var H$=Object.defineProperty;var k$=(i,e,t)=>e in i?H$(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var m_=(i,e,t)=>k$(i,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();function k3(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var dk={exports:{}},xE={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W$=Symbol.for("react.transitional.element"),X$=Symbol.for("react.fragment");function fk(i,e,t){var n=null;if(t!==void 0&&(n=""+t),e.key!==void 0&&(n=""+e.key),"key"in e){t={};for(var s in e)s!=="key"&&(t[s]=e[s])}else t=e;return e=t.ref,{$$typeof:W$,type:i,key:n,ref:e!==void 0?e:null,props:t}}xE.Fragment=X$;xE.jsx=fk;xE.jsxs=fk;dk.exports=xE;var G=dk.exports,pk={exports:{}},_E={},mk={exports:{}},gk={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(P,X){var J=P.length;P.push(X);e:for(;0<J;){var re=J-1>>>1,ne=P[re];if(0<s(ne,X))P[re]=X,P[J]=ne,J=re;else break e}}function t(P){return P.length===0?null:P[0]}function n(P){if(P.length===0)return null;var X=P[0],J=P.pop();if(J!==X){P[0]=J;e:for(var re=0,ne=P.length,ge=ne>>>1;re<ge;){var Te=2*(re+1)-1,Be=P[Te],et=Te+1,wt=P[et];if(0>s(Be,J))et<ne&&0>s(wt,Be)?(P[re]=wt,P[et]=J,re=et):(P[re]=Be,P[Te]=J,re=Te);else if(et<ne&&0>s(wt,J))P[re]=wt,P[et]=J,re=et;else break e}}return X}function s(P,X){var J=P.sortIndex-X.sortIndex;return J!==0?J:P.id-X.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;i.unstable_now=function(){return r.now()}}else{var a=Date,o=a.now();i.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,f=3,m=!1,g=!1,x=!1,v=!1,y=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;function T(P){for(var X=t(c);X!==null;){if(X.callback===null)n(c);else if(X.startTime<=P)n(c),X.sortIndex=X.expirationTime,e(l,X);else break;X=t(c)}}function M(P){if(x=!1,T(P),!g)if(t(l)!==null)g=!0,C||(C=!0,H());else{var X=t(c);X!==null&&Y(M,X.startTime-P)}}var C=!1,w=-1,N=5,E=-1;function B(){return v?!0:!(i.unstable_now()-E<N)}function U(){if(v=!1,C){var P=i.unstable_now();E=P;var X=!0;try{e:{g=!1,x&&(x=!1,b(w),w=-1),m=!0;var J=f;try{t:{for(T(P),h=t(l);h!==null&&!(h.expirationTime>P&&B());){var re=h.callback;if(typeof re=="function"){h.callback=null,f=h.priorityLevel;var ne=re(h.expirationTime<=P);if(P=i.unstable_now(),typeof ne=="function"){h.callback=ne,T(P),X=!0;break t}h===t(l)&&n(l),T(P)}else n(l);h=t(l)}if(h!==null)X=!0;else{var ge=t(c);ge!==null&&Y(M,ge.startTime-P),X=!1}}break e}finally{h=null,f=J,m=!1}X=void 0}}finally{X?H():C=!1}}}var H;if(typeof S=="function")H=function(){S(U)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,V=F.port2;F.port1.onmessage=U,H=function(){V.postMessage(null)}}else H=function(){y(U,0)};function Y(P,X){w=y(function(){P(i.unstable_now())},X)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(P){P.callback=null},i.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<P?Math.floor(1e3/P):5},i.unstable_getCurrentPriorityLevel=function(){return f},i.unstable_next=function(P){switch(f){case 1:case 2:case 3:var X=3;break;default:X=f}var J=f;f=X;try{return P()}finally{f=J}},i.unstable_requestPaint=function(){v=!0},i.unstable_runWithPriority=function(P,X){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var J=f;f=P;try{return X()}finally{f=J}},i.unstable_scheduleCallback=function(P,X,J){var re=i.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?re+J:re):J=re,P){case 1:var ne=-1;break;case 2:ne=250;break;case 5:ne=1073741823;break;case 4:ne=1e4;break;default:ne=5e3}return ne=J+ne,P={id:u++,callback:X,priorityLevel:P,startTime:J,expirationTime:ne,sortIndex:-1},J>re?(P.sortIndex=J,e(c,P),t(l)===null&&P===t(c)&&(x?(b(w),w=-1):x=!0,Y(M,J-re))):(P.sortIndex=ne,e(l,P),g||m||(g=!0,C||(C=!0,H()))),P},i.unstable_shouldYield=B,i.unstable_wrapCallback=function(P){var X=f;return function(){var J=f;f=X;try{return P.apply(this,arguments)}finally{f=J}}}})(gk);mk.exports=gk;var q$=mk.exports,yk={exports:{}},Bn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W3=Symbol.for("react.transitional.element"),j$=Symbol.for("react.portal"),Y$=Symbol.for("react.fragment"),K$=Symbol.for("react.strict_mode"),Z$=Symbol.for("react.profiler"),J$=Symbol.for("react.consumer"),Q$=Symbol.for("react.context"),$$=Symbol.for("react.forward_ref"),eee=Symbol.for("react.suspense"),tee=Symbol.for("react.memo"),xk=Symbol.for("react.lazy"),kG=Symbol.iterator;function nee(i){return i===null||typeof i!="object"?null:(i=kG&&i[kG]||i["@@iterator"],typeof i=="function"?i:null)}var _k={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},vk=Object.assign,bk={};function ux(i,e,t){this.props=i,this.context=e,this.refs=bk,this.updater=t||_k}ux.prototype.isReactComponent={};ux.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,e,"setState")};ux.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function Sk(){}Sk.prototype=ux.prototype;function X3(i,e,t){this.props=i,this.context=e,this.refs=bk,this.updater=t||_k}var q3=X3.prototype=new Sk;q3.constructor=X3;vk(q3,ux.prototype);q3.isPureReactComponent=!0;var WG=Array.isArray,rs={H:null,A:null,T:null,S:null,V:null},Tk=Object.prototype.hasOwnProperty;function j3(i,e,t,n,s,r){return t=r.ref,{$$typeof:W3,type:i,key:e,ref:t!==void 0?t:null,props:r}}function iee(i,e){return j3(i.type,e,void 0,void 0,void 0,i.props)}function Y3(i){return typeof i=="object"&&i!==null&&i.$$typeof===W3}function see(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(t){return e[t]})}var XG=/\/+/g;function kR(i,e){return typeof i=="object"&&i!==null&&i.key!=null?see(""+i.key):e.toString(36)}function qG(){}function ree(i){switch(i.status){case"fulfilled":return i.value;case"rejected":throw i.reason;default:switch(typeof i.status=="string"?i.then(qG,qG):(i.status="pending",i.then(function(e){i.status==="pending"&&(i.status="fulfilled",i.value=e)},function(e){i.status==="pending"&&(i.status="rejected",i.reason=e)})),i.status){case"fulfilled":return i.value;case"rejected":throw i.reason}}throw i}function F0(i,e,t,n,s){var r=typeof i;(r==="undefined"||r==="boolean")&&(i=null);var a=!1;if(i===null)a=!0;else switch(r){case"bigint":case"string":case"number":a=!0;break;case"object":switch(i.$$typeof){case W3:case j$:a=!0;break;case xk:return a=i._init,F0(a(i._payload),e,t,n,s)}}if(a)return s=s(i),a=n===""?"."+kR(i,0):n,WG(s)?(t="",a!=null&&(t=a.replace(XG,"$&/")+"/"),F0(s,e,t,"",function(c){return c})):s!=null&&(Y3(s)&&(s=iee(s,t+(s.key==null||i&&i.key===s.key?"":(""+s.key).replace(XG,"$&/")+"/")+a)),e.push(s)),1;a=0;var o=n===""?".":n+":";if(WG(i))for(var l=0;l<i.length;l++)n=i[l],r=o+kR(n,l),a+=F0(n,e,t,r,s);else if(l=nee(i),typeof l=="function")for(i=l.call(i),l=0;!(n=i.next()).done;)n=n.value,r=o+kR(n,l++),a+=F0(n,e,t,r,s);else if(r==="object"){if(typeof i.then=="function")return F0(ree(i),e,t,n,s);throw e=String(i),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return a}function qT(i,e,t){if(i==null)return i;var n=[],s=0;return F0(i,n,"","",function(r){return e.call(t,r,s++)}),n}function aee(i){if(i._status===-1){var e=i._result;e=e(),e.then(function(t){(i._status===0||i._status===-1)&&(i._status=1,i._result=t)},function(t){(i._status===0||i._status===-1)&&(i._status=2,i._result=t)}),i._status===-1&&(i._status=0,i._result=e)}if(i._status===1)return i._result.default;throw i._result}var jG=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function oee(){}Bn.Children={map:qT,forEach:function(i,e,t){qT(i,function(){e.apply(this,arguments)},t)},count:function(i){var e=0;return qT(i,function(){e++}),e},toArray:function(i){return qT(i,function(e){return e})||[]},only:function(i){if(!Y3(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};Bn.Component=ux;Bn.Fragment=Y$;Bn.Profiler=Z$;Bn.PureComponent=X3;Bn.StrictMode=K$;Bn.Suspense=eee;Bn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=rs;Bn.__COMPILER_RUNTIME={__proto__:null,c:function(i){return rs.H.useMemoCache(i)}};Bn.cache=function(i){return function(){return i.apply(null,arguments)}};Bn.cloneElement=function(i,e,t){if(i==null)throw Error("The argument must be a React element, but you passed "+i+".");var n=vk({},i.props),s=i.key,r=void 0;if(e!=null)for(a in e.ref!==void 0&&(r=void 0),e.key!==void 0&&(s=""+e.key),e)!Tk.call(e,a)||a==="key"||a==="__self"||a==="__source"||a==="ref"&&e.ref===void 0||(n[a]=e[a]);var a=arguments.length-2;if(a===1)n.children=t;else if(1<a){for(var o=Array(a),l=0;l<a;l++)o[l]=arguments[l+2];n.children=o}return j3(i.type,s,void 0,void 0,r,n)};Bn.createContext=function(i){return i={$$typeof:Q$,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null},i.Provider=i,i.Consumer={$$typeof:J$,_context:i},i};Bn.createElement=function(i,e,t){var n,s={},r=null;if(e!=null)for(n in e.key!==void 0&&(r=""+e.key),e)Tk.call(e,n)&&n!=="key"&&n!=="__self"&&n!=="__source"&&(s[n]=e[n]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var o=Array(a),l=0;l<a;l++)o[l]=arguments[l+2];s.children=o}if(i&&i.defaultProps)for(n in a=i.defaultProps,a)s[n]===void 0&&(s[n]=a[n]);return j3(i,r,void 0,void 0,null,s)};Bn.createRef=function(){return{current:null}};Bn.forwardRef=function(i){return{$$typeof:$$,render:i}};Bn.isValidElement=Y3;Bn.lazy=function(i){return{$$typeof:xk,_payload:{_status:-1,_result:i},_init:aee}};Bn.memo=function(i,e){return{$$typeof:tee,type:i,compare:e===void 0?null:e}};Bn.startTransition=function(i){var e=rs.T,t={};rs.T=t;try{var n=i(),s=rs.S;s!==null&&s(t,n),typeof n=="object"&&n!==null&&typeof n.then=="function"&&n.then(oee,jG)}catch(r){jG(r)}finally{rs.T=e}};Bn.unstable_useCacheRefresh=function(){return rs.H.useCacheRefresh()};Bn.use=function(i){return rs.H.use(i)};Bn.useActionState=function(i,e,t){return rs.H.useActionState(i,e,t)};Bn.useCallback=function(i,e){return rs.H.useCallback(i,e)};Bn.useContext=function(i){return rs.H.useContext(i)};Bn.useDebugValue=function(){};Bn.useDeferredValue=function(i,e){return rs.H.useDeferredValue(i,e)};Bn.useEffect=function(i,e,t){var n=rs.H;if(typeof t=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return n.useEffect(i,e)};Bn.useId=function(){return rs.H.useId()};Bn.useImperativeHandle=function(i,e,t){return rs.H.useImperativeHandle(i,e,t)};Bn.useInsertionEffect=function(i,e){return rs.H.useInsertionEffect(i,e)};Bn.useLayoutEffect=function(i,e){return rs.H.useLayoutEffect(i,e)};Bn.useMemo=function(i,e){return rs.H.useMemo(i,e)};Bn.useOptimistic=function(i,e){return rs.H.useOptimistic(i,e)};Bn.useReducer=function(i,e,t){return rs.H.useReducer(i,e,t)};Bn.useRef=function(i){return rs.H.useRef(i)};Bn.useState=function(i){return rs.H.useState(i)};Bn.useSyncExternalStore=function(i,e,t){return rs.H.useSyncExternalStore(i,e,t)};Bn.useTransition=function(){return rs.H.useTransition()};Bn.version="19.1.1";yk.exports=Bn;var $=yk.exports;const Ld=k3($);var Ak={exports:{}},Ja={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lee=$;function Mk(i){var e="https://react.dev/errors/"+i;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var t=2;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t])}return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function ad(){}var Ha={d:{f:ad,r:function(){throw Error(Mk(522))},D:ad,C:ad,L:ad,m:ad,X:ad,S:ad,M:ad},p:0,findDOMNode:null},cee=Symbol.for("react.portal");function uee(i,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:cee,key:n==null?null:""+n,children:i,containerInfo:e,implementation:t}}var _v=lee.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function vE(i,e){if(i==="font")return"";if(typeof e=="string")return e==="use-credentials"?e:""}Ja.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ha;Ja.createPortal=function(i,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)throw Error(Mk(299));return uee(i,e,null,t)};Ja.flushSync=function(i){var e=_v.T,t=Ha.p;try{if(_v.T=null,Ha.p=2,i)return i()}finally{_v.T=e,Ha.p=t,Ha.d.f()}};Ja.preconnect=function(i,e){typeof i=="string"&&(e?(e=e.crossOrigin,e=typeof e=="string"?e==="use-credentials"?e:"":void 0):e=null,Ha.d.C(i,e))};Ja.prefetchDNS=function(i){typeof i=="string"&&Ha.d.D(i)};Ja.preinit=function(i,e){if(typeof i=="string"&&e&&typeof e.as=="string"){var t=e.as,n=vE(t,e.crossOrigin),s=typeof e.integrity=="string"?e.integrity:void 0,r=typeof e.fetchPriority=="string"?e.fetchPriority:void 0;t==="style"?Ha.d.S(i,typeof e.precedence=="string"?e.precedence:void 0,{crossOrigin:n,integrity:s,fetchPriority:r}):t==="script"&&Ha.d.X(i,{crossOrigin:n,integrity:s,fetchPriority:r,nonce:typeof e.nonce=="string"?e.nonce:void 0})}};Ja.preinitModule=function(i,e){if(typeof i=="string")if(typeof e=="object"&&e!==null){if(e.as==null||e.as==="script"){var t=vE(e.as,e.crossOrigin);Ha.d.M(i,{crossOrigin:t,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0})}}else e==null&&Ha.d.M(i)};Ja.preload=function(i,e){if(typeof i=="string"&&typeof e=="object"&&e!==null&&typeof e.as=="string"){var t=e.as,n=vE(t,e.crossOrigin);Ha.d.L(i,t,{crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0,type:typeof e.type=="string"?e.type:void 0,fetchPriority:typeof e.fetchPriority=="string"?e.fetchPriority:void 0,referrerPolicy:typeof e.referrerPolicy=="string"?e.referrerPolicy:void 0,imageSrcSet:typeof e.imageSrcSet=="string"?e.imageSrcSet:void 0,imageSizes:typeof e.imageSizes=="string"?e.imageSizes:void 0,media:typeof e.media=="string"?e.media:void 0})}};Ja.preloadModule=function(i,e){if(typeof i=="string")if(e){var t=vE(e.as,e.crossOrigin);Ha.d.m(i,{as:typeof e.as=="string"&&e.as!=="script"?e.as:void 0,crossOrigin:t,integrity:typeof e.integrity=="string"?e.integrity:void 0})}else Ha.d.m(i)};Ja.requestFormReset=function(i){Ha.d.r(i)};Ja.unstable_batchedUpdates=function(i,e){return i(e)};Ja.useFormState=function(i,e,t){return _v.H.useFormState(i,e,t)};Ja.useFormStatus=function(){return _v.H.useHostTransitionStatus()};Ja.version="19.1.1";function Ek(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Ek)}catch(i){console.error(i)}}Ek(),Ak.exports=Ja;var hee=Ak.exports;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ur=q$,Ck=$,dee=hee;function nt(i){var e="https://react.dev/errors/"+i;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var t=2;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t])}return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function wk(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function jb(i){var e=i,t=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,e.flags&4098&&(t=e.return),i=e.return;while(i)}return e.tag===3?t:null}function Rk(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function YG(i){if(jb(i)!==i)throw Error(nt(188))}function fee(i){var e=i.alternate;if(!e){if(e=jb(i),e===null)throw Error(nt(188));return e!==i?null:i}for(var t=i,n=e;;){var s=t.return;if(s===null)break;var r=s.alternate;if(r===null){if(n=s.return,n!==null){t=n;continue}break}if(s.child===r.child){for(r=s.child;r;){if(r===t)return YG(s),i;if(r===n)return YG(s),e;r=r.sibling}throw Error(nt(188))}if(t.return!==n.return)t=s,n=r;else{for(var a=!1,o=s.child;o;){if(o===t){a=!0,t=s,n=r;break}if(o===n){a=!0,n=s,t=r;break}o=o.sibling}if(!a){for(o=r.child;o;){if(o===t){a=!0,t=r,n=s;break}if(o===n){a=!0,n=r,t=s;break}o=o.sibling}if(!a)throw Error(nt(189))}}if(t.alternate!==n)throw Error(nt(190))}if(t.tag!==3)throw Error(nt(188));return t.stateNode.current===t?i:e}function Nk(i){var e=i.tag;if(e===5||e===26||e===27||e===6)return i;for(i=i.child;i!==null;){if(e=Nk(i),e!==null)return e;i=i.sibling}return null}var Ji=Object.assign,pee=Symbol.for("react.element"),jT=Symbol.for("react.transitional.element"),av=Symbol.for("react.portal"),W0=Symbol.for("react.fragment"),Bk=Symbol.for("react.strict_mode"),UB=Symbol.for("react.profiler"),mee=Symbol.for("react.provider"),Dk=Symbol.for("react.consumer"),ah=Symbol.for("react.context"),K3=Symbol.for("react.forward_ref"),IB=Symbol.for("react.suspense"),PB=Symbol.for("react.suspense_list"),Z3=Symbol.for("react.memo"),bd=Symbol.for("react.lazy"),OB=Symbol.for("react.activity"),gee=Symbol.for("react.memo_cache_sentinel"),KG=Symbol.iterator;function g_(i){return i===null||typeof i!="object"?null:(i=KG&&i[KG]||i["@@iterator"],typeof i=="function"?i:null)}var yee=Symbol.for("react.client.reference");function FB(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===yee?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case W0:return"Fragment";case UB:return"Profiler";case Bk:return"StrictMode";case IB:return"Suspense";case PB:return"SuspenseList";case OB:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case av:return"Portal";case ah:return(i.displayName||"Context")+".Provider";case Dk:return(i._context.displayName||"Context")+".Consumer";case K3:var e=i.render;return i=i.displayName,i||(i=e.displayName||e.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Z3:return e=i.displayName||null,e!==null?e:FB(i.type)||"Memo";case bd:e=i._payload,i=i._init;try{return FB(i(e))}catch{}}return null}var ov=Array.isArray,_n=Ck.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,gi=dee.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ym={pending:!1,data:null,method:null,action:null},GB=[],X0=-1;function _u(i){return{current:i}}function Rr(i){0>X0||(i.current=GB[X0],GB[X0]=null,X0--)}function as(i,e){X0++,GB[X0]=i.current,i.current=e}var Kc=_u(null),nb=_u(null),jd=_u(null),eM=_u(null);function tM(i,e){switch(as(jd,e),as(nb,i),as(Kc,null),e.nodeType){case 9:case 11:i=(i=e.documentElement)&&(i=i.namespaceURI)?e4(i):0;break;default:if(i=e.tagName,e=e.namespaceURI)e=e4(e),i=K8(e,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}Rr(Kc),as(Kc,i)}function Ly(){Rr(Kc),Rr(nb),Rr(jd)}function zB(i){i.memoizedState!==null&&as(eM,i);var e=Kc.current,t=K8(e,i.type);e!==t&&(as(nb,i),as(Kc,t))}function nM(i){nb.current===i&&(Rr(Kc),Rr(nb)),eM.current===i&&(Rr(eM),db._currentValue=ym)}var VB=Object.prototype.hasOwnProperty,J3=ur.unstable_scheduleCallback,WR=ur.unstable_cancelCallback,xee=ur.unstable_shouldYield,_ee=ur.unstable_requestPaint,Zc=ur.unstable_now,vee=ur.unstable_getCurrentPriorityLevel,Lk=ur.unstable_ImmediatePriority,Uk=ur.unstable_UserBlockingPriority,iM=ur.unstable_NormalPriority,bee=ur.unstable_LowPriority,Ik=ur.unstable_IdlePriority,See=ur.log,Tee=ur.unstable_setDisableYieldValue,Yb=null,Xo=null;function Ud(i){if(typeof See=="function"&&Tee(i),Xo&&typeof Xo.setStrictMode=="function")try{Xo.setStrictMode(Yb,i)}catch{}}var qo=Math.clz32?Math.clz32:Eee,Aee=Math.log,Mee=Math.LN2;function Eee(i){return i>>>=0,i===0?32:31-(Aee(i)/Mee|0)|0}var YT=256,KT=4194304;function Qp(i){var e=i&42;if(e!==0)return e;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function bE(i,e,t){var n=i.pendingLanes;if(n===0)return 0;var s=0,r=i.suspendedLanes,a=i.pingedLanes;i=i.warmLanes;var o=n&134217727;return o!==0?(n=o&~r,n!==0?s=Qp(n):(a&=o,a!==0?s=Qp(a):t||(t=o&~i,t!==0&&(s=Qp(t))))):(o=n&~r,o!==0?s=Qp(o):a!==0?s=Qp(a):t||(t=n&~i,t!==0&&(s=Qp(t)))),s===0?0:e!==0&&e!==s&&!(e&r)&&(r=s&-s,t=e&-e,r>=t||r===32&&(t&4194048)!==0)?e:s}function Kb(i,e){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&e)===0}function Cee(i,e){switch(i){case 1:case 2:case 4:case 8:case 64:return e+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Pk(){var i=YT;return YT<<=1,!(YT&4194048)&&(YT=256),i}function Ok(){var i=KT;return KT<<=1,!(KT&62914560)&&(KT=4194304),i}function XR(i){for(var e=[],t=0;31>t;t++)e.push(i);return e}function Zb(i,e){i.pendingLanes|=e,e!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function wee(i,e,t,n,s,r){var a=i.pendingLanes;i.pendingLanes=t,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=t,i.entangledLanes&=t,i.errorRecoveryDisabledLanes&=t,i.shellSuspendCounter=0;var o=i.entanglements,l=i.expirationTimes,c=i.hiddenUpdates;for(t=a&~t;0<t;){var u=31-qo(t),h=1<<u;o[u]=0,l[u]=-1;var f=c[u];if(f!==null)for(c[u]=null,u=0;u<f.length;u++){var m=f[u];m!==null&&(m.lane&=-536870913)}t&=~h}n!==0&&Fk(i,n,0),r!==0&&s===0&&i.tag!==0&&(i.suspendedLanes|=r&~(a&~e))}function Fk(i,e,t){i.pendingLanes|=e,i.suspendedLanes&=~e;var n=31-qo(e);i.entangledLanes|=e,i.entanglements[n]=i.entanglements[n]|1073741824|t&4194090}function Gk(i,e){var t=i.entangledLanes|=e;for(i=i.entanglements;t;){var n=31-qo(t),s=1<<n;s&e|i[n]&e&&(i[n]|=e),t&=~s}}function Q3(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function $3(i){return i&=-i,2<i?8<i?i&134217727?32:268435456:8:2}function zk(){var i=gi.p;return i!==0?i:(i=window.event,i===void 0?32:r9(i.type))}function Ree(i,e){var t=gi.p;try{return gi.p=i,e()}finally{gi.p=t}}var qf=Math.random().toString(36).slice(2),pa="__reactFiber$"+qf,ho="__reactProps$"+qf,hx="__reactContainer$"+qf,HB="__reactEvents$"+qf,Nee="__reactListeners$"+qf,Bee="__reactHandles$"+qf,ZG="__reactResources$"+qf,Jb="__reactMarker$"+qf;function eL(i){delete i[pa],delete i[ho],delete i[HB],delete i[Nee],delete i[Bee]}function q0(i){var e=i[pa];if(e)return e;for(var t=i.parentNode;t;){if(e=t[hx]||t[pa]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(i=i4(i);i!==null;){if(t=i[pa])return t;i=i4(i)}return e}i=t,t=i.parentNode}return null}function dx(i){if(i=i[pa]||i[hx]){var e=i.tag;if(e===5||e===6||e===13||e===26||e===27||e===3)return i}return null}function lv(i){var e=i.tag;if(e===5||e===26||e===27||e===6)return i.stateNode;throw Error(nt(33))}function ly(i){var e=i[ZG];return e||(e=i[ZG]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function Ar(i){i[Jb]=!0}var Vk=new Set,Hk={};function cg(i,e){Uy(i,e),Uy(i+"Capture",e)}function Uy(i,e){for(Hk[i]=e,i=0;i<e.length;i++)Vk.add(e[i])}var Dee=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),JG={},QG={};function Lee(i){return VB.call(QG,i)?!0:VB.call(JG,i)?!1:Dee.test(i)?QG[i]=!0:(JG[i]=!0,!1)}function wA(i,e,t){if(Lee(e))if(t===null)i.removeAttribute(e);else{switch(typeof t){case"undefined":case"function":case"symbol":i.removeAttribute(e);return;case"boolean":var n=e.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){i.removeAttribute(e);return}}i.setAttribute(e,""+t)}}function ZT(i,e,t){if(t===null)i.removeAttribute(e);else{switch(typeof t){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(e);return}i.setAttribute(e,""+t)}}function Pu(i,e,t,n){if(n===null)i.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(t);return}i.setAttributeNS(e,t,""+n)}}var qR,$G;function G0(i){if(qR===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);qR=e&&e[1]||"",$G=-1<t.stack.indexOf(`
    at`)?" (<anonymous>)":-1<t.stack.indexOf("@")?"@unknown:0:0":""}return`
`+qR+i+$G}var jR=!1;function YR(i,e){if(!i||jR)return"";jR=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(e){var h=function(){throw Error()};if(Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(m){var f=m}Reflect.construct(i,[],h)}else{try{h.call()}catch(m){f=m}i.call(h.prototype)}}else{try{throw Error()}catch(m){f=m}(h=i())&&typeof h.catch=="function"&&h.catch(function(){})}}catch(m){if(m&&f&&typeof m.stack=="string")return[m.stack,f.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var s=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");s&&s.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var r=n.DetermineComponentFrameRoot(),a=r[0],o=r[1];if(a&&o){var l=a.split(`
`),c=o.split(`
`);for(s=n=0;n<l.length&&!l[n].includes("DetermineComponentFrameRoot");)n++;for(;s<c.length&&!c[s].includes("DetermineComponentFrameRoot");)s++;if(n===l.length||s===c.length)for(n=l.length-1,s=c.length-1;1<=n&&0<=s&&l[n]!==c[s];)s--;for(;1<=n&&0<=s;n--,s--)if(l[n]!==c[s]){if(n!==1||s!==1)do if(n--,s--,0>s||l[n]!==c[s]){var u=`
`+l[n].replace(" at new "," at ");return i.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",i.displayName)),u}while(1<=n&&0<=s);break}}}finally{jR=!1,Error.prepareStackTrace=t}return(t=i?i.displayName||i.name:"")?G0(t):""}function Uee(i){switch(i.tag){case 26:case 27:case 5:return G0(i.type);case 16:return G0("Lazy");case 13:return G0("Suspense");case 19:return G0("SuspenseList");case 0:case 15:return YR(i.type,!1);case 11:return YR(i.type.render,!1);case 1:return YR(i.type,!0);case 31:return G0("Activity");default:return""}}function ez(i){try{var e="";do e+=Uee(i),i=i.return;while(i);return e}catch(t){return`
Error generating stack: `+t.message+`
`+t.stack}}function Tl(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function kk(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Iee(i){var e=kk(i)?"checked":"value",t=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),n=""+i[e];if(!i.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,r=t.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){n=""+a,r.call(this,a)}}),Object.defineProperty(i,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function sM(i){i._valueTracker||(i._valueTracker=Iee(i))}function Wk(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return i&&(n=kk(i)?i.checked?"true":"false":i.value),i=n,i!==t?(e.setValue(i),!0):!1}function rM(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var Pee=/[\n"\\]/g;function Cl(i){return i.replace(Pee,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function kB(i,e,t,n,s,r,a,o){i.name="",a!=null&&typeof a!="function"&&typeof a!="symbol"&&typeof a!="boolean"?i.type=a:i.removeAttribute("type"),e!=null?a==="number"?(e===0&&i.value===""||i.value!=e)&&(i.value=""+Tl(e)):i.value!==""+Tl(e)&&(i.value=""+Tl(e)):a!=="submit"&&a!=="reset"||i.removeAttribute("value"),e!=null?WB(i,a,Tl(e)):t!=null?WB(i,a,Tl(t)):n!=null&&i.removeAttribute("value"),s==null&&r!=null&&(i.defaultChecked=!!r),s!=null&&(i.checked=s&&typeof s!="function"&&typeof s!="symbol"),o!=null&&typeof o!="function"&&typeof o!="symbol"&&typeof o!="boolean"?i.name=""+Tl(o):i.removeAttribute("name")}function Xk(i,e,t,n,s,r,a,o){if(r!=null&&typeof r!="function"&&typeof r!="symbol"&&typeof r!="boolean"&&(i.type=r),e!=null||t!=null){if(!(r!=="submit"&&r!=="reset"||e!=null))return;t=t!=null?""+Tl(t):"",e=e!=null?""+Tl(e):t,o||e===i.value||(i.value=e),i.defaultValue=e}n=n??s,n=typeof n!="function"&&typeof n!="symbol"&&!!n,i.checked=o?i.checked:!!n,i.defaultChecked=!!n,a!=null&&typeof a!="function"&&typeof a!="symbol"&&typeof a!="boolean"&&(i.name=a)}function WB(i,e,t){e==="number"&&rM(i.ownerDocument)===i||i.defaultValue===""+t||(i.defaultValue=""+t)}function cy(i,e,t,n){if(i=i.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<i.length;t++)s=e.hasOwnProperty("$"+i[t].value),i[t].selected!==s&&(i[t].selected=s),s&&n&&(i[t].defaultSelected=!0)}else{for(t=""+Tl(t),e=null,s=0;s<i.length;s++){if(i[s].value===t){i[s].selected=!0,n&&(i[s].defaultSelected=!0);return}e!==null||i[s].disabled||(e=i[s])}e!==null&&(e.selected=!0)}}function qk(i,e,t){if(e!=null&&(e=""+Tl(e),e!==i.value&&(i.value=e),t==null)){i.defaultValue!==e&&(i.defaultValue=e);return}i.defaultValue=t!=null?""+Tl(t):""}function jk(i,e,t,n){if(e==null){if(n!=null){if(t!=null)throw Error(nt(92));if(ov(n)){if(1<n.length)throw Error(nt(93));n=n[0]}t=n}t==null&&(t=""),e=t}t=Tl(e),i.defaultValue=t,n=i.textContent,n===t&&n!==""&&n!==null&&(i.value=n)}function Iy(i,e){if(e){var t=i.firstChild;if(t&&t===i.lastChild&&t.nodeType===3){t.nodeValue=e;return}}i.textContent=e}var Oee=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function tz(i,e,t){var n=e.indexOf("--")===0;t==null||typeof t=="boolean"||t===""?n?i.setProperty(e,""):e==="float"?i.cssFloat="":i[e]="":n?i.setProperty(e,t):typeof t!="number"||t===0||Oee.has(e)?e==="float"?i.cssFloat=t:i[e]=(""+t).trim():i[e]=t+"px"}function Yk(i,e,t){if(e!=null&&typeof e!="object")throw Error(nt(62));if(i=i.style,t!=null){for(var n in t)!t.hasOwnProperty(n)||e!=null&&e.hasOwnProperty(n)||(n.indexOf("--")===0?i.setProperty(n,""):n==="float"?i.cssFloat="":i[n]="");for(var s in e)n=e[s],e.hasOwnProperty(s)&&t[s]!==n&&tz(i,s,n)}else for(var r in e)e.hasOwnProperty(r)&&tz(i,r,e[r])}function tL(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Fee=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Gee=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function RA(i){return Gee.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var XB=null;function nL(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var j0=null,uy=null;function nz(i){var e=dx(i);if(e&&(i=e.stateNode)){var t=i[ho]||null;e:switch(i=e.stateNode,e.type){case"input":if(kB(i,t.value,t.defaultValue,t.defaultValue,t.checked,t.defaultChecked,t.type,t.name),e=t.name,t.type==="radio"&&e!=null){for(t=i;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll('input[name="'+Cl(""+e)+'"][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==i&&n.form===i.form){var s=n[ho]||null;if(!s)throw Error(nt(90));kB(n,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name)}}for(e=0;e<t.length;e++)n=t[e],n.form===i.form&&Wk(n)}break e;case"textarea":qk(i,t.value,t.defaultValue);break e;case"select":e=t.value,e!=null&&cy(i,!!t.multiple,e,!1)}}}var KR=!1;function Kk(i,e,t){if(KR)return i(e,t);KR=!0;try{var n=i(e);return n}finally{if(KR=!1,(j0!==null||uy!==null)&&(BE(),j0&&(e=j0,i=uy,uy=j0=null,nz(e),i)))for(e=0;e<i.length;e++)nz(i[e])}}function ib(i,e){var t=i.stateNode;if(t===null)return null;var n=t[ho]||null;if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(i=i.type,n=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!n;break e;default:i=!1}if(i)return null;if(t&&typeof t!="function")throw Error(nt(231,e,typeof t));return t}var Th=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qB=!1;if(Th)try{var y_={};Object.defineProperty(y_,"passive",{get:function(){qB=!0}}),window.addEventListener("test",y_,y_),window.removeEventListener("test",y_,y_)}catch{qB=!1}var Id=null,iL=null,NA=null;function Zk(){if(NA)return NA;var i,e=iL,t=e.length,n,s="value"in Id?Id.value:Id.textContent,r=s.length;for(i=0;i<t&&e[i]===s[i];i++);var a=t-i;for(n=1;n<=a&&e[t-n]===s[r-n];n++);return NA=s.slice(i,1<n?1-n:void 0)}function BA(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function JT(){return!0}function iz(){return!1}function go(i){function e(t,n,s,r,a){this._reactName=t,this._targetInst=s,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null;for(var o in i)i.hasOwnProperty(o)&&(t=i[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?JT:iz,this.isPropagationStopped=iz,this}return Ji(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=JT)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=JT)},persist:function(){},isPersistent:JT}),e}var ug={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},SE=go(ug),Qb=Ji({},ug,{view:0,detail:0}),zee=go(Qb),ZR,JR,x_,TE=Ji({},Qb,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:sL,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==x_&&(x_&&i.type==="mousemove"?(ZR=i.screenX-x_.screenX,JR=i.screenY-x_.screenY):JR=ZR=0,x_=i),ZR)},movementY:function(i){return"movementY"in i?i.movementY:JR}}),sz=go(TE),Vee=Ji({},TE,{dataTransfer:0}),Hee=go(Vee),kee=Ji({},Qb,{relatedTarget:0}),QR=go(kee),Wee=Ji({},ug,{animationName:0,elapsedTime:0,pseudoElement:0}),Xee=go(Wee),qee=Ji({},ug,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),jee=go(qee),Yee=Ji({},ug,{data:0}),rz=go(Yee),Kee={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Zee={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Jee={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Qee(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=Jee[i])?!!e[i]:!1}function sL(){return Qee}var $ee=Ji({},Qb,{key:function(i){if(i.key){var e=Kee[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=BA(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Zee[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:sL,charCode:function(i){return i.type==="keypress"?BA(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?BA(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),ete=go($ee),tte=Ji({},TE,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),az=go(tte),nte=Ji({},Qb,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:sL}),ite=go(nte),ste=Ji({},ug,{propertyName:0,elapsedTime:0,pseudoElement:0}),rte=go(ste),ate=Ji({},TE,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),ote=go(ate),lte=Ji({},ug,{newState:0,oldState:0}),cte=go(lte),ute=[9,13,27,32],rL=Th&&"CompositionEvent"in window,vv=null;Th&&"documentMode"in document&&(vv=document.documentMode);var hte=Th&&"TextEvent"in window&&!vv,Jk=Th&&(!rL||vv&&8<vv&&11>=vv),oz=" ",lz=!1;function Qk(i,e){switch(i){case"keyup":return ute.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $k(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Y0=!1;function dte(i,e){switch(i){case"compositionend":return $k(e);case"keypress":return e.which!==32?null:(lz=!0,oz);case"textInput":return i=e.data,i===oz&&lz?null:i;default:return null}}function fte(i,e){if(Y0)return i==="compositionend"||!rL&&Qk(i,e)?(i=Zk(),NA=iL=Id=null,Y0=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Jk&&e.locale!=="ko"?null:e.data;default:return null}}var pte={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cz(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!pte[i.type]:e==="textarea"}function e6(i,e,t,n){j0?uy?uy.push(n):uy=[n]:j0=n,e=TM(e,"onChange"),0<e.length&&(t=new SE("onChange","change",null,t,n),i.push({event:t,listeners:e}))}var bv=null,sb=null;function mte(i){q8(i,0)}function AE(i){var e=lv(i);if(Wk(e))return i}function uz(i,e){if(i==="change")return e}var t6=!1;if(Th){var $R;if(Th){var eN="oninput"in document;if(!eN){var hz=document.createElement("div");hz.setAttribute("oninput","return;"),eN=typeof hz.oninput=="function"}$R=eN}else $R=!1;t6=$R&&(!document.documentMode||9<document.documentMode)}function dz(){bv&&(bv.detachEvent("onpropertychange",n6),sb=bv=null)}function n6(i){if(i.propertyName==="value"&&AE(sb)){var e=[];e6(e,sb,i,nL(i)),Kk(mte,e)}}function gte(i,e,t){i==="focusin"?(dz(),bv=e,sb=t,bv.attachEvent("onpropertychange",n6)):i==="focusout"&&dz()}function yte(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return AE(sb)}function xte(i,e){if(i==="click")return AE(e)}function _te(i,e){if(i==="input"||i==="change")return AE(e)}function vte(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var $o=typeof Object.is=="function"?Object.is:vte;function rb(i,e){if($o(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var t=Object.keys(i),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var s=t[n];if(!VB.call(e,s)||!$o(i[s],e[s]))return!1}return!0}function fz(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function pz(i,e){var t=fz(i);i=0;for(var n;t;){if(t.nodeType===3){if(n=i+t.textContent.length,i<=e&&n>=e)return{node:t,offset:e-i};i=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=fz(t)}}function i6(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?i6(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function s6(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var e=rM(i.document);e instanceof i.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)i=e.contentWindow;else break;e=rM(i.document)}return e}function aL(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}var bte=Th&&"documentMode"in document&&11>=document.documentMode,K0=null,jB=null,Sv=null,YB=!1;function mz(i,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;YB||K0==null||K0!==rM(n)||(n=K0,"selectionStart"in n&&aL(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Sv&&rb(Sv,n)||(Sv=n,n=TM(jB,"onSelect"),0<n.length&&(e=new SE("onSelect","select",null,e,t),i.push({event:e,listeners:n}),e.target=K0)))}function wp(i,e){var t={};return t[i.toLowerCase()]=e.toLowerCase(),t["Webkit"+i]="webkit"+e,t["Moz"+i]="moz"+e,t}var Z0={animationend:wp("Animation","AnimationEnd"),animationiteration:wp("Animation","AnimationIteration"),animationstart:wp("Animation","AnimationStart"),transitionrun:wp("Transition","TransitionRun"),transitionstart:wp("Transition","TransitionStart"),transitioncancel:wp("Transition","TransitionCancel"),transitionend:wp("Transition","TransitionEnd")},tN={},r6={};Th&&(r6=document.createElement("div").style,"AnimationEvent"in window||(delete Z0.animationend.animation,delete Z0.animationiteration.animation,delete Z0.animationstart.animation),"TransitionEvent"in window||delete Z0.transitionend.transition);function hg(i){if(tN[i])return tN[i];if(!Z0[i])return i;var e=Z0[i],t;for(t in e)if(e.hasOwnProperty(t)&&t in r6)return tN[i]=e[t];return i}var a6=hg("animationend"),o6=hg("animationiteration"),l6=hg("animationstart"),Ste=hg("transitionrun"),Tte=hg("transitionstart"),Ate=hg("transitioncancel"),c6=hg("transitionend"),u6=new Map,KB="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");KB.push("scrollEnd");function Ec(i,e){u6.set(i,e),cg(e,[i])}var gz=new WeakMap;function wl(i,e){if(typeof i=="object"&&i!==null){var t=gz.get(i);return t!==void 0?t:(e={value:i,source:e,stack:ez(e)},gz.set(i,e),e)}return{value:i,source:e,stack:ez(e)}}var vl=[],J0=0,oL=0;function ME(){for(var i=J0,e=oL=J0=0;e<i;){var t=vl[e];vl[e++]=null;var n=vl[e];vl[e++]=null;var s=vl[e];vl[e++]=null;var r=vl[e];if(vl[e++]=null,n!==null&&s!==null){var a=n.pending;a===null?s.next=s:(s.next=a.next,a.next=s),n.pending=s}r!==0&&h6(t,s,r)}}function EE(i,e,t,n){vl[J0++]=i,vl[J0++]=e,vl[J0++]=t,vl[J0++]=n,oL|=n,i.lanes|=n,i=i.alternate,i!==null&&(i.lanes|=n)}function lL(i,e,t,n){return EE(i,e,t,n),aM(i)}function fx(i,e){return EE(i,null,null,e),aM(i)}function h6(i,e,t){i.lanes|=t;var n=i.alternate;n!==null&&(n.lanes|=t);for(var s=!1,r=i.return;r!==null;)r.childLanes|=t,n=r.alternate,n!==null&&(n.childLanes|=t),r.tag===22&&(i=r.stateNode,i===null||i._visibility&1||(s=!0)),i=r,r=r.return;return i.tag===3?(r=i.stateNode,s&&e!==null&&(s=31-qo(t),i=r.hiddenUpdates,n=i[s],n===null?i[s]=[e]:n.push(e),e.lane=t|536870912),r):null}function aM(i){if(50<Dv)throw Dv=0,gD=null,Error(nt(185));for(var e=i.return;e!==null;)i=e,e=i.return;return i.tag===3?i.stateNode:null}var Q0={};function Mte(i,e,t,n){this.tag=i,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Go(i,e,t,n){return new Mte(i,e,t,n)}function cL(i){return i=i.prototype,!(!i||!i.isReactComponent)}function mh(i,e){var t=i.alternate;return t===null?(t=Go(i.tag,e,i.key,i.mode),t.elementType=i.elementType,t.type=i.type,t.stateNode=i.stateNode,t.alternate=i,i.alternate=t):(t.pendingProps=e,t.type=i.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=i.flags&65011712,t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,e=i.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=i.sibling,t.index=i.index,t.ref=i.ref,t.refCleanup=i.refCleanup,t}function d6(i,e){i.flags&=65011714;var t=i.alternate;return t===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,i.type=t.type,e=t.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i}function DA(i,e,t,n,s,r){var a=0;if(n=i,typeof i=="function")cL(i)&&(a=1);else if(typeof i=="string")a=Cne(i,t,Kc.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case OB:return i=Go(31,t,e,s),i.elementType=OB,i.lanes=r,i;case W0:return xm(t.children,s,r,e);case Bk:a=8,s|=24;break;case UB:return i=Go(12,t,e,s|2),i.elementType=UB,i.lanes=r,i;case IB:return i=Go(13,t,e,s),i.elementType=IB,i.lanes=r,i;case PB:return i=Go(19,t,e,s),i.elementType=PB,i.lanes=r,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case mee:case ah:a=10;break e;case Dk:a=9;break e;case K3:a=11;break e;case Z3:a=14;break e;case bd:a=16,n=null;break e}a=29,t=Error(nt(130,i===null?"null":typeof i,"")),n=null}return e=Go(a,t,e,s),e.elementType=i,e.type=n,e.lanes=r,e}function xm(i,e,t,n){return i=Go(7,i,n,e),i.lanes=t,i}function nN(i,e,t){return i=Go(6,i,null,e),i.lanes=t,i}function iN(i,e,t){return e=Go(4,i.children!==null?i.children:[],i.key,e),e.lanes=t,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}var $0=[],ey=0,oM=null,lM=0,Al=[],Ml=0,_m=null,oh=1,lh="";function $p(i,e){$0[ey++]=lM,$0[ey++]=oM,oM=i,lM=e}function f6(i,e,t){Al[Ml++]=oh,Al[Ml++]=lh,Al[Ml++]=_m,_m=i;var n=oh;i=lh;var s=32-qo(n)-1;n&=~(1<<s),t+=1;var r=32-qo(e)+s;if(30<r){var a=s-s%5;r=(n&(1<<a)-1).toString(32),n>>=a,s-=a,oh=1<<32-qo(e)+s|t<<s|n,lh=r+i}else oh=1<<r|t<<s|n,lh=i}function uL(i){i.return!==null&&($p(i,1),f6(i,1,0))}function hL(i){for(;i===oM;)oM=$0[--ey],$0[ey]=null,lM=$0[--ey],$0[ey]=null;for(;i===_m;)_m=Al[--Ml],Al[Ml]=null,lh=Al[--Ml],Al[Ml]=null,oh=Al[--Ml],Al[Ml]=null}var Oa=null,vs=null,mi=!1,vm=null,kc=!1,ZB=Error(nt(519));function Dm(i){var e=Error(nt(418,""));throw ab(wl(e,i)),ZB}function yz(i){var e=i.stateNode,t=i.type,n=i.memoizedProps;switch(e[pa]=i,e[ho]=n,t){case"dialog":Hn("cancel",e),Hn("close",e);break;case"iframe":case"object":case"embed":Hn("load",e);break;case"video":case"audio":for(t=0;t<cb.length;t++)Hn(cb[t],e);break;case"source":Hn("error",e);break;case"img":case"image":case"link":Hn("error",e),Hn("load",e);break;case"details":Hn("toggle",e);break;case"input":Hn("invalid",e),Xk(e,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0),sM(e);break;case"select":Hn("invalid",e);break;case"textarea":Hn("invalid",e),jk(e,n.value,n.defaultValue,n.children),sM(e)}t=n.children,typeof t!="string"&&typeof t!="number"&&typeof t!="bigint"||e.textContent===""+t||n.suppressHydrationWarning===!0||Y8(e.textContent,t)?(n.popover!=null&&(Hn("beforetoggle",e),Hn("toggle",e)),n.onScroll!=null&&Hn("scroll",e),n.onScrollEnd!=null&&Hn("scrollend",e),n.onClick!=null&&(e.onclick=UE),e=!0):e=!1,e||Dm(i)}function xz(i){for(Oa=i.return;Oa;)switch(Oa.tag){case 5:case 13:kc=!1;return;case 27:case 3:kc=!0;return;default:Oa=Oa.return}}function __(i){if(i!==Oa)return!1;if(!mi)return xz(i),mi=!0,!1;var e=i.tag,t;if((t=e!==3&&e!==27)&&((t=e===5)&&(t=i.type,t=!(t!=="form"&&t!=="button")||SD(i.type,i.memoizedProps)),t=!t),t&&vs&&Dm(i),xz(i),e===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(nt(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8)if(t=i.data,t==="/$"){if(e===0){vs=yc(i.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++;i=i.nextSibling}vs=null}}else e===27?(e=vs,jf(i.type)?(i=MD,MD=null,vs=i):vs=e):vs=Oa?yc(i.stateNode.nextSibling):null;return!0}function $b(){vs=Oa=null,mi=!1}function _z(){var i=vm;return i!==null&&(so===null?so=i:so.push.apply(so,i),vm=null),i}function ab(i){vm===null?vm=[i]:vm.push(i)}var JB=_u(null),dg=null,ch=null;function Ed(i,e,t){as(JB,e._currentValue),e._currentValue=t}function gh(i){i._currentValue=JB.current,Rr(JB)}function QB(i,e,t){for(;i!==null;){var n=i.alternate;if((i.childLanes&e)!==e?(i.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),i===t)break;i=i.return}}function $B(i,e,t,n){var s=i.child;for(s!==null&&(s.return=i);s!==null;){var r=s.dependencies;if(r!==null){var a=s.child;r=r.firstContext;e:for(;r!==null;){var o=r;r=s;for(var l=0;l<e.length;l++)if(o.context===e[l]){r.lanes|=t,o=r.alternate,o!==null&&(o.lanes|=t),QB(r.return,t,i),n||(a=null);break e}r=o.next}}else if(s.tag===18){if(a=s.return,a===null)throw Error(nt(341));a.lanes|=t,r=a.alternate,r!==null&&(r.lanes|=t),QB(a,t,i),a=null}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===i){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}}function eS(i,e,t,n){i=null;for(var s=e,r=!1;s!==null;){if(!r){if(s.flags&524288)r=!0;else if(s.flags&262144)break}if(s.tag===10){var a=s.alternate;if(a===null)throw Error(nt(387));if(a=a.memoizedProps,a!==null){var o=s.type;$o(s.pendingProps.value,a.value)||(i!==null?i.push(o):i=[o])}}else if(s===eM.current){if(a=s.alternate,a===null)throw Error(nt(387));a.memoizedState.memoizedState!==s.memoizedState.memoizedState&&(i!==null?i.push(db):i=[db])}s=s.return}i!==null&&$B(e,i,t,n),e.flags|=262144}function cM(i){for(i=i.firstContext;i!==null;){if(!$o(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Lm(i){dg=i,ch=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function ma(i){return p6(dg,i)}function QT(i,e){return dg===null&&Lm(i),p6(i,e)}function p6(i,e){var t=e._currentValue;if(e={context:e,memoizedValue:t,next:null},ch===null){if(i===null)throw Error(nt(308));ch=e,i.dependencies={lanes:0,firstContext:e},i.flags|=524288}else ch=ch.next=e;return t}var Ete=typeof AbortController<"u"?AbortController:function(){var i=[],e=this.signal={aborted:!1,addEventListener:function(t,n){i.push(n)}};this.abort=function(){e.aborted=!0,i.forEach(function(t){return t()})}},Cte=ur.unstable_scheduleCallback,wte=ur.unstable_NormalPriority,ar={$$typeof:ah,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function dL(){return{controller:new Ete,data:new Map,refCount:0}}function tS(i){i.refCount--,i.refCount===0&&Cte(wte,function(){i.controller.abort()})}var Tv=null,eD=0,Py=0,hy=null;function Rte(i,e){if(Tv===null){var t=Tv=[];eD=0,Py=IL(),hy={status:"pending",value:void 0,then:function(n){t.push(n)}}}return eD++,e.then(vz,vz),e}function vz(){if(--eD===0&&Tv!==null){hy!==null&&(hy.status="fulfilled");var i=Tv;Tv=null,Py=0,hy=null;for(var e=0;e<i.length;e++)(0,i[e])()}}function Nte(i,e){var t=[],n={status:"pending",value:null,reason:null,then:function(s){t.push(s)}};return i.then(function(){n.status="fulfilled",n.value=e;for(var s=0;s<t.length;s++)(0,t[s])(e)},function(s){for(n.status="rejected",n.reason=s,s=0;s<t.length;s++)(0,t[s])(void 0)}),n}var bz=_n.S;_n.S=function(i,e){typeof e=="object"&&e!==null&&typeof e.then=="function"&&Rte(i,e),bz!==null&&bz(i,e)};var bm=_u(null);function fL(){var i=bm.current;return i!==null?i:Xi.pooledCache}function LA(i,e){e===null?as(bm,bm.current):as(bm,e.pool)}function m6(){var i=fL();return i===null?null:{parent:ar._currentValue,pool:i}}var nS=Error(nt(460)),g6=Error(nt(474)),CE=Error(nt(542)),tD={then:function(){}};function Sz(i){return i=i.status,i==="fulfilled"||i==="rejected"}function $T(){}function y6(i,e,t){switch(t=i[t],t===void 0?i.push(e):t!==e&&(e.then($T,$T),e=t),e.status){case"fulfilled":return e.value;case"rejected":throw i=e.reason,Az(i),i;default:if(typeof e.status=="string")e.then($T,$T);else{if(i=Xi,i!==null&&100<i.shellSuspendCounter)throw Error(nt(482));i=e,i.status="pending",i.then(function(n){if(e.status==="pending"){var s=e;s.status="fulfilled",s.value=n}},function(n){if(e.status==="pending"){var s=e;s.status="rejected",s.reason=n}})}switch(e.status){case"fulfilled":return e.value;case"rejected":throw i=e.reason,Az(i),i}throw Av=e,nS}}var Av=null;function Tz(){if(Av===null)throw Error(nt(459));var i=Av;return Av=null,i}function Az(i){if(i===nS||i===CE)throw Error(nt(483))}var Sd=!1;function pL(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function nD(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Yd(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Kd(i,e,t){var n=i.updateQueue;if(n===null)return null;if(n=n.shared,wi&2){var s=n.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),n.pending=e,e=aM(i),h6(i,null,t),e}return EE(i,n,e,t),aM(i)}function Mv(i,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194048)!==0)){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,Gk(i,t)}}function sN(i,e){var t=i.updateQueue,n=i.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var s=null,r=null;if(t=t.firstBaseUpdate,t!==null){do{var a={lane:t.lane,tag:t.tag,payload:t.payload,callback:null,next:null};r===null?s=r=a:r=r.next=a,t=t.next}while(t!==null);r===null?s=r=e:r=r.next=e}else s=r=e;t={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:n.shared,callbacks:n.callbacks},i.updateQueue=t;return}i=t.lastBaseUpdate,i===null?t.firstBaseUpdate=e:i.next=e,t.lastBaseUpdate=e}var iD=!1;function Ev(){if(iD){var i=hy;if(i!==null)throw i}}function Cv(i,e,t,n){iD=!1;var s=i.updateQueue;Sd=!1;var r=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var l=o,c=l.next;l.next=null,a===null?r=c:a.next=c,a=l;var u=i.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(r!==null){var h=s.baseState;a=0,u=c=l=null,o=r;do{var f=o.lane&-536870913,m=f!==o.lane;if(m?(Qn&f)===f:(n&f)===f){f!==0&&f===Py&&(iD=!0),u!==null&&(u=u.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var g=i,x=o;f=e;var v=t;switch(x.tag){case 1:if(g=x.payload,typeof g=="function"){h=g.call(v,h,f);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=x.payload,f=typeof g=="function"?g.call(v,h,f):g,f==null)break e;h=Ji({},h,f);break e;case 2:Sd=!0}}f=o.callback,f!==null&&(i.flags|=64,m&&(i.flags|=8192),m=s.callbacks,m===null?s.callbacks=[f]:m.push(f))}else m={lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(c=u=m,l=h):u=u.next=m,a|=f;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;m=o,o=m.next,m.next=null,s.lastBaseUpdate=m,s.shared.pending=null}}while(!0);u===null&&(l=h),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,r===null&&(s.shared.lanes=0),uf|=a,i.lanes=a,i.memoizedState=h}}function x6(i,e){if(typeof i!="function")throw Error(nt(191,i));i.call(e)}function _6(i,e){var t=i.callbacks;if(t!==null)for(i.callbacks=null,i=0;i<t.length;i++)x6(t[i],e)}var Oy=_u(null),uM=_u(0);function Mz(i,e){i=Eh,as(uM,i),as(Oy,e),Eh=i|e.baseLanes}function sD(){as(uM,Eh),as(Oy,Oy.current)}function mL(){Eh=uM.current,Rr(Oy),Rr(uM)}var lf=0,Un=null,Ii=null,Ks=null,hM=!1,dy=!1,Um=!1,dM=0,ob=0,fy=null,Bte=0;function Ns(){throw Error(nt(321))}function gL(i,e){if(e===null)return!1;for(var t=0;t<e.length&&t<i.length;t++)if(!$o(i[t],e[t]))return!1;return!0}function yL(i,e,t,n,s,r){return lf=r,Un=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,_n.H=i===null||i.memoizedState===null?Z6:J6,Um=!1,r=t(n,s),Um=!1,dy&&(r=b6(e,t,n,s)),v6(i),r}function v6(i){_n.H=fM;var e=Ii!==null&&Ii.next!==null;if(lf=0,Ks=Ii=Un=null,hM=!1,ob=0,fy=null,e)throw Error(nt(300));i===null||Er||(i=i.dependencies,i!==null&&cM(i)&&(Er=!0))}function b6(i,e,t,n){Un=i;var s=0;do{if(dy&&(fy=null),ob=0,dy=!1,25<=s)throw Error(nt(301));if(s+=1,Ks=Ii=null,i.updateQueue!=null){var r=i.updateQueue;r.lastEffect=null,r.events=null,r.stores=null,r.memoCache!=null&&(r.memoCache.index=0)}_n.H=Fte,r=e(t,n)}while(dy);return r}function Dte(){var i=_n.H,e=i.useState()[0];return e=typeof e.then=="function"?iS(e):e,i=i.useState()[0],(Ii!==null?Ii.memoizedState:null)!==i&&(Un.flags|=1024),e}function xL(){var i=dM!==0;return dM=0,i}function _L(i,e,t){e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~t}function vL(i){if(hM){for(i=i.memoizedState;i!==null;){var e=i.queue;e!==null&&(e.pending=null),i=i.next}hM=!1}lf=0,Ks=Ii=Un=null,dy=!1,ob=dM=0,fy=null}function no(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ks===null?Un.memoizedState=Ks=i:Ks=Ks.next=i,Ks}function er(){if(Ii===null){var i=Un.alternate;i=i!==null?i.memoizedState:null}else i=Ii.next;var e=Ks===null?Un.memoizedState:Ks.next;if(e!==null)Ks=e,Ii=i;else{if(i===null)throw Un.alternate===null?Error(nt(467)):Error(nt(310));Ii=i,i={memoizedState:Ii.memoizedState,baseState:Ii.baseState,baseQueue:Ii.baseQueue,queue:Ii.queue,next:null},Ks===null?Un.memoizedState=Ks=i:Ks=Ks.next=i}return Ks}function bL(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function iS(i){var e=ob;return ob+=1,fy===null&&(fy=[]),i=y6(fy,i,e),e=Un,(Ks===null?e.memoizedState:Ks.next)===null&&(e=e.alternate,_n.H=e===null||e.memoizedState===null?Z6:J6),i}function wE(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return iS(i);if(i.$$typeof===ah)return ma(i)}throw Error(nt(438,String(i)))}function SL(i){var e=null,t=Un.updateQueue;if(t!==null&&(e=t.memoCache),e==null){var n=Un.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(e={data:n.data.map(function(s){return s.slice()}),index:0})))}if(e==null&&(e={data:[],index:0}),t===null&&(t=bL(),Un.updateQueue=t),t.memoCache=e,t=e.data[e.index],t===void 0)for(t=e.data[e.index]=Array(i),n=0;n<i;n++)t[n]=gee;return e.index++,t}function Ah(i,e){return typeof e=="function"?e(i):e}function UA(i){var e=er();return TL(e,Ii,i)}function TL(i,e,t){var n=i.queue;if(n===null)throw Error(nt(311));n.lastRenderedReducer=t;var s=i.baseQueue,r=n.pending;if(r!==null){if(s!==null){var a=s.next;s.next=r.next,r.next=a}e.baseQueue=s=r,n.pending=null}if(r=i.baseState,s===null)i.memoizedState=r;else{e=s.next;var o=a=null,l=null,c=e,u=!1;do{var h=c.lane&-536870913;if(h!==c.lane?(Qn&h)===h:(lf&h)===h){var f=c.revertLane;if(f===0)l!==null&&(l=l.next={lane:0,revertLane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),h===Py&&(u=!0);else if((lf&f)===f){c=c.next,f===Py&&(u=!0);continue}else h={lane:0,revertLane:c.revertLane,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},l===null?(o=l=h,a=r):l=l.next=h,Un.lanes|=f,uf|=f;h=c.action,Um&&t(r,h),r=c.hasEagerState?c.eagerState:t(r,h)}else f={lane:h,revertLane:c.revertLane,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},l===null?(o=l=f,a=r):l=l.next=f,Un.lanes|=h,uf|=h;c=c.next}while(c!==null&&c!==e);if(l===null?a=r:l.next=o,!$o(r,i.memoizedState)&&(Er=!0,u&&(t=hy,t!==null)))throw t;i.memoizedState=r,i.baseState=a,i.baseQueue=l,n.lastRenderedState=r}return s===null&&(n.lanes=0),[i.memoizedState,n.dispatch]}function rN(i){var e=er(),t=e.queue;if(t===null)throw Error(nt(311));t.lastRenderedReducer=i;var n=t.dispatch,s=t.pending,r=e.memoizedState;if(s!==null){t.pending=null;var a=s=s.next;do r=i(r,a.action),a=a.next;while(a!==s);$o(r,e.memoizedState)||(Er=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),t.lastRenderedState=r}return[r,n]}function S6(i,e,t){var n=Un,s=er(),r=mi;if(r){if(t===void 0)throw Error(nt(407));t=t()}else t=e();var a=!$o((Ii||s).memoizedState,t);a&&(s.memoizedState=t,Er=!0),s=s.queue;var o=M6.bind(null,n,s,i);if(sS(2048,8,o,[i]),s.getSnapshot!==e||a||Ks!==null&&Ks.memoizedState.tag&1){if(n.flags|=2048,Fy(9,RE(),A6.bind(null,n,s,t,e),null),Xi===null)throw Error(nt(349));r||lf&124||T6(n,e,t)}return t}function T6(i,e,t){i.flags|=16384,i={getSnapshot:e,value:t},e=Un.updateQueue,e===null?(e=bL(),Un.updateQueue=e,e.stores=[i]):(t=e.stores,t===null?e.stores=[i]:t.push(i))}function A6(i,e,t,n){e.value=t,e.getSnapshot=n,E6(e)&&C6(i)}function M6(i,e,t){return t(function(){E6(e)&&C6(i)})}function E6(i){var e=i.getSnapshot;i=i.value;try{var t=e();return!$o(i,t)}catch{return!0}}function C6(i){var e=fx(i,2);e!==null&&Yo(e,i,2)}function rD(i){var e=no();if(typeof i=="function"){var t=i;if(i=t(),Um){Ud(!0);try{t()}finally{Ud(!1)}}}return e.memoizedState=e.baseState=i,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ah,lastRenderedState:i},e}function w6(i,e,t,n){return i.baseState=t,TL(i,Ii,typeof n=="function"?n:Ah)}function Lte(i,e,t,n,s){if(NE(i))throw Error(nt(485));if(i=e.action,i!==null){var r={payload:s,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(a){r.listeners.push(a)}};_n.T!==null?t(!0):r.isTransition=!1,n(r),t=e.pending,t===null?(r.next=e.pending=r,R6(e,r)):(r.next=t.next,e.pending=t.next=r)}}function R6(i,e){var t=e.action,n=e.payload,s=i.state;if(e.isTransition){var r=_n.T,a={};_n.T=a;try{var o=t(s,n),l=_n.S;l!==null&&l(a,o),Ez(i,e,o)}catch(c){aD(i,e,c)}finally{_n.T=r}}else try{r=t(s,n),Ez(i,e,r)}catch(c){aD(i,e,c)}}function Ez(i,e,t){t!==null&&typeof t=="object"&&typeof t.then=="function"?t.then(function(n){Cz(i,e,n)},function(n){return aD(i,e,n)}):Cz(i,e,t)}function Cz(i,e,t){e.status="fulfilled",e.value=t,N6(e),i.state=t,e=i.pending,e!==null&&(t=e.next,t===e?i.pending=null:(t=t.next,e.next=t,R6(i,t)))}function aD(i,e,t){var n=i.pending;if(i.pending=null,n!==null){n=n.next;do e.status="rejected",e.reason=t,N6(e),e=e.next;while(e!==n)}i.action=null}function N6(i){i=i.listeners;for(var e=0;e<i.length;e++)(0,i[e])()}function B6(i,e){return e}function wz(i,e){if(mi){var t=Xi.formState;if(t!==null){e:{var n=Un;if(mi){if(vs){t:{for(var s=vs,r=kc;s.nodeType!==8;){if(!r){s=null;break t}if(s=yc(s.nextSibling),s===null){s=null;break t}}r=s.data,s=r==="F!"||r==="F"?s:null}if(s){vs=yc(s.nextSibling),n=s.data==="F!";break e}}Dm(n)}n=!1}n&&(e=t[0])}}return t=no(),t.memoizedState=t.baseState=e,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:B6,lastRenderedState:e},t.queue=n,t=j6.bind(null,Un,n),n.dispatch=t,n=rD(!1),r=CL.bind(null,Un,!1,n.queue),n=no(),s={state:e,dispatch:null,action:i,pending:null},n.queue=s,t=Lte.bind(null,Un,s,r,t),s.dispatch=t,n.memoizedState=i,[e,t,!1]}function Rz(i){var e=er();return D6(e,Ii,i)}function D6(i,e,t){if(e=TL(i,e,B6)[0],i=UA(Ah)[0],typeof e=="object"&&e!==null&&typeof e.then=="function")try{var n=iS(e)}catch(a){throw a===nS?CE:a}else n=e;e=er();var s=e.queue,r=s.dispatch;return t!==e.memoizedState&&(Un.flags|=2048,Fy(9,RE(),Ute.bind(null,s,t),null)),[n,r,i]}function Ute(i,e){i.action=e}function Nz(i){var e=er(),t=Ii;if(t!==null)return D6(e,t,i);er(),e=e.memoizedState,t=er();var n=t.queue.dispatch;return t.memoizedState=i,[e,n,!1]}function Fy(i,e,t,n){return i={tag:i,create:t,deps:n,inst:e,next:null},e=Un.updateQueue,e===null&&(e=bL(),Un.updateQueue=e),t=e.lastEffect,t===null?e.lastEffect=i.next=i:(n=t.next,t.next=i,i.next=n,e.lastEffect=i),i}function RE(){return{destroy:void 0,resource:void 0}}function L6(){return er().memoizedState}function IA(i,e,t,n){var s=no();n=n===void 0?null:n,Un.flags|=i,s.memoizedState=Fy(1|e,RE(),t,n)}function sS(i,e,t,n){var s=er();n=n===void 0?null:n;var r=s.memoizedState.inst;Ii!==null&&n!==null&&gL(n,Ii.memoizedState.deps)?s.memoizedState=Fy(e,r,t,n):(Un.flags|=i,s.memoizedState=Fy(1|e,r,t,n))}function Bz(i,e){IA(8390656,8,i,e)}function U6(i,e){sS(2048,8,i,e)}function I6(i,e){return sS(4,2,i,e)}function P6(i,e){return sS(4,4,i,e)}function O6(i,e){if(typeof e=="function"){i=i();var t=e(i);return function(){typeof t=="function"?t():e(null)}}if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function F6(i,e,t){t=t!=null?t.concat([i]):null,sS(4,4,O6.bind(null,e,i),t)}function AL(){}function G6(i,e){var t=er();e=e===void 0?null:e;var n=t.memoizedState;return e!==null&&gL(e,n[1])?n[0]:(t.memoizedState=[i,e],i)}function z6(i,e){var t=er();e=e===void 0?null:e;var n=t.memoizedState;if(e!==null&&gL(e,n[1]))return n[0];if(n=i(),Um){Ud(!0);try{i()}finally{Ud(!1)}}return t.memoizedState=[n,e],n}function ML(i,e,t){return t===void 0||lf&1073741824?i.memoizedState=e:(i.memoizedState=t,i=N8(),Un.lanes|=i,uf|=i,t)}function V6(i,e,t,n){return $o(t,e)?t:Oy.current!==null?(i=ML(i,t,n),$o(i,e)||(Er=!0),i):lf&42?(i=N8(),Un.lanes|=i,uf|=i,e):(Er=!0,i.memoizedState=t)}function H6(i,e,t,n,s){var r=gi.p;gi.p=r!==0&&8>r?r:8;var a=_n.T,o={};_n.T=o,CL(i,!1,e,t);try{var l=s(),c=_n.S;if(c!==null&&c(o,l),l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=Nte(l,n);wv(i,e,u,jo(i))}else wv(i,e,n,jo(i))}catch(h){wv(i,e,{then:function(){},status:"rejected",reason:h},jo())}finally{gi.p=r,_n.T=a}}function Ite(){}function oD(i,e,t,n){if(i.tag!==5)throw Error(nt(476));var s=k6(i).queue;H6(i,s,e,ym,t===null?Ite:function(){return W6(i),t(n)})}function k6(i){var e=i.memoizedState;if(e!==null)return e;e={memoizedState:ym,baseState:ym,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ah,lastRenderedState:ym},next:null};var t={};return e.next={memoizedState:t,baseState:t,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ah,lastRenderedState:t},next:null},i.memoizedState=e,i=i.alternate,i!==null&&(i.memoizedState=e),e}function W6(i){var e=k6(i).next.queue;wv(i,e,{},jo())}function EL(){return ma(db)}function X6(){return er().memoizedState}function q6(){return er().memoizedState}function Pte(i){for(var e=i.return;e!==null;){switch(e.tag){case 24:case 3:var t=jo();i=Yd(t);var n=Kd(e,i,t);n!==null&&(Yo(n,e,t),Mv(n,e,t)),e={cache:dL()},i.payload=e;return}e=e.return}}function Ote(i,e,t){var n=jo();t={lane:n,revertLane:0,action:t,hasEagerState:!1,eagerState:null,next:null},NE(i)?Y6(e,t):(t=lL(i,e,t,n),t!==null&&(Yo(t,i,n),K6(t,e,n)))}function j6(i,e,t){var n=jo();wv(i,e,t,n)}function wv(i,e,t,n){var s={lane:n,revertLane:0,action:t,hasEagerState:!1,eagerState:null,next:null};if(NE(i))Y6(e,s);else{var r=i.alternate;if(i.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var a=e.lastRenderedState,o=r(a,t);if(s.hasEagerState=!0,s.eagerState=o,$o(o,a))return EE(i,e,s,0),Xi===null&&ME(),!1}catch{}finally{}if(t=lL(i,e,s,n),t!==null)return Yo(t,i,n),K6(t,e,n),!0}return!1}function CL(i,e,t,n){if(n={lane:2,revertLane:IL(),action:n,hasEagerState:!1,eagerState:null,next:null},NE(i)){if(e)throw Error(nt(479))}else e=lL(i,t,n,2),e!==null&&Yo(e,i,2)}function NE(i){var e=i.alternate;return i===Un||e!==null&&e===Un}function Y6(i,e){dy=hM=!0;var t=i.pending;t===null?e.next=e:(e.next=t.next,t.next=e),i.pending=e}function K6(i,e,t){if(t&4194048){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,Gk(i,t)}}var fM={readContext:ma,use:wE,useCallback:Ns,useContext:Ns,useEffect:Ns,useImperativeHandle:Ns,useLayoutEffect:Ns,useInsertionEffect:Ns,useMemo:Ns,useReducer:Ns,useRef:Ns,useState:Ns,useDebugValue:Ns,useDeferredValue:Ns,useTransition:Ns,useSyncExternalStore:Ns,useId:Ns,useHostTransitionStatus:Ns,useFormState:Ns,useActionState:Ns,useOptimistic:Ns,useMemoCache:Ns,useCacheRefresh:Ns},Z6={readContext:ma,use:wE,useCallback:function(i,e){return no().memoizedState=[i,e===void 0?null:e],i},useContext:ma,useEffect:Bz,useImperativeHandle:function(i,e,t){t=t!=null?t.concat([i]):null,IA(4194308,4,O6.bind(null,e,i),t)},useLayoutEffect:function(i,e){return IA(4194308,4,i,e)},useInsertionEffect:function(i,e){IA(4,2,i,e)},useMemo:function(i,e){var t=no();e=e===void 0?null:e;var n=i();if(Um){Ud(!0);try{i()}finally{Ud(!1)}}return t.memoizedState=[n,e],n},useReducer:function(i,e,t){var n=no();if(t!==void 0){var s=t(e);if(Um){Ud(!0);try{t(e)}finally{Ud(!1)}}}else s=e;return n.memoizedState=n.baseState=s,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:s},n.queue=i,i=i.dispatch=Ote.bind(null,Un,i),[n.memoizedState,i]},useRef:function(i){var e=no();return i={current:i},e.memoizedState=i},useState:function(i){i=rD(i);var e=i.queue,t=j6.bind(null,Un,e);return e.dispatch=t,[i.memoizedState,t]},useDebugValue:AL,useDeferredValue:function(i,e){var t=no();return ML(t,i,e)},useTransition:function(){var i=rD(!1);return i=H6.bind(null,Un,i.queue,!0,!1),no().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,e,t){var n=Un,s=no();if(mi){if(t===void 0)throw Error(nt(407));t=t()}else{if(t=e(),Xi===null)throw Error(nt(349));Qn&124||T6(n,e,t)}s.memoizedState=t;var r={value:t,getSnapshot:e};return s.queue=r,Bz(M6.bind(null,n,r,i),[i]),n.flags|=2048,Fy(9,RE(),A6.bind(null,n,r,t,e),null),t},useId:function(){var i=no(),e=Xi.identifierPrefix;if(mi){var t=lh,n=oh;t=(n&~(1<<32-qo(n)-1)).toString(32)+t,e=""+e+"R"+t,t=dM++,0<t&&(e+="H"+t.toString(32)),e+=""}else t=Bte++,e=""+e+"r"+t.toString(32)+"";return i.memoizedState=e},useHostTransitionStatus:EL,useFormState:wz,useActionState:wz,useOptimistic:function(i){var e=no();e.memoizedState=e.baseState=i;var t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=t,e=CL.bind(null,Un,!0,t),t.dispatch=e,[i,e]},useMemoCache:SL,useCacheRefresh:function(){return no().memoizedState=Pte.bind(null,Un)}},J6={readContext:ma,use:wE,useCallback:G6,useContext:ma,useEffect:U6,useImperativeHandle:F6,useInsertionEffect:I6,useLayoutEffect:P6,useMemo:z6,useReducer:UA,useRef:L6,useState:function(){return UA(Ah)},useDebugValue:AL,useDeferredValue:function(i,e){var t=er();return V6(t,Ii.memoizedState,i,e)},useTransition:function(){var i=UA(Ah)[0],e=er().memoizedState;return[typeof i=="boolean"?i:iS(i),e]},useSyncExternalStore:S6,useId:X6,useHostTransitionStatus:EL,useFormState:Rz,useActionState:Rz,useOptimistic:function(i,e){var t=er();return w6(t,Ii,i,e)},useMemoCache:SL,useCacheRefresh:q6},Fte={readContext:ma,use:wE,useCallback:G6,useContext:ma,useEffect:U6,useImperativeHandle:F6,useInsertionEffect:I6,useLayoutEffect:P6,useMemo:z6,useReducer:rN,useRef:L6,useState:function(){return rN(Ah)},useDebugValue:AL,useDeferredValue:function(i,e){var t=er();return Ii===null?ML(t,i,e):V6(t,Ii.memoizedState,i,e)},useTransition:function(){var i=rN(Ah)[0],e=er().memoizedState;return[typeof i=="boolean"?i:iS(i),e]},useSyncExternalStore:S6,useId:X6,useHostTransitionStatus:EL,useFormState:Nz,useActionState:Nz,useOptimistic:function(i,e){var t=er();return Ii!==null?w6(t,Ii,i,e):(t.baseState=i,[i,t.queue.dispatch])},useMemoCache:SL,useCacheRefresh:q6},py=null,lb=0;function e1(i){var e=lb;return lb+=1,py===null&&(py=[]),y6(py,i,e)}function v_(i,e){e=e.props.ref,i.ref=e!==void 0?e:null}function t1(i,e){throw e.$$typeof===pee?Error(nt(525)):(i=Object.prototype.toString.call(e),Error(nt(31,i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i)))}function Dz(i){var e=i._init;return e(i._payload)}function Q6(i){function e(y,b){if(i){var S=y.deletions;S===null?(y.deletions=[b],y.flags|=16):S.push(b)}}function t(y,b){if(!i)return null;for(;b!==null;)e(y,b),b=b.sibling;return null}function n(y){for(var b=new Map;y!==null;)y.key!==null?b.set(y.key,y):b.set(y.index,y),y=y.sibling;return b}function s(y,b){return y=mh(y,b),y.index=0,y.sibling=null,y}function r(y,b,S){return y.index=S,i?(S=y.alternate,S!==null?(S=S.index,S<b?(y.flags|=67108866,b):S):(y.flags|=67108866,b)):(y.flags|=1048576,b)}function a(y){return i&&y.alternate===null&&(y.flags|=67108866),y}function o(y,b,S,T){return b===null||b.tag!==6?(b=nN(S,y.mode,T),b.return=y,b):(b=s(b,S),b.return=y,b)}function l(y,b,S,T){var M=S.type;return M===W0?u(y,b,S.props.children,T,S.key):b!==null&&(b.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===bd&&Dz(M)===b.type)?(b=s(b,S.props),v_(b,S),b.return=y,b):(b=DA(S.type,S.key,S.props,null,y.mode,T),v_(b,S),b.return=y,b)}function c(y,b,S,T){return b===null||b.tag!==4||b.stateNode.containerInfo!==S.containerInfo||b.stateNode.implementation!==S.implementation?(b=iN(S,y.mode,T),b.return=y,b):(b=s(b,S.children||[]),b.return=y,b)}function u(y,b,S,T,M){return b===null||b.tag!==7?(b=xm(S,y.mode,T,M),b.return=y,b):(b=s(b,S),b.return=y,b)}function h(y,b,S){if(typeof b=="string"&&b!==""||typeof b=="number"||typeof b=="bigint")return b=nN(""+b,y.mode,S),b.return=y,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case jT:return S=DA(b.type,b.key,b.props,null,y.mode,S),v_(S,b),S.return=y,S;case av:return b=iN(b,y.mode,S),b.return=y,b;case bd:var T=b._init;return b=T(b._payload),h(y,b,S)}if(ov(b)||g_(b))return b=xm(b,y.mode,S,null),b.return=y,b;if(typeof b.then=="function")return h(y,e1(b),S);if(b.$$typeof===ah)return h(y,QT(y,b),S);t1(y,b)}return null}function f(y,b,S,T){var M=b!==null?b.key:null;if(typeof S=="string"&&S!==""||typeof S=="number"||typeof S=="bigint")return M!==null?null:o(y,b,""+S,T);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case jT:return S.key===M?l(y,b,S,T):null;case av:return S.key===M?c(y,b,S,T):null;case bd:return M=S._init,S=M(S._payload),f(y,b,S,T)}if(ov(S)||g_(S))return M!==null?null:u(y,b,S,T,null);if(typeof S.then=="function")return f(y,b,e1(S),T);if(S.$$typeof===ah)return f(y,b,QT(y,S),T);t1(y,S)}return null}function m(y,b,S,T,M){if(typeof T=="string"&&T!==""||typeof T=="number"||typeof T=="bigint")return y=y.get(S)||null,o(b,y,""+T,M);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case jT:return y=y.get(T.key===null?S:T.key)||null,l(b,y,T,M);case av:return y=y.get(T.key===null?S:T.key)||null,c(b,y,T,M);case bd:var C=T._init;return T=C(T._payload),m(y,b,S,T,M)}if(ov(T)||g_(T))return y=y.get(S)||null,u(b,y,T,M,null);if(typeof T.then=="function")return m(y,b,S,e1(T),M);if(T.$$typeof===ah)return m(y,b,S,QT(b,T),M);t1(b,T)}return null}function g(y,b,S,T){for(var M=null,C=null,w=b,N=b=0,E=null;w!==null&&N<S.length;N++){w.index>N?(E=w,w=null):E=w.sibling;var B=f(y,w,S[N],T);if(B===null){w===null&&(w=E);break}i&&w&&B.alternate===null&&e(y,w),b=r(B,b,N),C===null?M=B:C.sibling=B,C=B,w=E}if(N===S.length)return t(y,w),mi&&$p(y,N),M;if(w===null){for(;N<S.length;N++)w=h(y,S[N],T),w!==null&&(b=r(w,b,N),C===null?M=w:C.sibling=w,C=w);return mi&&$p(y,N),M}for(w=n(w);N<S.length;N++)E=m(w,y,N,S[N],T),E!==null&&(i&&E.alternate!==null&&w.delete(E.key===null?N:E.key),b=r(E,b,N),C===null?M=E:C.sibling=E,C=E);return i&&w.forEach(function(U){return e(y,U)}),mi&&$p(y,N),M}function x(y,b,S,T){if(S==null)throw Error(nt(151));for(var M=null,C=null,w=b,N=b=0,E=null,B=S.next();w!==null&&!B.done;N++,B=S.next()){w.index>N?(E=w,w=null):E=w.sibling;var U=f(y,w,B.value,T);if(U===null){w===null&&(w=E);break}i&&w&&U.alternate===null&&e(y,w),b=r(U,b,N),C===null?M=U:C.sibling=U,C=U,w=E}if(B.done)return t(y,w),mi&&$p(y,N),M;if(w===null){for(;!B.done;N++,B=S.next())B=h(y,B.value,T),B!==null&&(b=r(B,b,N),C===null?M=B:C.sibling=B,C=B);return mi&&$p(y,N),M}for(w=n(w);!B.done;N++,B=S.next())B=m(w,y,N,B.value,T),B!==null&&(i&&B.alternate!==null&&w.delete(B.key===null?N:B.key),b=r(B,b,N),C===null?M=B:C.sibling=B,C=B);return i&&w.forEach(function(H){return e(y,H)}),mi&&$p(y,N),M}function v(y,b,S,T){if(typeof S=="object"&&S!==null&&S.type===W0&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case jT:e:{for(var M=S.key;b!==null;){if(b.key===M){if(M=S.type,M===W0){if(b.tag===7){t(y,b.sibling),T=s(b,S.props.children),T.return=y,y=T;break e}}else if(b.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===bd&&Dz(M)===b.type){t(y,b.sibling),T=s(b,S.props),v_(T,S),T.return=y,y=T;break e}t(y,b);break}else e(y,b);b=b.sibling}S.type===W0?(T=xm(S.props.children,y.mode,T,S.key),T.return=y,y=T):(T=DA(S.type,S.key,S.props,null,y.mode,T),v_(T,S),T.return=y,y=T)}return a(y);case av:e:{for(M=S.key;b!==null;){if(b.key===M)if(b.tag===4&&b.stateNode.containerInfo===S.containerInfo&&b.stateNode.implementation===S.implementation){t(y,b.sibling),T=s(b,S.children||[]),T.return=y,y=T;break e}else{t(y,b);break}else e(y,b);b=b.sibling}T=iN(S,y.mode,T),T.return=y,y=T}return a(y);case bd:return M=S._init,S=M(S._payload),v(y,b,S,T)}if(ov(S))return g(y,b,S,T);if(g_(S)){if(M=g_(S),typeof M!="function")throw Error(nt(150));return S=M.call(S),x(y,b,S,T)}if(typeof S.then=="function")return v(y,b,e1(S),T);if(S.$$typeof===ah)return v(y,b,QT(y,S),T);t1(y,S)}return typeof S=="string"&&S!==""||typeof S=="number"||typeof S=="bigint"?(S=""+S,b!==null&&b.tag===6?(t(y,b.sibling),T=s(b,S),T.return=y,y=T):(t(y,b),T=nN(S,y.mode,T),T.return=y,y=T),a(y)):t(y,b)}return function(y,b,S,T){try{lb=0;var M=v(y,b,S,T);return py=null,M}catch(w){if(w===nS||w===CE)throw w;var C=Go(29,w,null,y.mode);return C.lanes=T,C.return=y,C}finally{}}}var Gy=Q6(!0),$6=Q6(!1),Wl=_u(null),Jc=null;function Cd(i){var e=i.alternate;as(or,or.current&1),as(Wl,i),Jc===null&&(e===null||Oy.current!==null||e.memoizedState!==null)&&(Jc=i)}function e8(i){if(i.tag===22){if(as(or,or.current),as(Wl,i),Jc===null){var e=i.alternate;e!==null&&e.memoizedState!==null&&(Jc=i)}}else wd()}function wd(){as(or,or.current),as(Wl,Wl.current)}function uh(i){Rr(Wl),Jc===i&&(Jc=null),Rr(or)}var or=_u(0);function pM(i){for(var e=i;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||AD(t)))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}function aN(i,e,t,n){e=i.memoizedState,t=t(n,e),t=t==null?e:Ji({},e,t),i.memoizedState=t,i.lanes===0&&(i.updateQueue.baseState=t)}var lD={enqueueSetState:function(i,e,t){i=i._reactInternals;var n=jo(),s=Yd(n);s.payload=e,t!=null&&(s.callback=t),e=Kd(i,s,n),e!==null&&(Yo(e,i,n),Mv(e,i,n))},enqueueReplaceState:function(i,e,t){i=i._reactInternals;var n=jo(),s=Yd(n);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=Kd(i,s,n),e!==null&&(Yo(e,i,n),Mv(e,i,n))},enqueueForceUpdate:function(i,e){i=i._reactInternals;var t=jo(),n=Yd(t);n.tag=2,e!=null&&(n.callback=e),e=Kd(i,n,t),e!==null&&(Yo(e,i,t),Mv(e,i,t))}};function Lz(i,e,t,n,s,r,a){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(n,r,a):e.prototype&&e.prototype.isPureReactComponent?!rb(t,n)||!rb(s,r):!0}function Uz(i,e,t,n){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==i&&lD.enqueueReplaceState(e,e.state,null)}function Im(i,e){var t=e;if("ref"in e){t={};for(var n in e)n!=="ref"&&(t[n]=e[n])}if(i=i.defaultProps){t===e&&(t=Ji({},t));for(var s in i)t[s]===void 0&&(t[s]=i[s])}return t}var mM=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function t8(i){mM(i)}function n8(i){console.error(i)}function i8(i){mM(i)}function gM(i,e){try{var t=i.onUncaughtError;t(e.value,{componentStack:e.stack})}catch(n){setTimeout(function(){throw n})}}function Iz(i,e,t){try{var n=i.onCaughtError;n(t.value,{componentStack:t.stack,errorBoundary:e.tag===1?e.stateNode:null})}catch(s){setTimeout(function(){throw s})}}function cD(i,e,t){return t=Yd(t),t.tag=3,t.payload={element:null},t.callback=function(){gM(i,e)},t}function s8(i){return i=Yd(i),i.tag=3,i}function r8(i,e,t,n){var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var r=n.value;i.payload=function(){return s(r)},i.callback=function(){Iz(e,t,n)}}var a=t.stateNode;a!==null&&typeof a.componentDidCatch=="function"&&(i.callback=function(){Iz(e,t,n),typeof s!="function"&&(Zd===null?Zd=new Set([this]):Zd.add(this));var o=n.stack;this.componentDidCatch(n.value,{componentStack:o!==null?o:""})})}function Gte(i,e,t,n,s){if(t.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(e=t.alternate,e!==null&&eS(e,t,s,!0),t=Wl.current,t!==null){switch(t.tag){case 13:return Jc===null?yD():t.alternate===null&&Ss===0&&(Ss=3),t.flags&=-257,t.flags|=65536,t.lanes=s,n===tD?t.flags|=16384:(e=t.updateQueue,e===null?t.updateQueue=new Set([n]):e.add(n),yN(i,n,s)),!1;case 22:return t.flags|=65536,n===tD?t.flags|=16384:(e=t.updateQueue,e===null?(e={transitions:null,markerInstances:null,retryQueue:new Set([n])},t.updateQueue=e):(t=e.retryQueue,t===null?e.retryQueue=new Set([n]):t.add(n)),yN(i,n,s)),!1}throw Error(nt(435,t.tag))}return yN(i,n,s),yD(),!1}if(mi)return e=Wl.current,e!==null?(!(e.flags&65536)&&(e.flags|=256),e.flags|=65536,e.lanes=s,n!==ZB&&(i=Error(nt(422),{cause:n}),ab(wl(i,t)))):(n!==ZB&&(e=Error(nt(423),{cause:n}),ab(wl(e,t))),i=i.current.alternate,i.flags|=65536,s&=-s,i.lanes|=s,n=wl(n,t),s=cD(i.stateNode,n,s),sN(i,s),Ss!==4&&(Ss=2)),!1;var r=Error(nt(520),{cause:n});if(r=wl(r,t),Bv===null?Bv=[r]:Bv.push(r),Ss!==4&&(Ss=2),e===null)return!0;n=wl(n,t),t=e;do{switch(t.tag){case 3:return t.flags|=65536,i=s&-s,t.lanes|=i,i=cD(t.stateNode,n,i),sN(t,i),!1;case 1:if(e=t.type,r=t.stateNode,(t.flags&128)===0&&(typeof e.getDerivedStateFromError=="function"||r!==null&&typeof r.componentDidCatch=="function"&&(Zd===null||!Zd.has(r))))return t.flags|=65536,s&=-s,t.lanes|=s,s=s8(s),r8(s,i,t,n),sN(t,s),!1}t=t.return}while(t!==null);return!1}var a8=Error(nt(461)),Er=!1;function Vr(i,e,t,n){e.child=i===null?$6(e,null,t,n):Gy(e,i.child,t,n)}function Pz(i,e,t,n,s){t=t.render;var r=e.ref;if("ref"in n){var a={};for(var o in n)o!=="ref"&&(a[o]=n[o])}else a=n;return Lm(e),n=yL(i,e,t,a,r,s),o=xL(),i!==null&&!Er?(_L(i,e,s),Mh(i,e,s)):(mi&&o&&uL(e),e.flags|=1,Vr(i,e,n,s),e.child)}function Oz(i,e,t,n,s){if(i===null){var r=t.type;return typeof r=="function"&&!cL(r)&&r.defaultProps===void 0&&t.compare===null?(e.tag=15,e.type=r,o8(i,e,r,n,s)):(i=DA(t.type,null,n,e,e.mode,s),i.ref=e.ref,i.return=e,e.child=i)}if(r=i.child,!wL(i,s)){var a=r.memoizedProps;if(t=t.compare,t=t!==null?t:rb,t(a,n)&&i.ref===e.ref)return Mh(i,e,s)}return e.flags|=1,i=mh(r,n),i.ref=e.ref,i.return=e,e.child=i}function o8(i,e,t,n,s){if(i!==null){var r=i.memoizedProps;if(rb(r,n)&&i.ref===e.ref)if(Er=!1,e.pendingProps=n=r,wL(i,s))i.flags&131072&&(Er=!0);else return e.lanes=i.lanes,Mh(i,e,s)}return uD(i,e,t,n,s)}function l8(i,e,t){var n=e.pendingProps,s=n.children,r=i!==null?i.memoizedState:null;if(n.mode==="hidden"){if(e.flags&128){if(n=r!==null?r.baseLanes|t:t,i!==null){for(s=e.child=i.child,r=0;s!==null;)r=r|s.lanes|s.childLanes,s=s.sibling;e.childLanes=r&~n}else e.childLanes=0,e.child=null;return Fz(i,e,n,t)}if(t&536870912)e.memoizedState={baseLanes:0,cachePool:null},i!==null&&LA(e,r!==null?r.cachePool:null),r!==null?Mz(e,r):sD(),e8(e);else return e.lanes=e.childLanes=536870912,Fz(i,e,r!==null?r.baseLanes|t:t,t)}else r!==null?(LA(e,r.cachePool),Mz(e,r),wd(),e.memoizedState=null):(i!==null&&LA(e,null),sD(),wd());return Vr(i,e,s,t),e.child}function Fz(i,e,t,n){var s=fL();return s=s===null?null:{parent:ar._currentValue,pool:s},e.memoizedState={baseLanes:t,cachePool:s},i!==null&&LA(e,null),sD(),e8(e),i!==null&&eS(i,e,n,!0),null}function PA(i,e){var t=e.ref;if(t===null)i!==null&&i.ref!==null&&(e.flags|=4194816);else{if(typeof t!="function"&&typeof t!="object")throw Error(nt(284));(i===null||i.ref!==t)&&(e.flags|=4194816)}}function uD(i,e,t,n,s){return Lm(e),t=yL(i,e,t,n,void 0,s),n=xL(),i!==null&&!Er?(_L(i,e,s),Mh(i,e,s)):(mi&&n&&uL(e),e.flags|=1,Vr(i,e,t,s),e.child)}function Gz(i,e,t,n,s,r){return Lm(e),e.updateQueue=null,t=b6(e,n,t,s),v6(i),n=xL(),i!==null&&!Er?(_L(i,e,r),Mh(i,e,r)):(mi&&n&&uL(e),e.flags|=1,Vr(i,e,t,r),e.child)}function zz(i,e,t,n,s){if(Lm(e),e.stateNode===null){var r=Q0,a=t.contextType;typeof a=="object"&&a!==null&&(r=ma(a)),r=new t(n,r),e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=lD,e.stateNode=r,r._reactInternals=e,r=e.stateNode,r.props=n,r.state=e.memoizedState,r.refs={},pL(e),a=t.contextType,r.context=typeof a=="object"&&a!==null?ma(a):Q0,r.state=e.memoizedState,a=t.getDerivedStateFromProps,typeof a=="function"&&(aN(e,t,a,n),r.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(a=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),a!==r.state&&lD.enqueueReplaceState(r,r.state,null),Cv(e,n,r,s),Ev(),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308),n=!0}else if(i===null){r=e.stateNode;var o=e.memoizedProps,l=Im(t,o);r.props=l;var c=r.context,u=t.contextType;a=Q0,typeof u=="object"&&u!==null&&(a=ma(u));var h=t.getDerivedStateFromProps;u=typeof h=="function"||typeof r.getSnapshotBeforeUpdate=="function",o=e.pendingProps!==o,u||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(o||c!==a)&&Uz(e,r,n,a),Sd=!1;var f=e.memoizedState;r.state=f,Cv(e,n,r,s),Ev(),c=e.memoizedState,o||f!==c||Sd?(typeof h=="function"&&(aN(e,t,h,n),c=e.memoizedState),(l=Sd||Lz(e,t,l,n,f,c,a))?(u||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount()),typeof r.componentDidMount=="function"&&(e.flags|=4194308)):(typeof r.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),r.props=n,r.state=c,r.context=a,n=l):(typeof r.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{r=e.stateNode,nD(i,e),a=e.memoizedProps,u=Im(t,a),r.props=u,h=e.pendingProps,f=r.context,c=t.contextType,l=Q0,typeof c=="object"&&c!==null&&(l=ma(c)),o=t.getDerivedStateFromProps,(c=typeof o=="function"||typeof r.getSnapshotBeforeUpdate=="function")||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(a!==h||f!==l)&&Uz(e,r,n,l),Sd=!1,f=e.memoizedState,r.state=f,Cv(e,n,r,s),Ev();var m=e.memoizedState;a!==h||f!==m||Sd||i!==null&&i.dependencies!==null&&cM(i.dependencies)?(typeof o=="function"&&(aN(e,t,o,n),m=e.memoizedState),(u=Sd||Lz(e,t,u,n,f,m,l)||i!==null&&i.dependencies!==null&&cM(i.dependencies))?(c||typeof r.UNSAFE_componentWillUpdate!="function"&&typeof r.componentWillUpdate!="function"||(typeof r.componentWillUpdate=="function"&&r.componentWillUpdate(n,m,l),typeof r.UNSAFE_componentWillUpdate=="function"&&r.UNSAFE_componentWillUpdate(n,m,l)),typeof r.componentDidUpdate=="function"&&(e.flags|=4),typeof r.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof r.componentDidUpdate!="function"||a===i.memoizedProps&&f===i.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&f===i.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=m),r.props=n,r.state=m,r.context=l,n=u):(typeof r.componentDidUpdate!="function"||a===i.memoizedProps&&f===i.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&f===i.memoizedState||(e.flags|=1024),n=!1)}return r=n,PA(i,e),n=(e.flags&128)!==0,r||n?(r=e.stateNode,t=n&&typeof t.getDerivedStateFromError!="function"?null:r.render(),e.flags|=1,i!==null&&n?(e.child=Gy(e,i.child,null,s),e.child=Gy(e,null,t,s)):Vr(i,e,t,s),e.memoizedState=r.state,i=e.child):i=Mh(i,e,s),i}function Vz(i,e,t,n){return $b(),e.flags|=256,Vr(i,e,t,n),e.child}var oN={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function lN(i){return{baseLanes:i,cachePool:m6()}}function cN(i,e,t){return i=i!==null?i.childLanes&~t:0,e&&(i|=Bl),i}function c8(i,e,t){var n=e.pendingProps,s=!1,r=(e.flags&128)!==0,a;if((a=r)||(a=i!==null&&i.memoizedState===null?!1:(or.current&2)!==0),a&&(s=!0,e.flags&=-129),a=(e.flags&32)!==0,e.flags&=-33,i===null){if(mi){if(s?Cd(e):wd(),mi){var o=vs,l;if(l=o){e:{for(l=o,o=kc;l.nodeType!==8;){if(!o){o=null;break e}if(l=yc(l.nextSibling),l===null){o=null;break e}}o=l}o!==null?(e.memoizedState={dehydrated:o,treeContext:_m!==null?{id:oh,overflow:lh}:null,retryLane:536870912,hydrationErrors:null},l=Go(18,null,null,0),l.stateNode=o,l.return=e,e.child=l,Oa=e,vs=null,l=!0):l=!1}l||Dm(e)}if(o=e.memoizedState,o!==null&&(o=o.dehydrated,o!==null))return AD(o)?e.lanes=32:e.lanes=536870912,null;uh(e)}return o=n.children,n=n.fallback,s?(wd(),s=e.mode,o=yM({mode:"hidden",children:o},s),n=xm(n,s,t,null),o.return=e,n.return=e,o.sibling=n,e.child=o,s=e.child,s.memoizedState=lN(t),s.childLanes=cN(i,a,t),e.memoizedState=oN,n):(Cd(e),hD(e,o))}if(l=i.memoizedState,l!==null&&(o=l.dehydrated,o!==null)){if(r)e.flags&256?(Cd(e),e.flags&=-257,e=uN(i,e,t)):e.memoizedState!==null?(wd(),e.child=i.child,e.flags|=128,e=null):(wd(),s=n.fallback,o=e.mode,n=yM({mode:"visible",children:n.children},o),s=xm(s,o,t,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,Gy(e,i.child,null,t),n=e.child,n.memoizedState=lN(t),n.childLanes=cN(i,a,t),e.memoizedState=oN,e=s);else if(Cd(e),AD(o)){if(a=o.nextSibling&&o.nextSibling.dataset,a)var c=a.dgst;a=c,n=Error(nt(419)),n.stack="",n.digest=a,ab({value:n,source:null,stack:null}),e=uN(i,e,t)}else if(Er||eS(i,e,t,!1),a=(t&i.childLanes)!==0,Er||a){if(a=Xi,a!==null&&(n=t&-t,n=n&42?1:Q3(n),n=n&(a.suspendedLanes|t)?0:n,n!==0&&n!==l.retryLane))throw l.retryLane=n,fx(i,n),Yo(a,i,n),a8;o.data==="$?"||yD(),e=uN(i,e,t)}else o.data==="$?"?(e.flags|=192,e.child=i.child,e=null):(i=l.treeContext,vs=yc(o.nextSibling),Oa=e,mi=!0,vm=null,kc=!1,i!==null&&(Al[Ml++]=oh,Al[Ml++]=lh,Al[Ml++]=_m,oh=i.id,lh=i.overflow,_m=e),e=hD(e,n.children),e.flags|=4096);return e}return s?(wd(),s=n.fallback,o=e.mode,l=i.child,c=l.sibling,n=mh(l,{mode:"hidden",children:n.children}),n.subtreeFlags=l.subtreeFlags&65011712,c!==null?s=mh(c,s):(s=xm(s,o,t,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,o=i.child.memoizedState,o===null?o=lN(t):(l=o.cachePool,l!==null?(c=ar._currentValue,l=l.parent!==c?{parent:c,pool:c}:l):l=m6(),o={baseLanes:o.baseLanes|t,cachePool:l}),s.memoizedState=o,s.childLanes=cN(i,a,t),e.memoizedState=oN,n):(Cd(e),t=i.child,i=t.sibling,t=mh(t,{mode:"visible",children:n.children}),t.return=e,t.sibling=null,i!==null&&(a=e.deletions,a===null?(e.deletions=[i],e.flags|=16):a.push(i)),e.child=t,e.memoizedState=null,t)}function hD(i,e){return e=yM({mode:"visible",children:e},i.mode),e.return=i,i.child=e}function yM(i,e){return i=Go(22,i,null,e),i.lanes=0,i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},i}function uN(i,e,t){return Gy(e,i.child,null,t),i=hD(e,e.pendingProps.children),i.flags|=2,e.memoizedState=null,i}function Hz(i,e,t){i.lanes|=e;var n=i.alternate;n!==null&&(n.lanes|=e),QB(i.return,e,t)}function hN(i,e,t,n,s){var r=i.memoizedState;r===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:s}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=n,r.tail=t,r.tailMode=s)}function u8(i,e,t){var n=e.pendingProps,s=n.revealOrder,r=n.tail;if(Vr(i,e,n.children,t),n=or.current,n&2)n=n&1|2,e.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Hz(i,t,e);else if(i.tag===19)Hz(i,t,e);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}n&=1}switch(as(or,n),s){case"forwards":for(t=e.child,s=null;t!==null;)i=t.alternate,i!==null&&pM(i)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),hN(e,!1,s,t,r);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(i=s.alternate,i!==null&&pM(i)===null){e.child=s;break}i=s.sibling,s.sibling=t,t=s,s=i}hN(e,!0,t,null,r);break;case"together":hN(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Mh(i,e,t){if(i!==null&&(e.dependencies=i.dependencies),uf|=e.lanes,!(t&e.childLanes))if(i!==null){if(eS(i,e,t,!1),(t&e.childLanes)===0)return null}else return null;if(i!==null&&e.child!==i.child)throw Error(nt(153));if(e.child!==null){for(i=e.child,t=mh(i,i.pendingProps),e.child=t,t.return=e;i.sibling!==null;)i=i.sibling,t=t.sibling=mh(i,i.pendingProps),t.return=e;t.sibling=null}return e.child}function wL(i,e){return i.lanes&e?!0:(i=i.dependencies,!!(i!==null&&cM(i)))}function zte(i,e,t){switch(e.tag){case 3:tM(e,e.stateNode.containerInfo),Ed(e,ar,i.memoizedState.cache),$b();break;case 27:case 5:zB(e);break;case 4:tM(e,e.stateNode.containerInfo);break;case 10:Ed(e,e.type,e.memoizedProps.value);break;case 13:var n=e.memoizedState;if(n!==null)return n.dehydrated!==null?(Cd(e),e.flags|=128,null):t&e.child.childLanes?c8(i,e,t):(Cd(e),i=Mh(i,e,t),i!==null?i.sibling:null);Cd(e);break;case 19:var s=(i.flags&128)!==0;if(n=(t&e.childLanes)!==0,n||(eS(i,e,t,!1),n=(t&e.childLanes)!==0),s){if(n)return u8(i,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),as(or,or.current),n)break;return null;case 22:case 23:return e.lanes=0,l8(i,e,t);case 24:Ed(e,ar,i.memoizedState.cache)}return Mh(i,e,t)}function h8(i,e,t){if(i!==null)if(i.memoizedProps!==e.pendingProps)Er=!0;else{if(!wL(i,t)&&!(e.flags&128))return Er=!1,zte(i,e,t);Er=!!(i.flags&131072)}else Er=!1,mi&&e.flags&1048576&&f6(e,lM,e.index);switch(e.lanes=0,e.tag){case 16:e:{i=e.pendingProps;var n=e.elementType,s=n._init;if(n=s(n._payload),e.type=n,typeof n=="function")cL(n)?(i=Im(n,i),e.tag=1,e=zz(null,e,n,i,t)):(e.tag=0,e=uD(null,e,n,i,t));else{if(n!=null){if(s=n.$$typeof,s===K3){e.tag=11,e=Pz(null,e,n,i,t);break e}else if(s===Z3){e.tag=14,e=Oz(null,e,n,i,t);break e}}throw e=FB(n)||n,Error(nt(306,e,""))}}return e;case 0:return uD(i,e,e.type,e.pendingProps,t);case 1:return n=e.type,s=Im(n,e.pendingProps),zz(i,e,n,s,t);case 3:e:{if(tM(e,e.stateNode.containerInfo),i===null)throw Error(nt(387));n=e.pendingProps;var r=e.memoizedState;s=r.element,nD(i,e),Cv(e,n,null,t);var a=e.memoizedState;if(n=a.cache,Ed(e,ar,n),n!==r.cache&&$B(e,[ar],t,!0),Ev(),n=a.element,r.isDehydrated)if(r={element:n,isDehydrated:!1,cache:a.cache},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){e=Vz(i,e,n,t);break e}else if(n!==s){s=wl(Error(nt(424)),e),ab(s),e=Vz(i,e,n,t);break e}else{switch(i=e.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(vs=yc(i.firstChild),Oa=e,mi=!0,vm=null,kc=!0,t=$6(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling}else{if($b(),n===s){e=Mh(i,e,t);break e}Vr(i,e,n,t)}e=e.child}return e;case 26:return PA(i,e),i===null?(t=r4(e.type,null,e.pendingProps,null))?e.memoizedState=t:mi||(t=e.type,i=e.pendingProps,n=AM(jd.current).createElement(t),n[pa]=e,n[ho]=i,qr(n,t,i),Ar(n),e.stateNode=n):e.memoizedState=r4(e.type,i.memoizedProps,e.pendingProps,i.memoizedState),null;case 27:return zB(e),i===null&&mi&&(n=e.stateNode=J8(e.type,e.pendingProps,jd.current),Oa=e,kc=!0,s=vs,jf(e.type)?(MD=s,vs=yc(n.firstChild)):vs=s),Vr(i,e,e.pendingProps.children,t),PA(i,e),i===null&&(e.flags|=4194304),e.child;case 5:return i===null&&mi&&((s=n=vs)&&(n=pne(n,e.type,e.pendingProps,kc),n!==null?(e.stateNode=n,Oa=e,vs=yc(n.firstChild),kc=!1,s=!0):s=!1),s||Dm(e)),zB(e),s=e.type,r=e.pendingProps,a=i!==null?i.memoizedProps:null,n=r.children,SD(s,r)?n=null:a!==null&&SD(s,a)&&(e.flags|=32),e.memoizedState!==null&&(s=yL(i,e,Dte,null,null,t),db._currentValue=s),PA(i,e),Vr(i,e,n,t),e.child;case 6:return i===null&&mi&&((i=t=vs)&&(t=mne(t,e.pendingProps,kc),t!==null?(e.stateNode=t,Oa=e,vs=null,i=!0):i=!1),i||Dm(e)),null;case 13:return c8(i,e,t);case 4:return tM(e,e.stateNode.containerInfo),n=e.pendingProps,i===null?e.child=Gy(e,null,n,t):Vr(i,e,n,t),e.child;case 11:return Pz(i,e,e.type,e.pendingProps,t);case 7:return Vr(i,e,e.pendingProps,t),e.child;case 8:return Vr(i,e,e.pendingProps.children,t),e.child;case 12:return Vr(i,e,e.pendingProps.children,t),e.child;case 10:return n=e.pendingProps,Ed(e,e.type,n.value),Vr(i,e,n.children,t),e.child;case 9:return s=e.type._context,n=e.pendingProps.children,Lm(e),s=ma(s),n=n(s),e.flags|=1,Vr(i,e,n,t),e.child;case 14:return Oz(i,e,e.type,e.pendingProps,t);case 15:return o8(i,e,e.type,e.pendingProps,t);case 19:return u8(i,e,t);case 31:return n=e.pendingProps,t=e.mode,n={mode:n.mode,children:n.children},i===null?(t=yM(n,t),t.ref=e.ref,e.child=t,t.return=e,e=t):(t=mh(i.child,n),t.ref=e.ref,e.child=t,t.return=e,e=t),e;case 22:return l8(i,e,t);case 24:return Lm(e),n=ma(ar),i===null?(s=fL(),s===null&&(s=Xi,r=dL(),s.pooledCache=r,r.refCount++,r!==null&&(s.pooledCacheLanes|=t),s=r),e.memoizedState={parent:n,cache:s},pL(e),Ed(e,ar,s)):(i.lanes&t&&(nD(i,e),Cv(e,null,null,t),Ev()),s=i.memoizedState,r=e.memoizedState,s.parent!==n?(s={parent:n,cache:n},e.memoizedState=s,e.lanes===0&&(e.memoizedState=e.updateQueue.baseState=s),Ed(e,ar,n)):(n=r.cache,Ed(e,ar,n),n!==s.cache&&$B(e,[ar],t,!0))),Vr(i,e,e.pendingProps.children,t),e.child;case 29:throw e.pendingProps}throw Error(nt(156,e.tag))}function Ou(i){i.flags|=4}function kz(i,e){if(e.type!=="stylesheet"||e.state.loading&4)i.flags&=-16777217;else if(i.flags|=16777216,!e9(e)){if(e=Wl.current,e!==null&&((Qn&4194048)===Qn?Jc!==null:(Qn&62914560)!==Qn&&!(Qn&536870912)||e!==Jc))throw Av=tD,g6;i.flags|=8192}}function n1(i,e){e!==null&&(i.flags|=4),i.flags&16384&&(e=i.tag!==22?Ok():536870912,i.lanes|=e,zy|=e)}function b_(i,e){if(!mi)switch(i.tailMode){case"hidden":e=i.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?i.tail=null:t.sibling=null;break;case"collapsed":t=i.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:n.sibling=null}}function us(i){var e=i.alternate!==null&&i.alternate.child===i.child,t=0,n=0;if(e)for(var s=i.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags&65011712,n|=s.flags&65011712,s.return=i,s=s.sibling;else for(s=i.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=i,s=s.sibling;return i.subtreeFlags|=n,i.childLanes=t,e}function Vte(i,e,t){var n=e.pendingProps;switch(hL(e),e.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return us(e),null;case 1:return us(e),null;case 3:return t=e.stateNode,n=null,i!==null&&(n=i.memoizedState.cache),e.memoizedState.cache!==n&&(e.flags|=2048),gh(ar),Ly(),t.pendingContext&&(t.context=t.pendingContext,t.pendingContext=null),(i===null||i.child===null)&&(__(e)?Ou(e):i===null||i.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,_z())),us(e),null;case 26:return t=e.memoizedState,i===null?(Ou(e),t!==null?(us(e),kz(e,t)):(us(e),e.flags&=-16777217)):t?t!==i.memoizedState?(Ou(e),us(e),kz(e,t)):(us(e),e.flags&=-16777217):(i.memoizedProps!==n&&Ou(e),us(e),e.flags&=-16777217),null;case 27:nM(e),t=jd.current;var s=e.type;if(i!==null&&e.stateNode!=null)i.memoizedProps!==n&&Ou(e);else{if(!n){if(e.stateNode===null)throw Error(nt(166));return us(e),null}i=Kc.current,__(e)?yz(e):(i=J8(s,n,t),e.stateNode=i,Ou(e))}return us(e),null;case 5:if(nM(e),t=e.type,i!==null&&e.stateNode!=null)i.memoizedProps!==n&&Ou(e);else{if(!n){if(e.stateNode===null)throw Error(nt(166));return us(e),null}if(i=Kc.current,__(e))yz(e);else{switch(s=AM(jd.current),i){case 1:i=s.createElementNS("http://www.w3.org/2000/svg",t);break;case 2:i=s.createElementNS("http://www.w3.org/1998/Math/MathML",t);break;default:switch(t){case"svg":i=s.createElementNS("http://www.w3.org/2000/svg",t);break;case"math":i=s.createElementNS("http://www.w3.org/1998/Math/MathML",t);break;case"script":i=s.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof n.is=="string"?s.createElement("select",{is:n.is}):s.createElement("select"),n.multiple?i.multiple=!0:n.size&&(i.size=n.size);break;default:i=typeof n.is=="string"?s.createElement(t,{is:n.is}):s.createElement(t)}}i[pa]=e,i[ho]=n;e:for(s=e.child;s!==null;){if(s.tag===5||s.tag===6)i.appendChild(s.stateNode);else if(s.tag!==4&&s.tag!==27&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}e.stateNode=i;e:switch(qr(i,t,n),t){case"button":case"input":case"select":case"textarea":i=!!n.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&Ou(e)}}return us(e),e.flags&=-16777217,null;case 6:if(i&&e.stateNode!=null)i.memoizedProps!==n&&Ou(e);else{if(typeof n!="string"&&e.stateNode===null)throw Error(nt(166));if(i=jd.current,__(e)){if(i=e.stateNode,t=e.memoizedProps,n=null,s=Oa,s!==null)switch(s.tag){case 27:case 5:n=s.memoizedProps}i[pa]=e,i=!!(i.nodeValue===t||n!==null&&n.suppressHydrationWarning===!0||Y8(i.nodeValue,t)),i||Dm(e)}else i=AM(i).createTextNode(n),i[pa]=e,e.stateNode=i}return us(e),null;case 13:if(n=e.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(s=__(e),n!==null&&n.dehydrated!==null){if(i===null){if(!s)throw Error(nt(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(nt(317));s[pa]=e}else $b(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;us(e),s=!1}else s=_z(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=s),s=!0;if(!s)return e.flags&256?(uh(e),e):(uh(e),null)}if(uh(e),e.flags&128)return e.lanes=t,e;if(t=n!==null,i=i!==null&&i.memoizedState!==null,t){n=e.child,s=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(s=n.alternate.memoizedState.cachePool.pool);var r=null;n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(r=n.memoizedState.cachePool.pool),r!==s&&(n.flags|=2048)}return t!==i&&t&&(e.child.flags|=8192),n1(e,e.updateQueue),us(e),null;case 4:return Ly(),i===null&&PL(e.stateNode.containerInfo),us(e),null;case 10:return gh(e.type),us(e),null;case 19:if(Rr(or),s=e.memoizedState,s===null)return us(e),null;if(n=(e.flags&128)!==0,r=s.rendering,r===null)if(n)b_(s,!1);else{if(Ss!==0||i!==null&&i.flags&128)for(i=e.child;i!==null;){if(r=pM(i),r!==null){for(e.flags|=128,b_(s,!1),i=r.updateQueue,e.updateQueue=i,n1(e,i),e.subtreeFlags=0,i=t,t=e.child;t!==null;)d6(t,i),t=t.sibling;return as(or,or.current&1|2),e.child}i=i.sibling}s.tail!==null&&Zc()>_M&&(e.flags|=128,n=!0,b_(s,!1),e.lanes=4194304)}else{if(!n)if(i=pM(r),i!==null){if(e.flags|=128,n=!0,i=i.updateQueue,e.updateQueue=i,n1(e,i),b_(s,!0),s.tail===null&&s.tailMode==="hidden"&&!r.alternate&&!mi)return us(e),null}else 2*Zc()-s.renderingStartTime>_M&&t!==536870912&&(e.flags|=128,n=!0,b_(s,!1),e.lanes=4194304);s.isBackwards?(r.sibling=e.child,e.child=r):(i=s.last,i!==null?i.sibling=r:e.child=r,s.last=r)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Zc(),e.sibling=null,i=or.current,as(or,n?i&1|2:i&1),e):(us(e),null);case 22:case 23:return uh(e),mL(),n=e.memoizedState!==null,i!==null?i.memoizedState!==null!==n&&(e.flags|=8192):n&&(e.flags|=8192),n?t&536870912&&!(e.flags&128)&&(us(e),e.subtreeFlags&6&&(e.flags|=8192)):us(e),t=e.updateQueue,t!==null&&n1(e,t.retryQueue),t=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(t=i.memoizedState.cachePool.pool),n=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(n=e.memoizedState.cachePool.pool),n!==t&&(e.flags|=2048),i!==null&&Rr(bm),null;case 24:return t=null,i!==null&&(t=i.memoizedState.cache),e.memoizedState.cache!==t&&(e.flags|=2048),gh(ar),us(e),null;case 25:return null;case 30:return null}throw Error(nt(156,e.tag))}function Hte(i,e){switch(hL(e),e.tag){case 1:return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 3:return gh(ar),Ly(),i=e.flags,i&65536&&!(i&128)?(e.flags=i&-65537|128,e):null;case 26:case 27:case 5:return nM(e),null;case 13:if(uh(e),i=e.memoizedState,i!==null&&i.dehydrated!==null){if(e.alternate===null)throw Error(nt(340));$b()}return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 19:return Rr(or),null;case 4:return Ly(),null;case 10:return gh(e.type),null;case 22:case 23:return uh(e),mL(),i!==null&&Rr(bm),i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 24:return gh(ar),null;case 25:return null;default:return null}}function d8(i,e){switch(hL(e),e.tag){case 3:gh(ar),Ly();break;case 26:case 27:case 5:nM(e);break;case 4:Ly();break;case 13:uh(e);break;case 19:Rr(or);break;case 10:gh(e.type);break;case 22:case 23:uh(e),mL(),i!==null&&Rr(bm);break;case 24:gh(ar)}}function rS(i,e){try{var t=e.updateQueue,n=t!==null?t.lastEffect:null;if(n!==null){var s=n.next;t=s;do{if((t.tag&i)===i){n=void 0;var r=t.create,a=t.inst;n=r(),a.destroy=n}t=t.next}while(t!==s)}}catch(o){zi(e,e.return,o)}}function cf(i,e,t){try{var n=e.updateQueue,s=n!==null?n.lastEffect:null;if(s!==null){var r=s.next;n=r;do{if((n.tag&i)===i){var a=n.inst,o=a.destroy;if(o!==void 0){a.destroy=void 0,s=e;var l=t,c=o;try{c()}catch(u){zi(s,l,u)}}}n=n.next}while(n!==r)}}catch(u){zi(e,e.return,u)}}function f8(i){var e=i.updateQueue;if(e!==null){var t=i.stateNode;try{_6(e,t)}catch(n){zi(i,i.return,n)}}}function p8(i,e,t){t.props=Im(i.type,i.memoizedProps),t.state=i.memoizedState;try{t.componentWillUnmount()}catch(n){zi(i,e,n)}}function Rv(i,e){try{var t=i.ref;if(t!==null){switch(i.tag){case 26:case 27:case 5:var n=i.stateNode;break;case 30:n=i.stateNode;break;default:n=i.stateNode}typeof t=="function"?i.refCleanup=t(n):t.current=n}}catch(s){zi(i,e,s)}}function jc(i,e){var t=i.ref,n=i.refCleanup;if(t!==null)if(typeof n=="function")try{n()}catch(s){zi(i,e,s)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof t=="function")try{t(null)}catch(s){zi(i,e,s)}else t.current=null}function m8(i){var e=i.type,t=i.memoizedProps,n=i.stateNode;try{e:switch(e){case"button":case"input":case"select":case"textarea":t.autoFocus&&n.focus();break e;case"img":t.src?n.src=t.src:t.srcSet&&(n.srcset=t.srcSet)}}catch(s){zi(i,i.return,s)}}function dN(i,e,t){try{var n=i.stateNode;cne(n,i.type,t,e),n[ho]=e}catch(s){zi(i,i.return,s)}}function g8(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&jf(i.type)||i.tag===4}function fN(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||g8(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&jf(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function dD(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t).insertBefore(i,e):(e=t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,e.appendChild(i),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=UE));else if(n!==4&&(n===27&&jf(i.type)&&(t=i.stateNode,e=null),i=i.child,i!==null))for(dD(i,e,t),i=i.sibling;i!==null;)dD(i,e,t),i=i.sibling}function xM(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.insertBefore(i,e):t.appendChild(i);else if(n!==4&&(n===27&&jf(i.type)&&(t=i.stateNode),i=i.child,i!==null))for(xM(i,e,t),i=i.sibling;i!==null;)xM(i,e,t),i=i.sibling}function y8(i){var e=i.stateNode,t=i.memoizedProps;try{for(var n=i.type,s=e.attributes;s.length;)e.removeAttributeNode(s[0]);qr(e,n,t),e[pa]=i,e[ho]=t}catch(r){zi(i,i.return,r)}}var $u=!1,Ls=!1,pN=!1,Wz=typeof WeakSet=="function"?WeakSet:Set,Sr=null;function kte(i,e){if(i=i.containerInfo,vD=wM,i=s6(i),aL(i)){if("selectionStart"in i)var t={start:i.selectionStart,end:i.selectionEnd};else e:{t=(t=i.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var s=n.anchorOffset,r=n.focusNode;n=n.focusOffset;try{t.nodeType,r.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,c=0,u=0,h=i,f=null;t:for(;;){for(var m;h!==t||s!==0&&h.nodeType!==3||(o=a+s),h!==r||n!==0&&h.nodeType!==3||(l=a+n),h.nodeType===3&&(a+=h.nodeValue.length),(m=h.firstChild)!==null;)f=h,h=m;for(;;){if(h===i)break t;if(f===t&&++c===s&&(o=a),f===r&&++u===n&&(l=a),(m=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=m}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(bD={focusedElem:i,selectionRange:t},wM=!1,Sr=e;Sr!==null;)if(e=Sr,i=e.child,(e.subtreeFlags&1024)!==0&&i!==null)i.return=e,Sr=i;else for(;Sr!==null;){switch(e=Sr,r=e.alternate,i=e.flags,e.tag){case 0:break;case 11:case 15:break;case 1:if(i&1024&&r!==null){i=void 0,t=e,s=r.memoizedProps,r=r.memoizedState,n=t.stateNode;try{var g=Im(t.type,s,t.elementType===t.type);i=n.getSnapshotBeforeUpdate(g,r),n.__reactInternalSnapshotBeforeUpdate=i}catch(x){zi(t,t.return,x)}}break;case 3:if(i&1024){if(i=e.stateNode.containerInfo,t=i.nodeType,t===9)TD(i);else if(t===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":TD(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(i&1024)throw Error(nt(163))}if(i=e.sibling,i!==null){i.return=e.return,Sr=i;break}Sr=e.return}}function x8(i,e,t){var n=t.flags;switch(t.tag){case 0:case 11:case 15:od(i,t),n&4&&rS(5,t);break;case 1:if(od(i,t),n&4)if(i=t.stateNode,e===null)try{i.componentDidMount()}catch(a){zi(t,t.return,a)}else{var s=Im(t.type,e.memoizedProps);e=e.memoizedState;try{i.componentDidUpdate(s,e,i.__reactInternalSnapshotBeforeUpdate)}catch(a){zi(t,t.return,a)}}n&64&&f8(t),n&512&&Rv(t,t.return);break;case 3:if(od(i,t),n&64&&(i=t.updateQueue,i!==null)){if(e=null,t.child!==null)switch(t.child.tag){case 27:case 5:e=t.child.stateNode;break;case 1:e=t.child.stateNode}try{_6(i,e)}catch(a){zi(t,t.return,a)}}break;case 27:e===null&&n&4&&y8(t);case 26:case 5:od(i,t),e===null&&n&4&&m8(t),n&512&&Rv(t,t.return);break;case 12:od(i,t);break;case 13:od(i,t),n&4&&b8(i,t),n&64&&(i=t.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(t=Qte.bind(null,t),gne(i,t))));break;case 22:if(n=t.memoizedState!==null||$u,!n){e=e!==null&&e.memoizedState!==null||Ls,s=$u;var r=Ls;$u=n,(Ls=e)&&!r?vd(i,t,(t.subtreeFlags&8772)!==0):od(i,t),$u=s,Ls=r}break;case 30:break;default:od(i,t)}}function _8(i){var e=i.alternate;e!==null&&(i.alternate=null,_8(e)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(e=i.stateNode,e!==null&&eL(e)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var $i=null,io=!1;function Fu(i,e,t){for(t=t.child;t!==null;)v8(i,e,t),t=t.sibling}function v8(i,e,t){if(Xo&&typeof Xo.onCommitFiberUnmount=="function")try{Xo.onCommitFiberUnmount(Yb,t)}catch{}switch(t.tag){case 26:Ls||jc(t,e),Fu(i,e,t),t.memoizedState?t.memoizedState.count--:t.stateNode&&(t=t.stateNode,t.parentNode.removeChild(t));break;case 27:Ls||jc(t,e);var n=$i,s=io;jf(t.type)&&($i=t.stateNode,io=!1),Fu(i,e,t),Lv(t.stateNode),$i=n,io=s;break;case 5:Ls||jc(t,e);case 6:if(n=$i,s=io,$i=null,Fu(i,e,t),$i=n,io=s,$i!==null)if(io)try{($i.nodeType===9?$i.body:$i.nodeName==="HTML"?$i.ownerDocument.body:$i).removeChild(t.stateNode)}catch(r){zi(t,e,r)}else try{$i.removeChild(t.stateNode)}catch(r){zi(t,e,r)}break;case 18:$i!==null&&(io?(i=$i,n4(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,t.stateNode),mb(i)):n4($i,t.stateNode));break;case 4:n=$i,s=io,$i=t.stateNode.containerInfo,io=!0,Fu(i,e,t),$i=n,io=s;break;case 0:case 11:case 14:case 15:Ls||cf(2,t,e),Ls||cf(4,t,e),Fu(i,e,t);break;case 1:Ls||(jc(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"&&p8(t,e,n)),Fu(i,e,t);break;case 21:Fu(i,e,t);break;case 22:Ls=(n=Ls)||t.memoizedState!==null,Fu(i,e,t),Ls=n;break;default:Fu(i,e,t)}}function b8(i,e){if(e.memoizedState===null&&(i=e.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{mb(i)}catch(t){zi(e,e.return,t)}}function Wte(i){switch(i.tag){case 13:case 19:var e=i.stateNode;return e===null&&(e=i.stateNode=new Wz),e;case 22:return i=i.stateNode,e=i._retryCache,e===null&&(e=i._retryCache=new Wz),e;default:throw Error(nt(435,i.tag))}}function mN(i,e){var t=Wte(i);e.forEach(function(n){var s=$te.bind(null,i,n);t.has(n)||(t.add(n),n.then(s,s))})}function wo(i,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var s=t[n],r=i,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 27:if(jf(o.type)){$i=o.stateNode,io=!1;break e}break;case 5:$i=o.stateNode,io=!1;break e;case 3:case 4:$i=o.stateNode.containerInfo,io=!0;break e}o=o.return}if($i===null)throw Error(nt(160));v8(r,a,s),$i=null,io=!1,r=s.alternate,r!==null&&(r.return=null),s.return=null}if(e.subtreeFlags&13878)for(e=e.child;e!==null;)S8(e,i),e=e.sibling}var uc=null;function S8(i,e){var t=i.alternate,n=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:wo(e,i),Ro(i),n&4&&(cf(3,i,i.return),rS(3,i),cf(5,i,i.return));break;case 1:wo(e,i),Ro(i),n&512&&(Ls||t===null||jc(t,t.return)),n&64&&$u&&(i=i.updateQueue,i!==null&&(n=i.callbacks,n!==null&&(t=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=t===null?n:t.concat(n))));break;case 26:var s=uc;if(wo(e,i),Ro(i),n&512&&(Ls||t===null||jc(t,t.return)),n&4){var r=t!==null?t.memoizedState:null;if(n=i.memoizedState,t===null)if(n===null)if(i.stateNode===null){e:{n=i.type,t=i.memoizedProps,s=s.ownerDocument||s;t:switch(n){case"title":r=s.getElementsByTagName("title")[0],(!r||r[Jb]||r[pa]||r.namespaceURI==="http://www.w3.org/2000/svg"||r.hasAttribute("itemprop"))&&(r=s.createElement(n),s.head.insertBefore(r,s.querySelector("head > title"))),qr(r,n,t),r[pa]=i,Ar(r),n=r;break e;case"link":var a=o4("link","href",s).get(n+(t.href||""));if(a){for(var o=0;o<a.length;o++)if(r=a[o],r.getAttribute("href")===(t.href==null||t.href===""?null:t.href)&&r.getAttribute("rel")===(t.rel==null?null:t.rel)&&r.getAttribute("title")===(t.title==null?null:t.title)&&r.getAttribute("crossorigin")===(t.crossOrigin==null?null:t.crossOrigin)){a.splice(o,1);break t}}r=s.createElement(n),qr(r,n,t),s.head.appendChild(r);break;case"meta":if(a=o4("meta","content",s).get(n+(t.content||""))){for(o=0;o<a.length;o++)if(r=a[o],r.getAttribute("content")===(t.content==null?null:""+t.content)&&r.getAttribute("name")===(t.name==null?null:t.name)&&r.getAttribute("property")===(t.property==null?null:t.property)&&r.getAttribute("http-equiv")===(t.httpEquiv==null?null:t.httpEquiv)&&r.getAttribute("charset")===(t.charSet==null?null:t.charSet)){a.splice(o,1);break t}}r=s.createElement(n),qr(r,n,t),s.head.appendChild(r);break;default:throw Error(nt(468,n))}r[pa]=i,Ar(r),n=r}i.stateNode=n}else l4(s,i.type,i.stateNode);else i.stateNode=a4(s,n,i.memoizedProps);else r!==n?(r===null?t.stateNode!==null&&(t=t.stateNode,t.parentNode.removeChild(t)):r.count--,n===null?l4(s,i.type,i.stateNode):a4(s,n,i.memoizedProps)):n===null&&i.stateNode!==null&&dN(i,i.memoizedProps,t.memoizedProps)}break;case 27:wo(e,i),Ro(i),n&512&&(Ls||t===null||jc(t,t.return)),t!==null&&n&4&&dN(i,i.memoizedProps,t.memoizedProps);break;case 5:if(wo(e,i),Ro(i),n&512&&(Ls||t===null||jc(t,t.return)),i.flags&32){s=i.stateNode;try{Iy(s,"")}catch(m){zi(i,i.return,m)}}n&4&&i.stateNode!=null&&(s=i.memoizedProps,dN(i,s,t!==null?t.memoizedProps:s)),n&1024&&(pN=!0);break;case 6:if(wo(e,i),Ro(i),n&4){if(i.stateNode===null)throw Error(nt(162));n=i.memoizedProps,t=i.stateNode;try{t.nodeValue=n}catch(m){zi(i,i.return,m)}}break;case 3:if(GA=null,s=uc,uc=MM(e.containerInfo),wo(e,i),uc=s,Ro(i),n&4&&t!==null&&t.memoizedState.isDehydrated)try{mb(e.containerInfo)}catch(m){zi(i,i.return,m)}pN&&(pN=!1,T8(i));break;case 4:n=uc,uc=MM(i.stateNode.containerInfo),wo(e,i),Ro(i),uc=n;break;case 12:wo(e,i),Ro(i);break;case 13:wo(e,i),Ro(i),i.child.flags&8192&&i.memoizedState!==null!=(t!==null&&t.memoizedState!==null)&&(LL=Zc()),n&4&&(n=i.updateQueue,n!==null&&(i.updateQueue=null,mN(i,n)));break;case 22:s=i.memoizedState!==null;var l=t!==null&&t.memoizedState!==null,c=$u,u=Ls;if($u=c||s,Ls=u||l,wo(e,i),Ls=u,$u=c,Ro(i),n&8192)e:for(e=i.stateNode,e._visibility=s?e._visibility&-2:e._visibility|1,s&&(t===null||l||$u||Ls||em(i)),t=null,e=i;;){if(e.tag===5||e.tag===26){if(t===null){l=t=e;try{if(r=l.stateNode,s)a=r.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none";else{o=l.stateNode;var h=l.memoizedProps.style,f=h!=null&&h.hasOwnProperty("display")?h.display:null;o.style.display=f==null||typeof f=="boolean"?"":(""+f).trim()}}catch(m){zi(l,l.return,m)}}}else if(e.tag===6){if(t===null){l=e;try{l.stateNode.nodeValue=s?"":l.memoizedProps}catch(m){zi(l,l.return,m)}}}else if((e.tag!==22&&e.tag!==23||e.memoizedState===null||e===i)&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break e;for(;e.sibling===null;){if(e.return===null||e.return===i)break e;t===e&&(t=null),e=e.return}t===e&&(t=null),e.sibling.return=e.return,e=e.sibling}n&4&&(n=i.updateQueue,n!==null&&(t=n.retryQueue,t!==null&&(n.retryQueue=null,mN(i,t))));break;case 19:wo(e,i),Ro(i),n&4&&(n=i.updateQueue,n!==null&&(i.updateQueue=null,mN(i,n)));break;case 30:break;case 21:break;default:wo(e,i),Ro(i)}}function Ro(i){var e=i.flags;if(e&2){try{for(var t,n=i.return;n!==null;){if(g8(n)){t=n;break}n=n.return}if(t==null)throw Error(nt(160));switch(t.tag){case 27:var s=t.stateNode,r=fN(i);xM(i,r,s);break;case 5:var a=t.stateNode;t.flags&32&&(Iy(a,""),t.flags&=-33);var o=fN(i);xM(i,o,a);break;case 3:case 4:var l=t.stateNode.containerInfo,c=fN(i);dD(i,c,l);break;default:throw Error(nt(161))}}catch(u){zi(i,i.return,u)}i.flags&=-3}e&4096&&(i.flags&=-4097)}function T8(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var e=i;T8(e),e.tag===5&&e.flags&1024&&e.stateNode.reset(),i=i.sibling}}function od(i,e){if(e.subtreeFlags&8772)for(e=e.child;e!==null;)x8(i,e.alternate,e),e=e.sibling}function em(i){for(i=i.child;i!==null;){var e=i;switch(e.tag){case 0:case 11:case 14:case 15:cf(4,e,e.return),em(e);break;case 1:jc(e,e.return);var t=e.stateNode;typeof t.componentWillUnmount=="function"&&p8(e,e.return,t),em(e);break;case 27:Lv(e.stateNode);case 26:case 5:jc(e,e.return),em(e);break;case 22:e.memoizedState===null&&em(e);break;case 30:em(e);break;default:em(e)}i=i.sibling}}function vd(i,e,t){for(t=t&&(e.subtreeFlags&8772)!==0,e=e.child;e!==null;){var n=e.alternate,s=i,r=e,a=r.flags;switch(r.tag){case 0:case 11:case 15:vd(s,r,t),rS(4,r);break;case 1:if(vd(s,r,t),n=r,s=n.stateNode,typeof s.componentDidMount=="function")try{s.componentDidMount()}catch(c){zi(n,n.return,c)}if(n=r,s=n.updateQueue,s!==null){var o=n.stateNode;try{var l=s.shared.hiddenCallbacks;if(l!==null)for(s.shared.hiddenCallbacks=null,s=0;s<l.length;s++)x6(l[s],o)}catch(c){zi(n,n.return,c)}}t&&a&64&&f8(r),Rv(r,r.return);break;case 27:y8(r);case 26:case 5:vd(s,r,t),t&&n===null&&a&4&&m8(r),Rv(r,r.return);break;case 12:vd(s,r,t);break;case 13:vd(s,r,t),t&&a&4&&b8(s,r);break;case 22:r.memoizedState===null&&vd(s,r,t),Rv(r,r.return);break;case 30:break;default:vd(s,r,t)}e=e.sibling}}function RL(i,e){var t=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(t=i.memoizedState.cachePool.pool),i=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),i!==t&&(i!=null&&i.refCount++,t!=null&&tS(t))}function NL(i,e){i=null,e.alternate!==null&&(i=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==i&&(e.refCount++,i!=null&&tS(i))}function Dc(i,e,t,n){if(e.subtreeFlags&10256)for(e=e.child;e!==null;)A8(i,e,t,n),e=e.sibling}function A8(i,e,t,n){var s=e.flags;switch(e.tag){case 0:case 11:case 15:Dc(i,e,t,n),s&2048&&rS(9,e);break;case 1:Dc(i,e,t,n);break;case 3:Dc(i,e,t,n),s&2048&&(i=null,e.alternate!==null&&(i=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==i&&(e.refCount++,i!=null&&tS(i)));break;case 12:if(s&2048){Dc(i,e,t,n),i=e.stateNode;try{var r=e.memoizedProps,a=r.id,o=r.onPostCommit;typeof o=="function"&&o(a,e.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(l){zi(e,e.return,l)}}else Dc(i,e,t,n);break;case 13:Dc(i,e,t,n);break;case 23:break;case 22:r=e.stateNode,a=e.alternate,e.memoizedState!==null?r._visibility&2?Dc(i,e,t,n):Nv(i,e):r._visibility&2?Dc(i,e,t,n):(r._visibility|=2,z0(i,e,t,n,(e.subtreeFlags&10256)!==0)),s&2048&&RL(a,e);break;case 24:Dc(i,e,t,n),s&2048&&NL(e.alternate,e);break;default:Dc(i,e,t,n)}}function z0(i,e,t,n,s){for(s=s&&(e.subtreeFlags&10256)!==0,e=e.child;e!==null;){var r=i,a=e,o=t,l=n,c=a.flags;switch(a.tag){case 0:case 11:case 15:z0(r,a,o,l,s),rS(8,a);break;case 23:break;case 22:var u=a.stateNode;a.memoizedState!==null?u._visibility&2?z0(r,a,o,l,s):Nv(r,a):(u._visibility|=2,z0(r,a,o,l,s)),s&&c&2048&&RL(a.alternate,a);break;case 24:z0(r,a,o,l,s),s&&c&2048&&NL(a.alternate,a);break;default:z0(r,a,o,l,s)}e=e.sibling}}function Nv(i,e){if(e.subtreeFlags&10256)for(e=e.child;e!==null;){var t=i,n=e,s=n.flags;switch(n.tag){case 22:Nv(t,n),s&2048&&RL(n.alternate,n);break;case 24:Nv(t,n),s&2048&&NL(n.alternate,n);break;default:Nv(t,n)}e=e.sibling}}var cv=8192;function i0(i){if(i.subtreeFlags&cv)for(i=i.child;i!==null;)M8(i),i=i.sibling}function M8(i){switch(i.tag){case 26:i0(i),i.flags&cv&&i.memoizedState!==null&&Rne(uc,i.memoizedState,i.memoizedProps);break;case 5:i0(i);break;case 3:case 4:var e=uc;uc=MM(i.stateNode.containerInfo),i0(i),uc=e;break;case 22:i.memoizedState===null&&(e=i.alternate,e!==null&&e.memoizedState!==null?(e=cv,cv=16777216,i0(i),cv=e):i0(i));break;default:i0(i)}}function E8(i){var e=i.alternate;if(e!==null&&(i=e.child,i!==null)){e.child=null;do e=i.sibling,i.sibling=null,i=e;while(i!==null)}}function S_(i){var e=i.deletions;if(i.flags&16){if(e!==null)for(var t=0;t<e.length;t++){var n=e[t];Sr=n,w8(n,i)}E8(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)C8(i),i=i.sibling}function C8(i){switch(i.tag){case 0:case 11:case 15:S_(i),i.flags&2048&&cf(9,i,i.return);break;case 3:S_(i);break;case 12:S_(i);break;case 22:var e=i.stateNode;i.memoizedState!==null&&e._visibility&2&&(i.return===null||i.return.tag!==13)?(e._visibility&=-3,OA(i)):S_(i);break;default:S_(i)}}function OA(i){var e=i.deletions;if(i.flags&16){if(e!==null)for(var t=0;t<e.length;t++){var n=e[t];Sr=n,w8(n,i)}E8(i)}for(i=i.child;i!==null;){switch(e=i,e.tag){case 0:case 11:case 15:cf(8,e,e.return),OA(e);break;case 22:t=e.stateNode,t._visibility&2&&(t._visibility&=-3,OA(e));break;default:OA(e)}i=i.sibling}}function w8(i,e){for(;Sr!==null;){var t=Sr;switch(t.tag){case 0:case 11:case 15:cf(8,t,e);break;case 23:case 22:if(t.memoizedState!==null&&t.memoizedState.cachePool!==null){var n=t.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:tS(t.memoizedState.cache)}if(n=t.child,n!==null)n.return=t,Sr=n;else e:for(t=i;Sr!==null;){n=Sr;var s=n.sibling,r=n.return;if(_8(n),n===t){Sr=null;break e}if(s!==null){s.return=r,Sr=s;break e}Sr=r}}}var Xte={getCacheForType:function(i){var e=ma(ar),t=e.data.get(i);return t===void 0&&(t=i(),e.data.set(i,t)),t}},qte=typeof WeakMap=="function"?WeakMap:Map,wi=0,Xi=null,Wn=null,Qn=0,Ei=0,Io=null,Pd=!1,px=!1,BL=!1,Eh=0,Ss=0,uf=0,Sm=0,DL=0,Bl=0,zy=0,Bv=null,so=null,fD=!1,LL=0,_M=1/0,vM=null,Zd=null,Hr=0,Jd=null,Vy=null,my=0,pD=0,mD=null,R8=null,Dv=0,gD=null;function jo(){if(wi&2&&Qn!==0)return Qn&-Qn;if(_n.T!==null){var i=Py;return i!==0?i:IL()}return zk()}function N8(){Bl===0&&(Bl=!(Qn&536870912)||mi?Pk():536870912);var i=Wl.current;return i!==null&&(i.flags|=32),Bl}function Yo(i,e,t){(i===Xi&&(Ei===2||Ei===9)||i.cancelPendingCommit!==null)&&(Hy(i,0),Od(i,Qn,Bl,!1)),Zb(i,t),(!(wi&2)||i!==Xi)&&(i===Xi&&(!(wi&2)&&(Sm|=t),Ss===4&&Od(i,Qn,Bl,!1)),vu(i))}function B8(i,e,t){if(wi&6)throw Error(nt(327));var n=!t&&(e&124)===0&&(e&i.expiredLanes)===0||Kb(i,e),s=n?Kte(i,e):gN(i,e,!0),r=n;do{if(s===0){px&&!n&&Od(i,e,0,!1);break}else{if(t=i.current.alternate,r&&!jte(t)){s=gN(i,e,!1),r=!1;continue}if(s===2){if(r=e,i.errorRecoveryDisabledLanes&r)var a=0;else a=i.pendingLanes&-536870913,a=a!==0?a:a&536870912?536870912:0;if(a!==0){e=a;e:{var o=i;s=Bv;var l=o.current.memoizedState.isDehydrated;if(l&&(Hy(o,a).flags|=256),a=gN(o,a,!1),a!==2){if(BL&&!l){o.errorRecoveryDisabledLanes|=r,Sm|=r,s=4;break e}r=so,so=s,r!==null&&(so===null?so=r:so.push.apply(so,r))}s=a}if(r=!1,s!==2)continue}}if(s===1){Hy(i,0),Od(i,e,0,!0);break}e:{switch(n=i,r=s,r){case 0:case 1:throw Error(nt(345));case 4:if((e&4194048)!==e)break;case 6:Od(n,e,Bl,!Pd);break e;case 2:so=null;break;case 3:case 5:break;default:throw Error(nt(329))}if((e&62914560)===e&&(s=LL+300-Zc(),10<s)){if(Od(n,e,Bl,!Pd),bE(n,0,!0)!==0)break e;n.timeoutHandle=Z8(Xz.bind(null,n,t,so,vM,fD,e,Bl,Sm,zy,Pd,r,2,-0,0),s);break e}Xz(n,t,so,vM,fD,e,Bl,Sm,zy,Pd,r,0,-0,0)}}break}while(!0);vu(i)}function Xz(i,e,t,n,s,r,a,o,l,c,u,h,f,m){if(i.timeoutHandle=-1,h=e.subtreeFlags,(h&8192||(h&16785408)===16785408)&&(hb={stylesheets:null,count:0,unsuspend:wne},M8(e),h=Nne(),h!==null)){i.cancelPendingCommit=h(jz.bind(null,i,e,r,t,n,s,a,o,l,u,1,f,m)),Od(i,r,a,!c);return}jz(i,e,r,t,n,s,a,o,l)}function jte(i){for(var e=i;;){var t=e.tag;if((t===0||t===11||t===15)&&e.flags&16384&&(t=e.updateQueue,t!==null&&(t=t.stores,t!==null)))for(var n=0;n<t.length;n++){var s=t[n],r=s.getSnapshot;s=s.value;try{if(!$o(r(),s))return!1}catch{return!1}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Od(i,e,t,n){e&=~DL,e&=~Sm,i.suspendedLanes|=e,i.pingedLanes&=~e,n&&(i.warmLanes|=e),n=i.expirationTimes;for(var s=e;0<s;){var r=31-qo(s),a=1<<r;n[r]=-1,s&=~a}t!==0&&Fk(i,t,e)}function BE(){return wi&6?!0:(aS(0),!1)}function UL(){if(Wn!==null){if(Ei===0)var i=Wn.return;else i=Wn,ch=dg=null,vL(i),py=null,lb=0,i=Wn;for(;i!==null;)d8(i.alternate,i),i=i.return;Wn=null}}function Hy(i,e){var t=i.timeoutHandle;t!==-1&&(i.timeoutHandle=-1,hne(t)),t=i.cancelPendingCommit,t!==null&&(i.cancelPendingCommit=null,t()),UL(),Xi=i,Wn=t=mh(i.current,null),Qn=e,Ei=0,Io=null,Pd=!1,px=Kb(i,e),BL=!1,zy=Bl=DL=Sm=uf=Ss=0,so=Bv=null,fD=!1,e&8&&(e|=e&32);var n=i.entangledLanes;if(n!==0)for(i=i.entanglements,n&=e;0<n;){var s=31-qo(n),r=1<<s;e|=i[s],n&=~r}return Eh=e,ME(),t}function D8(i,e){Un=null,_n.H=fM,e===nS||e===CE?(e=Tz(),Ei=3):e===g6?(e=Tz(),Ei=4):Ei=e===a8?8:e!==null&&typeof e=="object"&&typeof e.then=="function"?6:1,Io=e,Wn===null&&(Ss=1,gM(i,wl(e,i.current)))}function L8(){var i=_n.H;return _n.H=fM,i===null?fM:i}function U8(){var i=_n.A;return _n.A=Xte,i}function yD(){Ss=4,Pd||(Qn&4194048)!==Qn&&Wl.current!==null||(px=!0),!(uf&134217727)&&!(Sm&134217727)||Xi===null||Od(Xi,Qn,Bl,!1)}function gN(i,e,t){var n=wi;wi|=2;var s=L8(),r=U8();(Xi!==i||Qn!==e)&&(vM=null,Hy(i,e)),e=!1;var a=Ss;e:do try{if(Ei!==0&&Wn!==null){var o=Wn,l=Io;switch(Ei){case 8:UL(),a=6;break e;case 3:case 2:case 9:case 6:Wl.current===null&&(e=!0);var c=Ei;if(Ei=0,Io=null,ty(i,o,l,c),t&&px){a=0;break e}break;default:c=Ei,Ei=0,Io=null,ty(i,o,l,c)}}Yte(),a=Ss;break}catch(u){D8(i,u)}while(!0);return e&&i.shellSuspendCounter++,ch=dg=null,wi=n,_n.H=s,_n.A=r,Wn===null&&(Xi=null,Qn=0,ME()),a}function Yte(){for(;Wn!==null;)I8(Wn)}function Kte(i,e){var t=wi;wi|=2;var n=L8(),s=U8();Xi!==i||Qn!==e?(vM=null,_M=Zc()+500,Hy(i,e)):px=Kb(i,e);e:do try{if(Ei!==0&&Wn!==null){e=Wn;var r=Io;t:switch(Ei){case 1:Ei=0,Io=null,ty(i,e,r,1);break;case 2:case 9:if(Sz(r)){Ei=0,Io=null,qz(e);break}e=function(){Ei!==2&&Ei!==9||Xi!==i||(Ei=7),vu(i)},r.then(e,e);break e;case 3:Ei=7;break e;case 4:Ei=5;break e;case 7:Sz(r)?(Ei=0,Io=null,qz(e)):(Ei=0,Io=null,ty(i,e,r,7));break;case 5:var a=null;switch(Wn.tag){case 26:a=Wn.memoizedState;case 5:case 27:var o=Wn;if(!a||e9(a)){Ei=0,Io=null;var l=o.sibling;if(l!==null)Wn=l;else{var c=o.return;c!==null?(Wn=c,DE(c)):Wn=null}break t}}Ei=0,Io=null,ty(i,e,r,5);break;case 6:Ei=0,Io=null,ty(i,e,r,6);break;case 8:UL(),Ss=6;break e;default:throw Error(nt(462))}}Zte();break}catch(u){D8(i,u)}while(!0);return ch=dg=null,_n.H=n,_n.A=s,wi=t,Wn!==null?0:(Xi=null,Qn=0,ME(),Ss)}function Zte(){for(;Wn!==null&&!xee();)I8(Wn)}function I8(i){var e=h8(i.alternate,i,Eh);i.memoizedProps=i.pendingProps,e===null?DE(i):Wn=e}function qz(i){var e=i,t=e.alternate;switch(e.tag){case 15:case 0:e=Gz(t,e,e.pendingProps,e.type,void 0,Qn);break;case 11:e=Gz(t,e,e.pendingProps,e.type.render,e.ref,Qn);break;case 5:vL(e);default:d8(t,e),e=Wn=d6(e,Eh),e=h8(t,e,Eh)}i.memoizedProps=i.pendingProps,e===null?DE(i):Wn=e}function ty(i,e,t,n){ch=dg=null,vL(e),py=null,lb=0;var s=e.return;try{if(Gte(i,s,e,t,Qn)){Ss=1,gM(i,wl(t,i.current)),Wn=null;return}}catch(r){if(s!==null)throw Wn=s,r;Ss=1,gM(i,wl(t,i.current)),Wn=null;return}e.flags&32768?(mi||n===1?i=!0:px||Qn&536870912?i=!1:(Pd=i=!0,(n===2||n===9||n===3||n===6)&&(n=Wl.current,n!==null&&n.tag===13&&(n.flags|=16384))),P8(e,i)):DE(e)}function DE(i){var e=i;do{if(e.flags&32768){P8(e,Pd);return}i=e.return;var t=Vte(e.alternate,e,Eh);if(t!==null){Wn=t;return}if(e=e.sibling,e!==null){Wn=e;return}Wn=e=i}while(e!==null);Ss===0&&(Ss=5)}function P8(i,e){do{var t=Hte(i.alternate,i);if(t!==null){t.flags&=32767,Wn=t;return}if(t=i.return,t!==null&&(t.flags|=32768,t.subtreeFlags=0,t.deletions=null),!e&&(i=i.sibling,i!==null)){Wn=i;return}Wn=i=t}while(i!==null);Ss=6,Wn=null}function jz(i,e,t,n,s,r,a,o,l){i.cancelPendingCommit=null;do LE();while(Hr!==0);if(wi&6)throw Error(nt(327));if(e!==null){if(e===i.current)throw Error(nt(177));if(r=e.lanes|e.childLanes,r|=oL,wee(i,t,r,a,o,l),i===Xi&&(Wn=Xi=null,Qn=0),Vy=e,Jd=i,my=t,pD=r,mD=s,R8=n,e.subtreeFlags&10256||e.flags&10256?(i.callbackNode=null,i.callbackPriority=0,ene(iM,function(){return V8(),null})):(i.callbackNode=null,i.callbackPriority=0),n=(e.flags&13878)!==0,e.subtreeFlags&13878||n){n=_n.T,_n.T=null,s=gi.p,gi.p=2,a=wi,wi|=4;try{kte(i,e,t)}finally{wi=a,gi.p=s,_n.T=n}}Hr=1,O8(),F8(),G8()}}function O8(){if(Hr===1){Hr=0;var i=Jd,e=Vy,t=(e.flags&13878)!==0;if(e.subtreeFlags&13878||t){t=_n.T,_n.T=null;var n=gi.p;gi.p=2;var s=wi;wi|=4;try{S8(e,i);var r=bD,a=s6(i.containerInfo),o=r.focusedElem,l=r.selectionRange;if(a!==o&&o&&o.ownerDocument&&i6(o.ownerDocument.documentElement,o)){if(l!==null&&aL(o)){var c=l.start,u=l.end;if(u===void 0&&(u=c),"selectionStart"in o)o.selectionStart=c,o.selectionEnd=Math.min(u,o.value.length);else{var h=o.ownerDocument||document,f=h&&h.defaultView||window;if(f.getSelection){var m=f.getSelection(),g=o.textContent.length,x=Math.min(l.start,g),v=l.end===void 0?x:Math.min(l.end,g);!m.extend&&x>v&&(a=v,v=x,x=a);var y=pz(o,x),b=pz(o,v);if(y&&b&&(m.rangeCount!==1||m.anchorNode!==y.node||m.anchorOffset!==y.offset||m.focusNode!==b.node||m.focusOffset!==b.offset)){var S=h.createRange();S.setStart(y.node,y.offset),m.removeAllRanges(),x>v?(m.addRange(S),m.extend(b.node,b.offset)):(S.setEnd(b.node,b.offset),m.addRange(S))}}}}for(h=[],m=o;m=m.parentNode;)m.nodeType===1&&h.push({element:m,left:m.scrollLeft,top:m.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<h.length;o++){var T=h[o];T.element.scrollLeft=T.left,T.element.scrollTop=T.top}}wM=!!vD,bD=vD=null}finally{wi=s,gi.p=n,_n.T=t}}i.current=e,Hr=2}}function F8(){if(Hr===2){Hr=0;var i=Jd,e=Vy,t=(e.flags&8772)!==0;if(e.subtreeFlags&8772||t){t=_n.T,_n.T=null;var n=gi.p;gi.p=2;var s=wi;wi|=4;try{x8(i,e.alternate,e)}finally{wi=s,gi.p=n,_n.T=t}}Hr=3}}function G8(){if(Hr===4||Hr===3){Hr=0,_ee();var i=Jd,e=Vy,t=my,n=R8;e.subtreeFlags&10256||e.flags&10256?Hr=5:(Hr=0,Vy=Jd=null,z8(i,i.pendingLanes));var s=i.pendingLanes;if(s===0&&(Zd=null),$3(t),e=e.stateNode,Xo&&typeof Xo.onCommitFiberRoot=="function")try{Xo.onCommitFiberRoot(Yb,e,void 0,(e.current.flags&128)===128)}catch{}if(n!==null){e=_n.T,s=gi.p,gi.p=2,_n.T=null;try{for(var r=i.onRecoverableError,a=0;a<n.length;a++){var o=n[a];r(o.value,{componentStack:o.stack})}}finally{_n.T=e,gi.p=s}}my&3&&LE(),vu(i),s=i.pendingLanes,t&4194090&&s&42?i===gD?Dv++:(Dv=0,gD=i):Dv=0,aS(0)}}function z8(i,e){(i.pooledCacheLanes&=e)===0&&(e=i.pooledCache,e!=null&&(i.pooledCache=null,tS(e)))}function LE(i){return O8(),F8(),G8(),V8()}function V8(){if(Hr!==5)return!1;var i=Jd,e=pD;pD=0;var t=$3(my),n=_n.T,s=gi.p;try{gi.p=32>t?32:t,_n.T=null,t=mD,mD=null;var r=Jd,a=my;if(Hr=0,Vy=Jd=null,my=0,wi&6)throw Error(nt(331));var o=wi;if(wi|=4,C8(r.current),A8(r,r.current,a,t),wi=o,aS(0,!1),Xo&&typeof Xo.onPostCommitFiberRoot=="function")try{Xo.onPostCommitFiberRoot(Yb,r)}catch{}return!0}finally{gi.p=s,_n.T=n,z8(i,e)}}function Yz(i,e,t){e=wl(t,e),e=cD(i.stateNode,e,2),i=Kd(i,e,2),i!==null&&(Zb(i,2),vu(i))}function zi(i,e,t){if(i.tag===3)Yz(i,i,t);else for(;e!==null;){if(e.tag===3){Yz(e,i,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Zd===null||!Zd.has(n))){i=wl(t,i),t=s8(2),n=Kd(e,t,2),n!==null&&(r8(t,n,e,i),Zb(n,2),vu(n));break}}e=e.return}}function yN(i,e,t){var n=i.pingCache;if(n===null){n=i.pingCache=new qte;var s=new Set;n.set(e,s)}else s=n.get(e),s===void 0&&(s=new Set,n.set(e,s));s.has(t)||(BL=!0,s.add(t),i=Jte.bind(null,i,e,t),e.then(i,i))}function Jte(i,e,t){var n=i.pingCache;n!==null&&n.delete(e),i.pingedLanes|=i.suspendedLanes&t,i.warmLanes&=~t,Xi===i&&(Qn&t)===t&&(Ss===4||Ss===3&&(Qn&62914560)===Qn&&300>Zc()-LL?!(wi&2)&&Hy(i,0):DL|=t,zy===Qn&&(zy=0)),vu(i)}function H8(i,e){e===0&&(e=Ok()),i=fx(i,e),i!==null&&(Zb(i,e),vu(i))}function Qte(i){var e=i.memoizedState,t=0;e!==null&&(t=e.retryLane),H8(i,t)}function $te(i,e){var t=0;switch(i.tag){case 13:var n=i.stateNode,s=i.memoizedState;s!==null&&(t=s.retryLane);break;case 19:n=i.stateNode;break;case 22:n=i.stateNode._retryCache;break;default:throw Error(nt(314))}n!==null&&n.delete(e),H8(i,t)}function ene(i,e){return J3(i,e)}var bM=null,V0=null,xD=!1,SM=!1,xN=!1,Tm=0;function vu(i){i!==V0&&i.next===null&&(V0===null?bM=V0=i:V0=V0.next=i),SM=!0,xD||(xD=!0,nne())}function aS(i,e){if(!xN&&SM){xN=!0;do for(var t=!1,n=bM;n!==null;){if(i!==0){var s=n.pendingLanes;if(s===0)var r=0;else{var a=n.suspendedLanes,o=n.pingedLanes;r=(1<<31-qo(42|i)+1)-1,r&=s&~(a&~o),r=r&201326741?r&201326741|1:r?r|2:0}r!==0&&(t=!0,Kz(n,r))}else r=Qn,r=bE(n,n===Xi?r:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),!(r&3)||Kb(n,r)||(t=!0,Kz(n,r));n=n.next}while(t);xN=!1}}function tne(){k8()}function k8(){SM=xD=!1;var i=0;Tm!==0&&(une()&&(i=Tm),Tm=0);for(var e=Zc(),t=null,n=bM;n!==null;){var s=n.next,r=W8(n,e);r===0?(n.next=null,t===null?bM=s:t.next=s,s===null&&(V0=t)):(t=n,(i!==0||r&3)&&(SM=!0)),n=s}aS(i)}function W8(i,e){for(var t=i.suspendedLanes,n=i.pingedLanes,s=i.expirationTimes,r=i.pendingLanes&-62914561;0<r;){var a=31-qo(r),o=1<<a,l=s[a];l===-1?(!(o&t)||o&n)&&(s[a]=Cee(o,e)):l<=e&&(i.expiredLanes|=o),r&=~o}if(e=Xi,t=Qn,t=bE(i,i===e?t:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),n=i.callbackNode,t===0||i===e&&(Ei===2||Ei===9)||i.cancelPendingCommit!==null)return n!==null&&n!==null&&WR(n),i.callbackNode=null,i.callbackPriority=0;if(!(t&3)||Kb(i,t)){if(e=t&-t,e===i.callbackPriority)return e;switch(n!==null&&WR(n),$3(t)){case 2:case 8:t=Uk;break;case 32:t=iM;break;case 268435456:t=Ik;break;default:t=iM}return n=X8.bind(null,i),t=J3(t,n),i.callbackPriority=e,i.callbackNode=t,e}return n!==null&&n!==null&&WR(n),i.callbackPriority=2,i.callbackNode=null,2}function X8(i,e){if(Hr!==0&&Hr!==5)return i.callbackNode=null,i.callbackPriority=0,null;var t=i.callbackNode;if(LE()&&i.callbackNode!==t)return null;var n=Qn;return n=bE(i,i===Xi?n:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),n===0?null:(B8(i,n,e),W8(i,Zc()),i.callbackNode!=null&&i.callbackNode===t?X8.bind(null,i):null)}function Kz(i,e){if(LE())return null;B8(i,e,!0)}function nne(){dne(function(){wi&6?J3(Lk,tne):k8()})}function IL(){return Tm===0&&(Tm=Pk()),Tm}function Zz(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:RA(""+i)}function Jz(i,e){var t=e.ownerDocument.createElement("input");return t.name=e.name,t.value=e.value,i.id&&t.setAttribute("form",i.id),e.parentNode.insertBefore(t,e),i=new FormData(i),t.parentNode.removeChild(t),i}function ine(i,e,t,n,s){if(e==="submit"&&t&&t.stateNode===s){var r=Zz((s[ho]||null).action),a=n.submitter;a&&(e=(e=a[ho]||null)?Zz(e.formAction):a.getAttribute("formAction"),e!==null&&(r=e,a=null));var o=new SE("action","action",null,n,s);i.push({event:o,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(Tm!==0){var l=a?Jz(s,a):new FormData(s);oD(t,{pending:!0,data:l,method:s.method,action:r},null,l)}}else typeof r=="function"&&(o.preventDefault(),l=a?Jz(s,a):new FormData(s),oD(t,{pending:!0,data:l,method:s.method,action:r},r,l))},currentTarget:s}]})}}for(var _N=0;_N<KB.length;_N++){var vN=KB[_N],sne=vN.toLowerCase(),rne=vN[0].toUpperCase()+vN.slice(1);Ec(sne,"on"+rne)}Ec(a6,"onAnimationEnd");Ec(o6,"onAnimationIteration");Ec(l6,"onAnimationStart");Ec("dblclick","onDoubleClick");Ec("focusin","onFocus");Ec("focusout","onBlur");Ec(Ste,"onTransitionRun");Ec(Tte,"onTransitionStart");Ec(Ate,"onTransitionCancel");Ec(c6,"onTransitionEnd");Uy("onMouseEnter",["mouseout","mouseover"]);Uy("onMouseLeave",["mouseout","mouseover"]);Uy("onPointerEnter",["pointerout","pointerover"]);Uy("onPointerLeave",["pointerout","pointerover"]);cg("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));cg("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));cg("onBeforeInput",["compositionend","keypress","textInput","paste"]);cg("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));cg("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));cg("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ane=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(cb));function q8(i,e){e=(e&4)!==0;for(var t=0;t<i.length;t++){var n=i[t],s=n.event;n=n.listeners;e:{var r=void 0;if(e)for(var a=n.length-1;0<=a;a--){var o=n[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==r&&s.isPropagationStopped())break e;r=o,s.currentTarget=c;try{r(s)}catch(u){mM(u)}s.currentTarget=null,r=l}else for(a=0;a<n.length;a++){if(o=n[a],l=o.instance,c=o.currentTarget,o=o.listener,l!==r&&s.isPropagationStopped())break e;r=o,s.currentTarget=c;try{r(s)}catch(u){mM(u)}s.currentTarget=null,r=l}}}}function Hn(i,e){var t=e[HB];t===void 0&&(t=e[HB]=new Set);var n=i+"__bubble";t.has(n)||(j8(e,i,2,!1),t.add(n))}function bN(i,e,t){var n=0;e&&(n|=4),j8(t,i,n,e)}var i1="_reactListening"+Math.random().toString(36).slice(2);function PL(i){if(!i[i1]){i[i1]=!0,Vk.forEach(function(t){t!=="selectionchange"&&(ane.has(t)||bN(t,!1,i),bN(t,!0,i))});var e=i.nodeType===9?i:i.ownerDocument;e===null||e[i1]||(e[i1]=!0,bN("selectionchange",!1,e))}}function j8(i,e,t,n){switch(r9(e)){case 2:var s=Lne;break;case 8:s=Une;break;default:s=zL}t=s.bind(null,e,t,i),s=void 0,!qB||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),n?s!==void 0?i.addEventListener(e,t,{capture:!0,passive:s}):i.addEventListener(e,t,!0):s!==void 0?i.addEventListener(e,t,{passive:s}):i.addEventListener(e,t,!1)}function SN(i,e,t,n,s){var r=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var o=n.stateNode.containerInfo;if(o===s)break;if(a===4)for(a=n.return;a!==null;){var l=a.tag;if((l===3||l===4)&&a.stateNode.containerInfo===s)return;a=a.return}for(;o!==null;){if(a=q0(o),a===null)return;if(l=a.tag,l===5||l===6||l===26||l===27){n=r=a;continue e}o=o.parentNode}}n=n.return}Kk(function(){var c=r,u=nL(t),h=[];e:{var f=u6.get(i);if(f!==void 0){var m=SE,g=i;switch(i){case"keypress":if(BA(t)===0)break e;case"keydown":case"keyup":m=ete;break;case"focusin":g="focus",m=QR;break;case"focusout":g="blur",m=QR;break;case"beforeblur":case"afterblur":m=QR;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=sz;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=Hee;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=ite;break;case a6:case o6:case l6:m=Xee;break;case c6:m=rte;break;case"scroll":case"scrollend":m=zee;break;case"wheel":m=ote;break;case"copy":case"cut":case"paste":m=jee;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=az;break;case"toggle":case"beforetoggle":m=cte}var x=(e&4)!==0,v=!x&&(i==="scroll"||i==="scrollend"),y=x?f!==null?f+"Capture":null:f;x=[];for(var b=c,S;b!==null;){var T=b;if(S=T.stateNode,T=T.tag,T!==5&&T!==26&&T!==27||S===null||y===null||(T=ib(b,y),T!=null&&x.push(ub(b,T,S))),v)break;b=b.return}0<x.length&&(f=new m(f,g,null,t,u),h.push({event:f,listeners:x}))}}if(!(e&7)){e:{if(f=i==="mouseover"||i==="pointerover",m=i==="mouseout"||i==="pointerout",f&&t!==XB&&(g=t.relatedTarget||t.fromElement)&&(q0(g)||g[hx]))break e;if((m||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,m?(g=t.relatedTarget||t.toElement,m=c,g=g?q0(g):null,g!==null&&(v=jb(g),x=g.tag,g!==v||x!==5&&x!==27&&x!==6)&&(g=null)):(m=null,g=c),m!==g)){if(x=sz,T="onMouseLeave",y="onMouseEnter",b="mouse",(i==="pointerout"||i==="pointerover")&&(x=az,T="onPointerLeave",y="onPointerEnter",b="pointer"),v=m==null?f:lv(m),S=g==null?f:lv(g),f=new x(T,b+"leave",m,t,u),f.target=v,f.relatedTarget=S,T=null,q0(u)===c&&(x=new x(y,b+"enter",g,t,u),x.target=S,x.relatedTarget=v,T=x),v=T,m&&g)t:{for(x=m,y=g,b=0,S=x;S;S=s0(S))b++;for(S=0,T=y;T;T=s0(T))S++;for(;0<b-S;)x=s0(x),b--;for(;0<S-b;)y=s0(y),S--;for(;b--;){if(x===y||y!==null&&x===y.alternate)break t;x=s0(x),y=s0(y)}x=null}else x=null;m!==null&&Qz(h,f,m,x,!1),g!==null&&v!==null&&Qz(h,v,g,x,!0)}}e:{if(f=c?lv(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var M=uz;else if(cz(f))if(t6)M=_te;else{M=yte;var C=gte}else m=f.nodeName,!m||m.toLowerCase()!=="input"||f.type!=="checkbox"&&f.type!=="radio"?c&&tL(c.elementType)&&(M=uz):M=xte;if(M&&(M=M(i,c))){e6(h,M,t,u);break e}C&&C(i,f,c),i==="focusout"&&c&&f.type==="number"&&c.memoizedProps.value!=null&&WB(f,"number",f.value)}switch(C=c?lv(c):window,i){case"focusin":(cz(C)||C.contentEditable==="true")&&(K0=C,jB=c,Sv=null);break;case"focusout":Sv=jB=K0=null;break;case"mousedown":YB=!0;break;case"contextmenu":case"mouseup":case"dragend":YB=!1,mz(h,t,u);break;case"selectionchange":if(bte)break;case"keydown":case"keyup":mz(h,t,u)}var w;if(rL)e:{switch(i){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else Y0?Qk(i,t)&&(N="onCompositionEnd"):i==="keydown"&&t.keyCode===229&&(N="onCompositionStart");N&&(Jk&&t.locale!=="ko"&&(Y0||N!=="onCompositionStart"?N==="onCompositionEnd"&&Y0&&(w=Zk()):(Id=u,iL="value"in Id?Id.value:Id.textContent,Y0=!0)),C=TM(c,N),0<C.length&&(N=new rz(N,i,null,t,u),h.push({event:N,listeners:C}),w?N.data=w:(w=$k(t),w!==null&&(N.data=w)))),(w=hte?dte(i,t):fte(i,t))&&(N=TM(c,"onBeforeInput"),0<N.length&&(C=new rz("onBeforeInput","beforeinput",null,t,u),h.push({event:C,listeners:N}),C.data=w)),ine(h,i,c,t,u)}q8(h,e)})}function ub(i,e,t){return{instance:i,listener:e,currentTarget:t}}function TM(i,e){for(var t=e+"Capture",n=[];i!==null;){var s=i,r=s.stateNode;if(s=s.tag,s!==5&&s!==26&&s!==27||r===null||(s=ib(i,t),s!=null&&n.unshift(ub(i,s,r)),s=ib(i,e),s!=null&&n.push(ub(i,s,r))),i.tag===3)return n;i=i.return}return[]}function s0(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function Qz(i,e,t,n,s){for(var r=e._reactName,a=[];t!==null&&t!==n;){var o=t,l=o.alternate,c=o.stateNode;if(o=o.tag,l!==null&&l===n)break;o!==5&&o!==26&&o!==27||c===null||(l=c,s?(c=ib(t,r),c!=null&&a.unshift(ub(t,c,l))):s||(c=ib(t,r),c!=null&&a.push(ub(t,c,l)))),t=t.return}a.length!==0&&i.push({event:e,listeners:a})}var one=/\r\n?/g,lne=/\u0000|\uFFFD/g;function $z(i){return(typeof i=="string"?i:""+i).replace(one,`
`).replace(lne,"")}function Y8(i,e){return e=$z(e),$z(i)===e}function UE(){}function Di(i,e,t,n,s,r){switch(t){case"children":typeof n=="string"?e==="body"||e==="textarea"&&n===""||Iy(i,n):(typeof n=="number"||typeof n=="bigint")&&e!=="body"&&Iy(i,""+n);break;case"className":ZT(i,"class",n);break;case"tabIndex":ZT(i,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":ZT(i,t,n);break;case"style":Yk(i,n,r);break;case"data":if(e!=="object"){ZT(i,"data",n);break}case"src":case"href":if(n===""&&(e!=="a"||t!=="href")){i.removeAttribute(t);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){i.removeAttribute(t);break}n=RA(""+n),i.setAttribute(t,n);break;case"action":case"formAction":if(typeof n=="function"){i.setAttribute(t,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof r=="function"&&(t==="formAction"?(e!=="input"&&Di(i,e,"name",s.name,s,null),Di(i,e,"formEncType",s.formEncType,s,null),Di(i,e,"formMethod",s.formMethod,s,null),Di(i,e,"formTarget",s.formTarget,s,null)):(Di(i,e,"encType",s.encType,s,null),Di(i,e,"method",s.method,s,null),Di(i,e,"target",s.target,s,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){i.removeAttribute(t);break}n=RA(""+n),i.setAttribute(t,n);break;case"onClick":n!=null&&(i.onclick=UE);break;case"onScroll":n!=null&&Hn("scroll",i);break;case"onScrollEnd":n!=null&&Hn("scrollend",i);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(nt(61));if(t=n.__html,t!=null){if(s.children!=null)throw Error(nt(60));i.innerHTML=t}}break;case"multiple":i.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":i.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){i.removeAttribute("xlink:href");break}t=RA(""+n),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?i.setAttribute(t,""+n):i.removeAttribute(t);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?i.setAttribute(t,""):i.removeAttribute(t);break;case"capture":case"download":n===!0?i.setAttribute(t,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?i.setAttribute(t,n):i.removeAttribute(t);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?i.setAttribute(t,n):i.removeAttribute(t);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?i.removeAttribute(t):i.setAttribute(t,n);break;case"popover":Hn("beforetoggle",i),Hn("toggle",i),wA(i,"popover",n);break;case"xlinkActuate":Pu(i,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":Pu(i,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":Pu(i,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":Pu(i,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":Pu(i,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":Pu(i,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":Pu(i,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":Pu(i,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":Pu(i,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":wA(i,"is",n);break;case"innerText":case"textContent":break;default:(!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(t=Fee.get(t)||t,wA(i,t,n))}}function _D(i,e,t,n,s,r){switch(t){case"style":Yk(i,n,r);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(nt(61));if(t=n.__html,t!=null){if(s.children!=null)throw Error(nt(60));i.innerHTML=t}}break;case"children":typeof n=="string"?Iy(i,n):(typeof n=="number"||typeof n=="bigint")&&Iy(i,""+n);break;case"onScroll":n!=null&&Hn("scroll",i);break;case"onScrollEnd":n!=null&&Hn("scrollend",i);break;case"onClick":n!=null&&(i.onclick=UE);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Hk.hasOwnProperty(t))e:{if(t[0]==="o"&&t[1]==="n"&&(s=t.endsWith("Capture"),e=t.slice(2,s?t.length-7:void 0),r=i[ho]||null,r=r!=null?r[t]:null,typeof r=="function"&&i.removeEventListener(e,r,s),typeof n=="function")){typeof r!="function"&&r!==null&&(t in i?i[t]=null:i.hasAttribute(t)&&i.removeAttribute(t)),i.addEventListener(e,n,s);break e}t in i?i[t]=n:n===!0?i.setAttribute(t,""):wA(i,t,n)}}}function qr(i,e,t){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Hn("error",i),Hn("load",i);var n=!1,s=!1,r;for(r in t)if(t.hasOwnProperty(r)){var a=t[r];if(a!=null)switch(r){case"src":n=!0;break;case"srcSet":s=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(nt(137,e));default:Di(i,e,r,a,t,null)}}s&&Di(i,e,"srcSet",t.srcSet,t,null),n&&Di(i,e,"src",t.src,t,null);return;case"input":Hn("invalid",i);var o=r=a=s=null,l=null,c=null;for(n in t)if(t.hasOwnProperty(n)){var u=t[n];if(u!=null)switch(n){case"name":s=u;break;case"type":a=u;break;case"checked":l=u;break;case"defaultChecked":c=u;break;case"value":r=u;break;case"defaultValue":o=u;break;case"children":case"dangerouslySetInnerHTML":if(u!=null)throw Error(nt(137,e));break;default:Di(i,e,n,u,t,null)}}Xk(i,r,o,l,c,a,s,!1),sM(i);return;case"select":Hn("invalid",i),n=a=r=null;for(s in t)if(t.hasOwnProperty(s)&&(o=t[s],o!=null))switch(s){case"value":r=o;break;case"defaultValue":a=o;break;case"multiple":n=o;default:Di(i,e,s,o,t,null)}e=r,t=a,i.multiple=!!n,e!=null?cy(i,!!n,e,!1):t!=null&&cy(i,!!n,t,!0);return;case"textarea":Hn("invalid",i),r=s=n=null;for(a in t)if(t.hasOwnProperty(a)&&(o=t[a],o!=null))switch(a){case"value":n=o;break;case"defaultValue":s=o;break;case"children":r=o;break;case"dangerouslySetInnerHTML":if(o!=null)throw Error(nt(91));break;default:Di(i,e,a,o,t,null)}jk(i,n,s,r),sM(i);return;case"option":for(l in t)if(t.hasOwnProperty(l)&&(n=t[l],n!=null))switch(l){case"selected":i.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:Di(i,e,l,n,t,null)}return;case"dialog":Hn("beforetoggle",i),Hn("toggle",i),Hn("cancel",i),Hn("close",i);break;case"iframe":case"object":Hn("load",i);break;case"video":case"audio":for(n=0;n<cb.length;n++)Hn(cb[n],i);break;case"image":Hn("error",i),Hn("load",i);break;case"details":Hn("toggle",i);break;case"embed":case"source":case"link":Hn("error",i),Hn("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(c in t)if(t.hasOwnProperty(c)&&(n=t[c],n!=null))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(nt(137,e));default:Di(i,e,c,n,t,null)}return;default:if(tL(e)){for(u in t)t.hasOwnProperty(u)&&(n=t[u],n!==void 0&&_D(i,e,u,n,t,void 0));return}}for(o in t)t.hasOwnProperty(o)&&(n=t[o],n!=null&&Di(i,e,o,n,t,null))}function cne(i,e,t,n){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var s=null,r=null,a=null,o=null,l=null,c=null,u=null;for(m in t){var h=t[m];if(t.hasOwnProperty(m)&&h!=null)switch(m){case"checked":break;case"value":break;case"defaultValue":l=h;default:n.hasOwnProperty(m)||Di(i,e,m,null,n,h)}}for(var f in n){var m=n[f];if(h=t[f],n.hasOwnProperty(f)&&(m!=null||h!=null))switch(f){case"type":r=m;break;case"name":s=m;break;case"checked":c=m;break;case"defaultChecked":u=m;break;case"value":a=m;break;case"defaultValue":o=m;break;case"children":case"dangerouslySetInnerHTML":if(m!=null)throw Error(nt(137,e));break;default:m!==h&&Di(i,e,f,m,n,h)}}kB(i,a,o,l,c,u,r,s);return;case"select":m=a=o=f=null;for(r in t)if(l=t[r],t.hasOwnProperty(r)&&l!=null)switch(r){case"value":break;case"multiple":m=l;default:n.hasOwnProperty(r)||Di(i,e,r,null,n,l)}for(s in n)if(r=n[s],l=t[s],n.hasOwnProperty(s)&&(r!=null||l!=null))switch(s){case"value":f=r;break;case"defaultValue":o=r;break;case"multiple":a=r;default:r!==l&&Di(i,e,s,r,n,l)}e=o,t=a,n=m,f!=null?cy(i,!!t,f,!1):!!n!=!!t&&(e!=null?cy(i,!!t,e,!0):cy(i,!!t,t?[]:"",!1));return;case"textarea":m=f=null;for(o in t)if(s=t[o],t.hasOwnProperty(o)&&s!=null&&!n.hasOwnProperty(o))switch(o){case"value":break;case"children":break;default:Di(i,e,o,null,n,s)}for(a in n)if(s=n[a],r=t[a],n.hasOwnProperty(a)&&(s!=null||r!=null))switch(a){case"value":f=s;break;case"defaultValue":m=s;break;case"children":break;case"dangerouslySetInnerHTML":if(s!=null)throw Error(nt(91));break;default:s!==r&&Di(i,e,a,s,n,r)}qk(i,f,m);return;case"option":for(var g in t)if(f=t[g],t.hasOwnProperty(g)&&f!=null&&!n.hasOwnProperty(g))switch(g){case"selected":i.selected=!1;break;default:Di(i,e,g,null,n,f)}for(l in n)if(f=n[l],m=t[l],n.hasOwnProperty(l)&&f!==m&&(f!=null||m!=null))switch(l){case"selected":i.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:Di(i,e,l,f,n,m)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var x in t)f=t[x],t.hasOwnProperty(x)&&f!=null&&!n.hasOwnProperty(x)&&Di(i,e,x,null,n,f);for(c in n)if(f=n[c],m=t[c],n.hasOwnProperty(c)&&f!==m&&(f!=null||m!=null))switch(c){case"children":case"dangerouslySetInnerHTML":if(f!=null)throw Error(nt(137,e));break;default:Di(i,e,c,f,n,m)}return;default:if(tL(e)){for(var v in t)f=t[v],t.hasOwnProperty(v)&&f!==void 0&&!n.hasOwnProperty(v)&&_D(i,e,v,void 0,n,f);for(u in n)f=n[u],m=t[u],!n.hasOwnProperty(u)||f===m||f===void 0&&m===void 0||_D(i,e,u,f,n,m);return}}for(var y in t)f=t[y],t.hasOwnProperty(y)&&f!=null&&!n.hasOwnProperty(y)&&Di(i,e,y,null,n,f);for(h in n)f=n[h],m=t[h],!n.hasOwnProperty(h)||f===m||f==null&&m==null||Di(i,e,h,f,n,m)}var vD=null,bD=null;function AM(i){return i.nodeType===9?i:i.ownerDocument}function e4(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function K8(i,e){if(i===0)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&e==="foreignObject"?0:i}function SD(i,e){return i==="textarea"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.children=="bigint"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var TN=null;function une(){var i=window.event;return i&&i.type==="popstate"?i===TN?!1:(TN=i,!0):(TN=null,!1)}var Z8=typeof setTimeout=="function"?setTimeout:void 0,hne=typeof clearTimeout=="function"?clearTimeout:void 0,t4=typeof Promise=="function"?Promise:void 0,dne=typeof queueMicrotask=="function"?queueMicrotask:typeof t4<"u"?function(i){return t4.resolve(null).then(i).catch(fne)}:Z8;function fne(i){setTimeout(function(){throw i})}function jf(i){return i==="head"}function n4(i,e){var t=e,n=0,s=0;do{var r=t.nextSibling;if(i.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(0<n&&8>n){t=n;var a=i.ownerDocument;if(t&1&&Lv(a.documentElement),t&2&&Lv(a.body),t&4)for(t=a.head,Lv(t),a=t.firstChild;a;){var o=a.nextSibling,l=a.nodeName;a[Jb]||l==="SCRIPT"||l==="STYLE"||l==="LINK"&&a.rel.toLowerCase()==="stylesheet"||t.removeChild(a),a=o}}if(s===0){i.removeChild(r),mb(e);return}s--}else t==="$"||t==="$?"||t==="$!"?s++:n=t.charCodeAt(0)-48;else n=0;t=r}while(t);mb(e)}function TD(i){var e=i.firstChild;for(e&&e.nodeType===10&&(e=e.nextSibling);e;){var t=e;switch(e=e.nextSibling,t.nodeName){case"HTML":case"HEAD":case"BODY":TD(t),eL(t);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(t.rel.toLowerCase()==="stylesheet")continue}i.removeChild(t)}}function pne(i,e,t,n){for(;i.nodeType===1;){var s=t;if(i.nodeName.toLowerCase()!==e.toLowerCase()){if(!n&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(n){if(!i[Jb])switch(e){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(r=i.getAttribute("rel"),r==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(r!==s.rel||i.getAttribute("href")!==(s.href==null||s.href===""?null:s.href)||i.getAttribute("crossorigin")!==(s.crossOrigin==null?null:s.crossOrigin)||i.getAttribute("title")!==(s.title==null?null:s.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(r=i.getAttribute("src"),(r!==(s.src==null?null:s.src)||i.getAttribute("type")!==(s.type==null?null:s.type)||i.getAttribute("crossorigin")!==(s.crossOrigin==null?null:s.crossOrigin))&&r&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(e==="input"&&i.type==="hidden"){var r=s.name==null?null:""+s.name;if(s.type==="hidden"&&i.getAttribute("name")===r)return i}else return i;if(i=yc(i.nextSibling),i===null)break}return null}function mne(i,e,t){if(e==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!t||(i=yc(i.nextSibling),i===null))return null;return i}function AD(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState==="complete"}function gne(i,e){var t=i.ownerDocument;if(i.data!=="$?"||t.readyState==="complete")e();else{var n=function(){e(),t.removeEventListener("DOMContentLoaded",n)};t.addEventListener("DOMContentLoaded",n),i._reactRetry=n}}function yc(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break;if(e===8){if(e=i.data,e==="$"||e==="$!"||e==="$?"||e==="F!"||e==="F")break;if(e==="/$")return null}}return i}var MD=null;function i4(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return i;e--}else t==="/$"&&e++}i=i.previousSibling}return null}function J8(i,e,t){switch(e=AM(t),i){case"html":if(i=e.documentElement,!i)throw Error(nt(452));return i;case"head":if(i=e.head,!i)throw Error(nt(453));return i;case"body":if(i=e.body,!i)throw Error(nt(454));return i;default:throw Error(nt(451))}}function Lv(i){for(var e=i.attributes;e.length;)i.removeAttributeNode(e[0]);eL(i)}var Xl=new Map,s4=new Set;function MM(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Ph=gi.d;gi.d={f:yne,r:xne,D:_ne,C:vne,L:bne,m:Sne,X:Ane,S:Tne,M:Mne};function yne(){var i=Ph.f(),e=BE();return i||e}function xne(i){var e=dx(i);e!==null&&e.tag===5&&e.type==="form"?W6(e):Ph.r(i)}var mx=typeof document>"u"?null:document;function Q8(i,e,t){var n=mx;if(n&&typeof e=="string"&&e){var s=Cl(e);s='link[rel="'+i+'"][href="'+s+'"]',typeof t=="string"&&(s+='[crossorigin="'+t+'"]'),s4.has(s)||(s4.add(s),i={rel:i,crossOrigin:t,href:e},n.querySelector(s)===null&&(e=n.createElement("link"),qr(e,"link",i),Ar(e),n.head.appendChild(e)))}}function _ne(i){Ph.D(i),Q8("dns-prefetch",i,null)}function vne(i,e){Ph.C(i,e),Q8("preconnect",i,e)}function bne(i,e,t){Ph.L(i,e,t);var n=mx;if(n&&i&&e){var s='link[rel="preload"][as="'+Cl(e)+'"]';e==="image"&&t&&t.imageSrcSet?(s+='[imagesrcset="'+Cl(t.imageSrcSet)+'"]',typeof t.imageSizes=="string"&&(s+='[imagesizes="'+Cl(t.imageSizes)+'"]')):s+='[href="'+Cl(i)+'"]';var r=s;switch(e){case"style":r=ky(i);break;case"script":r=gx(i)}Xl.has(r)||(i=Ji({rel:"preload",href:e==="image"&&t&&t.imageSrcSet?void 0:i,as:e},t),Xl.set(r,i),n.querySelector(s)!==null||e==="style"&&n.querySelector(oS(r))||e==="script"&&n.querySelector(lS(r))||(e=n.createElement("link"),qr(e,"link",i),Ar(e),n.head.appendChild(e)))}}function Sne(i,e){Ph.m(i,e);var t=mx;if(t&&i){var n=e&&typeof e.as=="string"?e.as:"script",s='link[rel="modulepreload"][as="'+Cl(n)+'"][href="'+Cl(i)+'"]',r=s;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":r=gx(i)}if(!Xl.has(r)&&(i=Ji({rel:"modulepreload",href:i},e),Xl.set(r,i),t.querySelector(s)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(t.querySelector(lS(r)))return}n=t.createElement("link"),qr(n,"link",i),Ar(n),t.head.appendChild(n)}}}function Tne(i,e,t){Ph.S(i,e,t);var n=mx;if(n&&i){var s=ly(n).hoistableStyles,r=ky(i);e=e||"default";var a=s.get(r);if(!a){var o={loading:0,preload:null};if(a=n.querySelector(oS(r)))o.loading=5;else{i=Ji({rel:"stylesheet",href:i,"data-precedence":e},t),(t=Xl.get(r))&&OL(i,t);var l=a=n.createElement("link");Ar(l),qr(l,"link",i),l._p=new Promise(function(c,u){l.onload=c,l.onerror=u}),l.addEventListener("load",function(){o.loading|=1}),l.addEventListener("error",function(){o.loading|=2}),o.loading|=4,FA(a,e,n)}a={type:"stylesheet",instance:a,count:1,state:o},s.set(r,a)}}}function Ane(i,e){Ph.X(i,e);var t=mx;if(t&&i){var n=ly(t).hoistableScripts,s=gx(i),r=n.get(s);r||(r=t.querySelector(lS(s)),r||(i=Ji({src:i,async:!0},e),(e=Xl.get(s))&&FL(i,e),r=t.createElement("script"),Ar(r),qr(r,"link",i),t.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},n.set(s,r))}}function Mne(i,e){Ph.M(i,e);var t=mx;if(t&&i){var n=ly(t).hoistableScripts,s=gx(i),r=n.get(s);r||(r=t.querySelector(lS(s)),r||(i=Ji({src:i,async:!0,type:"module"},e),(e=Xl.get(s))&&FL(i,e),r=t.createElement("script"),Ar(r),qr(r,"link",i),t.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},n.set(s,r))}}function r4(i,e,t,n){var s=(s=jd.current)?MM(s):null;if(!s)throw Error(nt(446));switch(i){case"meta":case"title":return null;case"style":return typeof t.precedence=="string"&&typeof t.href=="string"?(e=ky(t.href),t=ly(s).hoistableStyles,n=t.get(e),n||(n={type:"style",instance:null,count:0,state:null},t.set(e,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(t.rel==="stylesheet"&&typeof t.href=="string"&&typeof t.precedence=="string"){i=ky(t.href);var r=ly(s).hoistableStyles,a=r.get(i);if(a||(s=s.ownerDocument||s,a={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},r.set(i,a),(r=s.querySelector(oS(i)))&&!r._p&&(a.instance=r,a.state.loading=5),Xl.has(i)||(t={rel:"preload",as:"style",href:t.href,crossOrigin:t.crossOrigin,integrity:t.integrity,media:t.media,hrefLang:t.hrefLang,referrerPolicy:t.referrerPolicy},Xl.set(i,t),r||Ene(s,i,t,a.state))),e&&n===null)throw Error(nt(528,""));return a}if(e&&n!==null)throw Error(nt(529,""));return null;case"script":return e=t.async,t=t.src,typeof t=="string"&&e&&typeof e!="function"&&typeof e!="symbol"?(e=gx(t),t=ly(s).hoistableScripts,n=t.get(e),n||(n={type:"script",instance:null,count:0,state:null},t.set(e,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(nt(444,i))}}function ky(i){return'href="'+Cl(i)+'"'}function oS(i){return'link[rel="stylesheet"]['+i+"]"}function $8(i){return Ji({},i,{"data-precedence":i.precedence,precedence:null})}function Ene(i,e,t,n){i.querySelector('link[rel="preload"][as="style"]['+e+"]")?n.loading=1:(e=i.createElement("link"),n.preload=e,e.addEventListener("load",function(){return n.loading|=1}),e.addEventListener("error",function(){return n.loading|=2}),qr(e,"link",t),Ar(e),i.head.appendChild(e))}function gx(i){return'[src="'+Cl(i)+'"]'}function lS(i){return"script[async]"+i}function a4(i,e,t){if(e.count++,e.instance===null)switch(e.type){case"style":var n=i.querySelector('style[data-href~="'+Cl(t.href)+'"]');if(n)return e.instance=n,Ar(n),n;var s=Ji({},t,{"data-href":t.href,"data-precedence":t.precedence,href:null,precedence:null});return n=(i.ownerDocument||i).createElement("style"),Ar(n),qr(n,"style",s),FA(n,t.precedence,i),e.instance=n;case"stylesheet":s=ky(t.href);var r=i.querySelector(oS(s));if(r)return e.state.loading|=4,e.instance=r,Ar(r),r;n=$8(t),(s=Xl.get(s))&&OL(n,s),r=(i.ownerDocument||i).createElement("link"),Ar(r);var a=r;return a._p=new Promise(function(o,l){a.onload=o,a.onerror=l}),qr(r,"link",n),e.state.loading|=4,FA(r,t.precedence,i),e.instance=r;case"script":return r=gx(t.src),(s=i.querySelector(lS(r)))?(e.instance=s,Ar(s),s):(n=t,(s=Xl.get(r))&&(n=Ji({},t),FL(n,s)),i=i.ownerDocument||i,s=i.createElement("script"),Ar(s),qr(s,"link",n),i.head.appendChild(s),e.instance=s);case"void":return null;default:throw Error(nt(443,e.type))}else e.type==="stylesheet"&&!(e.state.loading&4)&&(n=e.instance,e.state.loading|=4,FA(n,t.precedence,i));return e.instance}function FA(i,e,t){for(var n=t.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),s=n.length?n[n.length-1]:null,r=s,a=0;a<n.length;a++){var o=n[a];if(o.dataset.precedence===e)r=o;else if(r!==s)break}r?r.parentNode.insertBefore(i,r.nextSibling):(e=t.nodeType===9?t.head:t,e.insertBefore(i,e.firstChild))}function OL(i,e){i.crossOrigin==null&&(i.crossOrigin=e.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=e.referrerPolicy),i.title==null&&(i.title=e.title)}function FL(i,e){i.crossOrigin==null&&(i.crossOrigin=e.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=e.referrerPolicy),i.integrity==null&&(i.integrity=e.integrity)}var GA=null;function o4(i,e,t){if(GA===null){var n=new Map,s=GA=new Map;s.set(t,n)}else s=GA,n=s.get(t),n||(n=new Map,s.set(t,n));if(n.has(i))return n;for(n.set(i,null),t=t.getElementsByTagName(i),s=0;s<t.length;s++){var r=t[s];if(!(r[Jb]||r[pa]||i==="link"&&r.getAttribute("rel")==="stylesheet")&&r.namespaceURI!=="http://www.w3.org/2000/svg"){var a=r.getAttribute(e)||"";a=i+a;var o=n.get(a);o?o.push(r):n.set(a,[r])}}return n}function l4(i,e,t){i=i.ownerDocument||i,i.head.insertBefore(t,e==="title"?i.querySelector("head > title"):null)}function Cne(i,e,t){if(t===1||e.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof e.precedence!="string"||typeof e.href!="string"||e.href==="")break;return!0;case"link":if(typeof e.rel!="string"||typeof e.href!="string"||e.href===""||e.onLoad||e.onError)break;switch(e.rel){case"stylesheet":return i=e.disabled,typeof e.precedence=="string"&&i==null;default:return!0}case"script":if(e.async&&typeof e.async!="function"&&typeof e.async!="symbol"&&!e.onLoad&&!e.onError&&e.src&&typeof e.src=="string")return!0}return!1}function e9(i){return!(i.type==="stylesheet"&&!(i.state.loading&3))}var hb=null;function wne(){}function Rne(i,e,t){if(hb===null)throw Error(nt(475));var n=hb;if(e.type==="stylesheet"&&(typeof t.media!="string"||matchMedia(t.media).matches!==!1)&&!(e.state.loading&4)){if(e.instance===null){var s=ky(t.href),r=i.querySelector(oS(s));if(r){i=r._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(n.count++,n=EM.bind(n),i.then(n,n)),e.state.loading|=4,e.instance=r,Ar(r);return}r=i.ownerDocument||i,t=$8(t),(s=Xl.get(s))&&OL(t,s),r=r.createElement("link"),Ar(r);var a=r;a._p=new Promise(function(o,l){a.onload=o,a.onerror=l}),qr(r,"link",t),e.instance=r}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(e,i),(i=e.state.preload)&&!(e.state.loading&3)&&(n.count++,e=EM.bind(n),i.addEventListener("load",e),i.addEventListener("error",e))}}function Nne(){if(hb===null)throw Error(nt(475));var i=hb;return i.stylesheets&&i.count===0&&ED(i,i.stylesheets),0<i.count?function(e){var t=setTimeout(function(){if(i.stylesheets&&ED(i,i.stylesheets),i.unsuspend){var n=i.unsuspend;i.unsuspend=null,n()}},6e4);return i.unsuspend=e,function(){i.unsuspend=null,clearTimeout(t)}}:null}function EM(){if(this.count--,this.count===0){if(this.stylesheets)ED(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var CM=null;function ED(i,e){i.stylesheets=null,i.unsuspend!==null&&(i.count++,CM=new Map,e.forEach(Bne,i),CM=null,EM.call(i))}function Bne(i,e){if(!(e.state.loading&4)){var t=CM.get(i);if(t)var n=t.get(null);else{t=new Map,CM.set(i,t);for(var s=i.querySelectorAll("link[data-precedence],style[data-precedence]"),r=0;r<s.length;r++){var a=s[r];(a.nodeName==="LINK"||a.getAttribute("media")!=="not all")&&(t.set(a.dataset.precedence,a),n=a)}n&&t.set(null,n)}s=e.instance,a=s.getAttribute("data-precedence"),r=t.get(a)||n,r===n&&t.set(null,s),t.set(a,s),this.count++,n=EM.bind(this),s.addEventListener("load",n),s.addEventListener("error",n),r?r.parentNode.insertBefore(s,r.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(s,i.firstChild)),e.state.loading|=4}}var db={$$typeof:ah,Provider:null,Consumer:null,_currentValue:ym,_currentValue2:ym,_threadCount:0};function Dne(i,e,t,n,s,r,a,o){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=XR(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=XR(0),this.hiddenUpdates=XR(null),this.identifierPrefix=n,this.onUncaughtError=s,this.onCaughtError=r,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=o,this.incompleteTransitions=new Map}function t9(i,e,t,n,s,r,a,o,l,c,u,h){return i=new Dne(i,e,t,a,o,l,c,h),e=1,r===!0&&(e|=24),r=Go(3,null,null,e),i.current=r,r.stateNode=i,e=dL(),e.refCount++,i.pooledCache=e,e.refCount++,r.memoizedState={element:n,isDehydrated:t,cache:e},pL(r),i}function n9(i){return i?(i=Q0,i):Q0}function i9(i,e,t,n,s,r){s=n9(s),n.context===null?n.context=s:n.pendingContext=s,n=Yd(e),n.payload={element:t},r=r===void 0?null:r,r!==null&&(n.callback=r),t=Kd(i,n,e),t!==null&&(Yo(t,i,e),Mv(t,i,e))}function c4(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var t=i.retryLane;i.retryLane=t!==0&&t<e?t:e}}function GL(i,e){c4(i,e),(i=i.alternate)&&c4(i,e)}function s9(i){if(i.tag===13){var e=fx(i,67108864);e!==null&&Yo(e,i,67108864),GL(i,67108864)}}var wM=!0;function Lne(i,e,t,n){var s=_n.T;_n.T=null;var r=gi.p;try{gi.p=2,zL(i,e,t,n)}finally{gi.p=r,_n.T=s}}function Une(i,e,t,n){var s=_n.T;_n.T=null;var r=gi.p;try{gi.p=8,zL(i,e,t,n)}finally{gi.p=r,_n.T=s}}function zL(i,e,t,n){if(wM){var s=CD(n);if(s===null)SN(i,e,n,RM,t),u4(i,n);else if(Pne(s,i,e,t,n))n.stopPropagation();else if(u4(i,n),e&4&&-1<Ine.indexOf(i)){for(;s!==null;){var r=dx(s);if(r!==null)switch(r.tag){case 3:if(r=r.stateNode,r.current.memoizedState.isDehydrated){var a=Qp(r.pendingLanes);if(a!==0){var o=r;for(o.pendingLanes|=2,o.entangledLanes|=2;a;){var l=1<<31-qo(a);o.entanglements[1]|=l,a&=~l}vu(r),!(wi&6)&&(_M=Zc()+500,aS(0))}}break;case 13:o=fx(r,2),o!==null&&Yo(o,r,2),BE(),GL(r,2)}if(r=CD(n),r===null&&SN(i,e,n,RM,t),r===s)break;s=r}s!==null&&n.stopPropagation()}else SN(i,e,n,null,t)}}function CD(i){return i=nL(i),VL(i)}var RM=null;function VL(i){if(RM=null,i=q0(i),i!==null){var e=jb(i);if(e===null)i=null;else{var t=e.tag;if(t===13){if(i=Rk(e),i!==null)return i;i=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;i=null}else e!==i&&(i=null)}}return RM=i,null}function r9(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(vee()){case Lk:return 2;case Uk:return 8;case iM:case bee:return 32;case Ik:return 268435456;default:return 32}default:return 32}}var wD=!1,Qd=null,$d=null,ef=null,fb=new Map,pb=new Map,Rd=[],Ine="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function u4(i,e){switch(i){case"focusin":case"focusout":Qd=null;break;case"dragenter":case"dragleave":$d=null;break;case"mouseover":case"mouseout":ef=null;break;case"pointerover":case"pointerout":fb.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":pb.delete(e.pointerId)}}function T_(i,e,t,n,s,r){return i===null||i.nativeEvent!==r?(i={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:r,targetContainers:[s]},e!==null&&(e=dx(e),e!==null&&s9(e)),i):(i.eventSystemFlags|=n,e=i.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),i)}function Pne(i,e,t,n,s){switch(e){case"focusin":return Qd=T_(Qd,i,e,t,n,s),!0;case"dragenter":return $d=T_($d,i,e,t,n,s),!0;case"mouseover":return ef=T_(ef,i,e,t,n,s),!0;case"pointerover":var r=s.pointerId;return fb.set(r,T_(fb.get(r)||null,i,e,t,n,s)),!0;case"gotpointercapture":return r=s.pointerId,pb.set(r,T_(pb.get(r)||null,i,e,t,n,s)),!0}return!1}function a9(i){var e=q0(i.target);if(e!==null){var t=jb(e);if(t!==null){if(e=t.tag,e===13){if(e=Rk(t),e!==null){i.blockedOn=e,Ree(i.priority,function(){if(t.tag===13){var n=jo();n=Q3(n);var s=fx(t,n);s!==null&&Yo(s,t,n),GL(t,n)}});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){i.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}i.blockedOn=null}function zA(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var t=CD(i.nativeEvent);if(t===null){t=i.nativeEvent;var n=new t.constructor(t.type,t);XB=n,t.target.dispatchEvent(n),XB=null}else return e=dx(t),e!==null&&s9(e),i.blockedOn=t,!1;e.shift()}return!0}function h4(i,e,t){zA(i)&&t.delete(e)}function One(){wD=!1,Qd!==null&&zA(Qd)&&(Qd=null),$d!==null&&zA($d)&&($d=null),ef!==null&&zA(ef)&&(ef=null),fb.forEach(h4),pb.forEach(h4)}function s1(i,e){i.blockedOn===e&&(i.blockedOn=null,wD||(wD=!0,ur.unstable_scheduleCallback(ur.unstable_NormalPriority,One)))}var r1=null;function d4(i){r1!==i&&(r1=i,ur.unstable_scheduleCallback(ur.unstable_NormalPriority,function(){r1===i&&(r1=null);for(var e=0;e<i.length;e+=3){var t=i[e],n=i[e+1],s=i[e+2];if(typeof n!="function"){if(VL(n||t)===null)continue;break}var r=dx(t);r!==null&&(i.splice(e,3),e-=3,oD(r,{pending:!0,data:s,method:t.method,action:n},n,s))}}))}function mb(i){function e(l){return s1(l,i)}Qd!==null&&s1(Qd,i),$d!==null&&s1($d,i),ef!==null&&s1(ef,i),fb.forEach(e),pb.forEach(e);for(var t=0;t<Rd.length;t++){var n=Rd[t];n.blockedOn===i&&(n.blockedOn=null)}for(;0<Rd.length&&(t=Rd[0],t.blockedOn===null);)a9(t),t.blockedOn===null&&Rd.shift();if(t=(i.ownerDocument||i).$$reactFormReplay,t!=null)for(n=0;n<t.length;n+=3){var s=t[n],r=t[n+1],a=s[ho]||null;if(typeof r=="function")a||d4(t);else if(a){var o=null;if(r&&r.hasAttribute("formAction")){if(s=r,a=r[ho]||null)o=a.formAction;else if(VL(s)!==null)continue}else o=a.action;typeof o=="function"?t[n+1]=o:(t.splice(n,3),n-=3),d4(t)}}}function HL(i){this._internalRoot=i}IE.prototype.render=HL.prototype.render=function(i){var e=this._internalRoot;if(e===null)throw Error(nt(409));var t=e.current,n=jo();i9(t,n,i,e,null,null)};IE.prototype.unmount=HL.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var e=i.containerInfo;i9(i.current,2,null,i,null,null),BE(),e[hx]=null}};function IE(i){this._internalRoot=i}IE.prototype.unstable_scheduleHydration=function(i){if(i){var e=zk();i={blockedOn:null,target:i,priority:e};for(var t=0;t<Rd.length&&e!==0&&e<Rd[t].priority;t++);Rd.splice(t,0,i),t===0&&a9(i)}};var f4=Ck.version;if(f4!=="19.1.1")throw Error(nt(527,f4,"19.1.1"));gi.findDOMNode=function(i){var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(nt(188)):(i=Object.keys(i).join(","),Error(nt(268,i)));return i=fee(e),i=i!==null?Nk(i):null,i=i===null?null:i.stateNode,i};var Fne={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:_n,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var a1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!a1.isDisabled&&a1.supportsFiber)try{Yb=a1.inject(Fne),Xo=a1}catch{}}_E.createRoot=function(i,e){if(!wk(i))throw Error(nt(299));var t=!1,n="",s=t8,r=n8,a=i8,o=null;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onUncaughtError!==void 0&&(s=e.onUncaughtError),e.onCaughtError!==void 0&&(r=e.onCaughtError),e.onRecoverableError!==void 0&&(a=e.onRecoverableError),e.unstable_transitionCallbacks!==void 0&&(o=e.unstable_transitionCallbacks)),e=t9(i,1,!1,null,null,t,n,s,r,a,o,null),i[hx]=e.current,PL(i),new HL(e)};_E.hydrateRoot=function(i,e,t){if(!wk(i))throw Error(nt(299));var n=!1,s="",r=t8,a=n8,o=i8,l=null,c=null;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onUncaughtError!==void 0&&(r=t.onUncaughtError),t.onCaughtError!==void 0&&(a=t.onCaughtError),t.onRecoverableError!==void 0&&(o=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(l=t.unstable_transitionCallbacks),t.formState!==void 0&&(c=t.formState)),e=t9(i,1,!0,e,t??null,n,s,r,a,o,l,c),e.context=n9(null),t=e.current,n=jo(),n=Q3(n),s=Yd(n),s.callback=null,Kd(t,s,n),t=n,e.current.lanes=t,Zb(e,t),vu(e),i[hx]=e.current,PL(i),new IE(e)};_E.version="19.1.1";function o9(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o9)}catch(i){console.error(i)}}o9(),pk.exports=_E;var l9=pk.exports;/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const bu="182",Td={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Ad={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},PE=0,gb=1,OE=2,c9=3,FE=0,tf=1,gy=2,Dl=3,jr=0,hi=1,Ps=2,Nr=0,qa=1,hf=2,df=3,Ch=4,nf=5,Mr=100,cS=101,uS=102,GE=103,zE=104,dc=200,hS=201,dS=202,fS=203,Pm=204,Om=205,pS=206,mS=207,gS=208,yS=209,xS=210,kL=211,WL=212,XL=213,qL=214,Fm=0,Gm=1,zm=2,uu=3,Vm=4,Hm=5,km=6,Wm=7,fg=0,VE=1,HE=2,Ki=0,yx=1,xx=2,_x=3,pg=4,kE=5,vx=6,bx=7,NM="attached",jL="detached",hu=300,Sa=301,el=302,_c=303,wh=304,du=306,Zr=1e3,ui=1001,vc=1002,$n=1003,mg=1004,u9=1004,Ho=1005,h9=1005,Jt=1006,Qc=1007,d9=1007,$s=1008,yb=1008,ei=1009,$c=1010,eu=1011,ko=1012,Is=1013,Jn=1014,Rn=1015,ln=1016,Sx=1017,Tx=1018,ja=1020,Ax=35902,Mx=35899,_S=1021,gg=1022,ii=1023,lr=1026,kr=1027,ql=1028,Oh=1029,Wr=1030,Yf=1031,YL=1032,Kf=1033,tu=33776,nu=33777,iu=33778,su=33779,Xm=35840,qm=35841,jm=35842,Ym=35843,ff=36196,pf=37492,mf=37496,gf=37488,yf=37489,Rh=37490,xf=37491,_f=37808,vf=37809,bf=37810,Sf=37811,Tf=37812,Af=37813,Mf=37814,Ef=37815,Cf=37816,wf=37817,Rf=37818,Nf=37819,Bf=37820,Df=37821,Lf=36492,xb=36494,_b=36495,Uf=36283,If=36284,Nh=36285,Pf=36286,KL=2200,ZL=2201,JL=2202,Km=2300,Zm=2301,Uv=2302,Fd=2400,Gd=2401,Wy=2402,vS=2500,WE=2501,QL=0,XE=1,vb=2,$L=3200,f9=3201,p9=3202,m9=3203,Vl=0,qE=1,ha="",Js="srgb",Jr="srgb-linear",Of="linear",Ft="srgb",Iv="",jE="rg",eU="ga",tU=0,Zu=7680,nU=7681,iU=7682,sU=7683,rU=34055,aU=34056,oU=5386,lU=512,cU=513,uU=514,hU=515,dU=516,fU=517,pU=518,bb=519,bS=512,yg=513,SS=514,xg=515,TS=516,AS=517,_g=518,MS=519,Bh=35044,hh=35048,g9=35040,y9=35045,x9=35049,_9=35041,v9=35046,b9=35050,S9=35042,T9="100",BM="300 es",Cr=2e3,Ka=2001,ga={COMPUTE:"compute",RENDER:"render"},A9={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},M9={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};function mU(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}const Gne={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function ny(i,e){return new Gne[i](e)}function Xy(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function Sb(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function YE(){const i=Sb("canvas");return i.style.display="block",i}const p4={};let Ff=null;function gU(i){Ff=i}function E9(){return Ff}function Jm(...i){const e="THREE."+i.shift();Ff?Ff("log",e,...i):console.log(e,...i)}function Se(...i){const e="THREE."+i.shift();Ff?Ff("warn",e,...i):console.warn(e,...i)}function De(...i){const e="THREE."+i.shift();Ff?Ff("error",e,...i):console.error(e,...i)}function oi(...i){const e=i.join(" ");e in p4||(p4[e]=!0,Se(...i))}function zne(i,e,t){return new Promise(function(n,s){function r(){switch(i.clientWaitSync(e,i.SYNC_FLUSH_COMMANDS_BIT,0)){case i.WAIT_FAILED:s();break;case i.TIMEOUT_EXPIRED:setTimeout(r,t);break;default:n()}}setTimeout(r,t)})}let Ta=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const s=n[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const s=n.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,e);e.target=null}}};const la=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let m4=1234567;const Am=Math.PI/180,Qm=180/Math.PI;function Ko(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(la[i&255]+la[i>>8&255]+la[i>>16&255]+la[i>>24&255]+"-"+la[e&255]+la[e>>8&255]+"-"+la[e>>16&15|64]+la[e>>24&255]+"-"+la[t&63|128]+la[t>>8&255]+"-"+la[t>>16&255]+la[t>>24&255]+la[n&255]+la[n>>8&255]+la[n>>16&255]+la[n>>24&255]).toLowerCase()}function yn(i,e,t){return Math.max(e,Math.min(t,i))}function yU(i,e){return(i%e+e)%e}function Vne(i,e,t,n,s){return n+(i-e)*(s-n)/(t-e)}function Hne(i,e,t){return i!==e?(t-i)/(e-i):0}function Pv(i,e,t){return(1-t)*i+t*e}function kne(i,e,t,n){return Pv(i,e,1-Math.exp(-t*n))}function Wne(i,e=1){return e-Math.abs(yU(i,e*2)-e)}function Xne(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function qne(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function jne(i,e){return i+Math.floor(Math.random()*(e-i+1))}function Yne(i,e){return i+Math.random()*(e-i)}function Kne(i){return i*(.5-Math.random())}function Zne(i){i!==void 0&&(m4=i);let e=m4+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Jne(i){return i*Am}function Qne(i){return i*Qm}function $ne(i){return(i&i-1)===0&&i!==0}function eie(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function tie(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function nie(i,e,t,n,s){const r=Math.cos,a=Math.sin,o=r(t/2),l=a(t/2),c=r((e+n)/2),u=a((e+n)/2),h=r((e-n)/2),f=a((e-n)/2),m=r((n-e)/2),g=a((n-e)/2);switch(s){case"XYX":i.set(o*u,l*h,l*f,o*c);break;case"YZY":i.set(l*f,o*u,l*h,o*c);break;case"ZXZ":i.set(l*h,l*f,o*u,o*c);break;case"XZX":i.set(o*u,l*g,l*m,o*c);break;case"YXY":i.set(l*m,o*u,l*g,o*c);break;case"ZYZ":i.set(l*g,l*m,o*u,o*c);break;default:Se("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Fa(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Mn(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const Fh={DEG2RAD:Am,RAD2DEG:Qm,generateUUID:Ko,clamp:yn,euclideanModulo:yU,mapLinear:Vne,inverseLerp:Hne,lerp:Pv,damp:kne,pingpong:Wne,smoothstep:Xne,smootherstep:qne,randInt:jne,randFloat:Yne,randFloatSpread:Kne,seededRandom:Zne,degToRad:Jne,radToDeg:Qne,isPowerOfTwo:$ne,ceilPowerOfTwo:eie,floorPowerOfTwo:tie,setQuaternionFromProperEuler:nie,normalize:Mn,denormalize:Fa};class Ae{constructor(e=0,t=0){Ae.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6],this.y=s[1]*t+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=yn(this.x,e.x,t.x),this.y=yn(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=yn(this.x,e,t),this.y=yn(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(yn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(yn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),s=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*s+e.x,this.y=r*s+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Fs{constructor(e=0,t=0,n=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=s}static slerpFlat(e,t,n,s,r,a,o){let l=n[s+0],c=n[s+1],u=n[s+2],h=n[s+3],f=r[a+0],m=r[a+1],g=r[a+2],x=r[a+3];if(o<=0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h;return}if(o>=1){e[t+0]=f,e[t+1]=m,e[t+2]=g,e[t+3]=x;return}if(h!==x||l!==f||c!==m||u!==g){let v=l*f+c*m+u*g+h*x;v<0&&(f=-f,m=-m,g=-g,x=-x,v=-v);let y=1-o;if(v<.9995){const b=Math.acos(v),S=Math.sin(b);y=Math.sin(y*b)/S,o=Math.sin(o*b)/S,l=l*y+f*o,c=c*y+m*o,u=u*y+g*o,h=h*y+x*o}else{l=l*y+f*o,c=c*y+m*o,u=u*y+g*o,h=h*y+x*o;const b=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=b,c*=b,u*=b,h*=b}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,s,r,a){const o=n[s],l=n[s+1],c=n[s+2],u=n[s+3],h=r[a],f=r[a+1],m=r[a+2],g=r[a+3];return e[t]=o*g+u*h+l*m-c*f,e[t+1]=l*g+u*f+c*h-o*m,e[t+2]=c*g+u*m+o*f-l*h,e[t+3]=u*g-o*h-l*f-c*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,s){return this._x=e,this._y=t,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,s=e._y,r=e._z,a=e._order,o=Math.cos,l=Math.sin,c=o(n/2),u=o(s/2),h=o(r/2),f=l(n/2),m=l(s/2),g=l(r/2);switch(a){case"XYZ":this._x=f*u*h+c*m*g,this._y=c*m*h-f*u*g,this._z=c*u*g+f*m*h,this._w=c*u*h-f*m*g;break;case"YXZ":this._x=f*u*h+c*m*g,this._y=c*m*h-f*u*g,this._z=c*u*g-f*m*h,this._w=c*u*h+f*m*g;break;case"ZXY":this._x=f*u*h-c*m*g,this._y=c*m*h+f*u*g,this._z=c*u*g+f*m*h,this._w=c*u*h-f*m*g;break;case"ZYX":this._x=f*u*h-c*m*g,this._y=c*m*h+f*u*g,this._z=c*u*g-f*m*h,this._w=c*u*h+f*m*g;break;case"YZX":this._x=f*u*h+c*m*g,this._y=c*m*h+f*u*g,this._z=c*u*g-f*m*h,this._w=c*u*h-f*m*g;break;case"XZY":this._x=f*u*h-c*m*g,this._y=c*m*h-f*u*g,this._z=c*u*g+f*m*h,this._w=c*u*h+f*m*g;break;default:Se("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],s=t[4],r=t[8],a=t[1],o=t[5],l=t[9],c=t[2],u=t[6],h=t[10],f=n+o+h;if(f>0){const m=.5/Math.sqrt(f+1);this._w=.25/m,this._x=(u-l)*m,this._y=(r-c)*m,this._z=(a-s)*m}else if(n>o&&n>h){const m=2*Math.sqrt(1+n-o-h);this._w=(u-l)/m,this._x=.25*m,this._y=(s+a)/m,this._z=(r+c)/m}else if(o>h){const m=2*Math.sqrt(1+o-n-h);this._w=(r-c)/m,this._x=(s+a)/m,this._y=.25*m,this._z=(l+u)/m}else{const m=2*Math.sqrt(1+h-n-o);this._w=(a-s)/m,this._x=(r+c)/m,this._y=(l+u)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(yn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const s=Math.min(1,t/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,s=e._y,r=e._z,a=e._w,o=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+a*o+s*c-r*l,this._y=s*u+a*l+r*o-n*c,this._z=r*u+a*c+n*l-s*o,this._w=a*u-n*o-s*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let n=e._x,s=e._y,r=e._z,a=e._w,o=this.dot(e);o<0&&(n=-n,s=-s,r=-r,a=-a,o=-o);let l=1-t;if(o<.9995){const c=Math.acos(o),u=Math.sin(c);l=Math.sin(l*c)/u,t=Math.sin(t*c)/u,this._x=this._x*l+n*t,this._y=this._y*l+s*t,this._z=this._z*l+r*t,this._w=this._w*l+a*t,this._onChangeCallback()}else this._x=this._x*l+n*t,this._y=this._y*l+s*t,this._z=this._z*l+r*t,this._w=this._w*l+a*t,this.normalize();return this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),s=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(s*Math.sin(e),s*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class z{constructor(e=0,t=0,n=0){z.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(g4.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(g4.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*s,this.y=r[1]*t+r[4]*n+r[7]*s,this.z=r[2]*t+r[5]*n+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*s+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*s+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*s+r[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,s=this.z,r=e.x,a=e.y,o=e.z,l=e.w,c=2*(a*s-o*n),u=2*(o*t-r*s),h=2*(r*n-a*t);return this.x=t+l*c+a*h-o*u,this.y=n+l*u+o*c-r*h,this.z=s+l*h+r*u-a*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*s,this.y=r[1]*t+r[5]*n+r[9]*s,this.z=r[2]*t+r[6]*n+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=yn(this.x,e.x,t.x),this.y=yn(this.y,e.y,t.y),this.z=yn(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=yn(this.x,e,t),this.y=yn(this.y,e,t),this.z=yn(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(yn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,s=e.y,r=e.z,a=t.x,o=t.y,l=t.z;return this.x=s*l-r*o,this.y=r*a-n*l,this.z=n*o-s*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return AN.copy(this).projectOnVector(e),this.sub(AN)}reflect(e){return this.sub(AN.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(yn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return t*t+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const s=Math.sin(t)*e;return this.x=s*Math.sin(n),this.y=Math.cos(t)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const AN=new z,g4=new Fs;class gn{constructor(e,t,n,s,r,a,o,l,c){gn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,s,r,a,o,l,c)}set(e,t,n,s,r,a,o,l,c){const u=this.elements;return u[0]=e,u[1]=s,u[2]=o,u[3]=t,u[4]=r,u[5]=l,u[6]=n,u[7]=a,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,a=n[0],o=n[3],l=n[6],c=n[1],u=n[4],h=n[7],f=n[2],m=n[5],g=n[8],x=s[0],v=s[3],y=s[6],b=s[1],S=s[4],T=s[7],M=s[2],C=s[5],w=s[8];return r[0]=a*x+o*b+l*M,r[3]=a*v+o*S+l*C,r[6]=a*y+o*T+l*w,r[1]=c*x+u*b+h*M,r[4]=c*v+u*S+h*C,r[7]=c*y+u*T+h*w,r[2]=f*x+m*b+g*M,r[5]=f*v+m*S+g*C,r[8]=f*y+m*T+g*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8];return t*a*u-t*o*c-n*r*u+n*o*l+s*r*c-s*a*l}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=u*a-o*c,f=o*l-u*r,m=c*r-a*l,g=t*h+n*f+s*m;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const x=1/g;return e[0]=h*x,e[1]=(s*c-u*n)*x,e[2]=(o*n-s*a)*x,e[3]=f*x,e[4]=(u*t-s*l)*x,e[5]=(s*r-o*t)*x,e[6]=m*x,e[7]=(n*l-c*t)*x,e[8]=(a*t-n*r)*x,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,s,r,a,o){const l=Math.cos(r),c=Math.sin(r);return this.set(n*l,n*c,-n*(l*a+c*o)+a+e,-s*c,s*l,-s*(-c*a+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(MN.makeScale(e,t)),this}rotate(e){return this.premultiply(MN.makeRotation(-e)),this}translate(e,t){return this.premultiply(MN.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<9;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const MN=new gn,y4=new gn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),x4=new gn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function iie(){const i={enabled:!0,workingColorSpace:Jr,spaces:{},convert:function(s,r,a){return this.enabled===!1||r===a||!r||!a||(this.spaces[r].transfer===Ft&&(s.r=yh(s.r),s.g=yh(s.g),s.b=yh(s.b)),this.spaces[r].primaries!==this.spaces[a].primaries&&(s.applyMatrix3(this.spaces[r].toXYZ),s.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Ft&&(s.r=yy(s.r),s.g=yy(s.g),s.b=yy(s.b))),s},workingToColorSpace:function(s,r){return this.convert(s,this.workingColorSpace,r)},colorSpaceToWorking:function(s,r){return this.convert(s,r,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===ha?Of:this.spaces[s].transfer},getToneMappingMode:function(s){return this.spaces[s].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(s,r=this.workingColorSpace){return s.fromArray(this.spaces[r].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,r,a){return s.copy(this.spaces[r].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(s,r){return oi("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),i.workingToColorSpace(s,r)},toWorkingColorSpace:function(s,r){return oi("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),i.colorSpaceToWorking(s,r)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return i.define({[Jr]:{primaries:e,whitePoint:n,transfer:Of,toXYZ:y4,fromXYZ:x4,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Js},outputColorSpaceConfig:{drawingBufferColorSpace:Js}},[Js]:{primaries:e,whitePoint:n,transfer:Ft,toXYZ:y4,fromXYZ:x4,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Js}}}),i}const en=iie();function yh(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function yy(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let r0;class xU{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{r0===void 0&&(r0=Sb("canvas")),r0.width=e.width,r0.height=e.height;const s=r0.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),n=r0}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Sb("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),r=s.data;for(let a=0;a<r.length;a++)r[a]=yh(r[a]/255)*255;return n.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(yh(t[n]/255)*255):t[n]=yh(t[n]);return{data:t,width:e.width,height:e.height}}else return Se("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let sie=0;class dh{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:sie++}),this.uuid=Ko(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):typeof VideoFrame<"u"&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let a=0,o=s.length;a<o;a++)s[a].isDataTexture?r.push(EN(s[a].image)):r.push(EN(s[a]))}else r=EN(s);n.url=r}return t||(e.images[this.uuid]=n),n}}function EN(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?xU.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(Se("Texture: Unable to serialize Texture."),{})}let rie=0;const CN=new z;class In extends Ta{constructor(e=In.DEFAULT_IMAGE,t=In.DEFAULT_MAPPING,n=ui,s=ui,r=Jt,a=$s,o=ii,l=ei,c=In.DEFAULT_ANISOTROPY,u=ha){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:rie++}),this.uuid=Ko(),this.name="",this.source=new dh(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=r,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new Ae(0,0),this.repeat=new Ae(1,1),this.center=new Ae(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new gn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(CN).x}get height(){return this.source.getSize(CN).y}get depth(){return this.source.getSize(CN).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){Se(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){Se(`Texture.setValues(): property '${t}' does not exist.`);continue}s&&n&&s.isVector2&&n.isVector2||s&&n&&s.isVector3&&n.isVector3||s&&n&&s.isMatrix3&&n.isMatrix3?s.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==hu)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Zr:e.x=e.x-Math.floor(e.x);break;case ui:e.x=e.x<0?0:1;break;case vc:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Zr:e.y=e.y-Math.floor(e.y);break;case ui:e.y=e.y<0?0:1;break;case vc:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}In.DEFAULT_IMAGE=null;In.DEFAULT_MAPPING=hu;In.DEFAULT_ANISOTROPY=1;class un{constructor(e=0,t=0,n=0,s=1){un.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*s+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*s+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*s+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*s+a[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,s,r;const l=e.elements,c=l[0],u=l[4],h=l[8],f=l[1],m=l[5],g=l[9],x=l[2],v=l[6],y=l[10];if(Math.abs(u-f)<.01&&Math.abs(h-x)<.01&&Math.abs(g-v)<.01){if(Math.abs(u+f)<.1&&Math.abs(h+x)<.1&&Math.abs(g+v)<.1&&Math.abs(c+m+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const S=(c+1)/2,T=(m+1)/2,M=(y+1)/2,C=(u+f)/4,w=(h+x)/4,N=(g+v)/4;return S>T&&S>M?S<.01?(n=0,s=.707106781,r=.707106781):(n=Math.sqrt(S),s=C/n,r=w/n):T>M?T<.01?(n=.707106781,s=0,r=.707106781):(s=Math.sqrt(T),n=C/s,r=N/s):M<.01?(n=.707106781,s=.707106781,r=0):(r=Math.sqrt(M),n=w/r,s=N/r),this.set(n,s,r,t),this}let b=Math.sqrt((v-g)*(v-g)+(h-x)*(h-x)+(f-u)*(f-u));return Math.abs(b)<.001&&(b=1),this.x=(v-g)/b,this.y=(h-x)/b,this.z=(f-u)/b,this.w=Math.acos((c+m+y-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=yn(this.x,e.x,t.x),this.y=yn(this.y,e.y,t.y),this.z=yn(this.z,e.z,t.z),this.w=yn(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=yn(this.x,e,t),this.y=yn(this.y,e,t),this.z=yn(this.z,e,t),this.w=yn(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(yn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Si extends Ta{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Jt,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new un(0,0,e,t),this.scissorTest=!1,this.viewport=new un(0,0,e,t);const s={width:e,height:t,depth:n.depth},r=new In(s);this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=r.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:Jt,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let s=0,r=this.textures.length;s<r;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=n,this.textures[s].isData3DTexture!==!0&&(this.textures[s].isArrayTexture=this.textures[s].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const s=Object.assign({},e.textures[t].image);this.textures[t].source=new dh(s)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class xa extends Si{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Ex extends In{constructor(e=null,t=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=$n,this.minFilter=$n,this.wrapR=ui,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class C9 extends xa{constructor(e=1,t=1,n=1,s={}){super(e,t,s),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Ex(null,e,t,n),this._setTextureOptions(s),this.texture.isRenderTargetTexture=!0}}class ES extends In{constructor(e=null,t=1,n=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=$n,this.minFilter=$n,this.wrapR=ui,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class w9 extends xa{constructor(e=1,t=1,n=1,s={}){super(e,t,s),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new ES(null,e,t,n),this._setTextureOptions(s),this.texture.isRenderTargetTexture=!0}}class Br{constructor(e=new z(1/0,1/0,1/0),t=new z(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(ic.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(ic.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ic.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const r=n.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=r.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,ic):ic.fromBufferAttribute(r,a),ic.applyMatrix4(e.matrixWorld),this.expandByPoint(ic);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),o1.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),o1.copy(n.boundingBox)),o1.applyMatrix4(e.matrixWorld),this.union(o1)}const s=e.children;for(let r=0,a=s.length;r<a;r++)this.expandByObject(s[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,ic),ic.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(A_),l1.subVectors(this.max,A_),a0.subVectors(e.a,A_),o0.subVectors(e.b,A_),l0.subVectors(e.c,A_),ld.subVectors(o0,a0),cd.subVectors(l0,o0),Rp.subVectors(a0,l0);let t=[0,-ld.z,ld.y,0,-cd.z,cd.y,0,-Rp.z,Rp.y,ld.z,0,-ld.x,cd.z,0,-cd.x,Rp.z,0,-Rp.x,-ld.y,ld.x,0,-cd.y,cd.x,0,-Rp.y,Rp.x,0];return!wN(t,a0,o0,l0,l1)||(t=[1,0,0,0,1,0,0,0,1],!wN(t,a0,o0,l0,l1))?!1:(c1.crossVectors(ld,cd),t=[c1.x,c1.y,c1.z],wN(t,a0,o0,l0,l1))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ic).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(ic).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Gu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Gu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Gu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Gu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Gu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Gu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Gu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Gu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Gu),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Gu=[new z,new z,new z,new z,new z,new z,new z,new z],ic=new z,o1=new Br,a0=new z,o0=new z,l0=new z,ld=new z,cd=new z,Rp=new z,A_=new z,l1=new z,c1=new z,Np=new z;function wN(i,e,t,n,s){for(let r=0,a=i.length-3;r<=a;r+=3){Np.fromArray(i,r);const o=s.x*Math.abs(Np.x)+s.y*Math.abs(Np.y)+s.z*Math.abs(Np.z),l=e.dot(Np),c=t.dot(Np),u=n.dot(Np);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}const aie=new Br,M_=new z,RN=new z;class Gs{constructor(e=new z,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):aie.setFromPoints(e).getCenter(n);let s=0;for(let r=0,a=e.length;r<a;r++)s=Math.max(s,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;M_.subVectors(e,this.center);const t=M_.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),s=(n-this.radius)*.5;this.center.addScaledVector(M_,s/n),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(RN.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(M_.copy(e.center).add(RN)),this.expandByPoint(M_.copy(e.center).sub(RN))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const zu=new z,NN=new z,u1=new z,ud=new z,BN=new z,h1=new z,DN=new z;class Zf{constructor(e=new z,t=new z(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,zu)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=zu.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(zu.copy(this.origin).addScaledVector(this.direction,t),zu.distanceToSquared(e))}distanceSqToSegment(e,t,n,s){NN.copy(e).add(t).multiplyScalar(.5),u1.copy(t).sub(e).normalize(),ud.copy(this.origin).sub(NN);const r=e.distanceTo(t)*.5,a=-this.direction.dot(u1),o=ud.dot(this.direction),l=-ud.dot(u1),c=ud.lengthSq(),u=Math.abs(1-a*a);let h,f,m,g;if(u>0)if(h=a*l-o,f=a*o-l,g=r*u,h>=0)if(f>=-g)if(f<=g){const x=1/u;h*=x,f*=x,m=h*(h+a*f+2*o)+f*(a*h+f+2*l)+c}else f=r,h=Math.max(0,-(a*f+o)),m=-h*h+f*(f+2*l)+c;else f=-r,h=Math.max(0,-(a*f+o)),m=-h*h+f*(f+2*l)+c;else f<=-g?(h=Math.max(0,-(-a*r+o)),f=h>0?-r:Math.min(Math.max(-r,-l),r),m=-h*h+f*(f+2*l)+c):f<=g?(h=0,f=Math.min(Math.max(-r,-l),r),m=f*(f+2*l)+c):(h=Math.max(0,-(a*r+o)),f=h>0?r:Math.min(Math.max(-r,-l),r),m=-h*h+f*(f+2*l)+c);else f=a>0?-r:r,h=Math.max(0,-(a*f+o)),m=-h*h+f*(f+2*l)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,h),s&&s.copy(NN).addScaledVector(u1,f),m}intersectSphere(e,t){zu.subVectors(e.center,this.origin);const n=zu.dot(this.direction),s=zu.dot(zu)-n*n,r=e.radius*e.radius;if(s>r)return null;const a=Math.sqrt(r-s),o=n-a,l=n+a;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,s,r,a,o,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,f=this.origin;return c>=0?(n=(e.min.x-f.x)*c,s=(e.max.x-f.x)*c):(n=(e.max.x-f.x)*c,s=(e.min.x-f.x)*c),u>=0?(r=(e.min.y-f.y)*u,a=(e.max.y-f.y)*u):(r=(e.max.y-f.y)*u,a=(e.min.y-f.y)*u),n>a||r>s||((r>n||isNaN(n))&&(n=r),(a<s||isNaN(s))&&(s=a),h>=0?(o=(e.min.z-f.z)*h,l=(e.max.z-f.z)*h):(o=(e.max.z-f.z)*h,l=(e.min.z-f.z)*h),n>l||o>s)||((o>n||n!==n)&&(n=o),(l<s||s!==s)&&(s=l),s<0)?null:this.at(n>=0?n:s,t)}intersectsBox(e){return this.intersectBox(e,zu)!==null}intersectTriangle(e,t,n,s,r){BN.subVectors(t,e),h1.subVectors(n,e),DN.crossVectors(BN,h1);let a=this.direction.dot(DN),o;if(a>0){if(s)return null;o=1}else if(a<0)o=-1,a=-a;else return null;ud.subVectors(this.origin,e);const l=o*this.direction.dot(h1.crossVectors(ud,h1));if(l<0)return null;const c=o*this.direction.dot(BN.cross(ud));if(c<0||l+c>a)return null;const u=-o*ud.dot(DN);return u<0?null:this.at(u/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Lt{constructor(e,t,n,s,r,a,o,l,c,u,h,f,m,g,x,v){Lt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,s,r,a,o,l,c,u,h,f,m,g,x,v)}set(e,t,n,s,r,a,o,l,c,u,h,f,m,g,x,v){const y=this.elements;return y[0]=e,y[4]=t,y[8]=n,y[12]=s,y[1]=r,y[5]=a,y[9]=o,y[13]=l,y[2]=c,y[6]=u,y[10]=h,y[14]=f,y[3]=m,y[7]=g,y[11]=x,y[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Lt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return this.determinant()===0?(e.set(1,0,0),t.set(0,1,0),n.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this)}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const t=this.elements,n=e.elements,s=1/c0.setFromMatrixColumn(e,0).length(),r=1/c0.setFromMatrixColumn(e,1).length(),a=1/c0.setFromMatrixColumn(e,2).length();return t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,s=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),l=Math.cos(s),c=Math.sin(s),u=Math.cos(r),h=Math.sin(r);if(e.order==="XYZ"){const f=a*u,m=a*h,g=o*u,x=o*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=m+g*c,t[5]=f-x*c,t[9]=-o*l,t[2]=x-f*c,t[6]=g+m*c,t[10]=a*l}else if(e.order==="YXZ"){const f=l*u,m=l*h,g=c*u,x=c*h;t[0]=f+x*o,t[4]=g*o-m,t[8]=a*c,t[1]=a*h,t[5]=a*u,t[9]=-o,t[2]=m*o-g,t[6]=x+f*o,t[10]=a*l}else if(e.order==="ZXY"){const f=l*u,m=l*h,g=c*u,x=c*h;t[0]=f-x*o,t[4]=-a*h,t[8]=g+m*o,t[1]=m+g*o,t[5]=a*u,t[9]=x-f*o,t[2]=-a*c,t[6]=o,t[10]=a*l}else if(e.order==="ZYX"){const f=a*u,m=a*h,g=o*u,x=o*h;t[0]=l*u,t[4]=g*c-m,t[8]=f*c+x,t[1]=l*h,t[5]=x*c+f,t[9]=m*c-g,t[2]=-c,t[6]=o*l,t[10]=a*l}else if(e.order==="YZX"){const f=a*l,m=a*c,g=o*l,x=o*c;t[0]=l*u,t[4]=x-f*h,t[8]=g*h+m,t[1]=h,t[5]=a*u,t[9]=-o*u,t[2]=-c*u,t[6]=m*h+g,t[10]=f-x*h}else if(e.order==="XZY"){const f=a*l,m=a*c,g=o*l,x=o*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=f*h+x,t[5]=a*u,t[9]=m*h-g,t[2]=g*h-m,t[6]=o*u,t[10]=x*h+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(oie,e,lie)}lookAt(e,t,n){const s=this.elements;return No.subVectors(e,t),No.lengthSq()===0&&(No.z=1),No.normalize(),hd.crossVectors(n,No),hd.lengthSq()===0&&(Math.abs(n.z)===1?No.x+=1e-4:No.z+=1e-4,No.normalize(),hd.crossVectors(n,No)),hd.normalize(),d1.crossVectors(No,hd),s[0]=hd.x,s[4]=d1.x,s[8]=No.x,s[1]=hd.y,s[5]=d1.y,s[9]=No.y,s[2]=hd.z,s[6]=d1.z,s[10]=No.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,a=n[0],o=n[4],l=n[8],c=n[12],u=n[1],h=n[5],f=n[9],m=n[13],g=n[2],x=n[6],v=n[10],y=n[14],b=n[3],S=n[7],T=n[11],M=n[15],C=s[0],w=s[4],N=s[8],E=s[12],B=s[1],U=s[5],H=s[9],F=s[13],V=s[2],Y=s[6],P=s[10],X=s[14],J=s[3],re=s[7],ne=s[11],ge=s[15];return r[0]=a*C+o*B+l*V+c*J,r[4]=a*w+o*U+l*Y+c*re,r[8]=a*N+o*H+l*P+c*ne,r[12]=a*E+o*F+l*X+c*ge,r[1]=u*C+h*B+f*V+m*J,r[5]=u*w+h*U+f*Y+m*re,r[9]=u*N+h*H+f*P+m*ne,r[13]=u*E+h*F+f*X+m*ge,r[2]=g*C+x*B+v*V+y*J,r[6]=g*w+x*U+v*Y+y*re,r[10]=g*N+x*H+v*P+y*ne,r[14]=g*E+x*F+v*X+y*ge,r[3]=b*C+S*B+T*V+M*J,r[7]=b*w+S*U+T*Y+M*re,r[11]=b*N+S*H+T*P+M*ne,r[15]=b*E+S*F+T*X+M*ge,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],s=e[8],r=e[12],a=e[1],o=e[5],l=e[9],c=e[13],u=e[2],h=e[6],f=e[10],m=e[14],g=e[3],x=e[7],v=e[11],y=e[15],b=l*m-c*f,S=o*m-c*h,T=o*f-l*h,M=a*m-c*u,C=a*f-l*u,w=a*h-o*u;return t*(x*b-v*S+y*T)-n*(g*b-v*M+y*C)+s*(g*S-x*M+y*w)-r*(g*T-x*C+v*w)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],m=e[11],g=e[12],x=e[13],v=e[14],y=e[15],b=h*v*c-x*f*c+x*l*m-o*v*m-h*l*y+o*f*y,S=g*f*c-u*v*c-g*l*m+a*v*m+u*l*y-a*f*y,T=u*x*c-g*h*c+g*o*m-a*x*m-u*o*y+a*h*y,M=g*h*l-u*x*l-g*o*f+a*x*f+u*o*v-a*h*v,C=t*b+n*S+s*T+r*M;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/C;return e[0]=b*w,e[1]=(x*f*r-h*v*r-x*s*m+n*v*m+h*s*y-n*f*y)*w,e[2]=(o*v*r-x*l*r+x*s*c-n*v*c-o*s*y+n*l*y)*w,e[3]=(h*l*r-o*f*r-h*s*c+n*f*c+o*s*m-n*l*m)*w,e[4]=S*w,e[5]=(u*v*r-g*f*r+g*s*m-t*v*m-u*s*y+t*f*y)*w,e[6]=(g*l*r-a*v*r-g*s*c+t*v*c+a*s*y-t*l*y)*w,e[7]=(a*f*r-u*l*r+u*s*c-t*f*c-a*s*m+t*l*m)*w,e[8]=T*w,e[9]=(g*h*r-u*x*r-g*n*m+t*x*m+u*n*y-t*h*y)*w,e[10]=(a*x*r-g*o*r+g*n*c-t*x*c-a*n*y+t*o*y)*w,e[11]=(u*o*r-a*h*r-u*n*c+t*h*c+a*n*m-t*o*m)*w,e[12]=M*w,e[13]=(u*x*s-g*h*s+g*n*f-t*x*f-u*n*v+t*h*v)*w,e[14]=(g*o*s-a*x*s-g*n*l+t*x*l+a*n*v-t*o*v)*w,e[15]=(a*h*s-u*o*s+u*n*l-t*h*l-a*n*f+t*o*f)*w,this}scale(e){const t=this.elements,n=e.x,s=e.y,r=e.z;return t[0]*=n,t[4]*=s,t[8]*=r,t[1]*=n,t[5]*=s,t[9]*=r,t[2]*=n,t[6]*=s,t[10]*=r,t[3]*=n,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,s))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),s=Math.sin(t),r=1-n,a=e.x,o=e.y,l=e.z,c=r*a,u=r*o;return this.set(c*a+n,c*o-s*l,c*l+s*o,0,c*o+s*l,u*o+n,u*l-s*a,0,c*l-s*o,u*l+s*a,r*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,s,r,a){return this.set(1,n,r,0,e,1,a,0,t,s,1,0,0,0,0,1),this}compose(e,t,n){const s=this.elements,r=t._x,a=t._y,o=t._z,l=t._w,c=r+r,u=a+a,h=o+o,f=r*c,m=r*u,g=r*h,x=a*u,v=a*h,y=o*h,b=l*c,S=l*u,T=l*h,M=n.x,C=n.y,w=n.z;return s[0]=(1-(x+y))*M,s[1]=(m+T)*M,s[2]=(g-S)*M,s[3]=0,s[4]=(m-T)*C,s[5]=(1-(f+y))*C,s[6]=(v+b)*C,s[7]=0,s[8]=(g+S)*w,s[9]=(v-b)*w,s[10]=(1-(f+x))*w,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,n){const s=this.elements;if(e.x=s[12],e.y=s[13],e.z=s[14],this.determinant()===0)return n.set(1,1,1),t.identity(),this;let r=c0.set(s[0],s[1],s[2]).length();const a=c0.set(s[4],s[5],s[6]).length(),o=c0.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),sc.copy(this);const c=1/r,u=1/a,h=1/o;return sc.elements[0]*=c,sc.elements[1]*=c,sc.elements[2]*=c,sc.elements[4]*=u,sc.elements[5]*=u,sc.elements[6]*=u,sc.elements[8]*=h,sc.elements[9]*=h,sc.elements[10]*=h,t.setFromRotationMatrix(sc),n.x=r,n.y=a,n.z=o,this}makePerspective(e,t,n,s,r,a,o=Cr,l=!1){const c=this.elements,u=2*r/(t-e),h=2*r/(n-s),f=(t+e)/(t-e),m=(n+s)/(n-s);let g,x;if(l)g=r/(a-r),x=a*r/(a-r);else if(o===Cr)g=-(a+r)/(a-r),x=-2*a*r/(a-r);else if(o===Ka)g=-a/(a-r),x=-a*r/(a-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return c[0]=u,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=h,c[9]=m,c[13]=0,c[2]=0,c[6]=0,c[10]=g,c[14]=x,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,n,s,r,a,o=Cr,l=!1){const c=this.elements,u=2/(t-e),h=2/(n-s),f=-(t+e)/(t-e),m=-(n+s)/(n-s);let g,x;if(l)g=1/(a-r),x=a/(a-r);else if(o===Cr)g=-2/(a-r),x=-(a+r)/(a-r);else if(o===Ka)g=-1/(a-r),x=-r/(a-r);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return c[0]=u,c[4]=0,c[8]=0,c[12]=f,c[1]=0,c[5]=h,c[9]=0,c[13]=m,c[2]=0,c[6]=0,c[10]=g,c[14]=x,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<16;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const c0=new z,sc=new Lt,oie=new z(0,0,0),lie=new z(1,1,1),hd=new z,d1=new z,No=new z,_4=new Lt,v4=new Fs;class Lr{constructor(e=0,t=0,n=0,s=Lr.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,s=this._order){return this._x=e,this._y=t,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const s=e.elements,r=s[0],a=s[4],o=s[8],l=s[1],c=s[5],u=s[9],h=s[2],f=s[6],m=s[10];switch(t){case"XYZ":this._y=Math.asin(yn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,m),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-yn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,m),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(yn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,m),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-yn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,m),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(yn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(o,m));break;case"XZY":this._z=Math.asin(-yn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-u,m),this._y=0);break;default:Se("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return _4.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_4,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return v4.setFromEuler(this),this.setFromQuaternion(v4,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Lr.DEFAULT_ORDER="XYZ";class $m{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let cie=0;const b4=new z,u0=new Fs,Vu=new Lt,f1=new z,E_=new z,uie=new z,hie=new Fs,S4=new z(1,0,0),T4=new z(0,1,0),A4=new z(0,0,1),M4={type:"added"},die={type:"removed"},h0={type:"childadded",child:null},LN={type:"childremoved",child:null};class Fn extends Ta{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:cie++}),this.uuid=Ko(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Fn.DEFAULT_UP.clone();const e=new z,t=new Lr,n=new Fs,s=new z(1,1,1);function r(){n.setFromEuler(t,!1)}function a(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Lt},normalMatrix:{value:new gn}}),this.matrix=new Lt,this.matrixWorld=new Lt,this.matrixAutoUpdate=Fn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Fn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new $m,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return u0.setFromAxisAngle(e,t),this.quaternion.multiply(u0),this}rotateOnWorldAxis(e,t){return u0.setFromAxisAngle(e,t),this.quaternion.premultiply(u0),this}rotateX(e){return this.rotateOnAxis(S4,e)}rotateY(e){return this.rotateOnAxis(T4,e)}rotateZ(e){return this.rotateOnAxis(A4,e)}translateOnAxis(e,t){return b4.copy(e).applyQuaternion(this.quaternion),this.position.add(b4.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(S4,e)}translateY(e){return this.translateOnAxis(T4,e)}translateZ(e){return this.translateOnAxis(A4,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Vu.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?f1.copy(e):f1.set(e,t,n);const s=this.parent;this.updateWorldMatrix(!0,!1),E_.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Vu.lookAt(E_,f1,this.up):Vu.lookAt(f1,E_,this.up),this.quaternion.setFromRotationMatrix(Vu),s&&(Vu.extractRotation(s.matrixWorld),u0.setFromRotationMatrix(Vu),this.quaternion.premultiply(u0.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(De("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(M4),h0.child=e,this.dispatchEvent(h0),h0.child=null):De("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(die),LN.child=e,this.dispatchEvent(LN),LN.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Vu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Vu.multiply(e.parent.matrixWorld)),e.applyMatrix4(Vu),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(M4),h0.child=e,this.dispatchEvent(h0),h0.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,s=this.children.length;n<s;n++){const a=this.children[n].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(E_,e,uie),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(E_,hie,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),s.instanceInfo=this._instanceInfo.map(o=>({...o})),s.availableInstanceIds=this._availableInstanceIds.slice(),s.availableGeometryIds=this._availableGeometryIds.slice(),s.nextIndexStart=this._nextIndexStart,s.nextVertexStart=this._nextVertexStart,s.geometryCount=this._geometryCount,s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.matricesTexture=this._matricesTexture.toJSON(e),s.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(s.boundingBox=this.boundingBox.toJSON()));function r(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];r(e.shapes,h)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(r(e.materials,this.material[l]));s.material=o}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];s.animations.push(r(e.animations,l))}}if(t){const o=a(e.geometries),l=a(e.materials),c=a(e.textures),u=a(e.images),h=a(e.shapes),f=a(e.skeletons),m=a(e.animations),g=a(e.nodes);o.length>0&&(n.geometries=o),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),u.length>0&&(n.images=u),h.length>0&&(n.shapes=h),f.length>0&&(n.skeletons=f),m.length>0&&(n.animations=m),g.length>0&&(n.nodes=g)}return n.object=s,n;function a(o){const l=[];for(const c in o){const u=o[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}}Fn.DEFAULT_UP=new z(0,1,0);Fn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Fn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const rc=new z,Hu=new z,UN=new z,ku=new z,d0=new z,f0=new z,E4=new z,IN=new z,PN=new z,ON=new z,FN=new un,GN=new un,zN=new un;class Ga{constructor(e=new z,t=new z,n=new z){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,s){s.subVectors(n,t),rc.subVectors(e,t),s.cross(rc);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,n,s,r){rc.subVectors(s,t),Hu.subVectors(n,t),UN.subVectors(e,t);const a=rc.dot(rc),o=rc.dot(Hu),l=rc.dot(UN),c=Hu.dot(Hu),u=Hu.dot(UN),h=a*c-o*o;if(h===0)return r.set(0,0,0),null;const f=1/h,m=(c*l-o*u)*f,g=(a*u-o*l)*f;return r.set(1-m-g,g,m)}static containsPoint(e,t,n,s){return this.getBarycoord(e,t,n,s,ku)===null?!1:ku.x>=0&&ku.y>=0&&ku.x+ku.y<=1}static getInterpolation(e,t,n,s,r,a,o,l){return this.getBarycoord(e,t,n,s,ku)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(r,ku.x),l.addScaledVector(a,ku.y),l.addScaledVector(o,ku.z),l)}static getInterpolatedAttribute(e,t,n,s,r,a){return FN.setScalar(0),GN.setScalar(0),zN.setScalar(0),FN.fromBufferAttribute(e,t),GN.fromBufferAttribute(e,n),zN.fromBufferAttribute(e,s),a.setScalar(0),a.addScaledVector(FN,r.x),a.addScaledVector(GN,r.y),a.addScaledVector(zN,r.z),a}static isFrontFacing(e,t,n,s){return rc.subVectors(n,t),Hu.subVectors(e,t),rc.cross(Hu).dot(s)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,s){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,n,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return rc.subVectors(this.c,this.b),Hu.subVectors(this.a,this.b),rc.cross(Hu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ga.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ga.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,s,r){return Ga.getInterpolation(e,this.a,this.b,this.c,t,n,s,r)}containsPoint(e){return Ga.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ga.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,s=this.b,r=this.c;let a,o;d0.subVectors(s,n),f0.subVectors(r,n),IN.subVectors(e,n);const l=d0.dot(IN),c=f0.dot(IN);if(l<=0&&c<=0)return t.copy(n);PN.subVectors(e,s);const u=d0.dot(PN),h=f0.dot(PN);if(u>=0&&h<=u)return t.copy(s);const f=l*h-u*c;if(f<=0&&l>=0&&u<=0)return a=l/(l-u),t.copy(n).addScaledVector(d0,a);ON.subVectors(e,r);const m=d0.dot(ON),g=f0.dot(ON);if(g>=0&&m<=g)return t.copy(r);const x=m*c-l*g;if(x<=0&&c>=0&&g<=0)return o=c/(c-g),t.copy(n).addScaledVector(f0,o);const v=u*g-m*h;if(v<=0&&h-u>=0&&m-g>=0)return E4.subVectors(r,s),o=(h-u)/(h-u+(m-g)),t.copy(s).addScaledVector(E4,o);const y=1/(v+x+f);return a=x*y,o=f*y,t.copy(n).addScaledVector(d0,a).addScaledVector(f0,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const R9={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},dd={h:0,s:0,l:0},p1={h:0,s:0,l:0};function VN(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}class Ye{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Js){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,en.colorSpaceToWorking(this,t),this}setRGB(e,t,n,s=en.workingColorSpace){return this.r=e,this.g=t,this.b=n,en.colorSpaceToWorking(this,s),this}setHSL(e,t,n,s=en.workingColorSpace){if(e=yU(e,1),t=yn(t,0,1),n=yn(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,a=2*n-r;this.r=VN(a,r,e+1/3),this.g=VN(a,r,e),this.b=VN(a,r,e-1/3)}return en.colorSpaceToWorking(this,s),this}setStyle(e,t=Js){function n(r){r!==void 0&&parseFloat(r)<1&&Se("Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const a=s[1],o=s[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:Se("Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],a=r.length;if(a===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(r,16),t);Se("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Js){const n=R9[e.toLowerCase()];return n!==void 0?this.setHex(n,t):Se("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=yh(e.r),this.g=yh(e.g),this.b=yh(e.b),this}copyLinearToSRGB(e){return this.r=yy(e.r),this.g=yy(e.g),this.b=yy(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Js){return en.workingToColorSpace(ca.copy(this),e),Math.round(yn(ca.r*255,0,255))*65536+Math.round(yn(ca.g*255,0,255))*256+Math.round(yn(ca.b*255,0,255))}getHexString(e=Js){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=en.workingColorSpace){en.workingToColorSpace(ca.copy(this),t);const n=ca.r,s=ca.g,r=ca.b,a=Math.max(n,s,r),o=Math.min(n,s,r);let l,c;const u=(o+a)/2;if(o===a)l=0,c=0;else{const h=a-o;switch(c=u<=.5?h/(a+o):h/(2-a-o),a){case n:l=(s-r)/h+(s<r?6:0);break;case s:l=(r-n)/h+2;break;case r:l=(n-s)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=en.workingColorSpace){return en.workingToColorSpace(ca.copy(this),t),e.r=ca.r,e.g=ca.g,e.b=ca.b,e}getStyle(e=Js){en.workingToColorSpace(ca.copy(this),e);const t=ca.r,n=ca.g,s=ca.b;return e!==Js?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(s*255)})`}offsetHSL(e,t,n){return this.getHSL(dd),this.setHSL(dd.h+e,dd.s+t,dd.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(dd),e.getHSL(p1);const n=Pv(dd.h,p1.h,t),s=Pv(dd.s,p1.s,t),r=Pv(dd.l,p1.l,t);return this.setHSL(n,s,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,s=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*s,this.g=r[1]*t+r[4]*n+r[7]*s,this.b=r[2]*t+r[5]*n+r[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ca=new Ye;Ye.NAMES=R9;let fie=0;class Es extends Ta{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:fie++}),this.uuid=Ko(),this.name="",this.type="Material",this.blending=qa,this.side=jr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Pm,this.blendDst=Om,this.blendEquation=Mr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ye(0,0,0),this.blendAlpha=0,this.depthFunc=uu,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=bb,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Zu,this.stencilZFail=Zu,this.stencilZPass=Zu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){Se(`Material: parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){Se(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==qa&&(n.blending=this.blending),this.side!==jr&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==Pm&&(n.blendSrc=this.blendSrc),this.blendDst!==Om&&(n.blendDst=this.blendDst),this.blendEquation!==Mr&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==uu&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==bb&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Zu&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Zu&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Zu&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.allowOverride===!1&&(n.allowOverride=!1),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function s(r){const a=[];for(const o in r){const l=r[o];delete l.metadata,a.push(l)}return a}if(t){const r=s(e.textures),a=s(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const s=t.length;n=new Array(s);for(let r=0;r!==s;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Ts extends Es{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ye(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Lr,this.combine=fg,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const eh=pie();function pie(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),n=new Uint32Array(512),s=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(n[l]=0,n[l|256]=32768,s[l]=24,s[l|256]=24):c<-14?(n[l]=1024>>-c-14,n[l|256]=1024>>-c-14|32768,s[l]=-c-1,s[l|256]=-c-1):c<=15?(n[l]=c+15<<10,n[l|256]=c+15<<10|32768,s[l]=13,s[l|256]=13):c<128?(n[l]=31744,n[l|256]=64512,s[l]=24,s[l|256]=24):(n[l]=31744,n[l|256]=64512,s[l]=13,s[l|256]=13)}const r=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,r[l]=c|u}for(let l=1024;l<2048;++l)r[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:s,mantissaTable:r,exponentTable:a,offsetTable:o}}function to(i){Math.abs(i)>65504&&Se("DataUtils.toHalfFloat(): Value out of range."),i=yn(i,-65504,65504),eh.floatView[0]=i;const e=eh.uint32View[0],t=e>>23&511;return eh.baseTable[t]+((e&8388607)>>eh.shiftTable[t])}function uv(i){const e=i>>10;return eh.uint32View[0]=eh.mantissaTable[eh.offsetTable[e]+(i&1023)]+eh.exponentTable[e],eh.floatView[0]}class Ll{static toHalfFloat(e){return to(e)}static fromHalfFloat(e){return uv(e)}}const Xs=new z,m1=new Ae;let mie=0;class Nn{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:mie++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=Bh,this.updateRanges=[],this.gpuType=Rn,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[n+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)m1.fromBufferAttribute(this,t),m1.applyMatrix3(e),this.setXY(t,m1.x,m1.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Xs.fromBufferAttribute(this,t),Xs.applyMatrix3(e),this.setXYZ(t,Xs.x,Xs.y,Xs.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Xs.fromBufferAttribute(this,t),Xs.applyMatrix4(e),this.setXYZ(t,Xs.x,Xs.y,Xs.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Xs.fromBufferAttribute(this,t),Xs.applyNormalMatrix(e),this.setXYZ(t,Xs.x,Xs.y,Xs.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Xs.fromBufferAttribute(this,t),Xs.transformDirection(e),this.setXYZ(t,Xs.x,Xs.y,Xs.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Fa(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Mn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Fa(t,this.array)),t}setX(e,t){return this.normalized&&(t=Mn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Fa(t,this.array)),t}setY(e,t){return this.normalized&&(t=Mn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Fa(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Mn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Fa(t,this.array)),t}setW(e,t){return this.normalized&&(t=Mn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,s){return e*=this.itemSize,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array),s=Mn(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,t,n,s,r){return e*=this.itemSize,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array),s=Mn(s,this.array),r=Mn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Bh&&(e.usage=this.usage),e}}class N9 extends Nn{constructor(e,t,n){super(new Int8Array(e),t,n)}}class B9 extends Nn{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class D9 extends Nn{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class L9 extends Nn{constructor(e,t,n){super(new Int16Array(e),t,n)}}class CS extends Nn{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class U9 extends Nn{constructor(e,t,n){super(new Int32Array(e),t,n)}}class wS extends Nn{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class KE extends Nn{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=uv(this.array[e*this.itemSize]);return this.normalized&&(t=Fa(t,this.array)),t}setX(e,t){return this.normalized&&(t=Mn(t,this.array)),this.array[e*this.itemSize]=to(t),this}getY(e){let t=uv(this.array[e*this.itemSize+1]);return this.normalized&&(t=Fa(t,this.array)),t}setY(e,t){return this.normalized&&(t=Mn(t,this.array)),this.array[e*this.itemSize+1]=to(t),this}getZ(e){let t=uv(this.array[e*this.itemSize+2]);return this.normalized&&(t=Fa(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Mn(t,this.array)),this.array[e*this.itemSize+2]=to(t),this}getW(e){let t=uv(this.array[e*this.itemSize+3]);return this.normalized&&(t=Fa(t,this.array)),t}setW(e,t){return this.normalized&&(t=Mn(t,this.array)),this.array[e*this.itemSize+3]=to(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array)),this.array[e+0]=to(t),this.array[e+1]=to(n),this}setXYZ(e,t,n,s){return e*=this.itemSize,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array),s=Mn(s,this.array)),this.array[e+0]=to(t),this.array[e+1]=to(n),this.array[e+2]=to(s),this}setXYZW(e,t,n,s,r){return e*=this.itemSize,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array),s=Mn(s,this.array),r=Mn(r,this.array)),this.array[e+0]=to(t),this.array[e+1]=to(n),this.array[e+2]=to(s),this.array[e+3]=to(r),this}}class qt extends Nn{constructor(e,t,n){super(new Float32Array(e),t,n)}}let gie=0;const yl=new Lt,HN=new Fn,p0=new z,Bo=new Br,C_=new Br,vr=new z;class pn extends Ta{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:gie++}),this.uuid=Ko(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(mU(e)?wS:CS)(e,1):this.index=e,this}setIndirect(e,t=0){return this.indirect=e,this.indirectOffset=t,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new gn().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return yl.makeRotationFromQuaternion(e),this.applyMatrix4(yl),this}rotateX(e){return yl.makeRotationX(e),this.applyMatrix4(yl),this}rotateY(e){return yl.makeRotationY(e),this.applyMatrix4(yl),this}rotateZ(e){return yl.makeRotationZ(e),this.applyMatrix4(yl),this}translate(e,t,n){return yl.makeTranslation(e,t,n),this.applyMatrix4(yl),this}scale(e,t,n){return yl.makeScale(e,t,n),this.applyMatrix4(yl),this}lookAt(e){return HN.lookAt(e),HN.updateMatrix(),this.applyMatrix4(HN.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(p0).negate(),this.translate(p0.x,p0.y,p0.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let s=0,r=e.length;s<r;s++){const a=e[s];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new qt(n,3))}else{const n=Math.min(e.length,t.count);for(let s=0;s<n;s++){const r=e[s];t.setXYZ(s,r.x,r.y,r.z||0)}e.length>t.count&&Se("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Br);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){De("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new z(-1/0,-1/0,-1/0),new z(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){const r=t[n];Bo.setFromBufferAttribute(r),this.morphTargetsRelative?(vr.addVectors(this.boundingBox.min,Bo.min),this.boundingBox.expandByPoint(vr),vr.addVectors(this.boundingBox.max,Bo.max),this.boundingBox.expandByPoint(vr)):(this.boundingBox.expandByPoint(Bo.min),this.boundingBox.expandByPoint(Bo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&De('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Gs);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){De("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new z,1/0);return}if(e){const n=this.boundingSphere.center;if(Bo.setFromBufferAttribute(e),t)for(let r=0,a=t.length;r<a;r++){const o=t[r];C_.setFromBufferAttribute(o),this.morphTargetsRelative?(vr.addVectors(Bo.min,C_.min),Bo.expandByPoint(vr),vr.addVectors(Bo.max,C_.max),Bo.expandByPoint(vr)):(Bo.expandByPoint(C_.min),Bo.expandByPoint(C_.max))}Bo.getCenter(n);let s=0;for(let r=0,a=e.count;r<a;r++)vr.fromBufferAttribute(e,r),s=Math.max(s,n.distanceToSquared(vr));if(t)for(let r=0,a=t.length;r<a;r++){const o=t[r],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)vr.fromBufferAttribute(o,c),l&&(p0.fromBufferAttribute(e,c),vr.add(p0)),s=Math.max(s,n.distanceToSquared(vr))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&De('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){De("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,s=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Nn(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let N=0;N<n.count;N++)o[N]=new z,l[N]=new z;const c=new z,u=new z,h=new z,f=new Ae,m=new Ae,g=new Ae,x=new z,v=new z;function y(N,E,B){c.fromBufferAttribute(n,N),u.fromBufferAttribute(n,E),h.fromBufferAttribute(n,B),f.fromBufferAttribute(r,N),m.fromBufferAttribute(r,E),g.fromBufferAttribute(r,B),u.sub(c),h.sub(c),m.sub(f),g.sub(f);const U=1/(m.x*g.y-g.x*m.y);isFinite(U)&&(x.copy(u).multiplyScalar(g.y).addScaledVector(h,-m.y).multiplyScalar(U),v.copy(h).multiplyScalar(m.x).addScaledVector(u,-g.x).multiplyScalar(U),o[N].add(x),o[E].add(x),o[B].add(x),l[N].add(v),l[E].add(v),l[B].add(v))}let b=this.groups;b.length===0&&(b=[{start:0,count:e.count}]);for(let N=0,E=b.length;N<E;++N){const B=b[N],U=B.start,H=B.count;for(let F=U,V=U+H;F<V;F+=3)y(e.getX(F+0),e.getX(F+1),e.getX(F+2))}const S=new z,T=new z,M=new z,C=new z;function w(N){M.fromBufferAttribute(s,N),C.copy(M);const E=o[N];S.copy(E),S.sub(M.multiplyScalar(M.dot(E))).normalize(),T.crossVectors(C,E);const U=T.dot(l[N])<0?-1:1;a.setXYZW(N,S.x,S.y,S.z,U)}for(let N=0,E=b.length;N<E;++N){const B=b[N],U=B.start,H=B.count;for(let F=U,V=U+H;F<V;F+=3)w(e.getX(F+0)),w(e.getX(F+1)),w(e.getX(F+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Nn(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let f=0,m=n.count;f<m;f++)n.setXYZ(f,0,0,0);const s=new z,r=new z,a=new z,o=new z,l=new z,c=new z,u=new z,h=new z;if(e)for(let f=0,m=e.count;f<m;f+=3){const g=e.getX(f+0),x=e.getX(f+1),v=e.getX(f+2);s.fromBufferAttribute(t,g),r.fromBufferAttribute(t,x),a.fromBufferAttribute(t,v),u.subVectors(a,r),h.subVectors(s,r),u.cross(h),o.fromBufferAttribute(n,g),l.fromBufferAttribute(n,x),c.fromBufferAttribute(n,v),o.add(u),l.add(u),c.add(u),n.setXYZ(g,o.x,o.y,o.z),n.setXYZ(x,l.x,l.y,l.z),n.setXYZ(v,c.x,c.y,c.z)}else for(let f=0,m=t.count;f<m;f+=3)s.fromBufferAttribute(t,f+0),r.fromBufferAttribute(t,f+1),a.fromBufferAttribute(t,f+2),u.subVectors(a,r),h.subVectors(s,r),u.cross(h),n.setXYZ(f+0,u.x,u.y,u.z),n.setXYZ(f+1,u.x,u.y,u.z),n.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)vr.fromBufferAttribute(e,t),vr.normalize(),e.setXYZ(t,vr.x,vr.y,vr.z)}toNonIndexed(){function e(o,l){const c=o.array,u=o.itemSize,h=o.normalized,f=new c.constructor(l.length*u);let m=0,g=0;for(let x=0,v=l.length;x<v;x++){o.isInterleavedBufferAttribute?m=l[x]*o.data.stride+o.offset:m=l[x]*u;for(let y=0;y<u;y++)f[g++]=c[m++]}return new Nn(f,u,h)}if(this.index===null)return Se("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new pn,n=this.index.array,s=this.attributes;for(const o in s){const l=s[o],c=e(l,n);t.setAttribute(o,c)}const r=this.morphAttributes;for(const o in r){const l=[],c=r[o];for(let u=0,h=c.length;u<h;u++){const f=c[u],m=e(f,n);l.push(m)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const c=n[l];e.data.attributes[l]=c.toJSON(e.data)}const s={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,f=c.length;h<f;h++){const m=c[h];u.push(m.toJSON(e.data))}u.length>0&&(s[l]=u,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere=o.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const s=e.attributes;for(const c in s){const u=s[c];this.setAttribute(c,u.clone(t))}const r=e.morphAttributes;for(const c in r){const u=[],h=r[c];for(let f=0,m=h.length;f<m;f++)u.push(h[f].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,u=a.length;c<u;c++){const h=a[c];this.addGroup(h.start,h.count,h.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const C4=new Lt,Bp=new Zf,g1=new Gs,w4=new z,y1=new z,x1=new z,_1=new z,kN=new z,v1=new z,R4=new z,b1=new z;class Kn extends Fn{constructor(e=new pn,t=new Ts){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}getVertexPosition(e,t){const n=this.geometry,s=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(s,e);const o=this.morphTargetInfluences;if(r&&o){v1.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const u=o[l],h=r[l];u!==0&&(kN.fromBufferAttribute(h,e),a?v1.addScaledVector(kN,u):v1.addScaledVector(kN.sub(t),u))}t.add(v1)}return t}raycast(e,t){const n=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),g1.copy(n.boundingSphere),g1.applyMatrix4(r),Bp.copy(e.ray).recast(e.near),!(g1.containsPoint(Bp.origin)===!1&&(Bp.intersectSphere(g1,w4)===null||Bp.origin.distanceToSquared(w4)>(e.far-e.near)**2))&&(C4.copy(r).invert(),Bp.copy(e.ray).applyMatrix4(C4),!(n.boundingBox!==null&&Bp.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,Bp)))}_computeIntersections(e,t,n){let s;const r=this.geometry,a=this.material,o=r.index,l=r.attributes.position,c=r.attributes.uv,u=r.attributes.uv1,h=r.attributes.normal,f=r.groups,m=r.drawRange;if(o!==null)if(Array.isArray(a))for(let g=0,x=f.length;g<x;g++){const v=f[g],y=a[v.materialIndex],b=Math.max(v.start,m.start),S=Math.min(o.count,Math.min(v.start+v.count,m.start+m.count));for(let T=b,M=S;T<M;T+=3){const C=o.getX(T),w=o.getX(T+1),N=o.getX(T+2);s=S1(this,y,e,n,c,u,h,C,w,N),s&&(s.faceIndex=Math.floor(T/3),s.face.materialIndex=v.materialIndex,t.push(s))}}else{const g=Math.max(0,m.start),x=Math.min(o.count,m.start+m.count);for(let v=g,y=x;v<y;v+=3){const b=o.getX(v),S=o.getX(v+1),T=o.getX(v+2);s=S1(this,a,e,n,c,u,h,b,S,T),s&&(s.faceIndex=Math.floor(v/3),t.push(s))}}else if(l!==void 0)if(Array.isArray(a))for(let g=0,x=f.length;g<x;g++){const v=f[g],y=a[v.materialIndex],b=Math.max(v.start,m.start),S=Math.min(l.count,Math.min(v.start+v.count,m.start+m.count));for(let T=b,M=S;T<M;T+=3){const C=T,w=T+1,N=T+2;s=S1(this,y,e,n,c,u,h,C,w,N),s&&(s.faceIndex=Math.floor(T/3),s.face.materialIndex=v.materialIndex,t.push(s))}}else{const g=Math.max(0,m.start),x=Math.min(l.count,m.start+m.count);for(let v=g,y=x;v<y;v+=3){const b=v,S=v+1,T=v+2;s=S1(this,a,e,n,c,u,h,b,S,T),s&&(s.faceIndex=Math.floor(v/3),t.push(s))}}}}function yie(i,e,t,n,s,r,a,o){let l;if(e.side===hi?l=n.intersectTriangle(a,r,s,!0,o):l=n.intersectTriangle(s,r,a,e.side===jr,o),l===null)return null;b1.copy(o),b1.applyMatrix4(i.matrixWorld);const c=t.ray.origin.distanceTo(b1);return c<t.near||c>t.far?null:{distance:c,point:b1.clone(),object:i}}function S1(i,e,t,n,s,r,a,o,l,c){i.getVertexPosition(o,y1),i.getVertexPosition(l,x1),i.getVertexPosition(c,_1);const u=yie(i,e,t,n,y1,x1,_1,R4);if(u){const h=new z;Ga.getBarycoord(R4,y1,x1,_1,h),s&&(u.uv=Ga.getInterpolatedAttribute(s,o,l,c,h,new Ae)),r&&(u.uv1=Ga.getInterpolatedAttribute(r,o,l,c,h,new Ae)),a&&(u.normal=Ga.getInterpolatedAttribute(a,o,l,c,h,new z),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const f={a:o,b:l,c,normal:new z,materialIndex:0};Ga.getNormal(y1,x1,_1,f.normal),u.face=f,u.barycoord=h}return u}class Su extends pn{constructor(e=1,t=1,n=1,s=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:s,heightSegments:r,depthSegments:a};const o=this;s=Math.floor(s),r=Math.floor(r),a=Math.floor(a);const l=[],c=[],u=[],h=[];let f=0,m=0;g("z","y","x",-1,-1,n,t,e,a,r,0),g("z","y","x",1,-1,n,t,-e,a,r,1),g("x","z","y",1,1,e,n,t,s,a,2),g("x","z","y",1,-1,e,n,-t,s,a,3),g("x","y","z",1,-1,e,t,n,s,r,4),g("x","y","z",-1,-1,e,t,-n,s,r,5),this.setIndex(l),this.setAttribute("position",new qt(c,3)),this.setAttribute("normal",new qt(u,3)),this.setAttribute("uv",new qt(h,2));function g(x,v,y,b,S,T,M,C,w,N,E){const B=T/w,U=M/N,H=T/2,F=M/2,V=C/2,Y=w+1,P=N+1;let X=0,J=0;const re=new z;for(let ne=0;ne<P;ne++){const ge=ne*U-F;for(let Te=0;Te<Y;Te++){const Be=Te*B-H;re[x]=Be*b,re[v]=ge*S,re[y]=V,c.push(re.x,re.y,re.z),re[x]=0,re[v]=0,re[y]=C>0?1:-1,u.push(re.x,re.y,re.z),h.push(Te/w),h.push(1-ne/N),X+=1}}for(let ne=0;ne<N;ne++)for(let ge=0;ge<w;ge++){const Te=f+ge+Y*ne,Be=f+ge+Y*(ne+1),et=f+(ge+1)+Y*(ne+1),wt=f+(ge+1)+Y*ne;l.push(Te,Be,wt),l.push(Be,et,wt),J+=6}o.addGroup(m,J,E),m+=J,f+=X}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Su(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function qy(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const s=i[t][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(Se("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=s.clone():Array.isArray(s)?e[t][n]=s.slice():e[t][n]=s}}return e}function Ra(i){const e={};for(let t=0;t<i.length;t++){const n=qy(i[t]);for(const s in n)e[s]=n[s]}return e}function xie(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function I9(i){const e=i.getRenderTarget();return e===null?i.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:en.workingColorSpace}const P9={clone:qy,merge:Ra};var _ie=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,vie=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Za extends Es{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=_ie,this.fragmentShader=vie,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=qy(e.uniforms),this.uniformsGroups=xie(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this.defaultAttributeValues=Object.assign({},e.defaultAttributeValues),this.index0AttributeName=e.index0AttributeName,this.uniformsNeedUpdate=e.uniformsNeedUpdate,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const a=this.uniforms[s].value;a&&a.isTexture?t.uniforms[s]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[s]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[s]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[s]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[s]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[s]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[s]={type:"m4",value:a.toArray()}:t.uniforms[s]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Cx extends Fn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Lt,this.projectionMatrix=new Lt,this.projectionMatrixInverse=new Lt,this.coordinateSystem=Cr,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const fd=new z,N4=new Ae,B4=new Ae;class Ci extends Cx{constructor(e=50,t=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Qm*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Am*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Qm*2*Math.atan(Math.tan(Am*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){fd.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(fd.x,fd.y).multiplyScalar(-e/fd.z),fd.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(fd.x,fd.y).multiplyScalar(-e/fd.z)}getViewSize(e,t){return this.getViewBounds(e,N4,B4),t.subVectors(B4,N4)}setViewOffset(e,t,n,s,r,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Am*.5*this.fov)/this.zoom,n=2*t,s=this.aspect*n,r=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;r+=a.offsetX*s/l,t-=a.offsetY*n/c,s*=a.width/l,n*=a.height/c}const o=this.filmOffset;o!==0&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const m0=-90,g0=1;class ZE extends Fn{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Ci(m0,g0,e,t);s.layers=this.layers,this.add(s);const r=new Ci(m0,g0,e,t);r.layers=this.layers,this.add(r);const a=new Ci(m0,g0,e,t);a.layers=this.layers,this.add(a);const o=new Ci(m0,g0,e,t);o.layers=this.layers,this.add(o);const l=new Ci(m0,g0,e,t);l.layers=this.layers,this.add(l);const c=new Ci(m0,g0,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,s,r,a,o,l]=t;for(const c of t)this.remove(c);if(e===Cr)n.up.set(0,1,0),n.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Ka)n.up.set(0,-1,0),n.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,a,o,l,c,u]=this.children,h=e.getRenderTarget(),f=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),g=e.xr.enabled;e.xr.enabled=!1;const x=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,s),e.render(t,r),e.setRenderTarget(n,1,s),e.render(t,a),e.setRenderTarget(n,2,s),e.render(t,o),e.setRenderTarget(n,3,s),e.render(t,l),e.setRenderTarget(n,4,s),e.render(t,c),n.texture.generateMipmaps=x,e.setRenderTarget(n,5,s),e.render(t,u),e.setRenderTarget(h,f,m),e.xr.enabled=g,n.texture.needsPMREMUpdate=!0}}class Gh extends In{constructor(e=[],t=Sa,n,s,r,a,o,l,c,u){super(e,t,n,s,r,a,o,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class RS extends xa{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},s=[n,n,n,n,n,n];this.texture=new Gh(s),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new Su(5,5,5),r=new Za({name:"CubemapFromEquirect",uniforms:qy(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:hi,blending:Nr});r.uniforms.tEquirect.value=t;const a=new Kn(s,r),o=t.minFilter;return t.minFilter===$s&&(t.minFilter=Jt),new ZE(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,n=!0,s=!0){const r=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,s);e.setRenderTarget(r)}}class ao extends Fn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const bie={type:"move"};class xy{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ao,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ao,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new z,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new z),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ao,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new z,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new z),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let s=null,r=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){a=!0;for(const x of e.hand.values()){const v=t.getJointPose(x,n),y=this._getHandJoint(c,x);v!==null&&(y.matrix.fromArray(v.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.matrixWorldNeedsUpdate=!0,y.jointRadius=v.radius),y.visible=v!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],f=u.position.distanceTo(h.position),m=.02,g=.005;c.inputState.pinching&&f>m+g?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&f<=m-g&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(s=t.getPose(e.targetRaySpace,n),s===null&&r!==null&&(s=r),s!==null&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(bie)))}return o!==null&&(o.visible=s!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new ao;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class NS{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Ye(e),this.density=t}clone(){return new NS(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class BS{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Ye(e),this.near=t,this.far=n}clone(){return new BS(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class fu extends Fn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Lr,this.environmentIntensity=1,this.environmentRotation=new Lr,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class vg{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Bh,this.updateRanges=[],this.version=0,this.uuid=Ko()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let s=0,r=this.stride;s<r;s++)this.array[e+s]=t.array[n+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ko()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ko()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const wa=new z;class pu{constructor(e,t,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)wa.fromBufferAttribute(this,t),wa.applyMatrix4(e),this.setXYZ(t,wa.x,wa.y,wa.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)wa.fromBufferAttribute(this,t),wa.applyNormalMatrix(e),this.setXYZ(t,wa.x,wa.y,wa.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)wa.fromBufferAttribute(this,t),wa.transformDirection(e),this.setXYZ(t,wa.x,wa.y,wa.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=Fa(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Mn(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Mn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Mn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Mn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Mn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Fa(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Fa(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Fa(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Fa(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array),s=Mn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,t,n,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array),s=Mn(s,this.array),r=Mn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=r,this}clone(e){if(e===void 0){Jm("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return new Nn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new pu(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){Jm("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class DS extends Es{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ye(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let y0;const w_=new z,x0=new z,_0=new z,v0=new Ae,R_=new Ae,O9=new Lt,T1=new z,N_=new z,A1=new z,D4=new Ae,WN=new Ae,L4=new Ae;class _U extends Fn{constructor(e=new DS){if(super(),this.isSprite=!0,this.type="Sprite",y0===void 0){y0=new pn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new vg(t,5);y0.setIndex([0,1,2,0,2,3]),y0.setAttribute("position",new pu(n,3,0,!1)),y0.setAttribute("uv",new pu(n,2,3,!1))}this.geometry=y0,this.material=e,this.center=new Ae(.5,.5),this.count=1}raycast(e,t){e.camera===null&&De('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),x0.setFromMatrixScale(this.matrixWorld),O9.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_0.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&x0.multiplyScalar(-_0.z);const n=this.material.rotation;let s,r;n!==0&&(r=Math.cos(n),s=Math.sin(n));const a=this.center;M1(T1.set(-.5,-.5,0),_0,a,x0,s,r),M1(N_.set(.5,-.5,0),_0,a,x0,s,r),M1(A1.set(.5,.5,0),_0,a,x0,s,r),D4.set(0,0),WN.set(1,0),L4.set(1,1);let o=e.ray.intersectTriangle(T1,N_,A1,!1,w_);if(o===null&&(M1(N_.set(-.5,.5,0),_0,a,x0,s,r),WN.set(0,1),o=e.ray.intersectTriangle(T1,A1,N_,!1,w_),o===null))return;const l=e.ray.origin.distanceTo(w_);l<e.near||l>e.far||t.push({distance:l,point:w_.clone(),uv:Ga.getInterpolation(w_,T1,N_,A1,D4,WN,L4,new Ae),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function M1(i,e,t,n,s,r){v0.subVectors(i,t).addScalar(.5).multiply(n),s!==void 0?(R_.x=r*v0.x-s*v0.y,R_.y=s*v0.x+r*v0.y):R_.copy(v0),i.copy(e),i.x+=R_.x,i.y+=R_.y,i.applyMatrix4(O9)}const E1=new z,U4=new z;class vU extends Fn{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,s=t.length;n<s;n++){const r=t[n];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const s=this.levels;let r;for(r=0;r<s.length&&!(t<s[r].distance);r++);return s.splice(r,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const s=t.splice(n,1);return this.remove(s[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,s;for(n=1,s=t.length;n<s;n++){let r=t[n].distance;if(t[n].object.visible&&(r-=r*t[n].hysteresis),e<r)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){E1.setFromMatrixPosition(this.matrixWorld);const s=e.ray.origin.distanceTo(E1);this.getObjectForDistance(s).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){E1.setFromMatrixPosition(e.matrixWorld),U4.setFromMatrixPosition(this.matrixWorld);const n=E1.distanceTo(U4)/e.zoom;t[0].object.visible=!0;let s,r;for(s=1,r=t.length;s<r;s++){let a=t[s].distance;if(t[s].object.visible&&(a-=a*t[s].hysteresis),n>=a)t[s-1].object.visible=!1,t[s].object.visible=!0;else break}for(this._currentLevel=s-1;s<r;s++)t[s].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let s=0,r=n.length;s<r;s++){const a=n[s];t.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return t}}const I4=new z,P4=new un,O4=new un,Sie=new z,F4=new Lt,C1=new z,XN=new Gs,G4=new Lt,qN=new Zf;class JE extends Kn{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=NM,this.bindMatrix=new Lt,this.bindMatrixInverse=new Lt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Br),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,C1),this.boundingBox.expandByPoint(C1)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Gs),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,C1),this.boundingSphere.expandByPoint(C1)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,s=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),XN.copy(this.boundingSphere),XN.applyMatrix4(s),e.ray.intersectsSphere(XN)!==!1&&(G4.copy(s).invert(),qN.copy(e.ray).applyMatrix4(G4),!(this.boundingBox!==null&&qN.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,qN)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new un,t=this.geometry.attributes.skinWeight;for(let n=0,s=t.count;n<s;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===NM?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===jL?this.bindMatrixInverse.copy(this.bindMatrix).invert():Se("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,s=this.geometry;P4.fromBufferAttribute(s.attributes.skinIndex,e),O4.fromBufferAttribute(s.attributes.skinWeight,e),I4.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const a=O4.getComponent(r);if(a!==0){const o=P4.getComponent(r);F4.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(Sie.copy(I4).applyMatrix4(F4),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class LS extends Fn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class _a extends In{constructor(e=null,t=1,n=1,s,r,a,o,l,c=$n,u=$n,h,f){super(null,a,o,l,c,u,s,r,h,f),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const z4=new Lt,Tie=new Lt;class wx{constructor(e=[],t=[]){this.uuid=Ko(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.previousBoneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){Se("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,s=this.bones.length;n<s;n++)this.boneInverses.push(new Lt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new Lt;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,s=this.boneTexture;for(let r=0,a=e.length;r<a;r++){const o=e[r]?e[r].matrixWorld:Tie;z4.multiplyMatrices(o,t[r]),z4.toArray(n,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new wx(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new _a(t,e,e,ii,Rn);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,s=e.bones.length;n<s;n++){const r=e.bones[n];let a=t[r];a===void 0&&(Se("Skeleton: No bone found with UUID:",r),a=new LS),this.bones.push(a),this.boneInverses.push(new Lt().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let s=0,r=t.length;s<r;s++){const a=t[s];e.bones.push(a.uuid);const o=n[s];e.boneInverses.push(o.toArray())}return e}}class Yr extends Nn{constructor(e,t,n,s=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const b0=new Lt,V4=new Lt,w1=[],H4=new Br,Aie=new Lt,B_=new Kn,D_=new Gs;class QE extends Kn{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Yr(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<n;s++)this.setMatrixAt(s,Aie)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Br),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,b0),H4.copy(e.boundingBox).applyMatrix4(b0),this.boundingBox.union(H4)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Gs),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,b0),D_.copy(e.boundingSphere).applyMatrix4(b0),this.boundingSphere.union(D_)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const n=t.morphTargetInfluences,s=this.morphTexture.source.data.data,r=n.length+1,a=e*r+1;for(let o=0;o<n.length;o++)n[o]=s[a+o]}raycast(e,t){const n=this.matrixWorld,s=this.count;if(B_.geometry=this.geometry,B_.material=this.material,B_.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),D_.copy(this.boundingSphere),D_.applyMatrix4(n),e.ray.intersectsSphere(D_)!==!1))for(let r=0;r<s;r++){this.getMatrixAt(r,b0),V4.multiplyMatrices(n,b0),B_.matrixWorld=V4,B_.raycast(e,w1);for(let a=0,o=w1.length;a<o;a++){const l=w1[a];l.instanceId=r,l.object=this,t.push(l)}w1.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Yr(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const n=t.morphTargetInfluences,s=n.length+1;this.morphTexture===null&&(this.morphTexture=new _a(new Float32Array(s*this.count),s,this.count,ql,Rn));const r=this.morphTexture.source.data.data;let a=0;for(let c=0;c<n.length;c++)a+=n[c];const o=this.geometry.morphTargetsRelative?1:1-a,l=s*e;r[l]=o,r.set(n,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const jN=new z,Mie=new z,Eie=new gn;class El{constructor(e=new z(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,s){return this.normal.set(e,t,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const s=jN.subVectors(n,t).cross(Mie.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(jN),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Eie.getNormalMatrix(e),s=this.coplanarPoint(jN).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Dp=new Gs,Cie=new Ae(.5,.5),R1=new z;class zh{constructor(e=new El,t=new El,n=new El,s=new El,r=new El,a=new El){this.planes=[e,t,n,s,r,a]}set(e,t,n,s,r,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(s),o[4].copy(r),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Cr,n=!1){const s=this.planes,r=e.elements,a=r[0],o=r[1],l=r[2],c=r[3],u=r[4],h=r[5],f=r[6],m=r[7],g=r[8],x=r[9],v=r[10],y=r[11],b=r[12],S=r[13],T=r[14],M=r[15];if(s[0].setComponents(c-a,m-u,y-g,M-b).normalize(),s[1].setComponents(c+a,m+u,y+g,M+b).normalize(),s[2].setComponents(c+o,m+h,y+x,M+S).normalize(),s[3].setComponents(c-o,m-h,y-x,M-S).normalize(),n)s[4].setComponents(l,f,v,T).normalize(),s[5].setComponents(c-l,m-f,y-v,M-T).normalize();else if(s[4].setComponents(c-l,m-f,y-v,M-T).normalize(),t===Cr)s[5].setComponents(c+l,m+f,y+v,M+T).normalize();else if(t===Ka)s[5].setComponents(l,f,v,T).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Dp.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Dp.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Dp)}intersectsSprite(e){Dp.center.set(0,0,0);const t=Cie.distanceTo(e.center);return Dp.radius=.7071067811865476+t,Dp.applyMatrix4(e.matrixWorld),this.intersectsSphere(Dp)}intersectsSphere(e){const t=this.planes,n=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const s=t[n];if(R1.x=s.normal.x>0?e.max.x:e.min.x,R1.y=s.normal.y>0?e.max.y:e.min.y,R1.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(R1)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const Lc=new Lt,Uc=new zh;class Rx{constructor(){this.coordinateSystem=Cr}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const s=t.cameras[n];if(Lc.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Uc.setFromProjectionMatrix(Lc,s.coordinateSystem,s.reversedDepth),Uc.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const s=t.cameras[n];if(Lc.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Uc.setFromProjectionMatrix(Lc,s.coordinateSystem,s.reversedDepth),Uc.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const s=t.cameras[n];if(Lc.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Uc.setFromProjectionMatrix(Lc,s.coordinateSystem,s.reversedDepth),Uc.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const s=t.cameras[n];if(Lc.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Uc.setFromProjectionMatrix(Lc,s.coordinateSystem,s.reversedDepth),Uc.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const s=t.cameras[n];if(Lc.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Uc.setFromProjectionMatrix(Lc,s.coordinateSystem,s.reversedDepth),Uc.containsPoint(e))return!0}return!1}clone(){return new Rx}}function YN(i,e){return i-e}function wie(i,e){return i.z-e.z}function Rie(i,e){return e.z-i.z}class Nie{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,s){const r=this.pool,a=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1,index:-1});const o=r[this.index];a.push(o),this.index++,o.start=e,o.count=t,o.z=n,o.index=s}reset(){this.list.length=0,this.index=0}}const eo=new Lt,Bie=new Ye(1,1,1),k4=new zh,Die=new Rx,N1=new Br,Lp=new Gs,L_=new z,W4=new z,Lie=new z,KN=new Nie,ua=new Kn,B1=[];function Uie(i,e,t=0){const n=e.itemSize;if(i.isInterleavedBufferAttribute||i.array.constructor!==e.array.constructor){const s=i.count;for(let r=0;r<s;r++)for(let a=0;a<n;a++)e.setComponent(r+t,a,i.getComponent(r,a))}else e.array.set(i.array,t*n);e.needsUpdate=!0}function Up(i,e){if(i.constructor!==e.constructor){const t=Math.min(i.length,e.length);for(let n=0;n<t;n++)e[n]=i[n]}else{const t=Math.min(i.length,e.length);e.set(new i.constructor(i.buffer,0,t))}}class bU extends Kn{constructor(e,t,n=t*2,s){super(new pn,s),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new _a(t,e,e,ii,Rn);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new _a(t,e,e,Oh,Jn);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new _a(t,e,e,ii,Rn);n.colorSpace=en.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,s=this._maxIndexCount;if(this._geometryInitialized===!1){for(const r in e.attributes){const a=e.getAttribute(r),{array:o,itemSize:l,normalized:c}=a,u=new o.constructor(n*l),h=new Nn(u,l,c);t.setAttribute(r,h)}if(e.getIndex()!==null){const r=n>65535?new Uint32Array(s):new Uint16Array(s);t.setIndex(new Nn(r,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const s=e.getAttribute(n),r=t.getAttribute(n);if(s.itemSize!==r.itemSize||s.normalized!==r.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Br);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,s=t.length;n<s;n++){if(t[n].active===!1)continue;const r=t[n].geometryIndex;this.getMatrixAt(n,eo),this.getBoundingBoxAt(r,N1).applyMatrix4(eo),e.union(N1)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Gs);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,s=t.length;n<s;n++){if(t[n].active===!1)continue;const r=t[n].geometryIndex;this.getMatrixAt(n,eo),this.getBoundingSphereAt(r,Lp).applyMatrix4(eo),e.union(Lp)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const n={visible:!0,active:!0,geometryIndex:e};let s=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(YN),s=this._availableInstanceIds.shift(),this._instanceInfo[s]=n):(s=this._instanceInfo.length,this._instanceInfo.push(n));const r=this._matricesTexture;eo.identity().toArray(r.image.data,s*16),r.needsUpdate=!0;const a=this._colorsTexture;return a&&(Bie.toArray(a.image.data,s*4),a.needsUpdate=!0),this._visibilityChanged=!0,s}addGeometry(e,t=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e);const s={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},r=this._geometryInfo;s.vertexStart=this._nextVertexStart,s.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const a=e.getIndex();if(a!==null&&(s.indexStart=this._nextIndexStart,s.reservedIndexCount=n===-1?a.count:n),s.indexStart!==-1&&s.indexStart+s.reservedIndexCount>this._maxIndexCount||s.vertexStart+s.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(YN),l=this._availableGeometryIds.shift(),r[l]=s):(l=this._geometryCount,this._geometryCount++,r.push(s)),this.setGeometryAt(l,e),this._nextIndexStart=s.indexStart+s.reservedIndexCount,this._nextVertexStart=s.vertexStart+s.reservedVertexCount,l}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,s=n.getIndex()!==null,r=n.getIndex(),a=t.getIndex(),o=this._geometryInfo[e];if(s&&a.count>o.reservedIndexCount||t.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,c=o.reservedVertexCount;o.vertexCount=t.getAttribute("position").count;for(const u in n.attributes){const h=t.getAttribute(u),f=n.getAttribute(u);Uie(h,f,l);const m=h.itemSize;for(let g=h.count,x=c;g<x;g++){const v=l+g;for(let y=0;y<m;y++)f.setComponent(v,y,0)}f.needsUpdate=!0,f.addUpdateRange(l*m,c*m)}if(s){const u=o.indexStart,h=o.reservedIndexCount;o.indexCount=t.getIndex().count;for(let f=0;f<a.count;f++)r.setX(u+f,l+a.getX(f));for(let f=a.count,m=h;f<m;f++)r.setX(u+f,l);r.needsUpdate=!0,r.addUpdateRange(u,o.reservedIndexCount)}return o.start=s?o.indexStart:o.vertexStart,o.count=s?o.indexCount:o.vertexCount,o.boundingBox=null,t.boundingBox!==null&&(o.boundingBox=t.boundingBox.clone()),o.boundingSphere=null,t.boundingSphere!==null&&(o.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const n=this._instanceInfo;for(let s=0,r=n.length;s<r;s++)n[s].active&&n[s].geometryIndex===e&&this.deleteInstance(s);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,s=n.map((a,o)=>o).sort((a,o)=>n[a].vertexStart-n[o].vertexStart),r=this.geometry;for(let a=0,o=n.length;a<o;a++){const l=s[a],c=n[l];if(c.active!==!1){if(r.index!==null){if(c.indexStart!==t){const{indexStart:u,vertexStart:h,reservedIndexCount:f}=c,m=r.index,g=m.array,x=e-h;for(let v=u;v<u+f;v++)g[v]=g[v]+x;m.array.copyWithin(t,u,u+f),m.addUpdateRange(t,f),m.needsUpdate=!0,c.indexStart=t}t+=c.reservedIndexCount}if(c.vertexStart!==e){const{vertexStart:u,reservedVertexCount:h}=c,f=r.attributes;for(const m in f){const g=f[m],{array:x,itemSize:v}=g;x.copyWithin(e*v,u*v,(u+h)*v),g.addUpdateRange(e*v,h*v),g.needsUpdate=!0}c.vertexStart=e}e+=c.reservedVertexCount,c.start=r.index?c.indexStart:c.vertexStart,this._nextIndexStart=r.index?c.indexStart+c.reservedIndexCount:0,this._nextVertexStart=c.vertexStart+c.reservedVertexCount}}return this._visibilityChanged=!0,this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,s=this._geometryInfo[e];if(s.boundingBox===null){const r=new Br,a=n.index,o=n.attributes.position;for(let l=s.start,c=s.start+s.count;l<c;l++){let u=l;a&&(u=a.getX(u)),r.expandByPoint(L_.fromBufferAttribute(o,u))}s.boundingBox=r}return t.copy(s.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,s=this._geometryInfo[e];if(s.boundingSphere===null){const r=new Gs;this.getBoundingBoxAt(e,N1),N1.getCenter(r.center);const a=n.index,o=n.attributes.position;let l=0;for(let c=s.start,u=s.start+s.count;c<u;c++){let h=c;a&&(h=a.getX(h)),L_.fromBufferAttribute(o,h),l=Math.max(l,r.center.distanceToSquared(L_))}r.radius=Math.sqrt(l),s.boundingSphere=r}return t.copy(s.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,s=this._matricesTexture.image.data;return t.toArray(s,e*16),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,t){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t?this:(this._instanceInfo[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(YN);t[t.length-1]===n.length-1;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const s=new Int32Array(e),r=new Int32Array(e);Up(this._multiDrawCounts,s),Up(this._multiDrawStarts,r),this._multiDrawCounts=s,this._multiDrawStarts=r,this._maxInstanceCount=e;const a=this._indirectTexture,o=this._matricesTexture,l=this._colorsTexture;a.dispose(),this._initIndirectTexture(),Up(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),Up(o.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),Up(l.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...n.map(o=>o.vertexStart+o.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...n.map(l=>l.indexStart+l.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const r=this.geometry;r.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new pn,this._initializeGeometry(r));const a=this.geometry;r.index&&Up(r.index.array,a.index.array);for(const o in r.attributes)Up(r.attributes[o].array,a.attributes[o].array)}raycast(e,t){const n=this._instanceInfo,s=this._geometryInfo,r=this.matrixWorld,a=this.geometry;ua.material=this.material,ua.geometry.index=a.index,ua.geometry.attributes=a.attributes,ua.geometry.boundingBox===null&&(ua.geometry.boundingBox=new Br),ua.geometry.boundingSphere===null&&(ua.geometry.boundingSphere=new Gs);for(let o=0,l=n.length;o<l;o++){if(!n[o].visible||!n[o].active)continue;const c=n[o].geometryIndex,u=s[c];ua.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(o,ua.matrixWorld).premultiply(r),this.getBoundingBoxAt(c,ua.geometry.boundingBox),this.getBoundingSphereAt(c,ua.geometry.boundingSphere),ua.raycast(e,B1);for(let h=0,f=B1.length;h<f;h++){const m=B1[h];m.object=this,m.batchId=o,t.push(m)}B1.length=0}ua.material=null,ua.geometry.index=null,ua.geometry.attributes={},ua.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,s,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=s.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,l=this._instanceInfo,c=this._multiDrawStarts,u=this._multiDrawCounts,h=this._geometryInfo,f=this.perObjectFrustumCulled,m=this._indirectTexture,g=m.image.data,x=n.isArrayCamera?Die:k4;f&&!n.isArrayCamera&&(eo.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),k4.setFromProjectionMatrix(eo,n.coordinateSystem,n.reversedDepth));let v=0;if(this.sortObjects){eo.copy(this.matrixWorld).invert(),L_.setFromMatrixPosition(n.matrixWorld).applyMatrix4(eo),W4.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(eo);for(let S=0,T=l.length;S<T;S++)if(l[S].visible&&l[S].active){const M=l[S].geometryIndex;this.getMatrixAt(S,eo),this.getBoundingSphereAt(M,Lp).applyMatrix4(eo);let C=!1;if(f&&(C=!x.intersectsSphere(Lp,n)),!C){const w=h[M],N=Lie.subVectors(Lp.center,L_).dot(W4);KN.push(w.start,w.count,N,S)}}const y=KN.list,b=this.customSort;b===null?y.sort(r.transparent?Rie:wie):b.call(this,y,n);for(let S=0,T=y.length;S<T;S++){const M=y[S];c[v]=M.start*o,u[v]=M.count,g[v]=M.index,v++}KN.reset()}else for(let y=0,b=l.length;y<b;y++)if(l[y].visible&&l[y].active){const S=l[y].geometryIndex;let T=!1;if(f&&(this.getMatrixAt(y,eo),this.getBoundingSphereAt(S,Lp).applyMatrix4(eo),T=!x.intersectsSphere(Lp,n)),!T){const M=h[S];c[v]=M.start*o,u[v]=M.count,g[v]=y,v++}}m.needsUpdate=!0,this._multiDrawCount=v,this._visibilityChanged=!1}onBeforeShadow(e,t,n,s,r,a){this.onBeforeRender(e,null,s,r,a)}}class Ir extends Es{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ye(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const DM=new z,LM=new z,X4=new Lt,U_=new Zf,D1=new Gs,ZN=new z,q4=new z;class mu extends Fn{constructor(e=new pn,t=new Ir){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let s=1,r=t.count;s<r;s++)DM.fromBufferAttribute(t,s-1),LM.fromBufferAttribute(t,s),n[s]=n[s-1],n[s]+=DM.distanceTo(LM);e.setAttribute("lineDistance",new qt(n,1))}else Se("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),D1.copy(n.boundingSphere),D1.applyMatrix4(s),D1.radius+=r,e.ray.intersectsSphere(D1)===!1)return;X4.copy(s).invert(),U_.copy(e.ray).applyMatrix4(X4);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=this.isLineSegments?2:1,u=n.index,f=n.attributes.position;if(u!==null){const m=Math.max(0,a.start),g=Math.min(u.count,a.start+a.count);for(let x=m,v=g-1;x<v;x+=c){const y=u.getX(x),b=u.getX(x+1),S=L1(this,e,U_,l,y,b,x);S&&t.push(S)}if(this.isLineLoop){const x=u.getX(g-1),v=u.getX(m),y=L1(this,e,U_,l,x,v,g-1);y&&t.push(y)}}else{const m=Math.max(0,a.start),g=Math.min(f.count,a.start+a.count);for(let x=m,v=g-1;x<v;x+=c){const y=L1(this,e,U_,l,x,x+1,x);y&&t.push(y)}if(this.isLineLoop){const x=L1(this,e,U_,l,g-1,m,g-1);x&&t.push(x)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}}function L1(i,e,t,n,s,r,a){const o=i.geometry.attributes.position;if(DM.fromBufferAttribute(o,s),LM.fromBufferAttribute(o,r),t.distanceSqToSegment(DM,LM,ZN,q4)>n)return;ZN.applyMatrix4(i.matrixWorld);const c=e.ray.origin.distanceTo(ZN);if(!(c<e.near||c>e.far))return{distance:c,point:q4.clone().applyMatrix4(i.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:i}}const j4=new z,Y4=new z;class Zl extends mu{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let s=0,r=t.count;s<r;s+=2)j4.fromBufferAttribute(t,s),Y4.fromBufferAttribute(t,s+1),n[s]=s===0?0:n[s-1],n[s+1]=n[s]+j4.distanceTo(Y4);e.setAttribute("lineDistance",new qt(n,1))}else Se("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class $E extends mu{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Nx extends Es{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ye(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const K4=new Lt,RD=new Zf,U1=new Gs,I1=new z;class eC extends Fn{constructor(e=new pn,t=new Nx){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,r=e.params.Points.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),U1.copy(n.boundingSphere),U1.applyMatrix4(s),U1.radius+=r,e.ray.intersectsSphere(U1)===!1)return;K4.copy(s).invert(),RD.copy(e.ray).applyMatrix4(K4);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=n.index,h=n.attributes.position;if(c!==null){const f=Math.max(0,a.start),m=Math.min(c.count,a.start+a.count);for(let g=f,x=m;g<x;g++){const v=c.getX(g);I1.fromBufferAttribute(h,v),Z4(I1,v,l,s,e,t,this)}}else{const f=Math.max(0,a.start),m=Math.min(h.count,a.start+a.count);for(let g=f,x=m;g<x;g++)I1.fromBufferAttribute(h,g),Z4(I1,g,l,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}}function Z4(i,e,t,n,s,r,a){const o=RD.distanceSqToPoint(i);if(o<t){const l=new z;RD.closestPointToPoint(i,l),l.applyMatrix4(n);const c=s.ray.origin.distanceTo(l);if(c<s.near||c>s.far)return;r.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class SU extends In{constructor(e,t,n,s,r=Jt,a=Jt,o,l,c){super(e,t,n,s,r,a,o,l,c),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const u=this;function h(){u.needsUpdate=!0,u._requestVideoFrameCallbackId=e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(h))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){this._requestVideoFrameCallbackId!==0&&(this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),this._requestVideoFrameCallbackId=0),super.dispose()}}class F9 extends SU{constructor(e,t,n,s,r,a,o,l){super({},e,t,n,s,r,a,o,l),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class US extends In{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=$n,this.minFilter=$n,this.generateMipmaps=!1,this.needsUpdate=!0}}class IS extends In{constructor(e,t,n,s,r,a,o,l,c,u,h,f){super(null,a,o,l,c,u,s,r,h,f),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class G9 extends IS{constructor(e,t,n,s,r,a){super(e,t,n,r,a),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=ui,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class z9 extends IS{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,Sa),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class TU extends In{constructor(e,t,n,s,r,a,o,l,c){super(e,t,n,s,r,a,o,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class tr extends In{constructor(e,t,n=Jn,s,r,a,o=$n,l=$n,c,u=lr,h=1){if(u!==lr&&u!==kr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const f={width:e,height:t,depth:h};super(f,s,r,a,o,l,u,n,c),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new dh(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class tC extends tr{constructor(e,t=Jn,n=Sa,s,r,a=$n,o=$n,l,c=lr){const u={width:e,height:e,depth:1},h=[u,u,u,u,u,u];super(e,e,t,n,s,r,a,o,l,c),this.image=h,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class nC extends In{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class PS extends pn{constructor(e=1,t=1,n=4,s=8,r=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:s,heightSegments:r},t=Math.max(0,t),n=Math.max(1,Math.floor(n)),s=Math.max(3,Math.floor(s)),r=Math.max(1,Math.floor(r));const a=[],o=[],l=[],c=[],u=t/2,h=Math.PI/2*e,f=t,m=2*h+f,g=n*2+r,x=s+1,v=new z,y=new z;for(let b=0;b<=g;b++){let S=0,T=0,M=0,C=0;if(b<=n){const E=b/n,B=E*Math.PI/2;T=-u-e*Math.cos(B),M=e*Math.sin(B),C=-e*Math.cos(B),S=E*h}else if(b<=n+r){const E=(b-n)/r;T=-u+E*t,M=e,C=0,S=h+E*f}else{const E=(b-n-r)/n,B=E*Math.PI/2;T=u+e*Math.sin(B),M=e*Math.cos(B),C=e*Math.sin(B),S=h+f+E*h}const w=Math.max(0,Math.min(1,S/m));let N=0;b===0?N=.5/s:b===g&&(N=-.5/s);for(let E=0;E<=s;E++){const B=E/s,U=B*Math.PI*2,H=Math.sin(U),F=Math.cos(U);y.x=-M*F,y.y=T,y.z=M*H,o.push(y.x,y.y,y.z),v.set(-M*F,C,M*H),v.normalize(),l.push(v.x,v.y,v.z),c.push(B+N,w)}if(b>0){const E=(b-1)*x;for(let B=0;B<s;B++){const U=E+B,H=E+B+1,F=b*x+B,V=b*x+B+1;a.push(U,H,F),a.push(H,V,F)}}}this.setIndex(a),this.setAttribute("position",new qt(o,3)),this.setAttribute("normal",new qt(l,3)),this.setAttribute("uv",new qt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new PS(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class OS extends pn{constructor(e=1,t=32,n=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:s},t=Math.max(3,t);const r=[],a=[],o=[],l=[],c=new z,u=new Ae;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let h=0,f=3;h<=t;h++,f+=3){const m=n+h/t*s;c.x=e*Math.cos(m),c.y=e*Math.sin(m),a.push(c.x,c.y,c.z),o.push(0,0,1),u.x=(a[f]/e+1)/2,u.y=(a[f+1]/e+1)/2,l.push(u.x,u.y)}for(let h=1;h<=t;h++)r.push(h,h+1,0);this.setIndex(r),this.setAttribute("position",new qt(a,3)),this.setAttribute("normal",new qt(o,3)),this.setAttribute("uv",new qt(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new OS(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class bg extends pn{constructor(e=1,t=1,n=1,s=32,r=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:s,heightSegments:r,openEnded:a,thetaStart:o,thetaLength:l};const c=this;s=Math.floor(s),r=Math.floor(r);const u=[],h=[],f=[],m=[];let g=0;const x=[],v=n/2;let y=0;b(),a===!1&&(e>0&&S(!0),t>0&&S(!1)),this.setIndex(u),this.setAttribute("position",new qt(h,3)),this.setAttribute("normal",new qt(f,3)),this.setAttribute("uv",new qt(m,2));function b(){const T=new z,M=new z;let C=0;const w=(t-e)/n;for(let N=0;N<=r;N++){const E=[],B=N/r,U=B*(t-e)+e;for(let H=0;H<=s;H++){const F=H/s,V=F*l+o,Y=Math.sin(V),P=Math.cos(V);M.x=U*Y,M.y=-B*n+v,M.z=U*P,h.push(M.x,M.y,M.z),T.set(Y,w,P).normalize(),f.push(T.x,T.y,T.z),m.push(F,1-B),E.push(g++)}x.push(E)}for(let N=0;N<s;N++)for(let E=0;E<r;E++){const B=x[E][N],U=x[E+1][N],H=x[E+1][N+1],F=x[E][N+1];(e>0||E!==0)&&(u.push(B,U,F),C+=3),(t>0||E!==r-1)&&(u.push(U,H,F),C+=3)}c.addGroup(y,C,0),y+=C}function S(T){const M=g,C=new Ae,w=new z;let N=0;const E=T===!0?e:t,B=T===!0?1:-1;for(let H=1;H<=s;H++)h.push(0,v*B,0),f.push(0,B,0),m.push(.5,.5),g++;const U=g;for(let H=0;H<=s;H++){const V=H/s*l+o,Y=Math.cos(V),P=Math.sin(V);w.x=E*P,w.y=v*B,w.z=E*Y,h.push(w.x,w.y,w.z),f.push(0,B,0),C.x=Y*.5+.5,C.y=P*.5*B+.5,m.push(C.x,C.y),g++}for(let H=0;H<s;H++){const F=M+H,V=U+H;T===!0?u.push(V,V+1,F):u.push(V+1,V,F),N+=3}c.addGroup(y,N,T===!0?1:2),y+=N}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bg(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Bx extends bg{constructor(e=1,t=1,n=32,s=1,r=!1,a=0,o=Math.PI*2){super(0,e,t,n,s,r,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:s,openEnded:r,thetaStart:a,thetaLength:o}}static fromJSON(e){return new Bx(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Vh extends pn{constructor(e=[],t=[],n=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:s};const r=[],a=[];o(s),c(n),u(),this.setAttribute("position",new qt(r,3)),this.setAttribute("normal",new qt(r.slice(),3)),this.setAttribute("uv",new qt(a,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function o(b){const S=new z,T=new z,M=new z;for(let C=0;C<t.length;C+=3)m(t[C+0],S),m(t[C+1],T),m(t[C+2],M),l(S,T,M,b)}function l(b,S,T,M){const C=M+1,w=[];for(let N=0;N<=C;N++){w[N]=[];const E=b.clone().lerp(T,N/C),B=S.clone().lerp(T,N/C),U=C-N;for(let H=0;H<=U;H++)H===0&&N===C?w[N][H]=E:w[N][H]=E.clone().lerp(B,H/U)}for(let N=0;N<C;N++)for(let E=0;E<2*(C-N)-1;E++){const B=Math.floor(E/2);E%2===0?(f(w[N][B+1]),f(w[N+1][B]),f(w[N][B])):(f(w[N][B+1]),f(w[N+1][B+1]),f(w[N+1][B]))}}function c(b){const S=new z;for(let T=0;T<r.length;T+=3)S.x=r[T+0],S.y=r[T+1],S.z=r[T+2],S.normalize().multiplyScalar(b),r[T+0]=S.x,r[T+1]=S.y,r[T+2]=S.z}function u(){const b=new z;for(let S=0;S<r.length;S+=3){b.x=r[S+0],b.y=r[S+1],b.z=r[S+2];const T=v(b)/2/Math.PI+.5,M=y(b)/Math.PI+.5;a.push(T,1-M)}g(),h()}function h(){for(let b=0;b<a.length;b+=6){const S=a[b+0],T=a[b+2],M=a[b+4],C=Math.max(S,T,M),w=Math.min(S,T,M);C>.9&&w<.1&&(S<.2&&(a[b+0]+=1),T<.2&&(a[b+2]+=1),M<.2&&(a[b+4]+=1))}}function f(b){r.push(b.x,b.y,b.z)}function m(b,S){const T=b*3;S.x=e[T+0],S.y=e[T+1],S.z=e[T+2]}function g(){const b=new z,S=new z,T=new z,M=new z,C=new Ae,w=new Ae,N=new Ae;for(let E=0,B=0;E<r.length;E+=9,B+=6){b.set(r[E+0],r[E+1],r[E+2]),S.set(r[E+3],r[E+4],r[E+5]),T.set(r[E+6],r[E+7],r[E+8]),C.set(a[B+0],a[B+1]),w.set(a[B+2],a[B+3]),N.set(a[B+4],a[B+5]),M.copy(b).add(S).add(T).divideScalar(3);const U=v(M);x(C,B+0,b,U),x(w,B+2,S,U),x(N,B+4,T,U)}}function x(b,S,T,M){M<0&&b.x===1&&(a[S]=b.x-1),T.x===0&&T.z===0&&(a[S]=M/2/Math.PI+.5)}function v(b){return Math.atan2(b.z,-b.x)}function y(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Vh(e.vertices,e.indices,e.radius,e.detail)}}class FS extends Vh{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,s=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-n,0,-s,n,0,s,-n,0,s,n,-s,-n,0,-s,n,0,s,-n,0,s,n,0,-n,0,-s,n,0,-s,-n,0,s,n,0,s],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,a,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new FS(e.radius,e.detail)}}const P1=new z,O1=new z,JN=new z,F1=new Ga;class AU extends pn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const s=Math.pow(10,4),r=Math.cos(Am*t),a=e.getIndex(),o=e.getAttribute("position"),l=a?a.count:o.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),f={},m=[];for(let g=0;g<l;g+=3){a?(c[0]=a.getX(g),c[1]=a.getX(g+1),c[2]=a.getX(g+2)):(c[0]=g,c[1]=g+1,c[2]=g+2);const{a:x,b:v,c:y}=F1;if(x.fromBufferAttribute(o,c[0]),v.fromBufferAttribute(o,c[1]),y.fromBufferAttribute(o,c[2]),F1.getNormal(JN),h[0]=`${Math.round(x.x*s)},${Math.round(x.y*s)},${Math.round(x.z*s)}`,h[1]=`${Math.round(v.x*s)},${Math.round(v.y*s)},${Math.round(v.z*s)}`,h[2]=`${Math.round(y.x*s)},${Math.round(y.y*s)},${Math.round(y.z*s)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let b=0;b<3;b++){const S=(b+1)%3,T=h[b],M=h[S],C=F1[u[b]],w=F1[u[S]],N=`${T}_${M}`,E=`${M}_${T}`;E in f&&f[E]?(JN.dot(f[E].normal)<=r&&(m.push(C.x,C.y,C.z),m.push(w.x,w.y,w.z)),f[E]=null):N in f||(f[N]={index0:c[b],index1:c[S],normal:JN.clone()})}}for(const g in f)if(f[g]){const{index0:x,index1:v}=f[g];P1.fromBufferAttribute(o,x),O1.fromBufferAttribute(o,v),m.push(P1.x,P1.y,P1.z),m.push(O1.x,O1.y,O1.z)}this.setAttribute("position",new qt(m,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Jl{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){Se("Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,s=this.getPoint(0),r=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),r+=n.distanceTo(s),t.push(r),s=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let s=0;const r=n.length;let a;t?a=t:a=e*n[r-1];let o=0,l=r-1,c;for(;o<=l;)if(s=Math.floor(o+(l-o)/2),c=n[s]-a,c<0)o=s+1;else if(c>0)l=s-1;else{l=s;break}if(s=l,n[s]===a)return s/(r-1);const u=n[s],f=n[s+1]-u,m=(a-u)/f;return(s+m)/(r-1)}getTangent(e,t){let s=e-1e-4,r=e+1e-4;s<0&&(s=0),r>1&&(r=1);const a=this.getPoint(s),o=this.getPoint(r),l=t||(a.isVector2?new Ae:new z);return l.copy(o).sub(a).normalize(),l}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new z,s=[],r=[],a=[],o=new z,l=new Lt;for(let m=0;m<=e;m++){const g=m/e;s[m]=this.getTangentAt(g,new z)}r[0]=new z,a[0]=new z;let c=Number.MAX_VALUE;const u=Math.abs(s[0].x),h=Math.abs(s[0].y),f=Math.abs(s[0].z);u<=c&&(c=u,n.set(1,0,0)),h<=c&&(c=h,n.set(0,1,0)),f<=c&&n.set(0,0,1),o.crossVectors(s[0],n).normalize(),r[0].crossVectors(s[0],o),a[0].crossVectors(s[0],r[0]);for(let m=1;m<=e;m++){if(r[m]=r[m-1].clone(),a[m]=a[m-1].clone(),o.crossVectors(s[m-1],s[m]),o.length()>Number.EPSILON){o.normalize();const g=Math.acos(yn(s[m-1].dot(s[m]),-1,1));r[m].applyMatrix4(l.makeRotationAxis(o,g))}a[m].crossVectors(s[m],r[m])}if(t===!0){let m=Math.acos(yn(r[0].dot(r[e]),-1,1));m/=e,s[0].dot(o.crossVectors(r[0],r[e]))>0&&(m=-m);for(let g=1;g<=e;g++)r[g].applyMatrix4(l.makeRotationAxis(s[g],m*g)),a[g].crossVectors(s[g],r[g])}return{tangents:s,normals:r,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class GS extends Jl{constructor(e=0,t=0,n=1,s=1,r=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=s,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,t=new Ae){const n=t,s=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const a=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=s;for(;r>s;)r-=s;r<Number.EPSILON&&(a?r=0:r=s),this.aClockwise===!0&&!a&&(r===s?r=-s:r=r-s);const o=this.aStartAngle+e*r;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),f=l-this.aX,m=c-this.aY;l=f*u-m*h+this.aX,c=f*h+m*u+this.aY}return n.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class MU extends GS{constructor(e,t,n,s,r,a){super(e,t,n,n,s,r,a),this.isArcCurve=!0,this.type="ArcCurve"}}function EU(){let i=0,e=0,t=0,n=0;function s(r,a,o,l){i=r,e=o,t=-3*r+3*a-2*o-l,n=2*r-2*a+o+l}return{initCatmullRom:function(r,a,o,l,c){s(a,o,c*(o-r),c*(l-a))},initNonuniformCatmullRom:function(r,a,o,l,c,u,h){let f=(a-r)/c-(o-r)/(c+u)+(o-a)/u,m=(o-a)/u-(l-a)/(u+h)+(l-o)/h;f*=u,m*=u,s(a,o,f,m)},calc:function(r){const a=r*r,o=a*r;return i+e*r+t*a+n*o}}}const G1=new z,QN=new EU,$N=new EU,e2=new EU;class CU extends Jl{constructor(e=[],t=!1,n="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=s}getPoint(e,t=new z){const n=t,s=this.points,r=s.length,a=(r-(this.closed?0:1))*e;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/r)+1)*r:l===0&&o===r-1&&(o=r-2,l=1);let c,u;this.closed||o>0?c=s[(o-1)%r]:(G1.subVectors(s[0],s[1]).add(s[0]),c=G1);const h=s[o%r],f=s[(o+1)%r];if(this.closed||o+2<r?u=s[(o+2)%r]:(G1.subVectors(s[r-1],s[r-2]).add(s[r-1]),u=G1),this.curveType==="centripetal"||this.curveType==="chordal"){const m=this.curveType==="chordal"?.5:.25;let g=Math.pow(c.distanceToSquared(h),m),x=Math.pow(h.distanceToSquared(f),m),v=Math.pow(f.distanceToSquared(u),m);x<1e-4&&(x=1),g<1e-4&&(g=x),v<1e-4&&(v=x),QN.initNonuniformCatmullRom(c.x,h.x,f.x,u.x,g,x,v),$N.initNonuniformCatmullRom(c.y,h.y,f.y,u.y,g,x,v),e2.initNonuniformCatmullRom(c.z,h.z,f.z,u.z,g,x,v)}else this.curveType==="catmullrom"&&(QN.initCatmullRom(c.x,h.x,f.x,u.x,this.tension),$N.initCatmullRom(c.y,h.y,f.y,u.y,this.tension),e2.initCatmullRom(c.z,h.z,f.z,u.z,this.tension));return n.set(QN.calc(l),$N.calc(l),e2.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(new z().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function J4(i,e,t,n,s){const r=(n-e)*.5,a=(s-t)*.5,o=i*i,l=i*o;return(2*t-2*n+r+a)*l+(-3*t+3*n-2*r-a)*o+r*i+t}function Iie(i,e){const t=1-i;return t*t*e}function Pie(i,e){return 2*(1-i)*i*e}function Oie(i,e){return i*i*e}function Ov(i,e,t,n){return Iie(i,e)+Pie(i,t)+Oie(i,n)}function Fie(i,e){const t=1-i;return t*t*t*e}function Gie(i,e){const t=1-i;return 3*t*t*i*e}function zie(i,e){return 3*(1-i)*i*i*e}function Vie(i,e){return i*i*i*e}function Fv(i,e,t,n,s){return Fie(i,e)+Gie(i,t)+zie(i,n)+Vie(i,s)}class iC extends Jl{constructor(e=new Ae,t=new Ae,n=new Ae,s=new Ae){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new Ae){const n=t,s=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(Fv(e,s.x,r.x,a.x,o.x),Fv(e,s.y,r.y,a.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class wU extends Jl{constructor(e=new z,t=new z,n=new z,s=new z){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new z){const n=t,s=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(Fv(e,s.x,r.x,a.x,o.x),Fv(e,s.y,r.y,a.y,o.y),Fv(e,s.z,r.z,a.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class sC extends Jl{constructor(e=new Ae,t=new Ae){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Ae){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Ae){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class RU extends Jl{constructor(e=new z,t=new z){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new z){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new z){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class rC extends Jl{constructor(e=new Ae,t=new Ae,n=new Ae){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Ae){const n=t,s=this.v0,r=this.v1,a=this.v2;return n.set(Ov(e,s.x,r.x,a.x),Ov(e,s.y,r.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class aC extends Jl{constructor(e=new z,t=new z,n=new z){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new z){const n=t,s=this.v0,r=this.v1,a=this.v2;return n.set(Ov(e,s.x,r.x,a.x),Ov(e,s.y,r.y,a.y),Ov(e,s.z,r.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class oC extends Jl{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Ae){const n=t,s=this.points,r=(s.length-1)*e,a=Math.floor(r),o=r-a,l=s[a===0?a:a-1],c=s[a],u=s[a>s.length-2?s.length-1:a+1],h=s[a>s.length-3?s.length-1:a+2];return n.set(J4(o,l.x,c.x,u.x,h.x),J4(o,l.y,c.y,u.y,h.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(new Ae().fromArray(s))}return this}}var UM=Object.freeze({__proto__:null,ArcCurve:MU,CatmullRomCurve3:CU,CubicBezierCurve:iC,CubicBezierCurve3:wU,EllipseCurve:GS,LineCurve:sC,LineCurve3:RU,QuadraticBezierCurve:rC,QuadraticBezierCurve3:aC,SplineCurve:oC});class NU extends Jl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new UM[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),s=this.getCurveLengths();let r=0;for(;r<s.length;){if(s[r]>=n){const a=s[r]-n,o=this.curves[r],l=o.getLength(),c=l===0?0:1-a/l;return o.getPointAt(c,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,s=this.curves.length;n<s;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let s=0,r=this.curves;s<r.length;s++){const a=r[s],o=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,l=a.getPoints(o);for(let c=0;c<l.length;c++){const u=l[c];n&&n.equals(u)||(t.push(u),n=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const s=e.curves[t];this.curves.push(new UM[s.type]().fromJSON(s))}return this}}class Tb extends NU{constructor(e){super(),this.type="Path",this.currentPoint=new Ae,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new sC(this.currentPoint.clone(),new Ae(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,s){const r=new rC(this.currentPoint.clone(),new Ae(e,t),new Ae(n,s));return this.curves.push(r),this.currentPoint.set(n,s),this}bezierCurveTo(e,t,n,s,r,a){const o=new iC(this.currentPoint.clone(),new Ae(e,t),new Ae(n,s),new Ae(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new oC(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,s,r,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,t+l,n,s,r,a),this}absarc(e,t,n,s,r,a){return this.absellipse(e,t,n,n,s,r,a),this}ellipse(e,t,n,s,r,a,o,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,n,s,r,a,o,l),this}absellipse(e,t,n,s,r,a,o,l){const c=new GS(e,t,n,s,r,a,o,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class sf extends Tb{constructor(e){super(e),this.uuid=Ko(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,s=this.holes.length;n<s;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const s=e.holes[t];this.holes.push(new Tb().fromJSON(s))}return this}}function Hie(i,e,t=2){const n=e&&e.length,s=n?e[0]*t:i.length;let r=V9(i,0,s,t,!0);const a=[];if(!r||r.next===r.prev)return a;let o,l,c;if(n&&(r=jie(i,e,r,t)),i.length>80*t){o=i[0],l=i[1];let u=o,h=l;for(let f=t;f<s;f+=t){const m=i[f],g=i[f+1];m<o&&(o=m),g<l&&(l=g),m>u&&(u=m),g>h&&(h=g)}c=Math.max(u-o,h-l),c=c!==0?32767/c:0}return Ab(r,a,t,o,l,c,0),a}function V9(i,e,t,n,s){let r;if(s===sse(i,e,t,n)>0)for(let a=e;a<t;a+=n)r=Q4(a/n|0,i[a],i[a+1],r);else for(let a=t-n;a>=e;a-=n)r=Q4(a/n|0,i[a],i[a+1],r);return r&&jy(r,r.next)&&(Eb(r),r=r.next),r}function eg(i,e){if(!i)return i;e||(e=i);let t=i,n;do if(n=!1,!t.steiner&&(jy(t,t.next)||fs(t.prev,t,t.next)===0)){if(Eb(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function Ab(i,e,t,n,s,r,a){if(!i)return;!a&&r&&Qie(i,n,s,r);let o=i;for(;i.prev!==i.next;){const l=i.prev,c=i.next;if(r?Wie(i,n,s,r):kie(i)){e.push(l.i,i.i,c.i),Eb(i),i=c.next,o=c.next;continue}if(i=c,i===o){a?a===1?(i=Xie(eg(i),e),Ab(i,e,t,n,s,r,2)):a===2&&qie(i,e,t,n,s,r):Ab(eg(i),e,t,n,s,r,1);break}}}function kie(i){const e=i.prev,t=i,n=i.next;if(fs(e,t,n)>=0)return!1;const s=e.x,r=t.x,a=n.x,o=e.y,l=t.y,c=n.y,u=Math.min(s,r,a),h=Math.min(o,l,c),f=Math.max(s,r,a),m=Math.max(o,l,c);let g=n.next;for(;g!==e;){if(g.x>=u&&g.x<=f&&g.y>=h&&g.y<=m&&hv(s,o,r,l,a,c,g.x,g.y)&&fs(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function Wie(i,e,t,n){const s=i.prev,r=i,a=i.next;if(fs(s,r,a)>=0)return!1;const o=s.x,l=r.x,c=a.x,u=s.y,h=r.y,f=a.y,m=Math.min(o,l,c),g=Math.min(u,h,f),x=Math.max(o,l,c),v=Math.max(u,h,f),y=ND(m,g,e,t,n),b=ND(x,v,e,t,n);let S=i.prevZ,T=i.nextZ;for(;S&&S.z>=y&&T&&T.z<=b;){if(S.x>=m&&S.x<=x&&S.y>=g&&S.y<=v&&S!==s&&S!==a&&hv(o,u,l,h,c,f,S.x,S.y)&&fs(S.prev,S,S.next)>=0||(S=S.prevZ,T.x>=m&&T.x<=x&&T.y>=g&&T.y<=v&&T!==s&&T!==a&&hv(o,u,l,h,c,f,T.x,T.y)&&fs(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;S&&S.z>=y;){if(S.x>=m&&S.x<=x&&S.y>=g&&S.y<=v&&S!==s&&S!==a&&hv(o,u,l,h,c,f,S.x,S.y)&&fs(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;T&&T.z<=b;){if(T.x>=m&&T.x<=x&&T.y>=g&&T.y<=v&&T!==s&&T!==a&&hv(o,u,l,h,c,f,T.x,T.y)&&fs(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function Xie(i,e){let t=i;do{const n=t.prev,s=t.next.next;!jy(n,s)&&k9(n,t,t.next,s)&&Mb(n,s)&&Mb(s,n)&&(e.push(n.i,t.i,s.i),Eb(t),Eb(t.next),t=i=s),t=t.next}while(t!==i);return eg(t)}function qie(i,e,t,n,s,r){let a=i;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&tse(a,o)){let l=W9(a,o);a=eg(a,a.next),l=eg(l,l.next),Ab(a,e,t,n,s,r,0),Ab(l,e,t,n,s,r,0);return}o=o.next}a=a.next}while(a!==i)}function jie(i,e,t,n){const s=[];for(let r=0,a=e.length;r<a;r++){const o=e[r]*n,l=r<a-1?e[r+1]*n:i.length,c=V9(i,o,l,n,!1);c===c.next&&(c.steiner=!0),s.push(ese(c))}s.sort(Yie);for(let r=0;r<s.length;r++)t=Kie(s[r],t);return t}function Yie(i,e){let t=i.x-e.x;if(t===0&&(t=i.y-e.y,t===0)){const n=(i.next.y-i.y)/(i.next.x-i.x),s=(e.next.y-e.y)/(e.next.x-e.x);t=n-s}return t}function Kie(i,e){const t=Zie(i,e);if(!t)return e;const n=W9(t,i);return eg(n,n.next),eg(t,t.next)}function Zie(i,e){let t=e;const n=i.x,s=i.y;let r=-1/0,a;if(jy(i,t))return t;do{if(jy(i,t.next))return t.next;if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){const h=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(h<=n&&h>r&&(r=h,a=t.x<t.next.x?t:t.next,h===n))return a}t=t.next}while(t!==e);if(!a)return null;const o=a,l=a.x,c=a.y;let u=1/0;t=a;do{if(n>=t.x&&t.x>=l&&n!==t.x&&H9(s<c?n:r,s,l,c,s<c?r:n,s,t.x,t.y)){const h=Math.abs(s-t.y)/(n-t.x);Mb(t,i)&&(h<u||h===u&&(t.x>a.x||t.x===a.x&&Jie(a,t)))&&(a=t,u=h)}t=t.next}while(t!==o);return a}function Jie(i,e){return fs(i.prev,i,e.prev)<0&&fs(e.next,i,i.next)<0}function Qie(i,e,t,n){let s=i;do s.z===0&&(s.z=ND(s.x,s.y,e,t,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,$ie(s)}function $ie(i){let e,t=1;do{let n=i,s;i=null;let r=null;for(e=0;n;){e++;let a=n,o=0;for(let c=0;c<t&&(o++,a=a.nextZ,!!a);c++);let l=t;for(;o>0||l>0&&a;)o!==0&&(l===0||!a||n.z<=a.z)?(s=n,n=n.nextZ,o--):(s=a,a=a.nextZ,l--),r?r.nextZ=s:i=s,s.prevZ=r,r=s;n=a}r.nextZ=null,t*=2}while(e>1);return i}function ND(i,e,t,n,s){return i=(i-t)*s|0,e=(e-n)*s|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function ese(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function H9(i,e,t,n,s,r,a,o){return(s-a)*(e-o)>=(i-a)*(r-o)&&(i-a)*(n-o)>=(t-a)*(e-o)&&(t-a)*(r-o)>=(s-a)*(n-o)}function hv(i,e,t,n,s,r,a,o){return!(i===a&&e===o)&&H9(i,e,t,n,s,r,a,o)}function tse(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!nse(i,e)&&(Mb(i,e)&&Mb(e,i)&&ise(i,e)&&(fs(i.prev,i,e.prev)||fs(i,e.prev,e))||jy(i,e)&&fs(i.prev,i,i.next)>0&&fs(e.prev,e,e.next)>0)}function fs(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function jy(i,e){return i.x===e.x&&i.y===e.y}function k9(i,e,t,n){const s=V1(fs(i,e,t)),r=V1(fs(i,e,n)),a=V1(fs(t,n,i)),o=V1(fs(t,n,e));return!!(s!==r&&a!==o||s===0&&z1(i,t,e)||r===0&&z1(i,n,e)||a===0&&z1(t,i,n)||o===0&&z1(t,e,n))}function z1(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function V1(i){return i>0?1:i<0?-1:0}function nse(i,e){let t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&k9(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function Mb(i,e){return fs(i.prev,i,i.next)<0?fs(i,e,i.next)>=0&&fs(i,i.prev,e)>=0:fs(i,e,i.prev)<0||fs(i,i.next,e)<0}function ise(i,e){let t=i,n=!1;const s=(i.x+e.x)/2,r=(i.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&s<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==i);return n}function W9(i,e){const t=BD(i.i,i.x,i.y),n=BD(e.i,e.x,e.y),s=i.next,r=e.prev;return i.next=e,e.prev=i,t.next=s,s.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function Q4(i,e,t,n){const s=BD(i,e,t);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function Eb(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function BD(i,e,t){return{i,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function sse(i,e,t,n){let s=0;for(let r=e,a=t-n;r<t;r+=n)s+=(i[a]-i[r])*(i[r+1]+i[a+1]),a=r;return s}class rse{static triangulate(e,t,n=2){return Hie(e,t,n)}}class Ul{static area(e){const t=e.length;let n=0;for(let s=t-1,r=0;r<t;s=r++)n+=e[s].x*e[r].y-e[r].x*e[s].y;return n*.5}static isClockWise(e){return Ul.area(e)<0}static triangulateShape(e,t){const n=[],s=[],r=[];$4(e),eV(n,e);let a=e.length;t.forEach($4);for(let l=0;l<t.length;l++)s.push(a),a+=t[l].length,eV(n,t[l]);const o=rse.triangulate(n,s);for(let l=0;l<o.length;l+=3)r.push(o.slice(l,l+3));return r}}function $4(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function eV(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class zS extends pn{constructor(e=new sf([new Ae(.5,.5),new Ae(-.5,.5),new Ae(-.5,-.5),new Ae(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,s=[],r=[];for(let o=0,l=e.length;o<l;o++){const c=e[o];a(c)}this.setAttribute("position",new qt(s,3)),this.setAttribute("uv",new qt(r,2)),this.computeVertexNormals();function a(o){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,h=t.depth!==void 0?t.depth:1;let f=t.bevelEnabled!==void 0?t.bevelEnabled:!0,m=t.bevelThickness!==void 0?t.bevelThickness:.2,g=t.bevelSize!==void 0?t.bevelSize:m-.1,x=t.bevelOffset!==void 0?t.bevelOffset:0,v=t.bevelSegments!==void 0?t.bevelSegments:3;const y=t.extrudePath,b=t.UVGenerator!==void 0?t.UVGenerator:ase;let S,T=!1,M,C,w,N;if(y){S=y.getSpacedPoints(u),T=!0,f=!1;const Ie=y.isCatmullRomCurve3?y.closed:!1;M=y.computeFrenetFrames(u,Ie),C=new z,w=new z,N=new z}f||(v=0,m=0,g=0,x=0);const E=o.extractPoints(c);let B=E.shape;const U=E.holes;if(!Ul.isClockWise(B)){B=B.reverse();for(let Ie=0,ke=U.length;Ie<ke;Ie++){const Ve=U[Ie];Ul.isClockWise(Ve)&&(U[Ie]=Ve.reverse())}}function F(Ie){const Ve=10000000000000001e-36;let at=Ie[0];for(let Z=1;Z<=Ie.length;Z++){const zt=Z%Ie.length,st=Ie[zt],Vt=st.x-at.x,Je=st.y-at.y,K=Vt*Vt+Je*Je,I=Math.max(Math.abs(st.x),Math.abs(st.y),Math.abs(at.x),Math.abs(at.y)),ue=Ve*I*I;if(K<=ue){Ie.splice(zt,1),Z--;continue}at=st}}F(B),U.forEach(F);const V=U.length,Y=B;for(let Ie=0;Ie<V;Ie++){const ke=U[Ie];B=B.concat(ke)}function P(Ie,ke,Ve){return ke||De("ExtrudeGeometry: vec does not exist"),Ie.clone().addScaledVector(ke,Ve)}const X=B.length;function J(Ie,ke,Ve){let at,Z,zt;const st=Ie.x-ke.x,Vt=Ie.y-ke.y,Je=Ve.x-Ie.x,K=Ve.y-Ie.y,I=st*st+Vt*Vt,ue=st*K-Vt*Je;if(Math.abs(ue)>Number.EPSILON){const Ne=Math.sqrt(I),ze=Math.sqrt(Je*Je+K*K),we=ke.x-Vt/Ne,Ut=ke.y+st/Ne,dt=Ve.x-K/ze,Pt=Ve.y+Je/ze,Qt=((dt-we)*K-(Pt-Ut)*Je)/(st*K-Vt*Je);at=we+st*Qt-Ie.x,Z=Ut+Vt*Qt-Ie.y;const Xe=at*at+Z*Z;if(Xe<=2)return new Ae(at,Z);zt=Math.sqrt(Xe/2)}else{let Ne=!1;st>Number.EPSILON?Je>Number.EPSILON&&(Ne=!0):st<-Number.EPSILON?Je<-Number.EPSILON&&(Ne=!0):Math.sign(Vt)===Math.sign(K)&&(Ne=!0),Ne?(at=-Vt,Z=st,zt=Math.sqrt(I)):(at=st,Z=Vt,zt=Math.sqrt(I/2))}return new Ae(at/zt,Z/zt)}const re=[];for(let Ie=0,ke=Y.length,Ve=ke-1,at=Ie+1;Ie<ke;Ie++,Ve++,at++)Ve===ke&&(Ve=0),at===ke&&(at=0),re[Ie]=J(Y[Ie],Y[Ve],Y[at]);const ne=[];let ge,Te=re.concat();for(let Ie=0,ke=V;Ie<ke;Ie++){const Ve=U[Ie];ge=[];for(let at=0,Z=Ve.length,zt=Z-1,st=at+1;at<Z;at++,zt++,st++)zt===Z&&(zt=0),st===Z&&(st=0),ge[at]=J(Ve[at],Ve[zt],Ve[st]);ne.push(ge),Te=Te.concat(ge)}let Be;if(v===0)Be=Ul.triangulateShape(Y,U);else{const Ie=[],ke=[];for(let Ve=0;Ve<v;Ve++){const at=Ve/v,Z=m*Math.cos(at*Math.PI/2),zt=g*Math.sin(at*Math.PI/2)+x;for(let st=0,Vt=Y.length;st<Vt;st++){const Je=P(Y[st],re[st],zt);Bt(Je.x,Je.y,-Z),at===0&&Ie.push(Je)}for(let st=0,Vt=V;st<Vt;st++){const Je=U[st];ge=ne[st];const K=[];for(let I=0,ue=Je.length;I<ue;I++){const Ne=P(Je[I],ge[I],zt);Bt(Ne.x,Ne.y,-Z),at===0&&K.push(Ne)}at===0&&ke.push(K)}}Be=Ul.triangulateShape(Ie,ke)}const et=Be.length,wt=g+x;for(let Ie=0;Ie<X;Ie++){const ke=f?P(B[Ie],Te[Ie],wt):B[Ie];T?(w.copy(M.normals[0]).multiplyScalar(ke.x),C.copy(M.binormals[0]).multiplyScalar(ke.y),N.copy(S[0]).add(w).add(C),Bt(N.x,N.y,N.z)):Bt(ke.x,ke.y,0)}for(let Ie=1;Ie<=u;Ie++)for(let ke=0;ke<X;ke++){const Ve=f?P(B[ke],Te[ke],wt):B[ke];T?(w.copy(M.normals[Ie]).multiplyScalar(Ve.x),C.copy(M.binormals[Ie]).multiplyScalar(Ve.y),N.copy(S[Ie]).add(w).add(C),Bt(N.x,N.y,N.z)):Bt(Ve.x,Ve.y,h/u*Ie)}for(let Ie=v-1;Ie>=0;Ie--){const ke=Ie/v,Ve=m*Math.cos(ke*Math.PI/2),at=g*Math.sin(ke*Math.PI/2)+x;for(let Z=0,zt=Y.length;Z<zt;Z++){const st=P(Y[Z],re[Z],at);Bt(st.x,st.y,h+Ve)}for(let Z=0,zt=U.length;Z<zt;Z++){const st=U[Z];ge=ne[Z];for(let Vt=0,Je=st.length;Vt<Je;Vt++){const K=P(st[Vt],ge[Vt],at);T?Bt(K.x,K.y+S[u-1].y,S[u-1].x+Ve):Bt(K.x,K.y,h+Ve)}}}be(),Re();function be(){const Ie=s.length/3;if(f){let ke=0,Ve=X*ke;for(let at=0;at<et;at++){const Z=Be[at];ht(Z[2]+Ve,Z[1]+Ve,Z[0]+Ve)}ke=u+v*2,Ve=X*ke;for(let at=0;at<et;at++){const Z=Be[at];ht(Z[0]+Ve,Z[1]+Ve,Z[2]+Ve)}}else{for(let ke=0;ke<et;ke++){const Ve=Be[ke];ht(Ve[2],Ve[1],Ve[0])}for(let ke=0;ke<et;ke++){const Ve=Be[ke];ht(Ve[0]+X*u,Ve[1]+X*u,Ve[2]+X*u)}}n.addGroup(Ie,s.length/3-Ie,0)}function Re(){const Ie=s.length/3;let ke=0;tt(Y,ke),ke+=Y.length;for(let Ve=0,at=U.length;Ve<at;Ve++){const Z=U[Ve];tt(Z,ke),ke+=Z.length}n.addGroup(Ie,s.length/3-Ie,1)}function tt(Ie,ke){let Ve=Ie.length;for(;--Ve>=0;){const at=Ve;let Z=Ve-1;Z<0&&(Z=Ie.length-1);for(let zt=0,st=u+v*2;zt<st;zt++){const Vt=X*zt,Je=X*(zt+1),K=ke+at+Vt,I=ke+Z+Vt,ue=ke+Z+Je,Ne=ke+at+Je;Ke(K,I,ue,Ne)}}}function Bt(Ie,ke,Ve){l.push(Ie),l.push(ke),l.push(Ve)}function ht(Ie,ke,Ve){jt(Ie),jt(ke),jt(Ve);const at=s.length/3,Z=b.generateTopUV(n,s,at-3,at-2,at-1);Mt(Z[0]),Mt(Z[1]),Mt(Z[2])}function Ke(Ie,ke,Ve,at){jt(Ie),jt(ke),jt(at),jt(ke),jt(Ve),jt(at);const Z=s.length/3,zt=b.generateSideWallUV(n,s,Z-6,Z-3,Z-2,Z-1);Mt(zt[0]),Mt(zt[1]),Mt(zt[3]),Mt(zt[1]),Mt(zt[2]),Mt(zt[3])}function jt(Ie){s.push(l[Ie*3+0]),s.push(l[Ie*3+1]),s.push(l[Ie*3+2])}function Mt(Ie){r.push(Ie.x),r.push(Ie.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return ose(t,n,e)}static fromJSON(e,t){const n=[];for(let r=0,a=e.shapes.length;r<a;r++){const o=t[e.shapes[r]];n.push(o)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new UM[s.type]().fromJSON(s)),new zS(n,e.options)}}const ase={generateTopUV:function(i,e,t,n,s){const r=e[t*3],a=e[t*3+1],o=e[n*3],l=e[n*3+1],c=e[s*3],u=e[s*3+1];return[new Ae(r,a),new Ae(o,l),new Ae(c,u)]},generateSideWallUV:function(i,e,t,n,s,r){const a=e[t*3],o=e[t*3+1],l=e[t*3+2],c=e[n*3],u=e[n*3+1],h=e[n*3+2],f=e[s*3],m=e[s*3+1],g=e[s*3+2],x=e[r*3],v=e[r*3+1],y=e[r*3+2];return Math.abs(o-u)<Math.abs(a-c)?[new Ae(a,1-l),new Ae(c,1-h),new Ae(f,1-g),new Ae(x,1-y)]:[new Ae(o,1-l),new Ae(u,1-h),new Ae(m,1-g),new Ae(v,1-y)]}};function ose(i,e,t){if(t.shapes=[],Array.isArray(i))for(let n=0,s=i.length;n<s;n++){const r=i[n];t.shapes.push(r.uuid)}else t.shapes.push(i.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class Dx extends Vh{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,s=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Dx(e.radius,e.detail)}}class VS extends pn{constructor(e=[new Ae(0,-.5),new Ae(.5,0),new Ae(0,.5)],t=12,n=0,s=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:s},t=Math.floor(t),s=yn(s,0,Math.PI*2);const r=[],a=[],o=[],l=[],c=[],u=1/t,h=new z,f=new Ae,m=new z,g=new z,x=new z;let v=0,y=0;for(let b=0;b<=e.length-1;b++)switch(b){case 0:v=e[b+1].x-e[b].x,y=e[b+1].y-e[b].y,m.x=y*1,m.y=-v,m.z=y*0,x.copy(m),m.normalize(),l.push(m.x,m.y,m.z);break;case e.length-1:l.push(x.x,x.y,x.z);break;default:v=e[b+1].x-e[b].x,y=e[b+1].y-e[b].y,m.x=y*1,m.y=-v,m.z=y*0,g.copy(m),m.x+=x.x,m.y+=x.y,m.z+=x.z,m.normalize(),l.push(m.x,m.y,m.z),x.copy(g)}for(let b=0;b<=t;b++){const S=n+b*u*s,T=Math.sin(S),M=Math.cos(S);for(let C=0;C<=e.length-1;C++){h.x=e[C].x*T,h.y=e[C].y,h.z=e[C].x*M,a.push(h.x,h.y,h.z),f.x=b/t,f.y=C/(e.length-1),o.push(f.x,f.y);const w=l[3*C+0]*T,N=l[3*C+1],E=l[3*C+0]*M;c.push(w,N,E)}}for(let b=0;b<t;b++)for(let S=0;S<e.length-1;S++){const T=S+b*e.length,M=T,C=T+e.length,w=T+e.length+1,N=T+1;r.push(M,C,N),r.push(w,N,C)}this.setIndex(r),this.setAttribute("position",new qt(a,3)),this.setAttribute("uv",new qt(o,2)),this.setAttribute("normal",new qt(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new VS(e.points,e.segments,e.phiStart,e.phiLength)}}class Lx extends Vh{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,s,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Lx(e.radius,e.detail)}}class Cc extends pn{constructor(e=1,t=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:s};const r=e/2,a=t/2,o=Math.floor(n),l=Math.floor(s),c=o+1,u=l+1,h=e/o,f=t/l,m=[],g=[],x=[],v=[];for(let y=0;y<u;y++){const b=y*f-a;for(let S=0;S<c;S++){const T=S*h-r;g.push(T,-b,0),x.push(0,0,1),v.push(S/o),v.push(1-y/l)}}for(let y=0;y<l;y++)for(let b=0;b<o;b++){const S=b+c*y,T=b+c*(y+1),M=b+1+c*(y+1),C=b+1+c*y;m.push(S,T,C),m.push(T,M,C)}this.setIndex(m),this.setAttribute("position",new qt(g,3)),this.setAttribute("normal",new qt(x,3)),this.setAttribute("uv",new qt(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Cc(e.width,e.height,e.widthSegments,e.heightSegments)}}class HS extends pn{constructor(e=.5,t=1,n=32,s=1,r=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:s,thetaStart:r,thetaLength:a},n=Math.max(3,n),s=Math.max(1,s);const o=[],l=[],c=[],u=[];let h=e;const f=(t-e)/s,m=new z,g=new Ae;for(let x=0;x<=s;x++){for(let v=0;v<=n;v++){const y=r+v/n*a;m.x=h*Math.cos(y),m.y=h*Math.sin(y),l.push(m.x,m.y,m.z),c.push(0,0,1),g.x=(m.x/t+1)/2,g.y=(m.y/t+1)/2,u.push(g.x,g.y)}h+=f}for(let x=0;x<s;x++){const v=x*(n+1);for(let y=0;y<n;y++){const b=y+v,S=b,T=b+n+1,M=b+n+2,C=b+1;o.push(S,T,C),o.push(T,M,C)}}this.setIndex(o),this.setAttribute("position",new qt(l,3)),this.setAttribute("normal",new qt(c,3)),this.setAttribute("uv",new qt(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new HS(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class kS extends pn{constructor(e=new sf([new Ae(0,.5),new Ae(-.5,-.5),new Ae(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],s=[],r=[],a=[];let o=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(o,l,u),o+=l,l=0;this.setIndex(n),this.setAttribute("position",new qt(s,3)),this.setAttribute("normal",new qt(r,3)),this.setAttribute("uv",new qt(a,2));function c(u){const h=s.length/3,f=u.extractPoints(t);let m=f.shape;const g=f.holes;Ul.isClockWise(m)===!1&&(m=m.reverse());for(let v=0,y=g.length;v<y;v++){const b=g[v];Ul.isClockWise(b)===!0&&(g[v]=b.reverse())}const x=Ul.triangulateShape(m,g);for(let v=0,y=g.length;v<y;v++){const b=g[v];m=m.concat(b)}for(let v=0,y=m.length;v<y;v++){const b=m[v];s.push(b.x,b.y,0),r.push(0,0,1),a.push(b.x,b.y)}for(let v=0,y=x.length;v<y;v++){const b=x[v],S=b[0]+h,T=b[1]+h,M=b[2]+h;n.push(S,T,M),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return lse(t,e)}static fromJSON(e,t){const n=[];for(let s=0,r=e.shapes.length;s<r;s++){const a=t[e.shapes[s]];n.push(a)}return new kS(n,e.curveSegments)}}function lse(i,e){if(e.shapes=[],Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const s=i[t];e.shapes.push(s.uuid)}else e.shapes.push(i.uuid);return e}class Sg extends pn{constructor(e=1,t=32,n=16,s=0,r=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:s,phiLength:r,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const l=Math.min(a+o,Math.PI);let c=0;const u=[],h=new z,f=new z,m=[],g=[],x=[],v=[];for(let y=0;y<=n;y++){const b=[],S=y/n;let T=0;y===0&&a===0?T=.5/t:y===n&&l===Math.PI&&(T=-.5/t);for(let M=0;M<=t;M++){const C=M/t;h.x=-e*Math.cos(s+C*r)*Math.sin(a+S*o),h.y=e*Math.cos(a+S*o),h.z=e*Math.sin(s+C*r)*Math.sin(a+S*o),g.push(h.x,h.y,h.z),f.copy(h).normalize(),x.push(f.x,f.y,f.z),v.push(C+T,1-S),b.push(c++)}u.push(b)}for(let y=0;y<n;y++)for(let b=0;b<t;b++){const S=u[y][b+1],T=u[y][b],M=u[y+1][b],C=u[y+1][b+1];(y!==0||a>0)&&m.push(S,T,C),(y!==n-1||l<Math.PI)&&m.push(T,M,C)}this.setIndex(m),this.setAttribute("position",new qt(g,3)),this.setAttribute("normal",new qt(x,3)),this.setAttribute("uv",new qt(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sg(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class WS extends Vh{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,s,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new WS(e.radius,e.detail)}}class XS extends pn{constructor(e=1,t=.4,n=12,s=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:s,arc:r},n=Math.floor(n),s=Math.floor(s);const a=[],o=[],l=[],c=[],u=new z,h=new z,f=new z;for(let m=0;m<=n;m++)for(let g=0;g<=s;g++){const x=g/s*r,v=m/n*Math.PI*2;h.x=(e+t*Math.cos(v))*Math.cos(x),h.y=(e+t*Math.cos(v))*Math.sin(x),h.z=t*Math.sin(v),o.push(h.x,h.y,h.z),u.x=e*Math.cos(x),u.y=e*Math.sin(x),f.subVectors(h,u).normalize(),l.push(f.x,f.y,f.z),c.push(g/s),c.push(m/n)}for(let m=1;m<=n;m++)for(let g=1;g<=s;g++){const x=(s+1)*m+g-1,v=(s+1)*(m-1)+g-1,y=(s+1)*(m-1)+g,b=(s+1)*m+g;a.push(x,v,b),a.push(v,y,b)}this.setIndex(a),this.setAttribute("position",new qt(o,3)),this.setAttribute("normal",new qt(l,3)),this.setAttribute("uv",new qt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new XS(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class qS extends pn{constructor(e=1,t=.4,n=64,s=8,r=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:s,p:r,q:a},n=Math.floor(n),s=Math.floor(s);const o=[],l=[],c=[],u=[],h=new z,f=new z,m=new z,g=new z,x=new z,v=new z,y=new z;for(let S=0;S<=n;++S){const T=S/n*r*Math.PI*2;b(T,r,a,e,m),b(T+.01,r,a,e,g),v.subVectors(g,m),y.addVectors(g,m),x.crossVectors(v,y),y.crossVectors(x,v),x.normalize(),y.normalize();for(let M=0;M<=s;++M){const C=M/s*Math.PI*2,w=-t*Math.cos(C),N=t*Math.sin(C);h.x=m.x+(w*y.x+N*x.x),h.y=m.y+(w*y.y+N*x.y),h.z=m.z+(w*y.z+N*x.z),l.push(h.x,h.y,h.z),f.subVectors(h,m).normalize(),c.push(f.x,f.y,f.z),u.push(S/n),u.push(M/s)}}for(let S=1;S<=n;S++)for(let T=1;T<=s;T++){const M=(s+1)*(S-1)+(T-1),C=(s+1)*S+(T-1),w=(s+1)*S+T,N=(s+1)*(S-1)+T;o.push(M,C,N),o.push(C,w,N)}this.setIndex(o),this.setAttribute("position",new qt(l,3)),this.setAttribute("normal",new qt(c,3)),this.setAttribute("uv",new qt(u,2));function b(S,T,M,C,w){const N=Math.cos(S),E=Math.sin(S),B=M/T*S,U=Math.cos(B);w.x=C*(2+U)*.5*N,w.y=C*(2+U)*E*.5,w.z=C*Math.sin(B)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new qS(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class jS extends pn{constructor(e=new aC(new z(-1,-1,0),new z(-1,1,0),new z(1,1,0)),t=64,n=1,s=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:s,closed:r};const a=e.computeFrenetFrames(t,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new z,l=new z,c=new Ae;let u=new z;const h=[],f=[],m=[],g=[];x(),this.setIndex(g),this.setAttribute("position",new qt(h,3)),this.setAttribute("normal",new qt(f,3)),this.setAttribute("uv",new qt(m,2));function x(){for(let S=0;S<t;S++)v(S);v(r===!1?t:0),b(),y()}function v(S){u=e.getPointAt(S/t,u);const T=a.normals[S],M=a.binormals[S];for(let C=0;C<=s;C++){const w=C/s*Math.PI*2,N=Math.sin(w),E=-Math.cos(w);l.x=E*T.x+N*M.x,l.y=E*T.y+N*M.y,l.z=E*T.z+N*M.z,l.normalize(),f.push(l.x,l.y,l.z),o.x=u.x+n*l.x,o.y=u.y+n*l.y,o.z=u.z+n*l.z,h.push(o.x,o.y,o.z)}}function y(){for(let S=1;S<=t;S++)for(let T=1;T<=s;T++){const M=(s+1)*(S-1)+(T-1),C=(s+1)*S+(T-1),w=(s+1)*S+T,N=(s+1)*(S-1)+T;g.push(M,C,N),g.push(C,w,N)}}function b(){for(let S=0;S<=t;S++)for(let T=0;T<=s;T++)c.x=S/t,c.y=T/s,m.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new jS(new UM[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class BU extends pn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,s=new z,r=new z;if(e.index!==null){const a=e.attributes.position,o=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],f=h.start,m=h.count;for(let g=f,x=f+m;g<x;g+=3)for(let v=0;v<3;v++){const y=o.getX(g+v),b=o.getX(g+(v+1)%3);s.fromBufferAttribute(a,y),r.fromBufferAttribute(a,b),tV(s,r,n)===!0&&(t.push(s.x,s.y,s.z),t.push(r.x,r.y,r.z))}}}else{const a=e.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let c=0;c<3;c++){const u=3*o+c,h=3*o+(c+1)%3;s.fromBufferAttribute(a,u),r.fromBufferAttribute(a,h),tV(s,r,n)===!0&&(t.push(s.x,s.y,s.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new qt(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function tV(i,e,t){const n=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`;return t.has(n)===!0||t.has(s)===!0?!1:(t.add(n),t.add(s),!0)}var nV=Object.freeze({__proto__:null,BoxGeometry:Su,CapsuleGeometry:PS,CircleGeometry:OS,ConeGeometry:Bx,CylinderGeometry:bg,DodecahedronGeometry:FS,EdgesGeometry:AU,ExtrudeGeometry:zS,IcosahedronGeometry:Dx,LatheGeometry:VS,OctahedronGeometry:Lx,PlaneGeometry:Cc,PolyhedronGeometry:Vh,RingGeometry:HS,ShapeGeometry:kS,SphereGeometry:Sg,TetrahedronGeometry:WS,TorusGeometry:XS,TorusKnotGeometry:qS,TubeGeometry:jS,WireframeGeometry:BU});class lC extends Es{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ye(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class cC extends Za{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Tg extends Es{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Ye(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ye(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Vl,this.normalScale=new Ae(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Lr,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class yo extends Tg{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ae(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return yn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ye(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ye(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ye(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class uC extends Es{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ye(16777215),this.specular=new Ye(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ye(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Vl,this.normalScale=new Ae(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Lr,this.combine=fg,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class hC extends Es{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ye(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ye(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Vl,this.normalScale=new Ae(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class dC extends Es{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Vl,this.normalScale=new Ae(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class fC extends Es{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ye(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ye(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Vl,this.normalScale=new Ae(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Lr,this.combine=fg,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class pC extends Es{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=$L,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class mC extends Es{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class gC extends Es{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ye(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Vl,this.normalScale=new Ae(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class YS extends Ir{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function om(i,e){return!i||i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}function X9(i){function e(s,r){return i[s]-i[r]}const t=i.length,n=new Array(t);for(let s=0;s!==t;++s)n[s]=s;return n.sort(e),n}function DD(i,e,t){const n=i.length,s=new i.constructor(n);for(let r=0,a=0;a!==n;++r){const o=t[r]*e;for(let l=0;l!==e;++l)s[a++]=i[o+l]}return s}function DU(i,e,t,n){let s=1,r=i[0];for(;r!==void 0&&r[n]===void 0;)r=i[s++];if(r===void 0)return;let a=r[n];if(a!==void 0)if(Array.isArray(a))do a=r[n],a!==void 0&&(e.push(r.time),t.push(...a)),r=i[s++];while(r!==void 0);else if(a.toArray!==void 0)do a=r[n],a!==void 0&&(e.push(r.time),a.toArray(t,t.length)),r=i[s++];while(r!==void 0);else do a=r[n],a!==void 0&&(e.push(r.time),t.push(a)),r=i[s++];while(r!==void 0)}function cse(i,e,t,n,s=30){const r=i.clone();r.name=e;const a=[];for(let l=0;l<r.tracks.length;++l){const c=r.tracks[l],u=c.getValueSize(),h=[],f=[];for(let m=0;m<c.times.length;++m){const g=c.times[m]*s;if(!(g<t||g>=n)){h.push(c.times[m]);for(let x=0;x<u;++x)f.push(c.values[m*u+x])}}h.length!==0&&(c.times=om(h,c.times.constructor),c.values=om(f,c.values.constructor),a.push(c))}r.tracks=a;let o=1/0;for(let l=0;l<r.tracks.length;++l)o>r.tracks[l].times[0]&&(o=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*o);return r.resetDuration(),r}function use(i,e=0,t=i,n=30){n<=0&&(n=30);const s=t.tracks.length,r=e/n;for(let a=0;a<s;++a){const o=t.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=i.tracks.find(function(y){return y.name===o.name&&y.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let f=0;const m=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=m/3);const g=o.times.length-1;let x;if(r<=o.times[0]){const y=u,b=h-u;x=o.values.slice(y,b)}else if(r>=o.times[g]){const y=g*h+u,b=y+h-u;x=o.values.slice(y,b)}else{const y=o.createInterpolant(),b=u,S=h-u;y.evaluate(r),x=y.resultBuffer.slice(b,S)}l==="quaternion"&&new Fs().fromArray(x).normalize().conjugate().toArray(x);const v=c.times.length;for(let y=0;y<v;++y){const b=y*m+f;if(l==="quaternion")Fs.multiplyQuaternionsFlat(c.values,b,x,0,c.values,b);else{const S=m-f*2;for(let T=0;T<S;++T)c.values[b+T]-=x[T]}}}return i.blendMode=WE,i}class q9{static convertArray(e,t){return om(e,t)}static isTypedArray(e){return Xy(e)}static getKeyframeOrder(e){return X9(e)}static sortedArray(e,t,n){return DD(e,t,n)}static flattenJSON(e,t,n,s){DU(e,t,n,s)}static subclip(e,t,n,s,r=30){return cse(e,t,n,s,r)}static makeClipAdditive(e,t=0,n=e,s=30){return use(e,t,n,s)}}class Ag{constructor(e,t,n,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,s=t[n],r=t[n-1];e:{t:{let a;n:{i:if(!(e<s)){for(let o=n+2;;){if(s===void 0){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=s,s=t[++n],e<s)break t}a=t.length;break n}if(!(e>=r)){const o=t[1];e<o&&(n=2,r=o);for(let l=n-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(s=r,r=t[--n-1],e>=r)break t}a=n,n=0;break n}break e}for(;n<a;){const o=n+a>>>1;e<t[o]?a=o:n=o+1}if(s=t[n],r=t[n-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,s)}return this.interpolate_(n,r,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s;for(let a=0;a!==s;++a)t[a]=n[r+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class LU extends Ag{constructor(e,t,n,s){super(e,t,n,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Fd,endingEnd:Fd}}intervalChanged_(e,t,n){const s=this.parameterPositions;let r=e-2,a=e+1,o=s[r],l=s[a];if(o===void 0)switch(this.getSettings_().endingStart){case Gd:r=e,o=2*t-n;break;case Wy:r=s.length-2,o=t+s[r]-s[r+1];break;default:r=e,o=n}if(l===void 0)switch(this.getSettings_().endingEnd){case Gd:a=e,l=2*n-t;break;case Wy:a=1,l=n+s[1]-s[0];break;default:a=e-1,l=t}const c=(n-t)*.5,u=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(l-n),this._offsetPrev=r*u,this._offsetNext=a*u}interpolate_(e,t,n,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,u=this._offsetPrev,h=this._offsetNext,f=this._weightPrev,m=this._weightNext,g=(n-t)/(s-t),x=g*g,v=x*g,y=-f*v+2*f*x-f*g,b=(1+f)*v+(-1.5-2*f)*x+(-.5+f)*g+1,S=(-1-m)*v+(1.5+m)*x+.5*g,T=m*v-m*x;for(let M=0;M!==o;++M)r[M]=y*a[u+M]+b*a[c+M]+S*a[l+M]+T*a[h+M];return r}}class yC extends Ag{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,u=(n-t)/(s-t),h=1-u;for(let f=0;f!==o;++f)r[f]=a[c+f]*h+a[l+f]*u;return r}}class UU extends Ag{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class al{constructor(e,t,n,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=om(t,this.TimeBufferType),this.values=om(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:om(e.times,Array),values:om(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(n.interpolation=s)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new UU(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new yC(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new LU(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Km:t=this.InterpolantFactoryMethodDiscrete;break;case Zm:t=this.InterpolantFactoryMethodLinear;break;case Uv:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return Se("KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Km;case this.InterpolantFactoryMethodLinear:return Zm;case this.InterpolantFactoryMethodSmooth:return Uv}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]*=e}return this}trim(e,t){const n=this.times,s=n.length;let r=0,a=s-1;for(;r!==s&&n[r]<e;)++r;for(;a!==-1&&n[a]>t;)--a;if(++a,r!==0||a!==s){r>=a&&(a=Math.max(a,1),r=a-1);const o=this.getValueSize();this.times=n.slice(r,a),this.values=this.values.slice(r*o,a*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(De("KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,s=this.values,r=n.length;r===0&&(De("KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==r;o++){const l=n[o];if(typeof l=="number"&&isNaN(l)){De("KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(a!==null&&a>l){De("KeyframeTrack: Out of order keys.",this,o,l,a),e=!1;break}a=l}if(s!==void 0&&Xy(s))for(let o=0,l=s.length;o!==l;++o){const c=s[o];if(isNaN(c)){De("KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),s=this.getInterpolation()===Uv,r=e.length-1;let a=1;for(let o=1;o<r;++o){let l=!1;const c=e[o],u=e[o+1];if(c!==u&&(o!==1||c!==e[0]))if(s)l=!0;else{const h=o*n,f=h-n,m=h+n;for(let g=0;g!==n;++g){const x=t[h+g];if(x!==t[f+g]||x!==t[m+g]){l=!0;break}}}if(l){if(o!==a){e[a]=e[o];const h=o*n,f=a*n;for(let m=0;m!==n;++m)t[f+m]=t[h+m]}++a}}if(r>0){e[a]=e[r];for(let o=r*n,l=a*n,c=0;c!==n;++c)t[l+c]=t[o+c];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,s=new n(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}al.prototype.ValueTypeName="";al.prototype.TimeBufferType=Float32Array;al.prototype.ValueBufferType=Float32Array;al.prototype.DefaultInterpolation=Zm;class Jf extends al{constructor(e,t,n){super(e,t,n)}}Jf.prototype.ValueTypeName="bool";Jf.prototype.ValueBufferType=Array;Jf.prototype.DefaultInterpolation=Km;Jf.prototype.InterpolantFactoryMethodLinear=void 0;Jf.prototype.InterpolantFactoryMethodSmooth=void 0;class xC extends al{constructor(e,t,n,s){super(e,t,n,s)}}xC.prototype.ValueTypeName="color";class Gf extends al{constructor(e,t,n,s){super(e,t,n,s)}}Gf.prototype.ValueTypeName="number";class IU extends Ag{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(n-t)/(s-t);let c=e*o;for(let u=c+o;c!==u;c+=4)Fs.slerpFlat(r,0,a,c-o,a,c,l);return r}}class zf extends al{constructor(e,t,n,s){super(e,t,n,s)}InterpolantFactoryMethodLinear(e){return new IU(this.times,this.values,this.getValueSize(),e)}}zf.prototype.ValueTypeName="quaternion";zf.prototype.InterpolantFactoryMethodSmooth=void 0;class Qf extends al{constructor(e,t,n){super(e,t,n)}}Qf.prototype.ValueTypeName="string";Qf.prototype.ValueBufferType=Array;Qf.prototype.DefaultInterpolation=Km;Qf.prototype.InterpolantFactoryMethodLinear=void 0;Qf.prototype.InterpolantFactoryMethodSmooth=void 0;class Vf extends al{constructor(e,t,n,s){super(e,t,n,s)}}Vf.prototype.ValueTypeName="vector";class tg{constructor(e="",t=-1,n=[],s=vS){this.name=e,this.tracks=n,this.duration=t,this.blendMode=s,this.uuid=Ko(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,s=1/(e.fps||1);for(let a=0,o=n.length;a!==o;++a)t.push(dse(n[a]).scale(s));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r.userData=JSON.parse(e.userData||"{}"),r}static toJSON(e){const t=[],n=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let r=0,a=n.length;r!==a;++r)t.push(al.toJSON(n[r]));return s}static CreateFromMorphTargetSequence(e,t,n,s){const r=t.length,a=[];for(let o=0;o<r;o++){let l=[],c=[];l.push((o+r-1)%r,o,(o+1)%r),c.push(0,1,0);const u=X9(l);l=DD(l,1,u),c=DD(c,1,u),!s&&l[0]===0&&(l.push(r),c.push(c[0])),a.push(new Gf(".morphTargetInfluences["+t[o].name+"]",l,c).scale(1/n))}return new this(e,-1,a)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const s=e;n=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<n.length;s++)if(n[s].name===t)return n[s];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const s={},r=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const c=e[o],u=c.name.match(r);if(u&&u.length>1){const h=u[1];let f=s[h];f||(s[h]=f=[]),f.push(c)}}const a=[];for(const o in s)a.push(this.CreateFromMorphTargetSequence(o,s[o],t,n));return a}static parseAnimation(e,t){if(Se("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return De("AnimationClip: No animation in JSONLoader data."),null;const n=function(h,f,m,g,x){if(m.length!==0){const v=[],y=[];DU(m,v,y,g),v.length!==0&&x.push(new h(f,v,y))}},s=[],r=e.name||"default",a=e.fps||30,o=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let h=0;h<c.length;h++){const f=c[h].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const m={};let g;for(g=0;g<f.length;g++)if(f[g].morphTargets)for(let x=0;x<f[g].morphTargets.length;x++)m[f[g].morphTargets[x]]=-1;for(const x in m){const v=[],y=[];for(let b=0;b!==f[g].morphTargets.length;++b){const S=f[g];v.push(S.time),y.push(S.morphTarget===x?1:0)}s.push(new Gf(".morphTargetInfluence["+x+"]",v,y))}l=m.length*a}else{const m=".bones["+t[h].name+"]";n(Vf,m+".position",f,"pos",s),n(zf,m+".quaternion",f,"rot",s),n(Vf,m+".scale",f,"scl",s)}}return s.length===0?null:new this(r,l,s,o)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,s=e.length;n!==s;++n){const r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function hse(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Gf;case"vector":case"vector2":case"vector3":case"vector4":return Vf;case"color":return xC;case"quaternion":return zf;case"bool":case"boolean":return Jf;case"string":return Qf}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function dse(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=hse(i.type);if(i.times===void 0){const t=[],n=[];DU(i.keys,t,n,"value"),i.times=t,i.values=n}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const gc={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class KS{constructor(e,t,n){const s=this;let r=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this._abortController=null,this.itemStart=function(u){o++,r===!1&&s.onStart!==void 0&&s.onStart(u,a,o),r=!0},this.itemEnd=function(u){a++,s.onProgress!==void 0&&s.onProgress(u,a,o),a===o&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(u){s.onError!==void 0&&s.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,f=c.length;h<f;h+=2){const m=c[h],g=c[h+1];if(m.global&&(m.lastIndex=0),m.test(u))return g}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const lm=new KS;class fr{constructor(e){this.manager=e!==void 0?e:lm,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(s,r){n.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}fr.DEFAULT_MATERIAL_NAME="__DEFAULT";const Wu={};class fse extends Error{constructor(e,t){super(e),this.response=t}}class cr extends fr{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=gc.get(`file:${e}`);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(Wu[e]!==void 0){Wu[e].push({onLoad:t,onProgress:n,onError:s});return}Wu[e]=[],Wu[e].push({onLoad:t,onProgress:n,onError:s});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&Se("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=Wu[e],h=c.body.getReader(),f=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),m=f?parseInt(f):0,g=m!==0;let x=0;const v=new ReadableStream({start(y){b();function b(){h.read().then(({done:S,value:T})=>{if(S)y.close();else{x+=T.byteLength;const M=new ProgressEvent("progress",{lengthComputable:g,loaded:x,total:m});for(let C=0,w=u.length;C<w;C++){const N=u[C];N.onProgress&&N.onProgress(M)}y.enqueue(T),b()}},S=>{y.error(S)})}}});return new Response(v)}else throw new fse(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return c.json();default:if(o==="")return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),f=h&&h[1]?h[1].toLowerCase():void 0,m=new TextDecoder(f);return c.arrayBuffer().then(g=>m.decode(g))}}}).then(c=>{gc.add(`file:${e}`,c);const u=Wu[e];delete Wu[e];for(let h=0,f=u.length;h<f;h++){const m=u[h];m.onLoad&&m.onLoad(c)}}).catch(c=>{const u=Wu[e];if(u===void 0)throw this.manager.itemError(e),c;delete Wu[e];for(let h=0,f=u.length;h<f;h++){const m=u[h];m.onError&&m.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class j9 extends fr{constructor(e){super(e)}load(e,t,n,s){const r=this,a=new cr(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{t(r.parse(JSON.parse(o)))}catch(l){s?s(l):De(l),r.manager.itemError(e)}},n,s)}parse(e){const t=[];for(let n=0;n<e.length;n++){const s=tg.parse(e[n]);t.push(s)}return t}}class Y9 extends fr{constructor(e){super(e)}load(e,t,n,s){const r=this,a=[],o=new IS,l=new cr(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(r.withCredentials);let c=0;function u(h){l.load(e[h],function(f){const m=r.parse(f,!0);a[h]={width:m.width,height:m.height,format:m.format,mipmaps:m.mipmaps},c+=1,c===6&&(m.mipmapCount===1&&(o.minFilter=Jt),o.image=a,o.format=m.format,o.needsUpdate=!0,t&&t(o))},n,s)}if(Array.isArray(e))for(let h=0,f=e.length;h<f;++h)u(h);else l.load(e,function(h){const f=r.parse(h,!0);if(f.isCubemap){const m=f.mipmaps.length/f.mipmapCount;for(let g=0;g<m;g++){a[g]={mipmaps:[]};for(let x=0;x<f.mipmapCount;x++)a[g].mipmaps.push(f.mipmaps[g*f.mipmapCount+x]),a[g].format=f.format,a[g].width=f.width,a[g].height=f.height}o.image=a}else o.image.width=f.width,o.image.height=f.height,o.mipmaps=f.mipmaps;f.mipmapCount===1&&(o.minFilter=Jt),o.format=f.format,o.needsUpdate=!0,t&&t(o)},n,s);return o}}const S0=new WeakMap;class Yy extends fr{constructor(e){super(e)}load(e,t,n,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=gc.get(`image:${e}`);if(a!==void 0){if(a.complete===!0)r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0);else{let h=S0.get(a);h===void 0&&(h=[],S0.set(a,h)),h.push({onLoad:t,onError:s})}return a}const o=Sb("img");function l(){u(),t&&t(this);const h=S0.get(this)||[];for(let f=0;f<h.length;f++){const m=h[f];m.onLoad&&m.onLoad(this)}S0.delete(this),r.manager.itemEnd(e)}function c(h){u(),s&&s(h),gc.remove(`image:${e}`);const f=S0.get(this)||[];for(let m=0;m<f.length;m++){const g=f[m];g.onError&&g.onError(h)}S0.delete(this),r.manager.itemError(e),r.manager.itemEnd(e)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),gc.add(`image:${e}`,o),r.manager.itemStart(e),o.src=e,o}}class PU extends fr{constructor(e){super(e)}load(e,t,n,s){const r=new Gh;r.colorSpace=Js;const a=new Yy(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(c){a.load(e[c],function(u){r.images[c]=u,o++,o===6&&(r.needsUpdate=!0,t&&t(r))},void 0,s)}for(let c=0;c<e.length;++c)l(c);return r}}class ZS extends fr{constructor(e){super(e)}load(e,t,n,s){const r=this,a=new _a,o=new cr(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(e,function(l){let c;try{c=r.parse(l)}catch(u){if(s!==void 0)s(u);else{u(u);return}}c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:ui,a.wrapT=c.wrapT!==void 0?c.wrapT:ui,a.magFilter=c.magFilter!==void 0?c.magFilter:Jt,a.minFilter=c.minFilter!==void 0?c.minFilter:Jt,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(a.colorSpace=c.colorSpace),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=$s),c.mipmapCount===1&&(a.minFilter=Jt),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,t&&t(a,c)},n,s),a}}class $f extends fr{constructor(e){super(e)}load(e,t,n,s){const r=new In,a=new Yy(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){r.image=o,r.needsUpdate=!0,t!==void 0&&t(r)},n,s),r}}class Hh extends Fn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ye(e),this.intensity=t}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t}}class _C extends Hh{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Fn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ye(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}toJSON(e){const t=super.toJSON(e);return t.object.groundColor=this.groundColor.getHex(),t}}const t2=new Lt,iV=new z,sV=new z;class OU{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ae(512,512),this.mapType=ei,this.map=null,this.mapPass=null,this.matrix=new Lt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new zh,this._frameExtents=new Ae(1,1),this._viewportCount=1,this._viewports=[new un(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;iV.setFromMatrixPosition(e.matrixWorld),t.position.copy(iV),sV.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(sV),t.updateMatrixWorld(),t2.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(t2,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t2)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class pse extends OU{constructor(){super(new Ci(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=Qm*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height*this.aspect,r=e.distance||t.far;(n!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Mg extends Hh{constructor(e,t,n=0,s=Math.PI/3,r=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Fn.DEFAULT_UP),this.updateMatrix(),this.target=new Fn,this.distance=n,this.angle=s,this.penumbra=r,this.decay=a,this.map=null,this.shadow=new pse}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.map=e.map,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.angle=this.angle,t.object.decay=this.decay,t.object.penumbra=this.penumbra,t.object.target=this.target.uuid,this.map&&this.map.isTexture&&(t.object.map=this.map.toJSON(e).uuid),t.object.shadow=this.shadow.toJSON(),t}}class mse extends OU{constructor(){super(new Ci(90,1,.5,500)),this.isPointLightShadow=!0}}class JS extends Hh{constructor(e,t,n=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new mse}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.decay=this.decay,t.object.shadow=this.shadow.toJSON(),t}}class Dr extends Cx{constructor(e=-1,t=1,n=1,s=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=s,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,s,r,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=n-e,a=n+e,o=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,a=r+c*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,l,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class gse extends OU{constructor(){super(new Dr(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class ng extends Hh{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Fn.DEFAULT_UP),this.updateMatrix(),this.target=new Fn,this.shadow=new gse}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.shadow=this.shadow.toJSON(),t.object.target=this.target.uuid,t}}class vC extends Hh{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class bC extends Hh{constructor(e,t,n=10,s=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class SC{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new z)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,s=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*s),t.addScaledVector(a[2],.488603*r),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],1.092548*(n*s)),t.addScaledVector(a[5],1.092548*(s*r)),t.addScaledVector(a[6],.315392*(3*r*r-1)),t.addScaledVector(a[7],1.092548*(n*r)),t.addScaledVector(a[8],.546274*(n*n-s*s)),t}getIrradianceAt(e,t){const n=e.x,s=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*s),t.addScaledVector(a[2],2*.511664*r),t.addScaledVector(a[3],2*.511664*n),t.addScaledVector(a[4],2*.429043*n*s),t.addScaledVector(a[5],2*.429043*s*r),t.addScaledVector(a[6],.743125*r*r-.247708),t.addScaledVector(a[7],2*.429043*n*r),t.addScaledVector(a[8],.429043*(n*n-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].fromArray(e,t+s*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].toArray(e,t+s*3);return e}static getBasisAt(e,t){const n=e.x,s=e.y,r=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*s,t[5]=1.092548*s*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-s*s)}}class TC extends Hh{constructor(e=new SC,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Ux extends fr{constructor(e){super(e),this.textures={}}load(e,t,n,s){const r=this,a=new cr(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(o){try{t(r.parse(JSON.parse(o)))}catch(l){s?s(l):De(l),r.manager.itemError(e)}},n,s)}parse(e){const t=this.textures;function n(r){return t[r]===void 0&&Se("MaterialLoader: Undefined texture",r),t[r]}const s=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new Ye().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(s.dispersion=e.dispersion),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(s.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(s.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(s.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(s.depthFunc=e.depthFunc),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(s.blendSrc=e.blendSrc),e.blendDst!==void 0&&(s.blendDst=e.blendDst),e.blendEquation!==void 0&&(s.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(s.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(s.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(s.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&s.blendColor!==void 0&&s.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(s.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==void 0&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(s.forceSinglePass=e.forceSinglePass),e.allowOverride!==void 0&&(s.allowOverride=e.allowOverride),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const a=e.uniforms[r];switch(s.uniforms[r]={},a.type){case"t":s.uniforms[r].value=n(a.value);break;case"c":s.uniforms[r].value=new Ye().setHex(a.value);break;case"v2":s.uniforms[r].value=new Ae().fromArray(a.value);break;case"v3":s.uniforms[r].value=new z().fromArray(a.value);break;case"v4":s.uniforms[r].value=new un().fromArray(a.value);break;case"m3":s.uniforms[r].value=new gn().fromArray(a.value);break;case"m4":s.uniforms[r].value=new Lt().fromArray(a.value);break;default:s.uniforms[r].value=a.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const r in e.extensions)s.extensions[r]=e.extensions[r];if(e.lights!==void 0&&(s.lights=e.lights),e.clipping!==void 0&&(s.clipping=e.clipping),e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=n(e.map)),e.matcap!==void 0&&(s.matcap=n(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),s.normalScale=new Ae().fromArray(r)}return e.displacementMap!==void 0&&(s.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=n(e.envMap)),e.envMapRotation!==void 0&&s.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new Ae().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(s.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=n(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return Ux.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:lC,SpriteMaterial:DS,RawShaderMaterial:cC,ShaderMaterial:Za,PointsMaterial:Nx,MeshPhysicalMaterial:yo,MeshStandardMaterial:Tg,MeshPhongMaterial:uC,MeshToonMaterial:hC,MeshNormalMaterial:dC,MeshLambertMaterial:fC,MeshDepthMaterial:pC,MeshDistanceMaterial:mC,MeshBasicMaterial:Ts,MeshMatcapMaterial:gC,LineDashedMaterial:YS,LineBasicMaterial:Ir,Material:Es};return new t[e]}}class xh{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class FU extends pn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class GU extends fr{constructor(e){super(e)}load(e,t,n,s){const r=this,a=new cr(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(o){try{t(r.parse(JSON.parse(o)))}catch(l){s?s(l):De(l),r.manager.itemError(e)}},n,s)}parse(e){const t={},n={};function s(m,g){if(t[g]!==void 0)return t[g];const v=m.interleavedBuffers[g],y=r(m,v.buffer),b=ny(v.type,y),S=new vg(b,v.stride);return S.uuid=v.uuid,t[g]=S,S}function r(m,g){if(n[g]!==void 0)return n[g];const v=m.arrayBuffers[g],y=new Uint32Array(v).buffer;return n[g]=y,y}const a=e.isInstancedBufferGeometry?new FU:new pn,o=e.data.index;if(o!==void 0){const m=ny(o.type,o.array);a.setIndex(new Nn(m,1))}const l=e.data.attributes;for(const m in l){const g=l[m];let x;if(g.isInterleavedBufferAttribute){const v=s(e.data,g.data);x=new pu(v,g.itemSize,g.offset,g.normalized)}else{const v=ny(g.type,g.array),y=g.isInstancedBufferAttribute?Yr:Nn;x=new y(v,g.itemSize,g.normalized)}g.name!==void 0&&(x.name=g.name),g.usage!==void 0&&x.setUsage(g.usage),a.setAttribute(m,x)}const c=e.data.morphAttributes;if(c)for(const m in c){const g=c[m],x=[];for(let v=0,y=g.length;v<y;v++){const b=g[v];let S;if(b.isInterleavedBufferAttribute){const T=s(e.data,b.data);S=new pu(T,b.itemSize,b.offset,b.normalized)}else{const T=ny(b.type,b.array);S=new Nn(T,b.itemSize,b.normalized)}b.name!==void 0&&(S.name=b.name),x.push(S)}a.morphAttributes[m]=x}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let m=0,g=h.length;m!==g;++m){const x=h[m];a.addGroup(x.start,x.count,x.materialIndex)}const f=e.data.boundingSphere;return f!==void 0&&(a.boundingSphere=new Gs().fromJSON(f)),e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class zU extends fr{constructor(e){super(e)}load(e,t,n,s){const r=this,a=this.path===""?xh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new cr(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(h){s!==void 0&&s(h),h("ObjectLoader: Can't parse "+e+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){s!==void 0&&s(new Error("THREE.ObjectLoader: Can't load "+e)),De("ObjectLoader: Can't load "+e);return}r.parse(c,t)},n,s)}async loadAsync(e,t){const n=this,s=this.path===""?xh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const r=new cr(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const a=await r.loadAsync(e,t),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(o)}parse(e,t){const n=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,s),a=this.parseImages(e.images,function(){t!==void 0&&t(c)}),o=this.parseTextures(e.textures,a),l=this.parseMaterials(e.materials,o),c=this.parseObject(e.object,r,l,o,n),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),this.bindLightTargets(c),t!==void 0){let h=!1;for(const f in a)if(a[f].data instanceof HTMLImageElement){h=!0;break}h===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,r),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,s,o,a,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),this.bindLightTargets(l),l}parseShapes(e){const t={};if(e!==void 0)for(let n=0,s=e.length;n<s;n++){const r=new sf().fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},s={};if(t.traverse(function(r){r.isBone&&(s[r.uuid]=r)}),e!==void 0)for(let r=0,a=e.length;r<a;r++){const o=new wx().fromJSON(e[r],s);n[o.uuid]=o}return n}parseGeometries(e,t){const n={};if(e!==void 0){const s=new GU;for(let r=0,a=e.length;r<a;r++){let o;const l=e[r];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=s.parse(l);break;default:l.type in nV?o=nV[l.type].fromJSON(l,t):Se(`ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),n[l.uuid]=o}}return n}parseMaterials(e,t){const n={},s={};if(e!==void 0){const r=new Ux;r.setTextures(t);for(let a=0,o=e.length;a<o;a++){const l=e[a];n[l.uuid]===void 0&&(n[l.uuid]=r.parse(l)),s[l.uuid]=n[l.uuid]}}return s}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const s=e[n],r=tg.parse(s);t[r.uuid]=r}return t}parseImages(e,t){const n=this,s={};let r;function a(l){return n.manager.itemStart(l),r.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:n.resourcePath+c;return a(u)}else return l.data?{data:ny(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new KS(t);r=new Yy(l),r.setCrossOrigin(this.crossOrigin);for(let c=0,u=e.length;c<u;c++){const h=e[c],f=h.url;if(Array.isArray(f)){const m=[];for(let g=0,x=f.length;g<x;g++){const v=f[g],y=o(v);y!==null&&(y instanceof HTMLImageElement?m.push(y):m.push(new _a(y.data,y.width,y.height)))}s[h.uuid]=new dh(m)}else{const m=o(h.url);s[h.uuid]=new dh(m)}}}return s}async parseImagesAsync(e){const t=this,n={};let s;async function r(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:t.resourcePath+o;return await s.loadAsync(l)}else return a.data?{data:ny(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){s=new Yy(this.manager),s.setCrossOrigin(this.crossOrigin);for(let a=0,o=e.length;a<o;a++){const l=e[a],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,f=c.length;h<f;h++){const m=c[h],g=await r(m);g!==null&&(g instanceof HTMLImageElement?u.push(g):u.push(new _a(g.data,g.width,g.height)))}n[l.uuid]=new dh(u)}else{const u=await r(l.url);n[l.uuid]=new dh(u)}}}return n}parseTextures(e,t){function n(r,a){return typeof r=="number"?r:(Se("ObjectLoader.parseTexture: Constant should be in numeric form.",r),a[r])}const s={};if(e!==void 0)for(let r=0,a=e.length;r<a;r++){const o=e[r];o.image===void 0&&Se('ObjectLoader: No "image" specified for',o.uuid),t[o.image]===void 0&&Se("ObjectLoader: Undefined image",o.image);const l=t[o.image],c=l.data;let u;Array.isArray(c)?(u=new Gh,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new _a:u=new In,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=o.uuid,o.name!==void 0&&(u.name=o.name),o.mapping!==void 0&&(u.mapping=n(o.mapping,yse)),o.channel!==void 0&&(u.channel=o.channel),o.offset!==void 0&&u.offset.fromArray(o.offset),o.repeat!==void 0&&u.repeat.fromArray(o.repeat),o.center!==void 0&&u.center.fromArray(o.center),o.rotation!==void 0&&(u.rotation=o.rotation),o.wrap!==void 0&&(u.wrapS=n(o.wrap[0],rV),u.wrapT=n(o.wrap[1],rV)),o.format!==void 0&&(u.format=o.format),o.internalFormat!==void 0&&(u.internalFormat=o.internalFormat),o.type!==void 0&&(u.type=o.type),o.colorSpace!==void 0&&(u.colorSpace=o.colorSpace),o.minFilter!==void 0&&(u.minFilter=n(o.minFilter,aV)),o.magFilter!==void 0&&(u.magFilter=n(o.magFilter,aV)),o.anisotropy!==void 0&&(u.anisotropy=o.anisotropy),o.flipY!==void 0&&(u.flipY=o.flipY),o.generateMipmaps!==void 0&&(u.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(u.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(u.compareFunction=o.compareFunction),o.userData!==void 0&&(u.userData=o.userData),s[o.uuid]=u}return s}parseObject(e,t,n,s,r){let a;function o(f){return t[f]===void 0&&Se("ObjectLoader: Undefined geometry",f),t[f]}function l(f){if(f!==void 0){if(Array.isArray(f)){const m=[];for(let g=0,x=f.length;g<x;g++){const v=f[g];n[v]===void 0&&Se("ObjectLoader: Undefined material",v),m.push(n[v])}return m}return n[f]===void 0&&Se("ObjectLoader: Undefined material",f),n[f]}}function c(f){return s[f]===void 0&&Se("ObjectLoader: Undefined texture",f),s[f]}let u,h;switch(e.type){case"Scene":a=new fu,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new Ye(e.background):a.background=c(e.background)),e.environment!==void 0&&(a.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new BS(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new NS(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new Ci(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new Dr(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new vC(e.color,e.intensity);break;case"DirectionalLight":a=new ng(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new JS(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new bC(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new Mg(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new _C(e.color,e.groundColor,e.intensity);break;case"LightProbe":const f=new SC().fromArray(e.sh);a=new TC(f,e.intensity);break;case"SkinnedMesh":u=o(e.geometry),h=l(e.material),a=new JE(u,h),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":u=o(e.geometry),h=l(e.material),a=new Kn(u,h);break;case"InstancedMesh":u=o(e.geometry),h=l(e.material);const m=e.count,g=e.instanceMatrix,x=e.instanceColor;a=new QE(u,h,m),a.instanceMatrix=new Yr(new Float32Array(g.array),16),x!==void 0&&(a.instanceColor=new Yr(new Float32Array(x.array),x.itemSize));break;case"BatchedMesh":u=o(e.geometry),h=l(e.material),a=new bU(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,h),a.geometry=u,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._geometryInfo=e.geometryInfo.map(v=>{let y=null,b=null;return v.boundingBox!==void 0&&(y=new Br().fromJSON(v.boundingBox)),v.boundingSphere!==void 0&&(b=new Gs().fromJSON(v.boundingSphere)),{...v,boundingBox:y,boundingSphere:b}}),a._instanceInfo=e.instanceInfo,a._availableInstanceIds=e._availableInstanceIds,a._availableGeometryIds=e._availableGeometryIds,a._nextIndexStart=e.nextIndexStart,a._nextVertexStart=e.nextVertexStart,a._geometryCount=e.geometryCount,a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._matricesTexture=c(e.matricesTexture.uuid),a._indirectTexture=c(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=c(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(a.boundingSphere=new Gs().fromJSON(e.boundingSphere)),e.boundingBox!==void 0&&(a.boundingBox=new Br().fromJSON(e.boundingBox));break;case"LOD":a=new vU;break;case"Line":a=new mu(o(e.geometry),l(e.material));break;case"LineLoop":a=new $E(o(e.geometry),l(e.material));break;case"LineSegments":a=new Zl(o(e.geometry),l(e.material));break;case"PointCloud":case"Points":a=new eC(o(e.geometry),l(e.material));break;case"Sprite":a=new _U(l(e.material));break;case"Group":a=new ao;break;case"Bone":a=new LS;break;default:a=new Fn}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(a.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const f=e.children;for(let m=0;m<f.length;m++)a.add(this.parseObject(f[m],t,n,s,r))}if(e.animations!==void 0){const f=e.animations;for(let m=0;m<f.length;m++){const g=f[m];a.animations.push(r[g])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const f=e.levels;for(let m=0;m<f.length;m++){const g=f[m],x=a.getObjectByProperty("uuid",g.object);x!==void 0&&a.addLevel(x,g.distance,g.hysteresis)}}return a}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const s=t[n.skeleton];s===void 0?Se("ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(s,n.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,s=e.getObjectByProperty("uuid",n);s!==void 0?t.target=s:t.target=new Fn}})}}const yse={UVMapping:hu,CubeReflectionMapping:Sa,CubeRefractionMapping:el,EquirectangularReflectionMapping:_c,EquirectangularRefractionMapping:wh,CubeUVReflectionMapping:du},rV={RepeatWrapping:Zr,ClampToEdgeWrapping:ui,MirroredRepeatWrapping:vc},aV={NearestFilter:$n,NearestMipmapNearestFilter:mg,NearestMipmapLinearFilter:Ho,LinearFilter:Jt,LinearMipmapNearestFilter:Qc,LinearMipmapLinearFilter:$s},n2=new WeakMap;class VU extends fr{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&Se("ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&Se("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=gc.get(`image-bitmap:${e}`);if(a!==void 0){if(r.manager.itemStart(e),a.then){a.then(c=>{if(n2.has(a)===!0)s&&s(n2.get(a)),r.manager.itemError(e),r.manager.itemEnd(e);else return t&&t(c),r.manager.itemEnd(e),c});return}return setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,o.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const l=fetch(e,o).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){return gc.add(`image-bitmap:${e}`,c),t&&t(c),r.manager.itemEnd(e),c}).catch(function(c){s&&s(c),n2.set(l,c),gc.remove(`image-bitmap:${e}`),r.manager.itemError(e),r.manager.itemEnd(e)});gc.add(`image-bitmap:${e}`,l),r.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let H1;class AC{static getContext(){return H1===void 0&&(H1=new(window.AudioContext||window.webkitAudioContext)),H1}static setContext(e){H1=e}}class K9 extends fr{constructor(e){super(e)}load(e,t,n,s){const r=this,a=new cr(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{const c=l.slice(0);AC.getContext().decodeAudioData(c,function(h){t(h)}).catch(o)}catch(c){o(c)}},n,s);function o(l){s?s(l):De(l),r.manager.itemError(e)}}}const oV=new Lt,lV=new Lt,Ip=new Lt;class Z9{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ci,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ci,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Ip.copy(e.projectionMatrix);const s=t.eyeSep/2,r=s*t.near/t.focus,a=t.near*Math.tan(Am*t.fov*.5)/t.zoom;let o,l;lV.elements[12]=-s,oV.elements[12]=s,o=-a*t.aspect+r,l=a*t.aspect+r,Ip.elements[0]=2*t.near/(l-o),Ip.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(Ip),o=-a*t.aspect-r,l=a*t.aspect-r,Ip.elements[0]=2*t.near/(l-o),Ip.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(Ip)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(lV),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(oV)}}class MC extends Ci{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class EC{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const Pp=new z,i2=new Fs,xse=new z,Op=new z,Fp=new z;class J9 extends Fn{constructor(){super(),this.type="AudioListener",this.context=AC.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new EC}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Pp,i2,xse),Op.set(0,0,-1).applyQuaternion(i2),Fp.set(0,1,0).applyQuaternion(i2),t.positionX){const n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Pp.x,n),t.positionY.linearRampToValueAtTime(Pp.y,n),t.positionZ.linearRampToValueAtTime(Pp.z,n),t.forwardX.linearRampToValueAtTime(Op.x,n),t.forwardY.linearRampToValueAtTime(Op.y,n),t.forwardZ.linearRampToValueAtTime(Op.z,n),t.upX.linearRampToValueAtTime(Fp.x,n),t.upY.linearRampToValueAtTime(Fp.y,n),t.upZ.linearRampToValueAtTime(Fp.z,n)}else t.setPosition(Pp.x,Pp.y,Pp.z),t.setOrientation(Op.x,Op.y,Op.z,Fp.x,Fp.y,Fp.z)}}class HU extends Fn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){Se("Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){Se("Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){Se("Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){Se("Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){Se("Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(Se("Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){Se("Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),e.sourceType!=="buffer"?(Se("Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const Gp=new z,cV=new Fs,_se=new z,zp=new z;class Q9 extends HU{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Gp,cV,_se),zp.set(0,0,1).applyQuaternion(cV);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Gp.x,n),t.positionY.linearRampToValueAtTime(Gp.y,n),t.positionZ.linearRampToValueAtTime(Gp.z,n),t.orientationX.linearRampToValueAtTime(zp.x,n),t.orientationY.linearRampToValueAtTime(zp.y,n),t.orientationZ.linearRampToValueAtTime(zp.z,n)}else t.setPosition(Gp.x,Gp.y,Gp.z),t.setOrientation(zp.x,zp.y,zp.z)}}class $9{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class kU{constructor(e,t,n){this.binding=e,this.valueSize=n;let s,r,a;switch(t){case"quaternion":s=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":s=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:s=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,s=this.valueSize,r=e*s+s;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==s;++o)n[r+o]=n[o];a=t}else{a+=t;const o=t/a;this._mixBufferRegion(n,r,0,o,s)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,s=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,s=e*t+t,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const l=t*this._origIndex;this._mixBufferRegion(n,s,l,1-r,t)}a>0&&this._mixBufferRegionAdditive(n,s,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(n[l]!==n[l+t]){o.setValue(n,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,s=n*this._origIndex;e.getValue(t,s);for(let r=n,a=s;r!==a;++r)t[r]=t[s+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,s,r){if(s>=.5)for(let a=0;a!==r;++a)e[t+a]=e[n+a]}_slerp(e,t,n,s){Fs.slerpFlat(e,t,e,t,e,n,s)}_slerpAdditive(e,t,n,s,r){const a=this._workIndex*r;Fs.multiplyQuaternionsFlat(e,a,e,t,e,n),Fs.slerpFlat(e,t,e,t,e,a,s)}_lerp(e,t,n,s,r){const a=1-s;for(let o=0;o!==r;++o){const l=t+o;e[l]=e[l]*a+e[n+o]*s}}_lerpAdditive(e,t,n,s,r){for(let a=0;a!==r;++a){const o=t+a;e[o]=e[o]+e[n+a]*s}}}const WU="\\[\\]\\.:\\/",vse=new RegExp("["+WU+"]","g"),XU="[^"+WU+"]",bse="[^"+WU.replace("\\.","")+"]",Sse=/((?:WC+[\/:])*)/.source.replace("WC",XU),Tse=/(WCOD+)?/.source.replace("WCOD",bse),Ase=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",XU),Mse=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",XU),Ese=new RegExp("^"+Sse+Tse+Ase+Mse+"$"),Cse=["material","materials","bones","map"];class wse{constructor(e,t,n){const s=n||qn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,s=this._bindings[n];s!==void 0&&s.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=n.length;s!==r;++s)n[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class qn{constructor(e,t,n){this.path=t,this.parsedPath=n||qn.parseTrackName(t),this.node=qn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new qn.Composite(e,t,n):new qn(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(vse,"")}static parseTrackName(e){const t=Ese.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=n.nodeName&&n.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=n.nodeName.substring(s+1);Cse.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,s),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(r){for(let a=0;a<r.length;a++){const o=r[a];if(o.name===t||o.uuid===t)return o;const l=n(o.children);if(l)return l}return null},s=n(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)e[t++]=n[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,s=t.propertyName;let r=t.propertyIndex;if(e||(e=qn.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){Se("PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){De("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){De("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){De("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){De("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){De("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){De("PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){De("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const a=e[s];if(a===void 0){const c=t.nodeName;De("PropertyBinding: Trying to update property for track: "+c+"."+s+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?o=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){De("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){De("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}qn.Composite=wse;qn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};qn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};qn.prototype.GetterByBindingType=[qn.prototype._getValue_direct,qn.prototype._getValue_array,qn.prototype._getValue_arrayElement,qn.prototype._getValue_toArray];qn.prototype.SetterByBindingTypeAndVersioning=[[qn.prototype._setValue_direct,qn.prototype._setValue_direct_setNeedsUpdate,qn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[qn.prototype._setValue_array,qn.prototype._setValue_array_setNeedsUpdate,qn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[qn.prototype._setValue_arrayElement,qn.prototype._setValue_arrayElement_setNeedsUpdate,qn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[qn.prototype._setValue_fromArray,qn.prototype._setValue_fromArray_setNeedsUpdate,qn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class eW{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ko(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,s=arguments.length;n!==s;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,s=this._parsedPaths,r=this._bindings,a=r.length;let o,l=e.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const f=arguments[u],m=f.uuid;let g=t[m];if(g===void 0){g=l++,t[m]=g,e.push(f);for(let x=0,v=a;x!==v;++x)r[x].push(new qn(f,n[x],s[x]))}else if(g<c){o=e[g];const x=--c,v=e[x];t[v.uuid]=g,e[g]=v,t[m]=x,e[x]=f;for(let y=0,b=a;y!==b;++y){const S=r[y],T=S[x];let M=S[g];S[g]=T,M===void 0&&(M=new qn(f,n[y],s[y])),S[x]=M}}else e[g]!==o&&De("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,s=n.length;let r=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],c=l.uuid,u=t[c];if(u!==void 0&&u>=r){const h=r++,f=e[h];t[f.uuid]=u,e[u]=f,t[c]=h,e[h]=l;for(let m=0,g=s;m!==g;++m){const x=n[m],v=x[h],y=x[u];x[u]=v,x[h]=y}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,s=n.length;let r=this.nCachedObjects_,a=e.length;for(let o=0,l=arguments.length;o!==l;++o){const c=arguments[o],u=c.uuid,h=t[u];if(h!==void 0)if(delete t[u],h<r){const f=--r,m=e[f],g=--a,x=e[g];t[m.uuid]=h,e[h]=m,t[x.uuid]=f,e[f]=x,e.pop();for(let v=0,y=s;v!==y;++v){const b=n[v],S=b[f],T=b[g];b[h]=S,b[f]=T,b.pop()}}else{const f=--a,m=e[f];f>0&&(t[m.uuid]=h),e[h]=m,e.pop();for(let g=0,x=s;g!==x;++g){const v=n[g];v[h]=v[f],v.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let s=n[e];const r=this._bindings;if(s!==void 0)return r[s];const a=this._paths,o=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);s=r.length,n[e]=s,a.push(e),o.push(t),r.push(h);for(let f=u,m=l.length;f!==m;++f){const g=l[f];h[f]=new qn(g,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const s=this._paths,r=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],c=e[o];t[c]=n,a[n]=l,a.pop(),r[n]=r[o],r.pop(),s[n]=s[o],s.pop()}}}class qU{constructor(e,t,n=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=s;const r=t.tracks,a=r.length,o=new Array(a),l={endingStart:Fd,endingEnd:Fd};for(let c=0;c!==a;++c){const u=r[c].createInterpolant(null);o[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=ZL,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n=!1){if(e.fadeOut(t),this.fadeIn(t),n===!0){const s=this._clip.duration,r=e._clip.duration,a=r/s,o=s/r;e.warp(1,a,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n=!1){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const s=this._mixer,r=s.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=s._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=r,l[1]=r+n,c[0]=e/a,c[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,s){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const l=(e-r)*n;l<0||n===0?t=0:(this._startTime=null,t=n*l)}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case WE:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulateAdditive(o);break;case vS:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(s,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const s=n.evaluate(e)[0];t*=s,e>n.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const s=n.evaluate(e)[0];t*=s,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let s=this.time+e,r=this._loopCount;const a=n===JL;if(e===0)return r===-1?s:a&&(r&1)===1?t-s:s;if(n===KL){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),s>=t||s<0){const o=Math.floor(s/t);s-=t*o,r+=Math.abs(o);const l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=s;if(a&&(r&1)===1)return t-s}return s}_setEndings(e,t,n){const s=this._interpolantSettings;n?(s.endingStart=Gd,s.endingEnd=Gd):(e?s.endingStart=this.zeroSlopeAtStart?Gd:Fd:s.endingStart=Wy,t?s.endingEnd=this.zeroSlopeAtEnd?Gd:Fd:s.endingEnd=Wy)}_scheduleFading(e,t,n){const s=this._mixer,r=s.time;let a=this._weightInterpolant;a===null&&(a=s._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,l[0]=t,o[1]=r+e,l[1]=n,this}}const Rse=new Float32Array(1);class tW extends Ta{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,s=e._clip.tracks,r=s.length,a=e._propertyBindings,o=e._interpolants,l=n.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==r;++h){const f=s[h],m=f.name;let g=u[m];if(g!==void 0)++g.referenceCount,a[h]=g;else{if(g=a[h],g!==void 0){g._cacheIndex===null&&(++g.referenceCount,this._addInactiveBinding(g,l,m));continue}const x=t&&t._propertyBindings[h].binding.parsedPath;g=new kU(qn.create(n,m,x),f.ValueTypeName,f.getValueSize()),++g.referenceCount,this._addInactiveBinding(g,l,m),a[h]=g}o[h].resultBuffer=g.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,s=e._clip.uuid,r=this._actionsByClip[s];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,s,n)}const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const r=t[n];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const r=t[n];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const s=this._actions,r=this._actionsByClip;let a=r[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=s.length,s.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],s=e._cacheIndex;n._cacheIndex=s,t[s]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,a=this._actionsByClip,o=a[r],l=o.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;const h=o.actionByRoot,f=(e._localRoot||this._root).uuid;delete h[f],l.length===0&&delete a[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const r=t[n];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,s=this._nActiveActions++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,s=--this._nActiveActions,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const s=this._bindingsByRootAndName,r=this._bindings;let a=s[t];a===void 0&&(a={},s[t]=a),a[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,s=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[s],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete o[r],Object.keys(o).length===0&&delete a[s]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,s=this._nActiveBindings++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,s=--this._nActiveBindings,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new yC(new Float32Array(2),new Float32Array(2),1,Rse),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,s=--this._nActiveControlInterpolants,r=t[s];e.__cacheIndex=s,t[s]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const s=t||this._root,r=s.uuid;let a=typeof e=="string"?tg.findByName(s,e):e;const o=a!==null?a.uuid:e,l=this._actionsByClip[o];let c=null;if(n===void 0&&(a!==null?n=a.blendMode:n=vS),l!==void 0){const h=l.actionByRoot[r];if(h!==void 0&&h.blendMode===n)return h;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const u=new qU(this,a,t,n);return this._bindAction(u,c),this._addInactiveAction(u,o,r),u}existingAction(e,t){const n=t||this._root,s=n.uuid,r=typeof e=="string"?tg.findByName(n,e):e,a=r?r.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[s]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,s=this.time+=e,r=Math.sign(e),a=this._accuIndex^=1;for(let c=0;c!==n;++c)t[c]._update(s,e,r,a);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,s=this._actionsByClip,r=s[n];if(r!==void 0){const a=r.knownActions;for(let o=0,l=a.length;o!==l;++o){const c=a[o];this._deactivateAction(c);const u=c._cacheIndex,h=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,t[u]=h,t.pop(),this._removeInactiveBindingsForAction(c)}delete s[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const a in n){const o=n[a].actionByRoot,l=o[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const s=this._bindingsByRootAndName,r=s[t];if(r!==void 0)for(const a in r){const o=r[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class nW extends Si{constructor(e=1,t=1,n=1,s={}){super(e,t,s),this.isRenderTarget3D=!0,this.depth=n,this.texture=new ES(null,e,t,n),this._setTextureOptions(s),this.texture.isRenderTargetTexture=!0}}let iW=class sW{constructor(e){this.value=e}clone(){return new sW(this.value.clone===void 0?this.value:this.value.clone())}},Nse=0,rW=class extends Ta{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Nse++}),this.name="",this.usage=Bh,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,s=t.length;n<s;n++){const r=Array.isArray(t[n])?t[n]:[t[n]];for(let a=0;a<r.length;a++)this.uniforms.push(r[a].clone())}return this}clone(){return new this.constructor().copy(this)}};class jU extends vg{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class aW{constructor(e,t,n,s,r,a=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=s,this.count=r,this.normalized=a,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const uV=new Lt;class YU{constructor(e,t,n=0,s=1/0){this.ray=new Zf(e,t),this.near=n,this.far=s,this.camera=null,this.layers=new $m,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):De("Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return uV.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(uV),this}intersectObject(e,t=!0,n=[]){return LD(e,this,n,t),n.sort(hV),n}intersectObjects(e,t=!0,n=[]){for(let s=0,r=e.length;s<r;s++)LD(e[s],this,n,t);return n.sort(hV),n}}function hV(i,e){return i.distance-e.distance}function LD(i,e,t,n){let s=!0;if(i.layers.test(e.layers)&&i.raycast(e,t)===!1&&(s=!1),s===!0&&n===!0){const r=i.children;for(let a=0,o=r.length;a<o;a++)LD(r[a],e,t,!0)}}class oW{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,e.hidden!==void 0&&(this._pageVisibilityHandler=Bse.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(e!==void 0?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function Bse(){this._document.hidden===!1&&this.reset()}class Cb{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=yn(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(yn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class lW{constructor(e=1,t=0,n=0){this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}class Ix{constructor(e,t,n,s){Ix.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,s)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,s){const r=this.elements;return r[0]=e,r[2]=t,r[1]=n,r[3]=s,this}}const dV=new Ae;class cW{constructor(e=new Ae(1/0,1/0),t=new Ae(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=dV.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,dV).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const fV=new z,k1=new z,T0=new z,A0=new z,s2=new z,Dse=new z,Lse=new z;class uW{constructor(e=new z,t=new z){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){fV.subVectors(e,this.start),k1.subVectors(this.end,this.start);const n=k1.dot(k1);let r=k1.dot(fV)/n;return t&&(r=yn(r,0,1)),r}closestPointToPoint(e,t,n){const s=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(s).add(this.start)}distanceSqToLine3(e,t=Dse,n=Lse){const s=10000000000000001e-32;let r,a;const o=this.start,l=e.start,c=this.end,u=e.end;T0.subVectors(c,o),A0.subVectors(u,l),s2.subVectors(o,l);const h=T0.dot(T0),f=A0.dot(A0),m=A0.dot(s2);if(h<=s&&f<=s)return t.copy(o),n.copy(l),t.sub(n),t.dot(t);if(h<=s)r=0,a=m/f,a=yn(a,0,1);else{const g=T0.dot(s2);if(f<=s)a=0,r=yn(-g/h,0,1);else{const x=T0.dot(A0),v=h*f-x*x;v!==0?r=yn((x*m-g*f)/v,0,1):r=0,a=(x*r+m)/f,a<0?(a=0,r=yn(-g/h,0,1)):a>1&&(a=1,r=yn((x-g)/h,0,1))}}return t.copy(o).add(T0.multiplyScalar(r)),n.copy(l).add(A0.multiplyScalar(a)),t.sub(n),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const pV=new z;class hW extends Fn{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new pn,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const c=a/l*Math.PI*2,u=o/l*Math.PI*2;s.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}n.setAttribute("position",new qt(s,3));const r=new Ir({fog:!1,toneMapped:!1});this.cone=new Zl(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),pV.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(pV),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const pd=new z,W1=new Lt,r2=new Lt;class dW extends Zl{constructor(e){const t=fW(e),n=new pn,s=[],r=[];for(let c=0;c<t.length;c++){const u=t[c];u.parent&&u.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),r.push(0,0,0),r.push(0,0,0))}n.setAttribute("position",new qt(s,3)),n.setAttribute("color",new qt(r,3));const a=new Ir({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,a),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const o=new Ye(255),l=new Ye(65280);this.setColors(o,l)}updateMatrixWorld(e){const t=this.bones,n=this.geometry,s=n.getAttribute("position");r2.copy(this.root.matrixWorld).invert();for(let r=0,a=0;r<t.length;r++){const o=t[r];o.parent&&o.parent.isBone&&(W1.multiplyMatrices(r2,o.matrixWorld),pd.setFromMatrixPosition(W1),s.setXYZ(a,pd.x,pd.y,pd.z),W1.multiplyMatrices(r2,o.parent.matrixWorld),pd.setFromMatrixPosition(W1),s.setXYZ(a+1,pd.x,pd.y,pd.z),a+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const s=this.geometry.getAttribute("color");for(let r=0;r<s.count;r+=2)s.setXYZ(r,e.r,e.g,e.b),s.setXYZ(r+1,t.r,t.g,t.b);return s.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function fW(i){const e=[];i.isBone===!0&&e.push(i);for(let t=0;t<i.children.length;t++)e.push(...fW(i.children[t]));return e}class pW extends Kn{constructor(e,t,n){const s=new Sg(t,4,2),r=new Ts({wireframe:!0,fog:!1,toneMapped:!1});super(s,r),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Use=new z,mV=new Ye,gV=new Ye;class mW extends Fn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const s=new Lx(t);s.rotateY(Math.PI*.5),this.material=new Ts({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=s.getAttribute("position"),a=new Float32Array(r.count*3);s.setAttribute("color",new Nn(a,3)),this.add(new Kn(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");mV.copy(this.light.color),gV.copy(this.light.groundColor);for(let n=0,s=t.count;n<s;n++){const r=n<s/2?mV:gV;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Use.setFromMatrixPosition(this.light.matrixWorld).negate())}}class gW extends Zl{constructor(e=10,t=10,n=4473924,s=8947848){n=new Ye(n),s=new Ye(s);const r=t/2,a=e/t,o=e/2,l=[],c=[];for(let f=0,m=0,g=-o;f<=t;f++,g+=a){l.push(-o,0,g,o,0,g),l.push(g,0,-o,g,0,o);const x=f===r?n:s;x.toArray(c,m),m+=3,x.toArray(c,m),m+=3,x.toArray(c,m),m+=3,x.toArray(c,m),m+=3}const u=new pn;u.setAttribute("position",new qt(l,3)),u.setAttribute("color",new qt(c,3));const h=new Ir({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class yW extends Zl{constructor(e=10,t=16,n=8,s=64,r=4473924,a=8947848){r=new Ye(r),a=new Ye(a);const o=[],l=[];if(t>1)for(let h=0;h<t;h++){const f=h/t*(Math.PI*2),m=Math.sin(f)*e,g=Math.cos(f)*e;o.push(0,0,0),o.push(m,0,g);const x=h&1?r:a;l.push(x.r,x.g,x.b),l.push(x.r,x.g,x.b)}for(let h=0;h<n;h++){const f=h&1?r:a,m=e-e/n*h;for(let g=0;g<s;g++){let x=g/s*(Math.PI*2),v=Math.sin(x)*m,y=Math.cos(x)*m;o.push(v,0,y),l.push(f.r,f.g,f.b),x=(g+1)/s*(Math.PI*2),v=Math.sin(x)*m,y=Math.cos(x)*m,o.push(v,0,y),l.push(f.r,f.g,f.b)}}const c=new pn;c.setAttribute("position",new qt(o,3)),c.setAttribute("color",new qt(l,3));const u=new Ir({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const yV=new z,X1=new z,xV=new z;class xW extends Fn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let s=new pn;s.setAttribute("position",new qt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Ir({fog:!1,toneMapped:!1});this.lightPlane=new mu(s,r),this.add(this.lightPlane),s=new pn,s.setAttribute("position",new qt([0,0,0,0,0,1],3)),this.targetLine=new mu(s,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),yV.setFromMatrixPosition(this.light.matrixWorld),X1.setFromMatrixPosition(this.light.target.matrixWorld),xV.subVectors(X1,yV),this.lightPlane.lookAt(X1),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(X1),this.targetLine.scale.z=xV.length()}}const q1=new z,_s=new Cx;class _W extends Zl{constructor(e){const t=new pn,n=new Ir({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],r=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(g,x){l(g),l(x)}function l(g){s.push(0,0,0),r.push(0,0,0),a[g]===void 0&&(a[g]=[]),a[g].push(s.length/3-1)}t.setAttribute("position",new qt(s,3)),t.setAttribute("color",new qt(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new Ye(16755200),u=new Ye(16711680),h=new Ye(43775),f=new Ye(16777215),m=new Ye(3355443);this.setColors(c,u,h,f,m)}setColors(e,t,n,s,r){const o=this.geometry.getAttribute("color");return o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,t.r,t.g,t.b),o.setXYZ(25,t.r,t.g,t.b),o.setXYZ(26,t.r,t.g,t.b),o.setXYZ(27,t.r,t.g,t.b),o.setXYZ(28,t.r,t.g,t.b),o.setXYZ(29,t.r,t.g,t.b),o.setXYZ(30,t.r,t.g,t.b),o.setXYZ(31,t.r,t.g,t.b),o.setXYZ(32,n.r,n.g,n.b),o.setXYZ(33,n.r,n.g,n.b),o.setXYZ(34,n.r,n.g,n.b),o.setXYZ(35,n.r,n.g,n.b),o.setXYZ(36,n.r,n.g,n.b),o.setXYZ(37,n.r,n.g,n.b),o.setXYZ(38,s.r,s.g,s.b),o.setXYZ(39,s.r,s.g,s.b),o.setXYZ(40,r.r,r.g,r.b),o.setXYZ(41,r.r,r.g,r.b),o.setXYZ(42,r.r,r.g,r.b),o.setXYZ(43,r.r,r.g,r.b),o.setXYZ(44,r.r,r.g,r.b),o.setXYZ(45,r.r,r.g,r.b),o.setXYZ(46,r.r,r.g,r.b),o.setXYZ(47,r.r,r.g,r.b),o.setXYZ(48,r.r,r.g,r.b),o.setXYZ(49,r.r,r.g,r.b),o.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap,n=1,s=1;let r,a;if(_s.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)r=1,a=0;else if(this.camera.coordinateSystem===Cr)r=-1,a=1;else if(this.camera.coordinateSystem===Ka)r=0,a=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);Bs("c",t,e,_s,0,0,r),Bs("t",t,e,_s,0,0,a),Bs("n1",t,e,_s,-n,-s,r),Bs("n2",t,e,_s,n,-s,r),Bs("n3",t,e,_s,-n,s,r),Bs("n4",t,e,_s,n,s,r),Bs("f1",t,e,_s,-n,-s,a),Bs("f2",t,e,_s,n,-s,a),Bs("f3",t,e,_s,-n,s,a),Bs("f4",t,e,_s,n,s,a),Bs("u1",t,e,_s,n*.7,s*1.1,r),Bs("u2",t,e,_s,-n*.7,s*1.1,r),Bs("u3",t,e,_s,0,s*2,r),Bs("cf1",t,e,_s,-n,0,a),Bs("cf2",t,e,_s,n,0,a),Bs("cf3",t,e,_s,0,-s,a),Bs("cf4",t,e,_s,0,s,a),Bs("cn1",t,e,_s,-n,0,r),Bs("cn2",t,e,_s,n,0,r),Bs("cn3",t,e,_s,0,-s,r),Bs("cn4",t,e,_s,0,s,r),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Bs(i,e,t,n,s,r,a){q1.set(s,r,a).unproject(n);const o=e[i];if(o!==void 0){const l=t.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],q1.x,q1.y,q1.z)}}const j1=new Br;class vW extends Zl{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array(8*3),r=new pn;r.setIndex(new Nn(n,1)),r.setAttribute("position",new Nn(s,3)),super(r,new Ir({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&j1.setFromObject(this.object),j1.isEmpty())return;const e=j1.min,t=j1.max,n=this.geometry.attributes.position,s=n.array;s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=e.x,s[4]=t.y,s[5]=t.z,s[6]=e.x,s[7]=e.y,s[8]=t.z,s[9]=t.x,s[10]=e.y,s[11]=t.z,s[12]=t.x,s[13]=t.y,s[14]=e.z,s[15]=e.x,s[16]=t.y,s[17]=e.z,s[18]=e.x,s[19]=e.y,s[20]=e.z,s[21]=t.x,s[22]=e.y,s[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class bW extends Zl{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new pn;r.setIndex(new Nn(n,1)),r.setAttribute("position",new qt(s,3)),super(r,new Ir({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class SW extends mu{constructor(e,t=1,n=16776960){const s=n,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new pn;a.setAttribute("position",new qt(r,3)),a.computeBoundingSphere(),super(a,new Ir({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new pn;l.setAttribute("position",new qt(o,3)),l.computeBoundingSphere(),this.add(new Kn(l,new Ts({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const _V=new z;let Y1,a2;class TW extends Fn{constructor(e=new z(0,0,1),t=new z(0,0,0),n=1,s=16776960,r=n*.2,a=r*.2){super(),this.type="ArrowHelper",Y1===void 0&&(Y1=new pn,Y1.setAttribute("position",new qt([0,0,0,0,1,0],3)),a2=new Bx(.5,1,5,1),a2.translate(0,-.5,0)),this.position.copy(t),this.line=new mu(Y1,new Ir({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Kn(a2,new Ts({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{_V.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(_V,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AW extends Zl{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new pn;s.setAttribute("position",new qt(t,3)),s.setAttribute("color",new qt(n,3));const r=new Ir({vertexColors:!0,toneMapped:!1});super(s,r),this.type="AxesHelper"}setColors(e,t,n){const s=new Ye,r=this.geometry.attributes.color.array;return s.set(e),s.toArray(r,0),s.toArray(r,3),s.set(t),s.toArray(r,6),s.toArray(r,9),s.set(n),s.toArray(r,12),s.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class MW{constructor(){this.type="ShapePath",this.color=new Ye,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Tb,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,s){return this.currentPath.quadraticCurveTo(e,t,n,s),this}bezierCurveTo(e,t,n,s,r,a){return this.currentPath.bezierCurveTo(e,t,n,s,r,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(y){const b=[];for(let S=0,T=y.length;S<T;S++){const M=y[S],C=new sf;C.curves=M.curves,b.push(C)}return b}function n(y,b){const S=b.length;let T=!1;for(let M=S-1,C=0;C<S;M=C++){let w=b[M],N=b[C],E=N.x-w.x,B=N.y-w.y;if(Math.abs(B)>Number.EPSILON){if(B<0&&(w=b[C],E=-E,N=b[M],B=-B),y.y<w.y||y.y>N.y)continue;if(y.y===w.y){if(y.x===w.x)return!0}else{const U=B*(y.x-w.x)-E*(y.y-w.y);if(U===0)return!0;if(U<0)continue;T=!T}}else{if(y.y!==w.y)continue;if(N.x<=y.x&&y.x<=w.x||w.x<=y.x&&y.x<=N.x)return!0}}return T}const s=Ul.isClockWise,r=this.subPaths;if(r.length===0)return[];let a,o,l;const c=[];if(r.length===1)return o=r[0],l=new sf,l.curves=o.curves,c.push(l),c;let u=!s(r[0].getPoints());u=e?!u:u;const h=[],f=[];let m=[],g=0,x;f[g]=void 0,m[g]=[];for(let y=0,b=r.length;y<b;y++)o=r[y],x=o.getPoints(),a=s(x),a=e?!a:a,a?(!u&&f[g]&&g++,f[g]={s:new sf,p:x},f[g].s.curves=o.curves,u&&g++,m[g]=[]):m[g].push({h:o,p:x[0]});if(!f[0])return t(r);if(f.length>1){let y=!1,b=0;for(let S=0,T=f.length;S<T;S++)h[S]=[];for(let S=0,T=f.length;S<T;S++){const M=m[S];for(let C=0;C<M.length;C++){const w=M[C];let N=!0;for(let E=0;E<f.length;E++)n(w.p,f[E].p)&&(S!==E&&b++,N?(N=!1,h[E].push(w)):y=!0);N&&h[S].push(w)}}b>0&&y===!1&&(m=h)}let v;for(let y=0,b=f.length;y<b;y++){l=f[y].s,c.push(l),v=m[y];for(let S=0,T=v.length;S<T;S++)l.holes.push(v[S].h)}return c}}class EW extends Ta{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){Se("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function Ise(i,e){const t=i.image&&i.image.width?i.image.width/i.image.height:1;return t>e?(i.repeat.x=1,i.repeat.y=t/e,i.offset.x=0,i.offset.y=(1-i.repeat.y)/2):(i.repeat.x=e/t,i.repeat.y=1,i.offset.x=(1-i.repeat.x)/2,i.offset.y=0),i}function Pse(i,e){const t=i.image&&i.image.width?i.image.width/i.image.height:1;return t>e?(i.repeat.x=e/t,i.repeat.y=1,i.offset.x=(1-i.repeat.x)/2,i.offset.y=0):(i.repeat.x=1,i.repeat.y=t/e,i.offset.x=0,i.offset.y=(1-i.repeat.y)/2),i}function Ose(i){return i.repeat.x=1,i.repeat.y=1,i.offset.x=0,i.offset.y=0,i}function IM(i,e,t,n){const s=Fse(n);switch(t){case _S:return i*e;case ql:return i*e/s.components*s.byteLength;case Oh:return i*e/s.components*s.byteLength;case Wr:return i*e*2/s.components*s.byteLength;case Yf:return i*e*2/s.components*s.byteLength;case gg:return i*e*3/s.components*s.byteLength;case ii:return i*e*4/s.components*s.byteLength;case Kf:return i*e*4/s.components*s.byteLength;case tu:case nu:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case iu:case su:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case qm:case Ym:return Math.max(i,16)*Math.max(e,8)/4;case Xm:case jm:return Math.max(i,8)*Math.max(e,8)/2;case ff:case pf:case gf:case yf:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case mf:case Rh:case xf:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case _f:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case vf:return Math.floor((i+4)/5)*Math.floor((e+3)/4)*16;case bf:return Math.floor((i+4)/5)*Math.floor((e+4)/5)*16;case Sf:return Math.floor((i+5)/6)*Math.floor((e+4)/5)*16;case Tf:return Math.floor((i+5)/6)*Math.floor((e+5)/6)*16;case Af:return Math.floor((i+7)/8)*Math.floor((e+4)/5)*16;case Mf:return Math.floor((i+7)/8)*Math.floor((e+5)/6)*16;case Ef:return Math.floor((i+7)/8)*Math.floor((e+7)/8)*16;case Cf:return Math.floor((i+9)/10)*Math.floor((e+4)/5)*16;case wf:return Math.floor((i+9)/10)*Math.floor((e+5)/6)*16;case Rf:return Math.floor((i+9)/10)*Math.floor((e+7)/8)*16;case Nf:return Math.floor((i+9)/10)*Math.floor((e+9)/10)*16;case Bf:return Math.floor((i+11)/12)*Math.floor((e+9)/10)*16;case Df:return Math.floor((i+11)/12)*Math.floor((e+11)/12)*16;case Lf:case xb:case _b:return Math.ceil(i/4)*Math.ceil(e/4)*16;case Uf:case If:return Math.ceil(i/4)*Math.ceil(e/4)*8;case Nh:case Pf:return Math.ceil(i/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function Fse(i){switch(i){case ei:case $c:return{byteLength:1,components:1};case ko:case eu:case ln:return{byteLength:2,components:1};case Sx:case Tx:return{byteLength:2,components:4};case Jn:case Is:case Rn:return{byteLength:4,components:1};case Ax:case Mx:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${i}.`)}class CW{static contain(e,t){return Ise(e,t)}static cover(e,t){return Pse(e,t)}static fill(e){return Ose(e)}static getByteLength(e,t,n,s){return IM(e,t,n,s)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:bu}}));typeof window<"u"&&(window.__THREE__?Se("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=bu);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Gse=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],o2=new WeakMap;class wW{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=Gse,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:n,material:s,object:r}=e;if(t={material:this.getMaterialData(s),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:r.matrixWorld.clone()},r.center&&(t.center=r.center.clone()),r.morphTargetInfluences&&(t.morphTargetInfluences=r.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:a,height:o}=e.context;t.bufferWidth=a,t.bufferHeight=o}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const s=e[n];t[n]={version:s.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return!!(e.context.modelViewMatrix||e.context.modelNormalViewMatrix||e.context.getAO||e.context.getShadow)}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const s=e[n];s!=null&&(typeof s=="object"&&s.clone!==void 0?s.isTexture===!0?t[n]={id:s.id,version:s.version}:t[n]=s.clone():t[n]=s)}return t}equals(e,t){const{object:n,material:s,geometry:r}=e,a=this.getRenderObjectData(e);if(a.worldMatrix.equals(n.matrixWorld)!==!0)return a.worldMatrix.copy(n.matrixWorld),!1;const o=a.material;for(const v in o){const y=o[v],b=s[v];if(y.equals!==void 0){if(y.equals(b)===!1)return y.copy(b),!1}else if(b.isTexture===!0){if(y.id!==b.id||y.version!==b.version)return y.id=b.id,y.version=b.version,!1}else if(y!==b)return o[v]=b,!1}if(o.transmission>0){const{width:v,height:y}=e.context;if(a.bufferWidth!==v||a.bufferHeight!==y)return a.bufferWidth=v,a.bufferHeight=y,!1}const l=a.geometry,c=r.attributes,u=l.attributes,h=Object.keys(u),f=Object.keys(c);if(l.id!==r.id)return l.id=r.id,!1;if(h.length!==f.length)return a.geometry.attributes=this.getAttributesData(c),!1;for(const v of h){const y=u[v],b=c[v];if(b===void 0)return delete u[v],!1;if(y.version!==b.version)return y.version=b.version,!1}const m=r.index,g=l.indexVersion,x=m?m.version:null;if(g!==x)return l.indexVersion=x,!1;if(l.drawRange.start!==r.drawRange.start||l.drawRange.count!==r.drawRange.count)return l.drawRange.start=r.drawRange.start,l.drawRange.count=r.drawRange.count,!1;if(a.morphTargetInfluences){let v=!1;for(let y=0;y<a.morphTargetInfluences.length;y++)a.morphTargetInfluences[y]!==n.morphTargetInfluences[y]&&(a.morphTargetInfluences[y]=n.morphTargetInfluences[y],v=!0);if(v)return!1}if(a.lights){for(let v=0;v<t.length;v++)if(a.lights[v].map!==t[v].map)return!1}return a.center&&a.center.equals(n.center)===!1?(a.center.copy(n.center),!0):(e.bundle!==null&&(a.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const n of e)n.isSpotLight===!0&&n.map!==null&&t.push({map:n.map.version});return t}getLights(e,t){if(o2.has(e)){const s=o2.get(e);if(s.renderId===t)return s.lightsData}const n=this.getLightsData(e.getLights());return o2.set(e,{renderId:t,lightsData:n}),n}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const s=e.object.static===!0,r=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(s||r)return!1;const a=this.getLights(e.lightsNode,n);return this.equals(e,a)!==!0}}function KU(i,e=0){let t=3735928559^e,n=1103547991^e;if(i instanceof Array)for(let s=0,r;s<i.length;s++)r=i[s],t=Math.imul(t^r,2654435761),n=Math.imul(n^r,1597334677);else for(let s=0,r;s<i.length;s++)r=i.charCodeAt(s),t=Math.imul(t^r,2654435761),n=Math.imul(n^r,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&n)+(t>>>0)}const Px=i=>KU(i),Eg=i=>KU(i),_y=(...i)=>KU(i),zse=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),vV=new WeakMap;function ZU(i){return zse.get(i)}function wb(i){if(/[iu]?vec\d/.test(i))return i.startsWith("ivec")?Int32Array:i.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(i)||/float/.test(i))return Float32Array;if(/uint/.test(i))return Uint32Array;if(/int/.test(i))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${i}`)}function JU(i){if(/float|int|uint/.test(i))return 1;if(/vec2/.test(i))return 2;if(/vec3/.test(i))return 3;if(/vec4/.test(i)||/mat2/.test(i))return 4;if(/mat3/.test(i))return 9;if(/mat4/.test(i))return 16;De("TSL: Unsupported type:",i)}function RW(i){if(/float|int|uint/.test(i))return 1;if(/vec2/.test(i))return 2;if(/vec3/.test(i))return 3;if(/vec4/.test(i)||/mat2/.test(i))return 4;if(/mat3/.test(i))return 12;if(/mat4/.test(i))return 16;De("TSL: Unsupported type:",i)}function NW(i){if(/float|int|uint/.test(i))return 4;if(/vec2/.test(i))return 8;if(/vec3/.test(i)||/vec4/.test(i))return 16;if(/mat2/.test(i))return 8;if(/mat3/.test(i)||/mat4/.test(i))return 16;De("TSL: Unsupported type:",i)}function fh(i){if(i==null)return null;const e=typeof i;return i.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":i.isVector2===!0?"vec2":i.isVector3===!0?"vec3":i.isVector4===!0?"vec4":i.isMatrix2===!0?"mat2":i.isMatrix3===!0?"mat3":i.isMatrix4===!0?"mat4":i.isColor===!0?"color":i instanceof ArrayBuffer?"ArrayBuffer":null}function CC(i,...e){const t=i?i.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),i==="color"?new Ye(...e):t==="vec2"?new Ae(...e):t==="vec3"?new z(...e):t==="vec4"?new un(...e):t==="mat2"?new Ix(...e):t==="mat3"?new gn(...e):t==="mat4"?new Lt(...e):i==="bool"?e[0]||!1:i==="float"||i==="int"||i==="uint"?e[0]||0:i==="string"?e[0]||"":i==="ArrayBuffer"?eI(e[0]):null}function QU(i){let e=vV.get(i);return e===void 0&&(e={},vV.set(i,e)),e}function $U(i){let e="";const t=new Uint8Array(i);for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function eI(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0)).buffer}var Vse=Object.freeze({__proto__:null,arrayBufferToBase64:$U,base64ToArrayBuffer:eI,getAlignmentFromType:NW,getDataFromObject:QU,getLengthFromType:JU,getMemoryLengthFromType:RW,getTypeFromLength:ZU,getTypedArrayFromType:wb,getValueFromType:CC,getValueType:fh,hash:_y,hashArray:Eg,hashString:Px});const iy={VERTEX:"vertex",FRAGMENT:"fragment"},on={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},BW={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},wr={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},tI=["fragment","vertex"],PM=["setup","analyze","generate"],OM=[...tI,"compute"],ep=["x","y","z","w"],Hse={analyze:"setup",generate:"analyze"};let kse=0;class Gt extends Ta{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=on.NONE,this.updateBeforeType=on.NONE,this.updateAfterType=on.NONE,this.uuid=Fh.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:kse++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,on.FRAME)}onRenderUpdate(e){return this.onUpdate(e,on.RENDER)}onObjectUpdate(e){return this.onUpdate(e,on.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const n of Object.getOwnPropertyNames(this)){const s=this[n];if(!(n.startsWith("_")===!0||e.has(s))){if(Array.isArray(s)===!0)for(let r=0;r<s.length;r++){const a=s[r];a&&a.isNode===!0&&t.push({property:n,index:r,childNode:a})}else if(s&&s.isNode===!0)t.push({property:n,childNode:s});else if(s&&Object.getPrototypeOf(s)===Object.prototype)for(const r in s){if(r.startsWith("_")===!0)continue;const a=s[r];a&&a.isNode===!0&&t.push({property:n,index:r,childNode:a})}}}return t}getCacheKey(e=!1,t=null){if(e=e||this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);const n=[];for(const{property:s,childNode:r}of this._getChildren(t))n.push(Px(s.slice(0,-4)),r.getCacheKey(e,t));this._cacheKey=_y(Eg(n),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let n=0;for(const s of this.getChildren())t["node"+n++]=s;return t.outputNode||null}analyze(e,t=null){const n=e.increaseUsage(this);if(this.parents===!0){const s=e.getDataFromNode(this,"any");s.stages=s.stages||{},s.stages[e.shaderStage]=s.stages[e.shaderStage]||[],s.stages[e.shaderStage].push(t)}if(n===1){const s=e.getNodeProperties(this);for(const r of Object.values(s))r&&r.isNode===!0&&r.build(e,this)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(e,t)}updateBefore(){Se("Abstract function.")}updateAfter(){Se("Abstract function.")}update(){Se("Abstract function.")}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const n=this.getShared(e);if(this!==n)return n.build(e,t);if(this._beforeNodes!==null){const l=this._beforeNodes;this._beforeNodes=null;for(const c of l)c.build(e,t);this._beforeNodes=l}const s=e.getDataFromNode(this);s.buildStages=s.buildStages||{},s.buildStages[e.buildStage]=!0;const r=Hse[e.buildStage];if(r&&s.buildStages[r]!==!0){const l=e.getBuildStage();e.setBuildStage(r),this.build(e),e.setBuildStage(l)}e.addNode(this),e.addChain(this);let a=null;const o=e.getBuildStage();if(o==="setup"){this.updateReference(e);const l=e.getNodeProperties(this);if(l.initialized!==!0){l.initialized=!0,l.outputNode=this.setup(e)||l.outputNode||null;for(const c of Object.values(l))if(c&&c.isNode===!0){if(c.parents===!0){const u=e.getNodeProperties(c);u.parents=u.parents||[],u.parents.push(this)}c.build(e)}}a=l.outputNode}else if(o==="analyze")this.analyze(e,t);else if(o==="generate"){if(this.generate.length<2){const c=this.getNodeType(e),u=e.getDataFromNode(this);a=u.snippet,a===void 0?u.generated===void 0?(u.generated=!0,a=this.generate(e)||"",u.snippet=a):(Se("Node: Recursion detected.",this),a="/* Recursion detected. */"):u.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),a=e.format(a,c,t)}else a=this.generate(e,t)||"";a===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(De(`TSL: Invalid generated code, expected a "${t}".`),a=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),a}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:s,index:r,childNode:a}of t)r!==void 0?(n[s]===void 0&&(n[s]=Number.isInteger(r)?[]:{}),n[s][r]=a.toJSON(e.meta).uuid):n[s]=a.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const s=[];for(const r of e.inputNodes[n])s.push(t[r]);this[n]=s}else if(typeof e.inputNodes[n]=="object"){const s={};for(const r in e.inputNodes[n]){const a=e.inputNodes[n][r];s[r]=t[a]}this[n]=s}else{const s=e.inputNodes[n];this[n]=t[s]}}}toJSON(e){const{uuid:t,type:n}=this,s=e===void 0||typeof e=="string";s&&(e={textures:{},images:{},nodes:{}});let r=e.nodes[t];r===void 0&&(r={uuid:t,type:n,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},s!==!0&&(e.nodes[r.uuid]=r),this.serialize(r),delete r.meta);function a(o){const l=[];for(const c in o){const u=o[c];delete u.metadata,l.push(u)}return l}if(s){const o=a(e.textures),l=a(e.images),c=a(e.nodes);o.length>0&&(r.textures=o),l.length>0&&(r.images=l),c.length>0&&(r.nodes=c)}return r}}class tp extends Gt{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}generate(e){const t=this.indexNode.getNodeType(e),n=this.node.build(e),s=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${n}[ ${s} ]`}}class nI extends Gt{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const s of this.convertTo.split("|"))(n===null||e.getTypeLength(t)===e.getTypeLength(s))&&(n=s);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,s=this.getNodeType(e),r=n.build(e,s);return e.format(r,s,t)}}class ti extends Gt{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const s=e.getVectorType(this.getNodeType(e,t)),r=e.getDataFromNode(this);if(r.propertyName!==void 0)return e.format(r.propertyName,s,t);if(s!=="void"&&t!=="void"&&this.hasDependencies(e)){const a=super.build(e,s),o=e.getVarFromNode(this,null,s),l=e.getPropertyName(o);return e.addLineFlowCode(`${l} = ${a}`,this),r.snippet=a,r.propertyName=l,e.format(r.propertyName,s,t)}}return super.build(e,t)}}class DW extends ti{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),s=e.getTypeLength(n),r=this.nodes,a=e.getComponentType(n),o=[];let l=0;for(const u of r){if(l>=s){De(`TSL: Length of parameters exceeds maximum length of function '${n}()' type.`);break}let h=u.getNodeType(e),f=e.getTypeLength(h),m;if(l+f>s&&(De(`TSL: Length of '${n}()' data exceeds maximum length of output type.`),f=s-l,h=e.getTypeFromLength(f)),l+=f,m=u.build(e,h),e.getComponentType(h)!==a){const x=e.getTypeFromLength(f,a);m=e.format(m,h,x)}o.push(m)}const c=`${e.getType(n)}( ${o.join(", ")} )`;return e.format(c,n,t)}}const Wse=ep.join("");class iI extends Gt{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(ep.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const n=this.node,s=e.getTypeLength(n.getNodeType(e));let r=null;if(s>1){let a=null;this.getVectorLength()>=s&&(a=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const l=n.build(e,a);this.components.length===s&&this.components===Wse.slice(0,this.components.length)?r=e.format(l,a,t):r=e.format(`${l}.${this.components}`,this.getNodeType(e),t)}else r=n.build(e,t);return r}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class LW extends ti{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:s}=this,r=this.getNodeType(e),a=e.getComponentType(s.getNodeType(e)),o=e.getTypeFromLength(n.length,a),l=s.build(e,o),c=t.build(e,r),u=e.getTypeLength(r),h=[];for(let f=0;f<u;f++){const m=ep[f];m===n[0]?(h.push(l),f+=n.length-1):h.push(c+"."+m)}return`${e.getType(r)}( ${h.join(", ")} )`}}class Xse extends ti{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,s=this.getNodeType(e),r=n.build(e),a=e.getVarFromNode(this),o=e.getPropertyName(a);e.addLineFlowCode(o+" = "+r,this);const l=e.getTypeLength(s),c=[];let u=0;for(let h=0;h<l;h++){const f=ep[h];f===t[u]?(c.push("1.0 - "+(o+"."+f)),u++):c.push(o+"."+f)}return`${e.getType(s)}( ${c.join(", ")} )`}}class sI extends Gt{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?fh(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=fh(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=$U(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?CC(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){Se("Abstract function.")}}const bV=/float|u?int/;class ol extends sI{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return bV.test(n)&&bV.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}}class UW extends Gt{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){Se(`TSL: Member "${this.property}" does not exist in struct.`);const n=this.getNodeType(e);return e.generateConst(n)}return this.structNode.build(e)+"."+this.property}}let Hf=null;const UD=new Map;function Ue(i,e){if(UD.has(i)){Se(`TSL: Redefinition of method chaining '${i}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${i} is not a function`);UD.set(i,e),i!=="assign"&&(Gt.prototype[i]=function(...t){return this.isStackNode?this.addToStack(e(...t)):e(this,...t)},Gt.prototype[i+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const qse=i=>i.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),SV=i=>qse(i).split("").sort().join("");Gt.prototype.assign=function(...i){if(this.isStackNode!==!0)return Hf!==null?Hf.assign(this,...i):De("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const e=UD.get("assign");return this.addToStack(e(...i))}};Gt.prototype.toVarIntent=function(){return this};Gt.prototype.get=function(i){return new UW(this,i)};const Gv={};function K1(i,e,t){Gv[i]=Gv[e]=Gv[t]={get(){this._cache=this._cache||{};let a=this._cache[i];return a===void 0&&(a=new iI(this,i),this._cache[i]=a),a},set(a){this[i].assign(St(a))}};const n=i.toUpperCase(),s=e.toUpperCase(),r=t.toUpperCase();Gt.prototype["set"+n]=Gt.prototype["set"+s]=Gt.prototype["set"+r]=function(a){const o=SV(i);return new LW(this,o,St(a))},Gt.prototype["flip"+n]=Gt.prototype["flip"+s]=Gt.prototype["flip"+r]=function(){const a=SV(i);return new Xse(this,a)}}const Ic=["x","y","z","w"],Pc=["r","g","b","a"],Oc=["s","t","p","q"];for(let i=0;i<4;i++){let e=Ic[i],t=Pc[i],n=Oc[i];K1(e,t,n);for(let s=0;s<4;s++){e=Ic[i]+Ic[s],t=Pc[i]+Pc[s],n=Oc[i]+Oc[s],K1(e,t,n);for(let r=0;r<4;r++){e=Ic[i]+Ic[s]+Ic[r],t=Pc[i]+Pc[s]+Pc[r],n=Oc[i]+Oc[s]+Oc[r],K1(e,t,n);for(let a=0;a<4;a++)e=Ic[i]+Ic[s]+Ic[r]+Ic[a],t=Pc[i]+Pc[s]+Pc[r]+Pc[a],n=Oc[i]+Oc[s]+Oc[r]+Oc[a],K1(e,t,n)}}}for(let i=0;i<32;i++)Gv[i]={get(){this._cache=this._cache||{};let e=this._cache[i];return e===void 0&&(e=new tp(this,new ol(i,"uint")),this._cache[i]=e),e},set(e){this[i].assign(St(e))}};Object.defineProperties(Gt.prototype,Gv);const TV=new WeakMap,jse=function(i,e=null){const t=fh(i);return t==="node"?i:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?St(ID(i,e)):t==="shader"?i.isFn?i:le(i):i},Yse=function(i,e=null){for(const t in i)i[t]=St(i[t],e);return i},Kse=function(i,e=null){const t=i.length;for(let n=0;n<t;n++)i[n]=St(i[n],e);return i},IW=function(i,e=null,t=null,n=null){function s(u){return n!==null?(u=St(Object.assign(u,n)),n.intent===!0&&(u=u.toVarIntent())):u=St(u),u}let r,a=e,o,l;function c(u){let h;return a?h=/[a-z]/i.test(a)?a+"()":a:h=i.type,o!==void 0&&u.length<o?(De(`TSL: "${h}" parameter length is less than minimum required.`),u.concat(new Array(o-u.length).fill(0))):l!==void 0&&u.length>l?(De(`TSL: "${h}" parameter length exceeds limit.`),u.slice(0,l)):u}return e===null?r=(...u)=>s(new i(...Mm(c(u)))):t!==null?(t=St(t),r=(...u)=>s(new i(e,...Mm(c(u)),t))):r=(...u)=>s(new i(e,...Mm(c(u)))),r.setParameterLength=(...u)=>(u.length===1?o=l=u[0]:u.length===2&&([o,l]=u),r),r.setName=u=>(a=u,r),r},Zse=function(i,...e){return new i(...Mm(e))};class Jse extends Gt{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:n}=this,s=e.getNodeProperties(t),r=e.getClosestSubBuild(t.subBuilds)||"",a=r||"default";if(s[a])return s[a];const o=e.subBuildFn,l=e.fnCall;e.subBuildFn=r,e.fnCall=this;let c=null;if(t.layout){let u=TV.get(e.constructor);u===void 0&&(u=new WeakMap,TV.set(e.constructor,u));let h=u.get(t);h===void 0&&(h=St(e.buildFunctionNode(t)),u.set(t,h)),e.addInclude(h);const f=n?Qse(n):null;c=St(h.call(f))}else{const u=new Proxy(e,{get:(x,v,y)=>{let b;return Symbol.iterator===v?b=function*(){yield void 0}:b=Reflect.get(x,v,y),b}}),h=n?$se(n):null,f=Array.isArray(n)?n.length>0:n!==null,m=t.jsFunc,g=f||m.length>1?m(h,u):m(u);c=St(g)}return e.subBuildFn=o,e.fnCall=l,t.once&&(s[a]=c),c}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),n=e.getSubBuildOutput(this);return t[n]=t[n]||this.setupOutput(e),t[n].subBuild=e.getClosestSubBuild(this),t[n]}build(e,t=null){let n=null;const s=e.getBuildStage(),r=e.getNodeProperties(this),a=e.getSubBuildOutput(this),o=this.getOutputNode(e),l=e.fnCall;if(e.fnCall=this,s==="setup"){const c=e.getSubBuildProperty("initialized",this);if(r[c]!==!0&&(r[c]=!0,r[a]=this.getOutputNode(e),r[a].build(e),this.shaderNode.subBuilds))for(const u of e.chaining){const h=e.getDataFromNode(u,"any");h.subBuilds=h.subBuilds||new Set;for(const f of this.shaderNode.subBuilds)h.subBuilds.add(f)}n=r[a]}else s==="analyze"?o.build(e,t):s==="generate"&&(n=o.build(e,t)||"");return e.fnCall=l,n}}function Qse(i){let e;return NC(i),i[0]&&(i[0].isNode||Object.getPrototypeOf(i[0])!==Object.prototype)?e=[...i]:e=i[0],e}function $se(i){let e=0;return NC(i),new Proxy(i,{get:(t,n,s)=>{let r;if(n==="length")return r=i.length,r;if(Symbol.iterator===n)r=function*(){for(const a of i)yield St(a)};else{if(i.length>0)if(Object.getPrototypeOf(i[0])===Object.prototype){const a=i[0];a[n]===void 0?r=a[e++]:r=Reflect.get(a,n,s)}else i[0]instanceof Gt&&(i[n]===void 0?r=i[e++]:r=Reflect.get(i,n,s));else r=Reflect.get(t,n,s);r=St(r)}return r}})}class ere extends Gt{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new Jse(this,e)}setup(){return this.call()}}const tre=[!1,!0],nre=[0,1,2,3],ire=[-1,-2],PW=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],rI=new Map;for(const i of tre)rI.set(i,new ol(i));const aI=new Map;for(const i of nre)aI.set(i,new ol(i,"uint"));const oI=new Map([...aI].map(i=>new ol(i.value,"int")));for(const i of ire)oI.set(i,new ol(i,"int"));const wC=new Map([...oI].map(i=>new ol(i.value)));for(const i of PW)wC.set(i,new ol(i));for(const i of PW)wC.set(-i,new ol(-i));const RC={bool:rI,uint:aI,ints:oI,float:wC},AV=new Map([...rI,...wC]),ID=(i,e)=>AV.has(i)?AV.get(i):i.isNode===!0?i:new ol(i,e),nr=function(i,e=null){return(...t)=>{for(const s of t)if(s===void 0)return De(`TSL: Invalid parameter for the type "${i}".`),new ol(0,i);if((t.length===0||!["bool","float","int","uint"].includes(i)&&t.every(s=>{const r=typeof s;return r!=="object"&&r!=="function"}))&&(t=[CC(i,...t)]),t.length===1&&e!==null&&e.has(t[0]))return dv(e.get(t[0]));if(t.length===1){const s=ID(t[0],i);return s.nodeType===i?dv(s):dv(new nI(s,i))}const n=t.map(s=>ID(s));return dv(new DW(n,i))}},Rb=i=>typeof i=="object"&&i!==null?i.value:i,OW=i=>i!=null?i.nodeType||i.convertTo||(typeof i=="string"?i:null):null;function sy(i,e){return new ere(i,e)}const St=(i,e=null)=>jse(i,e),dv=(i,e=null)=>St(i,e).toVarIntent(),NC=(i,e=null)=>new Yse(i,e),Mm=(i,e=null)=>new Kse(i,e),fn=(i,e=null,t=null,n=null)=>new IW(i,e,t,n),_t=(i,...e)=>new Zse(i,...e),ot=(i,e=null,t=null,n={})=>new IW(i,e,t,{...n,intent:!0});let sre=0;class rre extends Gt{constructor(e,t=null){super();let n=null;t!==null&&(typeof t=="object"?n=t.return:(typeof t=="string"?n=t:De("TSL: Invalid layout type."),t=null)),this.shaderNode=new sy(e,n),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const n={name:"fn"+sre++,type:t,inputs:[]};for(const s in e)s!=="return"&&n.inputs.push({name:s,type:e[s]});e=n}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return De('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),e.generateConst(t)}}function le(i,e=null){const t=new rre(i,e);return new Proxy(()=>{},{apply(n,s,r){return t.call(...r)},get(n,s,r){return Reflect.get(t,s,r)},set(n,s,r,a){return Reflect.set(t,s,r,a)}})}const Nb=i=>{Hf=i},lI=()=>Hf,Wt=(...i)=>Hf.If(...i),are=(...i)=>Hf.Switch(...i);function BC(i){return Hf&&Hf.addToStack(i),i}Ue("toStack",BC);const FW=new nr("color"),W=new nr("float",RC.float),te=new nr("int",RC.ints),Ze=new nr("uint",RC.uint),jl=new nr("bool",RC.bool),$e=new nr("vec2"),js=new nr("ivec2"),cI=new nr("uvec2"),GW=new nr("bvec2"),se=new nr("vec3"),uI=new nr("ivec3"),Cg=new nr("uvec3"),hI=new nr("bvec3"),It=new nr("vec4"),dI=new nr("ivec4"),fI=new nr("uvec4"),zW=new nr("bvec4"),DC=new nr("mat2"),Qr=new nr("mat3"),rf=new nr("mat4"),ore=(i="")=>new ol(i,"string"),lre=i=>new ol(i,"ArrayBuffer");Ue("toColor",FW);Ue("toFloat",W);Ue("toInt",te);Ue("toUint",Ze);Ue("toBool",jl);Ue("toVec2",$e);Ue("toIVec2",js);Ue("toUVec2",cI);Ue("toBVec2",GW);Ue("toVec3",se);Ue("toIVec3",uI);Ue("toUVec3",Cg);Ue("toBVec3",hI);Ue("toVec4",It);Ue("toIVec4",dI);Ue("toUVec4",fI);Ue("toBVec4",zW);Ue("toMat2",DC);Ue("toMat3",Qr);Ue("toMat4",rf);const VW=fn(tp).setParameterLength(2),HW=(i,e)=>St(new nI(St(i),e)),cre=(i,e)=>St(new iI(St(i),e));Ue("element",VW);Ue("convert",HW);const ure=i=>(Se("TSL: append() has been renamed to Stack()."),BC(i));Ue("append",i=>(Se("TSL: .append() has been renamed to .toStack()."),BC(i)));class ni extends Gt{static get type(){return"PropertyNode"}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return Px(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const xc=(i,e)=>new ni(i,e),Po=(i,e)=>new ni(i,e,!0),pi=_t(ni,"vec4","DiffuseColor"),nm=_t(ni,"vec3","DiffuseContribution"),PD=_t(ni,"vec3","EmissiveColor"),Wc=_t(ni,"float","Roughness"),ph=_t(ni,"float","Metalness"),FM=_t(ni,"float","Clearcoat"),Bb=_t(ni,"float","ClearcoatRoughness"),Uo=_t(ni,"vec3","Sheen"),Nd=_t(ni,"float","SheenRoughness"),LC=_t(ni,"float","Iridescence"),GM=_t(ni,"float","IridescenceIOR"),zM=_t(ni,"float","IridescenceThickness"),VM=_t(ni,"float","AlphaT"),Md=_t(ni,"float","Anisotropy"),zv=_t(ni,"vec3","AnisotropyT"),Em=_t(ni,"vec3","AnisotropyB"),kf=_t(ni,"color","SpecularColor"),cm=_t(ni,"color","SpecularColorBlended"),vy=_t(ni,"float","SpecularF90"),HM=_t(ni,"float","Shininess"),by=_t(ni,"vec4","Output"),Cm=_t(ni,"float","dashSize"),Db=_t(ni,"float","gapSize"),hre=_t(ni,"float","pointWidth"),Vv=_t(ni,"float","IOR"),kM=_t(ni,"float","Transmission"),pI=_t(ni,"float","Thickness"),mI=_t(ni,"float","AttenuationDistance"),gI=_t(ni,"color","AttenuationColor"),yI=_t(ni,"float","Dispersion");class xI extends Gt{static get type(){return"UniformGroupNode"}constructor(e,t=!1,n=1){super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const kW=i=>new xI(i),UC=(i,e=0)=>new xI(i,!0,e),WW=UC("frame"),Kt=UC("render"),_I=kW("object");class Ox extends sI{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=_I}setName(e){return this.name=e,this}label(e){return Se('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(n=>{const s=e(n,this);s!==void 0&&(this.value=s)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const n=this.getNodeType(e),s=this.getUniformHash(e);let r=e.getNodeFromHash(s);r===void 0&&(e.setHashNode(this,s),r=this);const a=r.getInputType(e),o=e.getUniformFromNode(r,a,e.shaderStage,this.name||e.context.nodeName),l=e.getPropertyName(o);e.context.nodeName!==void 0&&delete e.context.nodeName;let c=l;if(n==="bool"){const u=e.getDataFromNode(this);let h=u.propertyName;if(h===void 0){const f=e.getVarFromNode(this,null,"bool");h=e.getPropertyName(f),u.propertyName=h,c=e.format(l,a,n),e.addLineFlowCode(`${h} = ${c}`,this)}c=h}return e.format(c,n,t)}}const Yt=(i,e)=>{const t=OW(e||i);if(t===i&&(i=CC(t)),i&&i.isNode===!0){let n=i.value;i.traverse(s=>{s.isConstNode===!0&&(n=s.value)}),i=n}return new Ox(i,t)};class OD extends ti{static get type(){return"ArrayNode"}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null?this.values[0].getNodeType(e):this.nodeType}getElementType(e){return this.getNodeType(e)}getMemberType(e,t){return this.nodeType===null?this.values[0].getMemberType(e,t):super.getMemberType(e,t)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const XW=(...i)=>{let e;if(i.length===1){const t=i[0];e=new OD(null,t.length,t)}else{const t=i[0],n=i[1];e=new OD(t,n)}return St(e)};Ue("toArray",(i,e)=>XW(Array(e).fill(i)));class qW extends ti{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return ep.join("").slice(0,n)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:n}=this,s=t.getScope(),r=e.getDataFromNode(s);r.assign=!0;const a=e.getNodeProperties(this);a.sourceNode=n,a.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:n,sourceNode:s}=e.getNodeProperties(this),r=this.needsSplitAssign(e),a=n.build(e),o=n.getNodeType(e),l=s.build(e,o),c=s.getNodeType(e),u=e.getDataFromNode(this);let h;if(u.initialized===!0)t!=="void"&&(h=a);else if(r){const f=e.getVarFromNode(this,null,o),m=e.getPropertyName(f);e.addLineFlowCode(`${m} = ${l}`,this);const g=n.node,v=g.node.context({assign:!0}).build(e);for(let y=0;y<g.components.length;y++){const b=g.components[y];e.addLineFlowCode(`${v}.${b} = ${m}[ ${y} ]`,this)}t!=="void"&&(h=a)}else h=`${a} = ${l}`,(t==="void"||c==="void")&&(e.addLineFlowCode(h,this),t!=="void"&&(h=a));return u.initialized=!0,e.format(h,o,t)}}const jW=fn(qW).setParameterLength(2);Ue("assign",jW);class YW extends ti{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],n=this.functionNode,s=n.getInputs(e),r=this.parameters,a=(l,c)=>{const u=c.type,h=u==="pointer";let f;return h?f="&"+l.build(e):f=l.build(e,u),f};if(Array.isArray(r)){if(r.length>s.length)De("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),r.length=s.length;else if(r.length<s.length)for(De("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");r.length<s.length;)r.push(W(0));for(let l=0;l<r.length;l++)t.push(a(r[l],s[l]))}else for(const l of s){const c=r[l.name];c!==void 0?t.push(a(c,l)):(De(`TSL: Input '${l.name}' not found in 'Fn()'.`),t.push(a(W(0),l)))}return`${n.build(e,"property")}( ${t.join(", ")} )`}}const KW=(i,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Mm(e):NC(e[0]),new YW(St(i),e));Ue("call",KW);const dre={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class os extends ti{static get type(){return"OperatorNode"}constructor(e,t,n,...s){if(super(),s.length>0){let r=new os(e,t,n);for(let a=0;a<s.length-1;a++)r=new os(e,r,s[a]);t=r,n=s[s.length-1]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(dre[this.op],t)}getNodeType(e,t=null){const n=this.op,s=this.aNode,r=this.bNode,a=s.getNodeType(e),o=r?r.getNodeType(e):null;if(a==="void"||o==="void")return t||"void";if(n==="%")return a;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return e.getIntegerType(a);if(n==="!"||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">="){const l=Math.max(e.getTypeLength(a),e.getTypeLength(o));return l>1?`bvec${l}`:"bool"}else{if(e.isMatrix(a)){if(o==="float")return a;if(e.isVector(o))return e.getVectorFromMatrix(a);if(e.isMatrix(o))return a}else if(e.isMatrix(o)){if(a==="float")return o;if(e.isVector(a))return e.getVectorFromMatrix(o)}return e.getTypeLength(o)>e.getTypeLength(a)?o:a}}generate(e,t){const n=this.op,{aNode:s,bNode:r}=this,a=this.getNodeType(e,t);let o=null,l=null;a!=="void"?(o=s.getNodeType(e),l=r?r.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="||n==="!="?e.isVector(o)?l=o:e.isVector(l)?o=l:o!==l&&(o=l="float"):n===">>"||n==="<<"?(o=a,l=e.changeComponentType(l,"uint")):n==="%"?(o=a,l=e.isInteger(o)&&e.isInteger(l)?l:o):e.isMatrix(o)?l==="float"?l="float":e.isVector(l)?l=e.getVectorFromMatrix(o):e.isMatrix(l)||(o=l=a):e.isMatrix(l)?o==="float"?o="float":e.isVector(o)?o=e.getVectorFromMatrix(l):o=l=a:o=l=a):o=l=a;const c=s.build(e,o),u=r?r.build(e,l):null,h=e.getFunctionOperator(n);if(t!=="void"){const f=e.renderer.coordinateSystem===Cr;if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">=")return f?e.isVector(o)?e.format(`${this.getOperatorMethod(e,t)}( ${c}, ${u} )`,a,t):e.format(`( ${c} ${n} ${u} )`,a,t):e.format(`( ${c} ${n} ${u} )`,a,t);if(n==="%")return e.isInteger(l)?e.format(`( ${c} % ${u} )`,a,t):e.format(`${this.getOperatorMethod(e,a)}( ${c}, ${u} )`,a,t);if(n==="!"||n==="~")return e.format(`(${n}${c})`,o,t);if(h)return e.format(`${h}( ${c}, ${u} )`,a,t);if(e.isMatrix(o)&&l==="float")return e.format(`( ${u} ${n} ${c} )`,a,t);if(o==="float"&&e.isMatrix(l))return e.format(`${c} ${n} ${u}`,a,t);{let m=`( ${c} ${n} ${u} )`;return!f&&a==="bool"&&e.isVector(o)&&e.isVector(l)&&(m=`all${m}`),e.format(m,a,t)}}else if(o!=="void")return h?e.format(`${h}( ${c}, ${u} )`,a,t):e.isMatrix(o)&&l==="float"?e.format(`${u} ${n} ${c}`,a,t):e.format(`${c} ${n} ${u}`,a,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const zs=ot(os,"+").setParameterLength(2,1/0).setName("add"),On=ot(os,"-").setParameterLength(2,1/0).setName("sub"),dn=ot(os,"*").setParameterLength(2,1/0).setName("mul"),tl=ot(os,"/").setParameterLength(2,1/0).setName("div"),QS=ot(os,"%").setParameterLength(2).setName("mod"),vI=ot(os,"==").setParameterLength(2).setName("equal"),ZW=ot(os,"!=").setParameterLength(2).setName("notEqual"),JW=ot(os,"<").setParameterLength(2).setName("lessThan"),bI=ot(os,">").setParameterLength(2).setName("greaterThan"),QW=ot(os,"<=").setParameterLength(2).setName("lessThanEqual"),$W=ot(os,">=").setParameterLength(2).setName("greaterThanEqual"),e7=ot(os,"&&").setParameterLength(2,1/0).setName("and"),t7=ot(os,"||").setParameterLength(2,1/0).setName("or"),n7=ot(os,"!").setParameterLength(1).setName("not"),i7=ot(os,"^^").setParameterLength(2).setName("xor"),s7=ot(os,"&").setParameterLength(2).setName("bitAnd"),r7=ot(os,"~").setParameterLength(1).setName("bitNot"),a7=ot(os,"|").setParameterLength(2).setName("bitOr"),o7=ot(os,"^").setParameterLength(2).setName("bitXor"),l7=ot(os,"<<").setParameterLength(2).setName("shiftLeft"),c7=ot(os,">>").setParameterLength(2).setName("shiftRight"),u7=le(([i])=>(i.addAssign(1),i)),h7=le(([i])=>(i.subAssign(1),i)),d7=le(([i])=>{const e=te(i).toConst();return i.addAssign(1),e}),f7=le(([i])=>{const e=te(i).toConst();return i.subAssign(1),e});Ue("add",zs);Ue("sub",On);Ue("mul",dn);Ue("div",tl);Ue("mod",QS);Ue("equal",vI);Ue("notEqual",ZW);Ue("lessThan",JW);Ue("greaterThan",bI);Ue("lessThanEqual",QW);Ue("greaterThanEqual",$W);Ue("and",e7);Ue("or",t7);Ue("not",n7);Ue("xor",i7);Ue("bitAnd",s7);Ue("bitNot",r7);Ue("bitOr",a7);Ue("bitXor",o7);Ue("shiftLeft",l7);Ue("shiftRight",c7);Ue("incrementBefore",u7);Ue("decrementBefore",h7);Ue("increment",d7);Ue("decrement",f7);const p7=(i,e)=>(Se('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),QS(te(i),te(e)));Ue("modInt",p7);class xe extends ti{static get type(){return"MathNode"}constructor(e,t,n=null,s=null){if(super(),(e===xe.MAX||e===xe.MIN)&&arguments.length>3){let r=new xe(e,t,n);for(let a=2;a<arguments.length-1;a++)r=new xe(e,r,arguments[a]);t=r,n=arguments[arguments.length-1],s=null}this.method=e,this.aNode=t,this.bNode=n,this.cNode=s,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,s=this.cNode?this.cNode.getNodeType(e):null,r=e.isMatrix(t)?0:e.getTypeLength(t),a=e.isMatrix(n)?0:e.getTypeLength(n),o=e.isMatrix(s)?0:e.getTypeLength(s);return r>a&&r>o?t:a>o?n:o>r?s:t}getNodeType(e){const t=this.method;return t===xe.LENGTH||t===xe.DISTANCE||t===xe.DOT?"float":t===xe.CROSS?"vec3":t===xe.ALL||t===xe.ANY?"bool":t===xe.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:n,method:s}=this;let r=null;if(s===xe.ONE_MINUS)r=On(1,t);else if(s===xe.RECIPROCAL)r=tl(1,t);else if(s===xe.DIFFERENCE)r=Pi(On(t,n));else if(s===xe.TRANSFORM_DIRECTION){let a=t,o=n;e.isMatrix(a.getNodeType(e))?o=It(se(o),0):a=It(se(a),0);const l=dn(a,o).xyz;r=Ya(l)}return r!==null?r:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let s=this.method;const r=this.getNodeType(e),a=this.getInputType(e),o=this.aNode,l=this.bNode,c=this.cNode,u=e.renderer.coordinateSystem;if(s===xe.NEGATE)return e.format("( - "+o.build(e,a)+" )",r,t);{const h=[];return s===xe.CROSS?h.push(o.build(e,r),l.build(e,r)):u===Cr&&s===xe.STEP?h.push(o.build(e,e.getTypeLength(o.getNodeType(e))===1?"float":a),l.build(e,a)):u===Cr&&(s===xe.MIN||s===xe.MAX)?h.push(o.build(e,a),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":a)):s===xe.REFRACT?h.push(o.build(e,a),l.build(e,a),c.build(e,"float")):s===xe.MIX?h.push(o.build(e,a),l.build(e,a),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":a)):(u===Ka&&s===xe.ATAN&&l!==null&&(s="atan2"),e.shaderStage!=="fragment"&&(s===xe.DFDX||s===xe.DFDY)&&(Se(`TSL: '${s}' is not supported in the ${e.shaderStage} stage.`),s="/*"+s+"*/"),h.push(o.build(e,a)),l!==null&&h.push(l.build(e,a)),c!==null&&h.push(c.build(e,a))),e.format(`${e.getMethod(s,r)}( ${h.join(", ")} )`,r,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}xe.ALL="all";xe.ANY="any";xe.RADIANS="radians";xe.DEGREES="degrees";xe.EXP="exp";xe.EXP2="exp2";xe.LOG="log";xe.LOG2="log2";xe.SQRT="sqrt";xe.INVERSE_SQRT="inversesqrt";xe.FLOOR="floor";xe.CEIL="ceil";xe.NORMALIZE="normalize";xe.FRACT="fract";xe.SIN="sin";xe.COS="cos";xe.TAN="tan";xe.ASIN="asin";xe.ACOS="acos";xe.ATAN="atan";xe.ABS="abs";xe.SIGN="sign";xe.LENGTH="length";xe.NEGATE="negate";xe.ONE_MINUS="oneMinus";xe.DFDX="dFdx";xe.DFDY="dFdy";xe.ROUND="round";xe.RECIPROCAL="reciprocal";xe.TRUNC="trunc";xe.FWIDTH="fwidth";xe.TRANSPOSE="transpose";xe.DETERMINANT="determinant";xe.INVERSE="inverse";xe.EQUALS="equals";xe.MIN="min";xe.MAX="max";xe.STEP="step";xe.REFLECT="reflect";xe.DISTANCE="distance";xe.DIFFERENCE="difference";xe.DOT="dot";xe.CROSS="cross";xe.POW="pow";xe.TRANSFORM_DIRECTION="transformDirection";xe.MIX="mix";xe.CLAMP="clamp";xe.REFRACT="refract";xe.SMOOTHSTEP="smoothstep";xe.FACEFORWARD="faceforward";const SI=W(1e-6),fre=W(1e6),WM=W(Math.PI),pre=W(Math.PI*2),mre=W(Math.PI*2),gre=W(Math.PI*.5),m7=ot(xe,xe.ALL).setParameterLength(1),g7=ot(xe,xe.ANY).setParameterLength(1),y7=ot(xe,xe.RADIANS).setParameterLength(1),x7=ot(xe,xe.DEGREES).setParameterLength(1),TI=ot(xe,xe.EXP).setParameterLength(1),Ky=ot(xe,xe.EXP2).setParameterLength(1),IC=ot(xe,xe.LOG).setParameterLength(1),ru=ot(xe,xe.LOG2).setParameterLength(1),ya=ot(xe,xe.SQRT).setParameterLength(1),AI=ot(xe,xe.INVERSE_SQRT).setParameterLength(1),au=ot(xe,xe.FLOOR).setParameterLength(1),PC=ot(xe,xe.CEIL).setParameterLength(1),Ya=ot(xe,xe.NORMALIZE).setParameterLength(1),bc=ot(xe,xe.FRACT).setParameterLength(1),La=ot(xe,xe.SIN).setParameterLength(1),fc=ot(xe,xe.COS).setParameterLength(1),_7=ot(xe,xe.TAN).setParameterLength(1),v7=ot(xe,xe.ASIN).setParameterLength(1),MI=ot(xe,xe.ACOS).setParameterLength(1),OC=ot(xe,xe.ATAN).setParameterLength(1,2),Pi=ot(xe,xe.ABS).setParameterLength(1),EI=ot(xe,xe.SIGN).setParameterLength(1),ou=ot(xe,xe.LENGTH).setParameterLength(1),CI=ot(xe,xe.NEGATE).setParameterLength(1),b7=ot(xe,xe.ONE_MINUS).setParameterLength(1),wI=ot(xe,xe.DFDX).setParameterLength(1),RI=ot(xe,xe.DFDY).setParameterLength(1),S7=ot(xe,xe.ROUND).setParameterLength(1),T7=ot(xe,xe.RECIPROCAL).setParameterLength(1),NI=ot(xe,xe.TRUNC).setParameterLength(1),BI=ot(xe,xe.FWIDTH).setParameterLength(1),A7=ot(xe,xe.TRANSPOSE).setParameterLength(1),M7=ot(xe,xe.DETERMINANT).setParameterLength(1),E7=ot(xe,xe.INVERSE).setParameterLength(1),C7=(i,e)=>(Se('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),vI(i,e)),fo=ot(xe,xe.MIN).setParameterLength(2,1/0),ls=ot(xe,xe.MAX).setParameterLength(2,1/0),FC=ot(xe,xe.STEP).setParameterLength(2),w7=ot(xe,xe.REFLECT).setParameterLength(2),R7=ot(xe,xe.DISTANCE).setParameterLength(2),N7=ot(xe,xe.DIFFERENCE).setParameterLength(2),Yl=ot(xe,xe.DOT).setParameterLength(2),Dh=ot(xe,xe.CROSS).setParameterLength(2),Il=ot(xe,xe.POW).setParameterLength(2),DI=i=>dn(i,i),B7=i=>dn(i,i,i),LI=i=>dn(i,i,i,i),D7=ot(xe,xe.TRANSFORM_DIRECTION).setParameterLength(2),L7=i=>dn(EI(i),Il(Pi(i),1/3)),UI=i=>Yl(i,i),wn=ot(xe,xe.MIX).setParameterLength(3),Sc=(i,e=0,t=1)=>St(new xe(xe.CLAMP,St(i),St(e),St(t))),GC=i=>Sc(i),II=ot(xe,xe.REFRACT).setParameterLength(3),nl=ot(xe,xe.SMOOTHSTEP).setParameterLength(3),PI=ot(xe,xe.FACEFORWARD).setParameterLength(3),U7=le(([i])=>{const n=43758.5453,s=Yl(i.xy,$e(12.9898,78.233)),r=QS(s,WM);return bc(La(r).mul(n))}),I7=(i,e,t)=>wn(e,t,i),P7=(i,e,t)=>nl(e,t,i),O7=(i,e)=>FC(e,i),F7=(i,e)=>(Se('TSL: "atan2" is overloaded. Use "atan" instead.'),OC(i,e)),yre=PI,xre=AI;Ue("all",m7);Ue("any",g7);Ue("equals",C7);Ue("radians",y7);Ue("degrees",x7);Ue("exp",TI);Ue("exp2",Ky);Ue("log",IC);Ue("log2",ru);Ue("sqrt",ya);Ue("inverseSqrt",AI);Ue("floor",au);Ue("ceil",PC);Ue("normalize",Ya);Ue("fract",bc);Ue("sin",La);Ue("cos",fc);Ue("tan",_7);Ue("asin",v7);Ue("acos",MI);Ue("atan",OC);Ue("abs",Pi);Ue("sign",EI);Ue("length",ou);Ue("lengthSq",UI);Ue("negate",CI);Ue("oneMinus",b7);Ue("dFdx",wI);Ue("dFdy",RI);Ue("round",S7);Ue("reciprocal",T7);Ue("trunc",NI);Ue("fwidth",BI);Ue("atan2",F7);Ue("min",fo);Ue("max",ls);Ue("step",O7);Ue("reflect",w7);Ue("distance",R7);Ue("dot",Yl);Ue("cross",Dh);Ue("pow",Il);Ue("pow2",DI);Ue("pow3",B7);Ue("pow4",LI);Ue("transformDirection",D7);Ue("mix",I7);Ue("clamp",Sc);Ue("refract",II);Ue("smoothstep",P7);Ue("faceForward",PI);Ue("difference",N7);Ue("saturate",GC);Ue("cbrt",L7);Ue("transpose",A7);Ue("determinant",M7);Ue("inverse",E7);Ue("rand",U7);class _re extends Gt{static get type(){return"ConditionalNode"}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const s=t.getNodeType(e);if(n!==null){const r=n.getNodeType(e);if(e.getTypeLength(r)>e.getTypeLength(s))return r}return s}setup(e){const t=this.condNode,n=this.ifNode.isolate(),s=this.elseNode?this.elseNode.isolate():null,r=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=r,s!==null&&(e.getDataFromNode(s).parentNodeBlock=r);const a=e.context.uniformFlow,o=e.getNodeProperties(this);o.condNode=t,o.ifNode=a?n:n.context({nodeBlock:n}),o.elseNode=s?a?s:s.context({nodeBlock:s}):null}generate(e,t){const n=this.getNodeType(e),s=e.getDataFromNode(this);if(s.nodeProperty!==void 0)return s.nodeProperty;const{condNode:r,ifNode:a,elseNode:o}=e.getNodeProperties(this),l=e.currentFunctionNode,c=t!=="void",u=c?xc(n).build(e):"";s.nodeProperty=u;const h=r.build(e,"bool");if(e.context.uniformFlow&&o!==null){const g=a.build(e,n),x=o.build(e,n),v=e.getTernary(h,g,x);return e.format(v,n,t)}e.addFlowCode(`
${e.tab}if ( ${h} ) {

`).addFlowTab();let m=a.build(e,n);if(m&&(c?m=u+" = "+m+";":(m="return "+m+";",l===null&&(Se("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),m="// "+m))),e.removeFlowTab().addFlowCode(e.tab+"	"+m+`

`+e.tab+"}"),o!==null){e.addFlowCode(` else {

`).addFlowTab();let g=o.build(e,n);g&&(c?g=u+" = "+g+";":(g="return "+g+";",l===null&&(Se("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),g="// "+g))),e.removeFlowTab().addFlowCode(e.tab+"	"+g+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(u,n,t)}}const Xr=fn(_re).setParameterLength(2,3);Ue("select",Xr);class OI extends Gt{static get type(){return"ContextNode"}constructor(e=null,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getFlowContextData(){const e=[];return this.traverse(t=>{t.isContextNode===!0&&e.push(t.value)}),Object.assign({},...e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const n=e.addContext(this.value),s=this.node.build(e,t);return e.setContext(n),s}}const kh=(i=null,e={})=>{let t=i;return(t===null||t.isNode!==!0)&&(e=t||e,t=null),new OI(t,e)},G7=i=>kh(i,{uniformFlow:!0}),FI=(i,e)=>kh(i,{nodeName:e});function z7(i,e,t=null){return kh(t,{getShadow:({light:n,shadowColorNode:s})=>e===n?s.mul(i):s})}function V7(i,e=null){return kh(e,{getAO:(t,{material:n})=>n.transparent===!0?t:t!==null?t.mul(i):i})}function H7(i,e){return Se('TSL: "label()" has been deprecated. Use "setName()" instead.'),FI(i,e)}Ue("context",kh);Ue("label",H7);Ue("uniformFlow",G7);Ue("setName",FI);Ue("builtinShadowContext",(i,e,t)=>z7(e,t,i));Ue("builtinAOContext",(i,e)=>V7(e,i));class Hv extends Gt{static get type(){return"VarNode"}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}isIntent(e){return e.getDataFromNode(this).forceDeclaration===!0?!1:this.intent}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){return e.getDataFromNode(this).assign}build(...e){const t=e[0];if(this._hasStack(t)===!1&&t.buildStage==="setup"&&(t.context.nodeLoop||t.context.nodeBlock)){let n=!1;if(this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&t.fnCall&&t.fnCall.shaderNode&&t.getDataFromNode(this.node.shaderNode).hasLoop){const a=t.getDataFromNode(this);a.forceDeclaration=!0,n=!0}const s=t.getBaseStack();n?s.addToStackBefore(this):s.addToStack(this)}return this.isIntent(t)&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:n,readOnly:s}=this,{renderer:r}=e,a=r.backend.isWebGPUBackend===!0;let o=!1,l=!1;s&&(o=e.isDeterministic(t),l=a?s:o);const c=this.getNodeType(e);if(c=="void")return this.isIntent(e)!==!0&&De('TSL: ".toVar()" can not be used with void type.'),t.build(e);const u=e.getVectorType(c),h=t.build(e,u),f=e.getVarFromNode(this,n,u,void 0,l),m=e.getPropertyName(f);let g=m;if(l)if(a)g=o?`const ${m}`:`let ${m}`;else{const x=t.getArrayCount(e);g=`const ${e.getVar(f.type,m,x)}`}return e.addLineFlowCode(`${g} = ${h}`,this),m}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}}const GI=fn(Hv),k7=(i,e=null)=>GI(i,e).toStack(),W7=(i,e=null)=>GI(i,e,!0).toStack(),X7=i=>GI(i).setIntent(!0).toStack();Ue("toVar",k7);Ue("toConst",W7);Ue("toVarIntent",X7);class q7 extends Gt{static get type(){return"SubBuild"}constructor(e,t,n=null){super(n),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const n=this.node.build(e,...t);return e.removeSubBuild(),n}}const Sy=(i,e,t=null)=>St(new q7(St(i),e,t));class j7 extends Gt{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(n===void 0){const s=this.name,r=this.getNodeType(e),a=this.interpolationType,o=this.interpolationSampling;t.varying=n=e.getVaryingFromNode(this,s,r,a,o),t.node=Sy(this.node,"VERTEX")}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(iy.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(iy.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),n=e.getNodeProperties(this),s=this.setupVarying(e);if(n[t]===void 0){const r=this.getNodeType(e),a=e.getPropertyName(s,iy.VERTEX);e.flowNodeFromShaderStage(iy.VERTEX,n.node,r,a),n[t]=a}return e.getPropertyName(s)}}const Tu=fn(j7).setParameterLength(1,2),Y7=i=>Tu(i);Ue("toVarying",Tu);Ue("toVertexStage",Y7);Ue("varying",(...i)=>(Se("TSL: .varying() has been renamed to .toVarying()."),Tu(...i)));Ue("vertexStage",(...i)=>(Se("TSL: .vertexStage() has been renamed to .toVertexStage()."),Tu(...i)));const K7=le(([i])=>{const e=i.mul(.9478672986).add(.0521327014).pow(2.4),t=i.mul(.0773993808),n=i.lessThanEqual(.04045);return wn(e,t,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Z7=le(([i])=>{const e=i.pow(.41666).mul(1.055).sub(.055),t=i.mul(12.92),n=i.lessThanEqual(.0031308);return wn(e,t,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),zI="WorkingColorSpace",vre="OutputColorSpace";class zC extends ti{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===zI?en.workingColorSpace:t===vre?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),s=this.resolveColorSpace(e,this.target);let r=t;return en.enabled===!1||n===s||!n||!s||(en.getTransfer(n)===Ft&&(r=It(K7(r.rgb),r.a)),en.getPrimaries(n)!==en.getPrimaries(s)&&(r=It(Qr(en._getMatrix(new gn,n,s)).mul(r.rgb),r.a)),en.getTransfer(s)===Ft&&(r=It(Z7(r.rgb),r.a))),r}}const J7=(i,e)=>St(new zC(St(i),zI,e)),VC=(i,e)=>St(new zC(St(i),e,zI)),bre=(i,e,t)=>St(new zC(St(i),e,t));Ue("workingToColorSpace",J7);Ue("colorSpaceToWorking",VC);let Sre=class extends tp{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),s=this.getNodeType();return e.format(t,n,s)}};class Q7 extends Gt{static get type(){return"ReferenceBaseNode"}constructor(e,t,n=null,s=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=s,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=on.OBJECT}setGroup(e){return this.group=e,this}element(e){return new Sre(this,St(e))}setNodeType(e){const t=Yt(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let s=1;s<t.length;s++)n=n[t[s]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Tre=(i,e,t)=>new Q7(i,e,t);class $7 extends Q7{static get type(){return"RendererReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(Kt)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const eX=(i,e,t=null)=>new $7(i,e,t);class tX extends ti{static get type(){return"ToneMappingNode"}constructor(e,t=iX,n=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return _y(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,n=this._toneMapping;if(n===Ki)return t;let s=null;const r=e.renderer.library.getToneMappingFunction(n);return r!==null?s=It(r(t.rgb,this.exposureNode),t.a):(De("ToneMappingNode: Unsupported Tone Mapping configuration.",n),s=t),s}}const nX=(i,e,t)=>St(new tX(i,St(e),St(t))),iX=eX("toneMappingExposure","float");Ue("toneMapping",(i,e,t)=>nX(e,t,i));const MV=new WeakMap;function EV(i,e){let t=MV.get(i);return t===void 0&&(t=new vg(i,e),MV.set(i,t)),t}class qu extends sI{static get type(){return"BufferAttributeNode"}constructor(e,t=null,n=0,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=s,this.usage=Bh,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&e.itemSize<=4&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),n=e.getTypeLength(t),s=this.value,r=this.bufferStride||n,a=this.bufferOffset;let o;s.isInterleavedBuffer===!0?o=s:s.isBufferAttribute===!0?o=EV(s.array,r):o=EV(s,r);const l=new pu(o,n,a);o.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),s=e.getPropertyName(n);let r=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=s,r=s):r=Tu(this).build(e,t),r}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}function HC(i,e=null,t=0,n=0,s=Bh,r=!1){return e==="mat3"||e===null&&i.itemSize===9?Qr(new qu(i,"vec3",9,0).setUsage(s).setInstanced(r),new qu(i,"vec3",9,3).setUsage(s).setInstanced(r),new qu(i,"vec3",9,6).setUsage(s).setInstanced(r)):e==="mat4"||e===null&&i.itemSize===16?rf(new qu(i,"vec4",16,0).setUsage(s).setInstanced(r),new qu(i,"vec4",16,4).setUsage(s).setInstanced(r),new qu(i,"vec4",16,8).setUsage(s).setInstanced(r),new qu(i,"vec4",16,12).setUsage(s).setInstanced(r)):new qu(i,e,t,n)}const VI=(i,e=null,t=0,n=0)=>HC(i,e,t,n),Are=(i,e=null,t=0,n=0)=>HC(i,e,t,n,hh),XM=(i,e=null,t=0,n=0)=>HC(i,e,t,n,Bh,!0),FD=(i,e=null,t=0,n=0)=>HC(i,e,t,n,hh,!0);Ue("toAttribute",i=>VI(i.value));class sX extends Gt{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=on.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return Se('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const n=e.getNodeProperties(this);n.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:n}=e;if(n==="compute"){const s=this.computeNode.build(e,"void");s!==""&&e.addLineFlowCode(s,this)}else{const r=e.getNodeProperties(this).outputComputeNode;if(r)return r.build(e,t)}}}const HI=(i,e=[64])=>{(e.length===0||e.length>3)&&De("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let t=0;t<e.length;t++){const n=e[t];(typeof n!="number"||n<=0||!Number.isInteger(n))&&De(`TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`)}for(;e.length<3;)e.push(1);return St(new sX(St(i),e))},rX=(i,e,t)=>HI(i,t).setCount(e);Ue("compute",rX);Ue("computeKernel",HI);class aX extends Gt{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const s=this.node.getNodeType(e);return e.setCache(t),s}build(e,...t){const n=e.getCache(),s=e.getCacheFromNode(this,this.parent);e.setCache(s);const r=this.node.build(e,...t);return e.setCache(n),r}setParent(e){return this.parent=e,this}getParent(){return this.parent}}const Ty=i=>new aX(St(i));function oX(i,e=!0){return Se('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),Ty(i).setParent(e)}Ue("cache",oX);Ue("isolate",Ty);class lX extends Gt{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const cX=fn(lX).setParameterLength(2);Ue("bypass",cX);class kI extends Gt{static get type(){return"RemapNode"}constructor(e,t,n,s=W(0),r=W(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=s,this.outHighNode=r,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:s,outHighNode:r,doClamp:a}=this;let o=e.sub(t).div(n.sub(t));return a===!0&&(o=o.clamp()),o.mul(r.sub(s)).add(s)}}const uX=fn(kI,null,null,{doClamp:!1}).setParameterLength(3,5),hX=fn(kI).setParameterLength(3,5);Ue("remap",uX);Ue("remapClamp",hX);class kv extends Gt{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const n=this.getNodeType(e),s=this.snippet;if(n==="void")e.addLineFlowCode(s,this);else return e.format(s,n,t)}}const Lh=fn(kv).setParameterLength(1,2),dX=i=>(i?Xr(i,Lh("discard")):Lh("discard")).toStack(),Mre=()=>Lh("return").toStack();Ue("discard",dX);class fX extends ti{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const n=(this._toneMapping!==null?this._toneMapping:e.toneMapping)||Ki,s=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||ha;return n!==Ki&&(t=t.toneMapping(n)),s!==ha&&s!==en.workingColorSpace&&(t=t.workingToColorSpace(s)),t}}const WI=(i,e=null,t=null)=>St(new fX(St(i),e,t));Ue("renderOutput",WI);class pX extends ti{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,n=this.node.build(e),s="--- TSL debug - "+e.shaderStage+" shader ---",r="-".repeat(s.length);let a="";return a+="// #"+s+`#
`,a+=e.flow.code.replace(/^\t/mg,"")+`
`,a+="/* ... */ "+n+` /* ... */
`,a+="// #"+r+`#
`,t!==null?t(e,a):Jm(a),n}}const mX=(i,e=null)=>St(new pX(St(i),e)).toStack();Ue("debug",mX);class kC{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class Ere extends Gt{static get type(){return"InspectorNode"}constructor(e,t="",n=null){super(),this.node=e,this.name=t,this.callback=n,this.updateType=on.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==kC&&oi('TSL: ".toInspector()" is only available with WebGPU.'),t}}function gX(i,e="",t=null){return i=St(i),i.before(new Ere(i,e,t))}Ue("toInspector",gX);function Cre(i){Se("TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",i)}class XI extends Gt{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const s=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(s)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const r=e.geometry.getAttribute(t),a=e.getTypeFromAttribute(r),o=e.getAttribute(t,a);return e.shaderStage==="vertex"?e.format(o.name,a,n):Tu(this).build(e,n)}else return Se(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Ua=(i,e=null)=>new XI(i,e),yi=(i=0)=>Ua("uv"+(i>0?i:""),"vec2");class yX extends Gt{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),s=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${s} )`,this.getNodeType(e),t)}}const _h=fn(yX).setParameterLength(1,2);class xX extends Ox{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=on.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&n.width!==void 0){const{width:s,height:r}=n;this.value=Math.log2(Math.max(s,r))}}}const qI=fn(xX).setParameterLength(1),jI=new In;class Tc extends Ox{static get type(){return"TextureNode"}constructor(e=jI,t=null,n=null,s=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=s,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=on.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Jn?"uvec4":this.value.type===Is?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return yi(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Yt(this.value.matrix)),this._matrixUniform.mul(se(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=Yt(!1)),t=t.toVar(),this.sampler?t=this._flipYUniform.select(t.flipY(),t):t=this._flipYUniform.select(t.setY(te(_h(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");const s=le(()=>{let a=this.uvNode;return(a===null||e.context.forceUVContext===!0)&&e.context.getUV&&(a=e.context.getUV(this,e)),a||(a=this.getDefaultUV()),this.updateMatrix===!0&&(a=this.getTransformedUV(a)),a=this.setupUV(e,a),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?on.OBJECT:on.NONE,a})();let r=this.levelNode;r===null&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),t.uvNode=s,t.levelNode=r,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,n,s,r,a,o,l,c){const u=this.value;let h;return r?h=e.generateTextureBias(u,t,n,r,a,c):l?h=e.generateTextureGrad(u,t,n,l,a,c):o?h=e.generateTextureCompare(u,t,n,o,a,c):this.sampler===!1?h=e.generateTextureLoad(u,t,n,s,a,c):s?h=e.generateTextureLevel(u,t,n,s,a,c):h=e.generateTexture(u,t,n,a,c),h}generate(e,t){const n=this.value,s=e.getNodeProperties(this),r=super.generate(e,"property");if(/^sampler/.test(t))return r+"_sampler";if(e.isReference(t))return r;{const a=e.getDataFromNode(this);let o=a.propertyName;if(o===void 0){const{uvNode:u,levelNode:h,biasNode:f,compareNode:m,depthNode:g,gradNode:x,offsetNode:v}=s,y=this.generateUV(e,u),b=h?h.build(e,"float"):null,S=f?f.build(e,"float"):null,T=g?g.build(e,"int"):null,M=m?m.build(e,"float"):null,C=x?[x[0].build(e,"vec2"),x[1].build(e,"vec2")]:null,w=v?this.generateOffset(e,v):null,N=e.getVarFromNode(this);o=e.getPropertyName(N);const E=this.generateSnippet(e,r,y,b,S,T,M,C,w);e.addLineFlowCode(`${o} = ${E}`,this),a.snippet=E,a.propertyName=o}let l=o;const c=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(l=VC(Lh(l,c),n.colorSpace).setup(e).build(e,c)),e.format(l,c,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return Se("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=St(e),t.referenceNode=this.getBase(),St(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=St(e).mul(qI(t)),t.referenceNode=this.getBase();const n=t.value;return t.generateMipmaps===!1&&(n&&n.generateMipmaps===!1||n.minFilter===$n||n.magFilter===$n)&&(Se("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),St(t)}level(e){const t=this.clone();return t.levelNode=St(e),t.referenceNode=this.getBase(),St(t)}size(e){return _h(this,e)}bias(e){const t=this.clone();return t.biasNode=St(e),t.referenceNode=this.getBase(),St(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=St(e),t.referenceNode=this.getBase(),St(t)}grad(e,t){const n=this.clone();return n.gradNode=[St(e),St(t)],n.referenceNode=this.getBase(),St(n)}depth(e){const t=this.clone();return t.depthNode=St(e),t.referenceNode=this.getBase(),St(t)}offset(e){const t=this.clone();return t.offsetNode=St(e),t.referenceNode=this.getBase(),St(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();const n=this._flipYUniform;n!==null&&(n.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}const wre=fn(Tc).setParameterLength(1,4).setName("texture"),jn=(i=jI,e=null,t=null,n=null)=>{let s;return i&&i.isTextureNode===!0?(s=St(i.clone()),s.referenceNode=i.getBase(),e!==null&&(s.uvNode=St(e)),t!==null&&(s.levelNode=St(t)),n!==null&&(s.biasNode=St(n))):s=wre(i,e,t,n),s},Rre=(i=jI)=>jn(i),hs=(...i)=>jn(...i).setSampler(!1),Nre=(i,e,t)=>jn(i,e).level(t),Bre=i=>(i.isNode===!0?i:jn(i)).convert("sampler"),Dre=i=>(i.isNode===!0?i:jn(i)).convert("samplerComparison");class WC extends Ox{static get type(){return"BufferNode"}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n,this.updateRanges=[]}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const $S=(i,e,t)=>new WC(i,e,t);class Lre extends tp{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),s=this.node.getPaddedType();return e.format(t,s,n)}}class _X extends WC{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?fh(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=on.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let s=0;s<e.length;s++){const r=s*4;t[r]=e[s]}else if(n==="color")for(let s=0;s<e.length;s++){const r=s*4,a=e[s];t[r]=a.r,t[r+1]=a.g,t[r+2]=a.b||0}else if(n==="mat2")for(let s=0;s<e.length;s++){const r=s*4,a=e[s];t[r]=a.elements[0],t[r+1]=a.elements[1],t[r+2]=a.elements[2],t[r+3]=a.elements[3]}else if(n==="mat3")for(let s=0;s<e.length;s++){const r=s*16,a=e[s];t[r]=a.elements[0],t[r+1]=a.elements[1],t[r+2]=a.elements[2],t[r+4]=a.elements[3],t[r+5]=a.elements[4],t[r+6]=a.elements[5],t[r+8]=a.elements[6],t[r+9]=a.elements[7],t[r+10]=a.elements[8],t[r+15]=1}else if(n==="mat4")for(let s=0;s<e.length;s++){const r=s*16,a=e[s];for(let o=0;o<a.elements.length;o++)t[r+o]=a.elements[o]}else for(let s=0;s<e.length;s++){const r=s*4,a=e[s];t[r]=a.x,t[r+1]=a.y,t[r+2]=a.z||0,t[r+3]=a.w||0}}setup(e){const t=this.array.length,n=this.elementType;let s=Float32Array;const r=this.paddedType,a=e.getTypeLength(r);return n.charAt(0)==="i"&&(s=Int32Array),n.charAt(0)==="u"&&(s=Uint32Array),this.value=new s(t*a),this.bufferCount=t,this.bufferType=r,super.setup(e)}element(e){return new Lre(this,St(e))}}const da=(i,e)=>new _X(i,e);class Ure extends Gt{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const Wh=fn(Ure).setParameterLength(1);let I_,P_;class Li extends Gt{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===Li.DPR?"float":this.scope===Li.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=on.NONE;return(this.scope===Li.SIZE||this.scope===Li.VIEWPORT||this.scope===Li.DPR)&&(e=on.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===Li.VIEWPORT?t!==null?P_.copy(t.viewport):(e.getViewport(P_),P_.multiplyScalar(e.getPixelRatio())):this.scope===Li.DPR?this._output.value=e.getPixelRatio():t!==null?(I_.width=t.width,I_.height=t.height):e.getDrawingBufferSize(I_)}setup(){const e=this.scope;let t=null;return e===Li.SIZE?t=Yt(I_||(I_=new Ae)):e===Li.VIEWPORT?t=Yt(P_||(P_=new un)):e===Li.DPR?t=Yt(1):t=$e(wg.div(ig)),this._output=t,t}generate(e){if(this.scope===Li.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(ig).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}}Li.COORDINATE="coordinate";Li.VIEWPORT="viewport";Li.SIZE="size";Li.UV="uv";Li.DPR="dpr";const YI=_t(Li,Li.DPR),vh=_t(Li,Li.UV),ig=_t(Li,Li.SIZE),wg=_t(Li,Li.COORDINATE),Ay=_t(Li,Li.VIEWPORT),KI=Ay.zw,vX=wg.sub(Ay.xy),Ire=vX.div(KI),Pre=le(()=>(Se('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.'),ig),"vec2").once()(),np=Yt(0,"uint").setName("u_cameraIndex").setGroup(UC("cameraIndex")).toVarying("v_cameraIndex"),th=Yt("float").setName("cameraNear").setGroup(Kt).onRenderUpdate(({camera:i})=>i.near),nh=Yt("float").setName("cameraFar").setGroup(Kt).onRenderUpdate(({camera:i})=>i.far),Ia=le(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.projectionMatrix);e=da(t).setGroup(Kt).setName("cameraProjectionMatrices").element(i.isMultiViewCamera?Wh("gl_ViewID_OVR"):np).toConst("cameraProjectionMatrix")}else e=Yt("mat4").setName("cameraProjectionMatrix").setGroup(Kt).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),Ore=le(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.projectionMatrixInverse);e=da(t).setGroup(Kt).setName("cameraProjectionMatricesInverse").element(i.isMultiViewCamera?Wh("gl_ViewID_OVR"):np).toConst("cameraProjectionMatrixInverse")}else e=Yt("mat4").setName("cameraProjectionMatrixInverse").setGroup(Kt).onRenderUpdate(({camera:t})=>t.projectionMatrixInverse);return e}).once()(),ll=le(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.matrixWorldInverse);e=da(t).setGroup(Kt).setName("cameraViewMatrices").element(i.isMultiViewCamera?Wh("gl_ViewID_OVR"):np).toConst("cameraViewMatrix")}else e=Yt("mat4").setName("cameraViewMatrix").setGroup(Kt).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),Fre=le(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.matrixWorld);e=da(t).setGroup(Kt).setName("cameraWorldMatrices").element(i.isMultiViewCamera?Wh("gl_ViewID_OVR"):np).toConst("cameraWorldMatrix")}else e=Yt("mat4").setName("cameraWorldMatrix").setGroup(Kt).onRenderUpdate(({camera:t})=>t.matrixWorld);return e}).once()(),Gre=le(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.normalMatrix);e=da(t).setGroup(Kt).setName("cameraNormalMatrices").element(i.isMultiViewCamera?Wh("gl_ViewID_OVR"):np).toConst("cameraNormalMatrix")}else e=Yt("mat3").setName("cameraNormalMatrix").setGroup(Kt).onRenderUpdate(({camera:t})=>t.normalMatrix);return e}).once()(),Wv=le(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(let s=0,r=i.cameras.length;s<r;s++)t.push(new z);e=da(t).setGroup(Kt).setName("cameraPositions").onRenderUpdate(({camera:s},r)=>{const a=s.cameras,o=r.array;for(let l=0,c=a.length;l<c;l++)o[l].setFromMatrixPosition(a[l].matrixWorld)}).element(i.isMultiViewCamera?Wh("gl_ViewID_OVR"):np).toConst("cameraPosition")}else e=Yt(new z).setName("cameraPosition").setGroup(Kt).onRenderUpdate(({camera:t},n)=>n.value.setFromMatrixPosition(t.matrixWorld));return e}).once()(),zre=le(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const s of i.cameras)t.push(s.viewport);e=da(t,"vec4").setGroup(Kt).setName("cameraViewports").element(np).toConst("cameraViewport")}else e=It(0,0,ig.x,ig.y).toConst("cameraViewport");return e}).once()(),CV=new Gs;class Ln extends Gt{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=on.OBJECT,this.uniformNode=new Ox(null)}getNodeType(){const e=this.scope;if(e===Ln.WORLD_MATRIX)return"mat4";if(e===Ln.POSITION||e===Ln.VIEW_POSITION||e===Ln.DIRECTION||e===Ln.SCALE)return"vec3";if(e===Ln.RADIUS)return"float"}update(e){const t=this.object3d,n=this.uniformNode,s=this.scope;if(s===Ln.WORLD_MATRIX)n.value=t.matrixWorld;else if(s===Ln.POSITION)n.value=n.value||new z,n.value.setFromMatrixPosition(t.matrixWorld);else if(s===Ln.SCALE)n.value=n.value||new z,n.value.setFromMatrixScale(t.matrixWorld);else if(s===Ln.DIRECTION)n.value=n.value||new z,t.getWorldDirection(n.value);else if(s===Ln.VIEW_POSITION){const r=e.camera;n.value=n.value||new z,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(r.matrixWorldInverse)}else if(s===Ln.RADIUS){const r=e.object.geometry;r.boundingSphere===null&&r.computeBoundingSphere(),CV.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),n.value=CV.radius}}generate(e){const t=this.scope;return t===Ln.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===Ln.POSITION||t===Ln.VIEW_POSITION||t===Ln.DIRECTION||t===Ln.SCALE?this.uniformNode.nodeType="vec3":t===Ln.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Ln.WORLD_MATRIX="worldMatrix";Ln.POSITION="position";Ln.SCALE="scale";Ln.VIEW_POSITION="viewPosition";Ln.DIRECTION="direction";Ln.RADIUS="radius";const Vre=fn(Ln,Ln.DIRECTION).setParameterLength(1),Hre=fn(Ln,Ln.WORLD_MATRIX).setParameterLength(1),bX=fn(Ln,Ln.POSITION).setParameterLength(1),kre=fn(Ln,Ln.SCALE).setParameterLength(1),Wre=fn(Ln,Ln.VIEW_POSITION).setParameterLength(1),Xre=fn(Ln,Ln.RADIUS).setParameterLength(1);class il extends Ln{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const qre=_t(il,il.DIRECTION),Pl=_t(il,il.WORLD_MATRIX),jre=_t(il,il.POSITION),Yre=_t(il,il.SCALE),Kre=_t(il,il.VIEW_POSITION),SX=_t(il,il.RADIUS),TX=Yt(new gn).onObjectUpdate(({object:i},e)=>e.value.getNormalMatrix(i.matrixWorld)),Zre=Yt(new Lt).onObjectUpdate(({object:i},e)=>e.value.copy(i.matrixWorld).invert()),gu=le(i=>i.context.modelViewMatrix||AX).once()().toVar("modelViewMatrix"),AX=ll.mul(Pl),GD=le(i=>(i.context.isHighPrecisionModelViewMatrix=!0,Yt("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),zD=le(i=>{const e=i.context.isHighPrecisionModelViewMatrix;return Yt("mat3").onObjectUpdate(({object:t,camera:n})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),zr=Ua("position","vec3"),ss=zr.toVarying("positionLocal"),qM=zr.toVarying("positionPrevious"),Zo=le(i=>Pl.mul(ss).xyz.toVarying(i.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),ZI=le(()=>ss.transformDirection(Pl).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),As=le(i=>i.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),_i=le(i=>{let e;return i.camera.isOrthographicCamera?e=se(0,0,1):e=As.negate().toVarying("v_positionViewDirection").normalize(),e.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class MX extends Gt{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===hi?"false":e.getFrontFacing()}}const EX=_t(MX),JI=W(EX).mul(2).sub(1),Fx=le(([i],{material:e})=>{const t=e.side;return t===hi?i=i.mul(-1):t===Ps&&(i=i.mul(JI)),i}),XC=Ua("normal","vec3"),po=le(i=>i.geometry.hasAttribute("normal")===!1?(Se('TSL: Vertex attribute "normal" not found on geometry.'),se(0,1,0)):XC,"vec3").once()().toVar("normalLocal"),CX=As.dFdx().cross(As.dFdy()).normalize().toVar("normalFlat"),Zy=le(i=>{let e;return i.material.flatShading===!0?e=CX:e=QI(po).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),wX=le(i=>{let e=Zy.transformDirection(ll);return i.material.flatShading!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),kn=le(({subBuildFn:i,material:e,context:t})=>{let n;return i==="NORMAL"||i==="VERTEX"?(n=Zy,e.flatShading!==!0&&(n=Fx(n))):n=t.setupNormal().context({getUV:null}),n},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),ip=kn.transformDirection(ll).toVar("normalWorld"),um=le(({subBuildFn:i,context:e})=>{let t;return i==="NORMAL"||i==="VERTEX"?t=kn:t=e.setupClearcoatNormal().context({getUV:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),RX=le(([i,e=Pl])=>{const t=Qr(e),n=i.div(se(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(n).xyz}),QI=le(([i],e)=>{const t=e.context.modelNormalViewMatrix;if(t)return t.transformDirection(i);const n=TX.mul(i);return ll.transformDirection(n)}),Jre=le(()=>(Se('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),kn)).once(["NORMAL","VERTEX"])(),Qre=le(()=>(Se('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),ip)).once(["NORMAL","VERTEX"])(),$re=le(()=>(Se('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),um)).once(["NORMAL","VERTEX"])(),wV=new Lr,l2=new Lt,NX=Yt(0).onReference(({material:i})=>i).onObjectUpdate(({material:i})=>i.refractionRatio),VA=Yt(1).onReference(({material:i})=>i).onObjectUpdate(function({material:i,scene:e}){return i.envMap?i.envMapIntensity:e.environmentIntensity}),$I=Yt(new Lt).onReference(function(i){return i.material}).onObjectUpdate(function({material:i,scene:e}){const t=e.environment!==null&&i.envMap===null?e.environmentRotation:i.envMapRotation;return t?(wV.copy(t),l2.makeRotationFromEuler(wV)):l2.identity(),l2}),BX=_i.negate().reflect(kn),DX=_i.negate().refract(kn,NX),LX=BX.transformDirection(ll).toVar("reflectVector"),UX=DX.transformDirection(ll).toVar("reflectVector"),IX=new Gh;class PX extends Tc{static get type(){return"CubeTextureNode"}constructor(e,t=null,n=null,s=null){super(e,t,n,s),this.isCubeTextureNode=!0}getInputType(){return this.value.isDepthTexture===!0?"cubeDepthTexture":"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===Sa?LX:e.mapping===el?UX:(De('CubeTextureNode: Mapping "%s" not supported.',e.mapping),se(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return n.isDepthTexture===!0?e.renderer.coordinateSystem===Ka?se(t.x,t.y.negate(),t.z):t:((e.renderer.coordinateSystem===Ka||!n.isRenderTargetTexture)&&(t=se(t.x.negate(),t.yz)),$I.mul(t))}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}}const eP=fn(PX).setParameterLength(1,4).setName("cubeTexture"),za=(i=IX,e=null,t=null,n=null)=>{let s;return i&&i.isCubeTextureNode===!0?(s=St(i.clone()),s.referenceNode=i,e!==null&&(s.uvNode=St(e)),t!==null&&(s.levelNode=St(t)),n!==null&&(s.biasNode=St(n))):s=eP(i,e,t,n),s},eae=(i=IX)=>eP(i);class tae extends tp{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),s=this.getNodeType();return e.format(t,n,s)}}class eT extends Gt{static get type(){return"ReferenceNode"}constructor(e,t,n=null,s=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=s,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=on.OBJECT}element(e){return new tae(this,St(e))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return Se('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=$S(null,e,this.count):Array.isArray(this.getValueFromReference())?t=da(null,e):e==="texture"?t=jn(null):e==="cubeTexture"?t=za(null):t=Yt(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let s=1;s<t.length;s++)n=n[t[s]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const vi=(i,e,t)=>new eT(i,e,t),VD=(i,e,t,n)=>new eT(i,e,n,t);class OX extends eT{static get type(){return"MaterialReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const ih=(i,e,t=null)=>new OX(i,e,t),FX=yi(),nae=As.dFdx(),iae=As.dFdy(),GX=FX.dFdx(),zX=FX.dFdy(),VX=kn,HX=iae.cross(VX),kX=VX.cross(nae),HD=HX.mul(GX.x).add(kX.mul(zX.x)),kD=HX.mul(GX.y).add(kX.mul(zX.y)),RV=HD.dot(HD).max(kD.dot(kD)),WX=RV.equal(0).select(0,RV.inverseSqrt()),sae=HD.mul(WX).toVar("tangentViewFrame"),rae=kD.mul(WX).toVar("bitangentViewFrame"),qC=Ua("tangent","vec4"),tT=qC.xyz.toVar("tangentLocal"),jC=le(({subBuildFn:i,geometry:e,material:t})=>{let n;return i==="VERTEX"||e.hasAttribute("tangent")?n=gu.mul(It(tT,0)).xyz.toVarying("v_tangentView").normalize():n=sae,t.flatShading!==!0&&(n=Fx(n)),n},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),XX=jC.transformDirection(ll).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),YC=le(([i,e],{subBuildFn:t,material:n})=>{let s=i.mul(qC.w).xyz;return t==="NORMAL"&&n.flatShading!==!0&&(s=s.toVarying(e)),s}).once(["NORMAL"]),aae=YC(XC.cross(qC),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),oae=YC(po.cross(tT),"v_bitangentLocal").normalize().toVar("bitangentLocal"),qX=le(({subBuildFn:i,geometry:e,material:t})=>{let n;return i==="VERTEX"||e.hasAttribute("tangent")?n=YC(kn.cross(jC),"v_bitangentView").normalize():n=rae,t.flatShading!==!0&&(n=Fx(n)),n},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),lae=YC(ip.cross(XX),"v_bitangentWorld").normalize().toVar("bitangentWorld"),hm=Qr(jC,qX,kn).toVar("TBNViewMatrix"),jX=_i.mul(hm),cae=(i,e)=>i.sub(jX.mul(e)),YX=le(()=>{let i=Em.cross(_i);return i=i.cross(Em).normalize(),i=wn(i,kn,Md.mul(Wc.oneMinus()).oneMinus().pow2().pow2()).normalize(),i}).once()(),KX=i=>St(i).mul(.5).add(.5),uae=i=>St(i).mul(2).sub(1),WD=i=>se(i,ya(GC(W(1).sub(Yl(i,i)))));class ZX extends ti{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=Vl,this.unpackNormalMode=Iv}setup({material:e}){const{normalMapType:t,scaleNode:n,unpackNormalMode:s}=this;let r=this.node.mul(2).sub(1);if(t===Vl?s===jE?r=WD(r.xy):s===eU?r=WD(r.yw):s!==Iv&&console.error(`THREE.NodeMaterial: Unexpected unpack normal mode: ${s}`):s!==Iv&&console.error(`THREE.NodeMaterial: Normal map type '${t}' is not compatible with unpack normal mode '${s}'`),n!==null){let o=n;e.flatShading===!0&&(o=Fx(o)),r=se(r.xy.mul(o),r.z)}let a=null;return t===qE?a=QI(r):t===Vl?a=hm.mul(r).normalize():(De(`NodeMaterial: Unsupported normal map type: ${t}`),a=kn),a}}const XD=fn(ZX).setParameterLength(1,2),hae=le(({textureNode:i,bumpScale:e})=>{const t=s=>i.isolate().context({getUV:r=>s(r.uvNode||yi()),forceUVContext:!0}),n=W(t(s=>s));return $e(W(t(s=>s.add(s.dFdx()))).sub(n),W(t(s=>s.add(s.dFdy()))).sub(n)).mul(e)}),dae=le(i=>{const{surf_pos:e,surf_norm:t,dHdxy:n}=i,s=e.dFdx().normalize(),r=e.dFdy().normalize(),a=t,o=r.cross(a),l=a.cross(s),c=s.dot(o).mul(JI),u=c.sign().mul(n.x.mul(o).add(n.y.mul(l)));return c.abs().mul(t).sub(u).normalize()});class JX extends ti{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=hae({textureNode:this.textureNode,bumpScale:e});return dae({surf_pos:As,surf_norm:kn,dHdxy:t})}}const tP=fn(JX).setParameterLength(1,2),NV=new Map;class Fe extends Gt{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=NV.get(e);return n===void 0&&(n=ih(e,t),NV.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let s=null;if(n===Fe.COLOR){const r=t.color!==void 0?this.getColor(n):se();t.map&&t.map.isTexture===!0?s=r.mul(this.getTexture("map")):s=r}else if(n===Fe.OPACITY){const r=this.getFloat(n);t.alphaMap&&t.alphaMap.isTexture===!0?s=r.mul(this.getTexture("alpha")):s=r}else if(n===Fe.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?s=this.getTexture("specular").r:s=W(1);else if(n===Fe.SPECULAR_INTENSITY){const r=this.getFloat(n);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?s=r.mul(this.getTexture(n).a):s=r}else if(n===Fe.SPECULAR_COLOR){const r=this.getColor(n);t.specularColorMap&&t.specularColorMap.isTexture===!0?s=r.mul(this.getTexture(n).rgb):s=r}else if(n===Fe.ROUGHNESS){const r=this.getFloat(n);t.roughnessMap&&t.roughnessMap.isTexture===!0?s=r.mul(this.getTexture(n).g):s=r}else if(n===Fe.METALNESS){const r=this.getFloat(n);t.metalnessMap&&t.metalnessMap.isTexture===!0?s=r.mul(this.getTexture(n).b):s=r}else if(n===Fe.EMISSIVE){const r=this.getFloat("emissiveIntensity"),a=this.getColor(n).mul(r);t.emissiveMap&&t.emissiveMap.isTexture===!0?s=a.mul(this.getTexture(n)):s=a}else if(n===Fe.NORMAL)t.normalMap?(s=XD(this.getTexture("normal"),this.getCache("normalScale","vec2")),s.normalMapType=t.normalMapType,(t.normalMap.format==Wr||t.normalMap.format==Nh||t.normalMap.format==Rh)&&(s.unpackNormalMode=jE)):t.bumpMap?s=tP(this.getTexture("bump").r,this.getFloat("bumpScale")):s=kn;else if(n===Fe.CLEARCOAT){const r=this.getFloat(n);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?s=r.mul(this.getTexture(n).r):s=r}else if(n===Fe.CLEARCOAT_ROUGHNESS){const r=this.getFloat(n);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?s=r.mul(this.getTexture(n).r):s=r}else if(n===Fe.CLEARCOAT_NORMAL)t.clearcoatNormalMap?s=XD(this.getTexture(n),this.getCache(n+"Scale","vec2")):s=kn;else if(n===Fe.SHEEN){const r=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?s=r.mul(this.getTexture("sheenColor").rgb):s=r}else if(n===Fe.SHEEN_ROUGHNESS){const r=this.getFloat(n);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?s=r.mul(this.getTexture(n).a):s=r,s=s.clamp(1e-4,1)}else if(n===Fe.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const r=this.getTexture(n);s=DC(H0.x,H0.y,H0.y.negate(),H0.x).mul(r.rg.mul(2).sub($e(1)).normalize().mul(r.b))}else s=H0;else if(n===Fe.IRIDESCENCE_THICKNESS){const r=vi("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const a=vi("0","float",t.iridescenceThicknessRange);s=r.sub(a).mul(this.getTexture(n).g).add(a)}else s=r}else if(n===Fe.TRANSMISSION){const r=this.getFloat(n);t.transmissionMap?s=r.mul(this.getTexture(n).r):s=r}else if(n===Fe.THICKNESS){const r=this.getFloat(n);t.thicknessMap?s=r.mul(this.getTexture(n).g):s=r}else if(n===Fe.IOR)s=this.getFloat(n);else if(n===Fe.LIGHT_MAP)s=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===Fe.AO)s=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(n===Fe.LINE_DASH_OFFSET)s=t.dashOffset?this.getFloat(n):W(0);else{const r=this.getNodeType(e);s=this.getCache(n,r)}return s}}Fe.ALPHA_TEST="alphaTest";Fe.COLOR="color";Fe.OPACITY="opacity";Fe.SHININESS="shininess";Fe.SPECULAR="specular";Fe.SPECULAR_STRENGTH="specularStrength";Fe.SPECULAR_INTENSITY="specularIntensity";Fe.SPECULAR_COLOR="specularColor";Fe.REFLECTIVITY="reflectivity";Fe.ROUGHNESS="roughness";Fe.METALNESS="metalness";Fe.NORMAL="normal";Fe.CLEARCOAT="clearcoat";Fe.CLEARCOAT_ROUGHNESS="clearcoatRoughness";Fe.CLEARCOAT_NORMAL="clearcoatNormal";Fe.EMISSIVE="emissive";Fe.ROTATION="rotation";Fe.SHEEN="sheen";Fe.SHEEN_ROUGHNESS="sheenRoughness";Fe.ANISOTROPY="anisotropy";Fe.IRIDESCENCE="iridescence";Fe.IRIDESCENCE_IOR="iridescenceIOR";Fe.IRIDESCENCE_THICKNESS="iridescenceThickness";Fe.IOR="ior";Fe.TRANSMISSION="transmission";Fe.THICKNESS="thickness";Fe.ATTENUATION_DISTANCE="attenuationDistance";Fe.ATTENUATION_COLOR="attenuationColor";Fe.LINE_SCALE="scale";Fe.LINE_DASH_SIZE="dashSize";Fe.LINE_GAP_SIZE="gapSize";Fe.LINE_WIDTH="linewidth";Fe.LINE_DASH_OFFSET="dashOffset";Fe.POINT_SIZE="size";Fe.DISPERSION="dispersion";Fe.LIGHT_MAP="light";Fe.AO="ao";const QX=_t(Fe,Fe.ALPHA_TEST),jM=_t(Fe,Fe.COLOR),$X=_t(Fe,Fe.SHININESS),eq=_t(Fe,Fe.EMISSIVE),KC=_t(Fe,Fe.OPACITY),tq=_t(Fe,Fe.SPECULAR),qD=_t(Fe,Fe.SPECULAR_INTENSITY),nq=_t(Fe,Fe.SPECULAR_COLOR),Xv=_t(Fe,Fe.SPECULAR_STRENGTH),HA=_t(Fe,Fe.REFLECTIVITY),iq=_t(Fe,Fe.ROUGHNESS),sq=_t(Fe,Fe.METALNESS),rq=_t(Fe,Fe.NORMAL),aq=_t(Fe,Fe.CLEARCOAT),oq=_t(Fe,Fe.CLEARCOAT_ROUGHNESS),lq=_t(Fe,Fe.CLEARCOAT_NORMAL),cq=_t(Fe,Fe.ROTATION),uq=_t(Fe,Fe.SHEEN),hq=_t(Fe,Fe.SHEEN_ROUGHNESS),dq=_t(Fe,Fe.ANISOTROPY),fq=_t(Fe,Fe.IRIDESCENCE),pq=_t(Fe,Fe.IRIDESCENCE_IOR),mq=_t(Fe,Fe.IRIDESCENCE_THICKNESS),gq=_t(Fe,Fe.TRANSMISSION),yq=_t(Fe,Fe.THICKNESS),xq=_t(Fe,Fe.IOR),_q=_t(Fe,Fe.ATTENUATION_DISTANCE),vq=_t(Fe,Fe.ATTENUATION_COLOR),nP=_t(Fe,Fe.LINE_SCALE),iP=_t(Fe,Fe.LINE_DASH_SIZE),sP=_t(Fe,Fe.LINE_GAP_SIZE),kA=_t(Fe,Fe.LINE_WIDTH),rP=_t(Fe,Fe.LINE_DASH_OFFSET),bq=_t(Fe,Fe.POINT_SIZE),Sq=_t(Fe,Fe.DISPERSION),aP=_t(Fe,Fe.LIGHT_MAP),Tq=_t(Fe,Fe.AO),H0=Yt(new Ae).onReference(function(i){return i.material}).onRenderUpdate(function({material:i}){this.value.set(i.anisotropy*Math.cos(i.anisotropyRotation),i.anisotropy*Math.sin(i.anisotropyRotation))}),Aq=le(i=>i.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class Mq extends tp{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const n=this.storageBufferNode.structTypeNode;return n?n.getMemberType(e,t):"void"}setup(e){return e.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let n;const s=e.context.assign;if(e.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&s!==!0&&(this.node.value.isInstancedBufferAttribute||e.shaderStage!=="compute")?n=e.generatePBO(this):n=this.node.build(e):n=super.generate(e),s!==!0){const r=this.getNodeType(e);n=e.format(n,r,t)}return n}}const fae=fn(Mq).setParameterLength(2);class Eq extends WC{static get type(){return"StorageBufferNode"}constructor(e,t=null,n=0){let s,r=null;t&&t.isStruct?(s="struct",r=t.layout,(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(n=e.count)):t===null&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(s=ZU(e.itemSize),n=e.count):s=t,super(e,s,n),this.isStorageBufferNode=!0,this.structTypeNode=r,this.access=wr.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return fae(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(wr.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=VI(this.value),this._varying=Tu(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}getMemberType(e,t){return this.structTypeNode!==null?this.structTypeNode.getMemberType(e,t):"void"}generate(e){if(this.structTypeNode!==null&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:n}=this.getAttributeData(),s=n.build(e);return e.registerTransform(s,t),s}}const bh=(i,e=null,t=0)=>new Eq(i,e,t),pae=(i,e,t)=>(Se('TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),bh(i,e,t).setPBO(!0));class Wi extends Gt{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let s;if(n===Wi.VERTEX)s=e.getVertexIndex();else if(n===Wi.INSTANCE)s=e.getInstanceIndex();else if(n===Wi.DRAW)s=e.getDrawIndex();else if(n===Wi.INVOCATION_LOCAL)s=e.getInvocationLocalIndex();else if(n===Wi.INVOCATION_SUBGROUP)s=e.getInvocationSubgroupIndex();else if(n===Wi.SUBGROUP)s=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let r;return e.shaderStage==="vertex"||e.shaderStage==="compute"?r=s:r=Tu(this).build(e,t),r}}Wi.VERTEX="vertex";Wi.INSTANCE="instance";Wi.SUBGROUP="subgroup";Wi.INVOCATION_LOCAL="invocationLocal";Wi.INVOCATION_SUBGROUP="invocationSubgroup";Wi.DRAW="draw";const Cq=_t(Wi,Wi.VERTEX),lu=_t(Wi,Wi.INSTANCE),mae=_t(Wi,Wi.SUBGROUP),gae=_t(Wi,Wi.INVOCATION_SUBGROUP),yae=_t(Wi,Wi.INVOCATION_LOCAL),wq=_t(Wi,Wi.DRAW);class oP extends Gt{static get type(){return"InstanceNode"}constructor(e,t,n=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=on.FRAME,this.buffer=null,this.bufferColor=null}get isStorageMatrix(){const{instanceMatrix:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}get isStorageColor(){const{instanceColor:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}setup(e){const{instanceMatrix:t,instanceColor:n,isStorageMatrix:s,isStorageColor:r}=this,{count:a}=t;let{instanceMatrixNode:o,instanceColorNode:l}=this;if(o===null){if(s)o=bh(t,"mat4",Math.max(a,1)).element(lu);else if(a<=1e3)o=$S(t.array,"mat4",Math.max(a,1)).element(lu);else{const u=new jU(t.array,16,1);this.buffer=u;const h=t.usage===hh?FD:XM,f=[h(u,"vec4",16,0),h(u,"vec4",16,4),h(u,"vec4",16,8),h(u,"vec4",16,12)];o=rf(...f)}this.instanceMatrixNode=o}if(n&&l===null){if(r)l=bh(n,"vec3",Math.max(n.count,1)).element(lu);else{const u=new Yr(n.array,3),h=n.usage===hh?FD:XM;this.bufferColor=u,l=se(h(u,"vec3",3,0))}this.instanceColorNode=l}const c=o.mul(ss).xyz;if(ss.assign(c),e.hasGeometryAttribute("normal")){const u=RX(po,o);po.assign(u)}this.instanceColorNode!==null&&Po("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.buffer!==null&&this.isStorageMatrix!==!0&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.usage!==hh&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&this.isStorageColor!==!0&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.usage!==hh&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}}const xae=fn(oP).setParameterLength(2,3);class Rq extends oP{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:s}=e;super(t,n,s),this.instancedMesh=e}}const Nq=fn(Rq).setParameterLength(1);class Bq extends Gt{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=lu:this.batchingIdNode=wq);const n=le(([g])=>{const x=te(_h(hs(this.batchMesh._indirectTexture),0).x).toConst(),v=te(g).mod(x).toConst(),y=te(g).div(x).toConst();return hs(this.batchMesh._indirectTexture,js(v,y)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(te(this.batchingIdNode)),s=this.batchMesh._matricesTexture,r=te(_h(hs(s),0).x).toConst(),a=W(n).mul(4).toInt().toConst(),o=a.mod(r).toConst(),l=a.div(r).toConst(),c=rf(hs(s,js(o,l)),hs(s,js(o.add(1),l)),hs(s,js(o.add(2),l)),hs(s,js(o.add(3),l))),u=this.batchMesh._colorsTexture;if(u!==null){const x=le(([v])=>{const y=te(_h(hs(u),0).x).toConst(),b=v,S=b.mod(y).toConst(),T=b.div(y).toConst();return hs(u,js(S,T)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(n);Po("vec3","vBatchColor").assign(x)}const h=Qr(c);ss.assign(c.mul(ss));const f=po.div(se(h[0].dot(h[0]),h[1].dot(h[1]),h[2].dot(h[2]))),m=h.mul(f).xyz;po.assign(m),e.hasGeometryAttribute("tangent")&&tT.mulAssign(h)}}const Dq=fn(Bq).setParameterLength(1),BV=new WeakMap;class lP extends Gt{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=on.OBJECT,this.skinIndexNode=Ua("skinIndex","uvec4"),this.skinWeightNode=Ua("skinWeight","vec4"),this.bindMatrixNode=vi("bindMatrix","mat4"),this.bindMatrixInverseNode=vi("bindMatrixInverse","mat4"),this.boneMatricesNode=VD("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=ss,this.toPositionNode=ss,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:n,skinWeightNode:s,bindMatrixNode:r,bindMatrixInverseNode:a}=this,o=e.element(n.x),l=e.element(n.y),c=e.element(n.z),u=e.element(n.w),h=r.mul(t),f=zs(o.mul(s.x).mul(h),l.mul(s.y).mul(h),c.mul(s.z).mul(h),u.mul(s.w).mul(h));return a.mul(f).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=po){const{skinIndexNode:n,skinWeightNode:s,bindMatrixNode:r,bindMatrixInverseNode:a}=this,o=e.element(n.x),l=e.element(n.y),c=e.element(n.z),u=e.element(n.w);let h=zs(s.x.mul(o),s.y.mul(l),s.z.mul(c),s.w.mul(u));return h=a.mul(h).mul(r),h.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=VD("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,qM)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||QU(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&qM.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const n=this.getSkinnedNormal();po.assign(n),e.hasGeometryAttribute("tangent")&&tT.assign(n)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;BV.get(t)!==e.frameId&&(BV.set(t,e.frameId),this.previousBoneMatricesNode!==null&&(t.previousBoneMatrices===null&&(t.previousBoneMatrices=new Float32Array(t.boneMatrices)),t.previousBoneMatrices.set(t.boneMatrices)),t.update())}}const Lq=i=>new lP(i),_ae=(i,e=null)=>{const t=new lP(i);return t.positionNode=bh(new Yr(i.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(lu).toVar(),t.skinIndexNode=bh(new Yr(new Uint32Array(i.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(lu).toVar(),t.skinWeightNode=bh(new Yr(i.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(lu).toVar(),t.bindMatrixNode=Yt(i.bindMatrix,"mat4"),t.bindMatrixInverseNode=Yt(i.bindMatrixInverse,"mat4"),t.boneMatricesNode=$S(i.skeleton.boneMatrices,"mat4",i.skeleton.bones.length),t.toPositionNode=e,St(t)};class Uq extends Gt{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const n={};for(let o=0,l=this.params.length-1;o<l;o++){const c=this.params[o],u=c.isNode!==!0&&c.name||this.getVarName(o),h=c.isNode!==!0&&c.type||"int";n[u]=Lh(u,h)}const s=e.addStack(),r=this.params[this.params.length-1](n);t.returnsNode=r.context({nodeLoop:r}),t.stackNode=s;const a=this.params[0];if(a.isNode!==!0&&typeof a.update=="function"){const o=le(this.params[0].update)(n);t.updateNode=o.context({nodeLoop:o})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){const t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){const t=this.getProperties(e),n=this.params,s=t.stackNode;for(let a=0,o=n.length-1;a<o;a++){const l=n[a];let c=!1,u=null,h=null,f=null,m=null,g=null,x=null;l.isNode?l.getNodeType(e)==="bool"?(c=!0,m="bool",h=l.build(e,m)):(m="int",f=this.getVarName(a),u="0",h=l.build(e,m),g="<"):(m=l.type||"int",f=l.name||this.getVarName(a),u=l.start,h=l.end,g=l.condition,x=l.update,typeof u=="number"?u=e.generateConst(m,u):u&&u.isNode&&(u=u.build(e,m)),typeof h=="number"?h=e.generateConst(m,h):h&&h.isNode&&(h=h.build(e,m)),u!==void 0&&h===void 0?(u=u+" - 1",h="0",g=">="):h!==void 0&&u===void 0&&(u="0",g="<"),g===void 0&&(Number(u)>Number(h)?g=">=":g="<"));let v;if(c)v=`while ( ${h} )`;else{const y={start:u,end:h},b=y.start,S=y.end;let T;const M=()=>g.includes("<")?"+=":"-=";if(x!=null)switch(typeof x){case"function":T=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":T=f+" "+M()+" "+e.generateConst(m,x);break;case"string":T=f+" "+x;break;default:x.isNode?T=f+" "+M()+" "+x.build(e):(De("TSL: 'Loop( { update: ... } )' is not a function, string or number."),T="break /* invalid update */")}else m==="int"||m==="uint"?x=g.includes("<")?"++":"--":x=M()+" 1.",T=f+" "+x;const C=e.getVar(m,f)+" = "+b,w=f+" "+g+" "+S;v=`for ( ${C}; ${w}; ${T} )`}e.addFlowCode((a===0?`
`:"")+e.tab+v+` {

`).addFlowTab()}const r=s.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode(`
`+e.tab+r);for(let a=0,o=this.params.length-1;a<o;a++)e.addFlowCode((a===0?"":e.tab)+`}

`).removeFlowTab();e.addFlowTab()}}const ci=(...i)=>new Uq(Mm(i,"int")).toStack(),vae=()=>Lh("continue").toStack(),Iq=()=>Lh("break").toStack(),c2=new WeakMap,Do=new un,DV=le(({bufferMap:i,influence:e,stride:t,width:n,depth:s,offset:r})=>{const a=te(Cq).mul(t).add(r),o=a.div(n),l=a.sub(o.mul(n));return hs(i,js(l,o)).depth(s).xyz.mul(e)});function bae(i){const e=i.morphAttributes.position!==void 0,t=i.morphAttributes.normal!==void 0,n=i.morphAttributes.color!==void 0,s=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,r=s!==void 0?s.length:0;let a=c2.get(i);if(a===void 0||a.count!==r){let b=function(){v.dispose(),c2.delete(i),i.removeEventListener("dispose",b)};var o=b;a!==void 0&&a.texture.dispose();const l=i.morphAttributes.position||[],c=i.morphAttributes.normal||[],u=i.morphAttributes.color||[];let h=0;e===!0&&(h=1),t===!0&&(h=2),n===!0&&(h=3);let f=i.attributes.position.count*h,m=1;const g=4096;f>g&&(m=Math.ceil(f/g),f=g);const x=new Float32Array(f*m*4*r),v=new Ex(x,f,m,r);v.type=Rn,v.needsUpdate=!0;const y=h*4;for(let S=0;S<r;S++){const T=l[S],M=c[S],C=u[S],w=f*m*4*S;for(let N=0;N<T.count;N++){const E=N*y;e===!0&&(Do.fromBufferAttribute(T,N),x[w+E+0]=Do.x,x[w+E+1]=Do.y,x[w+E+2]=Do.z,x[w+E+3]=0),t===!0&&(Do.fromBufferAttribute(M,N),x[w+E+4]=Do.x,x[w+E+5]=Do.y,x[w+E+6]=Do.z,x[w+E+7]=0),n===!0&&(Do.fromBufferAttribute(C,N),x[w+E+8]=Do.x,x[w+E+9]=Do.y,x[w+E+10]=Do.z,x[w+E+11]=C.itemSize===4?Do.w:1)}}a={count:r,texture:v,stride:h,size:new Ae(f,m)},c2.set(i,a),i.addEventListener("dispose",b)}return a}class Pq extends Gt{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Yt(1),this.updateType=on.OBJECT}setup(e){const{geometry:t}=e,n=t.morphAttributes.position!==void 0,s=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,r=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,a=r!==void 0?r.length:0,{texture:o,stride:l,size:c}=bae(t);n===!0&&ss.mulAssign(this.morphBaseInfluence),s===!0&&po.mulAssign(this.morphBaseInfluence);const u=te(c.width);ci(a,({i:h})=>{const f=W(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?f.assign(hs(this.mesh.morphTexture,js(te(h).add(1),te(lu))).r):f.assign(vi("morphTargetInfluences","float").element(h).toVar()),Wt(f.notEqual(0),()=>{n===!0&&ss.addAssign(DV({bufferMap:o,influence:f,stride:l,width:u,depth:h,offset:te(0)})),s===!0&&po.addAssign(DV({bufferMap:o,influence:f,stride:l,width:u,depth:h,offset:te(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,n)=>t+n,0)}}const Oq=fn(Pq).setParameterLength(1);class Rg extends Gt{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class Fq extends Rg{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class Gq extends OI{static get type(){return"LightingContextNode"}constructor(e,t=null,n=null,s=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=s,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n=se().toVar("directDiffuse"),s=se().toVar("directSpecular"),r=se().toVar("indirectDiffuse"),a=se().toVar("indirectSpecular"),o={directDiffuse:n,directSpecular:s,indirectDiffuse:r,indirectSpecular:a};return{radiance:se().toVar("radiance"),irradiance:se().toVar("irradiance"),iblIrradiance:se().toVar("iblIrradiance"),ambientOcclusion:W(1).toVar("ambientOcclusion"),reflectedLight:o,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const zq=fn(Gq);class Vq extends Rg{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}const M0=new Ae;class nT extends Tc{static get type(){return"ViewportTextureNode"}constructor(e=vh,t=null,n=null){let s=null;n===null?(s=new US,s.minFilter=$s,n=s):s=n,super(n,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=s,this.isOutputTextureNode=!0,this.updateBeforeType=on.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,n;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,n=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,n=this._cacheTextures),e===null)return t;if(n.has(e)===!1){const s=t.clone();n.set(e,s)}return n.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,n=t.getRenderTarget();n===null?t.getDrawingBufferSize(M0):M0.set(n.width,n.height);const s=this.getTextureForReference(n);(s.image.width!==M0.width||s.image.height!==M0.height)&&(s.image.width=M0.width,s.image.height=M0.height,s.needsUpdate=!0);const r=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(s),s.generateMipmaps=r}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const Sae=fn(nT).setParameterLength(0,3),cP=fn(nT,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let Z1=null;class Hq extends nT{static get type(){return"ViewportDepthTextureNode"}constructor(e=vh,t=null){Z1===null&&(Z1=new tr),super(e,t,Z1)}getTextureForReference(){return Z1}}const uP=fn(Hq).setParameterLength(0,2);class ka extends Gt{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===ka.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,n=this.valueNode;let s=null;if(t===ka.DEPTH_BASE)n!==null&&(s=kq().assign(n));else if(t===ka.DEPTH)e.isPerspectiveCamera?s=hP(As.z,th,nh):s=My(As.z,th,nh);else if(t===ka.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const r=dP(n,th,nh);s=My(r,th,nh)}else s=n;else s=My(As.z,th,nh);return s}}ka.DEPTH_BASE="depthBase";ka.DEPTH="depth";ka.LINEAR_DEPTH="linearDepth";const My=(i,e,t)=>i.add(e).div(e.sub(t)),Tae=(i,e,t)=>e.sub(t).mul(i).sub(e),hP=(i,e,t)=>e.add(i).mul(t).div(t.sub(e).mul(i)),dP=(i,e,t)=>e.mul(t).div(t.sub(e).mul(i).sub(t)),fP=(i,e,t)=>{e=e.max(1e-6).toVar();const n=ru(i.negate().div(e)),s=ru(t.div(e));return n.div(s)},Aae=(i,e,t)=>{const n=i.mul(IC(t.div(e)));return W(Math.E).pow(n).mul(e).negate()},kq=fn(ka,ka.DEPTH_BASE),pP=_t(ka,ka.DEPTH),Jy=fn(ka,ka.LINEAR_DEPTH).setParameterLength(0,1),Mae=Jy(uP());pP.assign=i=>kq(i);class Hl extends Gt{static get type(){return"ClippingNode"}constructor(e=Hl.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:s}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===Hl.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,s):this.scope===Hl.HARDWARE?this.setupHardwareClipping(s,e):this.setupDefault(n,s)}setupAlphaToCoverage(e,t){return le(()=>{const n=W().toVar("distanceToPlane"),s=W().toVar("distanceToGradient"),r=W(1).toVar("clipOpacity"),a=t.length;if(this.hardwareClipping===!1&&a>0){const l=da(t).setGroup(Kt);ci(a,({i:c})=>{const u=l.element(c);n.assign(As.dot(u.xyz).negate().add(u.w)),s.assign(n.fwidth().div(2)),r.mulAssign(nl(s.negate(),s,n))})}const o=e.length;if(o>0){const l=da(e).setGroup(Kt),c=W(1).toVar("intersectionClipOpacity");ci(o,({i:u})=>{const h=l.element(u);n.assign(As.dot(h.xyz).negate().add(h.w)),s.assign(n.fwidth().div(2)),c.mulAssign(nl(s.negate(),s,n).oneMinus())}),r.mulAssign(c.oneMinus())}pi.a.mulAssign(r),pi.a.equal(0).discard()})()}setupDefault(e,t){return le(()=>{const n=t.length;if(this.hardwareClipping===!1&&n>0){const r=da(t).setGroup(Kt);ci(n,({i:a})=>{const o=r.element(a);As.dot(o.xyz).greaterThan(o.w).discard()})}const s=e.length;if(s>0){const r=da(e).setGroup(Kt),a=jl(!0).toVar("clipped");ci(s,({i:o})=>{const l=r.element(o);a.assign(As.dot(l.xyz).greaterThan(l.w).and(a))}),a.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),le(()=>{const s=da(e).setGroup(Kt),r=Wh(t.getClipDistance());ci(n,({i:a})=>{const o=s.element(a),l=As.dot(o.xyz).sub(o.w).negate();r.element(a).assign(l)})})()}}Hl.ALPHA_TO_COVERAGE="alphaToCoverage";Hl.DEFAULT="default";Hl.HARDWARE="hardware";const Eae=()=>new Hl,Cae=()=>new Hl(Hl.ALPHA_TO_COVERAGE),wae=()=>new Hl(Hl.HARDWARE),Rae=.05,LV=le(([i])=>bc(dn(1e4,La(dn(17,i.x).add(dn(.1,i.y)))).mul(zs(.1,Pi(La(dn(13,i.y).add(i.x))))))),UV=le(([i])=>LV($e(LV(i.xy),i.z))),Nae=le(([i])=>{const e=ls(ou(wI(i.xyz)),ou(RI(i.xyz))),t=W(1).div(W(Rae).mul(e)).toVar("pixScale"),n=$e(Ky(au(ru(t))),Ky(PC(ru(t)))),s=$e(UV(au(n.x.mul(i.xyz))),UV(au(n.y.mul(i.xyz)))),r=bc(ru(t)),a=zs(dn(r.oneMinus(),s.x),dn(r,s.y)),o=fo(r,r.oneMinus()),l=se(a.mul(a).div(dn(2,o).mul(On(1,o))),a.sub(dn(.5,o)).div(On(1,o)),On(1,On(1,a).mul(On(1,a)).div(dn(2,o).mul(On(1,o))))),c=a.lessThan(o.oneMinus()).select(a.lessThan(o).select(l.x,l.y),l.z);return Sc(c,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class Wq extends XI{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),n=e.hasGeometryAttribute(t);let s;return n===!0?s=super.generate(e):s=e.generateConst(this.nodeType,new un(1,1,1,1)),s}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const Xq=(i=0)=>new Wq(i),qq=le(([i,e])=>fo(1,i.oneMinus().div(e)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),jq=le(([i,e])=>fo(i.div(e.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Yq=le(([i,e])=>i.oneMinus().mul(e.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Kq=le(([i,e])=>wn(i.mul(2).mul(e),i.oneMinus().mul(2).mul(e.oneMinus()).oneMinus(),FC(.5,i))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Bae=le(([i,e])=>{const t=e.a.add(i.a.mul(e.a.oneMinus()));return It(e.rgb.mul(e.a).add(i.rgb.mul(i.a).mul(e.a.oneMinus())).div(t),t)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),Zq=le(([i])=>It(i.rgb.mul(i.a),i.a),{color:"vec4",return:"vec4"}),Dae=le(([i])=>(Wt(i.a.equal(0),()=>It(0)),It(i.rgb.div(i.a),i.a)),{color:"vec4",return:"vec4"}),Lae=(...i)=>(Se('TSL: "burn" has been renamed. Use "blendBurn" instead.'),qq(i)),Uae=(...i)=>(Se('TSL: "dodge" has been renamed. Use "blendDodge" instead.'),jq(i)),Iae=(...i)=>(Se('TSL: "screen" has been renamed. Use "blendScreen" instead.'),Yq(i)),Pae=(...i)=>(Se('TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),Kq(i));class Tn extends Es{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,this.contextNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{Se('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(t.startsWith("_")===!0)continue;const n=this[t];n&&n.isNode===!0&&e.push({property:t,childNode:n})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:n}of this._getNodeChildren())e.push(Px(t.slice(0,-4)),n.getCacheKey());return this.type+Eg(e)}build(e){this.setup(e)}setupObserver(e){return new wW(e)}setup(e){e.context.setupNormal=()=>Sy(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();t.contextNode.isContextNode===!0?e.context={...e.context,...t.contextNode.getFlowContextData()}:De('NodeMaterial: "renderer.contextNode" must be an instance of `context()`.'),this.contextNode!==null&&(this.contextNode.isContextNode===!0?e.context={...e.context,...this.contextNode.getFlowContextData()}:De('NodeMaterial: "material.contextNode" must be an instance of `context()`.')),e.addStack();const s=Sy(this.setupVertex(e),"VERTEX"),r=this.vertexNode||s;e.stack.outputNode=r,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let a;const o=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(n!==null?n.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const l=this.setupLighting(e);o!==null&&e.stack.addToStack(o);const c=It(l,pi.a).max(0);a=this.setupOutput(e,c),by.assign(a);const u=this.outputNode!==null;if(u&&(a=this.outputNode),e.context.getOutput&&(a=e.context.getOutput(a,e)),n!==null){const h=t.getMRT(),f=this.mrtNode;h!==null?(u&&by.assign(a),a=h,f!==null&&(a=h.merge(f))):f!==null&&(a=f)}}else{let l=this.fragmentNode;l.isOutputStructNode!==!0&&(l=It(l)),a=this.setupOutput(e,l)}e.stack.outputNode=a,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let s=null;if(t.length>0||n.length>0){const r=e.renderer.currentSamples;this.alphaToCoverage&&r>1?s=Cae():e.stack.addToStack(Eae())}return s}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(wae()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let s=this.depthNode;if(s===null){const r=t.getMRT();r&&r.has("depth")?s=r.get("depth"):t.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?s=fP(As.z,th,nh):s=My(As.z,th,nh))}s!==null&&pP.assign(s).toStack()}setupPositionView(){return gu.mul(ss).xyz}setupModelViewProjection(){return Ia.mul(As)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),Aq}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&Oq(t).toStack(),t.isSkinnedMesh===!0&&Lq(t).toStack(),this.displacementMap){const s=ih("displacementMap","texture"),r=ih("displacementScale","float"),a=ih("displacementBias","float");ss.addAssign(po.normalize().mul(s.x.mul(r).add(a)))}return t.isBatchedMesh&&Dq(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&Nq(t).toStack(),this.positionNode!==null&&ss.assign(Sy(this.positionNode,"POSITION","vec3")),ss}setupDiffuseColor(e){const{object:t,geometry:n}=e;this.maskNode!==null&&jl(this.maskNode).not().discard();let s=this.colorNode?It(this.colorNode):jM;this.vertexColors===!0&&n.hasAttribute("color")&&(s=s.mul(Xq())),t.instanceColor&&(s=Po("vec3","vInstanceColor").mul(s)),t.isBatchedMesh&&t._colorsTexture&&(s=Po("vec3","vBatchColor").mul(s)),pi.assign(s);const r=this.opacityNode?W(this.opacityNode):KC;pi.a.assign(pi.a.mul(r));let a=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(a=this.alphaTestNode!==null?W(this.alphaTestNode):QX,this.alphaToCoverage===!0?(pi.a=nl(a,a.add(BI(pi.a)),pi.a),pi.a.lessThanEqual(0).discard()):pi.a.lessThanEqual(a).discard()),this.alphaHash===!0&&pi.a.lessThan(Nae(ss)).discard(),e.isOpaque()&&pi.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?se(0):pi.rgb}setupNormal(){return this.normalNode?se(this.normalNode):rq}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?ih("envMap","cubeTexture"):ih("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Vq(aP)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const s=this.setupLightMap(e);s&&s.isLightingNode&&t.push(s);let r=this.aoNode;r===null&&e.material.aoMap&&(r=Tq),e.context.getAO&&(r=e.context.getAO(r,e)),r&&t.push(new Fq(r));let a=this.lightsNode||e.lightsNode;return t.length>0&&(a=e.renderer.lighting.createNode([...a.getLights(),...t])),a}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:s,emissiveNode:r}=this,o=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let l=this.setupOutgoingLight(e);if(o&&o.getScope().hasLights){const c=this.setupLightingModel(e)||null;l=zq(o,c,n,s)}else n!==null&&(l=se(s!==null?wn(l,n,s):n));return(r&&r.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(PD.assign(se(r||eq)),l=l.add(PD)),l}setupFog(e,t){const n=e.fogNode;return n&&(by.assign(t),t=It(n.toVar())),t}setupPremultipliedAlpha(e,t){return Zq(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const n in e){const s=e[n];this[n]===void 0&&(this[n]=s,s&&s.clone&&(this[n]=s.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&t[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const n=Es.prototype.toJSON.call(this,e);n.inputNodes={};for(const{property:r,childNode:a}of this._getNodeChildren())n.inputNodes[r]=a.toJSON(e).uuid;function s(r){const a=[];for(const o in r){const l=r[o];delete l.metadata,a.push(l)}return a}if(t){const r=s(e.textures),a=s(e.images),o=s(e.nodes);r.length>0&&(n.textures=r),a.length>0&&(n.images=a),o.length>0&&(n.nodes=o)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,this.contextNode=e.contextNode,super.copy(e)}}const Oae=new Ir;class Jq extends Tn{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(Oae),this.setValues(e)}}const Fae=new YS;class Qq extends Tn{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(Fae),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?W(this.offsetNode):rP,t=this.dashScaleNode?W(this.dashScaleNode):nP,n=this.dashSizeNode?W(this.dashSizeNode):iP,s=this.gapSizeNode?W(this.gapSizeNode):sP;Cm.assign(n),Db.assign(s);const r=Tu(Ua("lineDistance").mul(t));(e?r.add(e):r).mod(Cm.add(Db)).greaterThan(Cm).discard()}}let J1=null;class $q extends nT{static get type(){return"ViewportSharedTextureNode"}constructor(e=vh,t=null){J1===null&&(J1=new US),super(e,t,J1)}getTextureForReference(){return J1}updateReference(){return this}}const ej=fn($q).setParameterLength(0,2),Gae=new YS;class zae extends Tn{static get type(){return"Line2NodeMaterial"}constructor(e={}){super(),this.isLine2NodeMaterial=!0,this.setDefaultValues(Gae),this.useColor=e.vertexColors,this.dashOffset=0,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.blending=Nr,this._useDash=e.dashed,this._useAlphaToCoverage=!0,this._useWorldUnits=!1,this.setValues(e)}setup(e){const{renderer:t}=e,n=this._useAlphaToCoverage,s=this.useColor,r=this._useDash,a=this._useWorldUnits,o=le(({start:c,end:u})=>{const h=Ia.element(2).element(2),g=Ia.element(3).element(2).mul(-.5).div(h).sub(c.z).div(u.z.sub(c.z));return It(wn(c.xyz,u.xyz,g),u.w)}).setLayout({name:"trimSegment",type:"vec4",inputs:[{name:"start",type:"vec4"},{name:"end",type:"vec4"}]});this.vertexNode=le(()=>{const c=Ua("instanceStart"),u=Ua("instanceEnd"),h=It(gu.mul(It(c,1))).toVar("start"),f=It(gu.mul(It(u,1))).toVar("end");if(r){const M=this.dashScaleNode?W(this.dashScaleNode):nP,C=this.offsetNode?W(this.offsetNode):rP,w=Ua("instanceDistanceStart"),N=Ua("instanceDistanceEnd");let E=zr.y.lessThan(.5).select(M.mul(w),M.mul(N));E=E.add(C),Po("float","lineDistance").assign(E)}a&&(Po("vec3","worldStart").assign(h.xyz),Po("vec3","worldEnd").assign(f.xyz));const m=Ay.z.div(Ay.w),g=Ia.element(2).element(3).equal(-1);Wt(g,()=>{Wt(h.z.lessThan(0).and(f.z.greaterThan(0)),()=>{f.assign(o({start:h,end:f}))}).ElseIf(f.z.lessThan(0).and(h.z.greaterThanEqual(0)),()=>{h.assign(o({start:f,end:h}))})});const x=Ia.mul(h),v=Ia.mul(f),y=x.xyz.div(x.w),b=v.xyz.div(v.w),S=b.xy.sub(y.xy).toVar();S.x.assign(S.x.mul(m)),S.assign(S.normalize());const T=It().toVar();if(a){const M=f.xyz.sub(h.xyz).normalize(),C=wn(h.xyz,f.xyz,.5).normalize(),w=M.cross(C).normalize(),N=M.cross(w),E=Po("vec4","worldPos");E.assign(zr.y.lessThan(.5).select(h,f));const B=kA.mul(.5);E.addAssign(It(zr.x.lessThan(0).select(w.mul(B),w.mul(B).negate()),0)),r||(E.addAssign(It(zr.y.lessThan(.5).select(M.mul(B).negate(),M.mul(B)),0)),E.addAssign(It(N.mul(B),0)),Wt(zr.y.greaterThan(1).or(zr.y.lessThan(0)),()=>{E.subAssign(It(N.mul(2).mul(B),0))})),T.assign(Ia.mul(E));const U=se().toVar();U.assign(zr.y.lessThan(.5).select(y,b)),T.z.assign(U.z.mul(T.w))}else{const M=$e(S.y,S.x.negate()).toVar("offset");S.x.assign(S.x.div(m)),M.x.assign(M.x.div(m)),M.assign(zr.x.lessThan(0).select(M.negate(),M)),Wt(zr.y.lessThan(0),()=>{M.assign(M.sub(S))}).ElseIf(zr.y.greaterThan(1),()=>{M.assign(M.add(S))}),M.assign(M.mul(kA)),M.assign(M.div(Ay.w.div(YI))),T.assign(zr.y.lessThan(.5).select(x,v)),M.assign(M.mul(T.w)),T.assign(T.add(It(M,0,0)))}return T})();const l=le(({p1:c,p2:u,p3:h,p4:f})=>{const m=c.sub(h),g=f.sub(h),x=u.sub(c),v=m.dot(g),y=g.dot(x),b=m.dot(x),S=g.dot(g),M=x.dot(x).mul(S).sub(y.mul(y)),w=v.mul(y).sub(b.mul(S)).div(M).clamp(),N=v.add(y.mul(w)).div(S).clamp();return $e(w,N)});if(this.colorNode=le(()=>{const c=yi();if(r){const f=this.dashSizeNode?W(this.dashSizeNode):iP,m=this.gapSizeNode?W(this.gapSizeNode):sP;Cm.assign(f),Db.assign(m);const g=Po("float","lineDistance");c.y.lessThan(-1).or(c.y.greaterThan(1)).discard(),g.mod(Cm.add(Db)).greaterThan(Cm).discard()}const u=W(1).toVar("alpha");if(a){const f=Po("vec3","worldStart"),m=Po("vec3","worldEnd"),g=Po("vec4","worldPos").xyz.normalize().mul(1e5),x=m.sub(f),v=l({p1:f,p2:m,p3:se(0,0,0),p4:g}),y=f.add(x.mul(v.x)),b=g.mul(v.y),M=y.sub(b).length().div(kA);if(!r)if(n&&t.currentSamples>0){const C=M.fwidth();u.assign(nl(C.negate().add(.5),C.add(.5),M).oneMinus())}else M.greaterThan(.5).discard()}else if(n&&t.currentSamples>0){const f=c.x,m=c.y.greaterThan(0).select(c.y.sub(1),c.y.add(1)),g=f.mul(f).add(m.mul(m)),x=W(g.fwidth()).toVar("dlen");Wt(c.y.abs().greaterThan(1),()=>{u.assign(nl(x.oneMinus(),x.add(1),g).oneMinus())})}else Wt(c.y.abs().greaterThan(1),()=>{const f=c.x,m=c.y.greaterThan(0).select(c.y.sub(1),c.y.add(1));f.mul(f).add(m.mul(m)).greaterThan(1).discard()});let h;if(this.lineColorNode)h=this.lineColorNode;else if(s){const f=Ua("instanceColorStart"),m=Ua("instanceColorEnd");h=zr.y.lessThan(.5).select(f,m).mul(jM)}else h=jM;return It(h,u)})(),this.transparent){const c=this.opacityNode?W(this.opacityNode):KC;this.outputNode=It(this.colorNode.rgb.mul(c).add(ej().rgb.mul(c.oneMinus())),this.colorNode.a)}super.setup(e)}get worldUnits(){return this._useWorldUnits}set worldUnits(e){this._useWorldUnits!==e&&(this._useWorldUnits=e,this.needsUpdate=!0)}get dashed(){return this._useDash}set dashed(e){this._useDash!==e&&(this._useDash=e,this.needsUpdate=!0)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const Vae=new dC;class tj extends Tn{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(Vae),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?W(this.opacityNode):KC;pi.assign(VC(It(KX(kn),e),Js))}}const mP=le(([i=ZI])=>{const e=i.z.atan(i.x).mul(1/(Math.PI*2)).add(.5),t=i.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return $e(e,t)});class nj extends RS{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,s=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r=new Su(5,5,5),a=mP(ZI),o=new Tn;o.colorNode=jn(t,a,0),o.side=hi,o.blending=Nr;const l=new Kn(r,o),c=new fu;c.add(l),t.minFilter===$s&&(t.minFilter=Jt);const u=new ZE(1,10,this),h=e.getMRT();return e.setMRT(null),u.update(e,c),e.setMRT(h),t.minFilter=n,t.currentGenerateMipmaps=s,l.geometry.dispose(),l.material.dispose(),this}}const qv=new WeakMap;class Hae extends ti{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=za(null);const t=new Gh;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=on.RENDER}updateBefore(e){const{renderer:t,material:n}=e,s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){const r=s.isTextureNode?s.value:n[s.property];if(r&&r.isTexture){const a=r.mapping;if(a===_c||a===wh){if(qv.has(r)){const o=qv.get(r);IV(o,r.mapping),this._cubeTexture=o}else{const o=r.image;if(kae(o)){const l=new nj(o.height);l.fromEquirectangularTexture(t,r),IV(l.texture,r.mapping),this._cubeTexture=l.texture,qv.set(r,l.texture),r.addEventListener("dispose",ij)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function kae(i){return i==null?!1:i.height>0}function ij(i){const e=i.target;e.removeEventListener("dispose",ij);const t=qv.get(e);t!==void 0&&(qv.delete(e),t.dispose())}function IV(i,e){e===_c?i.mapping=Sa:e===wh&&(i.mapping=el)}const sj=fn(Hae).setParameterLength(1);class ZC extends Rg{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=sj(this.envNode)}}class Wae extends Rg{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=W(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Gx{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class rj extends Gx{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,n=e.reflectedLight,s=e.irradianceLightMap;n.indirectDiffuse.assign(It(0)),s?n.indirectDiffuse.addAssign(s):n.indirectDiffuse.addAssign(It(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(pi.rgb)}finish(e){const{material:t,context:n}=e,s=n.outgoingLight,r=e.context.environment;if(r)switch(t.combine){case fg:s.rgb.assign(wn(s.rgb,s.rgb.mul(r.rgb),Xv.mul(HA)));break;case VE:s.rgb.assign(wn(s.rgb,r.rgb,Xv.mul(HA)));break;case HE:s.rgb.addAssign(r.rgb.mul(Xv.mul(HA)));break;default:Se("BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const Xae=new Ts;class gP extends Tn{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Xae),this.setValues(e)}setupNormal(){return Fx(Zy)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new ZC(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Wae(aP)),t}setupOutgoingLight(){return pi.rgb}setupLightingModel(){return new rj}}const Qy=le(({f0:i,f90:e,dotVH:t})=>{const n=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return i.mul(n.oneMinus()).add(e.mul(n))}),sg=le(i=>i.diffuseColor.mul(1/Math.PI)),qae=()=>W(.25),jae=le(({dotNH:i})=>HM.mul(W(.5)).add(1).mul(W(1/Math.PI)).mul(i.pow(HM))),Yae=le(({lightDirection:i})=>{const e=i.add(_i).normalize(),t=kn.dot(e).clamp(),n=_i.dot(e).clamp(),s=Qy({f0:kf,f90:1,dotVH:n}),r=qae(),a=jae({dotNH:t});return s.mul(r).mul(a)});class yP extends rj{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const r=kn.dot(e).clamp().mul(t);n.directDiffuse.addAssign(r.mul(sg({diffuseColor:pi.rgb}))),this.specular===!0&&n.directSpecular.addAssign(r.mul(Yae({lightDirection:e})).mul(Xv))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:s}=e.context;s.indirectDiffuse.addAssign(n.mul(sg({diffuseColor:pi}))),s.indirectDiffuse.mulAssign(t)}}const Kae=new fC;class aj extends Tn{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Kae),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new ZC(t):null}setupLightingModel(){return new yP(!1)}}const Zae=new uC;class oj extends Tn{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(Zae),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new ZC(t):null}setupLightingModel(){return new yP}setupVariants(){const e=(this.shininessNode?W(this.shininessNode):$X).max(1e-4);HM.assign(e);const t=this.specularNode||tq;kf.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const lj=le(i=>{if(i.geometry.hasAttribute("normal")===!1)return W(0);const e=Zy.dFdx().abs().max(Zy.dFdy().abs());return e.x.max(e.y).max(e.z)}),xP=le(i=>{const{roughness:e}=i,t=lj();let n=e.max(.0525);return n=n.add(t),n=n.min(1),n}),cj=le(({alpha:i,dotNL:e,dotNV:t})=>{const n=i.pow2(),s=e.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt()),r=t.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt());return tl(.5,s.add(r).max(SI))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),Jae=le(({alphaT:i,alphaB:e,dotTV:t,dotBV:n,dotTL:s,dotBL:r,dotNV:a,dotNL:o})=>{const l=o.mul(se(i.mul(t),e.mul(n),a).length()),c=a.mul(se(i.mul(s),e.mul(r),o).length());return tl(.5,l.add(c))}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),uj=le(({alpha:i,dotNH:e})=>{const t=i.pow2(),n=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Qae=W(1/Math.PI),$ae=le(({alphaT:i,alphaB:e,dotNH:t,dotTH:n,dotBH:s})=>{const r=i.mul(e),a=se(e.mul(n),i.mul(s),r.mul(t)),o=a.dot(a),l=r.div(o);return Qae.mul(r.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),_P=le(({lightDirection:i,f0:e,f90:t,roughness:n,f:s,normalView:r=kn,USE_IRIDESCENCE:a,USE_ANISOTROPY:o})=>{const l=n.pow2(),c=i.add(_i).normalize(),u=r.dot(i).clamp(),h=r.dot(_i).clamp(),f=r.dot(c).clamp(),m=_i.dot(c).clamp();let g=Qy({f0:e,f90:t,dotVH:m}),x,v;if(Rb(a)&&(g=LC.mix(g,s)),Rb(o)){const y=zv.dot(i),b=zv.dot(_i),S=zv.dot(c),T=Em.dot(i),M=Em.dot(_i),C=Em.dot(c);x=Jae({alphaT:VM,alphaB:l,dotTV:b,dotBV:M,dotTL:y,dotBL:T,dotNV:h,dotNL:u}),v=$ae({alphaT:VM,alphaB:l,dotNH:f,dotTH:S,dotBH:C})}else x=cj({alpha:l,dotNL:u,dotNV:h}),v=uj({alpha:l,dotNH:f});return g.mul(x).mul(v)}),eoe=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let Fc=null;const Lb=le(({roughness:i,dotNV:e})=>{Fc===null&&(Fc=new _a(eoe,16,16,Wr,ln),Fc.name="DFG_LUT",Fc.minFilter=Jt,Fc.magFilter=Jt,Fc.wrapS=ui,Fc.wrapT=ui,Fc.generateMipmaps=!1,Fc.needsUpdate=!0);const t=$e(i,e);return jn(Fc,t).rg}),toe=le(({lightDirection:i,f0:e,f90:t,roughness:n,f:s,USE_IRIDESCENCE:r,USE_ANISOTROPY:a})=>{const o=_P({lightDirection:i,f0:e,f90:t,roughness:n,f:s,USE_IRIDESCENCE:r,USE_ANISOTROPY:a}),l=kn.dot(i).clamp(),c=kn.dot(_i).clamp(),u=Lb({roughness:n,dotNV:c}),h=Lb({roughness:n,dotNV:l}),f=e.mul(u.x).add(t.mul(u.y)),m=e.mul(h.x).add(t.mul(h.y)),g=u.x.add(u.y),x=h.x.add(h.y),v=W(1).sub(g),y=W(1).sub(x),b=e.add(e.oneMinus().mul(.047619)),S=f.mul(m).mul(b).div(W(1).sub(v.mul(y).mul(b).mul(b)).add(SI)),T=v.mul(y),M=S.mul(T);return o.add(M)}),hj=le(i=>{const{dotNV:e,specularColor:t,specularF90:n,roughness:s}=i,r=Lb({dotNV:e,roughness:s});return t.mul(r.x).add(n.mul(r.y))}),jD=le(({f:i,f90:e,dotVH:t})=>{const n=t.oneMinus().saturate(),s=n.mul(n),r=n.mul(s,s).clamp(0,.9999);return i.sub(se(e).mul(r)).div(r.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),noe=le(({roughness:i,dotNH:e})=>{const t=i.pow2(),n=W(1).div(t),r=e.pow2().oneMinus().max(.0078125);return W(2).add(n).mul(r.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),ioe=le(({dotNV:i,dotNL:e})=>W(1).div(W(4).mul(e.add(i).sub(e.mul(i))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),soe=le(({lightDirection:i})=>{const e=i.add(_i).normalize(),t=kn.dot(i).clamp(),n=kn.dot(_i).clamp(),s=kn.dot(e).clamp(),r=noe({roughness:Nd,dotNH:s}),a=ioe({dotNV:n,dotNL:t});return Uo.mul(r).mul(a)}),roe=le(({N:i,V:e,roughness:t})=>{const r=.0078125,a=i.dot(e).saturate(),o=$e(t,a.oneMinus().sqrt());return o.assign(o.mul(.984375).add(r)),o}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),dj=le(({f:i})=>{const e=i.length();return ls(e.mul(e).add(i.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),zd=le(({v1:i,v2:e})=>{const t=i.dot(e),n=t.abs().toVar(),s=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),r=n.add(4.1616724).mul(n).add(3.417594).toVar(),a=s.div(r),o=t.greaterThan(0).select(a,ls(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(a));return i.cross(e).mul(o)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),PV=le(({N:i,V:e,P:t,mInv:n,p0:s,p1:r,p2:a,p3:o})=>{const l=r.sub(s).toVar(),c=o.sub(s).toVar(),u=l.cross(c),h=se().toVar();return Wt(u.dot(t.sub(s)).greaterThanEqual(0),()=>{const f=e.sub(i.mul(e.dot(i))).normalize(),m=i.cross(f).negate(),g=n.mul(Qr(f,m,i).transpose()).toVar(),x=g.mul(s.sub(t)).normalize().toVar(),v=g.mul(r.sub(t)).normalize().toVar(),y=g.mul(a.sub(t)).normalize().toVar(),b=g.mul(o.sub(t)).normalize().toVar(),S=se(0).toVar();S.addAssign(zd({v1:x,v2:v})),S.addAssign(zd({v1:v,v2:y})),S.addAssign(zd({v1:y,v2:b})),S.addAssign(zd({v1:b,v2:x})),h.assign(se(dj({f:S})))}),h}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),aoe=le(({P:i,p0:e,p1:t,p2:n,p3:s})=>{const r=t.sub(e).toVar(),a=s.sub(e).toVar(),o=r.cross(a),l=se().toVar();return Wt(o.dot(i.sub(e)).greaterThanEqual(0),()=>{const c=e.sub(i).normalize().toVar(),u=t.sub(i).normalize().toVar(),h=n.sub(i).normalize().toVar(),f=s.sub(i).normalize().toVar(),m=se(0).toVar();m.addAssign(zd({v1:c,v2:u})),m.addAssign(zd({v1:u,v2:h})),m.addAssign(zd({v1:h,v2:f})),m.addAssign(zd({v1:f,v2:c})),l.assign(se(dj({f:m.abs()})))}),l}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"P",type:"vec3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),JC=1/6,fj=i=>dn(JC,dn(i,dn(i,i.negate().add(3)).sub(3)).add(1)),YD=i=>dn(JC,dn(i,dn(i,dn(3,i).sub(6))).add(4)),pj=i=>dn(JC,dn(i,dn(i,dn(-3,i).add(3)).add(3)).add(1)),KD=i=>dn(JC,Il(i,3)),OV=i=>fj(i).add(YD(i)),FV=i=>pj(i).add(KD(i)),GV=i=>zs(-1,YD(i).div(fj(i).add(YD(i)))),zV=i=>zs(1,KD(i).div(pj(i).add(KD(i)))),VV=(i,e,t)=>{const n=i.uvNode,s=dn(n,e.zw).add(.5),r=au(s),a=bc(s),o=OV(a.x),l=FV(a.x),c=GV(a.x),u=zV(a.x),h=GV(a.y),f=zV(a.y),m=$e(r.x.add(c),r.y.add(h)).sub(.5).mul(e.xy),g=$e(r.x.add(u),r.y.add(h)).sub(.5).mul(e.xy),x=$e(r.x.add(c),r.y.add(f)).sub(.5).mul(e.xy),v=$e(r.x.add(u),r.y.add(f)).sub(.5).mul(e.xy),y=OV(a.y).mul(zs(o.mul(i.sample(m).level(t)),l.mul(i.sample(g).level(t)))),b=FV(a.y).mul(zs(o.mul(i.sample(x).level(t)),l.mul(i.sample(v).level(t))));return y.add(b)},vP=le(([i,e])=>{const t=$e(i.size(te(e))),n=$e(i.size(te(e.add(1)))),s=tl(1,t),r=tl(1,n),a=VV(i,It(s,t),au(e)),o=VV(i,It(r,n),PC(e));return bc(e).mix(a,o)}),ooe=le(([i,e])=>{const t=e.mul(qI(i));return vP(i,t)}),HV=le(([i,e,t,n,s])=>{const r=se(II(e.negate(),Ya(i),tl(1,n))),a=se(ou(s[0].xyz),ou(s[1].xyz),ou(s[2].xyz));return Ya(r).mul(t.mul(a))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),loe=le(([i,e])=>i.mul(Sc(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),coe=cP(),uoe=cP(),kV=le(([i,e,t],{material:n})=>{const r=(n.side===hi?coe:uoe).sample(i),a=ru(ig.x).mul(loe(e,t));return vP(r,a)}),WV=le(([i,e,t])=>(Wt(t.notEqual(0),()=>{const n=IC(e).negate().div(t);return TI(n.negate().mul(i))}),se(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),hoe=le(([i,e,t,n,s,r,a,o,l,c,u,h,f,m,g])=>{let x,v;if(g){x=It().toVar(),v=se().toVar();const M=u.sub(1).mul(g.mul(.025)),C=se(u.sub(M),u,u.add(M));ci({start:0,end:3},({i:w})=>{const N=C.element(w),E=HV(i,e,h,N,o),B=a.add(E),U=c.mul(l.mul(It(B,1))),H=$e(U.xy.div(U.w)).toVar();H.addAssign(1),H.divAssign(2),H.assign($e(H.x,H.y.oneMinus()));const F=kV(H,t,N);x.element(w).assign(F.element(w)),x.a.addAssign(F.a),v.element(w).assign(n.element(w).mul(WV(ou(E),f,m).element(w)))}),x.a.divAssign(3)}else{const M=HV(i,e,h,u,o),C=a.add(M),w=c.mul(l.mul(It(C,1))),N=$e(w.xy.div(w.w)).toVar();N.addAssign(1),N.divAssign(2),N.assign($e(N.x,N.y.oneMinus())),x=kV(N,t,u),v=n.mul(WV(ou(M),f,m))}const y=v.rgb.mul(x.rgb),b=i.dot(e).clamp(),S=se(hj({dotNV:b,specularColor:s,specularF90:r,roughness:t})),T=v.r.add(v.g,v.b).div(3);return It(S.oneMinus().mul(y),x.a.oneMinus().mul(T).oneMinus())}),doe=Qr(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),foe=i=>{const e=i.sqrt();return se(1).add(e).div(se(1).sub(e))},XV=(i,e)=>i.sub(e).div(i.add(e)).pow2(),poe=(i,e)=>{const t=i.mul(2*Math.PI*1e-9),n=se(54856e-17,44201e-17,52481e-17),s=se(1681e3,1795300,2208400),r=se(43278e5,93046e5,66121e5),a=W(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let o=n.mul(r.mul(2*Math.PI).sqrt()).mul(s.mul(t).add(e).cos()).mul(t.pow2().negate().mul(r).exp());return o=se(o.x.add(a),o.y,o.z).div(10685e-11),doe.mul(o)},qV=le(({outsideIOR:i,eta2:e,cosTheta1:t,thinFilmThickness:n,baseF0:s})=>{const r=wn(i,e,nl(0,.03,n)),o=i.div(r).pow2().mul(t.pow2().oneMinus()).oneMinus();Wt(o.lessThan(0),()=>se(1));const l=o.sqrt(),c=XV(r,i),u=Qy({f0:c,f90:1,dotVH:t}),h=u.oneMinus(),f=r.lessThan(i).select(Math.PI,0),m=W(Math.PI).sub(f),g=foe(s.clamp(0,.9999)),x=XV(g,r.toVec3()),v=Qy({f0:x,f90:1,dotVH:l}),y=se(g.x.lessThan(r).select(Math.PI,0),g.y.lessThan(r).select(Math.PI,0),g.z.lessThan(r).select(Math.PI,0)),b=r.mul(n,l,2),S=se(m).add(y),T=u.mul(v).clamp(1e-5,.9999),M=T.sqrt(),C=h.pow2().mul(v).div(se(1).sub(T)),N=u.add(C).toVar(),E=C.sub(h).toVar();return ci({start:1,end:2,condition:"<=",name:"m"},({m:B})=>{E.mulAssign(M);const U=poe(W(B).mul(b),W(B).mul(S)).mul(2);N.addAssign(E.mul(U))}),N.max(se(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),O_=le(({normal:i,viewDir:e,roughness:t})=>{const n=i.dot(e).saturate(),s=t.mul(t),r=t.add(.1).reciprocal(),a=W(-1.9362).add(t.mul(1.0678)).add(s.mul(.4573)).sub(r.mul(.8469)),o=W(-.6014).add(t.mul(.5538)).sub(s.mul(.467)).sub(r.mul(.1255));return a.mul(n).add(o).exp().saturate()}),u2=se(.04),h2=W(1);class QC extends Gx{constructor(e=!1,t=!1,n=!1,s=!1,r=!1,a=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=s,this.transmission=r,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null,this.iridescenceF0Dielectric=null,this.iridescenceF0Metallic=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=se().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=se().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=se().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=se().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=se().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=kn.dot(_i).clamp(),n=qV({outsideIOR:W(1),eta2:GM,cosTheta1:t,thinFilmThickness:zM,baseF0:kf}),s=qV({outsideIOR:W(1),eta2:GM,cosTheta1:t,thinFilmThickness:zM,baseF0:pi.rgb});this.iridescenceFresnel=wn(n,s,ph),this.iridescenceF0Dielectric=jD({f:n,f90:1,dotVH:t}),this.iridescenceF0Metallic=jD({f:s,f90:1,dotVH:t}),this.iridescenceF0=wn(this.iridescenceF0Dielectric,this.iridescenceF0Metallic,ph)}if(this.transmission===!0){const t=Zo,n=Wv.sub(Zo).normalize(),s=ip,r=e.context;r.backdrop=hoe(s,n,Wc,nm,cm,vy,t,Pl,ll,Ia,Vv,pI,gI,mI,this.dispersion?yI:null),r.backdropAlpha=kM,pi.a.mulAssign(wn(1,r.backdrop.a,kM))}super.start(e)}computeMultiscattering(e,t,n,s,r=null){const a=kn.dot(_i).clamp(),o=Lb({roughness:Wc,dotNV:a}),l=r?LC.mix(s,r):s,c=l.mul(o.x).add(n.mul(o.y)),h=o.x.add(o.y).oneMinus(),f=l.add(l.oneMinus().mul(.047619)),m=c.mul(f).div(h.mul(f).oneMinus());e.addAssign(c),t.addAssign(m.mul(h))}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const r=kn.dot(e).clamp().mul(t).toVar();if(this.sheen===!0){this.sheenSpecularDirect.addAssign(r.mul(soe({lightDirection:e})));const a=O_({normal:kn,viewDir:_i,roughness:Nd}),o=O_({normal:kn,viewDir:e,roughness:Nd}),l=Uo.r.max(Uo.g).max(Uo.b).mul(a.max(o)).oneMinus();r.mulAssign(l)}if(this.clearcoat===!0){const o=um.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(o.mul(_P({lightDirection:e,f0:u2,f90:h2,roughness:Bb,normalView:um})))}n.directDiffuse.addAssign(r.mul(sg({diffuseColor:nm}))),n.directSpecular.addAssign(r.mul(toe({lightDirection:e,f0:cm,f90:1,roughness:Wc,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:s,reflectedLight:r,ltc_1:a,ltc_2:o}){const l=t.add(n).sub(s),c=t.sub(n).sub(s),u=t.sub(n).add(s),h=t.add(n).add(s),f=kn,m=_i,g=As.toVar(),x=roe({N:f,V:m,roughness:Wc}),v=a.sample(x).toVar(),y=o.sample(x).toVar(),b=Qr(se(v.x,0,v.y),se(0,1,0),se(v.z,0,v.w)).toVar(),S=cm.mul(y.x).add(cm.oneMinus().mul(y.y)).toVar();r.directSpecular.addAssign(e.mul(S).mul(PV({N:f,V:m,P:g,mInv:b,p0:l,p1:c,p2:u,p3:h}))),r.directDiffuse.addAssign(e.mul(nm).mul(PV({N:f,V:m,P:g,mInv:Qr(1,0,0,0,1,0,0,0,1),p0:l,p1:c,p2:u,p3:h})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context,s=t.mul(sg({diffuseColor:nm})).toVar();if(this.sheen===!0){const r=O_({normal:kn,viewDir:_i,roughness:Nd}),a=Uo.r.max(Uo.g).max(Uo.b).mul(r).oneMinus();s.mulAssign(a)}n.indirectDiffuse.addAssign(s)}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:s}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(n.mul(Uo,O_({normal:kn,viewDir:_i,roughness:Nd}))),this.clearcoat===!0){const v=um.dot(_i).clamp(),y=hj({dotNV:v,specularColor:u2,specularF90:h2,roughness:Bb});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(y))}const r=se().toVar("singleScatteringDielectric"),a=se().toVar("multiScatteringDielectric"),o=se().toVar("singleScatteringMetallic"),l=se().toVar("multiScatteringMetallic");this.computeMultiscattering(r,a,vy,kf,this.iridescenceF0Dielectric),this.computeMultiscattering(o,l,vy,pi.rgb,this.iridescenceF0Metallic);const c=wn(r,o,ph),u=wn(a,l,ph),h=r.add(a),f=nm.mul(h.oneMinus()),m=n.mul(1/Math.PI),g=t.mul(c).add(u.mul(m)).toVar(),x=f.mul(m).toVar();if(this.sheen===!0){const v=O_({normal:kn,viewDir:_i,roughness:Nd}),y=Uo.r.max(Uo.g).max(Uo.b).mul(v).oneMinus();g.mulAssign(y),x.mulAssign(y)}s.indirectSpecular.addAssign(g),s.indirectDiffuse.addAssign(x)}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,r=kn.dot(_i).clamp().add(t),a=Wc.mul(-16).oneMinus().negate().exp2(),o=t.sub(r.pow(a).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(o)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const n=um.dot(_i).clamp(),s=Qy({dotVH:n,f0:u2,f90:h2}),r=t.mul(FM.mul(s).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(FM));t.assign(r)}if(this.sheen===!0){const n=t.add(this.sheenSpecularDirect,this.sheenSpecularIndirect.mul(1/Math.PI));t.assign(n)}}}const jV=W(1),ZD=W(-2),Q1=W(.8),d2=W(-1),$1=W(.4),f2=W(2),eA=W(.305),p2=W(3),YV=W(.21),moe=W(4),KV=W(4),goe=W(16),yoe=le(([i])=>{const e=se(Pi(i)).toVar(),t=W(-1).toVar();return Wt(e.x.greaterThan(e.z),()=>{Wt(e.x.greaterThan(e.y),()=>{t.assign(Xr(i.x.greaterThan(0),0,3))}).Else(()=>{t.assign(Xr(i.y.greaterThan(0),1,4))})}).Else(()=>{Wt(e.z.greaterThan(e.y),()=>{t.assign(Xr(i.z.greaterThan(0),2,5))}).Else(()=>{t.assign(Xr(i.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),xoe=le(([i,e])=>{const t=$e().toVar();return Wt(e.equal(0),()=>{t.assign($e(i.z,i.y).div(Pi(i.x)))}).ElseIf(e.equal(1),()=>{t.assign($e(i.x.negate(),i.z.negate()).div(Pi(i.y)))}).ElseIf(e.equal(2),()=>{t.assign($e(i.x.negate(),i.y).div(Pi(i.z)))}).ElseIf(e.equal(3),()=>{t.assign($e(i.z.negate(),i.y).div(Pi(i.x)))}).ElseIf(e.equal(4),()=>{t.assign($e(i.x.negate(),i.z).div(Pi(i.y)))}).Else(()=>{t.assign($e(i.x,i.y).div(Pi(i.z)))}),dn(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),_oe=le(([i])=>{const e=W(0).toVar();return Wt(i.greaterThanEqual(Q1),()=>{e.assign(jV.sub(i).mul(d2.sub(ZD)).div(jV.sub(Q1)).add(ZD))}).ElseIf(i.greaterThanEqual($1),()=>{e.assign(Q1.sub(i).mul(f2.sub(d2)).div(Q1.sub($1)).add(d2))}).ElseIf(i.greaterThanEqual(eA),()=>{e.assign($1.sub(i).mul(p2.sub(f2)).div($1.sub(eA)).add(f2))}).ElseIf(i.greaterThanEqual(YV),()=>{e.assign(eA.sub(i).mul(moe.sub(p2)).div(eA.sub(YV)).add(p2))}).Else(()=>{e.assign(W(-2).mul(ru(dn(1.16,i))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),mj=le(([i,e])=>{const t=i.toVar();t.assign(dn(2,t).sub(1));const n=se(t,1).toVar();return Wt(e.equal(0),()=>{n.assign(n.zyx)}).ElseIf(e.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),gj=le(([i,e,t,n,s,r])=>{const a=W(t),o=se(e),l=Sc(_oe(a),ZD,r),c=bc(l),u=au(l),h=se(Ub(i,o,u,n,s,r)).toVar();return Wt(c.notEqual(0),()=>{const f=se(Ub(i,o,u.add(1),n,s,r)).toVar();h.assign(wn(h,f,c))}),h}),Ub=le(([i,e,t,n,s,r])=>{const a=W(t).toVar(),o=se(e),l=W(yoe(o)).toVar(),c=W(ls(KV.sub(a),0)).toVar();a.assign(ls(a,KV));const u=W(Ky(a)).toVar(),h=$e(xoe(o,l).mul(u.sub(2)).add(1)).toVar();return Wt(l.greaterThan(2),()=>{h.y.addAssign(u),l.subAssign(3)}),h.x.addAssign(l.mul(u)),h.x.addAssign(c.mul(dn(3,goe))),h.y.addAssign(dn(4,Ky(r).sub(u))),h.x.mulAssign(n),h.y.mulAssign(s),i.sample(h).grad($e(),$e())}),m2=le(({envMap:i,mipInt:e,outputDirection:t,theta:n,axis:s,CUBEUV_TEXEL_WIDTH:r,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:o})=>{const l=fc(n),c=t.mul(l).add(s.cross(t).mul(La(n))).add(s.mul(s.dot(t).mul(l.oneMinus())));return Ub(i,c,e,r,a,o)}),yj=le(({n:i,latitudinal:e,poleAxis:t,outputDirection:n,weights:s,samples:r,dTheta:a,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:h})=>{const f=se(Xr(e,t,Dh(t,n))).toVar();Wt(f.equal(se(0)),()=>{f.assign(se(n.z,0,n.x.negate()))}),f.assign(Ya(f));const m=se().toVar();return m.addAssign(s.element(0).mul(m2({theta:0,axis:f,outputDirection:n,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:h}))),ci({start:te(1),end:i},({i:g})=>{Wt(g.greaterThanEqual(r),()=>{Iq()});const x=W(a.mul(W(g))).toVar();m.addAssign(s.element(g).mul(m2({theta:x.mul(-1),axis:f,outputDirection:n,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:h}))),m.addAssign(s.element(g).mul(m2({theta:x,axis:f,outputDirection:n,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:h})))}),It(m,1)}),voe=le(([i])=>{const e=Ze(i).toVar();return e.assign(e.shiftLeft(Ze(16)).bitOr(e.shiftRight(Ze(16)))),e.assign(e.bitAnd(Ze(1431655765)).shiftLeft(Ze(1)).bitOr(e.bitAnd(Ze(2863311530)).shiftRight(Ze(1)))),e.assign(e.bitAnd(Ze(858993459)).shiftLeft(Ze(2)).bitOr(e.bitAnd(Ze(3435973836)).shiftRight(Ze(2)))),e.assign(e.bitAnd(Ze(252645135)).shiftLeft(Ze(4)).bitOr(e.bitAnd(Ze(4042322160)).shiftRight(Ze(4)))),e.assign(e.bitAnd(Ze(16711935)).shiftLeft(Ze(8)).bitOr(e.bitAnd(Ze(4278255360)).shiftRight(Ze(8)))),W(e).mul(23283064365386963e-26)}),boe=le(([i,e])=>$e(W(i).div(W(e)),voe(i))),Soe=le(([i,e,t])=>{const n=se(e).toVar(),s=W(t),r=s.mul(s).toVar(),a=Ya(se(r.mul(n.x),r.mul(n.y),n.z)).toVar(),o=a.x.mul(a.x).add(a.y.mul(a.y)),l=Xr(o.greaterThan(0),se(a.y.negate(),a.x,0).div(ya(o)),se(1,0,0)).toVar(),c=Dh(a,l).toVar(),u=ya(i.x),h=dn(2,3.14159265359).mul(i.y),f=u.mul(fc(h)).toVar(),m=u.mul(La(h)).toVar(),g=dn(.5,a.z.add(1));m.assign(g.oneMinus().mul(ya(f.mul(f).oneMinus())).add(g.mul(m)));const x=l.mul(f).add(c.mul(m)).add(a.mul(ya(ls(0,f.mul(f).add(m.mul(m)).oneMinus()))));return Ya(se(r.mul(x.x),r.mul(x.y),ls(0,x.z)))}),xj=le(({roughness:i,mipInt:e,envMap:t,N_immutable:n,GGX_SAMPLES:s,CUBEUV_TEXEL_WIDTH:r,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:o})=>{const l=se(n).toVar(),c=se(0).toVar(),u=W(0).toVar();return Wt(i.lessThan(.001),()=>{c.assign(Ub(t,l,e,r,a,o))}).Else(()=>{const h=Xr(Pi(l.z).lessThan(.999),se(0,0,1),se(1,0,0)),f=Ya(Dh(h,l)).toVar(),m=Dh(l,f).toVar();ci({start:Ze(0),end:s},({i:g})=>{const x=boe(g,s),v=Soe(x,se(0,0,1),i),y=Ya(f.mul(v.x).add(m.mul(v.y)).add(l.mul(v.z))),b=Ya(y.mul(Yl(l,y).mul(2)).sub(l)),S=ls(Yl(l,b),0);Wt(S.greaterThan(0),()=>{const T=Ub(t,b,e,r,a,o);c.addAssign(T.mul(S)),u.addAssign(S)})}),Wt(u.greaterThan(0),()=>{c.assign(c.div(u))})}),It(c,1)}),Vd=4,ZV=[.125,.215,.35,.446,.526,.582],im=20,Toe=512,F_=new Dr(-1,1,1,-1,0,1),Aoe=new Ci(90,1),JV=new Ye;let g2=null,y2=0,x2=0;const Moe=new z,YM=new WeakMap,Eoe=[3,1,5,0,4,2],_2=mj(yi(),Ua("faceIndex")).normalize(),$C=se(_2.x,_2.y,_2.z);let _j=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,n=.1,s=100,r={}){const{size:a=256,position:o=Moe,renderTarget:l=null}=r;if(this._setSize(a),this._hasInitialized===!1){Se('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const u=l||this._allocateTarget();return r.renderTarget=u,this.fromSceneAsync(e,t,n,s,r),u}g2=this._renderer.getRenderTarget(),y2=this._renderer.getActiveCubeFace(),x2=this._renderer.getActiveMipmapLevel();const c=l||this._allocateTarget();return c.depthBuffer=!0,this._init(c),this._sceneToCubeUV(e,n,s,c,o),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}async fromSceneAsync(e,t=0,n=.1,s=100,r={}){return oi('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(e,t,n,s,r)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){Se('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return oi('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){Se("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return oi('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=$V(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=e5(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===Sa||e.mapping===el?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(g2,y2,x2),e.scissorTest=!1,E0(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),g2=this._renderer.getRenderTarget(),y2=this._renderer.getActiveCubeFace(),x2=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTarget();return this._init(n),this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return QV(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=QV(e.width,e.height);const{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=Coe(t)),this._blurMaterial=woe(t,e.width,e.height),this._ggxMaterial=Roe(t,e.width,e.height)}}async _compileMaterial(e){const t=new Kn(new pn,e);await this._renderer.compile(t,F_)}_sceneToCubeUV(e,t,n,s,r){const a=Aoe;a.near=t,a.far=n;const o=[1,1,1,1,-1,1],l=[1,-1,1,-1,1,-1],c=this._renderer,u=c.autoClear;c.getClearColor(JV),c.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new Kn(new Su,new Ts({name:"PMREM.Background",side:hi,depthWrite:!1,depthTest:!1})));const h=this._backgroundBox,f=h.material;let m=!1;const g=e.background;g?g.isColor&&(f.color.copy(g),e.background=null,m=!0):(f.color.copy(JV),m=!0),c.setRenderTarget(s),c.clear(),m&&c.render(h,a);for(let x=0;x<6;x++){const v=x%3;v===0?(a.up.set(0,o[x],0),a.position.set(r.x,r.y,r.z),a.lookAt(r.x+l[x],r.y,r.z)):v===1?(a.up.set(0,0,o[x]),a.position.set(r.x,r.y,r.z),a.lookAt(r.x,r.y+l[x],r.z)):(a.up.set(0,o[x],0),a.position.set(r.x,r.y,r.z),a.lookAt(r.x,r.y,r.z+l[x]));const y=this._cubeSize;E0(s,v*y,x>2?y:0,y,y),c.render(e,a)}c.autoClear=u,e.background=g}_textureToCubeUV(e,t){const n=this._renderer,s=e.mapping===Sa||e.mapping===el;s?this._cubemapMaterial===null&&(this._cubemapMaterial=$V(e)):this._equirectMaterial===null&&(this._equirectMaterial=e5(e));const r=s?this._cubemapMaterial:this._equirectMaterial;r.fragmentNode.value=e;const a=this._lodMeshes[0];a.material=r;const o=this._cubeSize;E0(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,F_)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const s=this._lodMeshes.length;for(let r=1;r<s;r++)this._applyGGXFilter(e,r-1,r);t.autoClear=n}_applyGGXFilter(e,t,n){const s=this._renderer,r=this._pingPongRenderTarget,a=this._ggxMaterial,o=this._lodMeshes[n];o.material=a;const l=YM.get(a),c=n/(this._lodMeshes.length-1),u=t/(this._lodMeshes.length-1),h=Math.sqrt(c*c-u*u),f=0+c*1.25,m=h*f,{_lodMax:g}=this,x=this._sizeLods[n],v=3*x*(n>g-Vd?n-g+Vd:0),y=4*(this._cubeSize-x);e.texture.frame=(e.texture.frame||0)+1,l.envMap.value=e.texture,l.roughness.value=m,l.mipInt.value=g-t,E0(r,v,y,3*x,2*x),s.setRenderTarget(r),s.render(o,F_),r.texture.frame=(r.texture.frame||0)+1,l.envMap.value=r.texture,l.roughness.value=0,l.mipInt.value=g-n,E0(e,v,y,3*x,2*x),s.setRenderTarget(e),s.render(o,F_)}_blur(e,t,n,s,r){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,s,"latitudinal",r),this._halfBlur(a,e,n,n,s,"longitudinal",r)}_halfBlur(e,t,n,s,r,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&De("blur direction must be either latitudinal or longitudinal!");const u=3,h=this._lodMeshes[s];h.material=c;const f=YM.get(c),m=this._sizeLods[n]-1,g=isFinite(r)?Math.PI/(2*m):2*Math.PI/(2*im-1),x=r/g,v=isFinite(r)?1+Math.floor(u*x):im;v>im&&Se(`sigmaRadians, ${r}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${im}`);const y=[];let b=0;for(let w=0;w<im;++w){const N=w/x,E=Math.exp(-N*N/2);y.push(E),w===0?b+=E:w<v&&(b+=2*E)}for(let w=0;w<y.length;w++)y[w]=y[w]/b;e.texture.frame=(e.texture.frame||0)+1,f.envMap.value=e.texture,f.samples.value=v,f.weights.array=y,f.latitudinal.value=a==="latitudinal"?1:0,o&&(f.poleAxis.value=o);const{_lodMax:S}=this;f.dTheta.value=g,f.mipInt.value=S-n;const T=this._sizeLods[s],M=3*T*(s>S-Vd?s-S+Vd:0),C=4*(this._cubeSize-T);E0(t,M,C,3*T,2*T),l.setRenderTarget(t),l.render(h,F_)}};function Coe(i){const e=[],t=[],n=[];let s=i;const r=i-Vd+1+ZV.length;for(let a=0;a<r;a++){const o=Math.pow(2,s);e.push(o);let l=1/o;a>i-Vd?l=ZV[a-i+Vd-1]:a===0&&(l=0),t.push(l);const c=1/(o-2),u=-c,h=1+c,f=[u,u,h,u,h,h,u,u,h,h,u,h],m=6,g=6,x=3,v=2,y=1,b=new Float32Array(x*g*m),S=new Float32Array(v*g*m),T=new Float32Array(y*g*m);for(let C=0;C<m;C++){const w=C%3*2/3-1,N=C>2?0:-1,E=[w,N,0,w+2/3,N,0,w+2/3,N+1,0,w,N,0,w+2/3,N+1,0,w,N+1,0],B=Eoe[C];b.set(E,x*g*B),S.set(f,v*g*B);const U=[B,B,B,B,B,B];T.set(U,y*g*B)}const M=new pn;M.setAttribute("position",new Nn(b,x)),M.setAttribute("uv",new Nn(S,v)),M.setAttribute("faceIndex",new Nn(T,y)),n.push(new Kn(M,null)),s>Vd&&s--}return{lodMeshes:n,sizeLods:e,sigmas:t}}function QV(i,e){const t={magFilter:Jt,minFilter:Jt,generateMipmaps:!1,type:ln,format:ii,colorSpace:Jr},n=new Si(i,e,t);return n.texture.mapping=du,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function E0(i,e,t,n,s){i.viewport.set(e,t,n,s),i.scissor.set(e,t,n,s)}function ew(i){const e=new Tn;return e.depthTest=!1,e.depthWrite=!1,e.blending=Nr,e.name=`PMREM_${i}`,e}function woe(i,e,t){const n=da(new Array(im).fill(0)),s=Yt(new z(0,1,0)),r=Yt(0),a=W(im),o=Yt(0),l=Yt(1),c=jn(),u=Yt(0),h=W(1/e),f=W(1/t),m=W(i),g={n:a,latitudinal:o,weights:n,poleAxis:s,outputDirection:$C,dTheta:r,samples:l,envMap:c,mipInt:u,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:m},x=ew("blur");return x.fragmentNode=yj({...g,latitudinal:o.equal(1)}),YM.set(x,g),x}function Roe(i,e,t){const n=jn(),s=Yt(0),r=Yt(0),a=W(1/e),o=W(1/t),l=W(i),c={envMap:n,roughness:s,mipInt:r,CUBEUV_TEXEL_WIDTH:a,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:l},u=ew("ggx");return u.fragmentNode=xj({...c,N_immutable:$C,GGX_SAMPLES:Ze(Toe)}),YM.set(u,c),u}function $V(i){const e=ew("cubemap");return e.fragmentNode=za(i,$C),e}function e5(i){const e=ew("equirect");return e.fragmentNode=jn(i,mP($C),0),e}const t5=new WeakMap;function Noe(i){const e=Math.log2(i)-2,t=1/i;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function Boe(i,e,t){const n=Doe(e);let s=n.get(i);if((s!==void 0?s.pmremVersion:-1)!==i.pmremVersion){const a=i.image;if(i.isCubeTexture)if(Loe(a))s=t.fromCubemap(i,s);else return null;else if(Uoe(a))s=t.fromEquirectangular(i,s);else return null;s.pmremVersion=i.pmremVersion,n.set(i,s)}return s.texture}function Doe(i){let e=t5.get(i);return e===void 0&&(e=new WeakMap,t5.set(i,e)),e}class vj extends ti{static get type(){return"PMREMNode"}constructor(e,t=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const s=new In;s.isRenderTargetTexture=!0,this._texture=jn(s),this._width=Yt(0),this._height=Yt(0),this._maxMip=Yt(0),this.updateBeforeType=on.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=Noe(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,s=this._value;n!==s.pmremVersion&&(s.isPMREMTexture===!0?t=s:t=Boe(s,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new _j(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this,e)),t=$I.mul(se(t.x,t.y.negate(),t.z));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),gj(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function Loe(i){if(i==null)return!1;let e=0;const t=6;for(let n=0;n<t;n++)i[n]!==void 0&&e++;return e===t}function Uoe(i){return i==null?!1:i.height>0}const bP=fn(vj).setParameterLength(1,3),n5=new WeakMap;class bj extends Rg{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const h=n.isTextureNode?n.value:t[n.property];let f=n5.get(h);f===void 0&&(f=bP(h),n5.set(h,f)),n=f}const r=t.useAnisotropy===!0||t.anisotropy>0?YX:kn,a=n.context(i5(Wc,r)).mul(VA),o=n.context(Ioe(ip)).mul(Math.PI).mul(VA),l=Ty(a),c=Ty(o);e.context.radiance.addAssign(l),e.context.iblIrradiance.addAssign(c);const u=e.context.lightingModel.clearcoatRadiance;if(u){const h=n.context(i5(Bb,um)).mul(VA),f=Ty(h);u.addAssign(f)}}}const i5=(i,e)=>{let t=null;return{getUV:()=>(t===null&&(t=_i.negate().reflect(e),t=LI(i).mix(t,e).normalize(),t=t.transformDirection(ll)),t),getTextureLevel:()=>i}},Ioe=i=>({getUV:()=>i,getTextureLevel:()=>W(1)}),Poe=new Tg;class SP extends Tn{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(Poe),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new bj(t):null}setupLightingModel(){return new QC}setupSpecular(){const e=wn(se(.04),pi.rgb,ph);kf.assign(se(.04)),cm.assign(e),vy.assign(1)}setupVariants(){const e=this.metalnessNode?W(this.metalnessNode):sq;ph.assign(e);let t=this.roughnessNode?W(this.roughnessNode):iq;t=xP({roughness:t}),Wc.assign(t),this.setupSpecular(),nm.assign(pi.rgb.mul(e.oneMinus()))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const Ooe=new yo;class tw extends SP{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(Ooe),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?W(this.iorNode):xq;Vv.assign(e),kf.assign(fo(DI(Vv.sub(1).div(Vv.add(1))).mul(nq),se(1)).mul(qD)),cm.assign(wn(kf,pi.rgb,ph)),vy.assign(wn(qD,1,ph))}setupLightingModel(){return new QC(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?W(this.clearcoatNode):aq,n=this.clearcoatRoughnessNode?W(this.clearcoatRoughnessNode):oq;FM.assign(t),Bb.assign(xP({roughness:n}))}if(this.useSheen){const t=this.sheenNode?se(this.sheenNode):uq,n=this.sheenRoughnessNode?W(this.sheenRoughnessNode):hq;Uo.assign(t),Nd.assign(n)}if(this.useIridescence){const t=this.iridescenceNode?W(this.iridescenceNode):fq,n=this.iridescenceIORNode?W(this.iridescenceIORNode):pq,s=this.iridescenceThicknessNode?W(this.iridescenceThicknessNode):mq;LC.assign(t),GM.assign(n),zM.assign(s)}if(this.useAnisotropy){const t=(this.anisotropyNode?$e(this.anisotropyNode):dq).toVar();Md.assign(t.length()),Wt(Md.equal(0),()=>{t.assign($e(1,0))}).Else(()=>{t.divAssign($e(Md)),Md.assign(Md.saturate())}),VM.assign(Md.pow2().mix(Wc.pow2(),1)),zv.assign(hm[0].mul(t.x).add(hm[1].mul(t.y))),Em.assign(hm[1].mul(t.x).sub(hm[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?W(this.transmissionNode):gq,n=this.thicknessNode?W(this.thicknessNode):yq,s=this.attenuationDistanceNode?W(this.attenuationDistanceNode):_q,r=this.attenuationColorNode?se(this.attenuationColorNode):vq;if(kM.assign(t),pI.assign(n),mI.assign(s),gI.assign(r),this.useDispersion){const a=this.dispersionNode?W(this.dispersionNode):Sq;yI.assign(a)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?se(this.clearcoatNormalNode):lq}setup(e){e.context.setupClearcoatNormal=()=>Sy(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}class Foe extends QC{constructor(e=!1,t=!1,n=!1,s=!1,r=!1,a=!1,o=!1){super(e,t,n,s,r,a),this.useSSS=o}direct({lightDirection:e,lightColor:t,reflectedLight:n},s){if(this.useSSS===!0){const r=s.material,{thicknessColorNode:a,thicknessDistortionNode:o,thicknessAmbientNode:l,thicknessAttenuationNode:c,thicknessPowerNode:u,thicknessScaleNode:h}=r,f=e.add(kn.mul(o)).normalize(),m=W(_i.dot(f.negate()).saturate().pow(u).mul(h)),g=se(m.add(l).mul(a));n.directDiffuse.addAssign(g.mul(c.mul(t)))}super.direct({lightDirection:e,lightColor:t,reflectedLight:n},s)}}class Goe extends tw{static get type(){return"MeshSSSNodeMaterial"}constructor(e){super(e),this.thicknessColorNode=null,this.thicknessDistortionNode=W(.1),this.thicknessAmbientNode=W(0),this.thicknessAttenuationNode=W(.1),this.thicknessPowerNode=W(2),this.thicknessScaleNode=W(10)}get useSSS(){return this.thicknessColorNode!==null}setupLightingModel(){return new Foe(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion,this.useSSS)}copy(e){return this.thicknessColorNode=e.thicknessColorNode,this.thicknessDistortionNode=e.thicknessDistortionNode,this.thicknessAmbientNode=e.thicknessAmbientNode,this.thicknessAttenuationNode=e.thicknessAttenuationNode,this.thicknessPowerNode=e.thicknessPowerNode,this.thicknessScaleNode=e.thicknessScaleNode,super.copy(e)}}const zoe=le(({normal:i,lightDirection:e,builder:t})=>{const n=i.dot(e),s=$e(n.mul(.5).add(.5),0);if(t.material.gradientMap){const r=ih("gradientMap","texture").context({getUV:()=>s});return se(r.r)}else{const r=s.fwidth().mul(.5);return wn(se(.7),se(1),nl(W(.7).sub(r.x),W(.7).add(r.x),s.x))}});class Voe extends Gx{direct({lightDirection:e,lightColor:t,reflectedLight:n},s){const r=zoe({normal:XC,lightDirection:e,builder:s}).mul(t);n.directDiffuse.addAssign(r.mul(sg({diffuseColor:pi.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:s}=e.context;s.indirectDiffuse.addAssign(n.mul(sg({diffuseColor:pi}))),s.indirectDiffuse.mulAssign(t)}}const Hoe=new hC;class Sj extends Tn{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Hoe),this.setValues(e)}setupLightingModel(){return new Voe}}const Tj=le(()=>{const i=se(_i.z,0,_i.x.negate()).normalize(),e=_i.cross(i);return $e(i.dot(kn),e.dot(kn)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),koe=new gC;class Aj extends Tn{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(koe),this.setValues(e)}setupVariants(e){const t=Tj;let n;e.material.matcap?n=ih("matcap","texture").context({getUV:()=>t}):n=se(wn(.2,.8,t.y)),pi.rgb.mulAssign(n.rgb)}}class Mj extends ti{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if(this.getNodeType(e)==="vec2"){const r=t.cos(),a=t.sin();return DC(r,a,a.negate(),r).mul(n)}else{const r=t,a=rf(It(1,0,0,0),It(0,fc(r.x),La(r.x).negate(),0),It(0,La(r.x),fc(r.x),0),It(0,0,0,1)),o=rf(It(fc(r.y),0,La(r.y),0),It(0,1,0,0),It(La(r.y).negate(),0,fc(r.y),0),It(0,0,0,1)),l=rf(It(fc(r.z),La(r.z).negate(),0,0),It(La(r.z),fc(r.z),0,0),It(0,0,1,0),It(0,0,0,1));return a.mul(o).mul(l).mul(It(n,1)).xyz}}}const iT=fn(Mj).setParameterLength(2),Woe=new DS;class TP extends Tn{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(Woe),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,{positionNode:s,rotationNode:r,scaleNode:a,sizeAttenuation:o}=this,l=gu.mul(se(s||0));let c=$e(Pl[0].xyz.length(),Pl[1].xyz.length());a!==null&&(c=c.mul($e(a))),n.isPerspectiveCamera&&o===!1&&(c=c.mul(l.z.negate()));let u=zr.xy;if(t.center&&t.center.isVector2===!0){const m=Tre("center","vec2",t);u=u.sub(m.sub(.5))}u=u.mul(c);const h=W(r||cq),f=iT(u,h);return It(l.xy.add(f),l.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const Xoe=new Nx,qoe=new Ae;class Ej extends TP{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(Xoe),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return gu.mul(se(e||ss)).xyz}setupVertexSprite(e){const{material:t,camera:n}=e,{rotationNode:s,scaleNode:r,sizeNode:a,sizeAttenuation:o}=this;let l=super.setupVertex(e);if(t.isNodeMaterial!==!0)return l;let c=a!==null?$e(a):bq;c=c.mul(YI),n.isPerspectiveCamera&&o===!0&&(c=c.mul(joe.div(As.z.negate()))),r&&r.isNode&&(c=c.mul($e(r)));let u=zr.xy;if(s&&s.isNode){const h=W(s);u=iT(u,h)}return u=u.mul(c),u=u.div(KI.div(2)),u=u.mul(l.w),l=l.add(It(u,0,0)),l}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const joe=Yt(1).onFrameUpdate(function({renderer:i}){const e=i.getSize(qoe);this.value=.5*e.y});class Yoe extends Gx{constructor(){super(),this.shadowNode=W(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){pi.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(pi.rgb)}}const Koe=new lC;class Cj extends Tn{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(Koe),this.setValues(e)}setupLightingModel(){return new Yoe}}const G_=xc("vec3"),s5=xc("vec3"),r5=xc("vec3");class Zoe extends Gx{constructor(){super()}start(e){const{material:t}=e,n=xc("vec3"),s=xc("vec3");Wt(Wv.sub(Zo).length().greaterThan(SX.mul(2)),()=>{n.assign(Wv),s.assign(Zo)}).Else(()=>{n.assign(Zo),s.assign(Wv)});const r=s.sub(n),a=Yt("int").onRenderUpdate(({material:h})=>h.steps),o=r.length().div(a).toVar(),l=r.normalize().toVar(),c=W(0).toVar(),u=se(1).toVar();t.offsetNode&&c.addAssign(t.offsetNode.mul(o)),ci(a,()=>{const h=n.add(l.mul(c)),f=ll.mul(It(h,1)).xyz;t.depthNode!==null&&(s5.assign(Jy(hP(f.z,th,nh))),e.context.sceneDepthNode=Jy(t.depthNode).toVar()),e.context.positionWorld=h,e.context.shadowPositionWorld=h,e.context.positionView=f,G_.assign(0);let m;t.scatteringNode&&(m=t.scatteringNode({positionRay:h})),super.start(e),m&&G_.mulAssign(m);const g=G_.mul(.01).negate().mul(o).exp();u.mulAssign(g),c.addAssign(o)}),r5.addAssign(u.saturate().oneMinus())}scatteringLight(e,t){const n=t.context.sceneDepthNode;n?Wt(n.greaterThanEqual(s5),()=>{G_.addAssign(e)}):G_.addAssign(e)}direct({lightNode:e,lightColor:t},n){if(e.light.distance===void 0)return;const s=t.xyz.toVar();s.mulAssign(e.shadowNode),this.scatteringLight(s,n)}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:s},r){const a=t.add(n).sub(s),o=t.sub(n).sub(s),l=t.sub(n).add(s),c=t.add(n).add(s),u=r.context.positionView,h=e.xyz.mul(aoe({P:u,p0:a,p1:o,p2:l,p3:c})).pow(1.5);this.scatteringLight(h,r)}finish(e){e.context.outgoingLight.assign(r5)}}class Joe extends Tn{static get type(){return"VolumeNodeMaterial"}constructor(e){super(),this.isVolumeNodeMaterial=!0,this.steps=25,this.offsetNode=null,this.scatteringNode=null,this.lights=!0,this.transparent=!0,this.side=hi,this.depthTest=!1,this.depthWrite=!1,this.setValues(e)}setupLightingModel(){return new Zoe}}let Qoe=class{constructor(e,t,n){this.renderer=e,this.nodes=t,this.info=n,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(t,n),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}};class Ac{constructor(){this.weakMaps={}}_getWeakMap(e){const t=e.length;let n=this.weakMaps[t];return n===void 0&&(n=new WeakMap,this.weakMaps[t]=n),n}get(e){let t=this._getWeakMap(e);for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let n=this._getWeakMap(e);for(let s=0;s<e.length-1;s++){const r=e[s];n.has(r)===!1&&n.set(r,new WeakMap),n=n.get(r)}return n.set(e[e.length-1],t),this}delete(e){let t=this._getWeakMap(e);for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return!1;return t.delete(e[e.length-1])}}let $oe=0;function ele(i){const e=Object.keys(i);let t=Object.getPrototypeOf(i);for(;t;){const n=Object.getOwnPropertyDescriptors(t);for(const s in n)if(n[s]!==void 0){const r=n[s];r&&typeof r.get=="function"&&e.push(s)}t=Object.getPrototypeOf(t)}return e}class tle{constructor(e,t,n,s,r,a,o,l,c,u){this.id=$oe++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=s,this.material=r,this.scene=a,this.camera=o,this.lightsNode=l,this.context=c,this.geometry=s.geometry,this.version=r.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=u,this.clippingContextCacheKey=u!==null?u.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getIndirectOffset(){return this._geometries.getIndirectOffset(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],s=new Set,r={};for(const a of e){let o;if(a.node&&a.node.attribute?o=a.node.attribute:(o=t.getAttribute(a.name),r[a.name]=o.version),o===void 0)continue;n.push(o);const l=o.isInterleavedBufferAttribute?o.data:o;s.add(l)}return this.attributes=n,this.attributesId=r,this.vertexBuffers=Array.from(s.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:s,drawRange:r}=this,a=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),o=this.getIndex(),l=o!==null;let c=1;if(n.isInstancedBufferGeometry===!0?c=n.instanceCount:e.count!==void 0&&(c=Math.max(0,e.count)),c===0)return null;if(a.instanceCount=c,e.isBatchedMesh===!0)return a;let u=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(u=2);let h=r.start*u,f=(r.start+r.count)*u;s!==null&&(h=Math.max(h,s.start*u),f=Math.min(f,(s.start+s.count)*u));const m=n.attributes.position;let g=1/0;l?g=o.count:m!=null&&(g=m.count),h=Math.max(h,0),f=Math.min(f,g);const x=f-h;return x<0||x===1/0?null:(a.vertexCount=x,a.firstVertex=h,a)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const s=e.attributes[n];t+=n+",",s.data&&(t+=s.data.stride+","),s.offset&&(t+=s.offset+","),s.itemSize&&(t+=s.itemSize+","),s.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const s=e.morphAttributes[n];t+="morph-"+n+",";for(let r=0,a=s.length;r<a;r++){const o=s[r];t+=o.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:n}=this;let s=t.customProgramCacheKey();for(const r of ele(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(r))continue;const a=t[r];let o;if(a!==null){const l=typeof a;l==="number"?o=a!==0?"1":"0":l==="object"?(o="{",a.isTexture&&(o+=a.mapping,n.backend.isWebGPUBackend===!0&&(o+=a.magFilter,o+=a.minFilter,o+=a.wrapS,o+=a.wrapT,o+=a.wrapR)),o+="}"):o=String(a)}else o=String(a);s+=o+","}return s+=this.clippingContextCacheKey+",",e.geometry&&(s+=this.getGeometryCacheKey()),e.skeleton&&(s+=e.skeleton.bones.length+","),e.isBatchedMesh&&(s+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(s+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(s+=e.uuid+","),s+=this.context.id+",",s+=e.receiveShadow+",",Px(s)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const n=this.geometry.getAttribute(t);if(n===void 0||e[t]!==n.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=_y(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=_y(e,1)),e=_y(e,this.camera.id,this.renderer.contextNode.id,this.renderer.contextNode.version),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const Vp=[];class nle{constructor(e,t,n,s,r,a){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=s,this.bindings=r,this.info=a,this.chainMaps={}}get(e,t,n,s,r,a,o,l){const c=this.getChainMap(l);Vp[0]=e,Vp[1]=t,Vp[2]=a,Vp[3]=r;let u=c.get(Vp);return u===void 0?(u=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,s,r,a,o,l),c.set(Vp,u)):(u.updateClipping(o),u.needsGeometryUpdate&&u.setGeometry(e.geometry),(u.version!==t.version||u.needsUpdate)&&(u.initialCacheKey!==u.getCacheKey()?(u.dispose(),u=this.get(e,t,n,s,r,a,o,l)):u.version=t.version)),Vp.length=0,u}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Ac)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,s,r,a,o,l,c,u,h){const f=this.getChainMap(h),m=new tle(e,t,n,s,r,a,o,l,c,u);return m.onDispose=()=>{this.pipelines.delete(m),this.bindings.deleteForRender(m),this.nodes.delete(m),f.delete(m.getChainArray())},m}}class sp{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const Ol={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Bd=16,ile=211,sle=212;class rle extends sp{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(n.version===void 0)t===Ol.VERTEX?this.backend.createAttribute(e):t===Ol.INDEX?this.backend.createIndexAttribute(e):t===Ol.STORAGE?this.backend.createStorageAttribute(e):t===Ol.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const s=this._getBufferAttribute(e);(n.version<s.version||s.usage===hh)&&(this.backend.updateAttribute(e),n.version=s.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function wj(i){return i.index!==null?i.index.version:i.attributes.position.version}function a5(i){const e=[],t=i.index,n=i.attributes.position;if(t!==null){const r=t.array;for(let a=0,o=r.length;a<o;a+=3){const l=r[a+0],c=r[a+1],u=r[a+2];e.push(l,c,c,u,u,l)}}else{const r=n.array;for(let a=0,o=r.length/3-1;a<o;a+=3){const l=a+0,c=a+1,u=a+2;e.push(l,c,c,u,u,l)}}const s=new(mU(e)?wS:CS)(e,1);return s.version=wj(i),s}class ale extends sp{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,n=this.get(t);n.initialized=!0,this.info.memory.geometries++;const s=()=>{this.info.memory.geometries--;const r=t.index,a=e.getAttributes();r!==null&&this.attributes.delete(r);for(const l of a)this.attributes.delete(l);const o=this.wireframes.get(t);o!==void 0&&this.attributes.delete(o),t.removeEventListener("dispose",s),this._geometryDisposeListeners.delete(t)};t.addEventListener("dispose",s),this._geometryDisposeListeners.set(t,s)}updateAttributes(e){const t=e.getAttributes();for(const r of t)r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute?this.updateAttribute(r,Ol.STORAGE):this.updateAttribute(r,Ol.VERTEX);const n=this.getIndex(e);n!==null&&this.updateAttribute(n,Ol.INDEX);const s=e.geometry.indirect;s!==null&&this.updateAttribute(s,Ol.INDIRECT)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndirectOffset(e){return e.geometry.indirectOffset}getIndex(e){const{geometry:t,material:n}=e;let s=t.index;if(n.wireframe===!0){const r=this.wireframes;let a=r.get(t);a===void 0?(a=a5(t),r.set(t,a)):a.version!==wj(t)&&(this.attributes.delete(a),a=a5(t),r.set(t,a)),s=a}return s}dispose(){for(const[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener("dispose",t);this._geometryDisposeListeners.clear()}}class ole{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):De("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class Rj{constructor(e){this.cacheKey=e,this.usedTimes=0}}class lle extends Rj{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}}class cle extends Rj{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let ule=0;class v2{constructor(e,t,n,s=null,r=null){this.id=ule++,this.code=e,this.stage=t,this.name=n,this.transforms=s,this.attributes=r,this.usedTimes=0}}class hle extends sp{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,s=this.get(e);if(this._needsComputeUpdate(e)){const r=s.pipeline;r&&(r.usedTimes--,r.computeProgram.usedTimes--);const a=this.nodes.getForCompute(e);let o=this.programs.compute.get(a.computeShader);o===void 0&&(r&&r.computeProgram.usedTimes===0&&this._releaseProgram(r.computeProgram),o=new v2(a.computeShader,"compute",e.name,a.transforms,a.nodeAttributes),this.programs.compute.set(a.computeShader,o),n.createProgram(o));const l=this._getComputeCacheKey(e,o);let c=this.caches.get(l);c===void 0&&(r&&r.usedTimes===0&&this._releasePipeline(r),c=this._getComputePipeline(e,o,l,t)),c.usedTimes++,o.usedTimes++,s.version=e.version,s.pipeline=c}return s.pipeline}getForRender(e,t=null){const{backend:n}=this,s=this.get(e);if(this._needsRenderUpdate(e)){const r=s.pipeline;r&&(r.usedTimes--,r.vertexProgram.usedTimes--,r.fragmentProgram.usedTimes--);const a=e.getNodeBuilderState(),o=e.material?e.material.name:"";let l=this.programs.vertex.get(a.vertexShader);l===void 0&&(r&&r.vertexProgram.usedTimes===0&&this._releaseProgram(r.vertexProgram),l=new v2(a.vertexShader,"vertex",o),this.programs.vertex.set(a.vertexShader,l),n.createProgram(l));let c=this.programs.fragment.get(a.fragmentShader);c===void 0&&(r&&r.fragmentProgram.usedTimes===0&&this._releaseProgram(r.fragmentProgram),c=new v2(a.fragmentShader,"fragment",o),this.programs.fragment.set(a.fragmentShader,c),n.createProgram(c));const u=this._getRenderCacheKey(e,l,c);let h=this.caches.get(u);h===void 0?(r&&r.usedTimes===0&&this._releasePipeline(r),h=this._getRenderPipeline(e,l,c,u,t)):e.pipeline=h,h.usedTimes++,l.usedTimes++,c.usedTimes++,s.pipeline=h}return s.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,s){n=n||this._getComputeCacheKey(e,t);let r=this.caches.get(n);return r===void 0&&(r=new cle(n,t),this.caches.set(n,r),this.backend.createComputePipeline(r,s)),r}_getRenderPipeline(e,t,n,s,r){s=s||this._getRenderCacheKey(e,t,n);let a=this.caches.get(s);return a===void 0&&(a=new lle(s,t,n),this.caches.set(s,a),e.pipeline=a,this.backend.createRenderPipeline(e,r)),a}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class dle extends sp{constructor(e,t,n,s,r,a){super(),this.backend=e,this.textures=n,this.pipelines=r,this.attributes=s,this.nodes=t,this.info=a,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const n of t){const s=this.get(n);s.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),s.bindGroup=n)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t){const s=this.get(n);s.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),s.bindGroup=n)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t)this.backend.deleteBindGroupData(n),this.delete(n)}deleteForRender(e){const t=e.getBindings();for(const n of t)this.backend.deleteBindGroupData(n),this.delete(n)}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){const n=t.attribute,s=n.isIndirectStorageBufferAttribute?Ol.INDIRECT:Ol.STORAGE;this.attributes.update(n,s)}}_update(e,t){const{backend:n}=this;let s=!1,r=!0,a=0,o=0;for(const l of e.bindings)if(this.nodes.updateGroup(l)!==!1){if(l.isStorageBuffer){const u=l.attribute,h=u.isIndirectStorageBufferAttribute?Ol.INDIRECT:Ol.STORAGE;this.attributes.update(u,h)}if(l.isUniformBuffer)l.update()&&n.updateBinding(l);else if(l.isSampledTexture){const u=l.update(),h=l.texture,f=this.textures.get(h);if(u&&(this.textures.updateTexture(h),l.generation!==f.generation&&(l.generation=f.generation,s=!0,r=!1)),n.get(h).externalTexture!==void 0||f.isDefaultTexture?r=!1:(a=a*10+h.id,o+=h.version),h.isStorageTexture===!0&&h.mipmapsAutoUpdate===!0){const g=this.get(h);l.store===!0?g.needsMipmap=!0:this.textures.needsMipmaps(h)&&g.needsMipmap===!0&&(this.backend.generateMipmaps(h),g.needsMipmap=!1)}}else if(l.isSampler&&l.update()){const h=this.textures.updateSampler(l.texture);l.samplerKey!==h&&(l.samplerKey=h,s=!0,r=!1)}}s===!0&&this.backend.updateBindings(e,t,r?a:0,o)}}function fle(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?i.z-e.z:i.id-e.id}function o5(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function l5(i){return(i.transmission>0||i.transmissionNode&&i.transmissionNode.isNode)&&i.side===Ps&&i.forceSinglePass===!1}class ple{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,s,r,a,o){let l=this.renderItems[this.renderItemsIndex];return l===void 0?(l={id:e.id,object:e,geometry:t,material:n,groupOrder:s,renderOrder:e.renderOrder,z:r,group:a,clippingContext:o},this.renderItems[this.renderItemsIndex]=l):(l.id=e.id,l.object=e,l.geometry=t,l.material=n,l.groupOrder=s,l.renderOrder=e.renderOrder,l.z=r,l.group=a,l.clippingContext=o),this.renderItemsIndex++,l}push(e,t,n,s,r,a,o){const l=this.getNextRenderItem(e,t,n,s,r,a,o);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(l5(n)&&this.transparentDoublePass.push(l),this.transparent.push(l)):this.opaque.push(l)}unshift(e,t,n,s,r,a,o){const l=this.getNextRenderItem(e,t,n,s,r,a,o);n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(l5(n)&&this.transparentDoublePass.unshift(l),this.transparent.unshift(l)):this.opaque.unshift(l)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||fle),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||o5),this.transparent.length>1&&this.transparent.sort(t||o5)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const n=this.renderItems[e];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null,n.clippingContext=null}}}const z_=[];class mle{constructor(e){this.lighting=e,this.lists=new Ac}get(e,t){const n=this.lists;z_[0]=e,z_[1]=t;let s=n.get(z_);return s===void 0&&(s=new ple(this.lighting,e,t),n.set(z_,s)),z_.length=0,s}dispose(){this.lists=new Ac}}let gle=0;class yle{constructor(){this.id=gle++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new un,this.scissor=!1,this.scissorValue=new un,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return Nj(this)}}function Nj(i){const{textures:e,activeCubeFace:t,activeMipmapLevel:n}=i,s=[t,n];for(const r of e)s.push(r.id);return Eg(s)}const C0=[],xle=new fu,_le=new Cx;class vle{constructor(){this.chainMaps={}}get(e,t,n=null,s=null){C0[0]=e,C0[1]=t,s!==null&&(C0[2]=s);let r;if(n===null)r="default";else{const l=n.texture.format;r=`${n.textures.length}:${l}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const a=this._getChainMap(r);let o=a.get(C0);return o===void 0&&(o=new yle,a.set(C0,o)),C0.length=0,n!==null&&(o.sampleCount=n.samples===0?1:n.samples),o}getForClear(e=null){return this.get(xle,_le,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Ac)}dispose(){this.chainMaps={}}}const ble=new z;class Sle extends sp{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e,t=0){const n=this.get(e),s=e.samples===0?1:e.samples,r=n.depthTextureMips||(n.depthTextureMips={}),a=e.textures,o=this.getSize(a[0]),l=o.width>>t,c=o.height>>t;let u=e.depthTexture||r[t];const h=e.depthBuffer===!0||e.stencilBuffer===!0;let f=!1;u===void 0&&h&&(u=new tr,u.format=e.stencilBuffer?kr:lr,u.type=e.stencilBuffer?ja:Jn,u.image.width=l,u.image.height=c,u.image.depth=o.depth,u.renderTarget=e,u.isArrayTexture=e.multiview===!0&&o.depth>1,r[t]=u),(n.width!==o.width||o.height!==n.height)&&(f=!0,u&&(u.needsUpdate=!0,u.image.width=l,u.image.height=c,u.image.depth=u.isArrayTexture?u.image.depth:1)),n.width=o.width,n.height=o.height,n.textures=a,n.depthTexture=u||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==s&&(f=!0,u&&(u.needsUpdate=!0),n.sampleCount=s);const m={sampleCount:s};if(e.isXRRenderTarget!==!0){for(let g=0;g<a.length;g++){const x=a[g];f&&(x.needsUpdate=!0),this.updateTexture(x,m)}u&&this.updateTexture(u,m)}n.initialized!==!0&&(n.initialized=!0,n.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener("dispose",n.onDispose))}updateTexture(e,t={}){const n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;const s=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,r=this.backend;if(s&&n.initialized===!0&&r.destroyTexture(e),e.isFramebufferTexture){const c=this.renderer.getRenderTarget();c?e.type=c.texture.type:e.type=ei}const{width:a,height:o,depth:l}=this.getSize(e);if(t.width=a,t.height=o,t.depth=l,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,a,o):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,s||e.isStorageTexture===!0||e.isExternalTexture===!0)r.createTexture(e,t),n.generation=e.version;else if(e.version>0){const c=e.image;if(c===void 0)Se("Renderer: Texture marked for update but image is undefined.");else if(c.complete===!1)Se("Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const h=[];for(const f of e.images)h.push(f);t.images=h}else t.image=c;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(r.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&r.updateTexture(e,t);const u=e.isStorageTexture===!0&&e.mipmapsAutoUpdate===!1;t.needsMipmaps&&e.mipmaps.length===0&&!u&&r.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else r.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;n.initialized!==!0&&(n.initialized=!0,n.generation=e.version,this.info.memory.textures++,e.isVideoTexture&&en.enabled===!0&&en.getTransfer(e.colorSpace)!==Ft&&Se("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),n.onDispose=()=>{this._destroyTexture(e)},e.addEventListener("dispose",n.onDispose)),n.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=ble){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?(t.width=n.videoWidth||1,t.height=n.videoHeight||1,t.depth=1):typeof VideoFrame<"u"&&n instanceof VideoFrame?(t.width=n.displayWidth||1,t.height=n.displayHeight||1,t.depth=1):(t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let s;return e.mipmaps.length>0?s=e.mipmaps.length:e.isCompressedTexture===!0?s=1:s=Math.floor(Math.log2(Math.max(t,n)))+1,s}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyRenderTarget(e){if(this.has(e)===!0){const t=this.get(e),n=t.textures,s=t.depthTexture;e.removeEventListener("dispose",t.onDispose);for(let r=0;r<n.length;r++)this._destroyTexture(n[r]);s&&this._destroyTexture(s),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(this.has(e)===!0){const t=this.get(e);e.removeEventListener("dispose",t.onDispose);const n=t.isDefaultTexture;this.backend.destroyTexture(e,n),this.delete(e),this.info.memory.textures--}}}class AP extends Ye{constructor(e,t,n,s=1){super(e,t,n),this.a=s}set(e,t,n,s=1){return this.a=s,super.set(e,t,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class MP extends ni{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){const n=this.getNodeType(e),s=e.getStructTypeNode(n);let r;return s!==null?r=s.getMemberType(e,t):(De(`TSL: Member "${t}" not found in struct "${n}".`),r="float"),r}getHash(){return this.uuid}generate(){return this.name}}const Tle=(i,e)=>new MP(i,e);class Bj extends Gt{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this._currentNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput?this.outputNode.getElementType(e):"void"}getNodeType(e){return this.hasOutput?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput?this.outputNode.getMemberType(e,t):"void"}addToStack(e,t=this.nodes.length){return e.isNode!==!0?(De("TSL: Invalid node added to stack."),this):(this.nodes.splice(t,0,e),this)}addToStackBefore(e){const t=this._currentNode?this.nodes.indexOf(this._currentNode):0;return this.addToStack(e,t)}If(e,t){const n=new sy(t);return this._currentCond=Xr(e,n),this.addToStack(this._currentCond)}ElseIf(e,t){const n=new sy(t),s=Xr(e,n);return this._currentCond.elseNode=s,this._currentCond=s,this}Else(e){return this._currentCond.elseNode=new sy(e),this}Switch(e){return this._expressionNode=St(e),this}Case(...e){const t=[];if(e.length>=2)for(let o=0;o<e.length-1;o++)t.push(this._expressionNode.equal(St(e[o])));else De("TSL: Invalid parameter length. Case() requires at least two parameters.");const n=e[e.length-1],s=new sy(n);let r=t[0];for(let o=1;o<t.length;o++)r=r.or(t[o]);const a=Xr(r,s);return this._currentCond===null?(this._currentCond=a,this.addToStack(this._currentCond)):(this._currentCond.elseNode=a,this._currentCond=a,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const s of this.getChildren())s.isVarNode&&s.isIntent(e)&&s.isAssign(e)!==!0||(t["node"+n++]=s);return t.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(e,...t){const n=lI(),s=e.buildStage;Nb(this),e.setActiveStack(this);const r=c=>{if(this._currentNode=c,!(c.isVarNode&&c.isIntent(e)&&c.isAssign(e)!==!0)){if(s==="setup")c.build(e);else if(s==="analyze")c.build(e,this);else if(s==="generate"){const u=e.getDataFromNode(c,"any").stages,h=u&&u[e.shaderStage];if(c.isVarNode&&h&&h.length===1&&h[0]&&h[0].isStackNode)return;c.build(e,"void")}}},a=[...this.nodes];for(const c of a)r(c);this._currentNode=null;const o=this.nodes.filter(c=>a.indexOf(c)===-1);for(const c of o)r(c);let l;return this.hasOutput?l=this.outputNode.build(e,...t):l=super.build(e,...t),Nb(n),e.removeActiveStack(this),l}}const WA=fn(Bj).setParameterLength(0,1);function Ale(i){return Object.entries(i).map(([e,t])=>typeof t=="string"?{name:e,type:t,atomic:!1}:{name:e,type:t.type,atomic:t.atomic||!1})}class Dj extends Gt{static get type(){return"StructTypeNode"}constructor(e,t=null){super("struct"),this.membersLayout=Ale(e),this.name=t,this.isStructLayoutNode=!0}getLength(){const e=Float32Array.BYTES_PER_ELEMENT;let t=1,n=0;for(const s of this.membersLayout){const r=s.type,a=RW(r),o=NW(r)/e;t=Math.max(t,o);const c=n%t%o;c!==0&&(n+=o-c),n+=a}return Math.ceil(n/t)*t}getMemberType(e,t){const n=this.membersLayout.find(s=>s.name===t);return n?n.type:"void"}getNodeType(e){return e.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(e){e.getStructTypeFromNode(this,this.membersLayout,this.name),e.addInclude(this)}generate(e){return this.getNodeType(e)}}class Lj extends Gt{static get type(){return"StructNode"}constructor(e,t){super("vec3"),this.structTypeNode=e,this.values=t,this.isStructNode=!0}getNodeType(e){return this.structTypeNode.getNodeType(e)}getMemberType(e,t){return this.structTypeNode.getMemberType(e,t)}generate(e){const t=e.getVarFromNode(this),n=t.type,s=e.getPropertyName(t);return e.addLineFlowCode(`${s} = ${e.generateStruct(n,this.structTypeNode.membersLayout,this.values)}`,this),t.name}}const Mle=(i,e=null)=>{const t=new Dj(i,e),n=(...s)=>{let r=null;if(s.length>0)if(s[0].isNode){r={};const a=Object.keys(i);for(let o=0;o<s.length;o++)r[a[o]]=s[o]}else r=s[0];return new Lj(t,r)};return n.layout=t,n.isStruct=!0,n};class EP extends Gt{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}getNodeType(e){const t=e.getNodeProperties(this);if(t.membersLayout===void 0){const n=this.members,s=[];for(let r=0;r<n.length;r++){const a="m"+r,o=n[r].getNodeType(e);s.push({name:a,type:o,index:r})}t.membersLayout=s,t.structType=e.getOutputStructTypeFromNode(this,t.membersLayout)}return t.structType.name}generate(e){const t=e.getOutputStructName(),n=this.members,s=t!==""?t+".":"";for(let r=0;r<n.length;r++){const a=n[r].build(e);e.addLineFlowCode(`${s}m${r} = ${a}`,this)}return t}}const Ele=fn(EP);function Uj(i,e){for(let t=0;t<i.length;t++)if(i[t].name===e)return t;return-1}class Ij extends EP{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return this.outputNodes[e]!==void 0}get(e){return this.outputNodes[e]}merge(e){const t={...this.outputNodes,...e.outputNodes};return Pj(t)}setup(e){const t=this.outputNodes,n=e.renderer.getRenderTarget(),s=[],r=n.textures;for(const a in t){const o=Uj(r,a);s[o]=It(t[a])}return this.members=s,super.setup(e)}}const Pj=fn(Ij);class zx extends ti{static get type(){return"BitcastNode"}constructor(e,t,n=null){super(),this.valueNode=e,this.conversionType=t,this.inputType=n,this.isBitcastNode=!0}getNodeType(e){if(this.inputType!==null){const t=this.valueNode.getNodeType(e),n=e.getTypeLength(t);return e.getTypeFromLength(n,this.conversionType)}return this.conversionType}generate(e){const t=this.getNodeType(e);let n="";if(this.inputType!==null){const s=this.valueNode.getNodeType(e);n=e.getTypeLength(s)===1?this.inputType:e.changeComponentType(s,this.inputType)}else n=this.valueNode.getNodeType(e);return`${e.getBitcastMethod(t,n)}( ${this.valueNode.build(e,n)} )`}}const Oj=ot(zx).setParameterLength(2),Cle=i=>new zx(i,"int","float"),Fj=i=>new zx(i,"uint","float"),wle=i=>new zx(i,"float","int"),Rle=i=>new zx(i,"float","uint"),tA={};class Jo extends xe{static get type(){return"BitcountNode"}constructor(e,t){super(e,t),this.isBitcountNode=!0}_resolveElementType(e,t,n){n==="int"?t.assign(Oj(e,"uint")):t.assign(e)}_returnDataNode(e){switch(e){case"uint":return Ze;case"int":return te;case"uvec2":return cI;case"uvec3":return Cg;case"uvec4":return fI;case"ivec2":return js;case"ivec3":return uI;case"ivec4":return dI}}_createTrailingZerosBaseLayout(e,t){const n=this._returnDataNode(t);return le(([r])=>{const a=Ze(0);this._resolveElementType(r,a,t);const o=W(a.bitAnd(CI(a))),c=Fj(o).shiftRight(23).sub(127);return n(c)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createLeadingZerosBaseLayout(e,t){const n=this._returnDataNode(t);return le(([r])=>{Wt(r.equal(Ze(0)),()=>Ze(32));const a=Ze(0),o=Ze(0);return this._resolveElementType(r,a,t),Wt(a.shiftRight(16).equal(0),()=>{o.addAssign(16),a.shiftLeftAssign(16)}),Wt(a.shiftRight(24).equal(0),()=>{o.addAssign(8),a.shiftLeftAssign(8)}),Wt(a.shiftRight(28).equal(0),()=>{o.addAssign(4),a.shiftLeftAssign(4)}),Wt(a.shiftRight(30).equal(0),()=>{o.addAssign(2),a.shiftLeftAssign(2)}),Wt(a.shiftRight(31).equal(0),()=>{o.addAssign(1)}),n(o)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createOneBitsBaseLayout(e,t){const n=this._returnDataNode(t);return le(([r])=>{const a=Ze(0);this._resolveElementType(r,a,t),a.assign(a.sub(a.shiftRight(Ze(1)).bitAnd(Ze(1431655765)))),a.assign(a.bitAnd(Ze(858993459)).add(a.shiftRight(Ze(2)).bitAnd(Ze(858993459))));const o=a.add(a.shiftRight(Ze(4))).bitAnd(Ze(252645135)).mul(Ze(16843009)).shiftRight(Ze(24));return n(o)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createMainLayout(e,t,n,s){const r=this._returnDataNode(t);return le(([o])=>{if(n===1)return r(s(o));{const l=r(0),c=["x","y","z","w"];for(let u=0;u<n;u++){const h=c[u];l[h].assign(s(o[h]))}return l}}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}setup(e){const{method:t,aNode:n}=this,{renderer:s}=e;if(s.backend.isWebGPUBackend)return super.setup(e);const r=this.getInputType(e),a=e.getElementType(r),o=e.getTypeLength(r),l=`${t}_base_${a}`,c=`${t}_${r}`;let u=tA[l];if(u===void 0){switch(t){case Jo.COUNT_LEADING_ZEROS:{u=this._createLeadingZerosBaseLayout(l,a);break}case Jo.COUNT_TRAILING_ZEROS:{u=this._createTrailingZerosBaseLayout(l,a);break}case Jo.COUNT_ONE_BITS:{u=this._createOneBitsBaseLayout(l,a);break}}tA[l]=u}let h=tA[c];return h===void 0&&(h=this._createMainLayout(c,r,o,u),tA[c]=h),le(()=>h(n))()}}Jo.COUNT_TRAILING_ZEROS="countTrailingZeros";Jo.COUNT_LEADING_ZEROS="countLeadingZeros";Jo.COUNT_ONE_BITS="countOneBits";const Nle=ot(Jo,Jo.COUNT_TRAILING_ZEROS).setParameterLength(1),Ble=ot(Jo,Jo.COUNT_LEADING_ZEROS).setParameterLength(1),Dle=ot(Jo,Jo.COUNT_ONE_BITS).setParameterLength(1),Lle=le(([i])=>{const e=i.toUint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).toFloat().mul(1/2**32)}),JD=(i,e)=>Il(dn(4,i.mul(On(1,i))),e),Ule=(i,e)=>i.lessThan(.5)?JD(i.mul(2),e).div(2):On(1,JD(dn(On(1,i),2),e).div(2)),Ile=(i,e,t)=>Il(tl(Il(i,e),zs(Il(i,e),Il(On(1,i),t))),1/e),Ple=(i,e)=>La(WM.mul(e.mul(i).sub(1))).div(WM.mul(e.mul(i).sub(1)));class CP extends ti{static get type(){return"PackFloatNode"}constructor(e,t){super(),this.vectorNode=t,this.encoding=e,this.isPackFloatNode=!0}getNodeType(){return"uint"}generate(e){const t=this.vectorNode.getNodeType(e);return`${e.getFloatPackingMethod(this.encoding)}(${this.vectorNode.build(e,t)})`}}const Ole=ot(CP,"snorm").setParameterLength(1),Fle=ot(CP,"unorm").setParameterLength(1),Gle=ot(CP,"float16").setParameterLength(1);class wP extends ti{static get type(){return"UnpackFloatNode"}constructor(e,t){super(),this.uintNode=t,this.encoding=e,this.isUnpackFloatNode=!0}getNodeType(){return"vec2"}generate(e){const t=this.uintNode.getNodeType(e);return`${e.getFloatUnpackingMethod(this.encoding)}(${this.uintNode.build(e,t)})`}}const zle=ot(wP,"snorm").setParameterLength(1),Vle=ot(wP,"unorm").setParameterLength(1),Hle=ot(wP,"float16").setParameterLength(1),Ju=le(([i])=>i.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),kle=le(([i])=>se(Ju(i.z.add(Ju(i.y.mul(1)))),Ju(i.z.add(Ju(i.x.mul(1)))),Ju(i.y.add(Ju(i.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),Wle=le(([i,e,t])=>{const n=se(i).toVar(),s=W(1.4).toVar(),r=W(0).toVar(),a=se(n).toVar();return ci({start:W(0),end:W(3),type:"float",condition:"<="},()=>{const o=se(kle(a.mul(2))).toVar();n.addAssign(o.add(t.mul(W(.1).mul(e)))),a.mulAssign(1.8),s.mulAssign(1.5),n.mulAssign(1.2);const l=W(Ju(n.z.add(Ju(n.x.add(Ju(n.y)))))).toVar();r.addAssign(l.div(s)),a.addAssign(.14)}),r}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class Gj extends Gt{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFn=null,this.global=!0}getNodeType(e){return this.getCandidateFn(e).shaderNode.layout.type}getCandidateFn(e){const t=this.parametersNodes;let n=this._candidateFn;if(n===null){let s=null,r=-1;for(const a of this.functionNodes){const l=a.shaderNode.layout;if(l===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const c=l.inputs;if(t.length===c.length){let u=0;for(let h=0;h<t.length;h++){const f=t[h],m=c[h];f.getNodeType(e)===m.type&&u++}u>r&&(s=a,r=u)}}this._candidateFn=n=s}return n}setup(e){return this.getCandidateFn(e)(...this.parametersNodes)}}const Xle=fn(Gj),$r=i=>(...e)=>Xle(i,...e),Vx=Yt(0).setGroup(Kt).onRenderUpdate(i=>i.time),qle=Yt(0).setGroup(Kt).onRenderUpdate(i=>i.deltaTime),zj=Yt(0,"uint").setGroup(Kt).onRenderUpdate(i=>i.frameId),jle=(i=Vx)=>i.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),Yle=(i=Vx)=>i.fract().round(),Kle=(i=Vx)=>i.add(.5).fract().mul(2).sub(1).abs(),Zle=(i=Vx)=>i.fract();function Jle(i,e=null){return kh(e,{getUV:i})}const Qle=le(([i,e,t=$e(.5)])=>iT(i.sub(t),e).add(t)),$le=le(([i,e,t=$e(.5)])=>{const n=i.sub(t),s=n.dot(n),a=s.mul(s).mul(e);return i.add(n.mul(a))}),ece=le(({position:i=null,horizontal:e=!0,vertical:t=!1})=>{let n;i!==null?(n=Pl.toVar(),n[3][0]=i.x,n[3][1]=i.y,n[3][2]=i.z):n=Pl;const s=ll.mul(n);return Rb(e)&&(s[0][0]=Pl[0].length(),s[0][1]=0,s[0][2]=0),Rb(t)&&(s[1][0]=0,s[1][1]=Pl[1].length(),s[1][2]=0),s[2][0]=0,s[2][1]=0,s[2][2]=1,Ia.mul(s).mul(ss)}),tce=le(([i=null])=>{const e=Jy();return Jy(uP(i)).sub(e).lessThan(0).select(vh,i)});class Vj extends Gt{static get type(){return"SpriteSheetUVNode"}constructor(e,t=yi(),n=W(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=n}setup(){const{frameNode:e,uvNode:t,countNode:n}=this,{width:s,height:r}=n,a=e.mod(s.mul(r)).floor(),o=a.mod(s),l=r.sub(a.add(1).div(s).ceil()),c=n.reciprocal(),u=$e(o,l);return t.add(u).mul(c)}}const nce=fn(Vj).setParameterLength(3),Hj=le(([i,e=null,t=null,n=W(1),s=ss,r=po])=>{let a=r.abs().normalize();a=a.div(a.dot(se(1)));const o=s.yz.mul(n),l=s.zx.mul(n),c=s.xy.mul(n),u=i.value,h=e!==null?e.value:u,f=t!==null?t.value:u,m=jn(u,o).mul(a.x),g=jn(h,l).mul(a.y),x=jn(f,c).mul(a.z);return zs(m,g,x)}),ice=(...i)=>Hj(...i),w0=new El,Hp=new z,R0=new z,b2=new z,V_=new Lt,nA=new z(0,0,-1),Gc=new un,H_=new z,iA=new z,k_=new un,sA=new Ae,KM=new Si,sce=vh.flipX();KM.depthTexture=new tr(1,1);let rA=!1;class nw extends Tc{static get type(){return"ReflectorNode"}constructor(e={}){super(e.defaultTexture||KM.texture,sce),this._reflectorBaseNode=e.reflector||new rce(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=St(new nw({defaultTexture:KM.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){const e=new this.constructor(this.reflectorNode);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e._reflectorBaseNode=this._reflectorBaseNode,e}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}}class rce extends Gt{static get type(){return"ReflectorBaseNode"}constructor(e,t={}){super();const{target:n=new Fn,resolutionScale:s=1,generateMipmaps:r=!1,bounces:a=!0,depth:o=!1,samples:l=0}=t;this.textureNode=e,this.target=n,this.resolutionScale=s,t.resolution!==void 0&&(oi('ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".'),this.resolutionScale=t.resolution),this.generateMipmaps=r,this.bounces=a,this.depth=o,this.samples=l,this.updateBeforeType=a?on.RENDER:on.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(e,t){const n=this.resolutionScale;t.getDrawingBufferSize(sA),e.setSize(Math.round(sA.width*n),Math.round(sA.height*n))}setup(e){return this._updateResolution(KM,e.renderer),super.setup(e)}dispose(){super.dispose();for(const e of this.renderTargets.values())e.dispose()}getVirtualCamera(e){let t=this.virtualCameras.get(e);return t===void 0&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return t===void 0&&(t=new Si(0,0,{type:ln,samples:this.samples}),this.generateMipmaps===!0&&(t.texture.minFilter=yb,t.texture.generateMipmaps=!0),this.depth===!0&&(t.depthTexture=new tr),this.renderTargets.set(e,t)),t}updateBefore(e){if(this.bounces===!1&&rA)return!1;rA=!0;const{scene:t,camera:n,renderer:s,material:r}=e,{target:a}=this,o=this.getVirtualCamera(n),l=this.getRenderTarget(o);s.getDrawingBufferSize(sA),this._updateResolution(l,s),R0.setFromMatrixPosition(a.matrixWorld),b2.setFromMatrixPosition(n.matrixWorld),V_.extractRotation(a.matrixWorld),Hp.set(0,0,1),Hp.applyMatrix4(V_),H_.subVectors(R0,b2);const c=H_.dot(Hp)>0;let u=!1;if(c===!0&&this.forceUpdate===!1){if(this.hasOutput===!1){rA=!1;return}u=!0}H_.reflect(Hp).negate(),H_.add(R0),V_.extractRotation(n.matrixWorld),nA.set(0,0,-1),nA.applyMatrix4(V_),nA.add(b2),iA.subVectors(R0,nA),iA.reflect(Hp).negate(),iA.add(R0),o.coordinateSystem=n.coordinateSystem,o.position.copy(H_),o.up.set(0,1,0),o.up.applyMatrix4(V_),o.up.reflect(Hp),o.lookAt(iA),o.near=n.near,o.far=n.far,o.updateMatrixWorld(),o.projectionMatrix.copy(n.projectionMatrix),w0.setFromNormalAndCoplanarPoint(Hp,R0),w0.applyMatrix4(o.matrixWorldInverse),Gc.set(w0.normal.x,w0.normal.y,w0.normal.z,w0.constant);const h=o.projectionMatrix;k_.x=(Math.sign(Gc.x)+h.elements[8])/h.elements[0],k_.y=(Math.sign(Gc.y)+h.elements[9])/h.elements[5],k_.z=-1,k_.w=(1+h.elements[10])/h.elements[14],Gc.multiplyScalar(1/Gc.dot(k_));const f=0;h.elements[2]=Gc.x,h.elements[6]=Gc.y,h.elements[10]=s.coordinateSystem===Ka?Gc.z-f:Gc.z+1-f,h.elements[14]=Gc.w,this.textureNode.value=l.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=l.depthTexture),r.visible=!1;const m=s.getRenderTarget(),g=s.getMRT(),x=s.autoClear;s.setMRT(null),s.setRenderTarget(l),s.autoClear=!0;const v=t.name;t.name=(t.name||"Scene")+" [ Reflector ]",u?(s.clear(),this.hasOutput=!1):(s.render(t,o),this.hasOutput=!0),t.name=v,s.setMRT(g),s.setRenderTarget(m),s.autoClear=x,r.visible=!0,rA=!1,this.forceUpdate=!1}get resolution(){return oi('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale}set resolution(e){oi('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale=e}}const ace=i=>new nw(i),S2=new Dr(-1,1,1,-1,0,1);class oce extends pn{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new qt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new qt(t,2))}}const lce=new oce;class Aa extends Kn{constructor(e=null){super(lce,e),this.camera=S2,this.isQuadMesh=!0}async renderAsync(e){oi('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await e.init(),e.render(this,S2)}render(e){e.render(this,S2)}}const cce=new Ae;class kj extends Tc{static get type(){return"RTTNode"}constructor(e,t=null,n=null,s={type:ln}){const r=new Si(t,n,s);super(r.texture,yi()),this.isRTTNode=!0,this.node=e,this.width=t,this.height=n,this.pixelRatio=1,this.renderTarget=r,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new Aa(new Tn),this.updateBeforeType=on.RENDER}get autoResize(){return this.width===null}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;const n=e*this.pixelRatio,s=t*this.pixelRatio;this.renderTarget.setSize(n,s),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoResize===!0){const s=e.getPixelRatio(),r=e.getSize(cce),a=Math.floor(r.width*s),o=Math.floor(r.height*s);(a!==this.renderTarget.width||o!==this.renderTarget.height)&&(this.renderTarget.setSize(a,o),this.textureNeedsUpdate=!0)}let t="RTT";this.node.name&&(t=this.node.name+" [ "+t+" ]"),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=t;const n=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(n)}clone(){const e=new Tc(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const Wj=(i,...e)=>St(new kj(St(i),...e)),uce=(i,...e)=>i.isSampleNode||i.isTextureNode?i:i.isPassNode?i.getTextureNode():Wj(i,...e),k0=le(([i,e,t],n)=>{let s;n.renderer.coordinateSystem===Ka?(i=$e(i.x,i.y.oneMinus()).mul(2).sub(1),s=It(se(i,e),1)):s=It(se(i.x,i.y.oneMinus(),e).mul(2).sub(1),1);const r=It(t.mul(s));return r.xyz.div(r.w)}),hce=le(([i,e])=>{const t=e.mul(It(i,1)),n=t.xy.div(t.w).mul(.5).add(.5).toVar();return $e(n.x,n.y.oneMinus())}),dce=le(([i,e,t])=>{const n=_h(hs(e)),s=js(i.mul(n)).toVar(),r=hs(e,s).toVar(),a=hs(e,s.sub(js(2,0))).toVar(),o=hs(e,s.sub(js(1,0))).toVar(),l=hs(e,s.add(js(1,0))).toVar(),c=hs(e,s.add(js(2,0))).toVar(),u=hs(e,s.add(js(0,2))).toVar(),h=hs(e,s.add(js(0,1))).toVar(),f=hs(e,s.sub(js(0,1))).toVar(),m=hs(e,s.sub(js(0,2))).toVar(),g=Pi(On(W(2).mul(o).sub(a),r)).toVar(),x=Pi(On(W(2).mul(l).sub(c),r)).toVar(),v=Pi(On(W(2).mul(h).sub(u),r)).toVar(),y=Pi(On(W(2).mul(f).sub(m),r)).toVar(),b=k0(i,r,t).toVar(),S=g.lessThan(x).select(b.sub(k0(i.sub($e(W(1).div(n.x),0)),o,t)),b.negate().add(k0(i.add($e(W(1).div(n.x),0)),l,t))),T=v.lessThan(y).select(b.sub(k0(i.add($e(0,W(1).div(n.y))),h,t)),b.negate().add(k0(i.sub($e(0,W(1).div(n.y))),f,t)));return Ya(Dh(S,T))}),RP=le(([i])=>bc(W(52.9829189).mul(bc(Yl(i,$e(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]}),mc=le(([i,e,t])=>{const n=W(2.399963229728653),s=ya(W(i).add(.5).div(W(e))),r=W(i).mul(n).add(t);return $e(fc(r),La(r)).mul(s)}).setLayout({name:"vogelDiskSample",type:"vec2",inputs:[{name:"sampleIndex",type:"int"},{name:"samplesCount",type:"int"},{name:"phi",type:"float"}]});class fce extends Gt{static get type(){return"SampleNode"}constructor(e,t=null){super(),this.callback=e,this.uvNode=t,this.isSampleNode=!0}setup(){return this.sample(yi())}sample(e){return this.callback(e)}}const pce=(i,e=null)=>new fce(i,St(e));class Wa extends Gt{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===Wa.OBJECT?this.updateType=on.OBJECT:e===Wa.MATERIAL?this.updateType=on.RENDER:e===Wa.BEFORE_OBJECT?this.updateBeforeType=on.OBJECT:e===Wa.BEFORE_MATERIAL&&(this.updateBeforeType=on.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}}Wa.OBJECT="object";Wa.MATERIAL="material";Wa.BEFORE_OBJECT="beforeObject";Wa.BEFORE_MATERIAL="beforeMaterial";const iw=(i,e)=>new Wa(i,e).toStack(),mce=i=>iw(Wa.OBJECT,i),gce=i=>iw(Wa.MATERIAL,i),yce=i=>iw(Wa.BEFORE_OBJECT,i),xce=i=>iw(Wa.BEFORE_MATERIAL,i);class Xj extends Yr{constructor(e,t,n=Float32Array){const s=ArrayBuffer.isView(e)?e:new n(e*t);super(s,t),this.isStorageInstancedBufferAttribute=!0}}class NP extends Nn{constructor(e,t,n=Float32Array){const s=ArrayBuffer.isView(e)?e:new n(e*t);super(s,t),this.isStorageBufferAttribute=!0}}const _ce=(i,e="float")=>{let t,n;e.isStruct===!0?(t=e.layout.getLength(),n=wb("float")):(t=JU(e),n=wb(e));const s=new NP(i,t,n);return bh(s,e,i)},vce=(i,e="float")=>{let t,n;e.isStruct===!0?(t=e.layout.getLength(),n=wb("float")):(t=JU(e),n=wb(e));const s=new Xj(i,t,n);return bh(s,e,i)};class qj extends Gt{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const bce=_t(qj),W_=new Lr,T2=new Lt;class Xa extends Gt{static get type(){return"SceneNode"}constructor(e=Xa.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,n=this.scene!==null?this.scene:e.scene;let s;return t===Xa.BACKGROUND_BLURRINESS?s=vi("backgroundBlurriness","float",n):t===Xa.BACKGROUND_INTENSITY?s=vi("backgroundIntensity","float",n):t===Xa.BACKGROUND_ROTATION?s=Yt("mat4").setName("backgroundRotation").setGroup(Kt).onRenderUpdate(()=>{const r=n.background;return r!==null&&r.isTexture&&r.mapping!==hu?(W_.copy(n.backgroundRotation),W_.x*=-1,W_.y*=-1,W_.z*=-1,T2.makeRotationFromEuler(W_)):T2.identity(),T2}):De("SceneNode: Unknown scope:",t),s}}Xa.BACKGROUND_BLURRINESS="backgroundBlurriness";Xa.BACKGROUND_INTENSITY="backgroundIntensity";Xa.BACKGROUND_ROTATION="backgroundRotation";const jj=_t(Xa,Xa.BACKGROUND_BLURRINESS),QD=_t(Xa,Xa.BACKGROUND_INTENSITY),Yj=_t(Xa,Xa.BACKGROUND_ROTATION);class Kj extends Tc{static get type(){return"StorageTextureNode"}constructor(e,t,n=null){super(e,t),this.storeNode=n,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=wr.WRITE_ONLY}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);return t.storeNode=this.storeNode,t}setAccess(e){return this.access=e,this}setMipLevel(e){return this.mipLevel=e,this}generate(e,t){let n;return this.storeNode!==null?n=this.generateStore(e):n=super.generate(e,t),n}toReadWrite(){return this.setAccess(wr.READ_WRITE)}toReadOnly(){return this.setAccess(wr.READ_ONLY)}toWriteOnly(){return this.setAccess(wr.WRITE_ONLY)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:n,storeNode:s,depthNode:r}=t,a=super.generate(e,"property"),o=n.build(e,this.value.is3DTexture===!0?"uvec3":"uvec2"),l=s.build(e,"vec4"),c=r?r.build(e,"int"):null,u=e.generateTextureStore(e,a,o,c,l);e.addLineFlowCode(u,this)}clone(){const e=super.clone();return e.storeNode=this.storeNode,e.mipLevel=this.mipLevel,e}}const Zj=fn(Kj).setParameterLength(1,3),Sce=(i,e,t)=>{const n=Zj(i,e,t);return t!==null&&n.toStack(),n},Tce=le(({texture:i,uv:e})=>{const n=se().toVar();return Wt(e.x.lessThan(1e-4),()=>{n.assign(se(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{n.assign(se(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{n.assign(se(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{n.assign(se(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{n.assign(se(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{n.assign(se(0,0,-1))}).Else(()=>{const r=i.sample(e.add(se(-.01,0,0))).r.sub(i.sample(e.add(se(.01,0,0))).r),a=i.sample(e.add(se(0,-.01,0))).r.sub(i.sample(e.add(se(0,.01,0))).r),o=i.sample(e.add(se(0,0,-.01))).r.sub(i.sample(e.add(se(0,0,.01))).r);n.assign(se(r,a,o))}),n.normalize()});class Jj extends Tc{static get type(){return"Texture3DNode"}constructor(e,t=null,n=null){super(e,t,n),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return se(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(te(_h(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return Tce({texture:this,uv:e})}}const sw=fn(Jj).setParameterLength(1,3),Ace=(...i)=>sw(...i).setSampler(!1),Mce=(i,e,t)=>sw(i,e).level(t);class Qj extends eT{static get type(){return"UserDataNode"}constructor(e,t,n=null){super(e,t,n),this.userData=n}updateReference(e){return this.reference=this.userData!==null?this.userData:e.object.userData,this.reference}}const Ece=(i,e,t)=>new Qj(i,e,t),c5=new WeakMap;class Cce extends ti{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=on.OBJECT,this.updateAfterType=on.OBJECT,this.previousModelWorldMatrix=Yt(new Lt),this.previousProjectionMatrix=Yt(new Lt).setGroup(Kt),this.previousCameraViewMatrix=Yt(new Lt)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:n}){const s=u5(n);this.previousModelWorldMatrix.value.copy(s);const r=$j(t);r.frameId!==e&&(r.frameId=e,r.previousProjectionMatrix===void 0?(r.previousProjectionMatrix=new Lt,r.previousCameraViewMatrix=new Lt,r.currentProjectionMatrix=new Lt,r.currentCameraViewMatrix=new Lt,r.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),r.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(r.previousProjectionMatrix.copy(r.currentProjectionMatrix),r.previousCameraViewMatrix.copy(r.currentCameraViewMatrix)),r.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),r.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(r.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(r.previousCameraViewMatrix))}updateAfter({object:e}){u5(e).copy(e.matrixWorld)}setup(){const e=this.projectionMatrix===null?Ia:Yt(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),n=e.mul(gu).mul(ss),s=this.previousProjectionMatrix.mul(t).mul(qM),r=n.xy.div(n.w),a=s.xy.div(s.w);return On(r,a)}}function $j(i){let e=c5.get(i);return e===void 0&&(e={},c5.set(i,e)),e}function u5(i,e=0){const t=$j(i);let n=t[e];return n===void 0&&(t[e]=n=new Lt,t[e].copy(i.matrixWorld)),n}const wce=_t(Cce),Rce=le(([i])=>BP(i.rgb)),Nce=le(([i,e=W(1)])=>e.mix(BP(i.rgb),i.rgb)),Bce=le(([i,e=W(1)])=>{const t=zs(i.r,i.g,i.b).div(3),n=i.r.max(i.g.max(i.b)),s=n.sub(t).mul(e).mul(-3);return wn(i.rgb,n,s)}),Dce=le(([i,e=W(1)])=>{const t=se(.57735,.57735,.57735),n=e.cos();return se(i.rgb.mul(n).add(t.cross(i.rgb).mul(e.sin()).add(t.mul(Yl(t,i.rgb).mul(n.oneMinus())))))}),BP=(i,e=se(en.getLuminanceCoefficients(new z)))=>Yl(i,e),Lce=le(([i,e=se(1),t=se(0),n=se(1),s=W(1),r=se(en.getLuminanceCoefficients(new z,Jr))])=>{const a=i.rgb.dot(se(r)),o=ls(i.rgb.mul(e).add(t),0).toVar(),l=o.pow(n).toVar();return Wt(o.r.greaterThan(0),()=>{o.r.assign(l.r)}),Wt(o.g.greaterThan(0),()=>{o.g.assign(l.g)}),Wt(o.b.greaterThan(0),()=>{o.b.assign(l.b)}),o.assign(a.add(o.sub(a).mul(s))),It(o.rgb,i.a)});class eY extends ti{static get type(){return"PosterizeNode"}constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const Uce=fn(eY).setParameterLength(2),aA=new Ae;class tY extends Tc{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class h5 extends tY{static get type(){return"PassMultipleTextureNode"}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}class Mc extends ti{static get type(){return"PassNode"}constructor(e,t,n,s={}){super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=s,this._pixelRatio=1,this._width=1,this._height=1;const r=new tr;r.isRenderTargetTexture=!0,r.name="depth";const a=new Si(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:ln,...s});a.texture.name="output",a.depthTexture=r,this.renderTarget=a,this.overrideMaterial=null,this.transparent=!0,this.opaque=!0,this.contextNode=null,this._contextNodeCache=null,this._textures={output:a.texture,depth:r},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Yt(0),this._cameraFar=Yt(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=on.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return Se("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return Se("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const n=this._textures[e],s=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[s]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=new h5(this,e),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=new h5(this,e,!0),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const n=this._cameraNear,s=this._cameraFar;this._viewZNodes[e]=t=dP(this.getTextureNode(e),n,s)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const n=this._cameraNear,s=this._cameraFar,r=this.getViewZNode(e);this._linearDepthNodes[e]=t=My(r,n,s)}return t}async compileAsync(e){const t=e.getRenderTarget(),n=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(n)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getOutputBufferType(),this.scope===Mc.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let s,r;const a=t.getOutputRenderTarget();a&&a.isXRRenderTarget===!0?(r=1,s=t.xr.getCamera(),t.xr.updateCamera(s),aA.set(a.width,a.height)):(s=this.camera,r=t.getPixelRatio(),t.getSize(aA)),this._pixelRatio=r,this.setSize(aA.width,aA.height);const o=t.getRenderTarget(),l=t.getMRT(),c=t.autoClear,u=t.transparent,h=t.opaque,f=s.layers.mask,m=t.contextNode,g=n.overrideMaterial;this._cameraNear.value=s.near,this._cameraFar.value=s.far,this._layers!==null&&(s.layers.mask=this._layers.mask);for(const v in this._previousTextures)this.toggleTexture(v);this.overrideMaterial!==null&&(n.overrideMaterial=this.overrideMaterial),t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0,t.transparent=this.transparent,t.opaque=this.opaque,this.contextNode!==null&&((this._contextNodeCache===null||this._contextNodeCache.version!==this.version)&&(this._contextNodeCache={version:this.version,context:kh({...t.contextNode.getFlowContextData(),...this.contextNode.getFlowContextData()})}),t.contextNode=this._contextNodeCache.context);const x=n.name;n.name=this.name?this.name:n.name,t.render(n,s),n.name=x,n.overrideMaterial=g,t.setRenderTarget(o),t.setMRT(l),t.autoClear=c,t.transparent=u,t.opaque=h,t.contextNode=m,s.layers.mask=f}setSize(e,t){this._width=e,this._height=t;const n=Math.floor(this._width*this._pixelRatio*this._resolutionScale),s=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(n,s),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,n,s){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new un),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,n,s),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,n,s){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new un),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,n,s),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Mc.COLOR="color";Mc.DEPTH="depth";const Ice=(i,e,t)=>new Mc(Mc.COLOR,i,e,t),Pce=(i,e)=>new tY(i,e),Oce=(i,e,t)=>new Mc(Mc.DEPTH,i,e,t);class nY extends Mc{static get type(){return"ToonOutlinePassNode"}constructor(e,t,n,s,r){super(Mc.COLOR,e,t),this.colorNode=n,this.thicknessNode=s,this.alphaNode=r,this._materialCache=new WeakMap,this.name="Outline Pass"}updateBefore(e){const{renderer:t}=e,n=t.getRenderObjectFunction();t.setRenderObjectFunction((s,r,a,o,l,c,u,h)=>{if((l.isMeshToonMaterial||l.isMeshToonNodeMaterial)&&l.wireframe===!1){const f=this._getOutlineMaterial(l);t.renderObject(s,r,a,o,f,c,u,h)}t.renderObject(s,r,a,o,l,c,u,h)}),super.updateBefore(e),t.setRenderObjectFunction(n)}_createMaterial(){const e=new Tn;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=hi;const t=po.negate(),n=Ia.mul(gu),s=W(1),r=n.mul(It(ss,1)),a=n.mul(It(ss.add(t),1)),o=Ya(r.sub(a));return e.vertexNode=r.add(o.mul(this.thicknessNode).mul(r.w).mul(s)),e.colorNode=It(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return t===void 0&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}const Fce=(i,e,t=new Ye(0,0,0),n=.003,s=1)=>St(new nY(i,e,St(t),St(n),St(s))),iY=le(([i,e])=>i.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),sY=le(([i,e])=>(i=i.mul(e),i.div(i.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),rY=le(([i,e])=>{i=i.mul(e),i=i.sub(.004).max(0);const t=i.mul(i.mul(6.2).add(.5)),n=i.mul(i.mul(6.2).add(1.7)).add(.06);return t.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Gce=le(([i])=>{const e=i.mul(i.add(.0245786)).sub(90537e-9),t=i.mul(i.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),aY=le(([i,e])=>{const t=Qr(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=Qr(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return i=i.mul(e).div(.6),i=t.mul(i),i=Gce(i),i=n.mul(i),i.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),zce=Qr(se(1.6605,-.1246,-.0182),se(-.5876,1.1329,-.1006),se(-.0728,-.0083,1.1187)),Vce=Qr(se(.6274,.0691,.0164),se(.3293,.9195,.088),se(.0433,.0113,.8956)),Hce=le(([i])=>{const e=se(i).toVar(),t=se(e.mul(e)).toVar(),n=se(t.mul(t)).toVar();return W(15.5).mul(n.mul(t)).sub(dn(40.14,n.mul(e))).add(dn(31.96,n).sub(dn(6.868,t.mul(e))).add(dn(.4298,t).add(dn(.1191,e).sub(.00232))))}),oY=le(([i,e])=>{const t=se(i).toVar(),n=Qr(se(.856627153315983,.137318972929847,.11189821299995),se(.0951212405381588,.761241990602591,.0767994186031903),se(.0482516061458583,.101439036467562,.811302368396859)),s=Qr(se(1.1271005818144368,-.1413297634984383,-.14132976349843826),se(-.11060664309660323,1.157823702216272,-.11060664309660294),se(-.016493938717834573,-.016493938717834257,1.2519364065950405)),r=W(-12.47393),a=W(4.026069);return t.mulAssign(e),t.assign(Vce.mul(t)),t.assign(n.mul(t)),t.assign(ls(t,1e-10)),t.assign(ru(t)),t.assign(t.sub(r).div(a.sub(r))),t.assign(Sc(t,0,1)),t.assign(Hce(t)),t.assign(s.mul(t)),t.assign(Il(ls(se(0),t),se(2.2))),t.assign(zce.mul(t)),t.assign(Sc(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),lY=le(([i,e])=>{const t=W(.76),n=W(.15);i=i.mul(e);const s=fo(i.r,fo(i.g,i.b)),r=Xr(s.lessThan(.08),s.sub(dn(6.25,s.mul(s))),.04);i.subAssign(r);const a=ls(i.r,ls(i.g,i.b));Wt(a.lessThan(t),()=>i);const o=On(1,t),l=On(1,o.mul(o).div(a.add(o.sub(t))));i.mulAssign(l.div(a));const c=On(1,tl(1,n.mul(a.sub(l)).add(1)));return wn(i,se(l),c)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class rr extends Gt{static get type(){return"CodeNode"}constructor(e="",t=[],n=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=n}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const s of t)s.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const rw=fn(rr).setParameterLength(1,3),kce=(i,e)=>rw(i,e,"js"),Wce=(i,e)=>rw(i,e,"wgsl"),Xce=(i,e)=>rw(i,e,"glsl");class DP extends rr{static get type(){return"FunctionNode"}constructor(e="",t=[],n=""){super(e,t,n)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),s=n.name,r=n.type,a=e.getCodeFromNode(this,r);s!==""&&(a.name=s);const o=e.getPropertyName(a),l=this.getNodeFunction(e).getCode(o);return a.code=l+`
`,t==="property"?o:e.format(`${o}()`,r,t)}}const cY=(i,e=[],t="")=>{for(let r=0;r<e.length;r++){const a=e[r];typeof a=="function"&&(e[r]=a.functionNode)}const n=new DP(i,e,t),s=(...r)=>n.call(...r);return s.functionNode=n,s},qce=(i,e)=>cY(i,e,"glsl"),jce=(i,e)=>cY(i,e,"wgsl");class uY extends Gt{static get type(){return"ScriptableValueNode"}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outputType=null,this.events=new Ta,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:W()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=$U(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=eI(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const XA=fn(uY).setParameterLength(1);class hY extends Map{get(e,t=null,...n){if(this.has(e))return super.get(e);if(t!==null){const s=t(...n);return this.set(e,s),s}}}let Yce=class{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}};const qA=new hY;class dY extends Gt{static get type(){return"ScriptableNode"}constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new hY,this._output=XA(null),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const n=this._outputs;return n[e]===void 0?n[e]=XA(t):n[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const n=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),n[e]=t,n[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),n[e]=t,n[e].events.addEventListener("refresh",this.onRefresh)):n[e]===void 0?(n[e]=XA(t),n[e].events.addEventListener("refresh",this.onRefresh)):n[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const s=this.getObject()[e];if(typeof s=="function")return s(...t)}async callAsync(e,...t){const s=this.getObject()[e];if(typeof s=="function")return s.constructor.name==="AsyncFunction"?await s(...t):s(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(c,u)=>this.setOutput(c,u),n=new Yce(this),s=qA.get("THREE"),r=qA.get("TSL"),a=this.getMethod(),o=[n,this._local,qA,e,t,s,r];this._object=a(...o);const l=this._object.layout;if(l&&(l.cache===!1&&this._local.clear(),this._output.outputType=l.outputType||null,Array.isArray(l.elements)))for(const c of l.elements){const u=c.id||c.name;c.inputType&&(this.getParameter(u)===void 0&&this.setParameter(u,null),this.getParameter(u).inputType=c.inputType),c.outputType&&(this.getOutput(u)===void 0&&this.setOutput(u,null),this.getOutput(u).outputType=c.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let n=this.parameters[t];n.isScriptableNode&&(n=n.getDefaultOutput()),n.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:W()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],n=["layout","init","main","dispose"].join(", "),s="var "+n+`; var output = {};
`,r=`
return { ...output, `+n+" };",a=s+this.codeNode.code+r;return this._method=new Function(...e,a),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){const t=[Px(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(const n in this.parameters)t.push(this.parameters[n].getCacheKey(e));return Eg(t)}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const Kce=fn(dY).setParameterLength(1,2);function fY(i){let e;const t=i.context.getViewZ;return t!==void 0&&(e=t(this)),(e||As.z).negate()}const LP=le(([i,e],t)=>{const n=fY(t);return nl(i,e,n)}),UP=le(([i],e)=>{const t=fY(e);return i.mul(i,t,t).negate().exp().oneMinus()}),Ib=le(([i,e])=>It(e.toFloat().mix(by.rgb,i.toVec3()),by.a));function Zce(i,e,t){return Se('TSL: "rangeFog( color, near, far )" is deprecated. Use "fog( color, rangeFogFactor( near, far ) )" instead.'),Ib(i,LP(e,t))}function Jce(i,e){return Se('TSL: "densityFog( color, density )" is deprecated. Use "fog( color, densityFogFactor( density ) )" instead.'),Ib(i,UP(e))}let kp=null,Wp=null;class pY extends Gt{static get type(){return"RangeNode"}constructor(e=W(),t=W()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=this.getConstNode(this.minNode),n=this.getConstNode(this.maxNode),s=e.getTypeLength(fh(t.value)),r=e.getTypeLength(fh(n.value));return s>r?s:r}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}getConstNode(e){let t=null;if(e.traverse(n=>{n.isConstNode===!0&&(t=n)}),t===null)throw new Error('THREE.TSL: No "ConstNode" found in node graph.');return t}setup(e){const t=e.object;let n=null;if(t.count>1){const s=this.getConstNode(this.minNode),r=this.getConstNode(this.maxNode),a=s.value,o=r.value,l=e.getTypeLength(fh(a)),c=e.getTypeLength(fh(o));kp=kp||new un,Wp=Wp||new un,kp.setScalar(0),Wp.setScalar(0),l===1?kp.setScalar(a):a.isColor?kp.set(a.r,a.g,a.b,1):kp.set(a.x,a.y,a.z||0,a.w||0),c===1?Wp.setScalar(o):o.isColor?Wp.set(o.r,o.g,o.b,1):Wp.set(o.x,o.y,o.z||0,o.w||0);const u=4,h=u*t.count,f=new Float32Array(h);for(let g=0;g<h;g++){const x=g%u,v=kp.getComponent(x),y=Wp.getComponent(x);f[g]=Fh.lerp(v,y,Math.random())}const m=this.getNodeType(e);if(t.count<=4096)n=$S(f,"vec4",t.count).element(lu).convert(m);else{const g=new Yr(f,4);e.geometry.setAttribute("__range"+this.id,g),n=XM(g).convert(m)}}else n=W(0);return n}}const Qce=fn(pY).setParameterLength(2);class $ce extends Gt{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){return e.hasBuiltin(this._builtinName)}generate(e,t){const n=this.getBuiltinName(e),s=this.getNodeType(e);return e.shaderStage==="compute"?e.format(n,s,t):(Se(`ComputeBuiltinNode: Compute built-in value ${n} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(s))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const sT=(i,e)=>new $ce(i,e),eue=sT("numWorkgroups","uvec3"),tue=sT("workgroupId","uvec3"),nue=sT("globalId","uvec3"),iue=sT("localId","uvec3"),sue=sT("subgroupSize","uint");class rue extends Gt{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}const IP=fn(rue),aue=()=>IP("workgroup").toStack(),oue=()=>IP("storage").toStack(),lue=()=>IP("texture").toStack();class cue extends tp{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let n;const s=e.context.assign;if(n=super.generate(e),s!==!0){const r=this.getNodeType(e);n=e.format(n,r,t)}return n}}class uue extends Gt{constructor(e,t,n=0){super(t),this.bufferType=t,this.bufferCount=n,this.isWorkgroupInfoNode=!0,this.elementType=t,this.scope=e,this.name=""}setName(e){return this.name=e,this}label(e){return Se('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setScope(e){return this.scope=e,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(e){return new cue(this,e)}generate(e){const t=this.name!==""?this.name:`${this.scope}Array_${this.id}`;return e.getScopedArray(t,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const hue=(i,e)=>new uue("Workgroup",i,e);class pr extends Gt{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),n=t.parents,s=this.method,r=this.getNodeType(e),a=this.getInputType(e),o=this.pointerNode,l=this.valueNode,c=[];c.push(`&${o.build(e,a)}`),l!==null&&c.push(l.build(e,a));const u=`${e.getMethod(s,r)}( ${c.join(", ")} )`;if(n?n.length===1&&n[0].isStackNode===!0:!1)e.addLineFlowCode(u,this);else return t.constNode===void 0&&(t.constNode=Lh(u,r).toConst()),t.constNode.build(e)}}pr.ATOMIC_LOAD="atomicLoad";pr.ATOMIC_STORE="atomicStore";pr.ATOMIC_ADD="atomicAdd";pr.ATOMIC_SUB="atomicSub";pr.ATOMIC_MAX="atomicMax";pr.ATOMIC_MIN="atomicMin";pr.ATOMIC_AND="atomicAnd";pr.ATOMIC_OR="atomicOr";pr.ATOMIC_XOR="atomicXor";const due=fn(pr),Au=(i,e,t)=>due(i,e,t).toStack(),fue=i=>Au(pr.ATOMIC_LOAD,i,null),pue=(i,e)=>Au(pr.ATOMIC_STORE,i,e),mue=(i,e)=>Au(pr.ATOMIC_ADD,i,e),gue=(i,e)=>Au(pr.ATOMIC_SUB,i,e),yue=(i,e)=>Au(pr.ATOMIC_MAX,i,e),xue=(i,e)=>Au(pr.ATOMIC_MIN,i,e),_ue=(i,e)=>Au(pr.ATOMIC_AND,i,e),vue=(i,e)=>Au(pr.ATOMIC_OR,i,e),bue=(i,e)=>Au(pr.ATOMIC_XOR,i,e);class Ct extends ti{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,n=null){super(),this.method=e,this.aNode=t,this.bNode=n}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,n=this.bNode?this.bNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),r=e.isMatrix(n)?0:e.getTypeLength(n);return s>r?t:n}getNodeType(e){const t=this.method;return t===Ct.SUBGROUP_ELECT?"bool":t===Ct.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const n=this.method,s=this.getNodeType(e),r=this.getInputType(e),a=this.aNode,o=this.bNode,l=[];if(n===Ct.SUBGROUP_BROADCAST||n===Ct.SUBGROUP_SHUFFLE||n===Ct.QUAD_BROADCAST){const u=o.getNodeType(e);l.push(a.build(e,s),o.build(e,u==="float"?"int":s))}else n===Ct.SUBGROUP_SHUFFLE_XOR||n===Ct.SUBGROUP_SHUFFLE_DOWN||n===Ct.SUBGROUP_SHUFFLE_UP?l.push(a.build(e,s),o.build(e,"uint")):(a!==null&&l.push(a.build(e,r)),o!==null&&l.push(o.build(e,r)));const c=l.length===0?"()":`( ${l.join(", ")} )`;return e.format(`${e.getMethod(n,s)}${c}`,s,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Ct.SUBGROUP_ELECT="subgroupElect";Ct.SUBGROUP_BALLOT="subgroupBallot";Ct.SUBGROUP_ADD="subgroupAdd";Ct.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";Ct.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";Ct.SUBGROUP_MUL="subgroupMul";Ct.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";Ct.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";Ct.SUBGROUP_AND="subgroupAnd";Ct.SUBGROUP_OR="subgroupOr";Ct.SUBGROUP_XOR="subgroupXor";Ct.SUBGROUP_MIN="subgroupMin";Ct.SUBGROUP_MAX="subgroupMax";Ct.SUBGROUP_ALL="subgroupAll";Ct.SUBGROUP_ANY="subgroupAny";Ct.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";Ct.QUAD_SWAP_X="quadSwapX";Ct.QUAD_SWAP_Y="quadSwapY";Ct.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";Ct.SUBGROUP_BROADCAST="subgroupBroadcast";Ct.SUBGROUP_SHUFFLE="subgroupShuffle";Ct.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";Ct.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";Ct.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";Ct.QUAD_BROADCAST="quadBroadcast";const Sue=ot(Ct,Ct.SUBGROUP_ELECT).setParameterLength(0),Tue=ot(Ct,Ct.SUBGROUP_BALLOT).setParameterLength(1),Aue=ot(Ct,Ct.SUBGROUP_ADD).setParameterLength(1),Mue=ot(Ct,Ct.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),Eue=ot(Ct,Ct.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),Cue=ot(Ct,Ct.SUBGROUP_MUL).setParameterLength(1),wue=ot(Ct,Ct.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),Rue=ot(Ct,Ct.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),Nue=ot(Ct,Ct.SUBGROUP_AND).setParameterLength(1),Bue=ot(Ct,Ct.SUBGROUP_OR).setParameterLength(1),Due=ot(Ct,Ct.SUBGROUP_XOR).setParameterLength(1),Lue=ot(Ct,Ct.SUBGROUP_MIN).setParameterLength(1),Uue=ot(Ct,Ct.SUBGROUP_MAX).setParameterLength(1),Iue=ot(Ct,Ct.SUBGROUP_ALL).setParameterLength(0),Pue=ot(Ct,Ct.SUBGROUP_ANY).setParameterLength(0),Oue=ot(Ct,Ct.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),Fue=ot(Ct,Ct.QUAD_SWAP_X).setParameterLength(1),Gue=ot(Ct,Ct.QUAD_SWAP_Y).setParameterLength(1),zue=ot(Ct,Ct.QUAD_SWAP_DIAGONAL).setParameterLength(1),Vue=ot(Ct,Ct.SUBGROUP_BROADCAST).setParameterLength(2),Hue=ot(Ct,Ct.SUBGROUP_SHUFFLE).setParameterLength(2),kue=ot(Ct,Ct.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),Wue=ot(Ct,Ct.SUBGROUP_SHUFFLE_UP).setParameterLength(2),Xue=ot(Ct,Ct.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),que=ot(Ct,Ct.QUAD_BROADCAST).setParameterLength(1);let oA;function aw(i){oA=oA||new WeakMap;let e=oA.get(i);return e===void 0&&oA.set(i,e={}),e}function ow(i){const e=aw(i);return e.shadowMatrix||(e.shadowMatrix=Yt("mat4").setGroup(Kt).onRenderUpdate(t=>((i.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&(i.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(i.shadow.camera.coordinateSystem=t.camera.coordinateSystem,i.shadow.camera.updateProjectionMatrix()),i.shadow.updateMatrices(i)),i.shadow.matrix)))}function mY(i,e=Zo){const t=ow(i).mul(e);return t.xyz.div(t.w)}function PP(i){const e=aw(i);return e.position||(e.position=Yt(new z).setGroup(Kt).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(i.matrixWorld)))}function gY(i){const e=aw(i);return e.targetPosition||(e.targetPosition=Yt(new z).setGroup(Kt).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(i.target.matrixWorld)))}function OP(i){const e=aw(i);return e.viewPosition||(e.viewPosition=Yt(new z).setGroup(Kt).onRenderUpdate(({camera:t},n)=>{n.value=n.value||new z,n.value.setFromMatrixPosition(i.matrixWorld),n.value.applyMatrix4(t.matrixWorldInverse)}))}const FP=i=>ll.transformDirection(PP(i).sub(gY(i))),jue=i=>i.sort((e,t)=>e.id-t.id),Yue=(i,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===i)return t;return null},A2=new WeakMap,X_=[];class lw extends Gt{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=xc("vec3","totalDiffuse"),this.totalSpecularNode=xc("vec3","totalSpecular"),this.outgoingLightNode=xc("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let n=0;n<e.length;n++){const s=e[n];if(X_.push(s.id),X_.push(s.castShadow?1:0),s.isSpotLight===!0){const r=s.map!==null?s.map.id:-1,a=s.colorNode?s.colorNode.getCacheKey():-1;X_.push(r,a)}}const t=Eg(X_);return X_.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const n of this._lightNodes)t.push(n.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const n of t.nodes)n.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,s=jue(this._lights),r=e.renderer.library;for(const a of s)if(a.isNode)t.push(St(a));else{let o=null;if(n!==null&&(o=Yue(a.id,n)),o===null){const l=r.getLightNodeClass(a.constructor);if(l===null){Se(`LightsNode.setupNodeLights: Light node not found for ${a.constructor.name}`);continue}let c=null;A2.has(a)?c=A2.get(a):(c=new l(a),A2.set(a,c)),t.push(c)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:s,reflectedLight:r}=e.context;s.direct({...n,lightNode:t,reflectedLight:r},e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:s,reflectedLight:r}=e.context;s.directRectArea({...n,lightNode:t,reflectedLight:r},e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const s=e.context,r=s.lightingModel,a=e.getNodeProperties(this);if(r){const{totalDiffuseNode:o,totalSpecularNode:l}=this;s.outgoingLight=n;const c=e.addStack();a.nodes=c.nodes,r.start(e);const{backdrop:u,backdropAlpha:h}=s,{directDiffuse:f,directSpecular:m,indirectDiffuse:g,indirectSpecular:x}=s.reflectedLight;let v=f.add(g);u!==null&&(h!==null?v=se(h.mix(v,u)):v=se(u)),o.assign(v),l.assign(m.add(x)),n.assign(o.add(l)),r.finish(e),n=n.bypass(e.removeStack())}else a.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const Kue=(i=[])=>new lw().setLights(i);class yY extends Gt{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=on.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){GP.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||Zo)}}const GP=xc("vec3","shadowPositionWorld");function zP(i,e={}){return e.toneMapping=i.toneMapping,e.toneMappingExposure=i.toneMappingExposure,e.outputColorSpace=i.outputColorSpace,e.renderTarget=i.getRenderTarget(),e.activeCubeFace=i.getActiveCubeFace(),e.activeMipmapLevel=i.getActiveMipmapLevel(),e.renderObjectFunction=i.getRenderObjectFunction(),e.pixelRatio=i.getPixelRatio(),e.mrt=i.getMRT(),e.clearColor=i.getClearColor(e.clearColor||new Ye),e.clearAlpha=i.getClearAlpha(),e.autoClear=i.autoClear,e.scissorTest=i.getScissorTest(),e}function xY(i,e){return e=zP(i,e),i.setMRT(null),i.setRenderObjectFunction(null),i.setClearColor(0,1),i.autoClear=!0,e}function _Y(i,e){i.toneMapping=e.toneMapping,i.toneMappingExposure=e.toneMappingExposure,i.outputColorSpace=e.outputColorSpace,i.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),i.setRenderObjectFunction(e.renderObjectFunction),i.setPixelRatio(e.pixelRatio),i.setMRT(e.mrt),i.setClearColor(e.clearColor,e.clearAlpha),i.autoClear=e.autoClear,i.setScissorTest(e.scissorTest)}function VP(i,e={}){return e.background=i.background,e.backgroundNode=i.backgroundNode,e.overrideMaterial=i.overrideMaterial,e}function vY(i,e){return e=VP(i,e),i.background=null,i.backgroundNode=null,i.overrideMaterial=null,e}function bY(i,e){i.background=e.background,i.backgroundNode=e.backgroundNode,i.overrideMaterial=e.overrideMaterial}function Zue(i,e,t={}){return t=zP(i,t),t=VP(e,t),t}function SY(i,e,t){return t=xY(i,t),t=vY(e,t),t}function TY(i,e,t){_Y(i,t),bY(e,t)}var Vs=Object.freeze({__proto__:null,resetRendererAndSceneState:SY,resetRendererState:xY,resetSceneState:vY,restoreRendererAndSceneState:TY,restoreRendererState:_Y,restoreSceneState:bY,saveRendererAndSceneState:Zue,saveRendererState:zP,saveSceneState:VP});const ZM=new WeakMap,AY=le(({depthTexture:i,shadowCoord:e,depthLayer:t})=>{let n=jn(i,e.xy).setName("t_basic");return i.isArrayTexture&&(n=n.depth(t)),n.compare(e.z)}),MY=le(({depthTexture:i,shadowCoord:e,shadow:t,depthLayer:n})=>{const s=(u,h)=>{let f=jn(i,u);return i.isArrayTexture&&(f=f.depth(n)),f.compare(h)},r=vi("mapSize","vec2",t).setGroup(Kt),a=vi("radius","float",t).setGroup(Kt),o=$e(1).div(r),l=a.mul(o.x),c=RP(wg.xy).mul(6.28318530718);return zs(s(e.xy.add(mc(0,5,c).mul(l)),e.z),s(e.xy.add(mc(1,5,c).mul(l)),e.z),s(e.xy.add(mc(2,5,c).mul(l)),e.z),s(e.xy.add(mc(3,5,c).mul(l)),e.z),s(e.xy.add(mc(4,5,c).mul(l)),e.z)).mul(1/5)}),EY=le(({depthTexture:i,shadowCoord:e,shadow:t,depthLayer:n})=>{const s=(h,f)=>{let m=jn(i,h);return i.isArrayTexture&&(m=m.depth(n)),m.compare(f)},r=vi("mapSize","vec2",t).setGroup(Kt),a=$e(1).div(r),o=a.x,l=a.y,c=e.xy,u=bc(c.mul(r).add(.5));return c.subAssign(u.mul(a)),zs(s(c,e.z),s(c.add($e(o,0)),e.z),s(c.add($e(0,l)),e.z),s(c.add(a),e.z),wn(s(c.add($e(o.negate(),0)),e.z),s(c.add($e(o.mul(2),0)),e.z),u.x),wn(s(c.add($e(o.negate(),l)),e.z),s(c.add($e(o.mul(2),l)),e.z),u.x),wn(s(c.add($e(0,l.negate())),e.z),s(c.add($e(0,l.mul(2))),e.z),u.y),wn(s(c.add($e(o,l.negate())),e.z),s(c.add($e(o,l.mul(2))),e.z),u.y),wn(wn(s(c.add($e(o.negate(),l.negate())),e.z),s(c.add($e(o.mul(2),l.negate())),e.z),u.x),wn(s(c.add($e(o.negate(),l.mul(2))),e.z),s(c.add($e(o.mul(2),l.mul(2))),e.z),u.x),u.y)).mul(1/9)}),CY=le(({depthTexture:i,shadowCoord:e,depthLayer:t})=>{let n=jn(i).sample(e.xy);i.isArrayTexture&&(n=n.depth(t)),n=n.rg;const s=n.x,r=ls(1e-7,n.y.mul(n.y)),a=FC(e.z,s);Wt(a.equal(1),()=>W(1));const o=e.z.sub(s);let l=r.div(r.add(o.mul(o)));return l=Sc(On(l,.3).div(.65)),ls(a,l)}),Jue=le(([i,e,t])=>{let n=Zo.sub(i).length();return n=n.sub(e).div(t.sub(e)),n=n.saturate(),n}),Que=i=>{const e=i.shadow.camera,t=vi("near","float",e).setGroup(Kt),n=vi("far","float",e).setGroup(Kt),s=bX(i);return Jue(s,t,n)},wY=i=>{let e=ZM.get(i);if(e===void 0){const t=i.isPointLight?Que(i):null;e=new Tn,e.colorNode=It(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,ZM.set(i,e)}return e},RY=i=>{const e=ZM.get(i);e!==void 0&&(e.dispose(),ZM.delete(i))},d5=new Ac,N0=[],NY=(i,e,t,n)=>{N0[0]=i,N0[1]=e;let s=d5.get(N0);return(s===void 0||s.shadowType!==t||s.useVelocity!==n)&&(s=(r,a,o,l,c,u,...h)=>{(r.castShadow===!0||r.receiveShadow&&t===Dl)&&(n&&(QU(r).useVelocity=!0),r.onBeforeShadow(i,r,o,e.camera,l,a.overrideMaterial,u),i.renderObject(r,a,o,l,c,u,...h),r.onAfterShadow(i,r,o,e.camera,l,a.overrideMaterial,u))},s.shadowType=t,s.useVelocity=n,d5.set(N0,s)),N0[0]=null,N0[1]=null,s},$ue=le(({samples:i,radius:e,size:t,shadowPass:n,depthLayer:s})=>{const r=W(0).toVar("meanVertical"),a=W(0).toVar("squareMeanVertical"),o=i.lessThanEqual(W(1)).select(W(0),W(2).div(i.sub(1))),l=i.lessThanEqual(W(1)).select(W(0),W(-1));ci({start:te(0),end:te(i),type:"int",condition:"<"},({i:u})=>{const h=l.add(W(u).mul(o));let f=n.sample(zs(wg.xy,$e(0,h).mul(e)).div(t));n.value.isArrayTexture&&(f=f.depth(s)),f=f.x,r.addAssign(f),a.addAssign(f.mul(f))}),r.divAssign(i),a.divAssign(i);const c=ya(a.sub(r.mul(r)).max(0));return $e(r,c)}),ehe=le(({samples:i,radius:e,size:t,shadowPass:n,depthLayer:s})=>{const r=W(0).toVar("meanHorizontal"),a=W(0).toVar("squareMeanHorizontal"),o=i.lessThanEqual(W(1)).select(W(0),W(2).div(i.sub(1))),l=i.lessThanEqual(W(1)).select(W(0),W(-1));ci({start:te(0),end:te(i),type:"int",condition:"<"},({i:u})=>{const h=l.add(W(u).mul(o));let f=n.sample(zs(wg.xy,$e(h,0).mul(e)).div(t));n.value.isArrayTexture&&(f=f.depth(s)),r.addAssign(f.x),a.addAssign(zs(f.y.mul(f.y),f.x.mul(f.x)))}),r.divAssign(i),a.divAssign(i);const c=ya(a.sub(r.mul(r)).max(0));return $e(r,c)}),the=[AY,MY,EY,CY];let M2;const lA=new Aa;class HP extends yY{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:s,shadow:r,depthLayer:a}){const o=s.x.greaterThanEqual(0).and(s.x.lessThanEqual(1)).and(s.y.greaterThanEqual(0)).and(s.y.lessThanEqual(1)).and(s.z.lessThanEqual(1)),l=t({depthTexture:n,shadowCoord:s,shadow:r,depthLayer:a});return o.select(l,W(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:s}=e,r=vi("bias","float",n).setGroup(Kt);let a=t,o;if(n.camera.isOrthographicCamera||s.logarithmicDepthBuffer!==!0)a=a.xyz.div(a.w),o=a.z,s.coordinateSystem===Ka&&(o=o.mul(2).sub(1));else{const l=a.w;a=a.xy.div(l);const c=vi("near","float",n.camera).setGroup(Kt),u=vi("far","float",n.camera).setGroup(Kt);o=fP(l.negate(),c,u)}return a=se(a.x,a.y.oneMinus(),o.add(r)),a}getShadowFilterFn(e){return the[e]}setupRenderTarget(e,t){const n=new tr(e.mapSize.width,e.mapSize.height);n.name="ShadowDepthTexture",n.compareFunction=yg;const s=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return s.texture.name="ShadowMap",s.texture.type=e.mapType,s.depthTexture=n,{shadowMap:s,depthTexture:n}}setupShadow(e){const{renderer:t,camera:n}=e,{light:s,shadow:r}=this,a=t.shadowMap.type,{depthTexture:o,shadowMap:l}=this.setupRenderTarget(r,e);if(r.camera.coordinateSystem=n.coordinateSystem,r.camera.updateProjectionMatrix(),a===Dl&&r.isPointLightShadow!==!0){o.compareFunction=null,l.depth>1?(l._vsmShadowMapVertical||(l._vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Wr,type:ln,depth:l.depth,depthBuffer:!1}),l._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=l._vsmShadowMapVertical,l._vsmShadowMapHorizontal||(l._vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Wr,type:ln,depth:l.depth,depthBuffer:!1}),l._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=l._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Wr,type:ln,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Wr,type:ln,depthBuffer:!1}));let S=jn(o);o.isArrayTexture&&(S=S.depth(this.depthLayer));let T=jn(this.vsmShadowMapVertical.texture);o.isArrayTexture&&(T=T.depth(this.depthLayer));const M=vi("blurSamples","float",r).setGroup(Kt),C=vi("radius","float",r).setGroup(Kt),w=vi("mapSize","vec2",r).setGroup(Kt);let N=this.vsmMaterialVertical||(this.vsmMaterialVertical=new Tn);N.fragmentNode=$ue({samples:M,radius:C,size:w,shadowPass:S,depthLayer:this.depthLayer}).context(e.getSharedContext()),N.name="VSMVertical",N=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new Tn),N.fragmentNode=ehe({samples:M,radius:C,size:w,shadowPass:T,depthLayer:this.depthLayer}).context(e.getSharedContext()),N.name="VSMHorizontal"}const c=vi("intensity","float",r).setGroup(Kt),u=vi("normalBias","float",r).setGroup(Kt),h=ow(s).mul(GP.add(ip.mul(u))),f=this.setupShadowCoord(e,h),m=r.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(m===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const g=a===Dl&&r.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:o,x=this.setupShadowFilter(e,{filterFn:m,shadowTexture:l.texture,depthTexture:g,shadowCoord:f,shadow:r,depthLayer:this.depthLayer});let v;l.texture.isCubeTexture?v=za(l.texture,f.xyz):(v=jn(l.texture,f),o.isArrayTexture&&(v=v.depth(this.depthLayer)));const y=wn(1,x.rgb.mix(v,1),c.mul(v.a)).toVar();this.shadowMap=l,this.shadow.map=l;const b=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return y.toInspector(`${b} / Color`,()=>this.shadowMap.texture.isCubeTexture?za(this.shadowMap.texture):jn(this.shadowMap.texture)).toInspector(`${b} / Depth`,()=>this.shadowMap.texture.isCubeTexture?za(this.shadowMap.texture).r.oneMinus():hs(this.shadowMap.depthTexture,yi().mul(_h(jn(this.shadowMap.depthTexture)))).r.oneMinus())}setup(e){if(e.renderer.shadowMap.enabled!==!1)return le(()=>{const t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let n=this._node;return this.setupShadowPosition(e),n===null&&(this._node=n=this.setupShadow(e),this._currentShadowType=t),e.material.shadowNode&&Se('NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(n=e.material.receivedShadowNode(n)),n})()}renderShadow(e){const{shadow:t,shadowMap:n,light:s}=this,{renderer:r,scene:a}=e;t.updateMatrices(s),n.setSize(t.mapSize.width,t.mapSize.height,n.depth);const o=a.name;a.name=`Shadow Map [ ${s.name||"ID: "+s.id} ]`,r.render(a,t.camera),a.name=o}updateShadow(e){const{shadowMap:t,light:n,shadow:s}=this,{renderer:r,scene:a,camera:o}=e,l=r.shadowMap.type,c=t.depthTexture.version;this._depthVersionCached=c;const u=s.camera.layers.mask;s.camera.layers.mask&4294967294||(s.camera.layers.mask=o.layers.mask);const h=r.getRenderObjectFunction(),f=r.getMRT(),m=f?f.has("velocity"):!1;M2=SY(r,a,M2),a.overrideMaterial=wY(n),r.setRenderObjectFunction(NY(r,s,l,m)),r.setClearColor(0,0),r.setRenderTarget(t),this.renderShadow(e),r.setRenderObjectFunction(h),l===Dl&&s.isPointLightShadow!==!0&&this.vsmPass(r),s.camera.layers.mask=u,TY(r,a,M2)}vsmPass(e){const{shadow:t}=this,n=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,n),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,n),e.setRenderTarget(this.vsmShadowMapVertical),lA.material=this.vsmMaterialVertical,lA.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),lA.material=this.vsmMaterialHorizontal,lA.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,RY(this.light),this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const BY=(i,e)=>new HP(i,e),nhe=new Ye,f5=new Lt,q_=new z,E2=new z,ihe=[new z(1,0,0),new z(-1,0,0),new z(0,-1,0),new z(0,1,0),new z(0,0,1),new z(0,0,-1)],she=[new z(0,-1,0),new z(0,-1,0),new z(0,0,-1),new z(0,0,1),new z(0,-1,0),new z(0,-1,0)],rhe=[new z(1,0,0),new z(-1,0,0),new z(0,1,0),new z(0,-1,0),new z(0,0,1),new z(0,0,-1)],ahe=[new z(0,-1,0),new z(0,-1,0),new z(0,0,1),new z(0,0,-1),new z(0,-1,0),new z(0,-1,0)],DY=le(({depthTexture:i,bd3D:e,dp:t})=>za(i,e).compare(t)),LY=le(({depthTexture:i,bd3D:e,dp:t,shadow:n})=>{const s=vi("radius","float",n).setGroup(Kt),r=vi("mapSize","vec2",n).setGroup(Kt),a=s.div(r.x),o=Pi(e),l=Ya(Dh(e,o.x.greaterThan(o.z).select(se(0,1,0),se(1,0,0)))),c=Dh(e,l),u=RP(wg.xy).mul(6.28318530718),h=mc(0,5,u),f=mc(1,5,u),m=mc(2,5,u),g=mc(3,5,u),x=mc(4,5,u);return za(i,e.add(l.mul(h.x).add(c.mul(h.y)).mul(a))).compare(t).add(za(i,e.add(l.mul(f.x).add(c.mul(f.y)).mul(a))).compare(t)).add(za(i,e.add(l.mul(m.x).add(c.mul(m.y)).mul(a))).compare(t)).add(za(i,e.add(l.mul(g.x).add(c.mul(g.y)).mul(a))).compare(t)).add(za(i,e.add(l.mul(x.x).add(c.mul(x.y)).mul(a))).compare(t)).mul(1/5)}),ohe=le(({filterFn:i,depthTexture:e,shadowCoord:t,shadow:n})=>{const s=t.xyz.toVar(),r=s.length(),a=Yt("float").setGroup(Kt).onRenderUpdate(()=>n.camera.near),o=Yt("float").setGroup(Kt).onRenderUpdate(()=>n.camera.far),l=vi("bias","float",n).setGroup(Kt),c=W(1).toVar();return Wt(r.sub(o).lessThanEqual(0).and(r.sub(a).greaterThanEqual(0)),()=>{const u=r.sub(a).div(o.sub(a)).toVar();u.addAssign(l);const h=s.normalize();c.assign(i({depthTexture:e,bd3D:h,dp:u,shadow:n}))}),c});class lhe extends HP{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===FE?DY:LY}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:s,shadow:r}){return ohe({filterFn:t,depthTexture:n,shadowCoord:s,shadow:r})}setupRenderTarget(e,t){const n=new tC(e.mapSize.width);n.name="PointShadowDepthTexture",n.compareFunction=yg;const s=t.createCubeRenderTarget(e.mapSize.width);return s.texture.name="PointShadowMap",s.depthTexture=n,{shadowMap:s,depthTexture:n}}renderShadow(e){const{shadow:t,shadowMap:n,light:s}=this,{renderer:r,scene:a}=e,o=t.camera,l=t.matrix,c=r.coordinateSystem===Ka,u=c?ihe:rhe,h=c?she:ahe;n.setSize(t.mapSize.width,t.mapSize.width);const f=r.autoClear,m=r.getClearColor(nhe),g=r.getClearAlpha();r.autoClear=!1,r.setClearColor(t.clearColor,t.clearAlpha);for(let x=0;x<6;x++){r.setRenderTarget(n,x),r.clear();const v=s.distance||o.far;v!==o.far&&(o.far=v,o.updateProjectionMatrix()),q_.setFromMatrixPosition(s.matrixWorld),o.position.copy(q_),E2.copy(o.position),E2.add(u[x]),o.up.copy(h[x]),o.lookAt(E2),o.updateMatrixWorld(),l.makeTranslation(-q_.x,-q_.y,-q_.z),f5.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse),t._frustum.setFromProjectionMatrix(f5,o.coordinateSystem,o.reversedDepth);const y=a.name;a.name=`Point Light Shadow [ ${s.name||"ID: "+s.id} ] - Face ${x+1}`,r.render(a,o),a.name=y}r.autoClear=f,r.setClearColor(m,g)}}const UY=(i,e)=>new lhe(i,e);class rp extends Rg{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new Ye,this.colorNode=e&&e.colorNode||Yt(this.color).setGroup(Kt),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=on.FRAME,e&&e.shadow&&(this._shadowDisposeListener=()=>{this.disposeShadow()},e.addEventListener("dispose",this._shadowDisposeListener))}dispose(){this._shadowDisposeListener&&this.light.removeEventListener("dispose",this._shadowDisposeListener),super.dispose()}disposeShadow(){this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null),this.shadowColorNode=null,this.baseColorNode!==null&&(this.colorNode=this.baseColorNode,this.baseColorNode=null)}getHash(){return this.light.uuid}getLightVector(e){return OP(this.light).sub(e.context.positionView||As)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return BY(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const s=this.light.shadow.shadowNode;let r;s!==void 0?r=St(s):r=this.setupShadowNode(),this.shadowNode=r,this.shadowColorNode=n=this.colorNode.mul(r),this.baseColorNode=this.colorNode}e.context.getShadow&&(n=e.context.getShadow(this,e)),this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const kP=le(({lightDistance:i,cutoffDistance:e,decayExponent:t})=>{const n=i.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(n.mul(i.div(e).pow4().oneMinus().clamp().pow2()),n)}),IY=({color:i,lightVector:e,cutoffDistance:t,decayExponent:n})=>{const s=e.normalize(),r=e.length(),a=kP({lightDistance:r,cutoffDistance:t,decayExponent:n}),o=i.mul(a);return{lightDirection:s,lightColor:o}};class PY extends rp{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Yt(0).setGroup(Kt),this.decayExponentNode=Yt(2).setGroup(Kt)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return UY(this.light)}setupDirect(e){return IY({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const che=le(([i=yi()])=>{const e=i.mul(2),t=e.x.floor(),n=e.y.floor();return t.add(n).mod(2).sign()}),uhe=le(([i=yi()],{renderer:e,material:t})=>{const n=UI(i.mul(2).sub(1));let s;if(t.alphaToCoverage&&e.currentSamples>0){const r=W(n.fwidth()).toVar();s=nl(r.oneMinus(),r.add(1),n).oneMinus()}else s=Xr(n.greaterThan(1),0,1);return s}),jv=le(([i,e,t])=>{const n=W(t).toVar(),s=W(e).toVar(),r=jl(i).toVar();return Xr(r,s,n)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),JM=le(([i,e])=>{const t=jl(e).toVar(),n=W(i).toVar();return Xr(t,n.negate(),n)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),Os=le(([i])=>{const e=W(i).toVar();return te(au(e))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),Zi=le(([i,e])=>{const t=W(i).toVar();return e.assign(Os(t)),t.sub(W(e))}),hhe=le(([i,e,t,n,s,r])=>{const a=W(r).toVar(),o=W(s).toVar(),l=W(n).toVar(),c=W(t).toVar(),u=W(e).toVar(),h=W(i).toVar(),f=W(On(1,o)).toVar();return On(1,a).mul(h.mul(f).add(u.mul(o))).add(a.mul(c.mul(f).add(l.mul(o))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),dhe=le(([i,e,t,n,s,r])=>{const a=W(r).toVar(),o=W(s).toVar(),l=se(n).toVar(),c=se(t).toVar(),u=se(e).toVar(),h=se(i).toVar(),f=W(On(1,o)).toVar();return On(1,a).mul(h.mul(f).add(u.mul(o))).add(a.mul(c.mul(f).add(l.mul(o))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),OY=$r([hhe,dhe]),fhe=le(([i,e,t,n,s,r,a,o,l,c,u])=>{const h=W(u).toVar(),f=W(c).toVar(),m=W(l).toVar(),g=W(o).toVar(),x=W(a).toVar(),v=W(r).toVar(),y=W(s).toVar(),b=W(n).toVar(),S=W(t).toVar(),T=W(e).toVar(),M=W(i).toVar(),C=W(On(1,m)).toVar(),w=W(On(1,f)).toVar();return W(On(1,h)).toVar().mul(w.mul(M.mul(C).add(T.mul(m))).add(f.mul(S.mul(C).add(b.mul(m))))).add(h.mul(w.mul(y.mul(C).add(v.mul(m))).add(f.mul(x.mul(C).add(g.mul(m))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),phe=le(([i,e,t,n,s,r,a,o,l,c,u])=>{const h=W(u).toVar(),f=W(c).toVar(),m=W(l).toVar(),g=se(o).toVar(),x=se(a).toVar(),v=se(r).toVar(),y=se(s).toVar(),b=se(n).toVar(),S=se(t).toVar(),T=se(e).toVar(),M=se(i).toVar(),C=W(On(1,m)).toVar(),w=W(On(1,f)).toVar();return W(On(1,h)).toVar().mul(w.mul(M.mul(C).add(T.mul(m))).add(f.mul(S.mul(C).add(b.mul(m))))).add(h.mul(w.mul(y.mul(C).add(v.mul(m))).add(f.mul(x.mul(C).add(g.mul(m))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),FY=$r([fhe,phe]),mhe=le(([i,e,t])=>{const n=W(t).toVar(),s=W(e).toVar(),r=Ze(i).toVar(),a=Ze(r.bitAnd(Ze(7))).toVar(),o=W(jv(a.lessThan(Ze(4)),s,n)).toVar(),l=W(dn(2,jv(a.lessThan(Ze(4)),n,s))).toVar();return JM(o,jl(a.bitAnd(Ze(1)))).add(JM(l,jl(a.bitAnd(Ze(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),ghe=le(([i,e,t,n])=>{const s=W(n).toVar(),r=W(t).toVar(),a=W(e).toVar(),o=Ze(i).toVar(),l=Ze(o.bitAnd(Ze(15))).toVar(),c=W(jv(l.lessThan(Ze(8)),a,r)).toVar(),u=W(jv(l.lessThan(Ze(4)),r,jv(l.equal(Ze(12)).or(l.equal(Ze(14))),a,s))).toVar();return JM(c,jl(l.bitAnd(Ze(1)))).add(JM(u,jl(l.bitAnd(Ze(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),Tr=$r([mhe,ghe]),yhe=le(([i,e,t])=>{const n=W(t).toVar(),s=W(e).toVar(),r=Cg(i).toVar();return se(Tr(r.x,s,n),Tr(r.y,s,n),Tr(r.z,s,n))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),xhe=le(([i,e,t,n])=>{const s=W(n).toVar(),r=W(t).toVar(),a=W(e).toVar(),o=Cg(i).toVar();return se(Tr(o.x,a,r,s),Tr(o.y,a,r,s),Tr(o.z,a,r,s))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),bl=$r([yhe,xhe]),_he=le(([i])=>{const e=W(i).toVar();return dn(.6616,e)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),vhe=le(([i])=>{const e=W(i).toVar();return dn(.982,e)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),bhe=le(([i])=>{const e=se(i).toVar();return dn(.6616,e)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),GY=$r([_he,bhe]),She=le(([i])=>{const e=se(i).toVar();return dn(.982,e)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),zY=$r([vhe,She]),Oo=le(([i,e])=>{const t=te(e).toVar(),n=Ze(i).toVar();return n.shiftLeft(t).bitOr(n.shiftRight(te(32).sub(t)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),VY=le(([i,e,t])=>{i.subAssign(t),i.bitXorAssign(Oo(t,te(4))),t.addAssign(e),e.subAssign(i),e.bitXorAssign(Oo(i,te(6))),i.addAssign(t),t.subAssign(e),t.bitXorAssign(Oo(e,te(8))),e.addAssign(i),i.subAssign(t),i.bitXorAssign(Oo(t,te(16))),t.addAssign(e),e.subAssign(i),e.bitXorAssign(Oo(i,te(19))),i.addAssign(t),t.subAssign(e),t.bitXorAssign(Oo(e,te(4))),e.addAssign(i)}),rT=le(([i,e,t])=>{const n=Ze(t).toVar(),s=Ze(e).toVar(),r=Ze(i).toVar();return n.bitXorAssign(s),n.subAssign(Oo(s,te(14))),r.bitXorAssign(n),r.subAssign(Oo(n,te(11))),s.bitXorAssign(r),s.subAssign(Oo(r,te(25))),n.bitXorAssign(s),n.subAssign(Oo(s,te(16))),r.bitXorAssign(n),r.subAssign(Oo(n,te(4))),s.bitXorAssign(r),s.subAssign(Oo(r,te(14))),n.bitXorAssign(s),n.subAssign(Oo(s,te(24))),n}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),va=le(([i])=>{const e=Ze(i).toVar();return W(e).div(W(Ze(te(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),cu=le(([i])=>{const e=W(i).toVar();return e.mul(e).mul(e).mul(e.mul(e.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),The=le(([i])=>{const e=te(i).toVar(),t=Ze(Ze(1)).toVar(),n=Ze(Ze(te(3735928559)).add(t.shiftLeft(Ze(2))).add(Ze(13))).toVar();return rT(n.add(Ze(e)),n,n)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),Ahe=le(([i,e])=>{const t=te(e).toVar(),n=te(i).toVar(),s=Ze(Ze(2)).toVar(),r=Ze().toVar(),a=Ze().toVar(),o=Ze().toVar();return r.assign(a.assign(o.assign(Ze(te(3735928559)).add(s.shiftLeft(Ze(2))).add(Ze(13))))),r.addAssign(Ze(n)),a.addAssign(Ze(t)),rT(r,a,o)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),Mhe=le(([i,e,t])=>{const n=te(t).toVar(),s=te(e).toVar(),r=te(i).toVar(),a=Ze(Ze(3)).toVar(),o=Ze().toVar(),l=Ze().toVar(),c=Ze().toVar();return o.assign(l.assign(c.assign(Ze(te(3735928559)).add(a.shiftLeft(Ze(2))).add(Ze(13))))),o.addAssign(Ze(r)),l.addAssign(Ze(s)),c.addAssign(Ze(n)),rT(o,l,c)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),Ehe=le(([i,e,t,n])=>{const s=te(n).toVar(),r=te(t).toVar(),a=te(e).toVar(),o=te(i).toVar(),l=Ze(Ze(4)).toVar(),c=Ze().toVar(),u=Ze().toVar(),h=Ze().toVar();return c.assign(u.assign(h.assign(Ze(te(3735928559)).add(l.shiftLeft(Ze(2))).add(Ze(13))))),c.addAssign(Ze(o)),u.addAssign(Ze(a)),h.addAssign(Ze(r)),VY(c,u,h),c.addAssign(Ze(s)),rT(c,u,h)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),Che=le(([i,e,t,n,s])=>{const r=te(s).toVar(),a=te(n).toVar(),o=te(t).toVar(),l=te(e).toVar(),c=te(i).toVar(),u=Ze(Ze(5)).toVar(),h=Ze().toVar(),f=Ze().toVar(),m=Ze().toVar();return h.assign(f.assign(m.assign(Ze(te(3735928559)).add(u.shiftLeft(Ze(2))).add(Ze(13))))),h.addAssign(Ze(c)),f.addAssign(Ze(l)),m.addAssign(Ze(o)),VY(h,f,m),h.addAssign(Ze(a)),f.addAssign(Ze(r)),rT(h,f,m)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),bi=$r([The,Ahe,Mhe,Ehe,Che]),whe=le(([i,e])=>{const t=te(e).toVar(),n=te(i).toVar(),s=Ze(bi(n,t)).toVar(),r=Cg().toVar();return r.x.assign(s.bitAnd(te(255))),r.y.assign(s.shiftRight(te(8)).bitAnd(te(255))),r.z.assign(s.shiftRight(te(16)).bitAnd(te(255))),r}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),Rhe=le(([i,e,t])=>{const n=te(t).toVar(),s=te(e).toVar(),r=te(i).toVar(),a=Ze(bi(r,s,n)).toVar(),o=Cg().toVar();return o.x.assign(a.bitAnd(te(255))),o.y.assign(a.shiftRight(te(8)).bitAnd(te(255))),o.z.assign(a.shiftRight(te(16)).bitAnd(te(255))),o}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),Sl=$r([whe,Rhe]),Nhe=le(([i])=>{const e=$e(i).toVar(),t=te().toVar(),n=te().toVar(),s=W(Zi(e.x,t)).toVar(),r=W(Zi(e.y,n)).toVar(),a=W(cu(s)).toVar(),o=W(cu(r)).toVar(),l=W(OY(Tr(bi(t,n),s,r),Tr(bi(t.add(te(1)),n),s.sub(1),r),Tr(bi(t,n.add(te(1))),s,r.sub(1)),Tr(bi(t.add(te(1)),n.add(te(1))),s.sub(1),r.sub(1)),a,o)).toVar();return GY(l)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),Bhe=le(([i])=>{const e=se(i).toVar(),t=te().toVar(),n=te().toVar(),s=te().toVar(),r=W(Zi(e.x,t)).toVar(),a=W(Zi(e.y,n)).toVar(),o=W(Zi(e.z,s)).toVar(),l=W(cu(r)).toVar(),c=W(cu(a)).toVar(),u=W(cu(o)).toVar(),h=W(FY(Tr(bi(t,n,s),r,a,o),Tr(bi(t.add(te(1)),n,s),r.sub(1),a,o),Tr(bi(t,n.add(te(1)),s),r,a.sub(1),o),Tr(bi(t.add(te(1)),n.add(te(1)),s),r.sub(1),a.sub(1),o),Tr(bi(t,n,s.add(te(1))),r,a,o.sub(1)),Tr(bi(t.add(te(1)),n,s.add(te(1))),r.sub(1),a,o.sub(1)),Tr(bi(t,n.add(te(1)),s.add(te(1))),r,a.sub(1),o.sub(1)),Tr(bi(t.add(te(1)),n.add(te(1)),s.add(te(1))),r.sub(1),a.sub(1),o.sub(1)),l,c,u)).toVar();return zY(h)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),WP=$r([Nhe,Bhe]),Dhe=le(([i])=>{const e=$e(i).toVar(),t=te().toVar(),n=te().toVar(),s=W(Zi(e.x,t)).toVar(),r=W(Zi(e.y,n)).toVar(),a=W(cu(s)).toVar(),o=W(cu(r)).toVar(),l=se(OY(bl(Sl(t,n),s,r),bl(Sl(t.add(te(1)),n),s.sub(1),r),bl(Sl(t,n.add(te(1))),s,r.sub(1)),bl(Sl(t.add(te(1)),n.add(te(1))),s.sub(1),r.sub(1)),a,o)).toVar();return GY(l)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),Lhe=le(([i])=>{const e=se(i).toVar(),t=te().toVar(),n=te().toVar(),s=te().toVar(),r=W(Zi(e.x,t)).toVar(),a=W(Zi(e.y,n)).toVar(),o=W(Zi(e.z,s)).toVar(),l=W(cu(r)).toVar(),c=W(cu(a)).toVar(),u=W(cu(o)).toVar(),h=se(FY(bl(Sl(t,n,s),r,a,o),bl(Sl(t.add(te(1)),n,s),r.sub(1),a,o),bl(Sl(t,n.add(te(1)),s),r,a.sub(1),o),bl(Sl(t.add(te(1)),n.add(te(1)),s),r.sub(1),a.sub(1),o),bl(Sl(t,n,s.add(te(1))),r,a,o.sub(1)),bl(Sl(t.add(te(1)),n,s.add(te(1))),r.sub(1),a,o.sub(1)),bl(Sl(t,n.add(te(1)),s.add(te(1))),r,a.sub(1),o.sub(1)),bl(Sl(t.add(te(1)),n.add(te(1)),s.add(te(1))),r.sub(1),a.sub(1),o.sub(1)),l,c,u)).toVar();return zY(h)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),aT=$r([Dhe,Lhe]),Uhe=le(([i])=>{const e=W(i).toVar(),t=te(Os(e)).toVar();return va(bi(t))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),Ihe=le(([i])=>{const e=$e(i).toVar(),t=te(Os(e.x)).toVar(),n=te(Os(e.y)).toVar();return va(bi(t,n))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),Phe=le(([i])=>{const e=se(i).toVar(),t=te(Os(e.x)).toVar(),n=te(Os(e.y)).toVar(),s=te(Os(e.z)).toVar();return va(bi(t,n,s))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),Ohe=le(([i])=>{const e=It(i).toVar(),t=te(Os(e.x)).toVar(),n=te(Os(e.y)).toVar(),s=te(Os(e.z)).toVar(),r=te(Os(e.w)).toVar();return va(bi(t,n,s,r))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),Fhe=$r([Uhe,Ihe,Phe,Ohe]),Ghe=le(([i])=>{const e=W(i).toVar(),t=te(Os(e)).toVar();return se(va(bi(t,te(0))),va(bi(t,te(1))),va(bi(t,te(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),zhe=le(([i])=>{const e=$e(i).toVar(),t=te(Os(e.x)).toVar(),n=te(Os(e.y)).toVar();return se(va(bi(t,n,te(0))),va(bi(t,n,te(1))),va(bi(t,n,te(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),Vhe=le(([i])=>{const e=se(i).toVar(),t=te(Os(e.x)).toVar(),n=te(Os(e.y)).toVar(),s=te(Os(e.z)).toVar();return se(va(bi(t,n,s,te(0))),va(bi(t,n,s,te(1))),va(bi(t,n,s,te(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),Hhe=le(([i])=>{const e=It(i).toVar(),t=te(Os(e.x)).toVar(),n=te(Os(e.y)).toVar(),s=te(Os(e.z)).toVar(),r=te(Os(e.w)).toVar();return se(va(bi(t,n,s,r,te(0))),va(bi(t,n,s,r,te(1))),va(bi(t,n,s,r,te(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),cw=$r([Ghe,zhe,Vhe,Hhe]),QM=le(([i,e,t,n])=>{const s=W(n).toVar(),r=W(t).toVar(),a=te(e).toVar(),o=se(i).toVar(),l=W(0).toVar(),c=W(1).toVar();return ci(a,()=>{l.addAssign(c.mul(WP(o))),c.mulAssign(s),o.mulAssign(r)}),l}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),uw=le(([i,e,t,n])=>{const s=W(n).toVar(),r=W(t).toVar(),a=te(e).toVar(),o=se(i).toVar(),l=se(0).toVar(),c=W(1).toVar();return ci(a,()=>{l.addAssign(c.mul(aT(o))),c.mulAssign(s),o.mulAssign(r)}),l}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),khe=le(([i,e,t,n])=>{const s=W(n).toVar(),r=W(t).toVar(),a=te(e).toVar(),o=se(i).toVar();return $e(QM(o,a,r,s),QM(o.add(se(te(19),te(193),te(17))),a,r,s))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Whe=le(([i,e,t,n])=>{const s=W(n).toVar(),r=W(t).toVar(),a=te(e).toVar(),o=se(i).toVar(),l=se(uw(o,a,r,s)).toVar(),c=W(QM(o.add(se(te(19),te(193),te(17))),a,r,s)).toVar();return It(l,c)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Xhe=le(([i,e,t,n,s,r,a])=>{const o=te(a).toVar(),l=W(r).toVar(),c=te(s).toVar(),u=te(n).toVar(),h=te(t).toVar(),f=te(e).toVar(),m=$e(i).toVar(),g=se(cw($e(f.add(u),h.add(c)))).toVar(),x=$e(g.x,g.y).toVar();x.subAssign(.5),x.mulAssign(l),x.addAssign(.5);const v=$e($e(W(f),W(h)).add(x)).toVar(),y=$e(v.sub(m)).toVar();return Wt(o.equal(te(2)),()=>Pi(y.x).add(Pi(y.y))),Wt(o.equal(te(3)),()=>ls(Pi(y.x),Pi(y.y))),Yl(y,y)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),qhe=le(([i,e,t,n,s,r,a,o,l])=>{const c=te(l).toVar(),u=W(o).toVar(),h=te(a).toVar(),f=te(r).toVar(),m=te(s).toVar(),g=te(n).toVar(),x=te(t).toVar(),v=te(e).toVar(),y=se(i).toVar(),b=se(cw(se(v.add(m),x.add(f),g.add(h)))).toVar();b.subAssign(.5),b.mulAssign(u),b.addAssign(.5);const S=se(se(W(v),W(x),W(g)).add(b)).toVar(),T=se(S.sub(y)).toVar();return Wt(c.equal(te(2)),()=>Pi(T.x).add(Pi(T.y)).add(Pi(T.z))),Wt(c.equal(te(3)),()=>ls(Pi(T.x),Pi(T.y),Pi(T.z))),Yl(T,T)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Hx=$r([Xhe,qhe]),jhe=le(([i,e,t])=>{const n=te(t).toVar(),s=W(e).toVar(),r=$e(i).toVar(),a=te().toVar(),o=te().toVar(),l=$e(Zi(r.x,a),Zi(r.y,o)).toVar(),c=W(1e6).toVar();return ci({start:-1,end:te(1),name:"x",condition:"<="},({x:u})=>{ci({start:-1,end:te(1),name:"y",condition:"<="},({y:h})=>{const f=W(Hx(l,u,h,a,o,s,n)).toVar();c.assign(fo(c,f))})}),Wt(n.equal(te(0)),()=>{c.assign(ya(c))}),c}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Yhe=le(([i,e,t])=>{const n=te(t).toVar(),s=W(e).toVar(),r=$e(i).toVar(),a=te().toVar(),o=te().toVar(),l=$e(Zi(r.x,a),Zi(r.y,o)).toVar(),c=$e(1e6,1e6).toVar();return ci({start:-1,end:te(1),name:"x",condition:"<="},({x:u})=>{ci({start:-1,end:te(1),name:"y",condition:"<="},({y:h})=>{const f=W(Hx(l,u,h,a,o,s,n)).toVar();Wt(f.lessThan(c.x),()=>{c.y.assign(c.x),c.x.assign(f)}).ElseIf(f.lessThan(c.y),()=>{c.y.assign(f)})})}),Wt(n.equal(te(0)),()=>{c.assign(ya(c))}),c}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Khe=le(([i,e,t])=>{const n=te(t).toVar(),s=W(e).toVar(),r=$e(i).toVar(),a=te().toVar(),o=te().toVar(),l=$e(Zi(r.x,a),Zi(r.y,o)).toVar(),c=se(1e6,1e6,1e6).toVar();return ci({start:-1,end:te(1),name:"x",condition:"<="},({x:u})=>{ci({start:-1,end:te(1),name:"y",condition:"<="},({y:h})=>{const f=W(Hx(l,u,h,a,o,s,n)).toVar();Wt(f.lessThan(c.x),()=>{c.z.assign(c.y),c.y.assign(c.x),c.x.assign(f)}).ElseIf(f.lessThan(c.y),()=>{c.z.assign(c.y),c.y.assign(f)}).ElseIf(f.lessThan(c.z),()=>{c.z.assign(f)})})}),Wt(n.equal(te(0)),()=>{c.assign(ya(c))}),c}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Zhe=le(([i,e,t])=>{const n=te(t).toVar(),s=W(e).toVar(),r=se(i).toVar(),a=te().toVar(),o=te().toVar(),l=te().toVar(),c=se(Zi(r.x,a),Zi(r.y,o),Zi(r.z,l)).toVar(),u=W(1e6).toVar();return ci({start:-1,end:te(1),name:"x",condition:"<="},({x:h})=>{ci({start:-1,end:te(1),name:"y",condition:"<="},({y:f})=>{ci({start:-1,end:te(1),name:"z",condition:"<="},({z:m})=>{const g=W(Hx(c,h,f,m,a,o,l,s,n)).toVar();u.assign(fo(u,g))})})}),Wt(n.equal(te(0)),()=>{u.assign(ya(u))}),u}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Jhe=$r([jhe,Zhe]),Qhe=le(([i,e,t])=>{const n=te(t).toVar(),s=W(e).toVar(),r=se(i).toVar(),a=te().toVar(),o=te().toVar(),l=te().toVar(),c=se(Zi(r.x,a),Zi(r.y,o),Zi(r.z,l)).toVar(),u=$e(1e6,1e6).toVar();return ci({start:-1,end:te(1),name:"x",condition:"<="},({x:h})=>{ci({start:-1,end:te(1),name:"y",condition:"<="},({y:f})=>{ci({start:-1,end:te(1),name:"z",condition:"<="},({z:m})=>{const g=W(Hx(c,h,f,m,a,o,l,s,n)).toVar();Wt(g.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(g)}).ElseIf(g.lessThan(u.y),()=>{u.y.assign(g)})})})}),Wt(n.equal(te(0)),()=>{u.assign(ya(u))}),u}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),$he=$r([Yhe,Qhe]),ede=le(([i,e,t])=>{const n=te(t).toVar(),s=W(e).toVar(),r=se(i).toVar(),a=te().toVar(),o=te().toVar(),l=te().toVar(),c=se(Zi(r.x,a),Zi(r.y,o),Zi(r.z,l)).toVar(),u=se(1e6,1e6,1e6).toVar();return ci({start:-1,end:te(1),name:"x",condition:"<="},({x:h})=>{ci({start:-1,end:te(1),name:"y",condition:"<="},({y:f})=>{ci({start:-1,end:te(1),name:"z",condition:"<="},({z:m})=>{const g=W(Hx(c,h,f,m,a,o,l,s,n)).toVar();Wt(g.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(g)}).ElseIf(g.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(g)}).ElseIf(g.lessThan(u.z),()=>{u.z.assign(g)})})})}),Wt(n.equal(te(0)),()=>{u.assign(ya(u))}),u}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),XP=$r([Khe,ede]),tde=le(([i,e,t,n,s,r,a,o,l,c,u])=>{const h=te(i).toVar(),f=$e(e).toVar(),m=$e(t).toVar(),g=$e(n).toVar(),x=W(s).toVar(),v=W(r).toVar(),y=W(a).toVar(),b=jl(o).toVar(),S=te(l).toVar(),T=W(c).toVar(),M=W(u).toVar(),C=f.mul(m).add(g),w=W(0).toVar();return Wt(h.equal(te(0)),()=>{w.assign(aT(C))}),Wt(h.equal(te(1)),()=>{w.assign(cw(C))}),Wt(h.equal(te(2)),()=>{w.assign(XP(C,x,te(0)))}),Wt(h.equal(te(3)),()=>{w.assign(uw(se(C,0),S,T,M))}),w.assign(w.mul(y.sub(v)).add(v)),Wt(b,()=>{w.assign(Sc(w,v,y))}),w}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),nde=le(([i,e,t,n,s,r,a,o,l,c,u])=>{const h=te(i).toVar(),f=se(e).toVar(),m=se(t).toVar(),g=se(n).toVar(),x=W(s).toVar(),v=W(r).toVar(),y=W(a).toVar(),b=jl(o).toVar(),S=te(l).toVar(),T=W(c).toVar(),M=W(u).toVar(),C=f.mul(m).add(g),w=W(0).toVar();return Wt(h.equal(te(0)),()=>{w.assign(aT(C))}),Wt(h.equal(te(1)),()=>{w.assign(cw(C))}),Wt(h.equal(te(2)),()=>{w.assign(XP(C,x,te(0)))}),Wt(h.equal(te(3)),()=>{w.assign(uw(C,S,T,M))}),w.assign(w.mul(y.sub(v)).add(v)),Wt(b,()=>{w.assign(Sc(w,v,y))}),w}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),ide=le(([i])=>{const e=i.y,t=i.z,n=se().toVar();return Wt(e.lessThan(1e-4),()=>{n.assign(se(t,t,t))}).Else(()=>{let s=i.x;s=s.sub(au(s)).mul(6).toVar();const r=te(NI(s)),a=s.sub(W(r)),o=t.mul(e.oneMinus()),l=t.mul(e.mul(a).oneMinus()),c=t.mul(e.mul(a.oneMinus()).oneMinus());Wt(r.equal(te(0)),()=>{n.assign(se(t,c,o))}).ElseIf(r.equal(te(1)),()=>{n.assign(se(l,t,o))}).ElseIf(r.equal(te(2)),()=>{n.assign(se(o,t,c))}).ElseIf(r.equal(te(3)),()=>{n.assign(se(o,l,t))}).ElseIf(r.equal(te(4)),()=>{n.assign(se(c,o,t))}).Else(()=>{n.assign(se(t,o,l))})}),n}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),sde=le(([i])=>{const e=se(i).toVar(),t=W(e.x).toVar(),n=W(e.y).toVar(),s=W(e.z).toVar(),r=W(fo(t,fo(n,s))).toVar(),a=W(ls(t,ls(n,s))).toVar(),o=W(a.sub(r)).toVar(),l=W().toVar(),c=W().toVar(),u=W().toVar();return u.assign(a),Wt(a.greaterThan(0),()=>{c.assign(o.div(a))}).Else(()=>{c.assign(0)}),Wt(c.lessThanEqual(0),()=>{l.assign(0)}).Else(()=>{Wt(t.greaterThanEqual(a),()=>{l.assign(n.sub(s).div(o))}).ElseIf(n.greaterThanEqual(a),()=>{l.assign(zs(2,s.sub(t).div(o)))}).Else(()=>{l.assign(zs(4,t.sub(n).div(o)))}),l.mulAssign(1/6),Wt(l.lessThan(0),()=>{l.addAssign(1)})}),se(l,c,u)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),rde=le(([i])=>{const e=se(i).toVar(),t=hI(bI(e,se(.04045))).toVar(),n=se(e.div(12.92)).toVar(),s=se(Il(ls(e.add(se(.055)),se(0)).div(1.055),se(2.4))).toVar();return wn(n,s,t)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),HY=(i,e)=>{i=W(i),e=W(e);const t=$e(e.dFdx(),e.dFdy()).length().mul(.7071067811865476);return nl(i.sub(t),i.add(t),e)},kY=(i,e,t,n)=>wn(i,e,t[n].clamp()),ade=(i,e,t=yi())=>kY(i,e,t,"x"),ode=(i,e,t=yi())=>kY(i,e,t,"y"),lde=(i,e,t,n,s=yi())=>{const r=s.x.clamp(),a=s.y.clamp(),o=wn(i,e,r),l=wn(t,n,r);return wn(o,l,a)},WY=(i,e,t,n,s)=>wn(i,e,HY(t,n[s])),cde=(i,e,t,n=yi())=>WY(i,e,t,n,"x"),ude=(i,e,t,n=yi())=>WY(i,e,t,n,"y"),hde=(i=1,e=0,t=yi())=>t.mul(i).add(e),dde=(i,e=1)=>(i=W(i),i.abs().pow(e).mul(i.sign())),fde=(i,e=1,t=.5)=>W(i).sub(t).mul(e).add(t),pde=(i=yi(),e=1,t=0)=>WP(i.convert("vec2|vec3")).mul(e).add(t),mde=(i=yi(),e=1,t=0)=>aT(i.convert("vec2|vec3")).mul(e).add(t),gde=(i=yi(),e=1,t=0)=>(i=i.convert("vec2|vec3"),It(aT(i),WP(i.add($e(19,73)))).mul(e).add(t)),yde=(i,e=yi(),t=$e(1,1),n=$e(0,0),s=1,r=0,a=1,o=!1,l=1,c=2,u=.5)=>tde(i,e.convert("vec2|vec3"),t,n,s,r,a,o,l,c,u),xde=(i,e=yi(),t=$e(1,1),n=$e(0,0),s=1,r=0,a=1,o=!1,l=1,c=2,u=.5)=>nde(i,e.convert("vec2|vec3"),t,n,s,r,a,o,l,c,u),_de=(i=yi(),e=1)=>Jhe(i.convert("vec2|vec3"),e,te(1)),vde=(i=yi(),e=1)=>$he(i.convert("vec2|vec3"),e,te(1)),bde=(i=yi(),e=1)=>XP(i.convert("vec2|vec3"),e,te(1)),Sde=(i=yi())=>Fhe(i.convert("vec2|vec3")),Tde=(i=yi(),e=3,t=2,n=.5,s=1)=>QM(i,te(e),t,n).mul(s),Ade=(i=yi(),e=3,t=2,n=.5,s=1)=>khe(i,te(e),t,n).mul(s),Mde=(i=yi(),e=3,t=2,n=.5,s=1)=>uw(i,te(e),t,n).mul(s),Ede=(i=yi(),e=3,t=2,n=.5,s=1)=>Whe(i,te(e),t,n).mul(s),Cde=(i,e=W(0))=>zs(i,e),wde=(i,e=W(0))=>On(i,e),Rde=(i,e=W(1))=>dn(i,e),Nde=(i,e=W(1))=>tl(i,e),Bde=(i,e=W(1))=>QS(i,e),Dde=(i,e=W(1))=>Il(i,e),Lde=(i=W(0),e=W(1))=>OC(i,e),Ude=()=>Vx,Ide=()=>zj,Pde=(i,e=W(1))=>On(e,i),Ode=(i,e,t,n)=>i.greaterThan(e).mix(t,n),Fde=(i,e,t,n)=>i.greaterThanEqual(e).mix(t,n),Gde=(i,e,t,n)=>i.equal(e).mix(t,n),zde=(i,e=null)=>{if(typeof e=="string"){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},n=e.replace(/^out/,"").toLowerCase();if(t[n]!==void 0)return i.element(t[n])}if(typeof e=="number")return i.element(e);if(typeof e=="string"&&e.length===1){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(t[e]!==void 0)return i.element(t[e])}return i},Vde=(i,e=$e(.5,.5),t=$e(1,1),n=W(0),s=$e(0,0))=>{let r=i;if(e&&(r=r.sub(e)),t&&(r=r.mul(t)),n){const a=n.mul(Math.PI/180),o=a.cos(),l=a.sin();r=$e(r.x.mul(o).sub(r.y.mul(l)),r.x.mul(l).add(r.y.mul(o)))}return e&&(r=r.add(e)),s&&(r=r.add(s)),r},Hde=(i,e)=>{i=$e(i),e=W(e);const t=e.mul(Math.PI/180);return iT(i,t)},kde=(i,e,t)=>{i=se(i),e=W(e),t=se(t);const n=e.mul(Math.PI/180),s=t.normalize(),r=n.cos(),a=n.sin(),o=W(1).sub(r);return i.mul(r).add(s.cross(i).mul(a)).add(s.mul(s.dot(i)).mul(o))},Wde=(i,e)=>(i=se(i),e=W(e),tP(i,e)),Xde=le(([i,e,t])=>{const n=Ya(i).toVar(),s=On(W(.5).mul(e.sub(t)),Zo).div(n).toVar(),r=On(W(-.5).mul(e.sub(t)),Zo).div(n).toVar(),a=se().toVar();a.x=n.x.greaterThan(W(0)).select(s.x,r.x),a.y=n.y.greaterThan(W(0)).select(s.y,r.y),a.z=n.z.greaterThan(W(0)).select(s.z,r.z);const o=fo(a.x,a.y,a.z).toVar();return Zo.add(n.mul(o)).toVar().sub(t)}),XY=le(([i,e])=>{const t=i.x,n=i.y,s=i.z;let r=e.element(0).mul(.886227);return r=r.add(e.element(1).mul(2*.511664).mul(n)),r=r.add(e.element(2).mul(2*.511664).mul(s)),r=r.add(e.element(3).mul(2*.511664).mul(t)),r=r.add(e.element(4).mul(2*.429043).mul(t).mul(n)),r=r.add(e.element(5).mul(2*.429043).mul(n).mul(s)),r=r.add(e.element(6).mul(s.mul(s).mul(.743125).sub(.247708))),r=r.add(e.element(7).mul(2*.429043).mul(t).mul(s)),r=r.add(e.element(8).mul(.429043).mul(dn(t,t).sub(dn(n,n)))),r});var D=Object.freeze({__proto__:null,BRDF_GGX:_P,BRDF_Lambert:sg,BasicPointShadowFilter:DY,BasicShadowFilter:AY,Break:Iq,Const:W7,Continue:vae,DFGLUT:Lb,D_GGX:uj,Discard:dX,EPSILON:SI,F_Schlick:Qy,Fn:le,HALF_PI:gre,INFINITY:fre,If:Wt,Loop:ci,NodeAccess:wr,NodeShaderStage:iy,NodeType:BW,NodeUpdateType:on,OnBeforeMaterialUpdate:xce,OnBeforeObjectUpdate:yce,OnMaterialUpdate:gce,OnObjectUpdate:mce,PCFShadowFilter:MY,PCFSoftShadowFilter:EY,PI:WM,PI2:pre,PointShadowFilter:LY,Return:Mre,Schlick_to_F0:jD,ScriptableNodeResources:qA,ShaderNode:sy,Stack:BC,Switch:are,TBNViewMatrix:hm,TWO_PI:mre,VSMShadowFilter:CY,V_GGX_SmithCorrelated:cj,Var:k7,VarIntent:X7,abs:Pi,acesFilmicToneMapping:aY,acos:MI,add:zs,addMethodChaining:Ue,addNodeElement:Cre,agxToneMapping:oY,all:m7,alphaT:VM,and:e7,anisotropy:Md,anisotropyB:Em,anisotropyT:zv,any:g7,append:ure,array:XW,arrayBuffer:lre,asin:v7,assign:jW,atan:OC,atan2:F7,atomicAdd:mue,atomicAnd:_ue,atomicFunc:Au,atomicLoad:fue,atomicMax:yue,atomicMin:xue,atomicOr:vue,atomicStore:pue,atomicSub:gue,atomicXor:bue,attenuationColor:gI,attenuationDistance:mI,attribute:Ua,attributeArray:_ce,backgroundBlurriness:jj,backgroundIntensity:QD,backgroundRotation:Yj,batch:Dq,bentNormalView:YX,billboarding:ece,bitAnd:s7,bitNot:r7,bitOr:a7,bitXor:o7,bitangentGeometry:aae,bitangentLocal:oae,bitangentView:qX,bitangentWorld:lae,bitcast:Oj,blendBurn:qq,blendColor:Bae,blendDodge:jq,blendOverlay:Kq,blendScreen:Yq,blur:yj,bool:jl,buffer:$S,bufferAttribute:VI,builtin:Wh,builtinAOContext:V7,builtinShadowContext:z7,bumpMap:tP,burn:Lae,bvec2:GW,bvec3:hI,bvec4:zW,bypass:cX,cache:oX,call:KW,cameraFar:nh,cameraIndex:np,cameraNear:th,cameraNormalMatrix:Gre,cameraPosition:Wv,cameraProjectionMatrix:Ia,cameraProjectionMatrixInverse:Ore,cameraViewMatrix:ll,cameraViewport:zre,cameraWorldMatrix:Fre,cbrt:L7,cdl:Lce,ceil:PC,checker:che,cineonToneMapping:rY,clamp:Sc,clearcoat:FM,clearcoatNormalView:um,clearcoatRoughness:Bb,code:rw,color:FW,colorSpaceToWorking:VC,colorToDirection:uae,compute:rX,computeKernel:HI,computeSkinning:_ae,context:kh,convert:HW,convertColorSpace:bre,convertToTexture:uce,cos:fc,countLeadingZeros:Ble,countOneBits:Dle,countTrailingZeros:Nle,cross:Dh,cubeTexture:za,cubeTextureBase:eP,dFdx:wI,dFdy:RI,dashSize:Cm,debug:mX,decrement:f7,decrementBefore:h7,defaultBuildStages:PM,defaultShaderStages:tI,defined:Rb,degrees:x7,deltaTime:qle,densityFog:Jce,densityFogFactor:UP,depth:pP,depthPass:Oce,determinant:M7,difference:N7,diffuseColor:pi,diffuseContribution:nm,directPointLight:IY,directionToColor:KX,directionToFaceDirection:Fx,dispersion:yI,disposeShadowMaterial:RY,distance:R7,div:tl,dodge:Uae,dot:Yl,drawIndex:wq,dynamicBufferAttribute:Are,element:VW,emissive:PD,equal:vI,equals:C7,equirectUV:mP,exp:TI,exp2:Ky,expression:Lh,faceDirection:JI,faceForward:PI,faceforward:yre,float:W,floatBitsToInt:Cle,floatBitsToUint:Fj,floor:au,fog:Ib,fract:bc,frameGroup:WW,frameId:zj,frontFacing:EX,fwidth:BI,gain:Ule,gapSize:Db,getConstNodeType:OW,getCurrentStack:lI,getDirection:mj,getDistanceAttenuation:kP,getGeometryRoughness:lj,getNormalFromDepth:dce,getParallaxCorrectNormal:Xde,getRoughness:xP,getScreenPosition:hce,getShIrradianceAt:XY,getShadowMaterial:wY,getShadowRenderObjectFunction:NY,getTextureIndex:Uj,getViewPosition:k0,ggxConvolution:xj,globalId:nue,glsl:Xce,glslFn:qce,grayscale:Rce,greaterThan:bI,greaterThanEqual:$W,hash:Lle,highpModelNormalViewMatrix:zD,highpModelViewMatrix:GD,hue:Dce,increment:d7,incrementBefore:u7,inspector:gX,instance:xae,instanceIndex:lu,instancedArray:vce,instancedBufferAttribute:XM,instancedDynamicBufferAttribute:FD,instancedMesh:Nq,int:te,intBitsToFloat:wle,interleavedGradientNoise:RP,inverse:E7,inverseSqrt:AI,inversesqrt:xre,invocationLocalIndex:yae,invocationSubgroupIndex:gae,ior:Vv,iridescence:LC,iridescenceIOR:GM,iridescenceThickness:zM,isolate:Ty,ivec2:js,ivec3:uI,ivec4:dI,js:kce,label:H7,length:ou,lengthSq:UI,lessThan:JW,lessThanEqual:QW,lightPosition:PP,lightProjectionUV:mY,lightShadowMatrix:ow,lightTargetDirection:FP,lightTargetPosition:gY,lightViewPosition:OP,lightingContext:zq,lights:Kue,linearDepth:Jy,linearToneMapping:iY,localId:iue,log:IC,log2:ru,logarithmicDepthToViewZ:Aae,luminance:BP,mat2:DC,mat3:Qr,mat4:rf,matcapUV:Tj,materialAO:Tq,materialAlphaTest:QX,materialAnisotropy:dq,materialAnisotropyVector:H0,materialAttenuationColor:vq,materialAttenuationDistance:_q,materialClearcoat:aq,materialClearcoatNormal:lq,materialClearcoatRoughness:oq,materialColor:jM,materialDispersion:Sq,materialEmissive:eq,materialEnvIntensity:VA,materialEnvRotation:$I,materialIOR:xq,materialIridescence:fq,materialIridescenceIOR:pq,materialIridescenceThickness:mq,materialLightMap:aP,materialLineDashOffset:rP,materialLineDashSize:iP,materialLineGapSize:sP,materialLineScale:nP,materialLineWidth:kA,materialMetalness:sq,materialNormal:rq,materialOpacity:KC,materialPointSize:bq,materialReference:ih,materialReflectivity:HA,materialRefractionRatio:NX,materialRotation:cq,materialRoughness:iq,materialSheen:uq,materialSheenRoughness:hq,materialShininess:$X,materialSpecular:tq,materialSpecularColor:nq,materialSpecularIntensity:qD,materialSpecularStrength:Xv,materialThickness:yq,materialTransmission:gq,max:ls,maxMipLevel:qI,mediumpModelViewMatrix:AX,metalness:ph,min:fo,mix:wn,mixElement:I7,mod:QS,modInt:p7,modelDirection:qre,modelNormalMatrix:TX,modelPosition:jre,modelRadius:SX,modelScale:Yre,modelViewMatrix:gu,modelViewPosition:Kre,modelViewProjection:Aq,modelWorldMatrix:Pl,modelWorldMatrixInverse:Zre,morphReference:Oq,mrt:Pj,mul:dn,mx_aastep:HY,mx_add:Cde,mx_atan2:Lde,mx_cell_noise_float:Sde,mx_contrast:fde,mx_divide:Nde,mx_fractal_noise_float:Tde,mx_fractal_noise_vec2:Ade,mx_fractal_noise_vec3:Mde,mx_fractal_noise_vec4:Ede,mx_frame:Ide,mx_heighttonormal:Wde,mx_hsvtorgb:ide,mx_ifequal:Gde,mx_ifgreater:Ode,mx_ifgreatereq:Fde,mx_invert:Pde,mx_modulo:Bde,mx_multiply:Rde,mx_noise_float:pde,mx_noise_vec3:mde,mx_noise_vec4:gde,mx_place2d:Vde,mx_power:Dde,mx_ramp4:lde,mx_ramplr:ade,mx_ramptb:ode,mx_rgbtohsv:sde,mx_rotate2d:Hde,mx_rotate3d:kde,mx_safepower:dde,mx_separate:zde,mx_splitlr:cde,mx_splittb:ude,mx_srgb_texture_to_lin_rec709:rde,mx_subtract:wde,mx_timer:Ude,mx_transform_uv:hde,mx_unifiednoise2d:yde,mx_unifiednoise3d:xde,mx_worley_noise_float:_de,mx_worley_noise_vec2:vde,mx_worley_noise_vec3:bde,negate:CI,neutralToneMapping:lY,nodeArray:Mm,nodeImmutable:_t,nodeObject:St,nodeObjectIntent:dv,nodeObjects:NC,nodeProxy:fn,nodeProxyIntent:ot,normalFlat:CX,normalGeometry:XC,normalLocal:po,normalMap:XD,normalView:kn,normalViewGeometry:Zy,normalWorld:ip,normalWorldGeometry:wX,normalize:Ya,not:n7,notEqual:ZW,numWorkgroups:eue,objectDirection:Vre,objectGroup:_I,objectPosition:bX,objectRadius:Xre,objectScale:kre,objectViewPosition:Wre,objectWorldMatrix:Hre,oneMinus:b7,or:t7,orthographicDepthToViewZ:Tae,oscSawtooth:Zle,oscSine:jle,oscSquare:Yle,oscTriangle:Kle,output:by,outputStruct:Ele,overlay:Pae,overloadingFn:$r,packHalf2x16:Gle,packSnorm2x16:Ole,packUnorm2x16:Fle,parabola:JD,parallaxDirection:jX,parallaxUV:cae,parameter:Tle,pass:Ice,passTexture:Pce,pcurve:Ile,perspectiveDepthToViewZ:dP,pmremTexture:bP,pointShadow:UY,pointUV:bce,pointWidth:hre,positionGeometry:zr,positionLocal:ss,positionPrevious:qM,positionView:As,positionViewDirection:_i,positionWorld:Zo,positionWorldDirection:ZI,posterize:Uce,pow:Il,pow2:DI,pow3:B7,pow4:LI,premultiplyAlpha:Zq,property:xc,quadBroadcast:que,quadSwapDiagonal:zue,quadSwapX:Fue,quadSwapY:Gue,radians:y7,rand:U7,range:Qce,rangeFog:Zce,rangeFogFactor:LP,reciprocal:T7,reference:vi,referenceBuffer:VD,reflect:w7,reflectVector:LX,reflectView:BX,reflector:ace,refract:II,refractVector:UX,refractView:DX,reinhardToneMapping:sY,remap:uX,remapClamp:hX,renderGroup:Kt,renderOutput:WI,rendererReference:eX,replaceDefaultUV:Jle,rotate:iT,rotateUV:Qle,roughness:Wc,round:S7,rtt:Wj,sRGBTransferEOTF:K7,sRGBTransferOETF:Z7,sample:pce,sampler:Bre,samplerComparison:Dre,saturate:GC,saturation:Nce,screen:Iae,screenCoordinate:wg,screenDPR:YI,screenSize:ig,screenUV:vh,scriptable:Kce,scriptableValue:XA,select:Xr,setCurrentStack:Nb,setName:FI,shaderStages:OM,shadow:BY,shadowPositionWorld:GP,shapeCircle:uhe,sharedUniformGroup:UC,sheen:Uo,sheenRoughness:Nd,shiftLeft:l7,shiftRight:c7,shininess:HM,sign:EI,sin:La,sinc:Ple,skinning:Lq,smoothstep:nl,smoothstepElement:P7,specularColor:kf,specularColorBlended:cm,specularF90:vy,spherizeUV:$le,split:cre,spritesheetUV:nce,sqrt:ya,stack:WA,step:FC,stepElement:O7,storage:bh,storageBarrier:oue,storageObject:pae,storageTexture:Zj,string:ore,struct:Mle,sub:On,subBuild:Sy,subgroupAdd:Aue,subgroupAll:Iue,subgroupAnd:Nue,subgroupAny:Pue,subgroupBallot:Tue,subgroupBroadcast:Vue,subgroupBroadcastFirst:Oue,subgroupElect:Sue,subgroupExclusiveAdd:Eue,subgroupExclusiveMul:Rue,subgroupInclusiveAdd:Mue,subgroupInclusiveMul:wue,subgroupIndex:mae,subgroupMax:Uue,subgroupMin:Lue,subgroupMul:Cue,subgroupOr:Bue,subgroupShuffle:Hue,subgroupShuffleDown:Xue,subgroupShuffleUp:Wue,subgroupShuffleXor:kue,subgroupSize:sue,subgroupXor:Due,tan:_7,tangentGeometry:qC,tangentLocal:tT,tangentView:jC,tangentWorld:XX,texture:jn,texture3D:sw,texture3DLevel:Mce,texture3DLoad:Ace,textureBarrier:lue,textureBicubic:ooe,textureBicubicLevel:vP,textureCubeUV:gj,textureLevel:Nre,textureLoad:hs,textureSize:_h,textureStore:Sce,thickness:pI,time:Vx,toneMapping:nX,toneMappingExposure:iX,toonOutlinePass:Fce,transformDirection:D7,transformNormal:RX,transformNormalToView:QI,transformedClearcoatNormalView:$re,transformedNormalView:Jre,transformedNormalWorld:Qre,transmission:kM,transpose:A7,triNoise3D:Wle,triplanarTexture:ice,triplanarTextures:Hj,trunc:NI,uint:Ze,uintBitsToFloat:Rle,uniform:Yt,uniformArray:da,uniformCubeTexture:eae,uniformFlow:G7,uniformGroup:kW,uniformTexture:Rre,unpackHalf2x16:Hle,unpackNormal:WD,unpackSnorm2x16:zle,unpackUnorm2x16:Vle,unpremultiplyAlpha:Dae,userData:Ece,uv:yi,uvec2:cI,uvec3:Cg,uvec4:fI,varying:Tu,varyingProperty:Po,vec2:$e,vec3:se,vec4:It,vectorComponents:ep,velocity:wce,vertexColor:Xq,vertexIndex:Cq,vertexStage:Y7,vibrance:Bce,viewZToLogarithmicDepth:fP,viewZToOrthographicDepth:My,viewZToPerspectiveDepth:hP,viewport:Ay,viewportCoordinate:vX,viewportDepthTexture:uP,viewportLinearDepth:Mae,viewportMipTexture:cP,viewportResolution:Pre,viewportSafeUV:tce,viewportSharedTexture:ej,viewportSize:KI,viewportTexture:Sae,viewportUV:Ire,vogelDiskSample:mc,wgsl:Wce,wgslFn:jce,workgroupArray:hue,workgroupBarrier:aue,workgroupId:tue,workingToColorSpace:J7,xor:i7});const ac=new AP;class qde extends sp{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const s=this.renderer,r=this.nodes.getBackgroundNode(e)||e.background;let a=!1;if(r===null)s._clearColor.getRGB(ac),ac.a=s._clearColor.a;else if(r.isColor===!0)r.getRGB(ac),ac.a=1,a=!0;else if(r.isNode===!0){const c=this.get(e),u=r;ac.copy(s._clearColor);let h=c.backgroundMesh;if(h===void 0){let S=function(){r.removeEventListener("dispose",S),h.material.dispose(),h.geometry.dispose()};var l=S;const m=It(u).mul(QD).context({getUV:()=>Yj.mul(wX),getTextureLevel:()=>jj}),g=Ia.element(3).element(3).equal(1),x=tl(1,Ia.element(1).element(1)).mul(3),v=g.select(ss.mul(x),ss);let y=Ia.mul(gu.mul(It(v,0)));y=y.setZ(y.w);const b=new Tn;b.name="Background.material",b.side=hi,b.depthTest=!1,b.depthWrite=!1,b.allowOverride=!1,b.fog=!1,b.lights=!1,b.vertexNode=y,b.colorNode=m,c.backgroundMeshNode=m,c.backgroundMesh=h=new Kn(new Sg(1,32,32),b),h.frustumCulled=!1,h.name="Background.mesh",r.addEventListener("dispose",S)}const f=u.getCacheKey();c.backgroundCacheKey!==f&&(c.backgroundMeshNode.node=It(u).mul(QD),c.backgroundMeshNode.needsUpdate=!0,h.material.needsUpdate=!0,c.backgroundCacheKey=f),t.unshift(h,h.geometry,h.material,0,0,null,null)}else De("Renderer: Unsupported background configuration.",r);const o=s.xr.getEnvironmentBlendMode();if(o==="additive"?ac.set(0,0,0,1):o==="alpha-blend"&&ac.set(0,0,0,0),s.autoClear===!0||a===!0){const c=n.clearColorValue;c.r=ac.r,c.g=ac.g,c.b=ac.b,c.a=ac.a,(s.backend.isWebGLBackend===!0||s.alpha===!0)&&(c.r*=c.a,c.g*=c.a,c.b*=c.a),n.depthClearValue=s._clearDepth,n.stencilClearValue=s._clearStencil,n.clearColor=s.autoClearColor===!0,n.clearDepth=s.autoClearDepth===!0,n.clearStencil=s.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let jde=0;class $D{constructor(e="",t=[],n=0,s=[]){this.name=e,this.bindings=t,this.index=n,this.bindingsReference=s,this.id=jde++}}class Yde{constructor(e,t,n,s,r,a,o,l,c,u=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=u,this.nodeAttributes=s,this.bindings=r,this.updateNodes=a,this.updateBeforeNodes=o,this.updateAfterNodes=l,this.observer=c,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const s=new $D(t.name,[],t.index,t.bindingsReference);e.push(s);for(const r of t.bindings)s.bindings.push(r.clone())}else e.push(t);return e}}class e3{constructor(e,t,n=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}}class qY{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class qP{constructor(e,t,n=!1,s=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=s}}class jY extends qP{constructor(e,t,n=null,s=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=n,this.interpolationSampling=s}}class YY{constructor(e,t,n=""){this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let Kde=0;class jA{constructor(e=null){this.id=Kde++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class Zde{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class ap{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class Jde extends ap{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class Qde extends ap{constructor(e,t=new Ae){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class $de extends ap{constructor(e,t=new z){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class efe extends ap{constructor(e,t=new un){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class tfe extends ap{constructor(e,t=new Ye){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class nfe extends ap{constructor(e,t=new Ix){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class ife extends ap{constructor(e,t=new gn){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class sfe extends ap{constructor(e,t=new Lt){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class rfe extends Jde{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class afe extends Qde{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class ofe extends $de{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class lfe extends efe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class cfe extends tfe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class ufe extends nfe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class hfe extends ife{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class dfe extends sfe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let ffe=0;const pfe=new WeakMap,p5=new WeakMap,mfe=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),cA=i=>/e/g.test(i)?String(i).replace(/\+/g,""):(i=Number(i),i+(i%1?"":".0"));class jP{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=WA(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new jA,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:ffe++})}isOpaque(){const e=this.material;return e.transparent===!1&&e.blending===qa&&e.alphaToCoverage===!1}getBindGroupsCache(){let e=p5.get(this.renderer);return e===void 0&&(e=new Ac,p5.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new Si(e,t,n)}createCubeRenderTarget(e,t){return new nj(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=this.getBindGroupsCache(),s=[];let r=!0;for(const o of t)s.push(o),r=r&&o.groupNode.shared!==!0;let a;return r?(a=n.get(s),a===void 0&&(a=new $D(e,s,this.bindingsIndexes[e].group,s),n.set(s,a))):a=new $D(e,s,this.bindingsIndexes[e].group,s),a}getBindGroupArray(e,t){const n=this.bindings[t];let s=n[e];return s===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=s=[]),s}getBindings(){let e=this.bindGroups;if(e===null){const t={},n=this.bindings;for(const s of OM)for(const r in n[s]){const a=n[s][r];(t[r]||(t[r]=[])).push(...a)}e=[];for(const s in t){const r=t[s],a=this._getBindGroup(s,r);e.push(a)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,n)=>t.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==on.NONE&&this.updateNodes.push(e);for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==on.NONE&&this.updateBeforeNodes.push(e),n!==on.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Jt||e.magFilter===Qc||e.magFilter===Ho||e.magFilter===$s||e.minFilter===Jt||e.minFilter===Qc||e.minFilter===Ho||e.minFilter===$s}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){const t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){const e={...this.context};return delete e.material,delete e.getUV,delete e.getOutput,delete e.getTextureLevel,delete e.getAO,delete e.getShadow,e}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new jA(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){Se("Abstract function.")}getInstanceIndex(){Se("Abstract function.")}getDrawIndex(){Se("Abstract function.")}getFrontFacing(){Se("Abstract function.")}getFragCoord(){Se("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){Se("Abstract function.")}generateTextureLod(){Se("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,n=null){let s=this.generateArrayDeclaration(e,t)+"( ";for(let r=0;r<t;r++){const a=n?n[r]:null;a!==null?s+=a.build(this,e):s+=this.generateConst(e),r<t-1&&(s+=", ")}return s+=" )",s}generateStruct(e,t,n=null){const s=[];for(const r of t){const{name:a,type:o}=r;n&&n[a]&&n[a].isNode?s.push(n[a].build(this,o)):s.push(this.generateConst(o))}return e+"( "+s.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new Ye:e==="vec2"||e==="uvec2"||e==="ivec2"?t=new Ae:e==="vec3"||e==="uvec3"||e==="ivec3"?t=new z:(e==="vec4"||e==="uvec4"||e==="ivec4")&&(t=new un)),e==="float")return cA(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${cA(t.r)}, ${cA(t.g)}, ${cA(t.b)} )`;const n=this.getTypeLength(e),s=this.getComponentType(e),r=a=>this.generateConst(s,a);if(n===2)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)} )`;if(n===3)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)}, ${r(t.z)} )`;if(n===4&&e!=="mat2")return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)}, ${r(t.z)}, ${r(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(r).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const n=this.attributes;for(const r of n)if(r.name===e)return r;const s=new e3(e,t);return this.registerDeclaration(s),n.push(s),s}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Is)return"int";if(t===Jn)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let n=ZU(e);const s=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(n=n.replace("vec","mat")),s+n}getTypeFromArray(e){return mfe.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,s=e.itemSize,r=e.normalized;let a;return!(e instanceof KE)&&r!==!0&&(a=this.getTypeFromArray(n)),this.getTypeFromLength(s,a)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return n!==null?Number(n[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]===e)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=WA(this.stack);const e=lI();return this.stacks.push(e),Nb(this.stack),this.stack}removeStack(){const e=this.stack;for(const t of e.nodes){const n=this.getDataFromNode(t);n.stack=e}return this.stack=e.parent,Nb(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let s=n.getData(e);s===void 0&&(s={},n.setData(e,s)),s[t]===void 0&&(s[t]={});let r=s[t];const a=s.any?s.any.subBuilds:null,o=this.getClosestSubBuild(a);return o&&(r.subBuildsCache===void 0&&(r.subBuildsCache={}),r=r.subBuildsCache[o]||(r.subBuildsCache[o]={}),r.subBuilds=a),r}getNodeProperties(e,t="any"){const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e,"vertex");let s=n.bufferAttribute;if(s===void 0){const r=this.uniforms.index++;s=new e3("nodeAttribute"+r,t,e),this.bufferAttributes.push(s),n.bufferAttribute=s}return s}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,n=null,s=this.shaderStage){const r=this.getDataFromNode(e,s,this.globalCache);let a=r.structType;if(a===void 0){const o=this.structs.index++;n===null&&(n="StructType"+o),a=new Zde(n,t),this.structs[s].push(a),this.types[s][n]=e,r.structType=a}return a}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t,n=this.shaderStage,s=null){const r=this.getDataFromNode(e,n,this.globalCache);let a=r.uniform;if(a===void 0){const o=this.uniforms.index++;a=new qY(s||"nodeUniform"+o,t,e),this.uniforms[n].push(a),this.registerDeclaration(a),r.uniform=a}return a}getVarFromNode(e,t=null,n=e.getNodeType(this),s=this.shaderStage,r=!1){const a=this.getDataFromNode(e,s),o=this.getSubBuildProperty("variable",a.subBuilds);let l=a[o];if(l===void 0){const c=r?"_const":"_var",u=this.vars[s]||(this.vars[s]=[]),h=this.vars[c]||(this.vars[c]=0);t===null&&(t=(r?"nodeConst":"nodeVar")+h,this.vars[c]++),o!=="variable"&&(t=this.getSubBuildProperty(t,a.subBuilds));const f=e.getArrayCount(this);l=new qP(t,n,r,f),r||u.push(l),this.registerDeclaration(l),a[o]=l}return l}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,n=e.getNodeType(this),s=null,r=null){const a=this.getDataFromNode(e,"any"),o=this.getSubBuildProperty("varying",a.subBuilds);let l=a[o];if(l===void 0){const c=this.varyings,u=c.length;t===null&&(t="nodeVarying"+u),o!=="varying"&&(t=this.getSubBuildProperty(t,a.subBuilds)),l=new jY(t,n,s,r),c.push(l),this.registerDeclaration(l),a[o]=l}return l}registerDeclaration(e){const t=this.shaderStage,n=this.declarations[t]||(this.declarations[t]={}),s=this.getPropertyName(e);let r=1,a=s;for(;n[a]!==void 0;)a=s+"_"+r++;r>1&&(e.name=a,Se(`TSL: Declaration name '${s}' of '${e.type}' already in use. Renamed to '${a}'.`)),n[a]=e}getCodeFromNode(e,t,n=this.shaderStage){const s=this.getDataFromNode(e);let r=s.code;if(r===void 0){const a=this.codes[n]||(this.codes[n]=[]),o=a.length;r=new YY("nodeCode"+o,t),a.push(r),s.code=r}return r}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:s}=this.getDataFromNode(e);let r=!0,a=t;for(;a;){if(s.get(a)===!0){r=!1;break}a=this.getDataFromNode(a).parentNodeBlock}if(r)for(const o of n)this.addLineFlowCode(o)}addLineFlowCodeBlock(e,t,n){const s=this.getDataFromNode(e),r=s.flowCodes||(s.flowCodes=[]),a=s.flowCodeBlock||(s.flowCodeBlock=new WeakMap);r.push(t),a.set(n,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new DP,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let a=0;const o=Object.values(this);return{next:()=>({value:o[a],done:a++>=o.length})}}};for(const a of t.inputs)n[a.name]=new MP(a.type,a.name);e.layout=null;const s=e.call(n),r=this.flowStagesNode(s,t.type);return e.layout=t,r}flowBuildStage(e,t,n=null){const s=this.getBuildStage();this.setBuildStage(t);const r=e.build(this,n);return this.setBuildStage(s),r}flowStagesNode(e,t=null){const n=this.flow,s=this.vars,r=this.declarations,a=this.cache,o=this.buildStage,l=this.stack,c={code:""};this.flow=c,this.vars={},this.declarations={},this.cache=new jA,this.stack=WA();for(const u of PM)this.setBuildStage(u),c.result=e.build(this,t);return c.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=s,this.declarations=r,this.cache=a,this.stack=l,this.setBuildStage(o),c}getFunctionOperator(){return null}buildFunctionCode(){Se("Abstract function.")}flowChildNode(e,t=null){const n=this.flow,s={code:""};return this.flow=s,s.result=e.build(this,t),this.flow=n,s}flowNodeFromShaderStage(e,t,n=null,s=null){const r=this.tab,a=this.cache,o=this.shaderStage,l=this.context;this.setShaderStage(e);const c={...this.context};delete c.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=c;let u=null;if(this.buildStage==="generate"){const h=this.flowChildNode(t,n);s!==null&&(h.code+=`${this.tab+s} = ${h.result};
`),this.flowCode[e]=this.flowCode[e]+h.code,u=h}else u=t.build(this);return this.setShaderStage(o),this.cache=a,this.tab=r,this.context=l,u}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){Se("Abstract function.")}getVaryings(){Se("Abstract function.")}getVar(e,t,n=null){return`${n!==null?this.generateArrayDeclaration(e,n):this.getType(e)} ${t}`}getVars(e){let t="";const n=this.vars[e];if(n!==void 0)for(const s of n)t+=`${this.getVar(s.type,s.name)}; `;return t}getUniforms(){Se("Abstract function.")}getCodes(e){const t=this.codes[e];let n="";if(t!==void 0)for(const s of t)n+=s.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){Se("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const n=this.subBuildLayers;for(let s=t.length-1;s>=0;s--){const r=t[s];if(n.includes(r))return r}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let n;t!==null?n=this.getClosestSubBuild(t):n=this.subBuildFn;let s;return n?s=e?n+"_"+e:n:s=e,s}build(){const{object:e,material:t,renderer:n}=this;if(t!==null){let s=n.library.fromMaterial(t);s===null&&(De(`NodeMaterial: Material "${t.type}" is not compatible.`),s=new Tn),s.build(this)}else this.addFlow("compute",e);for(const s of PM){this.setBuildStage(s),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const r of OM){this.setShaderStage(r);const a=this.flowNodes[r];for(const o of a)s==="generate"?this.flowNode(o):o.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getSharedDataFromNode(e){let t=pfe.get(e);return t===void 0&&(t={}),t}getNodeUniform(e,t){const n=this.getSharedDataFromNode(e);let s=n.cache;if(s===void 0){if(t==="float"||t==="int"||t==="uint")s=new rfe(e);else if(t==="vec2"||t==="ivec2"||t==="uvec2")s=new afe(e);else if(t==="vec3"||t==="ivec3"||t==="uvec3")s=new ofe(e);else if(t==="vec4"||t==="ivec4"||t==="uvec4")s=new lfe(e);else if(t==="color")s=new cfe(e);else if(t==="mat2")s=new ufe(e);else if(t==="mat3")s=new hfe(e);else if(t==="mat4")s=new dfe(e);else throw new Error(`Uniform "${t}" not implemented.`);n.cache=s}return s}format(e,t,n){if(t=this.getVectorType(t),n=this.getVectorType(n),t===n||n===null||this.isReference(n))return e;const s=this.getTypeLength(t),r=this.getTypeLength(n);return s===16&&r===9?`${this.getType(n)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:s===9&&r===4?`${this.getType(n)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:s>4||r>4||r===0?e:s===r?`${this.getType(n)}( ${e} )`:s>r?(e=n==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,r)}`,this.format(e,this.getTypeFromLength(r,this.getComponentType(t)),n)):r===4&&s>1?`${this.getType(n)}( ${this.format(e,t,"vec3")}, 1.0 )`:s===2?`${this.getType(n)}( ${this.format(e,t,"vec2")}, 0.0 )`:(s===1&&r>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${bu} - Node System
`}}class t3{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return n===void 0&&(n={renderId:0,frameId:0},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===on.FRAME){const s=this._getMaps(this.updateBeforeMap,n);if(s.frameId!==this.frameId){const r=s.frameId;s.frameId=this.frameId,e.updateBefore(this)===!1&&(s.frameId=r)}}else if(t===on.RENDER){const s=this._getMaps(this.updateBeforeMap,n);if(s.renderId!==this.renderId){const r=s.renderId;s.renderId=this.renderId,e.updateBefore(this)===!1&&(s.renderId=r)}}else t===on.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===on.FRAME){const s=this._getMaps(this.updateAfterMap,n);s.frameId!==this.frameId&&e.updateAfter(this)!==!1&&(s.frameId=this.frameId)}else if(t===on.RENDER){const s=this._getMaps(this.updateAfterMap,n);s.renderId!==this.renderId&&e.updateAfter(this)!==!1&&(s.renderId=this.renderId)}else t===on.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===on.FRAME){const s=this._getMaps(this.updateMap,n);s.frameId!==this.frameId&&e.update(this)!==!1&&(s.frameId=this.frameId)}else if(t===on.RENDER){const s=this._getMaps(this.updateMap,n);s.renderId!==this.renderId&&e.update(this)!==!1&&(s.renderId=this.renderId)}else t===on.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class hw{constructor(e,t,n=null,s="",r=!1){this.type=e,this.name=t,this.count=n,this.qualifier=s,this.isConst=r}}hw.isNodeFunctionInput=!0;class KY extends rp{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:FP(this.light),lightColor:e}}}const C2=new Lt,uA=new Lt;let j_=null;class ZY extends rp{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Yt(new z).setGroup(Kt),this.halfWidth=Yt(new z).setGroup(Kt),this.updateType=on.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;uA.identity(),C2.copy(t.matrixWorld),C2.premultiply(n),uA.extractRotation(C2),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(uA),this.halfHeight.value.applyMatrix4(uA)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=jn(j_.LTC_FLOAT_1),n=jn(j_.LTC_FLOAT_2)):(t=jn(j_.LTC_HALF_1),n=jn(j_.LTC_HALF_2));const{colorNode:s,light:r}=this,a=OP(r);return{lightColor:s,lightPosition:a,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){j_=e}}class dw extends rp{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Yt(0).setGroup(Kt),this.penumbraCosNode=Yt(0).setGroup(Kt),this.cutoffDistanceNode=Yt(0).setGroup(Kt),this.decayExponentNode=Yt(0).setGroup(Kt),this.colorNode=Yt(this.color).setGroup(Kt)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:n,penumbraCosNode:s}=this;return nl(n,s,t)}getLightCoord(e){const t=e.getNodeProperties(this);let n=t.projectionUV;return n===void 0&&(n=mY(this.light,e.context.positionWorld),t.projectionUV=n),n}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:s,light:r}=this,a=this.getLightVector(e),o=a.normalize(),l=o.dot(FP(r)),c=this.getSpotAttenuation(e,l),u=a.length(),h=kP({lightDistance:u,cutoffDistance:n,decayExponent:s});let f=t.mul(c).mul(h),m,g;return r.colorNode?(g=this.getLightCoord(e),m=r.colorNode(g)):r.map&&(g=this.getLightCoord(e),m=jn(r.map,g.xy).onRenderUpdate(()=>r.map)),m&&(f=g.mul(2).sub(1).abs().lessThan(1).all().select(f.mul(m),f)),{lightColor:f,lightDirection:o}}}class JY extends dw{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const n=this.light.iesMap;let s=null;if(n&&n.isTexture===!0){const r=t.acos().mul(1/Math.PI);s=jn(n,$e(r,0),0).r}else s=super.getSpotAttenuation(t);return s}}const gfe=le(([i,e])=>{const t=i.abs().sub(e);return ou(ls(t,0)).add(fo(ls(t.x,t.y),0))});class QY extends dw{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let n=1;t.map!==null&&(n=t.map.width/t.map.height),t.shadow.aspect=n}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=W(0),n=this.penumbraCosNode,s=ow(this.light).mul(e.context.positionWorld||Zo);return Wt(s.w.greaterThan(0),()=>{const r=s.xyz.div(s.w),a=gfe(r.xy.sub($e(.5)),$e(.5)),o=tl(-1,On(1,MI(n)).sub(1));t.assign(GC(a.mul(-2).mul(o)))}),t}}class $Y extends rp{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class eK extends rp{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=PP(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Yt(new Ye).setGroup(Kt)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:s}=this,a=ip.dot(s).mul(.5).add(.5),o=wn(n,t,a);e.context.irradiance.addAssign(o)}}class tK extends rp{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let n=0;n<9;n++)t.push(new z);this.lightProbe=da(t)}update(e){const{light:t}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(t.sh.coefficients[n]).multiplyScalar(t.intensity)}setup(e){const t=XY(ip,this.lightProbe);e.context.irradiance.addAssign(t)}}class nK{parseFunction(){Se("Abstract function.")}}class YP{constructor(e,t,n="",s=""){this.type=e,this.inputs=t,this.name=n,this.precision=s}getCode(){Se("Abstract function.")}}YP.isNodeFunction=!0;const yfe=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,xfe=/[a-z_0-9]+/ig,m5="#pragma main",_fe=i=>{i=i.trim();const e=i.indexOf(m5),t=e!==-1?i.slice(e+m5.length):i,n=t.match(yfe);if(n!==null&&n.length===5){const s=n[4],r=[];let a=null;for(;(a=xfe.exec(s))!==null;)r.push(a);const o=[];let l=0;for(;l<r.length;){const g=r[l][0]==="const";g===!0&&l++;let x=r[l][0];x==="in"||x==="out"||x==="inout"?l++:x="";const v=r[l++][0];let y=Number.parseInt(r[l][0]);Number.isNaN(y)===!1?l++:y=null;const b=r[l++][0];o.push(new hw(v,b,y,x,g))}const c=t.substring(n[0].length),u=n[3]!==void 0?n[3]:"",h=n[2],f=n[1]!==void 0?n[1]:"",m=e!==-1?i.slice(0,e):"";return{type:h,inputs:o,name:u,precision:f,inputsCode:s,blockCode:c,headerCode:m}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class vfe extends YP{constructor(e){const{type:t,inputs:n,name:s,precision:r,inputsCode:a,blockCode:o,headerCode:l}=_fe(e);super(t,n,s,r),this.inputsCode=a,this.blockCode=o,this.headerCode=l}getCode(e=this.name){let t;const n=this.blockCode;if(n!==""){const{type:s,inputsCode:r,headerCode:a,precision:o}=this;let l=`${s} ${e} ( ${r.trim()} )`;o!==""&&(l=`${o} ${l}`),t=a+l+n}else t="";return t}}class iK extends nK{parseFunction(e){return new vfe(e)}}const g5=new WeakMap,zc=[],md=[];class bfe extends sp{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new t3,this.nodeBuilderCache=new Map,this.callHashCache=new Ac,this.groupsData=new Ac,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===_I.name)return!0;if(n===Kt.name){const r=this.get(e),a=this.nodeFrame.renderId;return r.renderId!==a?(r.renderId=a,!0):!1}if(n===WW.name){const r=this.get(e),a=this.nodeFrame.frameId;return r.frameId!==a?(r.frameId=a,!0):!1}zc[0]=t,zc[1]=e;let s=this.groupsData.get(zc);return s===void 0&&this.groupsData.set(zc,s={}),zc.length=0,s.version!==t.version?(s.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:s}=this,r=this.getForRenderCacheKey(e);if(n=s.get(r),n===void 0){const a=l=>{const c=this.backend.createNodeBuilder(e.object,this.renderer);return c.scene=e.scene,c.material=l,c.camera=e.camera,c.context.material=l,c.lightsNode=e.lightsNode,c.environmentNode=this.getEnvironmentNode(e.scene),c.fogNode=this.getFogNode(e.scene),c.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&c.enableMultiview(),c};let o=a(e.material);try{o.build()}catch(l){o=a(new Tn),o.build(),De("TSL: "+l)}n=this._createNodeBuilderState(o),s.set(r,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const s=this.backend.createNodeBuilder(e,this.renderer);s.build(),n=this._createNodeBuilderState(s),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new Yde(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){zc[0]=e,zc[1]=t;const n=this.renderer.info.calls,s=this.callHashCache.get(zc)||{};if(s.callId!==n){const r=this.getEnvironmentNode(e),a=this.getFogNode(e);t&&md.push(t.getCacheKey(!0)),r&&md.push(r.getCacheKey()),a&&md.push(a.getCacheKey()),md.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),md.push(this.renderer.shadowMap.enabled?1:0),md.push(this.renderer.shadowMap.type),s.callId=n,s.cacheKey=Eg(md),this.callHashCache.set(zc,s),md.length=0}return zc.length=0,s.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const s=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==n||s){const r=this.getCacheNode("background",n,()=>{if(n.isCubeTexture===!0||n.mapping===_c||n.mapping===wh||n.mapping===du){if(e.backgroundBlurriness>0||n.mapping===du)return bP(n);{let a;return n.isCubeTexture===!0?a=za(n):a=jn(n),sj(a)}}else{if(n.isTexture===!0)return jn(n,vh.flipY()).setUpdateMatrix(!0);n.isColor!==!0&&De("WebGPUNodes: Unsupported background configuration.",n)}},s);t.backgroundNode=r,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n,s=!1){const r=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let a=r.get(t);return(a===void 0||s)&&(a=n(),r.set(t,a)),a}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const s=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const r=vi("color","color",n).setGroup(Kt),a=vi("density","float",n).setGroup(Kt);return Ib(r,UP(a))}else if(n.isFog){const r=vi("color","color",n).setGroup(Kt),a=vi("near","float",n).setGroup(Kt),o=vi("far","float",n).setGroup(Kt);return Ib(r,LP(a,o))}else De("Renderer: Unsupported fog configuration.",n)});t.fogNode=s,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const s=this.getCacheNode("environment",n,()=>{if(n.isCubeTexture===!0)return za(n);if(n.isTexture===!0)return jn(n);De("Nodes: Unsupported environment configuration.",n)});t.environmentNode=s,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,n=null,s=null,r=null){const a=this.nodeFrame;return a.renderer=e,a.scene=t,a.object=n,a.camera=s,a.material=r,a}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return g5.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),s=e.isArrayTexture?sw(e,se(vh,Wh("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):jn(e,vh).renderOutput(t.toneMapping,t.currentColorSpace);return g5.set(e,n),s}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const s of n.updateNodes)t.updateNode(s)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const s of n.updateNodes)t.updateNode(s)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new t3,this.nodeBuilderCache=new Map,this.cacheLib={}}}const w2=new El;class $M{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new gn,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const s=e.length;for(let r=0;r<s;r++){w2.copy(e[r]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const a=t[n+r],o=w2.normal;a.x=-o.x,a.y=-o.y,a.z=-o.z,a.w=w2.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const s=t.clippingPlanes,r=s.length;let a,o;if(this.clipIntersection?(a=this.intersectionPlanes,o=e.intersectionPlanes.length):(a=this.unionPlanes,o=e.unionPlanes.length),a.length!==o+r){a.length=o+r;for(let l=0;l<r;l++)a[o+l]=new un;n=!0}this.projectPlanes(s,a,o),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new $M(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class Sfe{constructor(e,t){this.bundleGroup=e,this.camera=t}}const Y_=[];class Tfe{constructor(){this.bundles=new Ac}get(e,t){const n=this.bundles;Y_[0]=e,Y_[1]=t;let s=n.get(Y_);return s===void 0&&(s=new Sfe(e,t),n.set(Y_,s)),Y_.length=0,s}dispose(){this.bundles=new Ac}}class sK{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(n!==null){t=new n;for(const s in e)t[s]=e[s]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t)){Se(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);n.set(t,e)}addClass(e,t,n){if(n.has(t)){Se(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);n.set(t,e)}}const Afe=new lw,K_=[];class rK extends Ac{constructor(){super()}createNode(e=[]){return new lw().setLights(e)}getNode(e,t){if(e.isQuadMesh)return Afe;K_[0]=e,K_[1]=t;let n=this.get(K_);return n===void 0&&(n=this.createNode(),this.set(K_,n)),K_.length=0,n}}class fv extends Si{constructor(e=1,t=1,n={}){super(e,t,n),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const y5=new z,x5=new z;class Mfe extends Ta{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new Ci,this._cameraL.viewport=new un,this._cameraR=new Ci,this._cameraR.viewport=new un,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new MC,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=Bfe.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new Ae,this._onSessionEvent=wfe.bind(this),this._onSessionEnd=Rfe.bind(this),this._onInputSourcesChange=Nfe.bind(this),this._onAnimationFrame=Dfe.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&Se("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&Se("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,n,s,r,a,o,l={}){const c=new Cc(e,t),u=new fv(r,a,{format:ii,type:ei,depthTexture:new tr(r,a,l.stencil?ja:Jn,void 0,void 0,void 0,void 0,void 0,void 0,l.stencil?kr:lr),stencilBuffer:l.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});u._autoAllocateDepthBuffer=!0;const h=new Ts({color:16777215,side:jr});h.map=u.texture,h.map.offset.y=1,h.map.repeat.y=-1;const f=new Kn(c,h);f.position.copy(n),f.quaternion.copy(s);const m={type:"quad",width:e,height:t,translation:n,quaternion:s,pixelwidth:r,pixelheight:a,plane:f,material:h,rendercall:o,renderTarget:u};if(this._layers.push(m),this._session!==null){m.plane.material=new Ts({color:16777215,side:jr}),m.plane.material.blending=nf,m.plane.material.blendEquation=Mr,m.plane.material.blendSrc=dc,m.plane.material.blendDst=dc,m.xrlayer=this._createXRLayer(m);const g=this._session.renderState.layers;g.unshift(m.xrlayer),this._session.updateRenderState({layers:g})}else u.isXRRenderTarget=!1;return f}createCylinderLayer(e,t,n,s,r,a,o,l,c={}){const u=new bg(e,e,e*t/n,64,64,!0,Math.PI-t/2,t),h=new fv(a,o,{format:ii,type:ei,depthTexture:new tr(a,o,c.stencil?ja:Jn,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?kr:lr),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});h._autoAllocateDepthBuffer=!0;const f=new Ts({color:16777215,side:hi});f.map=h.texture,f.map.offset.y=1,f.map.repeat.y=-1;const m=new Kn(u,f);m.position.copy(s),m.quaternion.copy(r);const g={type:"cylinder",radius:e,centralAngle:t,aspectratio:n,translation:s,quaternion:r,pixelwidth:a,pixelheight:o,plane:m,material:f,rendercall:l,renderTarget:h};if(this._layers.push(g),this._session!==null){g.plane.material=new Ts({color:16777215,side:hi}),g.plane.material.blending=nf,g.plane.material.blendEquation=Mr,g.plane.material.blendSrc=dc,g.plane.material.blendDst=dc,g.xrlayer=this._createXRLayer(g);const x=this._session.renderState.layers;x.unshift(g.xrlayer),this._session.updateRenderState({layers:x})}else h.isXRRenderTarget=!1;return m}renderLayers(){const e=new z,t=new Fs,n=this._renderer,s=this.isPresenting,r=n.getOutputRenderTarget(),a=n._frameBufferTarget;this.isPresenting=!1;const o=new Ae;n.getSize(o);const l=n._quad;for(const c of this._layers)if(c.renderTarget.isXRRenderTarget=this._session!==null,c.renderTarget._hasExternalTextures=c.renderTarget.isXRRenderTarget,c.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){c.xrlayer.transform=new XRRigidTransform(c.plane.getWorldPosition(e),c.plane.getWorldQuaternion(t));const u=this._glBinding.getSubImage(c.xrlayer,this._xrFrame);n.backend.setXRRenderTargetTextures(c.renderTarget,u.colorTexture,void 0),n._setXRLayerSize(c.renderTarget.width,c.renderTarget.height),n.setOutputRenderTarget(c.renderTarget),n.setRenderTarget(null),n._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:h,quad:f}=this._frameBufferTargets.get(c.renderTarget)||{frameBufferTarget:null,quad:null};h?(n._frameBufferTarget=h,n._quad=f):(n._quad=new Aa(new Tn),this._frameBufferTargets.set(c.renderTarget,{frameBufferTarget:n._getFrameBufferTarget(),quad:n._quad})),c.rendercall(),n._frameBufferTarget=null}else n.setRenderTarget(c.renderTarget),c.rendercall();n.setRenderTarget(null),n.setOutputRenderTarget(r),n._frameBufferTarget=a,n._setXRLayerSize(o.x,o.y),n._quad=l,this.isPresenting=s}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend;this._gl=t.getContext();const s=this._gl,r=s.getContextAttributes();if(this._session=e,e!==null){if(n.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let a=null,o=null,l=null;t.depth&&(l=t.stencil?s.DEPTH24_STENCIL8:s.DEPTH_COMPONENT24,a=t.stencil?kr:lr,o=t.stencil?ja:Jn);const c={colorFormat:s.RGBA8,depthFormat:l,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(c.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const u=this._glBinding.createProjectionLayer(c),h=[u];this._glProjLayer=u,t.setPixelRatio(1),t._setXRLayerSize(u.textureWidth,u.textureHeight);const f=this._useMultiview?2:1,m=new tr(u.textureWidth,u.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,a,f);if(this._xrRenderTarget=new fv(u.textureWidth,u.textureHeight,{format:ii,type:ei,colorSpace:t.outputColorSpace,depthTexture:m,stencilBuffer:t.stencil,samples:r.antialias?4:0,resolveDepthBuffer:u.ignoreDepthValues===!1,resolveStencilBuffer:u.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const g of this._layers)g.plane.material=new Ts({color:16777215,side:g.type==="cylinder"?hi:jr}),g.plane.material.blending=nf,g.plane.material.blendEquation=Mr,g.plane.material.blendSrc=dc,g.plane.material.blendDst=dc,g.xrlayer=this._createXRLayer(g),h.unshift(g.xrlayer);e.updateRenderState({layers:h})}else{const a={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},o=new XRWebGLLayer(e,s,a);this._glBaseLayer=o,e.updateRenderState({baseLayer:o}),t.setPixelRatio(1),t._setXRLayerSize(o.framebufferWidth,o.framebufferHeight),this._xrRenderTarget=new fv(o.framebufferWidth,o.framebufferHeight,{format:ii,type:ei,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:o.ignoreDepthValues===!1,resolveStencilBuffer:o.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const n=e.near,s=e.far,r=this._cameraXR,a=this._cameraL,o=this._cameraR;r.near=o.near=a.near=n,r.far=o.far=a.far=s,r.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==r.near||this._currentDepthFar!==r.far)&&(t.updateRenderState({depthNear:r.near,depthFar:r.far}),this._currentDepthNear=r.near,this._currentDepthFar=r.far),r.layers.mask=e.layers.mask|6,a.layers.mask=r.layers.mask&3,o.layers.mask=r.layers.mask&5;const l=e.parent,c=r.cameras;_5(r,l);for(let u=0;u<c.length;u++)_5(c[u],l);c.length===2?Efe(r,a,o):r.projectionMatrix.copy(a.projectionMatrix),Cfe(e,r,l)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new xy,this._controllers[e]=t),t}}function Efe(i,e,t){y5.setFromMatrixPosition(e.matrixWorld),x5.setFromMatrixPosition(t.matrixWorld);const n=y5.distanceTo(x5),s=e.projectionMatrix.elements,r=t.projectionMatrix.elements,a=s[14]/(s[10]-1),o=s[14]/(s[10]+1),l=(s[9]+1)/s[5],c=(s[9]-1)/s[5],u=(s[8]-1)/s[0],h=(r[8]+1)/r[0],f=a*u,m=a*h,g=n/(-u+h),x=g*-u;if(e.matrixWorld.decompose(i.position,i.quaternion,i.scale),i.translateX(x),i.translateZ(g),i.matrixWorld.compose(i.position,i.quaternion,i.scale),i.matrixWorldInverse.copy(i.matrixWorld).invert(),s[10]===-1)i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const v=a+g,y=o+g,b=f-x,S=m+(n-x),T=l*o/y*v,M=c*o/y*v;i.projectionMatrix.makePerspective(b,S,T,M,v,y),i.projectionMatrixInverse.copy(i.projectionMatrix).invert()}}function _5(i,e){e===null?i.matrixWorld.copy(i.matrix):i.matrixWorld.multiplyMatrices(e.matrixWorld,i.matrix),i.matrixWorldInverse.copy(i.matrixWorld).invert()}function Cfe(i,e,t){t===null?i.matrix.copy(e.matrixWorld):(i.matrix.copy(t.matrixWorld),i.matrix.invert(),i.matrix.multiply(e.matrixWorld)),i.matrix.decompose(i.position,i.quaternion,i.scale),i.updateMatrixWorld(!0),i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse),i.isPerspectiveCamera&&(i.fov=Qm*2*Math.atan(1/i.projectionMatrix.elements[5]),i.zoom=1)}function wfe(i){const e=this._controllerInputSources.indexOf(i.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const n=this.getReferenceSpace();t.update(i.inputSource,i.frame,n),t.dispatchEvent({type:i.type,data:i.inputSource})}}function Rfe(){const i=this._session,e=this._renderer;i.removeEventListener("select",this._onSessionEvent),i.removeEventListener("selectstart",this._onSessionEvent),i.removeEventListener("selectend",this._onSessionEvent),i.removeEventListener("squeeze",this._onSessionEvent),i.removeEventListener("squeezestart",this._onSessionEvent),i.removeEventListener("squeezeend",this._onSessionEvent),i.removeEventListener("end",this._onSessionEnd),i.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const n=this._controllerInputSources[t];n!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(n))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const t of this._layers)t.renderTarget=new fv(t.pixelwidth,t.pixelheight,{format:ii,type:ei,depthTexture:new tr(t.pixelwidth,t.pixelheight,t.stencilBuffer?ja:Jn,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?kr:lr),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function Nfe(i){const e=this._controllers,t=this._controllerInputSources;for(let n=0;n<i.removed.length;n++){const s=i.removed[n],r=t.indexOf(s);r>=0&&(t[r]=null,e[r].disconnect(s))}for(let n=0;n<i.added.length;n++){const s=i.added[n];let r=t.indexOf(s);if(r===-1){for(let o=0;o<e.length;o++)if(o>=t.length){t.push(s),r=o;break}else if(t[o]===null){t[o]=s,r=o;break}if(r===-1)break}const a=e[r];a&&a.connect(s)}}function Bfe(i){return i.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(i.translation,i.quaternion),width:i.width/2,height:i.height/2,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(i.translation,i.quaternion),radius:i.radius,centralAngle:i.centralAngle,aspectRatio:i.aspectRatio,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight,clearOnAccess:!1})}function Dfe(i,e){if(e===void 0)return;const t=this._cameraXR,n=this._renderer,s=n.backend,r=this._glBaseLayer,a=this.getReferenceSpace(),o=e.getViewerPose(a);if(this._xrFrame=e,o!==null){const l=o.views;this._glBaseLayer!==null&&s.setXRTarget(r.framebuffer);let c=!1;l.length!==t.cameras.length&&(t.cameras.length=0,c=!0);for(let u=0;u<l.length;u++){const h=l[u];let f;if(this._supportsLayers===!0){const g=this._glBinding.getViewSubImage(this._glProjLayer,h);f=g.viewport,u===0&&s.setXRRenderTargetTextures(this._xrRenderTarget,g.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:g.depthStencilTexture)}else f=r.getViewport(h);let m=this._cameras[u];m===void 0&&(m=new Ci,m.layers.enable(u),m.viewport=new un,this._cameras[u]=m),m.matrix.fromArray(h.transform.matrix),m.matrix.decompose(m.position,m.quaternion,m.scale),m.projectionMatrix.fromArray(h.projectionMatrix),m.projectionMatrixInverse.copy(m.projectionMatrix).invert(),m.viewport.set(f.x,f.y,f.width,f.height),u===0&&(t.matrix.copy(m.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),c===!0&&t.cameras.push(m)}n.setOutputRenderTarget(this._xrRenderTarget)}for(let l=0;l<this._controllers.length;l++){const c=this._controllerInputSources[l],u=this._controllers[l];c!==null&&u!==void 0&&u.update(c,e,a)}this._currentAnimationLoop&&this._currentAnimationLoop(i,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}class KP extends Ta{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new un(0,0,this._width,this._height),this._scissor=new un(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new US,this.depthTexture=new tr}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),n===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,s){const r=this._scissor;e.isVector4?r.copy(e):r.set(e,t,n,s)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,s,r=0,a=1){const o=this._viewport;e.isVector4?o.copy(e):o.set(e,t,n,s),o.minDepth=r,o.maxDepth=a}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const v5=new fu,B0=new Ae,R2=new un,N2=new zh,B2=new Rx,hA=new Lt,Xu=new un;class Lfe{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:s=!0,depth:r=!0,stencil:a=!1,antialias:o=!1,samples:l=0,getFallback:c=null,outputBufferType:u=ln,multiview:h=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=s,this.logarithmicDepthBuffer=n,this.outputColorSpace=Js,this.toneMapping=Ki,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=r,this.stencil=a,this.info=new ole,this.contextNode=kh(),this.library=new sK,this.lighting=new rK,this._samples=l||o===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new KP(e.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new kC,this._inspector.setRenderer(this),this._getFallback=c,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new Aa(new Tn),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const f=this.alpha===!0?0:1;this._clearColor=new AP(0,0,0,f),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._outputBufferType=u,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:tf},this.xr=new Mfe(this,h),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(m,g,x)=>{await this.compileAsync(m,g);const v=this._renderLists.get(m,g),y=this._renderContexts.get(m,g,this._renderTarget,this._mrt),b=m.overrideMaterial||x.material,S=this._objects.get(x,b,m,g,v.lightsNode,y,y.clippingContext),{fragmentShader:T,vertexShader:M}=S.getNodeBuilderState();return{fragmentShader:T,vertexShader:M}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(s){if(this._getFallback!==null)try{this.backend=n=this._getFallback(s),await n.init(this)}catch(r){t(r);return}else{t(s);return}}this._nodes=new bfe(this,n),this._animation=new Qoe(this,this._nodes,this.info),this._attributes=new rle(n),this._background=new qde(this,this._nodes),this._geometries=new ale(this._attributes,this.info),this._textures=new Sle(this,n,this.info),this._pipelines=new hle(n,this._nodes),this._bindings=new dle(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new nle(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new mle(this.lighting),this._bundles=new Tfe,this._renderContexts=new vle,this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const s=this._nodes.nodeFrame,r=s.renderId,a=this._currentRenderContext,o=this._currentRenderObjectFunction,l=this._compilationPromises,c=e.isScene===!0?e:v5;n===null&&(n=e);const u=this._renderTarget,h=this._renderContexts.get(n,t,u,this._mrt),f=this._activeMipmapLevel,m=[];this._currentRenderContext=h,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=m,s.renderId++,s.update(),h.depth=this.depth,h.stencil=this.stencil,h.clippingContext||(h.clippingContext=new $M),h.clippingContext.updateGlobal(c,t),c.onBeforeRender(this,e,t,u);const g=this._renderLists.get(e,t);if(g.begin(),this._projectObject(e,t,0,g,h.clippingContext),n!==e&&n.traverseVisible(function(S){S.isLight&&S.layers.test(t.layers)&&g.pushLight(S)}),g.finish(),u!==null){this._textures.updateRenderTarget(u,f);const S=this._textures.get(u);h.textures=S.textures,h.depthTexture=S.depthTexture}else h.textures=null,h.depthTexture=null;this._background.update(c,g,h);const x=g.opaque,v=g.transparent,y=g.transparentDoublePass,b=g.lightsNode;this.opaque===!0&&x.length>0&&this._renderObjects(x,t,c,b),this.transparent===!0&&v.length>0&&this._renderTransparents(v,y,t,c,b),s.renderId=r,this._currentRenderContext=a,this._currentRenderObjectFunction=o,this._compilationPromises=l,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(m)}async renderAsync(e,t){oi('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(e,t)}async waitForGPU(){De("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(e){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){const t=this.contextNode.value;e===!0?(t.modelViewMatrix=GD,t.modelNormalViewMatrix=zD):this.highPrecision&&(delete t.modelViewMatrix,delete t.modelNormalViewMatrix)}get highPrecision(){const e=this.contextNode.value;return e.modelViewMatrix===GD&&e.modelNormalViewMatrix===zD}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getOutputBufferType(){return this._outputBufferType}getColorBufferType(){return oi('Renderer: ".getColorBufferType()" has been renamed to ".getOutputBufferType()".'),this.getOutputBufferType()}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),De(t),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:s,camera:r,renderList:a}=e,o=this._currentRenderContext,l=this._bundles.get(s,r),c=this.backend.get(l);c.renderContexts===void 0&&(c.renderContexts=new Set);const u=s.version!==c.version,h=c.renderContexts.has(o)===!1||u;if(c.renderContexts.add(o),h){this.backend.beginBundle(o),(c.renderObjects===void 0||u)&&(c.renderObjects=[]),this._currentRenderBundle=l;const{transparentDoublePass:f,transparent:m,opaque:g}=a;this.opaque===!0&&g.length>0&&this._renderObjects(g,r,t,n),this.transparent===!0&&m.length>0&&this._renderTransparents(m,f,r,t,n),this._currentRenderBundle=null,this.backend.finishBundle(o,l),c.version=s.version}else{const{renderObjects:f}=c;for(let m=0,g=f.length;m<g;m++){const x=f[m];this._nodes.needsRefresh(x)&&(this._nodes.updateBefore(x),this._nodes.updateForRender(x),this._bindings.updateForRender(x),this._nodes.updateAfter(x))}}this.backend.addBundle(o,l)}render(e,t){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,n=e!==Ki,s=t!==en.workingColorSpace;if(n===!1&&s===!1)return null;const{width:r,height:a}=this.getDrawingBufferSize(B0),{depth:o,stencil:l}=this;let c=this._frameBufferTarget;c===null&&(c=new Si(r,a,{depthBuffer:o,stencilBuffer:l,type:this._outputBufferType,format:ii,colorSpace:en.workingColorSpace,generateMipmaps:!1,minFilter:Jt,magFilter:Jt,samples:this.samples}),c.isPostProcessingRenderTarget=!0,this._frameBufferTarget=c);const u=this.getOutputRenderTarget();c.depthBuffer=o,c.stencilBuffer=l,u!==null?c.setSize(u.width,u.height,u.depth):c.setSize(r,a,1);const h=this._canvasTarget;return c.viewport.copy(h._viewport),c.scissor.copy(h._scissor),c.viewport.multiplyScalar(h._pixelRatio),c.scissor.multiplyScalar(h._pixelRatio),c.scissorTest=h._scissorTest,c.multiview=u!==null?u.multiview:!1,c.resolveDepthBuffer=u!==null?u.resolveDepthBuffer:!0,c._autoAllocateDepthBuffer=u!==null?u._autoAllocateDepthBuffer:!1,c}_renderScene(e,t,n=!0){if(this._isDeviceLost===!0)return;const s=n?this._getFrameBufferTarget():null,r=this._nodes.nodeFrame,a=r.renderId,o=this._currentRenderContext,l=this._currentRenderObjectFunction,c=e.isScene===!0?e:v5,u=this._renderTarget||this._outputRenderTarget,h=this._activeCubeFace,f=this._activeMipmapLevel;let m;s!==null?(m=s,this.setRenderTarget(m)):m=u;const g=this._renderContexts.get(e,t,m,this._mrt);this._currentRenderContext=g,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,r.renderId=this.info.calls,this.backend.updateTimeStampUID(g),this.inspector.beginRender(this.backend.getTimestampUID(g),e,t,m);const x=this.coordinateSystem,v=this.xr;if(t.coordinateSystem!==x&&v.isPresenting===!1&&(t.coordinateSystem=x,t.updateProjectionMatrix(),t.isArrayCamera))for(const V of t.cameras)V.coordinateSystem=x,V.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),v.enabled===!0&&v.isPresenting===!0&&(v.cameraAutoUpdate===!0&&v.updateCamera(t),t=v.getCamera());const y=this._canvasTarget;let b=y._viewport,S=y._scissor,T=y._pixelRatio;m!==null&&(b=m.viewport,S=m.scissor,T=1),this.getDrawingBufferSize(B0),R2.set(0,0,B0.width,B0.height);const M=b.minDepth===void 0?0:b.minDepth,C=b.maxDepth===void 0?1:b.maxDepth;g.viewportValue.copy(b).multiplyScalar(T).floor(),g.viewportValue.width>>=f,g.viewportValue.height>>=f,g.viewportValue.minDepth=M,g.viewportValue.maxDepth=C,g.viewport=g.viewportValue.equals(R2)===!1,g.scissorValue.copy(S).multiplyScalar(T).floor(),g.scissor=y._scissorTest&&g.scissorValue.equals(R2)===!1,g.scissorValue.width>>=f,g.scissorValue.height>>=f,g.clippingContext||(g.clippingContext=new $M),g.clippingContext.updateGlobal(c,t),c.onBeforeRender(this,e,t,m);const w=t.isArrayCamera?B2:N2;t.isArrayCamera||(hA.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),w.setFromProjectionMatrix(hA,t.coordinateSystem,t.reversedDepth));const N=this._renderLists.get(e,t);if(N.begin(),this._projectObject(e,t,0,N,g.clippingContext),N.finish(),this.sortObjects===!0&&N.sort(this._opaqueSort,this._transparentSort),m!==null){this._textures.updateRenderTarget(m,f);const V=this._textures.get(m);g.textures=V.textures,g.depthTexture=V.depthTexture,g.width=V.width,g.height=V.height,g.renderTarget=m,g.depth=m.depthBuffer,g.stencil=m.stencilBuffer}else g.textures=null,g.depthTexture=null,g.width=B0.width,g.height=B0.height,g.depth=this.depth,g.stencil=this.stencil;g.width>>=f,g.height>>=f,g.activeCubeFace=h,g.activeMipmapLevel=f,g.occlusionQueryCount=N.occlusionQueryCount,g.scissorValue.max(Xu.set(0,0,0,0)),g.scissorValue.x+g.scissorValue.width>g.width&&(g.scissorValue.width=Math.max(g.width-g.scissorValue.x,0)),g.scissorValue.y+g.scissorValue.height>g.height&&(g.scissorValue.height=Math.max(g.height-g.scissorValue.y,0)),this._background.update(c,N,g),g.camera=t,this.backend.beginRender(g);const{bundles:E,lightsNode:B,transparentDoublePass:U,transparent:H,opaque:F}=N;return E.length>0&&this._renderBundles(E,c,B),this.opaque===!0&&F.length>0&&this._renderObjects(F,t,c,B),this.transparent===!0&&H.length>0&&this._renderTransparents(H,U,t,c,B),this.backend.finishRender(g),r.renderId=a,this._currentRenderContext=o,this._currentRenderObjectFunction=l,s!==null&&(this.setRenderTarget(u,h,f),this._renderOutput(m)),c.onAfterRender(this,e,t,m),this.inspector.finishRender(this.backend.getTimestampUID(g)),g}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,s=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=s}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,n)}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,n)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,n,s){this._canvasTarget.setScissor(e,t,n,s)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,n,s,r=0,a=1){this._canvasTarget.setViewport(e,t,n,s,r,a)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,n=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const s=this._renderTarget||this._getFrameBufferTarget();let r=null;if(s!==null){this._textures.updateRenderTarget(s);const a=this._textures.get(s);r=this._renderContexts.getForClear(s),r.textures=a.textures,r.depthTexture=a.depthTexture,r.width=a.width,r.height=a.height,r.renderTarget=s,r.depth=s.depthBuffer,r.stencil=s.stencilBuffer,r.clearColorValue=this.backend.getClearColor(),r.activeCubeFace=this.getActiveCubeFace(),r.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,n,r),s!==null&&this._renderTarget===null&&this._renderOutput(s)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,n=!0){oi('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(e,t,n)}async clearColorAsync(){oi('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){oi('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){oi('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const e=this.currentToneMapping!==Ki,t=this.currentColorSpace!==en.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return this._renderTarget!==null?e=this._renderTarget.samples:this.needsFrameBufferTarget&&(e=0),e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Ki}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:en.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,n=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return Se("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e,t);const n=this._nodes.nodeFrame,s=n.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,n.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);const r=this.backend,a=this._pipelines,o=this._bindings,l=this._nodes,c=Array.isArray(e)?e:[e];if(c[0]===void 0||c[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");r.beginCompute(e);for(const u of c){if(a.has(u)===!1){const m=()=>{u.removeEventListener("dispose",m),a.delete(u),o.deleteForCompute(u),l.delete(u)};u.addEventListener("dispose",m);const g=u.onInitFunction;g!==null&&g.call(u,{renderer:this})}l.updateForCompute(u),o.updateForCompute(u);const h=o.getForCompute(u),f=a.getForCompute(u,h);r.compute(e,u,h,f,t)}r.finishCompute(e),n.renderId=s,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return oi('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){oi('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(e)}initTexture(e){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=Xu.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=Xu.copy(t).floor();else{De("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=Xu.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,s;n!==null?s=n.renderTarget:(s=this._renderTarget||this._getFrameBufferTarget(),s!==null&&(this._textures.updateRenderTarget(s),n=this._textures.get(s))),this._textures.updateTexture(e,{renderTarget:s}),this.backend.copyFramebufferToTexture(e,n,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,n=null,s=null,r=0,a=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,s,r,a),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,n,s,r,a=0,o=0){return this.backend.copyTextureToBuffer(e.textures[a],t,n,s,r,o)}_projectObject(e,t,n,s,r){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(r=r.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)s.pushLight(e);else if(e.isSprite){const l=t.isArrayCamera?B2:N2;if(!e.frustumCulled||l.intersectsSprite(e,t)){this.sortObjects===!0&&Xu.setFromMatrixPosition(e.matrixWorld).applyMatrix4(hA);const{geometry:c,material:u}=e;u.visible&&s.push(e,c,u,n,Xu.z,null,r)}}else if(e.isLineLoop)De("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const l=t.isArrayCamera?B2:N2;if(!e.frustumCulled||l.intersectsObject(e,t)){const{geometry:c,material:u}=e;if(this.sortObjects===!0&&(c.boundingSphere===null&&c.computeBoundingSphere(),Xu.copy(c.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(hA)),Array.isArray(u)){const h=c.groups;for(let f=0,m=h.length;f<m;f++){const g=h[f],x=u[g.materialIndex];x&&x.visible&&s.push(e,c,x,n,Xu.z,g,r)}}else u.visible&&s.push(e,c,u,n,Xu.z,null,r)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const l=s;s=this._renderLists.get(e,t),s.begin(),l.pushBundle({bundleGroup:e,camera:t,renderList:s}),s.finish()}const o=e.children;for(let l=0,c=o.length;l<c;l++)this._projectObject(o[l],t,n,s,r)}_renderBundles(e,t,n){for(const s of e)this._renderBundle(s,t,n)}_renderTransparents(e,t,n,s,r){if(t.length>0){for(const{material:a}of t)a.side=hi;this._renderObjects(t,n,s,r,"backSide");for(const{material:a}of t)a.side=jr;this._renderObjects(e,n,s,r);for(const{material:a}of t)a.side=Ps}else this._renderObjects(e,n,s,r)}_renderObjects(e,t,n,s,r=null){for(let a=0,o=e.length;a<o;a++){const{object:l,geometry:c,material:u,group:h,clippingContext:f}=e[a];this._currentRenderObjectFunction(l,n,t,c,u,h,s,f,r)}}_getShadowNodes(e){const t=e.version;let n=this._cacheShadowNodes.get(e);if(n===void 0||n.version!==t){const s=e.map!==null,r=e.colorNode&&e.colorNode.isNode,a=e.castShadowNode&&e.castShadowNode.isNode;let o=null,l=null,c=null;if(s||r||a){let u,h;a?(u=e.castShadowNode.rgb,h=e.castShadowNode.a):(u=se(0),h=W(1)),s&&(h=h.mul(vi("map","texture",e).a)),r&&(h=h.mul(e.colorNode.a)),l=It(u,h)}e.depthNode&&e.depthNode.isNode&&(c=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?o=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(o=e.positionNode),n={version:t,colorNode:l,depthNode:c,positionNode:o},this._cacheShadowNodes.set(e,n)}return n}renderObject(e,t,n,s,r,a,o,l=null,c=null){let u=!1,h,f,m,g;if(e.onBeforeRender(this,t,n,s,r,a),r.allowOverride===!0&&t.overrideMaterial!==null){const x=t.overrideMaterial;if(u=!0,h=t.overrideMaterial.colorNode,f=t.overrideMaterial.depthNode,m=t.overrideMaterial.positionNode,g=t.overrideMaterial.side,r.positionNode&&r.positionNode.isNode&&(x.positionNode=r.positionNode),x.alphaTest=r.alphaTest,x.alphaMap=r.alphaMap,x.transparent=r.transparent||r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode||r.backdropNode&&r.backdropNode.isNode,x.isShadowPassMaterial){const{colorNode:v,depthNode:y,positionNode:b}=this._getShadowNodes(r);x.side=r.shadowSide===null?r.side:r.shadowSide,v!==null&&(x.colorNode=v),y!==null&&(x.depthNode=y),b!==null&&(x.positionNode=b)}r=x}r.transparent===!0&&r.side===Ps&&r.forceSinglePass===!1?(r.side=hi,this._handleObjectFunction(e,r,t,n,o,a,l,"backSide"),r.side=jr,this._handleObjectFunction(e,r,t,n,o,a,l,c),r.side=Ps):this._handleObjectFunction(e,r,t,n,o,a,l,c),u&&(t.overrideMaterial.colorNode=h,t.overrideMaterial.depthNode=f,t.overrideMaterial.positionNode=m,t.overrideMaterial.side=g),e.onAfterRender(this,t,n,s,r,a)}_renderObjectDirect(e,t,n,s,r,a,o,l){const c=this._objects.get(e,t,n,s,r,this._currentRenderContext,o,l);c.drawRange=e.geometry.drawRange,c.group=a;const u=this._nodes.needsRefresh(c);u&&(this._nodes.updateBefore(c),this._geometries.updateForRender(c),this._nodes.updateForRender(c),this._bindings.updateForRender(c)),this._pipelines.updateForRender(c),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(c),c.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(c,this.info),u&&this._nodes.updateAfter(c)}_createObjectPipeline(e,t,n,s,r,a,o,l){const c=this._objects.get(e,t,n,s,r,this._currentRenderContext,o,l);c.drawRange=e.geometry.drawRange,c.group=a,this._nodes.updateBefore(c),this._geometries.updateForRender(c),this._nodes.updateForRender(c),this._bindings.updateForRender(c),this._pipelines.getForRender(c,this._compilationPromises),this._nodes.updateAfter(c)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class aK{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}getVisibility(){return this.visibility}clone(){return Object.assign(new this.constructor,this)}}function Ufe(i){return i+(Bd-i%Bd)%Bd}class oK extends aK{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t,this._updateRanges=[]}get updateRanges(){return this._updateRanges}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}get byteLength(){return Ufe(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class lK extends oK{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let Ife=0;class cK extends lK{constructor(e,t){super("UniformBuffer_"+Ife++,e?e.value:null),this.nodeUniform=e,this.groupNode=t,this.isNodeUniformBuffer=!0}set updateRanges(e){this.nodeUniform.updateRanges=e}get updateRanges(){return this.nodeUniform.updateRanges}addUpdateRange(e,t){this.nodeUniform.addUpdateRange(e,t)}clearUpdateRanges(){this.nodeUniform.clearUpdateRanges()}get buffer(){return this.nodeUniform.value}}class Pfe extends lK{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let n=0,s=this.uniforms.length;n<s;n++){const r=this.uniforms[n],a=r.boundary,o=r.itemSize*e,l=t%Bd,c=l%a,u=l+c;t+=c,u!==0&&Bd-u<o&&(t+=Bd-u),r.offset=t/e,t+=o}return Math.ceil(t/Bd)*Bd}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);De("WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const n=this.values,s=e.getValue(),r=e.offset,a=e.getType();if(n[r]!==s){const o=this._getBufferForType(a);o[r]=n[r]=s,t=!0}return t}updateVector2(e){let t=!1;const n=this.values,s=e.getValue(),r=e.offset,a=e.getType();if(n[r+0]!==s.x||n[r+1]!==s.y){const o=this._getBufferForType(a);o[r+0]=n[r+0]=s.x,o[r+1]=n[r+1]=s.y,t=!0}return t}updateVector3(e){let t=!1;const n=this.values,s=e.getValue(),r=e.offset,a=e.getType();if(n[r+0]!==s.x||n[r+1]!==s.y||n[r+2]!==s.z){const o=this._getBufferForType(a);o[r+0]=n[r+0]=s.x,o[r+1]=n[r+1]=s.y,o[r+2]=n[r+2]=s.z,t=!0}return t}updateVector4(e){let t=!1;const n=this.values,s=e.getValue(),r=e.offset,a=e.getType();if(n[r+0]!==s.x||n[r+1]!==s.y||n[r+2]!==s.z||n[r+4]!==s.w){const o=this._getBufferForType(a);o[r+0]=n[r+0]=s.x,o[r+1]=n[r+1]=s.y,o[r+2]=n[r+2]=s.z,o[r+3]=n[r+3]=s.w,t=!0}return t}updateColor(e){let t=!1;const n=this.values,s=e.getValue(),r=e.offset;if(n[r+0]!==s.r||n[r+1]!==s.g||n[r+2]!==s.b){const a=this.buffer;a[r+0]=n[r+0]=s.r,a[r+1]=n[r+1]=s.g,a[r+2]=n[r+2]=s.b,t=!0}return t}updateMatrix3(e){let t=!1;const n=this.values,s=e.getValue().elements,r=e.offset;if(n[r+0]!==s[0]||n[r+1]!==s[1]||n[r+2]!==s[2]||n[r+4]!==s[3]||n[r+5]!==s[4]||n[r+6]!==s[5]||n[r+8]!==s[6]||n[r+9]!==s[7]||n[r+10]!==s[8]){const a=this.buffer;a[r+0]=n[r+0]=s[0],a[r+1]=n[r+1]=s[1],a[r+2]=n[r+2]=s[2],a[r+4]=n[r+4]=s[3],a[r+5]=n[r+5]=s[4],a[r+6]=n[r+6]=s[5],a[r+8]=n[r+8]=s[6],a[r+9]=n[r+9]=s[7],a[r+10]=n[r+10]=s[8],t=!0}return t}updateMatrix4(e){let t=!1;const n=this.values,s=e.getValue().elements,r=e.offset;return Ffe(n,s,r)===!1&&(this.buffer.set(s,r),Ofe(n,s,r),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function Ofe(i,e,t){for(let n=0,s=e.length;n<s;n++)i[t+n]=e[n]}function Ffe(i,e,t){for(let n=0,s=e.length;n<s;n++)if(i[t+n]!==e[n])return!1;return!0}let Gfe=0;class uK extends Pfe{constructor(e,t){super(e),this.id=Gfe++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class hK extends aK{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=t,this.version=t?t.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=e,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}clone(){const e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=0},e.texture=this.texture,e}}let zfe=0;class Vfe extends hK{constructor(e,t){super(e,t),this.id=zfe++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class fw extends Vfe{constructor(e,t,n,s=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=s}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class dK extends fw{constructor(e,t,n,s=null){super(e,t,n,s),this.isSampledCubeTexture=!0}}class n3 extends fw{constructor(e,t,n,s=null){super(e,t,n,s),this.isSampledTexture3D=!0}}const b5={bitcast_int_uint:new rr("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }"),bitcast_uint_int:new rr("uint tsl_bitcast_uint_to_int ( uint x ) { return floatBitsToInt( uintBitsToFloat ( x ) ); }")},Hfe={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint",floatpack_snorm_2x16:"packSnorm2x16",floatpack_unorm_2x16:"packUnorm2x16",floatpack_float16_2x16:"packHalf2x16",floatunpack_snorm_2x16:"unpackSnorm2x16",floatunpack_unorm_2x16:"unpackUnorm2x16",floatunpack_float16_2x16:"unpackHalf2x16"},kfe={low:"lowp",medium:"mediump",high:"highp"},S5={swizzleAssign:!0,storageBuffer:!1},T5={perspective:"smooth",linear:"noperspective"},A5={centroid:"centroid"},M5=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class Wfe extends jP{constructor(e,t){super(e,t,new iK),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==ha}_include(e){const t=b5[e];return t.build(this),this.addInclude(t),t}getMethod(e){return b5[e]!==void 0&&this._include(e),Hfe[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,n){return`${e} ? ${t} : ${n}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),s=[];for(const a of t.inputs)s.push(this.getType(a.type)+" "+a.name);return`${this.getType(t.type)} ${t.name}( ${s.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const n=t.array,s=t.count*t.itemSize,{itemSize:r}=t,a=t.array.constructor.name.toLowerCase().includes("int");let o=a?Oh:ql;r===2?o=a?Yf:Wr:r===3?o=a?YL:gg:r===4&&(o=a?Kf:ii);const l={Float32Array:Rn,Uint8Array:ei,Uint16Array:ko,Uint32Array:Jn,Int8Array:$c,Int16Array:eu,Int32Array:Is,Uint8ClampedArray:ei},c=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(s/r))));let u=Math.ceil(s/r/c);c*u*r<s&&u++;const h=c*u*r,f=new n.constructor(h);f.set(n,0),t.array=f;const m=new _a(t.array,c,u,o,l[t.array.constructor.name]||Rn);m.needsUpdate=!0,m.isPBOTexture=!0;const g=new Tc(m,null,null);g.setPrecision("high"),t.pboNode=g,t.pbo=g.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,s=t.value;if(this.renderer.backend.has(s)){const u=this.renderer.backend.get(s);u.pbo=s.pbo}const r=this.getUniformFromNode(s.pboNode,"texture",this.shaderStage,this.context.nodeName),a=this.getPropertyName(r);this.increaseUsage(n);const o=n.build(this,"uint"),l=this.getDataFromNode(e);let c=l.propertyName;if(c===void 0){const u=this.getVarFromNode(e);c=this.getPropertyName(u);const h=this.getDataFromNode(t);let f=h.propertySizeName;f===void 0&&(f=c+"Size",this.getVarFromNode(t,f,"uint"),this.addLineFlowCode(`${f} = uint( textureSize( ${a}, 0 ).x )`,e),h.propertySizeName=f);const{itemSize:m}=s,g="."+ep.join("").slice(0,m),x=`ivec2(${o} % ${f}, ${o} / ${f})`,v=this.generateTextureLoad(null,a,x,"0",null,null);let y="vec4";s.pbo.type===Jn?y="uvec4":s.pbo.type===Is&&(y="ivec4"),this.addLineFlowCode(`${c} = ${y}(${v})${g}`,e),l.propertyName=c}return c}generateTextureLoad(e,t,n,s,r,a){s===null&&(s="0");let o;return r?a?o=`texelFetchOffset( ${t}, ivec3( ${n}, ${r} ), ${s}, ${a} )`:o=`texelFetch( ${t}, ivec3( ${n}, ${r} ), ${s} )`:a?o=`texelFetchOffset( ${t}, ${n}, ${s}, ${a} )`:o=`texelFetch( ${t}, ${n}, ${s} )`,e!==null&&e.isDepthTexture&&(o+=".x"),o}generateTexture(e,t,n,s,r){return s&&(n=`vec3( ${n}, ${s} )`),e.isDepthTexture?r?`textureOffset( ${t}, ${n}, ${r} ).x`:`texture( ${t}, ${n} ).x`:r?`textureOffset( ${t}, ${n}, ${r} )`:`texture( ${t}, ${n} )`}generateTextureLevel(e,t,n,s,r){return r?`textureLodOffset( ${t}, ${n}, ${s}, ${r} )`:`textureLod( ${t}, ${n}, ${s} )`}generateTextureBias(e,t,n,s,r){return r?`textureOffset( ${t}, ${n}, ${r}, ${s} )`:`texture( ${t}, ${n}, ${s} )`}generateTextureGrad(e,t,n,s,r){return r?`textureGradOffset( ${t}, ${n}, ${s[0]}, ${s[1]}, ${r} )`:`textureGrad( ${t}, ${n}, ${s[0]}, ${s[1]} )`}generateTextureCompare(e,t,n,s,r,a,o=this.shaderStage){if(o==="fragment")return e.isCubeTexture?`texture( ${t}, vec4( ${n}, ${s} ) )`:r?a?`textureOffset( ${t}, vec4( ${n}, ${r}, ${s} ), ${a} )`:`texture( ${t}, vec4( ${n}, ${r}, ${s} ) )`:a?`textureOffset( ${t}, vec3( ${n}, ${s} ), ${a} )`:`texture( ${t}, vec3( ${n}, ${s} ) )`;De(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const s of n)t.push(`${this.getVar(s.type,s.name,s.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],n=[],s={};for(const a of t){let o=null,l=!1;if(a.type==="texture"||a.type==="texture3D"){const u=a.node.value;let h="";(u.isDataTexture===!0||u.isData3DTexture===!0)&&(u.type===Jn?h="u":u.type===Is&&(h="i")),a.type==="texture3D"&&u.isArrayTexture===!1?o=`${h}sampler3D ${a.name};`:u.compareFunction?u.isArrayTexture===!0?o=`sampler2DArrayShadow ${a.name};`:o=`sampler2DShadow ${a.name};`:u.isArrayTexture===!0||u.isDataArrayTexture===!0||u.isCompressedArrayTexture===!0?o=`${h}sampler2DArray ${a.name};`:o=`${h}sampler2D ${a.name};`}else if(a.type==="cubeTexture")o=`samplerCube ${a.name};`;else if(a.type==="cubeDepthTexture")o=`samplerCubeShadow ${a.name};`;else if(a.type==="buffer"){const u=a.node,h=this.getType(u.bufferType),f=u.bufferCount,m=f>0?f:"";o=`${u.name} {
	${h} ${a.name}[${m}];
};
`}else o=`${this.getVectorType(a.type)} ${this.getPropertyName(a,e)};`,l=!0;const c=a.node.precision;if(c!==null&&(o=kfe[c]+" "+o),l){o="	"+o;const u=a.groupNode.name;(s[u]||(s[u]=[])).push(o)}else o="uniform "+o,n.push(o)}let r="";for(const a in s){const o=s[a];r+=this._getGLSLUniformStruct(e+"_"+a,o.join(`
`))+`
`}return r+=n.join(`
`),r}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Is){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const s=n.array;s instanceof Uint32Array||s instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const n=this.getAttributesArray();let s=0;for(const r of n)t+=`layout( location = ${s++} ) in ${r.type} ${r.name};
`}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push(`	${n.type} ${n.name};`);return t.join(`
`)}getStructs(e){const t=[],n=this.structs[e],s=[];for(const r of n)if(r.output)for(const a of r.members)s.push(`layout( location = ${a.index} ) out ${a.type} ${a.name};`);else{let a="struct "+r.name+` {
`;a+=this.getStructMembers(r),a+=`
};
`,t.push(a)}return s.length===0&&s.push("layout( location = 0 ) out vec4 fragColor;"),`
`+s.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const n=this.varyings;if(e==="vertex"||e==="compute")for(const s of n){e==="compute"&&(s.needsInterpolation=!0);const r=this.getType(s.type);if(s.needsInterpolation)if(s.interpolationType){const a=T5[s.interpolationType]||s.interpolationType,o=A5[s.interpolationSampling]||"";t+=`${a} ${o} out ${r} ${s.name};
`}else{const a=r.includes("int")||r.includes("uv")||r.includes("iv")?"flat ":"";t+=`${a}out ${r} ${s.name};
`}else t+=`${r} ${s.name};
`}else if(e==="fragment"){for(const s of n)if(s.needsInterpolation){const r=this.getType(s.type);if(s.interpolationType){const a=T5[s.interpolationType]||s.interpolationType,o=A5[s.interpolationSampling]||"";t+=`${a} ${o} in ${r} ${s.name};
`}else{const a=r.includes("int")||r.includes("uv")||r.includes("iv")?"flat ":"";t+=`${a}in ${r} ${s.name};
`}}}for(const s of this.builtins[e])t+=`${s};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((n,s)=>n*s,1)}u`}getSubgroupSize(){De("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){De("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){De("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,n=this.shaderStage){const s=this.extensions[n]||(this.extensions[n]=new Map);s.has(e)===!1&&s.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const s=this.renderer.backend.extensions;this.object.isBatchedMesh&&s.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(n!==void 0)for(const{name:s,behavior:r}of n.values())t.push(`#extension ${s} : ${r}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=S5[e];if(t===void 0){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance";break}if(n!==void 0){const s=this.renderer.backend.extensions;s.has(n)&&(s.get(n),t=!0)}S5[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const s=e[n],r=this.getPropertyName(s.attributeNode);r&&(t+=`${s.varyingName} = ${r};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${M5}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${M5}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n=`// code

`;n+=this.flowCode[t];const s=this.flowNodes[t],r=s[s.length-1];for(const o of s){const l=this.getFlowData(o),c=o.name;c&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${c}
	`),n+=`${l.code}
	`,o===r&&t!=="compute"&&(n+=`// result
	`,t==="vertex"?(n+="gl_Position = ",n+=`${l.result};`):t==="fragment"&&(o.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${l.result};`)))}const a=e[t];a.extensions=this.getExtensions(t),a.uniforms=this.getUniforms(t),a.attributes=this.getAttributes(t),a.varyings=this.getVaryings(t),a.vars=this.getVars(t),a.structs=this.getStructs(t),a.codes=this.getCodes(t),a.transforms=this.getTransforms(t),a.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n,s=null){const r=super.getUniformFromNode(e,t,n,s),a=this.getDataFromNode(e,n,this.globalCache);let o=a.uniformGPU;if(o===void 0){const l=e.groupNode,c=l.name,u=this.getBindGroupArray(c,n);if(t==="texture")o=new fw(r.name,r.node,l),u.push(o);else if(t==="cubeTexture"||t==="cubeDepthTexture")o=new dK(r.name,r.node,l),u.push(o);else if(t==="texture3D")o=new n3(r.name,r.node,l),u.push(o);else if(t==="buffer"){r.name=`buffer${e.id}`;const h=this.getSharedDataFromNode(e);let f=h.buffer;f===void 0&&(e.name=`NodeBuffer_${e.id}`,f=new cK(e,l),f.name=e.name,h.buffer=f),u.push(f),o=f}else{const h=this.uniformGroups[n]||(this.uniformGroups[n]={});let f=h[c];f===void 0&&(f=new uK(n+"_"+c,l),h[c]=f,u.push(f)),o=this.getNodeUniform(r,t),f.addUniform(o)}a.uniformGPU=o}return r}}let D2=null,D0=null;class fK{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[ga.RENDER]:null,[ga.COMPUTE]:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){const t=this.get(e),n=this.renderer.info.frame;let s;e.isComputeNode===!0?s="c:"+this.renderer.info.compute.frameCalls:s="r:"+this.renderer.info.render.frameCalls,t.timestampUID=s+":"+e.id+":f"+n}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){const t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){const t=e.startsWith("c:")?ga.COMPUTE:ga.RENDER;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){oi("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t)return;const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return D2=D2||new Ae,this.renderer.getDrawingBufferSize(D2)}setScissorTest(){}getClearColor(){const e=this.renderer;return D0=D0||new AP,e.getClearColor(D0),D0.getRGB(D0),D0}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:YE(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${bu} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}deleteBindGroupData(){}dispose(){}}let Xfe=0;class qfe{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class jfe{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:s}=n,r=e.array,a=e.usage||s.STATIC_DRAW,o=e.isInterleavedBufferAttribute?e.data:e,l=n.get(o);let c=l.bufferGPU;c===void 0&&(c=this._createBuffer(s,t,r,a),l.bufferGPU=c,l.bufferType=t,l.version=o.version);let u;if(r instanceof Float32Array)u=s.FLOAT;else if(typeof Float16Array<"u"&&r instanceof Float16Array)u=s.HALF_FLOAT;else if(r instanceof Uint16Array)e.isFloat16BufferAttribute?u=s.HALF_FLOAT:u=s.UNSIGNED_SHORT;else if(r instanceof Int16Array)u=s.SHORT;else if(r instanceof Uint32Array)u=s.UNSIGNED_INT;else if(r instanceof Int32Array)u=s.INT;else if(r instanceof Int8Array)u=s.BYTE;else if(r instanceof Uint8Array)u=s.UNSIGNED_BYTE;else if(r instanceof Uint8ClampedArray)u=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+r);let h={bufferGPU:c,bufferType:t,type:u,byteLength:r.byteLength,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:u===s.INT||u===s.UNSIGNED_INT||e.gpuType===Is,id:Xfe++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const f=this._createBuffer(s,t,r,a);h=new qfe(h,f)}n.set(e,h)}updateAttribute(e){const t=this.backend,{gl:n}=t,s=e.array,r=e.isInterleavedBufferAttribute?e.data:e,a=t.get(r),o=a.bufferType,l=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(o,a.bufferGPU),l.length===0)n.bufferSubData(o,0,s);else{for(let c=0,u=l.length;c<u;c++){const h=l[c];n.bufferSubData(o,h.start*s.BYTES_PER_ELEMENT,s,h.start,h.count)}r.clearUpdateRanges()}n.bindBuffer(o,null),a.version=r.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const s=t.get(e);n.deleteBuffer(s.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,s=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:r}=t.get(s),a=e.array,o=a.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,r);const l=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,l),n.bufferData(n.COPY_WRITE_BUFFER,o,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,o),await t.utils._clientWaitAsync();const c=new e.array.constructor(a.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,l),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,c),n.deleteBuffer(l),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),c.buffer}_createBuffer(e,t,n,s){const r=e.createBuffer();return e.bindBuffer(t,r),e.bufferData(t,n,s),e.bindBuffer(t,null),r}}let L2,Z_,Yfe=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;L2={[Mr]:e.FUNC_ADD,[cS]:e.FUNC_SUBTRACT,[uS]:e.FUNC_REVERSE_SUBTRACT},Z_={[dc]:e.ZERO,[hS]:e.ONE,[dS]:e.SRC_COLOR,[Pm]:e.SRC_ALPHA,[xS]:e.SRC_ALPHA_SATURATE,[gS]:e.DST_COLOR,[pS]:e.DST_ALPHA,[fS]:e.ONE_MINUS_SRC_COLOR,[Om]:e.ONE_MINUS_SRC_ALPHA,[yS]:e.ONE_MINUS_DST_COLOR,[mS]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=new un().fromArray(t),this.currentViewport=new un().fromArray(n),this._tempVec4=new un}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==PE?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===gb?t.cullFace(t.BACK):e===OE?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setMRTBlending(e){const t=this.gl,n=this.backend.drawBuffersIndexedExt;if(n)for(let s=1;s<e.length;s++)n.blendFuncSeparateiOES(s,t.ONE,t.ZERO,t.ONE,t.ZERO)}setBlending(e,t,n,s,r,a,o,l){const{gl:c}=this;if(e===Nr){this.currentBlendingEnabled===!0&&(this.disable(c.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(c.BLEND),this.currentBlendingEnabled=!0),e!==nf){if(e!==this.currentBlending||l!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==Mr||this.currentBlendEquationAlpha!==Mr)&&(c.blendEquation(c.FUNC_ADD),this.currentBlendEquation=Mr,this.currentBlendEquationAlpha=Mr),l)switch(e){case qa:c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case hf:c.blendFunc(c.ONE,c.ONE);break;case df:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case Ch:c.blendFuncSeparate(c.DST_COLOR,c.ONE_MINUS_SRC_ALPHA,c.ZERO,c.ONE);break;default:De("WebGLState: Invalid blending: ",e);break}else switch(e){case qa:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case hf:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE,c.ONE,c.ONE);break;case df:De("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Ch:De("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:De("WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=l}return}r=r||t,a=a||n,o=o||s,(t!==this.currentBlendEquation||r!==this.currentBlendEquationAlpha)&&(c.blendEquationSeparate(L2[t],L2[r]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=r),(n!==this.currentBlendSrc||s!==this.currentBlendDst||a!==this.currentBlendSrcAlpha||o!==this.currentBlendDstAlpha)&&(c.blendFuncSeparate(Z_[n],Z_[s],Z_[a],Z_[o]),this.currentBlendSrc=n,this.currentBlendDst=s,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=o),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case Fm:t.depthFunc(t.NEVER);break;case Gm:t.depthFunc(t.ALWAYS);break;case zm:t.depthFunc(t.LESS);break;case uu:t.depthFunc(t.LEQUAL);break;case Vm:t.depthFunc(t.EQUAL);break;case Hm:t.depthFunc(t.GEQUAL);break;case km:t.depthFunc(t.GREATER);break;case Wm:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,s){const r=this._tempVec4.set(e,t,n,s);if(this.currentScissor.equals(r)===!1){const{gl:a}=this;a.scissor(r.x,r.y,r.z,r.w),this.currentScissor.copy(r)}}viewport(e,t,n,s){const r=this._tempVec4.set(e,t,n,s);if(this.currentViewport.equals(r)===!1){const{gl:a}=this;a.viewport(r.x,r.y,r.z,r.w),this.currentViewport.copy(r)}}setScissorTest(e){const t=this.gl;e?this.enable(t.SCISSOR_TEST):this.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:s}=this;e.side===Ps?this.disable(s.CULL_FACE):this.enable(s.CULL_FACE);let r=e.side===hi;t&&(r=!r),this.setFlipSided(r),e.blending===qa&&e.transparent===!1?this.setBlending(Nr):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const a=e.stencilWrite;if(this.setStencilTest(a),a&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(s.SAMPLE_ALPHA_TO_COVERAGE):this.disable(s.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n)for(let l=0;l<8;l++)l<n?this.enable(12288+l):this.disable(12288+l)}setPolygonOffset(e,t,n){const{gl:s}=this;e?(this.enable(s.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==n)&&(s.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(s.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const n=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(n.bindVertexArray(e),t!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:s}=this;return s[e]!==t?(n.bindFramebuffer(e,t),s[e]=t,e===n.DRAW_FRAMEBUFFER&&(s[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(s[n.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:n}=this;let s=[],r=!1;if(e.textures!==null){s=this.currentDrawbuffers.get(t),s===void 0&&(s=[],this.currentDrawbuffers.set(t,s));const a=e.textures;if(s.length!==a.length||s[0]!==n.COLOR_ATTACHMENT0){for(let o=0,l=a.length;o<l;o++)s[o]=n.COLOR_ATTACHMENT0+o;s.length=a.length,r=!0}}else s[0]!==n.BACK&&(s[0]=n.BACK,r=!0);r&&n.drawBuffers(s)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:s}=this;e===void 0&&(e=t.TEXTURE0+s-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:s,currentTextureSlot:r,currentBoundTextures:a,maxTextures:o}=this;n===void 0&&(r===null?n=s.TEXTURE0+o-1:n=r);let l=a[n];l===void 0&&(l={type:void 0,texture:void 0},a[n]=l),(l.type!==e||l.texture!==t)&&(r!==n&&(s.activeTexture(n),this.currentTextureSlot=n),s.bindTexture(e,t),l.type=e,l.texture=t)}bindBufferBase(e,t,n){const{gl:s}=this,r=`${e}-${t}`;return this.currentBoundBufferBases[r]!==n?(s.bindBufferBase(e,t,n),this.currentBoundBufferBases[r]=n,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,s=n[t];s!==void 0&&s.type!==void 0&&(e.bindTexture(s.type,null),s.type=void 0,s.texture=void 0)}},Kfe=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=ha){const{gl:n,extensions:s}=this;let r;const a=en.getTransfer(t);if(e===ei)return n.UNSIGNED_BYTE;if(e===Sx)return n.UNSIGNED_SHORT_4_4_4_4;if(e===Tx)return n.UNSIGNED_SHORT_5_5_5_1;if(e===Ax)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===Mx)return n.UNSIGNED_INT_10F_11F_11F_REV;if(e===$c)return n.BYTE;if(e===eu)return n.SHORT;if(e===ko)return n.UNSIGNED_SHORT;if(e===Is)return n.INT;if(e===Jn)return n.UNSIGNED_INT;if(e===Rn)return n.FLOAT;if(e===ln)return n.HALF_FLOAT;if(e===_S)return n.ALPHA;if(e===gg)return n.RGB;if(e===ii)return n.RGBA;if(e===lr)return n.DEPTH_COMPONENT;if(e===kr)return n.DEPTH_STENCIL;if(e===ql)return n.RED;if(e===Oh)return n.RED_INTEGER;if(e===Wr)return n.RG;if(e===Yf)return n.RG_INTEGER;if(e===Kf)return n.RGBA_INTEGER;if(e===tu||e===nu||e===iu||e===su)if(a===Ft)if(r=s.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(e===tu)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===nu)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===iu)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===su)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=s.get("WEBGL_compressed_texture_s3tc"),r!==null){if(e===tu)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===nu)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===iu)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===su)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===Xm||e===qm||e===jm||e===Ym)if(r=s.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(e===Xm)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===qm)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===jm)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Ym)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===ff||e===pf||e===mf||e===gf||e===yf||e===Rh||e===xf)if(r=s.get("WEBGL_compressed_texture_etc"),r!==null){if(e===ff||e===pf)return a===Ft?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(e===mf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC;if(e===gf)return r.COMPRESSED_R11_EAC;if(e===yf)return r.COMPRESSED_SIGNED_R11_EAC;if(e===Rh)return r.COMPRESSED_RG11_EAC;if(e===xf)return r.COMPRESSED_SIGNED_RG11_EAC}else return null;if(e===_f||e===vf||e===bf||e===Sf||e===Tf||e===Af||e===Mf||e===Ef||e===Cf||e===wf||e===Rf||e===Nf||e===Bf||e===Df)if(r=s.get("WEBGL_compressed_texture_astc"),r!==null){if(e===_f)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===vf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===bf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Sf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Tf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===Af)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===Mf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===Ef)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===Cf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===wf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===Rf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Nf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===Bf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===Df)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===Lf)if(r=s.get("EXT_texture_compression_bptc"),r!==null){if(e===Lf)return a===Ft?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===Uf||e===If||e===Nh||e===Pf)if(r=s.get("EXT_texture_compression_rgtc"),r!==null){if(e===Uf)return r.COMPRESSED_RED_RGTC1_EXT;if(e===If)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===Nh)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===Pf)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===ja?n.UNSIGNED_INT_24_8:n[e]!==void 0?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,s)=>{function r(){const a=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(a===e.WAIT_FAILED){e.deleteSync(t),s();return}if(a===e.TIMEOUT_EXPIRED){requestAnimationFrame(r);return}e.deleteSync(t),n()}r()})}},E5=!1,dA,U2,C5;class Zfe{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,E5===!1&&(this._init(),E5=!0)}_init(){const e=this.gl;dA={[Zr]:e.REPEAT,[ui]:e.CLAMP_TO_EDGE,[vc]:e.MIRRORED_REPEAT},U2={[$n]:e.NEAREST,[mg]:e.NEAREST_MIPMAP_NEAREST,[Ho]:e.NEAREST_MIPMAP_LINEAR,[Jt]:e.LINEAR,[Qc]:e.LINEAR_MIPMAP_NEAREST,[$s]:e.LINEAR_MIPMAP_LINEAR},C5={[bS]:e.NEVER,[MS]:e.ALWAYS,[yg]:e.LESS,[xg]:e.LEQUAL,[SS]:e.EQUAL,[_g]:e.GEQUAL,[TS]:e.GREATER,[AS]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return e.isCubeTexture===!0?n=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?n=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?n=t.TEXTURE_3D:n=t.TEXTURE_2D,n}getInternalFormat(e,t,n,s,r=!1){const{gl:a,extensions:o}=this;if(e!==null){if(a[e]!==void 0)return a[e];Se("WebGLBackend: Attempt to use non-existing WebGL internal format '"+e+"'")}let l=t;if(t===a.RED&&(n===a.FLOAT&&(l=a.R32F),n===a.HALF_FLOAT&&(l=a.R16F),n===a.UNSIGNED_BYTE&&(l=a.R8),n===a.UNSIGNED_SHORT&&(l=a.R16),n===a.UNSIGNED_INT&&(l=a.R32UI),n===a.BYTE&&(l=a.R8I),n===a.SHORT&&(l=a.R16I),n===a.INT&&(l=a.R32I)),t===a.RED_INTEGER&&(n===a.UNSIGNED_BYTE&&(l=a.R8UI),n===a.UNSIGNED_SHORT&&(l=a.R16UI),n===a.UNSIGNED_INT&&(l=a.R32UI),n===a.BYTE&&(l=a.R8I),n===a.SHORT&&(l=a.R16I),n===a.INT&&(l=a.R32I)),t===a.RG&&(n===a.FLOAT&&(l=a.RG32F),n===a.HALF_FLOAT&&(l=a.RG16F),n===a.UNSIGNED_BYTE&&(l=a.RG8),n===a.UNSIGNED_SHORT&&(l=a.RG16),n===a.UNSIGNED_INT&&(l=a.RG32UI),n===a.BYTE&&(l=a.RG8I),n===a.SHORT&&(l=a.RG16I),n===a.INT&&(l=a.RG32I)),t===a.RG_INTEGER&&(n===a.UNSIGNED_BYTE&&(l=a.RG8UI),n===a.UNSIGNED_SHORT&&(l=a.RG16UI),n===a.UNSIGNED_INT&&(l=a.RG32UI),n===a.BYTE&&(l=a.RG8I),n===a.SHORT&&(l=a.RG16I),n===a.INT&&(l=a.RG32I)),t===a.RGB){const c=r?Of:en.getTransfer(s);n===a.FLOAT&&(l=a.RGB32F),n===a.HALF_FLOAT&&(l=a.RGB16F),n===a.UNSIGNED_BYTE&&(l=a.RGB8),n===a.UNSIGNED_SHORT&&(l=a.RGB16),n===a.UNSIGNED_INT&&(l=a.RGB32UI),n===a.BYTE&&(l=a.RGB8I),n===a.SHORT&&(l=a.RGB16I),n===a.INT&&(l=a.RGB32I),n===a.UNSIGNED_BYTE&&(l=c===Ft?a.SRGB8:a.RGB8),n===a.UNSIGNED_SHORT_5_6_5&&(l=a.RGB565),n===a.UNSIGNED_SHORT_5_5_5_1&&(l=a.RGB5_A1),n===a.UNSIGNED_SHORT_4_4_4_4&&(l=a.RGB4),n===a.UNSIGNED_INT_5_9_9_9_REV&&(l=a.RGB9_E5),n===a.UNSIGNED_INT_10F_11F_11F_REV&&(l=a.R11F_G11F_B10F)}if(t===a.RGB_INTEGER&&(n===a.UNSIGNED_BYTE&&(l=a.RGB8UI),n===a.UNSIGNED_SHORT&&(l=a.RGB16UI),n===a.UNSIGNED_INT&&(l=a.RGB32UI),n===a.BYTE&&(l=a.RGB8I),n===a.SHORT&&(l=a.RGB16I),n===a.INT&&(l=a.RGB32I)),t===a.RGBA){const c=r?Of:en.getTransfer(s);n===a.FLOAT&&(l=a.RGBA32F),n===a.HALF_FLOAT&&(l=a.RGBA16F),n===a.UNSIGNED_BYTE&&(l=a.RGBA8),n===a.UNSIGNED_SHORT&&(l=a.RGBA16),n===a.UNSIGNED_INT&&(l=a.RGBA32UI),n===a.BYTE&&(l=a.RGBA8I),n===a.SHORT&&(l=a.RGBA16I),n===a.INT&&(l=a.RGBA32I),n===a.UNSIGNED_BYTE&&(l=c===Ft?a.SRGB8_ALPHA8:a.RGBA8),n===a.UNSIGNED_SHORT_4_4_4_4&&(l=a.RGBA4),n===a.UNSIGNED_SHORT_5_5_5_1&&(l=a.RGB5_A1)}return t===a.RGBA_INTEGER&&(n===a.UNSIGNED_BYTE&&(l=a.RGBA8UI),n===a.UNSIGNED_SHORT&&(l=a.RGBA16UI),n===a.UNSIGNED_INT&&(l=a.RGBA32UI),n===a.BYTE&&(l=a.RGBA8I),n===a.SHORT&&(l=a.RGBA16I),n===a.INT&&(l=a.RGBA32I)),t===a.DEPTH_COMPONENT&&(n===a.UNSIGNED_SHORT&&(l=a.DEPTH_COMPONENT16),n===a.UNSIGNED_INT&&(l=a.DEPTH_COMPONENT24),n===a.FLOAT&&(l=a.DEPTH_COMPONENT32F)),t===a.DEPTH_STENCIL&&n===a.UNSIGNED_INT_24_8&&(l=a.DEPTH24_STENCIL8),(l===a.R16F||l===a.R32F||l===a.RG16F||l===a.RG32F||l===a.RGBA16F||l===a.RGBA32F)&&o.get("EXT_color_buffer_float"),l}setTextureParameters(e,t){const{gl:n,extensions:s,backend:r}=this,a=en.getPrimaries(en.workingColorSpace),o=t.colorSpace===ha?null:en.getPrimaries(t.colorSpace),l=t.colorSpace===ha||a===o?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,l),n.texParameteri(e,n.TEXTURE_WRAP_S,dA[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,dA[t.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||n.texParameteri(e,n.TEXTURE_WRAP_R,dA[t.wrapR])),n.texParameteri(e,n.TEXTURE_MAG_FILTER,U2[t.magFilter]);const c=t.mipmaps!==void 0&&t.mipmaps.length>0,u=t.minFilter===Jt&&c?$s:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,U2[u]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,C5[t.compareFunction])),s.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===$n||t.minFilter!==Ho&&t.minFilter!==$s||t.type===Rn&&s.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const h=s.get("EXT_texture_filter_anisotropic");n.texParameterf(e,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,r.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:s}=this,r=this.getGLTextureType(e);let a=s[r];a===void 0&&(a=t.createTexture(),n.state.bindTexture(r,a),t.texParameteri(r,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(r,t.TEXTURE_MAG_FILTER,t.NEAREST),s[r]=a),n.set(e,{textureGPU:a,glTextureType:r})}createTexture(e,t){const{gl:n,backend:s}=this,{levels:r,width:a,height:o,depth:l}=t,c=s.utils.convert(e.format,e.colorSpace),u=s.utils.convert(e.type),h=this.getInternalFormat(e.internalFormat,c,u,e.colorSpace,e.isVideoTexture),f=n.createTexture(),m=this.getGLTextureType(e);s.state.bindTexture(m,f),this.setTextureParameters(m,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,r,h,a,o,l):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,r,h,a,o,l):e.isVideoTexture||n.texStorage2D(m,r,h,a,o),s.set(e,{textureGPU:f,glTextureType:m,glFormat:c,glType:u,glInternalFormat:h})}copyBufferToTexture(e,t){const{gl:n,backend:s}=this,{textureGPU:r,glTextureType:a,glFormat:o,glType:l}=s.get(t),{width:c,height:u}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),s.state.bindTexture(a,r),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(a,0,0,0,c,u,o,l,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),s.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:s,height:r}=t,{textureGPU:a,glTextureType:o,glFormat:l,glType:c,glInternalFormat:u}=this.backend.get(e);if(!(e.isRenderTargetTexture||a===void 0))if(this.backend.state.bindTexture(o,a),this.setTextureParameters(o,e),e.isCompressedTexture){const h=e.mipmaps,f=t.image;for(let m=0;m<h.length;m++){const g=h[m];e.isCompressedArrayTexture?e.format!==n.RGBA?l!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,m,0,0,0,g.width,g.height,f.depth,l,g.data):Se("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,m,0,0,0,g.width,g.height,f.depth,l,c,g.data):l!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,m,0,0,g.width,g.height,l,g.data):Se("WebGLBackend: Unsupported compressed texture format")}}else if(e.isCubeTexture){const h=t.images,f=e.mipmaps;for(let m=0;m<6;m++){const g=fA(h[m]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,0,0,s,r,l,c,g);for(let x=0;x<f.length;x++){const v=f[x],y=fA(v.images[m]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+m,x+1,0,0,y.width,y.height,l,c,y)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const h=t.image;if(e.layerUpdates.size>0){const f=IM(h.width,h.height,e.format,e.type);for(const m of e.layerUpdates){const g=h.data.subarray(m*f/h.data.BYTES_PER_ELEMENT,(m+1)*f/h.data.BYTES_PER_ELEMENT);n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,m,h.width,h.height,1,l,c,g)}e.clearLayerUpdates()}else n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,h.width,h.height,h.depth,l,c,h.data)}else if(e.isData3DTexture){const h=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,h.width,h.height,h.depth,l,c,h.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(o,0,u,l,c,t.image);else{const h=e.mipmaps;if(h.length>0)for(let f=0,m=h.length;f<m;f++){const g=h[f],x=fA(g);n.texSubImage2D(o,f,0,0,g.width,g.height,l,c,x)}else{const f=fA(t.image);n.texSubImage2D(o,0,0,0,s,r,l,c,f)}}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:s,glTextureType:r}=n.get(e);n.state.bindTexture(r,s),t.generateMipmap(r)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const s=n.get(e);if(s.renderBufferStorageSetup=void 0,s.framebuffers){for(const r in s.framebuffers)t.deleteFramebuffer(s.framebuffers[r]);delete s.framebuffers}if(s.depthRenderbuffer&&(t.deleteRenderbuffer(s.depthRenderbuffer),delete s.depthRenderbuffer),s.stencilRenderbuffer&&(t.deleteRenderbuffer(s.stencilRenderbuffer),delete s.stencilRenderbuffer),s.msaaFrameBuffer&&(t.deleteFramebuffer(s.msaaFrameBuffer),delete s.msaaFrameBuffer),s.msaaRenderbuffers){for(let r=0;r<s.msaaRenderbuffers.length;r++)t.deleteRenderbuffer(s.msaaRenderbuffers[r]);delete s.msaaRenderbuffers}}}destroyTexture(e,t=!1){const{gl:n,backend:s}=this,{textureGPU:r,renderTarget:a}=s.get(e);this.deallocateRenderBuffers(a),t===!1&&n.deleteTexture(r),s.delete(e)}copyTextureToTexture(e,t,n=null,s=null,r=0,a=0){const{gl:o,backend:l}=this,{state:c}=this.backend,{textureGPU:u,glTextureType:h,glType:f,glFormat:m}=l.get(t);c.bindTexture(h,u);let g,x,v,y,b,S,T,M,C;const w=e.isCompressedTexture?e.mipmaps[a]:e.image;if(n!==null)g=n.max.x-n.min.x,x=n.max.y-n.min.y,v=n.isBox3?n.max.z-n.min.z:1,y=n.min.x,b=n.min.y,S=n.isBox3?n.min.z:0;else{const Y=Math.pow(2,-r);g=Math.floor(w.width*Y),x=Math.floor(w.height*Y),e.isDataArrayTexture||e.isArrayTexture?v=w.depth:e.isData3DTexture?v=Math.floor(w.depth*Y):v=1,y=0,b=0,S=0}s!==null?(T=s.x,M=s.y,C=s.z):(T=0,M=0,C=0),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment);const N=o.getParameter(o.UNPACK_ROW_LENGTH),E=o.getParameter(o.UNPACK_IMAGE_HEIGHT),B=o.getParameter(o.UNPACK_SKIP_PIXELS),U=o.getParameter(o.UNPACK_SKIP_ROWS),H=o.getParameter(o.UNPACK_SKIP_IMAGES);o.pixelStorei(o.UNPACK_ROW_LENGTH,w.width),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,w.height),o.pixelStorei(o.UNPACK_SKIP_PIXELS,y),o.pixelStorei(o.UNPACK_SKIP_ROWS,b),o.pixelStorei(o.UNPACK_SKIP_IMAGES,S);const F=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,V=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){const Y=l.get(e),P=l.get(t),X=l.get(Y.renderTarget),J=l.get(P.renderTarget),re=X.framebuffers[Y.cacheKey],ne=J.framebuffers[P.cacheKey];c.bindFramebuffer(o.READ_FRAMEBUFFER,re),c.bindFramebuffer(o.DRAW_FRAMEBUFFER,ne);for(let ge=0;ge<v;ge++)F&&(o.framebufferTextureLayer(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,Y.textureGPU,r,S+ge),o.framebufferTextureLayer(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,u,a,C+ge)),o.blitFramebuffer(y,b,g,x,T,M,g,x,o.DEPTH_BUFFER_BIT,o.NEAREST);c.bindFramebuffer(o.READ_FRAMEBUFFER,null),c.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else if(r!==0||e.isRenderTargetTexture||l.has(e)){const Y=l.get(e);this._srcFramebuffer===null&&(this._srcFramebuffer=o.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=o.createFramebuffer()),c.bindFramebuffer(o.READ_FRAMEBUFFER,this._srcFramebuffer),c.bindFramebuffer(o.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let P=0;P<v;P++)F?o.framebufferTextureLayer(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,Y.textureGPU,r,S+P):o.framebufferTexture2D(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,Y.textureGPU,r),V?o.framebufferTextureLayer(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,u,a,C+P):o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,u,a),r!==0?o.blitFramebuffer(y,b,g,x,T,M,g,x,o.COLOR_BUFFER_BIT,o.NEAREST):V?o.copyTexSubImage3D(h,a,T,M,C+P,y,b,g,x):o.copyTexSubImage2D(h,a,T,M,y,b,g,x);c.bindFramebuffer(o.READ_FRAMEBUFFER,null),c.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else V?e.isDataTexture||e.isData3DTexture?o.texSubImage3D(h,a,T,M,C,g,x,v,m,f,w.data):t.isCompressedArrayTexture?o.compressedTexSubImage3D(h,a,T,M,C,g,x,v,m,w.data):o.texSubImage3D(h,a,T,M,C,g,x,v,m,f,w):e.isDataTexture?o.texSubImage2D(o.TEXTURE_2D,a,T,M,g,x,m,f,w.data):e.isCompressedTexture?o.compressedTexSubImage2D(o.TEXTURE_2D,a,T,M,w.width,w.height,m,w.data):o.texSubImage2D(o.TEXTURE_2D,a,T,M,g,x,m,f,w);o.pixelStorei(o.UNPACK_ROW_LENGTH,N),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,E),o.pixelStorei(o.UNPACK_SKIP_PIXELS,B),o.pixelStorei(o.UNPACK_SKIP_ROWS,U),o.pixelStorei(o.UNPACK_SKIP_IMAGES,H),a===0&&t.generateMipmaps&&o.generateMipmap(h),c.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:s}=this,{state:r}=this.backend,{textureGPU:a}=this.backend.get(e),{x:o,y:l,z:c,w:u}=n,h=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,f=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(h){const m=o!==0||l!==0;let g,x;if(e.isDepthTexture===!0?(g=s.DEPTH_BUFFER_BIT,x=s.DEPTH_ATTACHMENT,t.stencil&&(g|=s.STENCIL_BUFFER_BIT)):(g=s.COLOR_BUFFER_BIT,x=s.COLOR_ATTACHMENT0),m){const v=this.backend.get(t.renderTarget),y=v.framebuffers[t.getCacheKey()],b=v.msaaFrameBuffer;r.bindFramebuffer(s.DRAW_FRAMEBUFFER,y),r.bindFramebuffer(s.READ_FRAMEBUFFER,b);const S=f-l-u;s.blitFramebuffer(o,S,o+c,S+u,o,S,o+c,S+u,g,s.NEAREST),r.bindFramebuffer(s.READ_FRAMEBUFFER,y),r.bindTexture(s.TEXTURE_2D,a),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,o,S,c,u),r.unbindTexture()}else{const v=s.createFramebuffer();r.bindFramebuffer(s.DRAW_FRAMEBUFFER,v),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,x,s.TEXTURE_2D,a,0),s.blitFramebuffer(0,0,c,u,0,0,c,u,g,s.NEAREST),s.deleteFramebuffer(v)}}else r.bindTexture(s.TEXTURE_2D,a),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,o,f-u-l,c,u),r.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n,s=!1){const{gl:r}=this,a=t.renderTarget,{depthTexture:o,depthBuffer:l,stencilBuffer:c,width:u,height:h}=a;if(r.bindRenderbuffer(r.RENDERBUFFER,e),l&&!c){let f=r.DEPTH_COMPONENT24;s===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(r.RENDERBUFFER,a.samples,f,u,h):n>0?(o&&o.isDepthTexture&&o.type===r.FLOAT&&(f=r.DEPTH_COMPONENT32F),r.renderbufferStorageMultisample(r.RENDERBUFFER,n,f,u,h)):r.renderbufferStorage(r.RENDERBUFFER,f,u,h),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e)}else l&&c&&(n>0?r.renderbufferStorageMultisample(r.RENDERBUFFER,n,r.DEPTH24_STENCIL8,u,h):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,u,h),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e));r.bindRenderbuffer(r.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,n,s,r,a){const{backend:o,gl:l}=this,{textureGPU:c,glFormat:u,glType:h}=this.backend.get(e),f=l.createFramebuffer();o.state.bindFramebuffer(l.READ_FRAMEBUFFER,f);const m=e.isCubeTexture?l.TEXTURE_CUBE_MAP_POSITIVE_X+a:l.TEXTURE_2D;l.framebufferTexture2D(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,m,c,0);const g=this._getTypedArrayType(h),x=this._getBytesPerTexel(h,u),y=s*r*x,b=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,b),l.bufferData(l.PIXEL_PACK_BUFFER,y,l.STREAM_READ),l.readPixels(t,n,s,r,u,h,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await o.utils._clientWaitAsync();const S=new g(y/g.BYTES_PER_ELEMENT);return l.bindBuffer(l.PIXEL_PACK_BUFFER,b),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,S),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),o.state.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.deleteFramebuffer(f),S}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:n}=this;let s=0;if(e===n.UNSIGNED_BYTE&&(s=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(s=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(s=4),t===n.RGBA)return s*4;if(t===n.RGB)return s*3;if(t===n.ALPHA)return s}dispose(){const{gl:e}=this;this._srcFramebuffer!==null&&e.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&e.deleteFramebuffer(this._dstFramebuffer)}}function fA(i){return i.isDataTexture?i.image.data:typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?i:i.data}let Jfe=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}},Qfe=class{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}};const w5={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};let $fe=class{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:s,object:r,type:a,info:o,index:l}=this;l!==0?n.drawElements(s,t,a,e):n.drawArrays(s,e,t),o.update(r,t,1)}renderInstances(e,t,n){const{gl:s,mode:r,type:a,index:o,object:l,info:c}=this;n!==0&&(o!==0?s.drawElementsInstanced(r,t,a,e,n):s.drawArraysInstanced(r,e,t,n),c.update(l,t,n))}renderMultiDraw(e,t,n){const{extensions:s,mode:r,object:a,info:o}=this;if(n===0)return;const l=s.get("WEBGL_multi_draw");if(l===null)for(let c=0;c<n;c++)this.render(e[c],t[c]);else{this.index!==0?l.multiDrawElementsWEBGL(r,t,0,this.type,e,0,n):l.multiDrawArraysWEBGL(r,e,0,t,0,n);let c=0;for(let u=0;u<n;u++)c+=t[u];o.update(a,c,1)}}renderMultiDrawInstances(e,t,n,s){const{extensions:r,mode:a,object:o,info:l}=this;if(n===0)return;const c=r.get("WEBGL_multi_draw");if(c===null)for(let u=0;u<n;u++)this.renderInstances(e[u],t[u],s[u]);else{this.index!==0?c.multiDrawElementsInstancedWEBGL(a,t,0,this.type,e,0,s,0,n):c.multiDrawArraysInstancedWEBGL(a,e,0,t,0,s,0,n);let u=0;for(let h=0;h<n;h++)u+=t[h]*s[h];l.update(o,u,1)}}};class pK{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return t===void 0&&(Se(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class epe extends pK{constructor(e,t,n=2048){if(super(n),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){Se("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let s=0;s<this.maxQueries;s++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return oi(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;const n=this.queries[t];if(n)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(s){De("Error in beginQuery:",s),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(n){De("Error in endQuery:",n),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=new Map;for(const[r,a]of this.queryOffsets)if(this.queryStates.get(a)==="ended"){const l=this.queries[a];e.set(r,this.resolveQuery(l))}if(e.size===0)return this.lastValue;const t={},n=[];for(const[r,a]of e){const o=r.match(/^(.*):f(\d+)$/),l=parseInt(o[2]);n.includes(l)===!1&&n.push(l),t[l]===void 0&&(t[l]=0);const c=await a;this.timestamps.set(r,c),t[l]+=c}const s=t[n[n.length-1]];return this.lastValue=s,this.frames=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,s}catch(e){return De("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let n,s=!1;const r=()=>{n&&(clearTimeout(n),n=null)},a=l=>{s||(s=!0,r(),t(l))},o=()=>{if(this.isDisposed){a(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){a(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){n=setTimeout(o,1);return}const u=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(u)/1e6)}catch(l){De("Error checking query:",l),t(this.lastValue)}};o()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class R5 extends fK{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},s=t.context!==void 0?t.context:e.domElement.getContext("webgl2",n);function r(a){a.preventDefault();const o={api:"WebGL",message:a.statusMessage||"Unknown reason",reason:null,originalEvent:a};e.onDeviceLost(o)}this._onContextLost=r,e.domElement.addEventListener("webglcontextlost",r,!1),this.gl=s,this.extensions=new Jfe(this),this.capabilities=new Qfe(this),this.attributeUtils=new jfe(this),this.textureUtils=new Zfe(this),this.bufferRenderer=new $fe(this),this.state=new Yfe(this),this.utils=new Kfe(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this.drawBuffersIndexedExt=this.extensions.get("OES_draw_buffers_indexed")}get coordinateSystem(){return Cr}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,n=null){const s=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:s.RGBA8}),n!==null){const r=e.stencilBuffer?s.DEPTH24_STENCIL8:s.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:r}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&Se("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new epe(this.gl,e,2048));const n=this.timestampQueryPool[e];n.allocateQueriesForContext(t)!==null&&n.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,n=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:r,height:a}=this.getDrawingBufferSize();t.viewport(0,0,r,a)}if(e.scissor){const{x:r,y:a,width:o,height:l}=e.scissorValue;t.scissor(r,e.height-l-a,o,l)}this.initTimestampQuery(ga.RENDER,this.getTimestampUID(e)),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const s=e.occlusionQueryCount;s>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(s),n.occlusionQueryObjects=new Array(s),n.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,s=this.get(e),r=s.previousContext;n.resetVertexState();const a=e.occlusionQueryCount;a>0&&(a>s.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const o=e.textures;if(o!==null)for(let l=0;l<o.length;l++){const c=o[l];c.generateMipmaps&&this.generateMipmaps(c)}if(this._currentContext=r,this._resolveRenderTarget(e),r!==null)if(this._setFramebuffer(r),r.viewport)this.updateViewport(r);else{const{width:l,height:c}=this.getDrawingBufferSize();n.viewport(0,0,l,c)}this.prepareTimestampBuffer(ga.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:s}=t;if(n&&s){const r=new WeakSet,{gl:a}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const o=()=>{let l=0;for(let c=0;c<n.length;c++){const u=n[c];u!==null&&a.getQueryParameter(u,a.QUERY_RESULT_AVAILABLE)&&(a.getQueryParameter(u,a.QUERY_RESULT)===0&&r.add(s[c]),n[c]=null,a.deleteQuery(u),l++)}l<n.length?requestAnimationFrame(o):t.occluded=r};o()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:s,width:r,height:a}=e.viewportValue;t.viewport(n,e.height-a-s,r,a)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n,s=null,r=!0,a=!0){const{gl:o,renderer:l}=this;s===null&&(s={textures:null,clearColorValue:this.getClearColor()});let c=0;if(e&&(c|=o.COLOR_BUFFER_BIT),t&&(c|=o.DEPTH_BUFFER_BIT),n&&(c|=o.STENCIL_BUFFER_BIT),c!==0){let u;s.clearColorValue?u=s.clearColorValue:u=this.getClearColor();const h=l.getClearDepth(),f=l.getClearStencil();if(t&&this.state.setDepthMask(!0),s.textures===null)o.clearColor(u.r,u.g,u.b,u.a),o.clear(c);else{if(r&&this._setFramebuffer(s),e)for(let m=0;m<s.textures.length;m++)m===0?o.clearBufferfv(o.COLOR,m,[u.r,u.g,u.b,u.a]):o.clearBufferfv(o.COLOR,m,[0,0,0,1]);t&&n?o.clearBufferfi(o.DEPTH_STENCIL,0,h,f):t?o.clearBufferfv(o.DEPTH,0,[h]):n&&o.clearBufferiv(o.STENCIL,0,[f]),r&&a&&this._resolveRenderTarget(s)}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(ga.COMPUTE,this.getTimestampUID(e))}compute(e,t,n,s,r=null){const{state:a,gl:o}=this;this.discard===!1&&(a.enable(o.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:l,transformBuffers:c,attributes:u}=this.get(s),h=this._getVaoKey(u),f=this.vaoCache[h];f===void 0?this.vaoCache[h]=this._createVao(u):a.setVertexState(f),a.useProgram(l),this._bindUniforms(n);const m=this._getTransformFeedback(c);o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,m),o.beginTransformFeedback(o.POINTS),r=r!==null?r:t.count,Array.isArray(r)?(oi("WebGLBackend.compute(): The count parameter must be a single number, not an array."),r=r[0]):r&&typeof r=="object"&&r.isIndirectStorageBufferAttribute&&(oi("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),r=t.count),u[0].isStorageInstancedBufferAttribute?o.drawArraysInstanced(o.POINTS,0,1,r):o.drawArrays(o.POINTS,0,r),o.endTransformFeedback(),o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null);for(let g=0;g<c.length;g++){const x=c[g];x.pbo&&this.has(x.pbo)&&this.textureUtils.copyBufferToTexture(x.transformBuffer,x.pbo),x.switchBuffers()}}finishCompute(e){const{state:t,gl:n}=this;this.discard=!1,t.disable(n.RASTERIZER_DISCARD),this.prepareTimestampBuffer(ga.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:n,material:s,context:r,hardwareClippingPlanes:a}=e,{programGPU:o}=this.get(n),{gl:l,state:c}=this,u=this.get(r),h=e.getDrawParameters();if(h===null)return;this._bindUniforms(e.getBindings());const f=t.isMesh&&t.matrixWorld.determinant()<0;c.setMaterial(s,f,a),r.textures!==null&&r.textures.length>1&&c.setMRTBlending(r.textures),c.useProgram(o);const m=e.getAttributes(),g=this.get(m);let x=g.vaoGPU;if(x===void 0){const N=this._getVaoKey(m);x=this.vaoCache[N],x===void 0&&(x=this._createVao(m),this.vaoCache[N]=x,g.vaoGPU=x)}const v=e.getIndex(),y=v!==null?this.get(v).bufferGPU:null;c.setVertexState(x,y);const b=u.lastOcclusionObject;if(b!==t&&b!==void 0){if(b!==null&&b.occlusionTest===!0&&(l.endQuery(l.ANY_SAMPLES_PASSED),u.occlusionQueryIndex++),t.occlusionTest===!0){const N=l.createQuery();l.beginQuery(l.ANY_SAMPLES_PASSED,N),u.occlusionQueries[u.occlusionQueryIndex]=N,u.occlusionQueryObjects[u.occlusionQueryIndex]=t}u.lastOcclusionObject=t}const S=this.bufferRenderer;t.isPoints?S.mode=l.POINTS:t.isLineSegments?S.mode=l.LINES:t.isLine?S.mode=l.LINE_STRIP:t.isLineLoop?S.mode=l.LINE_LOOP:s.wireframe===!0?(c.setLineWidth(s.wireframeLinewidth*this.renderer.getPixelRatio()),S.mode=l.LINES):S.mode=l.TRIANGLES;const{vertexCount:T,instanceCount:M}=h;let{firstVertex:C}=h;if(S.object=t,v!==null){C*=v.array.BYTES_PER_ELEMENT;const N=this.get(v);S.index=v.count,S.type=N.type}else S.index=0;const w=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(oi("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),S.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?S.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):oi("WebGLBackend: WEBGL_multi_draw not supported."):M>1?S.renderInstances(C,T,M):S.render(C,T)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const N=this.get(e.camera),E=e.camera.cameras,B=e.getBindingGroup("cameraIndex").bindings[0];if(N.indexesGPU===void 0||N.indexesGPU.length!==E.length){const P=new Uint32Array([0,0,0,0]),X=[];for(let J=0,re=E.length;J<re;J++){const ne=l.createBuffer();P[0]=J,l.bindBuffer(l.UNIFORM_BUFFER,ne),l.bufferData(l.UNIFORM_BUFFER,P,l.STATIC_DRAW),X.push(ne)}N.indexesGPU=X}const U=this.get(B),H=this.renderer.getPixelRatio(),F=this._currentContext.renderTarget,V=this._isRenderCameraDepthArray(this._currentContext),Y=this._currentContext.activeCubeFace;if(V){const P=this.get(F.depthTexture);if(P.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){P.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:X}=F;for(let J=0,re=E.length;J<re;J++)this.renderer._activeCubeFace=J,this._currentContext.activeCubeFace=J,this._setFramebuffer(this._currentContext),this.clear(!1,!0,X,this._currentContext,!1,!1);this.renderer._activeCubeFace=Y,this._currentContext.activeCubeFace=Y}}for(let P=0,X=E.length;P<X;P++){const J=E[P];if(t.layers.test(J.layers)){V&&(this.renderer._activeCubeFace=P,this._currentContext.activeCubeFace=P,this._setFramebuffer(this._currentContext));const re=J.viewport;if(re!==void 0){const ne=re.x*H,ge=re.y*H,Te=re.width*H,Be=re.height*H;c.viewport(Math.floor(ne),Math.floor(e.context.height-Be-ge),Math.floor(Te),Math.floor(Be))}c.bindBufferBase(l.UNIFORM_BUFFER,U.index,N.indexesGPU[P]),w()}this._currentContext.activeCubeFace=Y,this.renderer._activeCubeFace=Y}}else w()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,n,s,r,a){return this.textureUtils.copyTextureToBuffer(e,t,n,s,r,a)}updateSampler(){return""}createNodeBuilder(e,t){return new Wfe(e,t)}createProgram(e){const t=this.gl,{stage:n,code:s}=e,r=n==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(r,s),t.compileShader(r),this.set(e,{shaderGPU:r})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,s=e.pipeline,{fragmentProgram:r,vertexProgram:a}=s,o=n.createProgram(),l=this.get(r).shaderGPU,c=this.get(a).shaderGPU;if(n.attachShader(o,l),n.attachShader(o,c),n.linkProgram(o),this.set(s,{programGPU:o,fragmentShader:l,vertexShader:c}),t!==null&&this.parallel){const u=new Promise(h=>{const f=this.parallel,m=()=>{n.getProgramParameter(o,f.COMPLETION_STATUS_KHR)?(this._completeCompile(e,s),h()):requestAnimationFrame(m)};m()});t.push(u);return}this._completeCompile(e,s)}_handleSource(e,t){const n=e.split(`
`),s=[],r=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let o=r;o<a;o++){const l=o+1;s.push(`${l===t?">":" "} ${l}: ${n[o]}`)}return s.join(`
`)}_getShaderErrors(e,t,n){const s=e.getShaderParameter(t,e.COMPILE_STATUS),a=(e.getShaderInfoLog(t)||"").trim();if(s&&a==="")return"";const o=/ERROR: 0:(\d+)/.exec(a);if(o){const l=parseInt(o[1]);return n.toUpperCase()+`

`+a+`

`+this._handleSource(e.getShaderSource(t),l)}else return a}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const s=this.gl,a=(s.getProgramInfoLog(e)||"").trim();if(s.getProgramParameter(e,s.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(s,e,n,t);else{const o=this._getShaderErrors(s,n,"vertex"),l=this._getShaderErrors(s,t,"fragment");De("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(e,s.VALIDATE_STATUS)+`

Program Info Log: `+a+`
`+o+`
`+l)}else a!==""&&Se("WebGLProgram: Program Info Log:",a)}}_completeCompile(e,t){const{state:n,gl:s}=this,r=this.get(t),{programGPU:a,fragmentShader:o,vertexShader:l}=r;s.getProgramParameter(a,s.LINK_STATUS)===!1&&this._logProgramError(a,o,l),n.useProgram(a);const c=e.getBindings();this._setupBindings(c,a),this.set(t,{programGPU:a})}createComputePipeline(e,t){const{state:n,gl:s}=this,r={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(r);const{computeProgram:a}=e,o=s.createProgram(),l=this.get(r).shaderGPU,c=this.get(a).shaderGPU,u=a.transforms,h=[],f=[];for(let v=0;v<u.length;v++){const y=u[v];h.push(y.varyingName),f.push(y.attributeNode)}s.attachShader(o,l),s.attachShader(o,c),s.transformFeedbackVaryings(o,h,s.SEPARATE_ATTRIBS),s.linkProgram(o),s.getProgramParameter(o,s.LINK_STATUS)===!1&&this._logProgramError(o,l,c),n.useProgram(o),this._setupBindings(t,o);const m=a.attributes,g=[],x=[];for(let v=0;v<m.length;v++){const y=m[v].node.attribute;g.push(y),this.has(y)||this.attributeUtils.createAttribute(y,s.ARRAY_BUFFER)}for(let v=0;v<f.length;v++){const y=f[v].attribute;this.has(y)||this.attributeUtils.createAttribute(y,s.ARRAY_BUFFER);const b=this.get(y);x.push(b)}this.set(e,{programGPU:o,transformBuffers:x,attributes:g})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let n=0,s=0;for(const r of t){this.set(r,{textures:s,uniformBuffers:n});for(const a of r.bindings)a.isUniformBuffer&&n++,a.isSampledTexture&&s++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let s=n.uniformBuffers,r=n.textures;for(const a of e.bindings){const o=this.get(a);if(a.isUniformsGroup||a.isUniformBuffer){const l=a.buffer;let{bufferGPU:c}=this.get(l);c===void 0?(c=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,c),t.bufferData(t.UNIFORM_BUFFER,l.byteLength,t.DYNAMIC_DRAW),this.set(l,{bufferGPU:c})):t.bindBuffer(t.UNIFORM_BUFFER,c);const u=a.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,c),u.length===0)t.bufferData(t.UNIFORM_BUFFER,l,t.DYNAMIC_DRAW);else{const h=Xy(l),f=h?1:l.BYTES_PER_ELEMENT;for(let m=0,g=u.length;m<g;m++){const x=u[m],v=x.start*f,y=x.count*f,b=v*(h?l.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,b,l,v,y)}}o.index=s++,o.bufferGPU=c,this.set(a,o)}else if(a.isSampledTexture){const{textureGPU:l,glTextureType:c}=this.get(a.texture);o.index=r++,o.textureGPU=l,o.glTextureType=c,this.set(a,o)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const s=this.get(e).bufferGPU,r=e.buffer,a=e.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,s),a.length===0)t.bufferData(t.UNIFORM_BUFFER,r,t.DYNAMIC_DRAW);else{const o=Xy(r),l=o?1:r.BYTES_PER_ELEMENT;for(let c=0,u=a.length;c<u;c++){const h=a[c],f=h.start*l,m=h.count*l,g=f*(o?r.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,g,r,f,m)}}}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(w5).filter(s=>w5[s]===e),n=this.extensions;for(let s=0;s<t.length;s++)if(n.has(t[s]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,n=null,s=null,r=0,a=0){this.textureUtils.copyTextureToTexture(e,t,n,s,r,a)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){const{gl:t,state:n}=this;let s=null;if(e.textures!==null){const r=e.renderTarget,a=this.get(r),{samples:o,depthBuffer:l,stencilBuffer:c}=r,u=r.isWebGLCubeRenderTarget===!0,h=r.isRenderTarget3D===!0,f=r.depth>1,m=r.isXRRenderTarget===!0,g=m===!0&&r._hasExternalTextures===!0;let x=a.msaaFrameBuffer,v=a.depthRenderbuffer;const y=this.extensions.get("WEBGL_multisampled_render_to_texture"),b=this.extensions.get("OVR_multiview2"),S=this._useMultisampledExtension(r),T=Nj(e);let M;if(u?(a.cubeFramebuffers||(a.cubeFramebuffers={}),M=a.cubeFramebuffers[T]):m&&g===!1?M=this._xrFramebuffer:(a.framebuffers||(a.framebuffers={}),M=a.framebuffers[T]),M===void 0){M=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,M);const C=e.textures,w=[];if(u){a.cubeFramebuffers[T]=M;const{textureGPU:E}=this.get(C[0]),B=this.renderer._activeCubeFace,U=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+B,E,U)}else{a.framebuffers[T]=M;for(let E=0;E<C.length;E++){const B=C[E],U=this.get(B);U.renderTarget=e.renderTarget,U.cacheKey=T;const H=t.COLOR_ATTACHMENT0+E;if(r.multiview)b.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,H,U.textureGPU,0,o,0,2);else if(h||f){const F=this.renderer._activeCubeFace,V=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,H,U.textureGPU,V,F)}else if(S)y.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,H,t.TEXTURE_2D,U.textureGPU,0,o);else{const F=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,H,t.TEXTURE_2D,U.textureGPU,F)}}}const N=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(r._autoAllocateDepthBuffer===!0){const E=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(E,e,0,S),a.xrDepthRenderbuffer=E,w.push(c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,E),t.framebufferRenderbuffer(t.FRAMEBUFFER,N,t.RENDERBUFFER,E)}else if(e.depthTexture!==null){w.push(c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const E=this.get(e.depthTexture);if(E.renderTarget=e.renderTarget,E.cacheKey=T,r.multiview)b.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,N,E.textureGPU,0,o,0,2);else if(g&&S)y.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,N,t.TEXTURE_2D,E.textureGPU,0,o);else if(e.depthTexture.isArrayTexture){const B=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,N,E.textureGPU,0,B)}else if(e.depthTexture.isCubeTexture){const B=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,N,t.TEXTURE_CUBE_MAP_POSITIVE_X+B,E.textureGPU,0)}else t.framebufferTexture2D(t.FRAMEBUFFER,N,t.TEXTURE_2D,E.textureGPU,0)}a.depthInvalidationArray=w}else{if(this._isRenderCameraDepthArray(e)){n.bindFramebuffer(t.FRAMEBUFFER,M);const w=this.renderer._activeCubeFace,N=this.get(e.depthTexture),E=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,E,N.textureGPU,0,w)}if((m||S||r.multiview)&&r._isOpaqueFramebuffer!==!0){n.bindFramebuffer(t.FRAMEBUFFER,M);const w=this.get(e.textures[0]);r.multiview?b.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,w.textureGPU,0,o,0,2):S?y.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,w.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,w.textureGPU,0);const N=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(r._autoAllocateDepthBuffer===!0){const E=a.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,E),t.framebufferRenderbuffer(t.FRAMEBUFFER,N,t.RENDERBUFFER,E)}else{const E=this.get(e.depthTexture);r.multiview?b.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,N,E.textureGPU,0,o,0,2):S?y.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,N,t.TEXTURE_2D,E.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,N,t.TEXTURE_2D,E.textureGPU,0)}}}if(o>0&&S===!1&&!r.multiview){if(x===void 0){const C=[];x=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,x);const w=[],N=e.textures;for(let E=0;E<N.length;E++){w[E]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,w[E]),C.push(t.COLOR_ATTACHMENT0+E);const B=e.textures[E],U=this.get(B);t.renderbufferStorageMultisample(t.RENDERBUFFER,o,U.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+E,t.RENDERBUFFER,w[E])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),a.msaaFrameBuffer=x,a.msaaRenderbuffers=w,l&&v===void 0){v=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(v,e,o),a.depthRenderbuffer=v;const E=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;C.push(E)}a.invalidationArray=C}s=a.msaaFrameBuffer}else s=M;n.drawBuffers(e,M)}n.bindFramebuffer(t.FRAMEBUFFER,s)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){const s=this.get(e[n]);t+=":"+s.id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();t.bindVertexArray(n);for(let s=0;s<e.length;s++){const r=e[s],a=this.get(r);t.bindBuffer(t.ARRAY_BUFFER,a.bufferGPU),t.enableVertexAttribArray(s);let o,l;r.isInterleavedBufferAttribute===!0?(o=r.data.stride*a.bytesPerElement,l=r.offset*a.bytesPerElement):(o=0,l=0),a.isInteger?t.vertexAttribIPointer(s,r.itemSize,a.type,o,l):t.vertexAttribPointer(s,r.itemSize,a.type,r.normalized,o,l),r.isInstancedBufferAttribute&&!r.isInterleavedBufferAttribute?t.vertexAttribDivisor(s,r.meshPerAttribute):r.isInterleavedBufferAttribute&&r.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(s,r.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),n}_getTransformFeedback(e){let t="";for(let r=0;r<e.length;r++)t+=":"+e[r].id;let n=this.transformFeedbackCache[t];if(n!==void 0)return n;const{gl:s}=this;n=s.createTransformFeedback(),s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,n);for(let r=0;r<e.length;r++){const a=e[r];s.bindBufferBase(s.TRANSFORM_FEEDBACK_BUFFER,r,a.transformBuffer)}return s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const s of e)for(const r of s.bindings){const o=this.get(r).index;if(r.isUniformsGroup||r.isUniformBuffer){const l=n.getUniformBlockIndex(t,r.name);n.uniformBlockBinding(t,l,o)}else if(r.isSampledTexture){const l=n.getUniformLocation(t,r.name);n.uniform1i(l,o)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const s of e)for(const r of s.bindings){const a=this.get(r),o=a.index;r.isUniformsGroup||r.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,o,a.bufferGPU):r.isSampledTexture&&n.bindTexture(a.glTextureType,a.textureGPU,t.TEXTURE0+o)}}_resolveRenderTarget(e){const{gl:t,state:n}=this,s=e.renderTarget;if(e.textures!==null&&s){const r=this.get(s);if(s.samples>0&&this._useMultisampledExtension(s)===!1){const a=r.framebuffers[e.getCacheKey()];let o=t.COLOR_BUFFER_BIT;s.resolveDepthBuffer&&(s.depthBuffer&&(o|=t.DEPTH_BUFFER_BIT),s.stencilBuffer&&s.resolveStencilBuffer&&(o|=t.STENCIL_BUFFER_BIT));const l=r.msaaFrameBuffer,c=r.msaaRenderbuffers,u=e.textures,h=u.length>1;if(n.bindFramebuffer(t.READ_FRAMEBUFFER,l),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,a),h)for(let f=0;f<u.length;f++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+f,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+f,t.TEXTURE_2D,null,0);for(let f=0;f<u.length;f++){if(h){const{textureGPU:m}=this.get(u[f]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,c[f]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,m,0)}if(e.scissor){const{x:m,y:g,width:x,height:v}=e.scissorValue,y=e.height-v-g;t.blitFramebuffer(m,y,m+x,y+v,m,y,m+x,y+v,o,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,o,t.NEAREST)}if(h)for(let f=0;f<u.length;f++){const{textureGPU:m}=this.get(u[f]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+f,t.RENDERBUFFER,c[f]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+f,t.TEXTURE_2D,m,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,r.invalidationArray)}else if(s.resolveDepthBuffer===!1&&r.framebuffers){const a=r.framebuffers[e.getCacheKey()];n.bindFramebuffer(t.DRAW_FRAMEBUFFER,a),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,r.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const ry={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},dm=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},Gr={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},Na={Store:"store"},fi={Load:"load",Clear:"clear"},N5={CCW:"ccw",CW:"cw"},B5={None:"none",Back:"back"},$y={Uint16:"uint16",Uint32:"uint32"},ae={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},I2={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},sm={Linear:"linear",Nearest:"nearest"},Vn={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Xp={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},D5={None:0,All:15},gd={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},P2={Storage:"storage",ReadOnlyStorage:"read-only-storage"},O2={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},L5={NonFiltering:"non-filtering",Comparison:"comparison"},qp={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},U5={TwoD:"2d",ThreeD:"3d"},Ys={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},tpe={All:"all"},pA={Vertex:"vertex",Instance:"instance"},i3={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},I5={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class npe extends hK{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class ipe extends oK{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let spe=0;class rpe extends ipe{constructor(e,t){super("StorageBuffer_"+spe++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:wr.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class ape extends sp{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,n=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,s=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:sm.Linear}),this.flipYSampler=e.createSampler({minFilter:sm.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:n}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:s})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:ry.TriangleStrip,stripIndexFormat:$y.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:ry.TriangleStrip,stripIndexFormat:$y.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,n=0){const s=t.format,{width:r,height:a}=t.size,o=this.getTransferPipeline(s),l=this.getFlipYPipeline(s),c=this.device.createTexture({size:{width:r,height:a,depthOrArrayLayers:1},format:s,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),u=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Ys.TwoD,baseArrayLayer:n}),h=c.createView({baseMipLevel:0,mipLevelCount:1,dimension:Ys.TwoD,baseArrayLayer:0}),f=this.device.createCommandEncoder({}),m=(g,x,v)=>{const y=g.getBindGroupLayout(0),b=this.device.createBindGroup({layout:y,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:x}]}),S=f.beginRenderPass({colorAttachments:[{view:v,loadOp:fi.Clear,storeOp:Na.Store,clearValue:[0,0,0,0]}]});S.setPipeline(g),S.setBindGroup(0,b),S.draw(4,1,0,0),S.end()};m(o,u,h),m(l,h,u),this.device.queue.submit([f.finish()]),c.destroy()}generateMipmaps(e,t,n=0,s=null){const r=this.get(e);r.layers===void 0&&(r.layers=[]);const a=r.layers[n]||this._mipmapCreateBundles(e,t,n),o=s||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(o,a),s===null&&this.device.queue.submit([o.finish()]),r.layers[n]=a}_mipmapCreateBundles(e,t,n){const s=this.getTransferPipeline(t.format),r=s.getBindGroupLayout(0);let a=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Ys.TwoD,baseArrayLayer:n});const o=[];for(let l=1;l<t.mipLevelCount;l++){const c=this.device.createBindGroup({layout:r,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:a}]}),u=e.createView({baseMipLevel:l,mipLevelCount:1,dimension:Ys.TwoD,baseArrayLayer:n}),h={colorAttachments:[{view:u,loadOp:fi.Clear,storeOp:Na.Store,clearValue:[0,0,0,0]}]},f=this.device.createRenderBundleEncoder({colorFormats:[t.format]});f.setPipeline(s),f.setBindGroup(0,c),f.draw(4,1,0,0),o.push({renderBundles:[f.finish()],passDescriptor:h}),a=u}return o}_mipmapRunBundles(e,t){const n=t.length;for(let s=0;s<n;s++){const r=t[s],a=e.beginRenderPass(r.passDescriptor);a.executeBundles(r.renderBundles),a.end()}}}const ope={[bS]:"never",[yg]:"less",[SS]:"equal",[xg]:"less-equal",[TS]:"greater",[_g]:"greater-equal",[MS]:"always",[AS]:"not-equal"},lpe=[0,1,3,2,4,5];class cpe{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){const t=this.backend,n=e.minFilter+"-"+e.magFilter+"-"+e.wrapS+"-"+e.wrapT+"-"+(e.wrapR||"0")+"-"+e.anisotropy+"-"+(e.compareFunction||0);let s=this._samplerCache.get(n);if(s===void 0){const a={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};a.magFilter===sm.Linear&&a.minFilter===sm.Linear&&a.mipmapFilter===sm.Linear&&(a.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(a.compare=ope[e.compareFunction]),s={sampler:t.device.createSampler(a),usedTimes:0},this._samplerCache.set(n,s)}const r=t.get(e);if(r.sampler!==s.sampler){if(r.sampler!==void 0){const a=this._samplerCache.get(r.samplerKey);a.usedTimes--,a.usedTimes===0&&this._samplerCache.delete(r.samplerKey)}r.samplerKey=n,r.sampler=s.sampler,s.usedTimes++}return n}createDefaultTexture(e){let t;const n=s3(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(n):t=this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e,t={}){const n=this.backend,s=n.get(e);if(s.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture){s.texture=e.sourceTexture,s.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:r,height:a,depth:o,levels:l}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const c=this._getDimension(e),u=e.internalFormat||t.format||s3(e,n.device);s.format=u;const{samples:h,primarySamples:f,isMSAA:m}=n.utils.getTextureSampleData(e);let g=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(g|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&u!==ae.RGB9E5UFloat&&(g|=GPUTextureUsage.RENDER_ATTACHMENT);const x={label:e.name,size:{width:r,height:a,depthOrArrayLayers:o},mipLevelCount:l,sampleCount:f,dimension:c,format:u,usage:g};if(u===void 0){Se("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}if(e.isCubeTexture&&(x.textureBindingViewDimension=Ys.Cube),s.texture=n.device.createTexture(x),m){const v=Object.assign({},x);v.label=v.label+"-msaa",v.sampleCount=h,v.mipLevelCount=1,s.msaaTexture=n.device.createTexture(v)}s.initialized=!0,s.textureDescriptorGPU=x}destroyTexture(e,t=!1){const n=this.backend,s=n.get(e);s.texture!==void 0&&t===!1&&s.texture.destroy(),s.msaaTexture!==void 0&&s.msaaTexture.destroy(),n.delete(e)}generateMipmaps(e,t=null){const n=this.backend.get(e);if(e.isCubeTexture)for(let s=0;s<6;s++)this._generateMipmaps(n.texture,n.textureDescriptorGPU,s,t);else{const s=e.image.depth||1;for(let r=0;r<s;r++)this._generateMipmaps(n.texture,n.textureDescriptorGPU,r,t)}}getColorBuffer(){const e=this.backend,t=e.renderer.getCanvasTarget(),{width:n,height:s}=e.getDrawingBufferSize(),r=e.renderer.currentSamples,a=t.colorTexture,o=e.get(a);if(a.width===n&&a.height===s&&a.samples===r)return o.texture;let l=o.texture;return l&&l.destroy(),l=e.device.createTexture({label:"colorBuffer",size:{width:n,height:s,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),a.source.width=n,a.source.height=s,a.samples=r,o.texture=l,l}getDepthBuffer(e=!0,t=!1){const n=this.backend,s=n.renderer.getCanvasTarget(),{width:r,height:a}=n.getDrawingBufferSize(),o=n.renderer.currentSamples,l=s.depthTexture;if(l.width===r&&l.height===a&&l.samples===o&&l.depth===e&&l.stencil===t)return n.get(l).texture;const c=n.get(l).texture;let u,h;if(t?(u=kr,h=ja):e&&(u=lr,h=Jn),c!==void 0){if(l.image.width===r&&l.image.height===a&&l.format===u&&l.type===h&&l.samples===o)return c;this.destroyTexture(l)}return l.name="depthBuffer",l.format=u,l.type=h,l.image.width=r,l.image.height=a,l.samples=o,this.createTexture(l,{width:r,height:a}),n.get(l).texture}updateTexture(e,t){const n=this.backend.get(e),s=e.mipmaps,{textureDescriptorGPU:r}=n;if(!(e.isRenderTargetTexture||r===void 0)){if(e.isDataTexture)if(s.length>0)for(let a=0,o=s.length;a<o;a++){const l=s[a];this._copyBufferToTexture(l,n.texture,r,0,e.flipY,0,a)}else this._copyBufferToTexture(t.image,n.texture,r,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let a=0;a<t.image.depth;a++)this._copyBufferToTexture(t.image,n.texture,r,a,e.flipY,a);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,r);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,n.texture,r);else if(s.length>0)for(let a=0,o=s.length;a<o;a++){const l=s[a];this._copyImageToTexture(l,n.texture,r,0,e.flipY,e.premultiplyAlpha,a)}else this._copyImageToTexture(t.image,n.texture,r,0,e.flipY,e.premultiplyAlpha);n.version=e.version}}async copyTextureToBuffer(e,t,n,s,r,a){const o=this.backend.device,l=this.backend.get(e),c=l.texture,u=l.textureDescriptorGPU.format,h=this._getBytesPerTexel(u);let f=s*h;f=Math.ceil(f/256)*256;const m=o.createBuffer({size:(r-1)*f+s*h,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),g=o.createCommandEncoder();g.copyTextureToBuffer({texture:c,origin:{x:t,y:n,z:a}},{buffer:m,bytesPerRow:f},{width:s,height:r});const x=this._getTypedArrayType(u);o.queue.submit([g.finish()]),await m.mapAsync(GPUMapMode.READ);const v=m.getMappedRange();return new x(v)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new In;n.minFilter=$n,n.magFilter=$n,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultCubeTexture[e];if(t===void 0){const n=new Gh;n.minFilter=$n,n.magFilter=$n,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,n){const s=e.images,r=e.mipmaps;for(let a=0;a<6;a++){const o=s[a],l=e.flipY===!0?lpe[a]:a;o.isDataTexture?this._copyBufferToTexture(o.image,t,n,l,e.flipY):this._copyImageToTexture(o,t,n,l,e.flipY,e.premultiplyAlpha);for(let c=0;c<r.length;c++){const h=r[c].images[a];h.isDataTexture?this._copyBufferToTexture(h.image,t,n,l,e.flipY,0,c+1):this._copyImageToTexture(h,t,n,l,e.flipY,e.premultiplyAlpha,c+1)}}}_copyImageToTexture(e,t,n,s,r,a,o=0){const l=this.backend.device,c=o>0?e.width:n.size.width,u=o>0?e.height:n.size.height;try{l.queue.copyExternalImageToTexture({source:e,flipY:r},{texture:t,mipLevel:o,origin:{x:0,y:0,z:s},premultipliedAlpha:a},{width:c,height:u,depthOrArrayLayers:1})}catch{}}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new ape(this.backend.device)),e}_generateMipmaps(e,t,n=0,s=null){this._getPassUtils().generateMipmaps(e,t,n,s)}_flipY(e,t,n=0){this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,s,r,a=0,o=0){const l=this.backend.device,c=e.data,u=this._getBytesPerTexel(n.format),h=e.width*u;l.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:s}},c,{offset:e.width*e.height*u*a,bytesPerRow:h},{width:e.width,height:e.height,depthOrArrayLayers:1}),r===!0&&this._flipY(t,n,s)}_copyCompressedBufferToTexture(e,t,n){const s=this.backend.device,r=this._getBlockData(n.format),a=n.size.depthOrArrayLayers>1;for(let o=0;o<e.length;o++){const l=e[o],c=l.width,u=l.height,h=a?n.size.depthOrArrayLayers:1,f=Math.ceil(c/r.width)*r.byteLength,m=f*Math.ceil(u/r.height);for(let g=0;g<h;g++)s.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:g}},l.data,{offset:g*m,bytesPerRow:f,rowsPerImage:Math.ceil(u/r.height)},{width:Math.ceil(c/r.width)*r.width,height:Math.ceil(u/r.height)*r.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===ae.BC1RGBAUnorm||e===ae.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===ae.BC2RGBAUnorm||e===ae.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ae.BC3RGBAUnorm||e===ae.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ae.BC4RUnorm||e===ae.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===ae.BC5RGUnorm||e===ae.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===ae.BC6HRGBUFloat||e===ae.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===ae.BC7RGBAUnorm||e===ae.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ae.ETC2RGB8Unorm||e===ae.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ae.ETC2RGB8A1Unorm||e===ae.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ae.ETC2RGBA8Unorm||e===ae.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ae.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===ae.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===ae.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===ae.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===ae.ASTC4x4Unorm||e===ae.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ae.ASTC5x4Unorm||e===ae.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===ae.ASTC5x5Unorm||e===ae.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===ae.ASTC6x5Unorm||e===ae.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===ae.ASTC6x6Unorm||e===ae.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===ae.ASTC8x5Unorm||e===ae.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===ae.ASTC8x6Unorm||e===ae.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===ae.ASTC8x8Unorm||e===ae.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===ae.ASTC10x5Unorm||e===ae.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===ae.ASTC10x6Unorm||e===ae.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===ae.ASTC10x8Unorm||e===ae.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===ae.ASTC10x10Unorm||e===ae.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===ae.ASTC12x10Unorm||e===ae.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===ae.ASTC12x12Unorm||e===ae.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=I2.ClampToEdge;return e===Zr?t=I2.Repeat:e===vc&&(t=I2.MirrorRepeat),t}_convertFilterMode(e){let t=sm.Linear;return(e===$n||e===mg||e===Ho)&&(t=sm.Nearest),t}_getBytesPerTexel(e){if(e===ae.R8Unorm||e===ae.R8Snorm||e===ae.R8Uint||e===ae.R8Sint)return 1;if(e===ae.R16Uint||e===ae.R16Sint||e===ae.R16Float||e===ae.RG8Unorm||e===ae.RG8Snorm||e===ae.RG8Uint||e===ae.RG8Sint)return 2;if(e===ae.R32Uint||e===ae.R32Sint||e===ae.R32Float||e===ae.RG16Uint||e===ae.RG16Sint||e===ae.RG16Float||e===ae.RGBA8Unorm||e===ae.RGBA8UnormSRGB||e===ae.RGBA8Snorm||e===ae.RGBA8Uint||e===ae.RGBA8Sint||e===ae.BGRA8Unorm||e===ae.BGRA8UnormSRGB||e===ae.RGB9E5UFloat||e===ae.RGB10A2Unorm||e===ae.RG11B10UFloat||e===ae.Depth32Float||e===ae.Depth24Plus||e===ae.Depth24PlusStencil8||e===ae.Depth32FloatStencil8)return 4;if(e===ae.RG32Uint||e===ae.RG32Sint||e===ae.RG32Float||e===ae.RGBA16Uint||e===ae.RGBA16Sint||e===ae.RGBA16Float)return 8;if(e===ae.RGBA32Uint||e===ae.RGBA32Sint||e===ae.RGBA32Float)return 16}_getTypedArrayType(e){if(e===ae.R8Uint)return Uint8Array;if(e===ae.R8Sint)return Int8Array;if(e===ae.R8Unorm)return Uint8Array;if(e===ae.R8Snorm)return Int8Array;if(e===ae.RG8Uint)return Uint8Array;if(e===ae.RG8Sint)return Int8Array;if(e===ae.RG8Unorm)return Uint8Array;if(e===ae.RG8Snorm)return Int8Array;if(e===ae.RGBA8Uint)return Uint8Array;if(e===ae.RGBA8Sint)return Int8Array;if(e===ae.RGBA8Unorm||e===ae.RGBA8UnormSRGB)return Uint8Array;if(e===ae.RGBA8Snorm)return Int8Array;if(e===ae.R16Uint)return Uint16Array;if(e===ae.R16Sint)return Int16Array;if(e===ae.RG16Uint)return Uint16Array;if(e===ae.RG16Sint)return Int16Array;if(e===ae.RGBA16Uint)return Uint16Array;if(e===ae.RGBA16Sint)return Int16Array;if(e===ae.R16Float||e===ae.RG16Float||e===ae.RGBA16Float)return Uint16Array;if(e===ae.R32Uint)return Uint32Array;if(e===ae.R32Sint)return Int32Array;if(e===ae.R32Float)return Float32Array;if(e===ae.RG32Uint)return Uint32Array;if(e===ae.RG32Sint)return Int32Array;if(e===ae.RG32Float)return Float32Array;if(e===ae.RGBA32Uint)return Uint32Array;if(e===ae.RGBA32Sint)return Int32Array;if(e===ae.RGBA32Float)return Float32Array;if(e===ae.BGRA8Unorm||e===ae.BGRA8UnormSRGB)return Uint8Array;if(e===ae.RGB10A2Unorm||e===ae.RGB9E5UFloat||e===ae.RG11B10UFloat)return Uint32Array;if(e===ae.Depth32Float)return Float32Array;if(e===ae.Depth24Plus||e===ae.Depth24PlusStencil8)return Uint32Array;if(e===ae.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=U5.ThreeD:t=U5.TwoD,t}}function s3(i,e=null){const t=i.format,n=i.type,s=i.colorSpace,r=en.getTransfer(s);let a;if(i.isCompressedTexture===!0||i.isCompressedArrayTexture===!0)switch(t){case tu:case nu:a=r===Ft?ae.BC1RGBAUnormSRGB:ae.BC1RGBAUnorm;break;case iu:a=r===Ft?ae.BC2RGBAUnormSRGB:ae.BC2RGBAUnorm;break;case su:a=r===Ft?ae.BC3RGBAUnormSRGB:ae.BC3RGBAUnorm;break;case Uf:a=ae.BC4RUnorm;break;case If:a=ae.BC4RSnorm;break;case Nh:a=ae.BC5RGUnorm;break;case Pf:a=ae.BC5RGSnorm;break;case Lf:a=r===Ft?ae.BC7RGBAUnormSRGB:ae.BC7RGBAUnorm;break;case pf:case ff:a=r===Ft?ae.ETC2RGB8UnormSRGB:ae.ETC2RGB8Unorm;break;case mf:a=r===Ft?ae.ETC2RGBA8UnormSRGB:ae.ETC2RGBA8Unorm;break;case gf:a=ae.EACR11Unorm;break;case yf:a=ae.EACR11Snorm;break;case Rh:a=ae.EACRG11Unorm;break;case xf:a=ae.EACRG11Snorm;break;case _f:a=r===Ft?ae.ASTC4x4UnormSRGB:ae.ASTC4x4Unorm;break;case vf:a=r===Ft?ae.ASTC5x4UnormSRGB:ae.ASTC5x4Unorm;break;case bf:a=r===Ft?ae.ASTC5x5UnormSRGB:ae.ASTC5x5Unorm;break;case Sf:a=r===Ft?ae.ASTC6x5UnormSRGB:ae.ASTC6x5Unorm;break;case Tf:a=r===Ft?ae.ASTC6x6UnormSRGB:ae.ASTC6x6Unorm;break;case Af:a=r===Ft?ae.ASTC8x5UnormSRGB:ae.ASTC8x5Unorm;break;case Mf:a=r===Ft?ae.ASTC8x6UnormSRGB:ae.ASTC8x6Unorm;break;case Ef:a=r===Ft?ae.ASTC8x8UnormSRGB:ae.ASTC8x8Unorm;break;case Cf:a=r===Ft?ae.ASTC10x5UnormSRGB:ae.ASTC10x5Unorm;break;case wf:a=r===Ft?ae.ASTC10x6UnormSRGB:ae.ASTC10x6Unorm;break;case Rf:a=r===Ft?ae.ASTC10x8UnormSRGB:ae.ASTC10x8Unorm;break;case Nf:a=r===Ft?ae.ASTC10x10UnormSRGB:ae.ASTC10x10Unorm;break;case Bf:a=r===Ft?ae.ASTC12x10UnormSRGB:ae.ASTC12x10Unorm;break;case Df:a=r===Ft?ae.ASTC12x12UnormSRGB:ae.ASTC12x12Unorm;break;case ii:a=r===Ft?ae.RGBA8UnormSRGB:ae.RGBA8Unorm;break;default:De("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case ii:switch(n){case $c:a=ae.RGBA8Snorm;break;case eu:a=ae.RGBA16Sint;break;case ko:a=ae.RGBA16Uint;break;case Jn:a=ae.RGBA32Uint;break;case Is:a=ae.RGBA32Sint;break;case ei:a=r===Ft?ae.RGBA8UnormSRGB:ae.RGBA8Unorm;break;case ln:a=ae.RGBA16Float;break;case Rn:a=ae.RGBA32Float;break;default:De("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case gg:switch(n){case Ax:a=ae.RGB9E5UFloat;break;case Mx:a=ae.RG11B10UFloat;break;default:De("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case ql:switch(n){case $c:a=ae.R8Snorm;break;case eu:a=ae.R16Sint;break;case ko:a=ae.R16Uint;break;case Jn:a=ae.R32Uint;break;case Is:a=ae.R32Sint;break;case ei:a=ae.R8Unorm;break;case ln:a=ae.R16Float;break;case Rn:a=ae.R32Float;break;default:De("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case Wr:switch(n){case $c:a=ae.RG8Snorm;break;case eu:a=ae.RG16Sint;break;case ko:a=ae.RG16Uint;break;case Jn:a=ae.RG32Uint;break;case Is:a=ae.RG32Sint;break;case ei:a=ae.RG8Unorm;break;case ln:a=ae.RG16Float;break;case Rn:a=ae.RG32Float;break;default:De("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case lr:switch(n){case ko:a=ae.Depth16Unorm;break;case Jn:a=ae.Depth24Plus;break;case Rn:a=ae.Depth32Float;break;default:De("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case kr:switch(n){case ja:a=ae.Depth24PlusStencil8;break;case Rn:e&&e.features.has(i3.Depth32FloatStencil8)===!1&&De('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),a=ae.Depth32FloatStencil8;break;default:De("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case Oh:switch(n){case Is:a=ae.R32Sint;break;case Jn:a=ae.R32Uint;break;default:De("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case Yf:switch(n){case Is:a=ae.RG32Sint;break;case Jn:a=ae.RG32Uint;break;default:De("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case Kf:switch(n){case Is:a=ae.RGBA32Sint;break;case Jn:a=ae.RGBA32Uint;break;default:De("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:De("WebGPURenderer: Unsupported texture format.",t)}return a}const upe=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,hpe=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,P5={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},dpe=i=>{i=i.trim();const e=i.match(upe);if(e!==null&&e.length===4){const t=e[2],n=[];let s=null;for(;(s=hpe.exec(t))!==null;)n.push({name:s[1],type:s[2]});const r=[];for(let u=0;u<n.length;u++){const{name:h,type:f}=n[u];let m=f;m.startsWith("ptr")?m="pointer":(m.startsWith("texture")&&(m=f.split("<")[0]),m=P5[m]),r.push(new hw(m,h))}const a=i.substring(e[0].length),o=e[3]||"void",l=e[1]!==void 0?e[1]:"";return{type:P5[o]||o,inputs:r,name:l,inputsCode:t,blockCode:a,outputType:o}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class fpe extends YP{constructor(e){const{type:t,inputs:n,name:s,inputsCode:r,blockCode:a,outputType:o}=dpe(e);super(t,n,s),this.inputsCode=r,this.blockCode=a,this.outputType=o}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class ppe extends nK{parseFunction(e){return new fpe(e)}}const mpe={[wr.READ_ONLY]:"read",[wr.WRITE_ONLY]:"write",[wr.READ_WRITE]:"read_write"},O5={[Zr]:"repeat",[ui]:"clamp",[vc]:"mirror"},mA={vertex:dm.VERTEX,fragment:dm.FRAGMENT,compute:dm.COMPUTE},F5={instance:!0,swizzleAssign:!1,storageBuffer:!0},gpe={"^^":"tsl_xor"},ype={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},G5={},J_={tsl_xor:new rr("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new rr("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new rr("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new rr("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new rr("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new rr("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new rr("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new rr("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new rr("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new rr("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new rr("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new rr("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new rr(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},xpe={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>",floatpack_snorm_2x16:"pack2x16snorm",floatpack_unorm_2x16:"pack2x16unorm",floatpack_float16_2x16:"pack2x16float",floatunpack_snorm_2x16:"unpack2x16snorm",floatunpack_unorm_2x16:"unpack2x16unorm",floatunpack_float16_2x16:"unpack2x16float"};let mK="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(mK+=`diagnostic( off, derivative_uniformity );
`);class _pe extends jP{constructor(e,t){super(e,t,new ppe),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,n,s,r,a=this.shaderStage){return a==="fragment"?s?r?`textureSample( ${t}, ${t}_sampler, ${n}, ${s}, ${r} )`:`textureSample( ${t}, ${t}_sampler, ${n}, ${s} )`:r?`textureSample( ${t}, ${t}_sampler, ${n}, ${r} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this.generateTextureSampleLevel(e,t,n,"0",s)}generateTextureSampleLevel(e,t,n,s,r,a){return this.isUnfilterable(e)===!1?a?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${s}, ${a} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${s} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,a,s):this.generateTextureLod(e,t,n,r,a,s)}generateWrapFunction(e){const t=`tsl_coord_${O5[e.wrapS]}S_${O5[e.wrapT]}_${e.is3DTexture||e.isData3DTexture?"3d":"2d"}T`;let n=G5[t];if(n===void 0){const s=[],r=e.is3DTexture||e.isData3DTexture?"vec3f":"vec2f";let a=`fn ${t}( coord : ${r} ) -> ${r} {

	return ${r}(
`;const o=(l,c)=>{l===Zr?(s.push(J_.repeatWrapping_float),a+=`		tsl_repeatWrapping_float( coord.${c} )`):l===ui?(s.push(J_.clampWrapping_float),a+=`		tsl_clampWrapping_float( coord.${c} )`):l===vc?(s.push(J_.mirrorWrapping_float),a+=`		tsl_mirrorWrapping_float( coord.${c} )`):(a+=`		coord.${c}`,Se(`WebGPURenderer: Unsupported texture wrap type "${l}" for vertex shader.`))};o(e.wrapS,"x"),a+=`,
`,o(e.wrapT,"y"),(e.is3DTexture||e.isData3DTexture)&&(a+=`,
`,o(e.wrapR,"z")),a+=`
	);

}
`,G5[t]=n=new rr(a,s)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){const s=this.getDataFromNode(e,this.shaderStage,this.globalCache);s.dimensionsSnippet===void 0&&(s.dimensionsSnippet={});let r=s.dimensionsSnippet[n];if(s.dimensionsSnippet[n]===void 0){let a,o;const{primarySamples:l}=this.renderer.backend.utils.getTextureSampleData(e),c=l>1;e.is3DTexture||e.isData3DTexture?o="vec3<u32>":o="vec2<u32>",c||e.isStorageTexture?a=t:a=`${t}${n?`, u32( ${n} )`:""}`,r=new Hv(new kv(`textureDimensions( ${a} )`,o)),s.dimensionsSnippet[n]=r,(e.isArrayTexture||e.isDataArrayTexture||e.is3DTexture||e.isData3DTexture)&&(s.arrayLayerCount=new Hv(new kv(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(s.cubeFaceCount=new Hv(new kv("6u","u32")))}return r.build(this)}generateFilteredTexture(e,t,n,s,r="0u"){this._include("biquadraticTexture");const a=this.generateWrapFunction(e),o=this.generateTextureDimension(e,t,r);return s&&(n=`${n} + vec2<f32>(${s}) / ${o}`),`tsl_biquadraticTexture( ${t}, ${a}( ${n} ), ${o}, u32( ${r} ) )`}generateTextureLod(e,t,n,s,r,a="0u"){const o=this.generateWrapFunction(e),l=this.generateTextureDimension(e,t,a),c=e.is3DTexture||e.isData3DTexture?"vec3":"vec2";r&&(n=`${n} + ${c}<f32>(${r}) / ${c}<f32>( ${l} )`);const u=`${c}<u32>( ${o}( ${n} ) * ${c}<f32>( ${l} ) )`;return this.generateTextureLoad(e,t,u,a,s,null)}generateTextureLoad(e,t,n,s,r,a){s===null&&(s="0u"),a&&(n=`${n} + ${a}`);let o;return r?o=`textureLoad( ${t}, ${n}, ${r}, u32( ${s} ) )`:(o=`textureLoad( ${t}, ${n}, u32( ${s} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(o+=".x")),o}generateTextureStore(e,t,n,s,r){let a;return s?a=`textureStore( ${t}, ${n}, ${s}, ${r} )`:a=`textureStore( ${t}, ${n}, ${r} )`,a}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===Rn||this.isSampleCompare(e)===!1&&e.minFilter===$n&&e.magFilter===$n||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,s,r,a=this.shaderStage){let o=null;return this.isUnfilterable(e)?o=this.generateTextureLod(e,t,n,s,r,"0",a):o=this._generateTextureSample(e,t,n,s,r,a),o}generateTextureGrad(e,t,n,s,r,a,o=this.shaderStage){if(o==="fragment")return a?`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${s[0]}, ${s[1]}, ${a} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${s[0]}, ${s[1]} )`;De(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(e,t,n,s,r,a,o=this.shaderStage){if(o==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?a?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r}, ${s}, ${a} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r}, ${s} )`:a?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${s}, ${a} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${s} )`;De(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(e,t,n,s,r,a){return this.isUnfilterable(e)===!1?a?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${s}, ${a} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${s} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,a,s):this.generateTextureLod(e,t,n,r,a,s)}generateTextureBias(e,t,n,s,r,a,o=this.shaderStage){if(o==="fragment")return a?`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${s}, ${a} )`:`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${s} )`;De(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${o} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const n=e.name,s=e.type;return s==="texture"||s==="cubeTexture"||s==="cubeDepthTexture"||s==="storageTexture"||s==="texture3D"?n:s==="buffer"||s==="storageBuffer"||s==="indirectStorageBuffer"?this.isCustomStruct(e)?n:n+".value":e.groupNode.name+"."+n}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=gpe[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?e.isAtomic===!0?(Se("WebGPURenderer: Atomic operations are only supported in compute shaders."),wr.READ_WRITE):wr.READ_ONLY:e.access}getStorageAccess(e,t){return mpe[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n,s=null){const r=super.getUniformFromNode(e,t,n,s),a=this.getDataFromNode(e,n,this.globalCache);if(a.uniformGPU===void 0){let o;const l=e.groupNode,c=l.name,u=this.getBindGroupArray(c,n);if(t==="texture"||t==="cubeTexture"||t==="cubeDepthTexture"||t==="storageTexture"||t==="texture3D"){let h=null;const f=this.getNodeAccess(e,n);if(t==="texture"||t==="storageTexture"?e.value.is3DTexture===!0?h=new n3(r.name,r.node,l,f):h=new fw(r.name,r.node,l,f):t==="cubeTexture"||t==="cubeDepthTexture"?h=new dK(r.name,r.node,l,f):t==="texture3D"&&(h=new n3(r.name,r.node,l,f)),h.store=e.isStorageTextureNode===!0,h.mipLevel=h.store?e.mipLevel:0,h.setVisibility(mA[n]),this.isUnfilterable(e.value)===!1&&h.store===!1){const m=new npe(`${r.name}_sampler`,r.node,l);m.setVisibility(mA[n]),u.push(m,h),o=[m,h]}else u.push(h),o=[h]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const h=this.getSharedDataFromNode(e);let f=h.buffer;if(f===void 0){const m=t==="buffer"?cK:rpe;f=new m(e,l),h.buffer=f}f.setVisibility(f.getVisibility()|mA[n]),u.push(f),o=f,r.name=s||"NodeBuffer_"+r.id}else{const h=this.uniformGroups[n]||(this.uniformGroups[n]={});let f=h[c];f===void 0&&(f=new uK(c,l),f.setVisibility(mA[n]),h[c]=f,u.push(f)),o=this.getNodeUniform(r,t),f.addUniform(o)}a.uniformGPU=o}return r}getBuiltin(e,t,n,s=this.shaderStage){const r=this.builtins[s]||(this.builtins[s]=new Map);return r.has(e)===!1&&r.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),s=[];for(const a of t.inputs)s.push(a.name+" : "+this.getType(a.type));let r=`fn ${t.name}( ${s.join(", ")} ) -> ${this.getType(t.type)} {
${n.vars}
${n.code}
`;return n.result&&(r+=`	return ${n.result};
`),r+=`
}
`,r}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(n!==void 0)for(const s of n)t.push(`enable ${s};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(n!==void 0)for(const{name:s,property:r,type:a}of n.values())t.push(`@builtin( ${s} ) ${r} : ${a}`);return t.join(`,
	`)}getScopedArray(e,t,n,s){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:s}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:n,scope:s,bufferType:r,bufferCount:a}of this.scopedArrays.values()){const o=this.getType(r);t.push(`var<${s}> ${n}: array< ${o}, ${a} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const n=this.getBuiltins("attribute");n&&t.push(n);const s=this.getAttributesArray();for(let r=0,a=s.length;r<a;r++){const o=s[r],l=o.name,c=this.getType(o.type);t.push(`@location( ${r} ) ${l} : ${c}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const n of e.members){const s=e.output?"@location( "+n.index+" ) ":"";let r=this.getType(n.type);n.atomic&&(r="atomic< "+r+" >"),t.push(`	${s+n.name} : ${r}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const s=[];for(const r of n){let a=`struct ${r.name} {
`;a+=this.getStructMembers(r),a+=`
};`,s.push(a)}t=`
`+s.join(`

`)+`
`}return t}getVar(e,t,n=null){let s=`var ${t} : `;return n!==null?s+=this.generateArrayDeclaration(e,n):s+=this.getType(e),s}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const s of n)t.push(`	${this.getVar(s.type,s.name,s.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const r=this.varyings,a=this.vars[e];for(let o=0;o<r.length;o++){const l=r[o];if(l.needsInterpolation){let c=`@location( ${o} )`;if(l.interpolationType){const u=l.interpolationSampling!==null?`, ${l.interpolationSampling} )`:" )";c+=` @interpolate( ${l.interpolationType}${u}`}else/^(int|uint|ivec|uvec)/.test(l.type)&&(c+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${c} ${l.name} : ${this.getType(l.type)}`)}else e==="vertex"&&a.includes(l)===!1&&a.push(l)}}const n=this.getBuiltins(e);n&&t.push(n);const s=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+s):s}isCustomStruct(e){const t=e.value,n=e.node,s=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&n.structTypeNode!==null,r=n.value&&n.value.array&&typeof n.value.itemSize=="number"&&n.value.array.length>n.value.itemSize;return s&&!r}getUniforms(e){const t=this.uniforms[e],n=[],s=[],r=[],a={};for(const l of t){const c=l.groupNode.name,u=this.bindingsIndexes[c];if(l.type==="texture"||l.type==="cubeTexture"||l.type==="cubeDepthTexture"||l.type==="storageTexture"||l.type==="texture3D"){const h=l.node.value;this.isUnfilterable(h)===!1&&l.node.isStorageTextureNode!==!0&&(this.isSampleCompare(h)?n.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${l.name}_sampler : sampler_comparison;`):n.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${l.name}_sampler : sampler;`));let f,m="";const{primarySamples:g}=this.renderer.backend.utils.getTextureSampleData(h);if(g>1&&(m="_multisampled"),h.isCubeTexture===!0&&h.isDepthTexture===!0)f="texture_depth_cube";else if(h.isCubeTexture===!0)f="texture_cube<f32>";else if(h.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&h.compareFunction===null?f=`texture${m}_2d<f32>`:f=`texture_depth${m}_2d${h.isArrayTexture===!0?"_array":""}`;else if(l.node.isStorageTextureNode===!0){const x=s3(h),v=this.getStorageAccess(l.node,e),y=l.node.value.is3DTexture,b=l.node.value.isArrayTexture;f=`texture_storage_${y?"3d":`2d${b?"_array":""}`}<${x}, ${v}>`}else if(h.isArrayTexture===!0||h.isDataArrayTexture===!0||h.isCompressedArrayTexture===!0)f="texture_2d_array<f32>";else if(h.is3DTexture===!0||h.isData3DTexture===!0)f="texture_3d<f32>";else{const x=this.getComponentTypeFromTexture(h).charAt(0);f=`texture${m}_2d<${x}32>`}n.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${l.name} : ${f};`)}else if(l.type==="buffer"||l.type==="storageBuffer"||l.type==="indirectStorageBuffer"){const h=l.node,f=this.getType(h.getNodeType(this)),m=h.bufferCount,g=m>0&&l.type==="buffer"?", "+m:"",x=h.isStorageBufferNode?`storage, ${this.getStorageAccess(h,e)}`:"uniform";if(this.isCustomStruct(l))s.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var<${x}> ${l.name} : ${f};`);else{const y=`	value : array< ${h.isAtomic?`atomic<${f}>`:`${f}`}${g} >`;s.push(this._getWGSLStructBinding(l.name,y,x,u.binding++,u.group))}}else{const h=this.getType(this.getVectorType(l.type)),f=l.groupNode.name;(a[f]||(a[f]={index:u.binding++,id:u.group,snippets:[]})).snippets.push(`	${l.name} : ${h}`)}}for(const l in a){const c=a[l];r.push(this._getWGSLStructBinding(l,c.snippets.join(`,
`),"uniform",c.index,c.id))}return[...n,...s,...r].join(`
`)}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let s=`// code

`;s+=this.flowCode[t];const r=this.flowNodes[t],a=r[r.length-1],o=a.outputNode,l=o!==void 0&&o.isOutputStructNode===!0;for(const c of r){const u=this.getFlowData(c),h=c.name;if(h&&(s.length>0&&(s+=`
`),s+=`	// flow -> ${h}
`),s+=`${u.code}
	`,c===a&&t!=="compute"){if(s+=`// result

	`,t==="vertex")s+=`varyings.Vertex = ${u.result};`;else if(t==="fragment")if(l)n.returnType=o.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",s+=`return ${u.result};`;else{let f="	@location(0) color: vec4<f32>";const m=this.getBuiltins("output");m&&(f+=`,
	`+m),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",f),n.structs+=`
var<private> output : OutputStruct;`,s+=`output.color = ${u.result};

	return output;`}}}n.flow=s}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let n;return t!==null&&(n=this._getWGSLMethod(e+"_"+t)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,n){return`select( ${n}, ${t}, ${e} )`}getType(e){return ype[e]||e}isAvailable(e){let t=F5[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),F5[e]=t),t}_getWGSLMethod(e){return J_[e]!==void 0&&this._include(e),xpe[e]}_include(e){const t=J_[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${mK}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){const[n,s,r]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${n}, ${s}, ${r} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${n} * numWorkgroups.x )
		+ globalId.z * ( ${n} * numWorkgroups.x ) * ( ${s} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,n,s=0,r=0){const a=e+"Struct";return`${this._getWGSLStruct(a,t)}
@binding( ${s} ) @group( ${r} )
var<${n}> ${e} : ${a};`}}class vpe{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=ae.Depth24PlusStencil8:e.depth&&(t=ae.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const r=this.backend.renderer,a=r.getRenderTarget();t=a?a.samples:r.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorFormats(e){return e.textures!==null?e.textures.map(t=>this.getTextureFormatGPU(t)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return ry.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return ry.LineList;if(e.isLine)return ry.LineStrip;if(e.isMesh)return ry.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const t=this.backend.parameters.outputType;if(t===void 0)return navigator.gpu.getPreferredCanvasFormat();if(t===ei)return ae.BGRA8Unorm;if(t===ln)return ae.RGBA16Float;throw new Error("Unsupported output buffer type.")}}const gK=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&gK.set(Float16Array,["float16"]);const bpe=new Map([[KE,["float16"]]]),Spe=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class Tpe{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),s=this.backend,r=s.get(n);let a=r.buffer;if(a===void 0){const o=s.device;let l=n.array;if(e.normalized===!1){if(l.constructor===Int16Array||l.constructor===Int8Array)l=new Int32Array(l);else if((l.constructor===Uint16Array||l.constructor===Uint8Array)&&(l=new Uint32Array(l),t&GPUBufferUsage.INDEX))for(let h=0;h<l.length;h++)l[h]===65535&&(l[h]=4294967295)}if(n.array=l,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){l=new l.constructor(n.count*4);for(let h=0;h<n.count;h++)l.set(n.array.subarray(h*3,h*3+3),h*4);n.itemSize=4,n.array=l,r._force3to4BytesAlignment=!0}const c=l.byteLength,u=c+(4-c%4)%4;a=o.createBuffer({label:n.name,size:u,usage:t,mappedAtCreation:!0}),new l.constructor(a.getMappedRange()).set(l),a.unmap(),r.buffer=a}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,s=n.device,r=n.get(t),a=n.get(t).buffer;let o=t.array;if(r._force3to4BytesAlignment===!0){o=new o.constructor(t.count*4);for(let c=0;c<t.count;c++)o.set(t.array.subarray(c*3,c*3+3),c*4);t.array=o}const l=t.updateRanges;if(l.length===0)s.queue.writeBuffer(a,0,o,0);else{const c=Xy(o),u=c?1:o.BYTES_PER_ELEMENT;for(let h=0,f=l.length;h<f;h++){const m=l[h];let g,x;if(r._force3to4BytesAlignment===!0){const y=Math.floor(m.start/3),b=Math.ceil(m.count/3);g=y*4*u,x=b*4*u}else g=m.start*u,x=m.count*u;const v=g*(c?o.BYTES_PER_ELEMENT:1);s.queue.writeBuffer(a,v,o,g,x)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let s=0;s<t.length;s++){const r=t[s],a=r.array.BYTES_PER_ELEMENT,o=this._getBufferAttribute(r);let l=n.get(o);if(l===void 0){let h,f;r.isInterleavedBufferAttribute===!0?(h=r.data.stride*a,f=r.data.isInstancedInterleavedBuffer?pA.Instance:pA.Vertex):(h=r.itemSize*a,f=r.isInstancedBufferAttribute?pA.Instance:pA.Vertex),r.normalized===!1&&(r.array.constructor===Int16Array||r.array.constructor===Uint16Array)&&(h=4),l={arrayStride:h,attributes:[],stepMode:f},n.set(o,l)}const c=this._getVertexFormat(r),u=r.isInterleavedBufferAttribute===!0?r.offset*a:0;l.attributes.push({shaderLocation:s,offset:u,format:c})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,r=t.get(this._getBufferAttribute(e)).buffer,a=r.size,o=n.createBuffer({label:`${e.name}_readback`,size:a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),l=n.createCommandEncoder({label:`readback_encoder_${e.name}`});l.copyBufferToBuffer(r,0,o,0,a);const c=l.finish();n.queue.submit([c]),await o.mapAsync(GPUMapMode.READ);const u=o.getMappedRange(),h=new e.array.constructor(u.slice(0));return o.unmap(),h.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,s=e.array.constructor,r=e.constructor;let a;if(t===1)a=Spe.get(s);else{const l=(bpe.get(r)||gK.get(s))[n?1:0];if(l){const c=s.BYTES_PER_ELEMENT*t,h=Math.floor((c+3)/4)*4/s.BYTES_PER_ELEMENT;if(h%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");a=`${l}x${h}`}}return a||De("WebGPUAttributeUtils: Vertex format not supported yet."),a}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class Ape{constructor(e){this.layoutGPU=e,this.usedTimes=0}}class Mpe{constructor(e){this.backend=e,this._bindGroupLayoutCache=new Map}createBindingsLayout(e){const t=this.backend,n=t.device,s=t.get(e);if(s.layout)return s.layout.layoutGPU;const r=this._createLayoutEntries(e),a=JSON.stringify(r);let o=this._bindGroupLayoutCache.get(a);return o===void 0&&(o=new Ape(n.createBindGroupLayout({entries:r})),this._bindGroupLayoutCache.set(a,o)),o.usedTimes++,s.layout=o,s.layoutKey=a,o.layoutGPU}createBindings(e,t,n,s=0){const{backend:r}=this,a=r.get(e),o=this.createBindingsLayout(e);let l;n>0&&(a.groups===void 0&&(a.groups=[],a.versions=[]),a.versions[n]===s&&(l=a.groups[n])),l===void 0&&(l=this.createBindGroup(e,o),n>0&&(a.groups[n]=l,a.versions[n]=s)),a.group=l}updateBinding(e){const t=this.backend,n=t.device,s=e.buffer,r=t.get(e).buffer,a=e.updateRanges;if(a.length===0)n.queue.writeBuffer(r,0,s,0);else{const o=Xy(s),l=o?1:s.BYTES_PER_ELEMENT;for(let c=0,u=a.length;c<u;c++){const h=a[c],f=h.start*l,m=h.count*l,g=f*(o?s.BYTES_PER_ELEMENT:1);n.queue.writeBuffer(r,g,s,f,m)}e.clearUpdateRanges()}}createBindGroupIndex(e,t){const s=this.backend.device,r=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a=e[0],o=s.createBuffer({label:"bindingCameraIndex_"+a,size:16,usage:r});s.queue.writeBuffer(o,0,e,0);const l=[{binding:0,resource:{buffer:o}}];return s.createBindGroup({label:"bindGroupCameraIndex_"+a,layout:t,entries:l})}createBindGroup(e,t){const n=this.backend,s=n.device;let r=0;const a=[];for(const o of e.bindings){if(o.isUniformBuffer){const l=n.get(o);if(l.buffer===void 0){const c=o.byteLength,u=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,h=[];o.visibility&dm.VERTEX&&h.push("vertex"),o.visibility&dm.FRAGMENT&&h.push("fragment"),o.visibility&dm.COMPUTE&&h.push("compute");const f=`(${h.join(",")})`,m=s.createBuffer({label:`bindingBuffer${o.id}_${o.name}_${f}`,size:c,usage:u});l.buffer=m}a.push({binding:r,resource:{buffer:l.buffer}})}else if(o.isStorageBuffer){const l=n.get(o);if(l.buffer===void 0){const c=o.attribute;l.buffer=n.get(c).buffer}a.push({binding:r,resource:{buffer:l.buffer}})}else if(o.isSampledTexture){const l=n.get(o.texture);let c;if(l.externalTexture!==void 0)c=s.importExternalTexture({source:l.externalTexture});else{const u=o.store?1:l.texture.mipLevelCount,h=o.store?o.mipLevel:0;let f=`view-${l.texture.width}-${l.texture.height}`;if(l.texture.depthOrArrayLayers>1&&(f+=`-${l.texture.depthOrArrayLayers}`),f+=`-${u}-${h}`,c=l[f],c===void 0){const m=tpe.All;let g;o.isSampledCubeTexture?g=Ys.Cube:o.isSampledTexture3D?g=Ys.ThreeD:o.texture.isArrayTexture||o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?g=Ys.TwoDArray:g=Ys.TwoD,c=l[f]=l.texture.createView({aspect:m,dimension:g,mipLevelCount:u,baseMipLevel:h})}}a.push({binding:r,resource:c})}else if(o.isSampler){const l=n.get(o.texture);a.push({binding:r,resource:l.sampler})}r++}return s.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:a})}_createLayoutEntries(e){const t=[];let n=0;for(const s of e.bindings){const r=this.backend,a={binding:n,visibility:s.visibility};if(s.isUniformBuffer||s.isStorageBuffer){const o={};s.isStorageBuffer&&(s.visibility&dm.COMPUTE&&(s.access===wr.READ_WRITE||s.access===wr.WRITE_ONLY)?o.type=P2.Storage:o.type=P2.ReadOnlyStorage),a.buffer=o}else if(s.isSampledTexture&&s.store){const o={};o.format=this.backend.get(s.texture).texture.format;const l=s.access;l===wr.READ_WRITE?o.access=O2.ReadWrite:l===wr.WRITE_ONLY?o.access=O2.WriteOnly:o.access=O2.ReadOnly,s.texture.isArrayTexture?o.viewDimension=Ys.TwoDArray:s.texture.is3DTexture&&(o.viewDimension=Ys.ThreeD),a.storageTexture=o}else if(s.isSampledTexture){const o={},{primarySamples:l}=r.utils.getTextureSampleData(s.texture);if(l>1&&(o.multisampled=!0,s.texture.isDepthTexture||(o.sampleType=qp.UnfilterableFloat)),s.texture.isDepthTexture)r.compatibilityMode&&s.texture.compareFunction===null?o.sampleType=qp.UnfilterableFloat:o.sampleType=qp.Depth;else if(s.texture.isDataTexture||s.texture.isDataArrayTexture||s.texture.isData3DTexture){const c=s.texture.type;c===Is?o.sampleType=qp.SInt:c===Jn?o.sampleType=qp.UInt:c===Rn&&(this.backend.hasFeature("float32-filterable")?o.sampleType=qp.Float:o.sampleType=qp.UnfilterableFloat)}s.isSampledCubeTexture?o.viewDimension=Ys.Cube:s.texture.isArrayTexture||s.texture.isDataArrayTexture||s.texture.isCompressedArrayTexture?o.viewDimension=Ys.TwoDArray:s.isSampledTexture3D&&(o.viewDimension=Ys.ThreeD),a.texture=o}else if(s.isSampler){const o={};s.texture.isDepthTexture&&(s.texture.compareFunction!==null?o.type=L5.Comparison:r.compatibilityMode&&(o.type=L5.NonFiltering)),a.sampler=o}else De(`WebGPUBindingUtils: Unsupported binding "${s}".`);t.push(a),n++}return t}deleteBindGroupData(e){const{backend:t}=this,n=t.get(e);n.layout&&(n.layout.usedTimes--,n.layout.usedTimes===0&&this._bindGroupLayoutCache.delete(n.layoutKey),n.layout=void 0,n.layoutKey=void 0)}dispose(){this._bindGroupLayoutCache.clear()}}class Epe{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:s,geometry:r,pipeline:a}=e,{vertexProgram:o,fragmentProgram:l}=a,c=this.backend,u=c.device,h=c.utils,f=c.get(a),m=[];for(const F of e.getBindings()){const V=c.get(F),{layoutGPU:Y}=V.layout;m.push(Y)}const g=c.attributeUtils.createShaderVertexBuffers(e);let x;s.blending!==Nr&&(s.blending!==qa||s.transparent!==!1)&&(x=this._getBlending(s));let v={};s.stencilWrite===!0&&(v={compare:this._getStencilCompare(s),failOp:this._getStencilOperation(s.stencilFail),depthFailOp:this._getStencilOperation(s.stencilZFail),passOp:this._getStencilOperation(s.stencilZPass)});const y=this._getColorWriteMask(s),b=[];if(e.context.textures!==null){const F=e.context.textures;for(let V=0;V<F.length;V++){const Y=h.getTextureFormatGPU(F[V]);V===0?b.push({format:Y,blend:x,writeMask:y}):b.push({format:Y,writeMask:y})}}else{const F=h.getCurrentColorFormat(e.context);b.push({format:F,blend:x,writeMask:y})}const S=c.get(o).module,T=c.get(l).module,M=this._getPrimitiveState(n,r,s),C=this._getDepthCompare(s),w=h.getCurrentDepthStencilFormat(e.context),N=this._getSampleCount(e.context),E={label:`renderPipeline_${s.name||s.type}_${s.id}`,vertex:Object.assign({},S,{buffers:g}),fragment:Object.assign({},T,{targets:b}),primitive:M,multisample:{count:N,alphaToCoverageEnabled:s.alphaToCoverage&&N>1},layout:u.createPipelineLayout({bindGroupLayouts:m})},B={},U=e.context.depth,H=e.context.stencil;if((U===!0||H===!0)&&(U===!0&&(B.format=w,B.depthWriteEnabled=s.depthWrite,B.depthCompare=C),H===!0&&(B.stencilFront=v,B.stencilBack={},B.stencilReadMask=s.stencilFuncMask,B.stencilWriteMask=s.stencilWriteMask),s.polygonOffset===!0&&(B.depthBias=s.polygonOffsetUnits,B.depthBiasSlopeScale=s.polygonOffsetFactor,B.depthBiasClamp=0),E.depthStencil=B),u.pushErrorScope("validation"),t===null)f.pipeline=u.createRenderPipeline(E),u.popErrorScope().then(F=>{F!==null&&(f.error=!0,De(F.message))});else{const F=new Promise(async V=>{try{f.pipeline=await u.createRenderPipelineAsync(E)}catch{}const Y=await u.popErrorScope();Y!==null&&(f.error=!0,De(Y.message)),V()});t.push(F)}}createBundleEncoder(e,t="renderBundleEncoder"){const n=this.backend,{utils:s,device:r}=n,a=s.getCurrentDepthStencilFormat(e),o=s.getCurrentColorFormats(e),l=this._getSampleCount(e),c={label:t,colorFormats:o,depthStencilFormat:a,sampleCount:l};return r.createRenderBundleEncoder(c)}createComputePipeline(e,t){const n=this.backend,s=n.device,r=n.get(e.computeProgram).module,a=n.get(e),o=[];for(const l of t){const c=n.get(l),{layoutGPU:u}=c.layout;o.push(u)}a.pipeline=s.createComputePipeline({compute:r,layout:s.createPipelineLayout({bindGroupLayouts:o})})}_getBlending(e){let t,n;const s=e.blending,r=e.blendSrc,a=e.blendDst,o=e.blendEquation;if(s===nf){const l=e.blendSrcAlpha!==null?e.blendSrcAlpha:r,c=e.blendDstAlpha!==null?e.blendDstAlpha:a,u=e.blendEquationAlpha!==null?e.blendEquationAlpha:o;t={srcFactor:this._getBlendFactor(r),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(o)},n={srcFactor:this._getBlendFactor(l),dstFactor:this._getBlendFactor(c),operation:this._getBlendOperation(u)}}else{const l=e.premultipliedAlpha,c=(u,h,f,m)=>{t={srcFactor:u,dstFactor:h,operation:Xp.Add},n={srcFactor:f,dstFactor:m,operation:Xp.Add}};if(l)switch(s){case qa:c(Vn.One,Vn.OneMinusSrcAlpha,Vn.One,Vn.OneMinusSrcAlpha);break;case hf:c(Vn.One,Vn.One,Vn.One,Vn.One);break;case df:c(Vn.Zero,Vn.OneMinusSrc,Vn.Zero,Vn.One);break;case Ch:c(Vn.Dst,Vn.OneMinusSrcAlpha,Vn.Zero,Vn.One);break}else switch(s){case qa:c(Vn.SrcAlpha,Vn.OneMinusSrcAlpha,Vn.One,Vn.OneMinusSrcAlpha);break;case hf:c(Vn.SrcAlpha,Vn.One,Vn.One,Vn.One);break;case df:De("WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Ch:De("WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true");break}}if(t!==void 0&&n!==void 0)return{color:t,alpha:n};De("WebGPURenderer: Invalid blending: ",s)}_getBlendFactor(e){let t;switch(e){case dc:t=Vn.Zero;break;case hS:t=Vn.One;break;case dS:t=Vn.Src;break;case fS:t=Vn.OneMinusSrc;break;case Pm:t=Vn.SrcAlpha;break;case Om:t=Vn.OneMinusSrcAlpha;break;case gS:t=Vn.Dst;break;case yS:t=Vn.OneMinusDst;break;case pS:t=Vn.DstAlpha;break;case mS:t=Vn.OneMinusDstAlpha;break;case xS:t=Vn.SrcAlphaSaturated;break;case ile:t=Vn.Constant;break;case sle:t=Vn.OneMinusConstant;break;default:De("WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const n=e.stencilFunc;switch(n){case lU:t=Gr.Never;break;case bb:t=Gr.Always;break;case cU:t=Gr.Less;break;case hU:t=Gr.LessEqual;break;case uU:t=Gr.Equal;break;case pU:t=Gr.GreaterEqual;break;case dU:t=Gr.Greater;break;case fU:t=Gr.NotEqual;break;default:De("WebGPURenderer: Invalid stencil function.",n)}return t}_getStencilOperation(e){let t;switch(e){case Zu:t=gd.Keep;break;case tU:t=gd.Zero;break;case nU:t=gd.Replace;break;case oU:t=gd.Invert;break;case iU:t=gd.IncrementClamp;break;case sU:t=gd.DecrementClamp;break;case rU:t=gd.IncrementWrap;break;case aU:t=gd.DecrementWrap;break;default:De("WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case Mr:t=Xp.Add;break;case cS:t=Xp.Subtract;break;case uS:t=Xp.ReverseSubtract;break;case GE:t=Xp.Min;break;case zE:t=Xp.Max;break;default:De("WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,n){const s={},r=this.backend.utils;s.topology=r.getPrimitiveTopology(e,n),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(s.stripIndexFormat=t.index.array instanceof Uint16Array?$y.Uint16:$y.Uint32);let a=n.side===hi;return e.isMesh&&e.matrixWorld.determinant()<0&&(a=!a),s.frontFace=a===!0?N5.CW:N5.CCW,s.cullMode=n.side===Ps?B5.None:B5.Back,s}_getColorWriteMask(e){return e.colorWrite===!0?D5.All:D5.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=Gr.Always;else{const n=e.depthFunc;switch(n){case Fm:t=Gr.Never;break;case Gm:t=Gr.Always;break;case zm:t=Gr.Less;break;case uu:t=Gr.LessEqual;break;case Vm:t=Gr.Equal;break;case Hm:t=Gr.GreaterEqual;break;case km:t=Gr.Greater;break;case Wm:t=Gr.NotEqual;break;default:De("WebGPUPipelineUtils: Invalid depth function.",n)}}return t}}class Cpe extends pK{constructor(e,t,n=2048){super(n),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const s=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return oi(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const s=this.device.createCommandEncoder();s.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),s.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const r=s.finish();if(this.device.queue.submit([r]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const a=new BigUint64Array(this.resultBuffer.getMappedRange(0,n)),o={},l=[];for(const[u,h]of e){const f=u.match(/^(.*):f(\d+)$/),m=parseInt(f[2]);l.includes(m)===!1&&l.push(m),o[m]===void 0&&(o[m]=0);const g=a[h],x=a[h+1],v=Number(x-g)/1e6;this.timestamps.set(u,v),o[m]+=v}const c=o[l[l.length-1]];return this.resultBuffer.unmap(),this.lastValue=c,this.frames=l,c}catch(e){return De("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){De("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){De("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class wpe extends fK{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new vpe(this),this.attributeUtils=new Tpe(this),this.bindingUtils=new Mpe(this),this.pipelineUtils=new Epe(this),this.textureUtils=new cpe(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let n;if(t.device===void 0){const s={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},r=typeof navigator<"u"?await navigator.gpu.requestAdapter(s):null;if(r===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const a=Object.values(i3),o=[];for(const c of a)r.features.has(c)&&o.push(c);const l={requiredFeatures:o,requiredLimits:t.requiredLimits};n=await r.requestDevice(l)}else n=t.device;n.lost.then(s=>{if(s.reason==="destroyed")return;const r={api:"WebGPU",message:s.message||"Unknown reason",reason:s.reason||null,originalEvent:s};e.onDeviceLost(r)}),this.device=n,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(i3.TimestampQuery),this.updateSize()}get context(){const e=this.renderer.getCanvasTarget(),t=this.get(e);let n=t.context;if(n===void 0){const s=this.parameters;e.isDefaultCanvasTarget===!0&&s.context!==void 0?n=s.context:n=e.domElement.getContext("webgpu"),"setAttribute"in e.domElement&&e.domElement.setAttribute("data-engine",`three.js r${bu} webgpu`);const r=s.alpha?"premultiplied":"opaque",a=s.outputType===ln?"extended":"standard";n.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:r,toneMapping:{mode:a}}),t.context=n}return n}get coordinateSystem(){return Ka}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const e=this.renderer,t=e.getCanvasTarget(),n=this.get(t),s=e.currentSamples;let r=n.descriptor;if(r===void 0||n.samples!==s){r={colorAttachments:[{view:null}]},(e.depth===!0||e.stencil===!0)&&(r.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const o=r.colorAttachments[0];s>0?o.view=this.textureUtils.getColorBuffer().createView():o.resolveTarget=void 0,n.descriptor=r,n.samples=s}const a=r.colorAttachments[0];return s>0?a.resolveTarget=this.context.getCurrentTexture().createView():a.view=this.context.getCurrentTexture().createView(),r}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const n=e.renderTarget,s=this.get(n);let r=s.descriptors;(r===void 0||s.width!==n.width||s.height!==n.height||s.samples!==n.samples)&&(r={},s.descriptors=r);const a=e.getCacheKey();let o=r[a];if(o===void 0){const c=e.textures,u=[];let h;const f=this._isRenderCameraDepthArray(e);for(let m=0;m<c.length;m++){const g=this.get(c[m]),x={label:`colorAttachment_${m}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:Ys.TwoD};if(n.isRenderTarget3D)h=e.activeCubeFace,x.baseArrayLayer=0,x.dimension=Ys.ThreeD,x.depthOrArrayLayers=c[m].image.depth;else if(n.isRenderTarget&&c[m].image.depth>1)if(f===!0){const v=e.camera.cameras;for(let y=0;y<v.length;y++){const b={...x,baseArrayLayer:y,arrayLayerCount:1,dimension:Ys.TwoD},S=g.texture.createView(b);u.push({view:S,resolveTarget:void 0,depthSlice:void 0})}}else x.dimension=Ys.TwoDArray,x.depthOrArrayLayers=c[m].image.depth;if(f!==!0){const v=g.texture.createView(x);let y,b;g.msaaTexture!==void 0?(y=g.msaaTexture.createView(),b=v):(y=v,b=void 0),u.push({view:y,resolveTarget:b,depthSlice:h})}}if(o={textureViews:u},e.depth){const m=this.get(e.depthTexture),g={};(e.depthTexture.isArrayTexture||e.depthTexture.isCubeTexture)&&(g.dimension=Ys.TwoD,g.arrayLayerCount=1,g.baseArrayLayer=e.activeCubeFace),o.depthStencilView=m.texture.createView(g)}r[a]=o,s.width=n.width,s.height=n.height,s.samples=n.samples,s.activeMipmapLevel=e.activeMipmapLevel,s.activeCubeFace=e.activeCubeFace}const l={colorAttachments:[]};for(let c=0;c<o.textureViews.length;c++){const u=o.textureViews[c];let h={r:0,g:0,b:0,a:1};c===0&&t.clearValue&&(h=t.clearValue),l.colorAttachments.push({view:u.view,depthSlice:u.depthSlice,resolveTarget:u.resolveTarget,loadOp:t.loadOp||fi.Load,storeOp:t.storeOp||Na.Store,clearValue:h})}return o.depthStencilView&&(l.depthStencilAttachment={view:o.depthStencilView}),l}beginRender(e){const t=this.get(e),n=this.device,s=e.occlusionQueryCount;let r;s>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,r=n.createQuerySet({type:"occlusion",count:s,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=r,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(s),t.lastOcclusionObject=null);let a;e.textures===null?a=this._getDefaultRenderPassDescriptor():a=this._getRenderPassDescriptor(e,{loadOp:fi.Load}),this.initTimestampQuery(ga.RENDER,this.getTimestampUID(e),a),a.occlusionQuerySet=r;const o=a.depthStencilAttachment;if(e.textures!==null){const c=a.colorAttachments;for(let u=0;u<c.length;u++){const h=c[u];e.clearColor?(h.clearValue=u===0?e.clearColorValue:{r:0,g:0,b:0,a:1},h.loadOp=fi.Clear):h.loadOp=fi.Load,h.storeOp=Na.Store}}else{const c=a.colorAttachments[0];e.clearColor?(c.clearValue=e.clearColorValue,c.loadOp=fi.Clear):c.loadOp=fi.Load,c.storeOp=Na.Store}e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=fi.Clear):o.depthLoadOp=fi.Load,o.depthStoreOp=Na.Store),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=fi.Clear):o.stencilLoadOp=fi.Load,o.stencilStoreOp=Na.Store);const l=n.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const c=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==c.length?this._createDepthLayerDescriptors(e,t,a,c):this._updateDepthLayerDescriptors(e,t,c),t.bundleEncoders=[],t.bundleSets=[];for(let u=0;u<c.length;u++){const h=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+u),f={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(h),t.bundleSets.push(f)}t.currentPass=null}else{const c=l.beginRenderPass(a);t.currentPass=c,e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}t.descriptor=a,t.encoder=l,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,n,s){const r=n.depthStencilAttachment;t.layerDescriptors=[];const a=this.get(e.depthTexture);a.viewCache||(a.viewCache=[]);for(let o=0;o<s.length;o++){const l={...n,colorAttachments:[{...n.colorAttachments[0],view:n.colorAttachments[o].view}]};if(n.depthStencilAttachment){const c=o;a.viewCache[c]||(a.viewCache[c]=a.texture.createView({dimension:Ys.TwoD,baseArrayLayer:o,arrayLayerCount:1})),l.depthStencilAttachment={view:a.viewCache[c],depthLoadOp:r.depthLoadOp||fi.Clear,depthStoreOp:r.depthStoreOp||Na.Store,depthClearValue:r.depthClearValue||1},e.stencil&&(l.depthStencilAttachment.stencilLoadOp=r.stencilLoadOp,l.depthStencilAttachment.stencilStoreOp=r.stencilStoreOp,l.depthStencilAttachment.stencilClearValue=r.stencilClearValue)}else l.depthStencilAttachment={...r};t.layerDescriptors.push(l)}}_updateDepthLayerDescriptors(e,t,n){for(let s=0;s<n.length;s++){const r=t.layerDescriptors[s];if(r.depthStencilAttachment){const a=r.depthStencilAttachment;e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=fi.Clear):a.depthLoadOp=fi.Load),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=fi.Clear):a.stencilLoadOp=fi.Load)}}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const s=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const r=[];for(let a=0;a<t.bundleEncoders.length;a++){const o=t.bundleEncoders[a];r.push(o.finish())}for(let a=0;a<t.layerDescriptors.length;a++)if(a<r.length){const o=t.layerDescriptors[a],l=s.beginRenderPass(o);if(e.viewport){const{x:c,y:u,width:h,height:f,minDepth:m,maxDepth:g}=e.viewportValue;l.setViewport(c,u,h,f,m,g)}if(e.scissor){const{x:c,y:u,width:h,height:f}=e.scissorValue;l.setScissorRect(c,u,h,f)}l.executeBundles([r[a]]),l.end()}}else t.currentPass&&t.currentPass.end();if(n>0){const r=n*8;let a=this.occludedResolveCache.get(r);a===void 0&&(a=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(r,a));const o=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,a,0),t.encoder.copyBufferToBuffer(a,0,o,0,r),t.occlusionQueryBuffer=o,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const r=e.textures;for(let a=0;a<r.length;a++){const o=r[a];o.generateMipmaps===!0&&this.textureUtils.generateMipmaps(o)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:s}=t;if(n&&s){const r=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const a=n.getMappedRange(),o=new BigUint64Array(a);for(let l=0;l<s.length;l++)o[l]===BigInt(0)&&r.add(s[l]);n.destroy(),t.occluded=r}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:s,width:r,height:a,minDepth:o,maxDepth:l}=e.viewportValue;t.setViewport(n,s,r,a,o,l)}updateScissor(e){const{currentPass:t}=this.get(e),{x:n,y:s,width:r,height:a}=e.scissorValue;t.setScissorRect(n,s,r,a)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n,s=null){const r=this.device,a=this.renderer;let o=[],l,c,u,h;if(e){const g=this.getClearColor();c={r:g.r,g:g.g,b:g.b,a:g.a}}if(s===null){u=a.depth,h=a.stencil;const g=this._getDefaultRenderPassDescriptor();if(e){o=g.colorAttachments;const x=o[0];x.clearValue=c,x.loadOp=fi.Clear,x.storeOp=Na.Store}(u||h)&&(l=g.depthStencilAttachment)}else{u=s.depth,h=s.stencil;const g={loadOp:e?fi.Clear:fi.Load,clearValue:e?c:void 0};u&&(g.depthLoadOp=t?fi.Clear:fi.Load,g.depthClearValue=t?a.getClearDepth():void 0,g.depthStoreOp=Na.Store),h&&(g.stencilLoadOp=n?fi.Clear:fi.Load,g.stencilClearValue=n?a.getClearStencil():void 0,g.stencilStoreOp=Na.Store);const x=this._getRenderPassDescriptor(s,g);o=x.colorAttachments,l=x.depthStencilAttachment}u&&l&&(t?(l.depthLoadOp=fi.Clear,l.depthClearValue=a.getClearDepth(),l.depthStoreOp=Na.Store):(l.depthLoadOp=fi.Load,l.depthStoreOp=Na.Store)),h&&l&&(n?(l.stencilLoadOp=fi.Clear,l.stencilClearValue=a.getClearStencil(),l.stencilStoreOp=Na.Store):(l.stencilLoadOp=fi.Load,l.stencilStoreOp=Na.Store));const f=r.createCommandEncoder({label:"clear"});f.beginRenderPass({colorAttachments:o,depthStencilAttachment:l}).end(),r.queue.submit([f.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(ga.COMPUTE,this.getTimestampUID(e),n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,s,r=null){const a=this.get(t),{passEncoderGPU:o}=this.get(e),l=this.get(s).pipeline;this.pipelineUtils.setPipeline(o,l);for(let c=0,u=n.length;c<u;c++){const h=n[c],f=this.get(h);o.setBindGroup(c,f.group)}if(r===null&&(r=t.count),r&&typeof r=="object"&&r.isIndirectStorageBufferAttribute){const c=this.get(r).buffer;o.dispatchWorkgroupsIndirect(c,0);return}if(typeof r=="number"){const c=r;if(a.dispatchSize===void 0||a.count!==c){a.dispatchSize=[0,1,1],a.count=c;const u=t.workgroupSize;let h=u[0];for(let g=1;g<u.length;g++)h*=u[g];const f=Math.ceil(c/h),m=this.device.limits.maxComputeWorkgroupsPerDimension;r=[f,1,1],f>m&&(r[0]=Math.min(f,m),r[1]=Math.ceil(f/m)),a.dispatchSize=r}r=a.dispatchSize}o.dispatchWorkgroups(r[0],r[1]||1,r[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){const{object:n,material:s,context:r,pipeline:a}=e,o=e.getBindings(),l=this.get(r),c=this.get(a),u=c.pipeline;if(c.error===!0)return;const h=e.getIndex(),f=h!==null,m=e.getDrawParameters();if(m===null)return;const g=(v,y)=>{this.pipelineUtils.setPipeline(v,u),y.pipeline=u;const b=y.bindingGroups;for(let T=0,M=o.length;T<M;T++){const C=o[T],w=this.get(C);b[C.index]!==C.id&&(v.setBindGroup(C.index,w.group),b[C.index]=C.id)}if(f===!0&&y.index!==h){const T=this.get(h).buffer,M=h.array instanceof Uint16Array?$y.Uint16:$y.Uint32;v.setIndexBuffer(T,M),y.index=h}const S=e.getVertexBuffers();for(let T=0,M=S.length;T<M;T++){const C=S[T];if(y.attributes[T]!==C){const w=this.get(C).buffer;v.setVertexBuffer(T,w),y.attributes[T]=C}}r.stencil===!0&&s.stencilWrite===!0&&l.currentStencilRef!==s.stencilRef&&(v.setStencilReference(s.stencilRef),l.currentStencilRef=s.stencilRef)},x=(v,y)=>{if(g(v,y),n.isBatchedMesh===!0){const b=n._multiDrawStarts,S=n._multiDrawCounts,T=n._multiDrawCount,M=n._multiDrawInstances;M!==null&&oi("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let C=0;C<T;C++){const w=M?M[C]:1,N=w>1?0:C;f===!0?v.drawIndexed(S[C],w,b[C]/h.array.BYTES_PER_ELEMENT,0,N):v.draw(S[C],w,b[C],N),t.update(n,S[C],w)}}else if(f===!0){const{vertexCount:b,instanceCount:S,firstVertex:T}=m,M=e.getIndirect();if(M!==null){const C=this.get(M).buffer,w=e.getIndirectOffset(),N=Array.isArray(w)?w:[w];for(let E=0;E<N.length;E++)v.drawIndexedIndirect(C,N[E])}else v.drawIndexed(b,S,T,0,0);t.update(n,b,S)}else{const{vertexCount:b,instanceCount:S,firstVertex:T}=m,M=e.getIndirect();if(M!==null){const C=this.get(M).buffer,w=e.getIndirectOffset(),N=Array.isArray(w)?w:[w];for(let E=0;E<N.length;E++)v.drawIndirect(C,N[E])}else v.draw(b,S,T,0);t.update(n,b,S)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const v=this.get(e.camera),y=e.camera.cameras,b=e.getBindingGroup("cameraIndex");if(v.indexesGPU===void 0||v.indexesGPU.length!==y.length){const T=this.get(b),M=[],C=new Uint32Array([0,0,0,0]);for(let w=0,N=y.length;w<N;w++){C[0]=w;const{layoutGPU:E}=T.layout,B=this.bindingUtils.createBindGroupIndex(C,E);M.push(B)}v.indexesGPU=M}const S=this.renderer.getPixelRatio();for(let T=0,M=y.length;T<M;T++){const C=y[T];if(n.layers.test(C.layers)){const w=C.viewport;let N=l.currentPass,E=l.currentSets;if(l.bundleEncoders){const B=l.bundleEncoders[T],U=l.bundleSets[T];N=B,E=U}w&&N.setViewport(Math.floor(w.x*S),Math.floor(w.y*S),Math.floor(w.width*S),Math.floor(w.height*S),r.viewportValue.minDepth,r.viewportValue.maxDepth),b&&v.indexesGPU&&(N.setBindGroup(b.index,v.indexesGPU[T]),E.bindingGroups[b.index]=b.id),x(N,E)}}}else if(l.currentPass){if(l.occlusionQuerySet!==void 0){const v=l.lastOcclusionObject;v!==n&&(v!==null&&v.occlusionTest===!0&&(l.currentPass.endOcclusionQuery(),l.occlusionQueryIndex++),n.occlusionTest===!0&&(l.currentPass.beginOcclusionQuery(l.occlusionQueryIndex),l.occlusionQueryObjects[l.occlusionQueryIndex]=n),l.lastOcclusionObject=n)}x(l.currentPass,l.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:n,material:s}=e,r=this.utils,a=r.getSampleCountRenderContext(e.context),o=r.getCurrentColorSpace(e.context),l=r.getCurrentColorFormat(e.context),c=r.getCurrentDepthStencilFormat(e.context),u=r.getPrimitiveTopology(n,s);let h=!1;return(t.material!==s||t.materialVersion!==s.version||t.transparent!==s.transparent||t.blending!==s.blending||t.premultipliedAlpha!==s.premultipliedAlpha||t.blendSrc!==s.blendSrc||t.blendDst!==s.blendDst||t.blendEquation!==s.blendEquation||t.blendSrcAlpha!==s.blendSrcAlpha||t.blendDstAlpha!==s.blendDstAlpha||t.blendEquationAlpha!==s.blendEquationAlpha||t.colorWrite!==s.colorWrite||t.depthWrite!==s.depthWrite||t.depthTest!==s.depthTest||t.depthFunc!==s.depthFunc||t.stencilWrite!==s.stencilWrite||t.stencilFunc!==s.stencilFunc||t.stencilFail!==s.stencilFail||t.stencilZFail!==s.stencilZFail||t.stencilZPass!==s.stencilZPass||t.stencilFuncMask!==s.stencilFuncMask||t.stencilWriteMask!==s.stencilWriteMask||t.side!==s.side||t.alphaToCoverage!==s.alphaToCoverage||t.sampleCount!==a||t.colorSpace!==o||t.colorFormat!==l||t.depthStencilFormat!==c||t.primitiveTopology!==u||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=s,t.materialVersion=s.version,t.transparent=s.transparent,t.blending=s.blending,t.premultipliedAlpha=s.premultipliedAlpha,t.blendSrc=s.blendSrc,t.blendDst=s.blendDst,t.blendEquation=s.blendEquation,t.blendSrcAlpha=s.blendSrcAlpha,t.blendDstAlpha=s.blendDstAlpha,t.blendEquationAlpha=s.blendEquationAlpha,t.colorWrite=s.colorWrite,t.depthWrite=s.depthWrite,t.depthTest=s.depthTest,t.depthFunc=s.depthFunc,t.stencilWrite=s.stencilWrite,t.stencilFunc=s.stencilFunc,t.stencilFail=s.stencilFail,t.stencilZFail=s.stencilZFail,t.stencilZPass=s.stencilZPass,t.stencilFuncMask=s.stencilFuncMask,t.stencilWriteMask=s.stencilWriteMask,t.side=s.side,t.alphaToCoverage=s.alphaToCoverage,t.sampleCount=a,t.colorSpace=o,t.colorFormat=l,t.depthStencilFormat=c,t.primitiveTopology=u,t.clippingContextCacheKey=e.clippingContextCacheKey,h=!0),h}getRenderCacheKey(e){const{object:t,material:n}=e,s=this.utils,r=e.context,a=t.isMesh&&t.matrixWorld.determinant()<0;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,a,s.getSampleCountRenderContext(r),s.getCurrentColorSpace(r),s.getCurrentColorFormat(r),s.getCurrentDepthStencilFormat(r),s.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,n,s,r,a){return this.textureUtils.copyTextureToBuffer(e,t,n,s,r,a)}initTimestampQuery(e,t,n){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new Cpe(this.device,e,2048));const s=this.timestampQueryPool[e],r=s.allocateQueriesForContext(t);n.timestampWrites={querySet:s.querySet,beginningOfPassWriteIndex:r,endOfPassWriteIndex:r+1}}createNodeBuilder(e,t){return new _pe(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),r=n.currentPass.finish();this.get(t).bundleGPU=r,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,s){this.bindingUtils.createBindings(e,t,n,s)}updateBindings(e,t,n,s){this.bindingUtils.createBindings(e,t,n,s)}updateBinding(e){this.bindingUtils.updateBinding(e)}deleteBindGroupData(e){this.bindingUtils.deleteBindGroupData(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return I5[e]!==void 0&&(e=I5[e]),this.device.features.has(e)}copyTextureToTexture(e,t,n=null,s=null,r=0,a=0){let o=0,l=0,c=0,u=0,h=0,f=0,m=e.image.width,g=e.image.height,x=1;n!==null&&(n.isBox3===!0?(u=n.min.x,h=n.min.y,f=n.min.z,m=n.max.x-n.min.x,g=n.max.y-n.min.y,x=n.max.z-n.min.z):(u=n.min.x,h=n.min.y,m=n.max.x-n.min.x,g=n.max.y-n.min.y,x=1)),s!==null&&(o=s.x,l=s.y,c=s.z||0);const v=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),y=this.get(e).texture,b=this.get(t).texture;v.copyTextureToTexture({texture:y,mipLevel:r,origin:{x:u,y:h,z:f}},{texture:b,mipLevel:a,origin:{x:o,y:l,z:c}},[m,g,x]),this.device.queue.submit([v.finish()]),a===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,n){const s=this.get(t);let r=null;t.renderTarget?e.isDepthTexture?r=this.get(t.depthTexture).texture:r=this.get(t.textures[0]).texture:e.isDepthTexture?r=this.textureUtils.getDepthBuffer(t.depth,t.stencil):r=this.context.getCurrentTexture();const a=this.get(e).texture;if(r.format!==a.format){De("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",r.format,a.format);return}let o;if(s.currentPass?(s.currentPass.end(),o=s.encoder):o=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),o.copyTextureToTexture({texture:r,origin:[n.x,n.y,0]},{texture:a},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,o),s.currentPass){const{descriptor:l}=s;for(let c=0;c<l.colorAttachments.length;c++)l.colorAttachments[c].loadOp=fi.Load;t.depth&&(l.depthStencilAttachment.depthLoadOp=fi.Load),t.stencil&&(l.depthStencilAttachment.stencilLoadOp=fi.Load),s.currentPass=o.beginRenderPass(l),s.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([o.finish()])}dispose(){if(this.bindingUtils.dispose(),this.textureUtils.dispose(),this.occludedResolveCache){for(const e of this.occludedResolveCache.values())e.destroy();this.occludedResolveCache.clear()}if(this.timestampQueryPool)for(const e of Object.values(this.timestampQueryPool))e!==null&&e.dispose();this.parameters.device===void 0&&this.device!==null&&this.device.destroy()}}class yK extends Mg{constructor(e,t,n,s,r,a){super(e,t,n,s,r,a),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class xK extends Mg{constructor(e,t,n,s,r,a){super(e,t,n,s,r,a),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class Rpe extends sK{constructor(){super(),this.addMaterial(oj,"MeshPhongMaterial"),this.addMaterial(SP,"MeshStandardMaterial"),this.addMaterial(tw,"MeshPhysicalMaterial"),this.addMaterial(Sj,"MeshToonMaterial"),this.addMaterial(gP,"MeshBasicMaterial"),this.addMaterial(aj,"MeshLambertMaterial"),this.addMaterial(tj,"MeshNormalMaterial"),this.addMaterial(Aj,"MeshMatcapMaterial"),this.addMaterial(Jq,"LineBasicMaterial"),this.addMaterial(Qq,"LineDashedMaterial"),this.addMaterial(Ej,"PointsMaterial"),this.addMaterial(TP,"SpriteMaterial"),this.addMaterial(Cj,"ShadowMaterial"),this.addLight(PY,JS),this.addLight(KY,ng),this.addLight(ZY,bC),this.addLight(dw,Mg),this.addLight($Y,vC),this.addLight(eK,_C),this.addLight(tK,TC),this.addLight(JY,yK),this.addLight(QY,xK),this.addToneMapping(iY,yx),this.addToneMapping(sY,xx),this.addToneMapping(rY,_x),this.addToneMapping(aY,pg),this.addToneMapping(oY,vx),this.addToneMapping(lY,bx)}}class _K extends Lfe{constructor(e={}){let t;e.forceWebGL?t=R5:(t=wpe,e.getFallback=()=>(Se("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new R5(e)));const n=new t(e);super(n,e),this.library=new Rpe,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}class Npe extends ao{constructor(){super(),this.isBundleGroup=!0,this.type="BundleGroup",this.static=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}}class vK{constructor(e,t=It(0,0,1,1)){this.renderer=e,this.outputNode=t,this.outputColorTransform=!0,this.needsUpdate=!0;const n=new Tn;n.name="PostProcessing",this._quadMesh=new Aa(n),this._quadMesh.name="Post-Processing",this._context=null}render(){const e=this.renderer;this._update(),this._context.onBeforePostProcessing!==null&&this._context.onBeforePostProcessing();const t=e.toneMapping,n=e.outputColorSpace;e.toneMapping=Ki,e.outputColorSpace=en.workingColorSpace;const s=e.xr.enabled;e.xr.enabled=!1,this._quadMesh.render(e),e.xr.enabled=s,e.toneMapping=t,e.outputColorSpace=n,this._context.onAfterPostProcessing!==null&&this._context.onAfterPostProcessing()}get context(){return this._context}dispose(){this._quadMesh.material.dispose()}_update(){if(this.needsUpdate===!0){const e=this.renderer,t=e.toneMapping,n=e.outputColorSpace,s={postProcessing:this,onBeforePostProcessing:null,onAfterPostProcessing:null};let r=this.outputNode;this.outputColorTransform===!0?(r=r.context(s),r=WI(r,t,n)):(s.toneMapping=t,s.outputColorSpace=n,r=r.context(s)),this._context=s,this._quadMesh.material.fragmentNode=r,this._quadMesh.material.needsUpdate=!0,this.needsUpdate=!1}}async renderAsync(){oi('PostProcessing: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.renderer.init(),this.render()}}class Bpe extends In{constructor(e=1,t=1){super(),this.image={width:e,height:t},this.magFilter=Jt,this.minFilter=Jt,this.isStorageTexture=!0,this.mipmapsAutoUpdate=!0}setSize(e,t){(this.image.width!==e||this.image.height!==t)&&(this.image.width=e,this.image.height=t,this.dispose())}}class Dpe extends In{constructor(e=1,t=1,n=1){super(),this.isArrayTexture=!1,this.image={width:e,height:t,depth:n},this.magFilter=Jt,this.minFilter=Jt,this.wrapR=ui,this.isStorageTexture=!0,this.is3DTexture=!0}setSize(e,t,n){(this.image.width!==e||this.image.height!==t||this.image.depth!==n)&&(this.image.width=e,this.image.height=t,this.image.depth=n,this.dispose())}}class Lpe extends In{constructor(e=1,t=1,n=1){super(),this.isArrayTexture=!0,this.image={width:e,height:t,depth:n},this.magFilter=Jt,this.minFilter=Jt,this.isStorageTexture=!0}setSize(e,t,n){(this.image.width!==e||this.image.height!==t||this.image.depth!==n)&&(this.image.width=e,this.image.height=t,this.image.depth=n,this.dispose())}}class Upe extends NP{constructor(e,t){super(e,t,Uint32Array),this.isIndirectStorageBufferAttribute=!0}}class bK extends fr{constructor(e){super(e),this.textures={},this.nodes={}}load(e,t,n,s){const r=new cr(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,a=>{try{t(this.parse(JSON.parse(a)))}catch(o){s?s(o):De(o),this.manager.itemError(e)}},n,s)}parseNodes(e){const t={};if(e!==void 0){for(const s of e){const{uuid:r,type:a}=s;t[r]=this.createNodeFromType(a),t[r].uuid=r}const n={nodes:t,textures:this.textures};for(const s of e)s.meta=n,t[s.uuid].deserialize(s),delete s.meta}return t}parse(e){const t=this.createNodeFromType(e.type);t.uuid=e.uuid;const s={nodes:this.parseNodes(e.nodes),textures:this.textures};return e.meta=s,t.deserialize(e),delete e.meta,t}setTextures(e){return this.textures=e,this}setNodes(e){return this.nodes=e,this}createNodeFromType(e){return this.nodes[e]===void 0?(De("NodeLoader: Node type not found:",e),W()):new this.nodes[e]}}class SK extends Ux{constructor(e){super(e),this.nodes={},this.nodeMaterials={}}parse(e){const t=super.parse(e),n=this.nodes,s=e.inputNodes;for(const r in s){const a=s[r];t[r]=n[a]}return t}setNodes(e){return this.nodes=e,this}setNodeMaterials(e){return this.nodeMaterials=e,this}createMaterialFromType(e){const t=this.nodeMaterials[e];return t!==void 0?new t:super.createMaterialFromType(e)}}class Ipe extends zU{constructor(e){super(e),this.nodes={},this.nodeMaterials={},this._nodesJSON=null}setNodes(e){return this.nodes=e,this}setNodeMaterials(e){return this.nodeMaterials=e,this}parse(e,t){this._nodesJSON=e.nodes;const n=super.parse(e,t);return this._nodesJSON=null,n}parseNodes(e,t){if(e!==void 0){const n=new bK;return n.setNodes(this.nodes),n.setTextures(t),n.parseNodes(e)}return{}}parseMaterials(e,t){const n={};if(e!==void 0){const s=this.parseNodes(this._nodesJSON,t),r=new SK;r.setTextures(t),r.setNodes(s),r.setNodeMaterials(this.nodeMaterials);for(let a=0,o=e.length;a<o;a++){const l=e[a];n[l.uuid]=r.parse(l)}}return n}}class Ppe extends ao{constructor(){super(),this.isClippingGroup=!0,this.clippingPlanes=[],this.enabled=!0,this.clipIntersection=!1,this.clipShadows=!1}}const Ope=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:pg,AONode:Fq,AddEquation:Mr,AddOperation:HE,AdditiveAnimationBlendMode:WE,AdditiveBlending:hf,AgXToneMapping:vx,AlphaFormat:_S,AlwaysCompare:MS,AlwaysDepth:Gm,AlwaysStencilFunc:bb,AmbientLight:vC,AmbientLightNode:$Y,AnalyticLightNode:rp,AnimationAction:qU,AnimationClip:tg,AnimationLoader:j9,AnimationMixer:tW,AnimationObjectGroup:eW,AnimationUtils:q9,ArcCurve:MU,ArrayCamera:MC,ArrayElementNode:tp,ArrayNode:OD,ArrowHelper:TW,AssignNode:qW,AttachedBindMode:NM,AttributeNode:XI,Audio:HU,AudioAnalyser:$9,AudioContext:AC,AudioListener:J9,AudioLoader:K9,AxesHelper:AW,BackSide:hi,BasicDepthPacking:$L,BasicEnvironmentNode:ZC,BasicShadowMap:FE,BatchNode:Bq,BatchedMesh:bU,BitcastNode:zx,Bone:LS,BooleanKeyframeTrack:Jf,Box2:cW,Box3:Br,Box3Helper:bW,BoxGeometry:Su,BoxHelper:vW,BufferAttribute:Nn,BufferAttributeNode:qu,BufferGeometry:pn,BufferGeometryLoader:GU,BufferNode:WC,BumpMapNode:JX,BundleGroup:Npe,BypassNode:lX,ByteType:$c,Cache:gc,Camera:Cx,CameraHelper:_W,CanvasTarget:KP,CanvasTexture:TU,CapsuleGeometry:PS,CatmullRomCurve3:CU,CineonToneMapping:_x,CircleGeometry:OS,ClampToEdgeWrapping:ui,ClippingGroup:Ppe,Clock:EC,CodeNode:rr,Color:Ye,ColorKeyframeTrack:xC,ColorManagement:en,ColorSpaceNode:zC,CompressedArrayTexture:G9,CompressedCubeTexture:z9,CompressedTexture:IS,CompressedTextureLoader:Y9,ComputeNode:sX,ConeGeometry:Bx,ConstNode:ol,ConstantAlphaFactor:XL,ConstantColorFactor:kL,ContextNode:OI,Controls:EW,ConvertNode:nI,CubeCamera:ZE,CubeDepthTexture:tC,CubeReflectionMapping:Sa,CubeRefractionMapping:el,CubeTexture:Gh,CubeTextureLoader:PU,CubeTextureNode:PX,CubeUVReflectionMapping:du,CubicBezierCurve:iC,CubicBezierCurve3:wU,CubicInterpolant:LU,CullFaceBack:gb,CullFaceFront:OE,CullFaceFrontBack:c9,CullFaceNone:PE,Curve:Jl,CurvePath:NU,CustomBlending:nf,CustomToneMapping:kE,CylinderGeometry:bg,Cylindrical:lW,Data3DTexture:ES,DataArrayTexture:Ex,DataTexture:_a,DataTextureLoader:ZS,DataUtils:Ll,DebugNode:pX,DecrementStencilOp:sU,DecrementWrapStencilOp:aU,DefaultLoadingManager:lm,DepthFormat:lr,DepthStencilFormat:kr,DepthTexture:tr,DetachedBindMode:jL,DirectionalLight:ng,DirectionalLightHelper:xW,DirectionalLightNode:KY,DiscreteInterpolant:UU,DodecahedronGeometry:FS,DoubleSide:Ps,DstAlphaFactor:pS,DstColorFactor:gS,DynamicCopyUsage:b9,DynamicDrawUsage:hh,DynamicReadUsage:x9,EdgesGeometry:AU,EllipseCurve:GS,EnvironmentNode:bj,EqualCompare:SS,EqualDepth:Vm,EqualStencilFunc:uU,EquirectangularReflectionMapping:_c,EquirectangularRefractionMapping:wh,Euler:Lr,EventDispatcher:Ta,EventNode:Wa,ExpressionNode:kv,ExternalTexture:nC,ExtrudeGeometry:zS,FileLoader:cr,Float16BufferAttribute:KE,Float32BufferAttribute:qt,FloatType:Rn,Fog:BS,FogExp2:NS,FramebufferTexture:US,FrontFacingNode:MX,FrontSide:jr,Frustum:zh,FrustumArray:Rx,FunctionCallNode:YW,FunctionNode:DP,FunctionOverloadingNode:Gj,GLBufferAttribute:aW,GLSL1:T9,GLSL3:BM,GLSLNodeParser:iK,GreaterCompare:TS,GreaterDepth:km,GreaterEqualCompare:_g,GreaterEqualDepth:Hm,GreaterEqualStencilFunc:pU,GreaterStencilFunc:dU,GridHelper:gW,Group:ao,HalfFloatType:ln,HemisphereLight:_C,HemisphereLightHelper:mW,HemisphereLightNode:eK,IESSpotLight:yK,IESSpotLightNode:JY,IcosahedronGeometry:Dx,ImageBitmapLoader:VU,ImageLoader:Yy,ImageUtils:xU,IncrementStencilOp:iU,IncrementWrapStencilOp:rU,IndexNode:Wi,IndirectStorageBufferAttribute:Upe,InspectorBase:kC,InstanceNode:oP,InstancedBufferAttribute:Yr,InstancedBufferGeometry:FU,InstancedInterleavedBuffer:jU,InstancedMesh:QE,InstancedMeshNode:Rq,Int16BufferAttribute:L9,Int32BufferAttribute:U9,Int8BufferAttribute:N9,IntType:Is,InterleavedBuffer:vg,InterleavedBufferAttribute:pu,Interpolant:Ag,InterpolateDiscrete:Km,InterpolateLinear:Zm,InterpolateSmooth:Uv,InterpolationSamplingMode:M9,InterpolationSamplingType:A9,InvertStencilOp:oU,IrradianceNode:Vq,IsolateNode:aX,JoinNode:DW,KeepStencilOp:Zu,KeyframeTrack:al,LOD:vU,LatheGeometry:VS,Layers:$m,LessCompare:yg,LessDepth:zm,LessEqualCompare:xg,LessEqualDepth:uu,LessEqualStencilFunc:hU,LessStencilFunc:cU,Light:Hh,LightProbe:TC,LightProbeNode:tK,Lighting:rK,LightingContextNode:Gq,LightingModel:Gx,LightingNode:Rg,LightsNode:lw,Line:mu,Line2NodeMaterial:zae,Line3:uW,LineBasicMaterial:Ir,LineBasicNodeMaterial:Jq,LineCurve:sC,LineCurve3:RU,LineDashedMaterial:YS,LineDashedNodeMaterial:Qq,LineLoop:$E,LineSegments:Zl,LinearFilter:Jt,LinearInterpolant:yC,LinearMipMapLinearFilter:yb,LinearMipMapNearestFilter:d9,LinearMipmapLinearFilter:$s,LinearMipmapNearestFilter:Qc,LinearSRGBColorSpace:Jr,LinearToneMapping:yx,LinearTransfer:Of,Loader:fr,LoaderUtils:xh,LoadingManager:KS,LoopNode:Uq,LoopOnce:KL,LoopPingPong:JL,LoopRepeat:ZL,MOUSE:Td,MRTNode:Ij,Material:Es,MaterialLoader:Ux,MaterialNode:Fe,MaterialReferenceNode:OX,MathUtils:Fh,Matrix2:Ix,Matrix3:gn,Matrix4:Lt,MaxEquation:zE,MaxMipLevelNode:xX,MemberNode:UW,Mesh:Kn,MeshBasicMaterial:Ts,MeshBasicNodeMaterial:gP,MeshDepthMaterial:pC,MeshDistanceMaterial:mC,MeshLambertMaterial:fC,MeshLambertNodeMaterial:aj,MeshMatcapMaterial:gC,MeshMatcapNodeMaterial:Aj,MeshNormalMaterial:dC,MeshNormalNodeMaterial:tj,MeshPhongMaterial:uC,MeshPhongNodeMaterial:oj,MeshPhysicalMaterial:yo,MeshPhysicalNodeMaterial:tw,MeshSSSNodeMaterial:Goe,MeshStandardMaterial:Tg,MeshStandardNodeMaterial:SP,MeshToonMaterial:hC,MeshToonNodeMaterial:Sj,MinEquation:GE,MirroredRepeatWrapping:vc,MixOperation:VE,ModelNode:il,MorphNode:Pq,MultiplyBlending:Ch,MultiplyOperation:fg,NearestFilter:$n,NearestMipMapLinearFilter:h9,NearestMipMapNearestFilter:u9,NearestMipmapLinearFilter:Ho,NearestMipmapNearestFilter:mg,NeutralToneMapping:bx,NeverCompare:bS,NeverDepth:Fm,NeverStencilFunc:lU,NoBlending:Nr,NoColorSpace:ha,NoNormalPacking:Iv,NoToneMapping:Ki,Node:Gt,NodeAccess:wr,NodeAttribute:e3,NodeBuilder:jP,NodeCache:jA,NodeCode:YY,NodeFrame:t3,NodeFunctionInput:hw,NodeLoader:bK,NodeMaterial:Tn,NodeMaterialLoader:SK,NodeMaterialObserver:wW,NodeObjectLoader:Ipe,NodeShaderStage:iy,NodeType:BW,NodeUniform:qY,NodeUpdateType:on,NodeUtils:Vse,NodeVar:qP,NodeVarying:jY,NormalAnimationBlendMode:vS,NormalBlending:qa,NormalGAPacking:eU,NormalMapNode:ZX,NormalRGPacking:jE,NotEqualCompare:AS,NotEqualDepth:Wm,NotEqualStencilFunc:fU,NumberKeyframeTrack:Gf,Object3D:Fn,Object3DNode:Ln,ObjectLoader:zU,ObjectSpaceNormalMap:qE,OctahedronGeometry:Lx,OneFactor:hS,OneMinusConstantAlphaFactor:qL,OneMinusConstantColorFactor:WL,OneMinusDstAlphaFactor:mS,OneMinusDstColorFactor:yS,OneMinusSrcAlphaFactor:Om,OneMinusSrcColorFactor:fS,OrthographicCamera:Dr,OutputStructNode:EP,PCFShadowMap:tf,PCFSoftShadowMap:gy,PMREMGenerator:_j,PMREMNode:vj,ParameterNode:MP,PassNode:Mc,Path:Tb,PerspectiveCamera:Ci,PhongLightingModel:yP,PhysicalLightingModel:QC,Plane:El,PlaneGeometry:Cc,PlaneHelper:SW,PointLight:JS,PointLightHelper:pW,PointLightNode:PY,PointUVNode:qj,Points:eC,PointsMaterial:Nx,PointsNodeMaterial:Ej,PolarGridHelper:yW,PolyhedronGeometry:Vh,PositionalAudio:Q9,PostProcessing:vK,PosterizeNode:eY,ProjectorLight:xK,ProjectorLightNode:QY,PropertyBinding:qn,PropertyMixer:kU,PropertyNode:ni,QuadMesh:Aa,QuadraticBezierCurve:rC,QuadraticBezierCurve3:aC,Quaternion:Fs,QuaternionKeyframeTrack:zf,QuaternionLinearInterpolant:IU,R11_EAC_Format:gf,RED_GREEN_RGTC2_Format:Nh,RED_RGTC1_Format:Uf,REVISION:bu,RG11_EAC_Format:Rh,RGBADepthPacking:f9,RGBAFormat:ii,RGBAIntegerFormat:Kf,RGBA_ASTC_10x10_Format:Nf,RGBA_ASTC_10x5_Format:Cf,RGBA_ASTC_10x6_Format:wf,RGBA_ASTC_10x8_Format:Rf,RGBA_ASTC_12x10_Format:Bf,RGBA_ASTC_12x12_Format:Df,RGBA_ASTC_4x4_Format:_f,RGBA_ASTC_5x4_Format:vf,RGBA_ASTC_5x5_Format:bf,RGBA_ASTC_6x5_Format:Sf,RGBA_ASTC_6x6_Format:Tf,RGBA_ASTC_8x5_Format:Af,RGBA_ASTC_8x6_Format:Mf,RGBA_ASTC_8x8_Format:Ef,RGBA_BPTC_Format:Lf,RGBA_ETC2_EAC_Format:mf,RGBA_PVRTC_2BPPV1_Format:Ym,RGBA_PVRTC_4BPPV1_Format:jm,RGBA_S3TC_DXT1_Format:nu,RGBA_S3TC_DXT3_Format:iu,RGBA_S3TC_DXT5_Format:su,RGBDepthPacking:p9,RGBFormat:gg,RGBIntegerFormat:YL,RGB_BPTC_SIGNED_Format:xb,RGB_BPTC_UNSIGNED_Format:_b,RGB_ETC1_Format:ff,RGB_ETC2_Format:pf,RGB_PVRTC_2BPPV1_Format:qm,RGB_PVRTC_4BPPV1_Format:Xm,RGB_S3TC_DXT1_Format:tu,RGDepthPacking:m9,RGFormat:Wr,RGIntegerFormat:Yf,RTTNode:kj,RangeNode:pY,RawShaderMaterial:cC,Ray:Zf,Raycaster:YU,RectAreaLight:bC,RectAreaLightNode:ZY,RedFormat:ql,RedIntegerFormat:Oh,ReferenceNode:eT,ReflectorNode:nw,ReinhardToneMapping:xx,RemapNode:kI,RenderOutputNode:fX,RenderTarget:Si,RenderTarget3D:nW,RendererReferenceNode:$7,RendererUtils:Vs,RepeatWrapping:Zr,ReplaceStencilOp:nU,ReverseSubtractEquation:uS,RingGeometry:HS,RotateNode:Mj,SIGNED_R11_EAC_Format:yf,SIGNED_RED_GREEN_RGTC2_Format:Pf,SIGNED_RED_RGTC1_Format:If,SIGNED_RG11_EAC_Format:xf,SRGBColorSpace:Js,SRGBTransfer:Ft,Scene:fu,SceneNode:Xa,ScreenNode:Li,ScriptableNode:dY,ScriptableValueNode:uY,SetNode:LW,ShaderMaterial:Za,ShadowBaseNode:yY,ShadowMaterial:lC,ShadowNode:HP,ShadowNodeMaterial:Cj,Shape:sf,ShapeGeometry:kS,ShapePath:MW,ShapeUtils:Ul,ShortType:eu,Skeleton:wx,SkeletonHelper:dW,SkinnedMesh:JE,SkinningNode:lP,Source:dh,Sphere:Gs,SphereGeometry:Sg,Spherical:Cb,SphericalHarmonics3:SC,SplineCurve:oC,SplitNode:iI,SpotLight:Mg,SpotLightHelper:hW,SpotLightNode:dw,Sprite:_U,SpriteMaterial:DS,SpriteNodeMaterial:TP,SpriteSheetUVNode:Vj,SrcAlphaFactor:Pm,SrcAlphaSaturateFactor:xS,SrcColorFactor:dS,StackNode:Bj,StaticCopyUsage:v9,StaticDrawUsage:Bh,StaticReadUsage:y9,StereoCamera:Z9,Storage3DTexture:Dpe,StorageArrayElementNode:Mq,StorageArrayTexture:Lpe,StorageBufferAttribute:NP,StorageBufferNode:Eq,StorageInstancedBufferAttribute:Xj,StorageTexture:Bpe,StorageTextureNode:Kj,StreamCopyUsage:S9,StreamDrawUsage:g9,StreamReadUsage:_9,StringKeyframeTrack:Qf,StructNode:Lj,StructTypeNode:Dj,SubBuildNode:q7,SubtractEquation:cS,SubtractiveBlending:df,TOUCH:Ad,TSL:D,TangentSpaceNormalMap:Vl,TempNode:ti,TetrahedronGeometry:WS,Texture:In,Texture3DNode:Jj,TextureLoader:$f,TextureNode:Tc,TextureSizeNode:yX,TextureUtils:CW,Timer:oW,TimestampQuery:ga,ToneMappingNode:tX,ToonOutlinePassNode:nY,TorusGeometry:XS,TorusKnotGeometry:qS,Triangle:Ga,TriangleFanDrawMode:vb,TriangleStripDrawMode:XE,TrianglesDrawMode:QL,TubeGeometry:jS,UVMapping:hu,Uint16BufferAttribute:CS,Uint32BufferAttribute:wS,Uint8BufferAttribute:B9,Uint8ClampedBufferAttribute:D9,Uniform:iW,UniformArrayNode:_X,UniformGroupNode:xI,UniformNode:Ox,UniformsGroup:rW,UnsignedByteType:ei,UnsignedInt101111Type:Mx,UnsignedInt248Type:ja,UnsignedInt5999Type:Ax,UnsignedIntType:Jn,UnsignedShort4444Type:Sx,UnsignedShort5551Type:Tx,UnsignedShortType:ko,UserDataNode:Qj,VSMShadowMap:Dl,VarNode:Hv,VaryingNode:j7,Vector2:Ae,Vector3:z,Vector4:un,VectorKeyframeTrack:Vf,VertexColorNode:Wq,VideoFrameTexture:F9,VideoTexture:SU,ViewportDepthNode:ka,ViewportDepthTextureNode:Hq,ViewportSharedTextureNode:$q,ViewportTextureNode:nT,VolumeNodeMaterial:Joe,WebGL3DRenderTarget:w9,WebGLArrayRenderTarget:C9,WebGLCoordinateSystem:Cr,WebGLCubeRenderTarget:RS,WebGLRenderTarget:xa,WebGPUCoordinateSystem:Ka,WebGPURenderer:_K,WebXRController:xy,WireframeGeometry:BU,WrapAroundEnding:Wy,ZeroCurvatureEnding:Fd,ZeroFactor:dc,ZeroSlopeEnding:Gd,ZeroStencilOp:tU,createCanvasElement:YE,defaultBuildStages:PM,defaultShaderStages:tI,error:De,getConsoleFunction:E9,log:Jm,setConsoleFunction:gU,shaderStages:OM,vectorComponents:ep,warn:Se,warnOnce:oi},Symbol.toStringTag,{value:"Module"}));class TK{constructor(e,t){this.uid=e,this.cid=e.match(/^(.*):f(\d+)$/)[1],this.name=t,this.timestamp=0,this.cpu=0,this.gpu=0,this.fps=0,this.children=[],this.parent=null}}class Fpe extends TK{constructor(e,t,n,s){let r=t.name;r===""&&(t.isScene?r="Scene":t.isQuadMesh&&(r="QuadMesh")),super(e,r),this.scene=t,this.camera=n,this.renderTarget=s,this.isRenderStats=!0}}class Gpe extends TK{constructor(e,t){super(e,t.name),this.computeNode=t,this.isComputeStats=!0}}class zpe extends kC{constructor(){super(),this.currentFrame=null,this.currentRender=null,this.currentNodes=null,this.lastFrame=null,this.frames=[],this.framesLib={},this.maxFrames=512,this._lastFinishTime=0,this._resolveTimestampPromise=null,this.isRendererInspector=!0}getParent(){return this.currentRender||this.getFrame()}begin(){this.currentFrame=this._createFrame(),this.currentRender=this.currentFrame,this.currentNodes=[]}finish(){const e=performance.now(),t=this.currentFrame;t.finishTime=e,t.deltaTime=e-(this._lastFinishTime>0?this._lastFinishTime:e),this.addFrame(t),this.fps=this._getFPS(),this.lastFrame=t,this.currentFrame=null,this.currentRender=null,this.currentNodes=null,this._lastFinishTime=e}_getFPS(){let e=0,t=0;for(let n=this.frames.length-1;n>=0;n--){const s=this.frames[n];if(e++,t+=s.deltaTime,t>=1e3)break}return e*1e3/t}_createFrame(){return{frameId:this.nodeFrame.frameId,resolvedCompute:!1,resolvedRender:!1,deltaTime:0,startTime:performance.now(),finishTime:0,miscellaneous:0,children:[],renders:[],computes:[]}}getFrame(){return this.currentFrame||this.lastFrame}getFrameById(e){return this.framesLib[e]||null}resolveViewer(){}resolveFrame(){}async resolveTimestamp(){return this._resolveTimestampPromise!==null?this._resolveTimestampPromise:(this._resolveTimestampPromise=new Promise(e=>{requestAnimationFrame(async()=>{const t=this.getRenderer();await t.resolveTimestampsAsync(ga.COMPUTE),await t.resolveTimestampsAsync(ga.RENDER);const n=t.backend.getTimestampFrames(ga.COMPUTE),s=t.backend.getTimestampFrames(ga.RENDER),r=[...new Set([...n,...s])];for(const a of r){const o=this.getFrameById(a);if(o!==null){if(o.resolvedCompute===!1)if(o.computes.length>0){if(n.includes(a)){for(const l of o.computes)t.backend.hasTimestamp(l.uid)?l.gpu=t.backend.getTimestamp(l.uid):(l.gpu=0,l.gpuNotAvailable=!0);o.resolvedCompute=!0}}else o.resolvedCompute=!0;if(o.resolvedRender===!1)if(o.renders.length>0){if(s.includes(a)){for(const l of o.renders)t.backend.hasTimestamp(l.uid)?l.gpu=t.backend.getTimestamp(l.uid):(l.gpu=0,l.gpuNotAvailable=!0);o.resolvedRender=!0}}else o.resolvedRender=!0;o.resolvedCompute===!0&&o.resolvedRender===!0&&this.resolveFrame(o)}}this._resolveTimestampPromise=null,e()})}),this._resolveTimestampPromise)}get isAvailable(){return this.getRenderer()!==null}addFrame(e){if(this.frames.length>=this.maxFrames){const t=this.frames.shift();delete this.framesLib[t.frameId]}this.frames.push(e),this.framesLib[e.frameId]=e,this.isAvailable&&(this.resolveViewer(),this.resolveTimestamp())}inspect(e){this.currentNodes.push(e)}beginCompute(e,t){const n=this.getFrame();if(!n)return;const s=new Gpe(e,t);s.timestamp=performance.now(),s.parent=this.currentCompute||this.getParent(),n.computes.push(s),this.currentRender!==null?this.currentRender.children.push(s):n.children.push(s),this.currentCompute=s}finishCompute(){if(!this.getFrame())return;const t=this.currentCompute;t.cpu=performance.now()-t.timestamp,this.currentCompute=t.parent.isComputeStats?t.parent:null}beginRender(e,t,n,s){const r=this.getFrame();if(!r)return;const a=new Fpe(e,t,n,s);a.timestamp=performance.now(),a.parent=this.getParent(),r.renders.push(a),this.currentRender!==null?this.currentRender.children.push(a):r.children.push(a),this.currentRender=a}finishRender(){if(!this.getFrame())return;const t=this.currentRender;t.cpu=performance.now()-t.timestamp,this.currentRender=t.parent}}class Vpe{static init(){if(document.getElementById("profiler-styles"))return;const e=`
:root {
	--profiler-bg: #1e1e24f5;
	--profiler-header-bg: #2a2a33aa;
	--profiler-header: #2a2a33;
	--profiler-border: #4a4a5a;
	--text-primary: #e0e0e0;
	--text-secondary: #9a9aab;
	--accent-color: #00aaff;
	--color-green: #4caf50;
	--color-yellow: #ffc107;
	--color-red: #f44336;
	--font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
	--font-mono: 'Fira Code', 'Courier New', Courier, monospace;
}

@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Fira+Code&display=swap');

#profiler-panel *, #profiler-toggle * {
	text-transform: initial;
	line-height: normal;
	box-sizing: border-box;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}

#profiler-toggle {
	position: fixed;
	top: 15px;
	right: 15px;
	background-color: rgba(30, 30, 36, 0.85);
	border: 1px solid #4a4a5a54;
	border-radius: 12px 6px 6px 12px;
	color: var(--text-primary);
	cursor: pointer;
	z-index: 1001;
	transition: all 0.2s ease-in-out;
	/*font-size: 14px;*/
	font-size: 15px;
	backdrop-filter: blur(8px);
	box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
	display: flex;
	align-items: stretch;
	padding: 0;
	overflow: hidden;
	font-family: var(--font-family);
}

#profiler-toggle:hover {
	border-color: var(--accent-color);
}

#profiler-toggle.hidden {
	opacity: 0;
	pointer-events: none;
}

#toggle-icon {
	display: flex;
	align-items: center;
	justify-content: center;
	width: 40px;
	font-size: 20px;
	transition: background-color 0.2s;
}

#profiler-toggle:hover #toggle-icon {
	background-color: rgba(255, 255, 255, 0.05);
}

.toggle-separator {
	width: 1px;
	background-color: var(--profiler-border);
}

#toggle-text {
	display: flex;
	align-items: baseline;
	padding: 8px 14px;
	min-width: 80px;
	justify-content: right;
}

#toggle-text .fps-label {
	font-size: 0.7em;
	margin-left: 10px;
    color: #999;
}

#builtin-tabs-container {
	display: flex;
	align-items: stretch;
	gap: 0;
	border-right: 1px solid #262636;
	order: -1;
}

.builtin-tab-btn {
	background: transparent;
	border: none;
	color: var(--text-secondary);
	cursor: pointer;
	padding: 8px 14px;
	font-family: var(--font-family);
	font-size: 13px;
	font-weight: 600;
	transition: all 0.2s;
	display: flex;
	align-items: center;
	justify-content: center;
	min-width: 32px;
	position: relative;
}

.builtin-tab-btn svg {
	width: 20px;
	height: 20px;
	stroke: currentColor;
}

.builtin-tab-btn:hover {
	background-color: rgba(255, 255, 255, 0.08);
	color: var(--accent-color);
}

.builtin-tab-btn:active {
	background-color: rgba(255, 255, 255, 0.12);
}

.builtin-tab-btn.active {
	background-color: rgba(0, 170, 255, 0.2);
	color: var(--accent-color);
}

.builtin-tab-btn.active:hover {
	background-color: rgba(0, 170, 255, 0.3);
}

#profiler-mini-panel {
	position: fixed;
	top: 60px;
	right: 15px;
	background-color: rgba(30, 30, 36, 0.85);
	border: 1px solid #4a4a5a54;
	border-radius: 8px;
	color: var(--text-primary);
	z-index: 9999;
	backdrop-filter: blur(8px);
	box-shadow: 0 6px 24px rgba(0, 0, 0, 0.5);
	font-family: var(--font-family);
	font-size: 11px;
	width: 350px;
	max-height: calc(100vh - 100px);
	overflow-y: auto;
	overflow-x: hidden;
	display: none;
	opacity: 0;
	transform: translateY(-10px) scale(0.98);
	transition: opacity 0.25s cubic-bezier(0.4, 0, 0.2, 1), 
	            transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
}

#profiler-mini-panel.visible {
	display: block;
	opacity: 1;
	transform: translateY(0) scale(1);
}

#profiler-mini-panel::-webkit-scrollbar {
	width: 6px;
}

#profiler-mini-panel::-webkit-scrollbar-track {
	background: transparent;
}

#profiler-mini-panel::-webkit-scrollbar-thumb {
	background: rgba(255, 255, 255, 0.15);
	border-radius: 3px;
	transition: background 0.2s;
}

#profiler-mini-panel::-webkit-scrollbar-thumb:hover {
	background: rgba(255, 255, 255, 0.25);
}

.mini-panel-content {
	padding: 0;
	font-size: 11px;
	line-height: 1.5;
	font-family: var(--font-mono);
	letter-spacing: 0.3px;
	user-select: none;
	-webkit-user-select: none;
}

.mini-panel-content .profiler-content {
	display: block !important;
	background: transparent;
}

.mini-panel-content .list-scroll-wrapper {
	max-height: calc(100vh - 120px);
	overflow-y: auto;
	overflow-x: hidden;
}

.mini-panel-content .list-scroll-wrapper::-webkit-scrollbar {
	width: 4px;
}

.mini-panel-content .list-scroll-wrapper::-webkit-scrollbar-track {
	background: transparent;
}

.mini-panel-content .list-scroll-wrapper::-webkit-scrollbar-thumb {
	background: rgba(255, 255, 255, 0.1);
	border-radius: 2px;
}

.mini-panel-content .list-scroll-wrapper::-webkit-scrollbar-thumb:hover {
	background: rgba(255, 255, 255, 0.2);
}

.mini-panel-content .parameters {
	background: transparent;
	border: none;
	box-shadow: none;
	padding: 4px;
}

.mini-panel-content .list-container.parameters {
	padding: 2px 6px 0px 6px !important;
}

.mini-panel-content .list-header {
	display: none;
	padding: 2px 4px;
	font-size: 11px;
	font-weight: 600;
	text-transform: uppercase;
	letter-spacing: 0.5px;
}

.mini-panel-content .list-item {
	border-bottom: 1px solid rgba(74, 74, 90, 0.2);
	transition: background-color 0.15s;
}

.mini-panel-content .list-item:last-child {
	border-bottom: none;
}

.mini-panel-content .list-item:hover {
	background-color: rgba(255, 255, 255, 0.04);
}

.mini-panel-content .list-item.actionable:hover {
	background-color: rgba(255, 255, 255, 0.06);
	cursor: pointer;
}

/* Style adjustments for lil-gui look */
.mini-panel-content .item-row {
	padding: 3px 8px;
	min-height: 24px;
}

.mini-panel-content .list-item-row {
	padding: 1px 4px;
	gap: 8px;
	min-height: 21px;
	align-items: center;
}

.mini-panel-content input[type="checkbox"] {
	width: 12px;
	height: 12px;
}

.mini-panel-content input[type="range"] {
	height: 18px;
}

.mini-panel-content .value-number input,
.mini-panel-content .value-slider input {
	background-color: rgba(0, 0, 0, 0.3);
	border: 1px solid rgba(74, 74, 90, 0.5);
	font-size: 10px;
}

.mini-panel-content .value-number input:focus,
.mini-panel-content .value-slider input:focus {
	border-color: var(--accent-color);
}

.mini-panel-content .value-slider {
	gap: 6px;
}

/* Compact nested items */
.mini-panel-content .list-item .list-item {
	margin-left: 8px;
}

.mini-panel-content .list-item .list-item .item-row,
.mini-panel-content .list-item .list-item .list-item-row {
	padding: 2px 6px;
	min-height: 22px;
}

/* Compact collapsible headers */
.mini-panel-content .collapsible .item-row,
.mini-panel-content .list-item-row.collapsible {
	padding: 2px 8px;
	font-weight: 600;
	min-height: 16px;
	display: flex;
	align-items: center;
}

.mini-panel-content .collapsible-icon {
	font-size: 10px;
	width: 14px;
	height: 14px;
}

.mini-panel-content .param-control input[type="range"] {
	height: 12px;
	margin-top: 1px;
	padding-top: 5px;
	user-select: none;
	-webkit-user-select: none;
	outline: none;
}

.mini-panel-content .param-control input[type="range"]::-webkit-slider-thumb {
	width: 14px;
	height: 14px;
	margin-top: -5px;
	user-select: none;
	-webkit-user-select: none;
}

.mini-panel-content .param-control input[type="range"]::-moz-range-thumb {
	width: 14px;
	height: 14px;
	user-select: none;
	-moz-user-select: none;
}

.mini-panel-content .list-children-container {
	padding-left: 0;
}

.mini-panel-content .param-control input[type="number"] {
	flex-basis: 60px !important;
}

.mini-panel-content .param-control {
	align-items: center;
}

.mini-panel-content .param-control select {
	font-size: 11px;
}

.mini-panel-content .list-item-wrapper {
	margin-top: 0;
	margin-bottom: 0;
}

#profiler-panel {
	position: fixed;
	z-index: 1001 !important;
	bottom: 0;
	left: 0;
	right: 0;
	height: 350px;
	background-color: var(--profiler-bg);
	backdrop-filter: blur(8px);
	border-top: 2px solid var(--profiler-border);
	color: var(--text-primary);
	display: flex;
	flex-direction: column;
	z-index: 1000;
	/*box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.5);*/
	transform: translateY(100%);
	transition: transform 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94), height 0.3s ease-out, width 0.3s ease-out;
	font-family: var(--font-mono);
}

#profiler-panel.resizing,
#profiler-panel.dragging {
	transition: none;
}

#profiler-panel.visible {
	transform: translateY(0);
}

#profiler-panel.maximized {
	height: 100vh;
}

/* Position-specific styles */
#profiler-panel.position-top {
	bottom: auto;
	top: 0;
	border-top: none;
	border-bottom: 2px solid var(--profiler-border);
	transform: translateY(-100%);
}

#profiler-panel.position-top.visible {
	transform: translateY(0);
}

#profiler-panel.position-bottom {
	/* Default position - already defined above */
}

#profiler-panel.position-left {
	top: 0;
	bottom: 0;
	left: 0;
	right: auto;
	width: 350px;
	height: 100%;
	border-top: none;
	border-right: 2px solid var(--profiler-border);
	transform: translateX(-100%);
}

#profiler-panel.position-left.visible {
	transform: translateX(0);
}

#profiler-panel.position-right {
	top: 0;
	bottom: 0;
	left: auto;
	right: 0;
	width: 350px;
	height: 100%;
	border-top: none;
	border-left: 2px solid var(--profiler-border);
	transform: translateX(100%);
}

#profiler-panel.position-right.visible {
	transform: translateX(0);
}

#profiler-panel.position-floating {
	border: 2px solid var(--profiler-border);
	border-radius: 8px;
	box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
	transform: none !important;
	overflow: hidden;
}

#profiler-panel.position-floating.visible {
	transform: none !important;
}

#profiler-panel.position-floating .profiler-header {
	border-radius: 6px 6px 0 0;
}

#profiler-panel.position-floating .panel-resizer {
	bottom: 0;
	right: 0;
	top: auto;
	left: auto;
	width: 16px;
	height: 16px;
	cursor: nwse-resize;
	border-radius: 0 0 6px 0;
}

#profiler-panel.position-floating .panel-resizer::after {
	content: '';
	position: absolute;
	right: 2px;
	bottom: 2px;
	width: 10px;
	height: 10px;
	background: linear-gradient(135deg, transparent 0%, transparent 45%, var(--profiler-border) 45%, var(--profiler-border) 55%, transparent 55%);
}


.panel-resizer {
	position: absolute;
	top: -2px;
	left: 0;
	width: 100%;
	height: 5px;
	cursor: ns-resize;
	z-index: 1001;
	touch-action: none;
}

#profiler-panel.position-top .panel-resizer {
	top: auto;
	bottom: -2px;
}

#profiler-panel.position-left .panel-resizer {
	top: 0;
	left: auto;
	right: -2px;
	width: 5px;
	height: 100%;
	cursor: ew-resize;
}

#profiler-panel.position-right .panel-resizer {
	top: 0;
	left: -2px;
	right: auto;
	width: 5px;
	height: 100%;
	cursor: ew-resize;
}

.profiler-header {
	display: flex;
	background-color: var(--profiler-header-bg);
	border-bottom: 1px solid var(--profiler-border);
	flex-shrink: 0;
	justify-content: space-between;
	align-items: stretch;

	overflow-x: auto;
	overflow-y: hidden;
	width: calc(100% - 134px);
	height: 38px;
	user-select: none;
	-webkit-user-select: none;
}

/* Adjust header width based on panel position */
#profiler-panel.position-right .profiler-header,
#profiler-panel.position-left .profiler-header {
	width: calc(100% - 134px);
}

#profiler-panel.position-bottom .profiler-header,
#profiler-panel.position-top .profiler-header {
	width: calc(100% - 134px);
}

/* Adjust header width when position toggle button is hidden (mobile) */
#profiler-panel.hide-position-toggle .profiler-header {
	width: calc(100% - 90px);
}

/* ===== RULES FOR WHEN THERE ARE NO TABS ===== */

/* Horizontal mode (bottom/top) without tabs */
#profiler-panel.position-bottom.no-tabs:not(.maximized),
#profiler-panel.position-top.no-tabs:not(.maximized) {
	height: 38px !important;
	min-height: 38px !important;
}

#profiler-panel.position-bottom.no-tabs .profiler-header,
#profiler-panel.position-top.no-tabs .profiler-header {
	width: 100%;
	height: 38px;
	border-bottom: none;
}

#profiler-panel.position-bottom.no-tabs .profiler-content-wrapper,
#profiler-panel.position-top.no-tabs .profiler-content-wrapper {
	display: none;
}

#profiler-panel.position-bottom.no-tabs .panel-resizer,
#profiler-panel.position-top.no-tabs .panel-resizer {
	display: none;
}

/* Vertical mode (right/left) without tabs */
#profiler-panel.position-right.no-tabs:not(.maximized),
#profiler-panel.position-left.no-tabs:not(.maximized) {
	width: 45px !important;
	min-width: 45px !important;
}

/* Vertical layout for header when no tabs */
#profiler-panel.position-right.no-tabs .profiler-header,
#profiler-panel.position-left.no-tabs .profiler-header {
	width: 100%;
	flex-direction: column;
	height: 100%;
	border-bottom: none;
}

/* Vertical layout for controls when no tabs */
#profiler-panel.position-right.no-tabs .profiler-controls,
#profiler-panel.position-left.no-tabs .profiler-controls {
	position: static;
	flex-direction: column-reverse;
	justify-content: flex-end;
	width: 100%;
	height: 100%;
	border-bottom: none;
	border-left: none;
	background: transparent;
}

#profiler-panel.position-right.no-tabs .profiler-controls button,
#profiler-panel.position-left.no-tabs .profiler-controls button {
	width: 100%;
	height: 45px;
	border-left: none;
	border-top: none;
	border-bottom: 1px solid var(--profiler-border);
}

#profiler-panel.position-right.no-tabs .profiler-content-wrapper,
#profiler-panel.position-left.no-tabs .profiler-content-wrapper {
	display: none;
}

#profiler-panel.position-right.no-tabs .profiler-tabs,
#profiler-panel.position-left.no-tabs .profiler-tabs {
	display: none;
}

#profiler-panel.position-right.no-tabs .panel-resizer,
#profiler-panel.position-left.no-tabs .panel-resizer {
	display: none;
}

/* Hide position toggle on mobile without tabs */
#profiler-panel.hide-position-toggle.position-right.no-tabs:not(.maximized),
#profiler-panel.hide-position-toggle.position-left.no-tabs:not(.maximized) {
	width: 45px !important;
	min-width: 45px !important;
}

/* Hide drag indicator on mobile devices */
#profiler-panel.hide-position-toggle .tab-btn.active::before {
	display: none;
}

.profiler-header::-webkit-scrollbar {
	width: 8px;
	height: 8px;
}

.profiler-header::-webkit-scrollbar-track {
	background: transparent;
}

.profiler-header::-webkit-scrollbar-thumb {
	background-color: rgba(0, 0, 0, 0.25);
	border-radius: 10px;
	transition: background 0.3s ease;
}

.profiler-header::-webkit-scrollbar-thumb:hover {
	background-color: rgba(0, 0, 0, 0.4);
}

.profiler-header::-webkit-scrollbar-corner {
	background: transparent;
}

#profiler-panel.dragging .profiler-header {
	cursor: grabbing !important;
}

#profiler-panel.dragging {
	opacity: 0.8;
}

.profiler-tabs {
	display: flex;
	cursor: grab;
	position: relative;
}

.profiler-tabs:active {
	cursor: grabbing;
}

.profiler-tabs::-webkit-scrollbar {
	width: 8px;
	height: 8px;
}

.profiler-tabs::-webkit-scrollbar-track {
	background: transparent;
}

.profiler-tabs::-webkit-scrollbar-thumb {
	background-color: rgba(0, 0, 0, 0.25);
	border-radius: 10px;
	transition: background 0.3s ease;
}

.profiler-tabs::-webkit-scrollbar-thumb:hover {
	background-color: rgba(0, 0, 0, 0.4);
}

.profiler-tabs::-webkit-scrollbar-corner {
	background: transparent;
}

.profiler-controls {
	display: flex;
	position: absolute;
	right: 0;
	top: 0;
	height: 38px;
	background: var(--profiler-header-bg);
	border-bottom: 1px solid var(--profiler-border);
}

.tab-btn {
	position: relative;
	background: transparent;
	border: none;
	/*border-right: 1px solid var(--profiler-border);*/
	color: var(--text-secondary);
	padding: 8px 18px;
	cursor: default;
	display: flex;
	align-items: center;
	font-family: var(--font-family);
	font-weight: 600;
	font-size: 14px;
	user-select: none;
	transition: opacity 0.2s, transform 0.2s;
	touch-action: none;
}

.tab-btn.active {
	border-bottom: 2px solid var(--accent-color);
	color: white;
}

.tab-btn.active::before {
	content: '';
	position: absolute;
	left: 3px;
	top: calc(50% - 2px);
	transform: translateY(-50%);
	color: var(--profiler-border);
	font-size: 18px;
	letter-spacing: -2px;
	opacity: 0.6;
}

.tab-btn.no-detach.active::before {
	display: none;
}

#floating-btn,
#maximize-btn,
#hide-panel-btn {
	background: transparent;
	border: none;
	border-left: 1px solid var(--profiler-border);
	color: var(--text-secondary);
	width: 45px;
	height: 100%;
	cursor: pointer;
	transition: all 0.2s;
	display: flex;
	align-items: center;
	justify-content: center;
	flex-shrink: 0;
}

/* Disable transitions in vertical mode to avoid broken animations */
#profiler-panel.position-right #floating-btn,
#profiler-panel.position-right #maximize-btn,
#profiler-panel.position-right #hide-panel-btn,
#profiler-panel.position-left #floating-btn,
#profiler-panel.position-left #maximize-btn,
#profiler-panel.position-left #hide-panel-btn {
	transition: background-color 0.2s, color 0.2s;
}

#floating-btn:hover,
#maximize-btn:hover,
#hide-panel-btn:hover {
	background-color: rgba(255, 255, 255, 0.1);
	color: var(--text-primary);
}

/* Hide maximize button when there are no tabs */
#profiler-panel.position-right.no-tabs #maximize-btn,
#profiler-panel.position-left.no-tabs #maximize-btn,
#profiler-panel.position-bottom.no-tabs #maximize-btn,
#profiler-panel.position-top.no-tabs #maximize-btn {
	display: none !important;
}

.profiler-content-wrapper {
	flex-grow: 1;
	overflow: hidden;
	position: relative;
}

.profiler-content {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	overflow-y: auto;
	font-size: 13px;
	visibility: hidden;
	opacity: 0;
	transition: opacity 0.2s, visibility 0.2s;
	box-sizing: border-box;
	display: flex;
	flex-direction: column;
	user-select: none;
	-webkit-user-select: none;
}

.profiler-content.active {
	visibility: visible;
	opacity: 1;
}

.profiler-content {
	overflow: auto; /* make sure scrollbars can appear */
}

.profiler-content::-webkit-scrollbar {
	width: 8px;
	height: 8px;
}

.profiler-content::-webkit-scrollbar-track {
	background: transparent;
}

.profiler-content::-webkit-scrollbar-thumb {
	background-color: rgba(0, 0, 0, 0.25);
	border-radius: 10px;
	transition: background 0.3s ease;
}

.profiler-content::-webkit-scrollbar-thumb:hover {
	background-color: rgba(0, 0, 0, 0.4);
}

.profiler-content::-webkit-scrollbar-corner {
	background: transparent;
}

.profiler-content {
	scrollbar-width: thin; /* "auto" | "thin" */
	scrollbar-color: rgba(0, 0, 0, 0.25) transparent;
}

.list-item-row {
	display: grid;
	align-items: center;
	padding: 4px 8px;
	border-radius: 3px;
	transition: background-color 0.2s;
	gap: 10px;
	border-bottom: none;
	user-select: none;
	-webkit-user-select: none;
}

.parameters .list-item-row {
	min-height: 31px;
}

.mini-panel-content .parameters .list-item-row {
	min-height: 21px;
}

.list-item-wrapper {
	margin-top: 2px;
	margin-bottom: 2px;
	user-select: none;
	-webkit-user-select: none;
}

.list-item-wrapper:first-child {
	/*margin-top: 0;*/
}

.list-item-wrapper:not(.header-wrapper):nth-child(odd) > .list-item-row {
	background-color: rgba(0,0,0,0.1);
}

.list-item-wrapper.header-wrapper>.list-item-row {
	color: var(--accent-color);
	background-color: rgba(0, 170, 255, 0.1);
}

.list-item-wrapper.header-wrapper>.list-item-row>.list-item-cell:first-child {
	font-weight: 600;
	line-height: 1;
}

.list-item-row.collapsible,
.list-item-row.actionable {
	cursor: pointer;
}

.list-item-row.collapsible {
	background-color: rgba(0, 170, 255, 0.15) !important;
	min-height: 23px;
}

.list-item-row.collapsible.alert,
.list-item-row.alert {
	background-color: rgba(244, 67, 54, 0.1) !important;
}

@media (hover: hover) {

	.list-item-row:hover:not(.collapsible):not(.no-hover),
	.list-item-row:hover:not(.no-hover),
	.list-item-row.actionable:hover,
	.list-item-row.collapsible.actionable:hover {
		background-color: rgba(255, 255, 255, 0.05) !important;
	}

	.list-item-row.collapsible:hover {
		background-color: rgba(0, 170, 255, 0.25) !important;
	}

}

.list-item-cell {
	white-space: pre;
	display: flex;
	align-items: center;
	user-select: none;
	-webkit-user-select: none;
}

.list-item-cell:not(:first-child) {
	justify-content: flex-end;
	font-weight: 600;
}

.list-header {
	display: grid;
	align-items: center;
	padding: 4px 8px;
	font-weight: 600;
	color: var(--text-secondary);
	padding-bottom: 6px;
	border-bottom: 1px solid var(--profiler-border);
	margin-bottom: 5px;
	gap: 10px;
	user-select: none;
	-webkit-user-select: none;
}

.list-item-wrapper.section-start {
	margin-top: 5px;
	margin-bottom: 5px;
}

.list-header .list-header-cell:not(:first-child) {
	text-align: right;
}

.list-children-container {
	padding-left: 1.5em;
	overflow: hidden;
	transition: max-height 0.1s ease-out;
	margin-top: 2px;
}

.list-children-container.closed {
	max-height: 0;
}

.item-toggler {
	display: inline-block;
	margin-right: 0.8em;
	text-align: left;
}

.list-item-row.open .item-toggler::before {
	content: '-';
}

.list-item-row:not(.open) .item-toggler::before {
	content: '+';
}

.list-item-cell .value.good {
	color: var(--color-green);
}

.list-item-cell .value.warn {
	color: var(--color-yellow);
}

.list-item-cell .value.bad {
	color: var(--color-red);
}

.list-scroll-wrapper {
	overflow-x: auto;
	width: 100%;
	user-select: none;
	-webkit-user-select: none;
}

.list-container.parameters .list-item-row:not(.collapsible) {
}

.graph-container {
	width: 100%;
	box-sizing: border-box;
	padding: 8px 0;
	position: relative;
}

.graph-svg {
	width: 100%;
	height: 80px;
	background-color: var(--profiler-header);
	border: 1px solid var(--profiler-border);
	border-radius: 4px;
}

.graph-path {
	stroke-width: 2;
	fill-opacity: 0.4;
}

.console-header {
	padding: 10px;
	border-bottom: 1px solid var(--profiler-border);
	display: flex;
	gap: 20px;
	flex-shrink: 0;
	align-items: center;
	justify-content: space-between;
}

.console-filters-group {
	display: flex;
	gap: 20px;
}

.console-filter-input {
	background-color: var(--profiler-bg);
	border: 1px solid var(--profiler-border);
	color: var(--text-primary);
	border-radius: 4px;
	padding: 4px 8px;
	font-family: var(--font-mono);
	flex-grow: 1;
	max-width: 300px;
	border-radius: 15px;
}

#console-log {
	display: flex;
	flex-direction: column;
	gap: 4px;
	padding: 10px;
	overflow-y: auto;
	flex-grow: 1;
}

.log-message {
	padding: 2px 5px;
	white-space: pre-wrap;
	word-break: break-all;
	border-radius: 3px;
	line-height: 1.5 !important;
}

.log-message.hidden {
	display: none;
}

.log-message.info {
	color: var(--text-primary);
}

.log-message.warn {
	color: var(--color-yellow);
}

.log-message.error {
	color: #f9dedc;
	background-color: rgba(244, 67, 54, 0.1);
}

.log-prefix {
	color: var(--text-secondary);
	margin-right: 8px;
}

.log-code {
	background-color: rgba(255, 255, 255, 0.1);
	border-radius: 3px;
	padding: 1px 4px;
}

.thumbnail-container {
	display: flex;
	align-items: center;
}

.thumbnail-svg {
	width: 40px;
	height: 22.5px;
	flex-shrink: 0;
	margin-right: 8px;
}

.param-control {
	display: flex;
	align-items: center;
	justify-content: flex-end;
	gap: 10px;
	width: 100%;
}

.param-control input,
.param-control select,
.param-control button {
	background-color: var(--profiler-bg);
	border: 1px solid var(--profiler-border);
	color: var(--text-primary);
	border-radius: 4px;
	padding: 4px 6px;
	padding-bottom: 2px;
	font-family: var(--font-mono);
	width: 100%;
	box-sizing: border-box;
}

.param-control select {
	padding-top: 3px;
	padding-bottom: 1px;
}

.param-control input[type="number"] {
	cursor: ns-resize;
}

.param-control input[type="color"] {
	padding: 2px;
}

.param-control button {
	cursor: pointer;
	transition: background-color 0.2s;
}

.param-control button:hover {
	background-color: var(--profiler-header);
}

.param-control-vector {
	display: flex;
	gap: 5px;
}

.custom-checkbox {
	display: inline-flex;
	align-items: center;
	cursor: pointer;
	gap: 8px;
	will-change: transform;
}

.custom-checkbox input {
	display: none;
}

.custom-checkbox .checkmark {
	width: 14px;
	height: 14px;
	border: 1px solid var(--accent-color);
	border-radius: 3px;
	display: inline-flex;
	justify-content: center;
	align-items: center;
	transition: background-color 0.2s, border-color 0.2s;
}

.custom-checkbox .checkmark::after {
	content: '';
	width: 6px;
	height: 6px;
	background-color: var(--accent-color);
	border-radius: 1px;
	display: block;
	transform: scale(0);
	transition: transform 0.2s;
}

.custom-checkbox input:checked+.checkmark {
	border-color: var(--accent-color);
}

.custom-checkbox input:checked+.checkmark::after {
	transform: scale(1);
}

.param-control input[type="range"] {
	-webkit-appearance: none;
	appearance: none;
	width: 100%;
	height: 16px;
	background: var(--profiler-header);
	border-radius: 5px;
	border: 1px solid var(--profiler-border);
	outline: none;
	padding: 0px;
	padding-top: 8px;
}

.param-control input[type="range"]::-webkit-slider-thumb {
	-webkit-appearance: none;
	appearance: none;
	width: 18px;
	height: 18px;
	background: var(--profiler-bg);
	border: 1px solid var(--accent-color);
	border-radius: 3px;
	cursor: pointer;
	margin-top: -8px;
}

.param-control input[type="range"]::-moz-range-thumb {
	width: 18px;
	height: 18px;
	background: var(--profiler-bg);
	border: 2px solid var(--accent-color);
	border-radius: 3px;
	cursor: pointer;
}

.param-control input[type="range"]::-moz-range-track {
	width: 100%;
	height: 16px;
	background: var(--profiler-header);
	border-radius: 5px;
	border: 1px solid var(--profiler-border);
}

/* Override .param-control styles for mini-panel-content */
.mini-panel-content input,
.mini-panel-content select,
.mini-panel-content button {
	padding: 2px 4px;
	height: 21px;
	line-height: 1.4;
	padding-top: 4px;
}

.mini-panel-content .param-control input,
.mini-panel-content .param-control select,
.mini-panel-content .param-control button {
	background-color: #1e1e24c2;
	line-height: 1.0;
}

.mini-panel-content .param-control select {
	padding: 2px 2px;
	padding-top: 3px;
}

.mini-panel-content .param-control input[type="number"]::-webkit-outer-spin-button,
.mini-panel-content .param-control input[type="number"]::-webkit-inner-spin-button {
	-webkit-appearance: none;
	margin: 0;
}

.mini-panel-content .param-control input[type="number"] {
	-moz-appearance: textfield;
}

.mini-panel-content .list-item-cell span {
	position: relative;
	top: 1px;
	margin-left: 2px;
}

.mini-panel-content .custom-checkbox .checkmark {
	width: 12px;
	height: 12px;
	margin-bottom: 2px;
	will-change: transform;
}

.mini-panel-content .list-container.parameters .list-item-row:not(.collapsible) {
	margin-bottom: 2px;
}

@media screen and (max-width: 450px) and (orientation: portrait) {

	.console-filter-input {
		max-width: 100px;
	}

}

/* Touch device optimizations */
@media (hover: none) and (pointer: coarse) {

	.panel-resizer {
		top: -10px !important;
		height: 20px !important;
	}

	#profiler-panel.position-top .panel-resizer {
		top: auto !important;
		bottom: -10px !important;
		height: 20px !important;
	}

	#profiler-panel.position-left .panel-resizer {
		right: -10px !important;
		width: 20px !important;
		height: 100% !important;
	}

	#profiler-panel.position-right .panel-resizer {
		left: -10px !important;
		width: 20px !important;
		height: 100% !important;
	}

	.detached-tab-resizer-top,
	.detached-tab-resizer-bottom {
		height: 10px !important;
	}

	.detached-tab-resizer-left,
	.detached-tab-resizer-right {
		width: 10px !important;
	}

}

.drag-preview-indicator {
	position: fixed;
	background-color: rgba(0, 170, 255, 0.2);
	border: 2px dashed var(--accent-color);
	z-index: 999;
	pointer-events: none;
	transition: all 0.2s ease-out;
}

/* Detached Tab Windows */
.detached-tab-panel {
	position: fixed;
	width: 500px;
	height: 400px;
	background: var(--profiler-bg);
	border: 1px solid var(--profiler-border);
	border-radius: 8px;
	box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
	z-index: 1002;
	display: flex;
	flex-direction: column;
	backdrop-filter: blur(10px);
	overflow: hidden;
	opacity: 1;
	visibility: visible;
	transition: opacity 0.2s, visibility 0.2s;
}

#profiler-panel:not(.visible) ~ * .detached-tab-panel,
body:has(#profiler-panel:not(.visible)) .detached-tab-panel {
	opacity: 0;
	visibility: hidden;
	pointer-events: none;
}

.detached-tab-header {
	background: var(--profiler-header-bg);
	padding: 0 7px 0 15px;
	font-family: var(--font-family);
	font-size: 14px;
	color: var(--text-primary);
	font-weight: 600;
	display: flex;
	justify-content: space-between;
	align-items: center;
	border-bottom: 1px solid var(--profiler-border);
	cursor: grab;
	user-select: none;
	height: 38px;
	flex-shrink: 0;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
	touch-action: none;
}

.detached-tab-header:active {
	cursor: grabbing;
}

.detached-header-controls {
	display: flex;
	gap: 5px;
}

.detached-reattach-btn {
	background: transparent;
	border: none;
	color: var(--text-secondary);
	font-family: var(--font-family);
	font-size: 18px;
	line-height: 1;
	cursor: pointer;
	padding: 4px 8px;
	border-radius: 4px;
	transition: all 0.2s;
	display: flex;
	align-items: center;
	justify-content: center;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}

.detached-reattach-btn:hover {
	background: rgba(0, 170, 255, 0.2);
	color: var(--accent-color);
}

.detached-tab-content {
	flex: 1;
	overflow: auto;
	position: relative;
	background: var(--profiler-bg);
}

.detached-tab-content::-webkit-scrollbar {
	width: 8px;
	height: 8px;
}

.detached-tab-content::-webkit-scrollbar-track {
	background: transparent;
}

.detached-tab-content::-webkit-scrollbar-thumb {
	background-color: rgba(0, 0, 0, 0.25);
	border-radius: 10px;
	transition: background 0.3s ease;
}

.detached-tab-content::-webkit-scrollbar-thumb:hover {
	background-color: rgba(0, 0, 0, 0.4);
}

.detached-tab-content::-webkit-scrollbar-corner {
	background: transparent;
}

.detached-tab-content .profiler-content {
	display: block !important;
	height: 100%;
	visibility: visible !important;
	opacity: 1 !important;
	position: relative !important;
}

.detached-tab-content .profiler-content > * {
	font-family: var(--font-mono);
	color: var(--text-primary);
}

.detached-tab-resizer {
	position: absolute;
	bottom: 0;
	right: 0;
	width: 20px;
	height: 20px;
	cursor: nwse-resize;
	z-index: 10;
	touch-action: none;
}

.detached-tab-resizer::after {
	content: '';
	position: absolute;
	bottom: 2px;
	right: 2px;
	width: 12px;
	height: 12px;
	border-right: 2px solid var(--profiler-border);
	border-bottom: 2px solid var(--profiler-border);
	border-bottom-right-radius: 6px;
	opacity: 0.5;
}

.detached-tab-resizer:hover::after {
	opacity: 1;
	border-color: var(--accent-color);
}

/* Edge resizers */
.detached-tab-resizer-top {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	height: 5px;
	cursor: ns-resize;
	z-index: 10;
	touch-action: none;
}

.detached-tab-resizer-right {
	position: absolute;
	top: 0;
	right: 0;
	bottom: 0;
	width: 5px;
	cursor: ew-resize;
	z-index: 10;
	touch-action: none;
}

.detached-tab-resizer-bottom {
	position: absolute;
	bottom: 0;
	left: 0;
	right: 0;
	height: 5px;
	cursor: ns-resize;
	z-index: 10;
	touch-action: none;
}

.detached-tab-resizer-left {
	position: absolute;
	top: 0;
	left: 0;
	bottom: 0;
	width: 5px;
	cursor: ew-resize;
	z-index: 10;
	touch-action: none;
}

/* Input number spin buttons - hide arrows */
/* Chrome, Safari, Edge, Opera */
#profiler-panel input[type="number"]::-webkit-outer-spin-button,
#profiler-panel input[type="number"]::-webkit-inner-spin-button,
.detached-tab-content input[type="number"]::-webkit-outer-spin-button,
.detached-tab-content input[type="number"]::-webkit-inner-spin-button {
	-webkit-appearance: none;
	margin: 0;
}

/* Firefox */
#profiler-panel input[type="number"],
.detached-tab-content input[type="number"] {
	-moz-appearance: textfield;
}
`,t=document.createElement("style");t.id="profiler-styles",t.textContent=e,document.head.appendChild(t)}}class Hpe{constructor(){this.tabs={},this.activeTabId=null,this.isResizing=!1,this.lastHeightBottom=350,this.lastWidthRight=450,this.position="bottom",this.detachedWindows=[],this.isMobile=this.detectMobile(),this.maxZIndex=1002,this.nextTabOriginalIndex=0,Vpe.init(),this.setupShell(),this.setupResizing(),this.isMobile&&this.setupOrientationListener(),this.setupWindowResizeListener()}detectMobile(){const e=navigator.userAgent||navigator.vendor||window.opera,t=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e),n="ontouchstart"in window||navigator.maxTouchPoints>0,s=window.innerWidth<=768;return t||n&&s}setupOrientationListener(){const e=()=>{const n=window.innerWidth>window.innerHeight?"right":"bottom";this.position!==n&&this.setPosition(n)};e(),window.addEventListener("orientationchange",e),window.addEventListener("resize",e)}setupWindowResizeListener(){const e=()=>{this.detachedWindows.forEach(n=>{this.constrainWindowToBounds(n.panel)})},t=()=>{if(this.panel.classList.contains("maximized"))return;const n=window.innerWidth,s=window.innerHeight;if(this.position==="bottom"){const r=this.panel.offsetHeight,a=s-50;r>a&&(this.panel.style.height=`${a}px`,this.lastHeightBottom=a)}else if(this.position==="right"){const r=this.panel.offsetWidth,a=n-50;r>a&&(this.panel.style.width=`${a}px`,this.lastWidthRight=a)}};window.addEventListener("resize",()=>{e(),t()})}constrainWindowToBounds(e){const t=window.innerWidth,n=window.innerHeight,s=e.offsetWidth,r=e.offsetHeight;let a=parseFloat(e.style.left)||e.offsetLeft||0,o=parseFloat(e.style.top)||e.offsetTop||0;const l=s/2,c=r/2;a+s>t+l&&(a=t+l-s),a<-l&&(a=-l),o+r>n+c&&(o=n+c-r),o<-c&&(o=-c),e.style.left=`${a}px`,e.style.top=`${o}px`}setupShell(){this.domElement=document.createElement("div"),this.domElement.id="profiler-shell",this.toggleButton=document.createElement("button"),this.toggleButton.id="profiler-toggle",this.toggleButton.innerHTML=`
<span id="builtin-tabs-container"></span>
<span id="toggle-text">
	<span id="fps-counter">-</span>
	<span class="fps-label">FPS</span>
</span>
<span id="toggle-icon">
	<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-device-ipad-horizontal-search"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11.5 20h-6.5a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v5.5" /><path d="M9 17h2" /><path d="M18 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M20.2 20.2l1.8 1.8" /></svg>
</span>
`,this.toggleButton.onclick=()=>this.togglePanel(),this.builtinTabsContainer=this.toggleButton.querySelector("#builtin-tabs-container"),this.miniPanel=document.createElement("div"),this.miniPanel.id="profiler-mini-panel",this.miniPanel.className="profiler-mini-panel",this.panel=document.createElement("div"),this.panel.id="profiler-panel";const e=document.createElement("div");e.className="profiler-header",this.tabsContainer=document.createElement("div"),this.tabsContainer.className="profiler-tabs";const t=document.createElement("div");t.className="profiler-controls",this.floatingBtn=document.createElement("button"),this.floatingBtn.id="floating-btn",this.floatingBtn.title="Switch to Right Side",this.floatingBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="15" y1="3" x2="15" y2="21"></line></svg>',this.floatingBtn.onclick=()=>this.togglePosition(),this.isMobile&&(this.floatingBtn.style.display="none",this.panel.classList.add("hide-position-toggle")),this.maximizeBtn=document.createElement("button"),this.maximizeBtn.id="maximize-btn",this.maximizeBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>',this.maximizeBtn.onclick=()=>this.toggleMaximize();const n=document.createElement("button");n.id="hide-panel-btn",n.textContent="-",n.onclick=()=>this.togglePanel(),t.append(this.floatingBtn,this.maximizeBtn,n),e.append(this.tabsContainer,t),this.contentWrapper=document.createElement("div"),this.contentWrapper.className="profiler-content-wrapper";const s=document.createElement("div");s.className="panel-resizer",this.panel.append(s,e,this.contentWrapper),this.domElement.append(this.toggleButton,this.miniPanel,this.panel),this.panel.classList.add(`position-${this.position}`)}setupResizing(){const e=this.panel.querySelector(".panel-resizer"),t=n=>{this.isResizing=!0,this.panel.classList.add("resizing"),e.setPointerCapture(n.pointerId);const s=n.clientX,r=n.clientY,a=this.panel.offsetHeight,o=this.panel.offsetWidth,l=u=>{if(!this.isResizing)return;u.preventDefault();const h=u.clientX,f=u.clientY;if(this.position==="bottom"){const m=a-(f-r);m>100&&m<window.innerHeight-50&&(this.panel.style.height=`${m}px`)}else if(this.position==="right"){const m=o-(h-s);m>200&&m<window.innerWidth-50&&(this.panel.style.width=`${m}px`)}},c=()=>{this.isResizing=!1,this.panel.classList.remove("resizing"),e.removeEventListener("pointermove",l),e.removeEventListener("pointerup",c),e.removeEventListener("pointercancel",c),this.panel.classList.contains("maximized")||(this.position==="bottom"?this.lastHeightBottom=this.panel.offsetHeight:this.position==="right"&&(this.lastWidthRight=this.panel.offsetWidth),this.saveLayout())};e.addEventListener("pointermove",l),e.addEventListener("pointerup",c),e.addEventListener("pointercancel",c)};e.addEventListener("pointerdown",t)}toggleMaximize(){this.panel.classList.contains("maximized")?(this.panel.classList.remove("maximized"),this.position==="bottom"?(this.panel.style.height=`${this.lastHeightBottom}px`,this.panel.style.width="100%"):this.position==="right"&&(this.panel.style.height="100%",this.panel.style.width=`${this.lastWidthRight}px`),this.maximizeBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>'):(this.position==="bottom"?this.lastHeightBottom=this.panel.offsetHeight:this.position==="right"&&(this.lastWidthRight=this.panel.offsetWidth),this.panel.classList.add("maximized"),this.position==="bottom"?(this.panel.style.height="100vh",this.panel.style.width="100%"):this.position==="right"&&(this.panel.style.height="100%",this.panel.style.width="100vw"),this.maximizeBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="8" y="8" width="12" height="12" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg>')}addTab(e){this.tabs[e.id]=e,e.originalIndex=this.nextTabOriginalIndex++,e.allowDetach===!1&&e.button.classList.add("no-detach"),e.onVisibilityChange=()=>this.updatePanelSize(),this.setupTabDragAndDrop(e),this.tabsContainer.appendChild(e.button),this.contentWrapper.appendChild(e.content),e.isVisible||(e.button.style.display="none",e.content.style.display="none"),e.builtin&&this.addBuiltinTab(e),this.updatePanelSize()}addBuiltinTab(e){const t=document.createElement("button");t.className="builtin-tab-btn",e.icon?t.innerHTML=e.icon:t.textContent=e.button.textContent.charAt(0).toUpperCase(),t.title=e.button.textContent;const n=document.createElement("div");n.className="mini-panel-content",n.style.display="none",e.builtinButton=t,e.miniContent=n,this.miniPanel.appendChild(n),t.onclick=s=>{if(s.stopPropagation(),this.panel.classList.contains("visible"))e.isVisible||e.show(),e.isDetached?e.detachedWindow&&this.bringWindowToFront(e.detachedWindow.panel):this.setActiveTab(e.id);else{const a=n.style.display!=="none"&&n.children.length>0;if(this.miniPanel.querySelectorAll(".mini-panel-content").forEach(o=>{o.style.display="none"}),this.builtinTabsContainer.querySelectorAll(".builtin-tab-btn").forEach(o=>{o.classList.remove("active")}),a)this.miniPanel.classList.remove("visible"),n.style.display="none",n.firstChild&&e.content.appendChild(n.firstChild);else{if(t.classList.add("active"),!n.firstChild){const o=e.content.querySelector(".list-scroll-wrapper")||e.content.firstElementChild;o&&n.appendChild(o)}n.style.display="block",this.miniPanel.classList.add("visible")}}},this.builtinTabsContainer.appendChild(t),e.builtinButton=t,e.miniContent=n,e.profiler=this,e.isVisible||(t.style.display="none",n.style.display="none",Array.from(this.builtinTabsContainer.querySelectorAll(".builtin-tab-btn")).some(r=>r.style.display!=="none")||(this.builtinTabsContainer.style.display="none"))}updatePanelSize(){Object.values(this.tabs).some(t=>!t.isDetached&&t.isVisible)?(this.panel.classList.remove("no-tabs"),Object.keys(this.tabs).length>0&&(this.position==="bottom"?parseInt(this.panel.style.height)===38&&(this.panel.style.height=`${this.lastHeightBottom}px`):this.position==="right"&&parseInt(this.panel.style.width)===45&&(this.panel.style.width=`${this.lastWidthRight}px`))):(this.panel.classList.add("no-tabs"),this.panel.classList.contains("maximized")&&(this.panel.classList.remove("maximized"),this.maximizeBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>'),this.position==="bottom"?this.panel.style.height="38px":this.position==="right"&&(this.panel.style.width="45px"))}setupTabDragAndDrop(e){if(this.isMobile){e.button.addEventListener("click",()=>{this.setActiveTab(e.id)});return}if(e.allowDetach===!1){e.button.addEventListener("click",()=>{this.setActiveTab(e.id)}),e.button.style.cursor="default";return}let t=!1,n,s,r=!1,a=null;const o=10,l=h=>{n=h.clientX,s=h.clientY,t=!1,r=!1,e.button.setPointerCapture(h.pointerId)},c=h=>{const f=h.clientX,m=h.clientY,g=Math.abs(f-n),x=Math.abs(m-s);!t&&(g>o||x>o)&&(t=!0,e.button.style.cursor="grabbing",e.button.style.opacity="0.5",e.button.style.transform="scale(1.05)",a=this.createPreviewWindow(e,f,m),a.style.opacity="0.8"),t&&a&&(r=!0,h.preventDefault(),a.style.left=`${f-200}px`,a.style.top=`${m-20}px`)},u=()=>{if(t&&r&&a){a.parentNode&&a.parentNode.removeChild(a);const h=parseInt(a.style.left)+200,f=parseInt(a.style.top)+20;this.detachTab(e,h,f)}else r||this.setActiveTab(e.id),a&&a.parentNode&&a.parentNode.removeChild(a);e.button.style.opacity="",e.button.style.transform="",e.button.style.cursor="",t=!1,r=!1,a=null,e.button.removeEventListener("pointermove",c),e.button.removeEventListener("pointerup",u),e.button.removeEventListener("pointercancel",u)};e.button.addEventListener("pointerdown",h=>{l(h),e.button.addEventListener("pointermove",c),e.button.addEventListener("pointerup",u),e.button.addEventListener("pointercancel",u)}),e.button.style.cursor="grab"}createPreviewWindow(e,t,n){const s=document.createElement("div");s.className="detached-tab-panel",s.style.left=`${t-200}px`,s.style.top=`${n-20}px`,s.style.pointerEvents="none",this.maxZIndex++,s.style.setProperty("z-index",this.maxZIndex,"important");const r=document.createElement("div");r.className="detached-tab-header";const a=document.createElement("span");a.textContent=e.button.textContent.replace("","").trim(),r.appendChild(a);const o=document.createElement("div");o.className="detached-header-controls";const l=document.createElement("button");l.className="detached-reattach-btn",l.innerHTML="",o.appendChild(l),r.appendChild(o);const c=document.createElement("div");c.className="detached-tab-content";const u=document.createElement("div");return u.className="detached-tab-resizer",s.appendChild(u),s.appendChild(r),s.appendChild(c),document.body.appendChild(s),s}detachTab(e,t,n){if(e.isDetached||e.allowDetach===!1)return;const r=Array.from(this.tabsContainer.children).map(c=>Object.keys(this.tabs).find(u=>this.tabs[u].button===c)).filter(c=>c!==void 0),a=r.indexOf(e.id);let o=null;if(this.activeTabId===e.id){e.setActive(!1);const c=r.filter(u=>u!==e.id&&!this.tabs[u].isDetached&&this.tabs[u].isVisible);if(c.length>0){for(let u=a-1;u>=0;u--)if(c.includes(r[u])){o=r[u];break}if(!o){for(let u=a+1;u<r.length;u++)if(c.includes(r[u])){o=r[u];break}}o||(o=c[0])}}e.button.parentNode&&e.button.parentNode.removeChild(e.button),e.content.parentNode&&e.content.parentNode.removeChild(e.content);const l=this.createDetachedWindow(e,t,n);this.detachedWindows.push(l),e.isDetached=!0,e.detachedWindow=l,o?this.setActiveTab(o):this.activeTabId===e.id&&(this.activeTabId=null),this.updatePanelSize(),this.saveLayout()}createDetachedWindow(e,t,n){const s=window.innerWidth,r=window.innerHeight,a=400,o=300;let l=t-200,c=n-20;l+a>s&&(l=s-a),l<0&&(l=0),c+o>r&&(c=r-o),c<0&&(c=0);const u=document.createElement("div");u.className="detached-tab-panel",u.style.left=`${l}px`,u.style.top=`${c}px`,this.panel.classList.contains("visible")||(u.style.opacity="0",u.style.visibility="hidden",u.style.pointerEvents="none"),e.isVisible||(u.style.display="none");const h=document.createElement("div");h.className="detached-tab-header";const f=document.createElement("span");f.textContent=e.button.textContent.replace("","").trim(),h.appendChild(f);const m=document.createElement("div");m.className="detached-header-controls";const g=document.createElement("button");g.className="detached-reattach-btn",g.innerHTML="",g.title="Reattach to main panel",g.onclick=()=>this.reattachTab(e),m.appendChild(g),h.appendChild(m);const x=document.createElement("div");x.className="detached-tab-content",x.appendChild(e.content),e.content.style.display="block",e.content.classList.add("active");const v=document.createElement("div");v.className="detached-tab-resizer-top";const y=document.createElement("div");y.className="detached-tab-resizer-right";const b=document.createElement("div");b.className="detached-tab-resizer-bottom";const S=document.createElement("div");S.className="detached-tab-resizer-left";const T=document.createElement("div");return T.className="detached-tab-resizer",u.appendChild(v),u.appendChild(y),u.appendChild(b),u.appendChild(S),u.appendChild(T),u.appendChild(h),u.appendChild(x),document.body.appendChild(u),this.setupDetachedWindowDrag(u,h,e),this.setupDetachedWindowResize(u,v,y,b,S,T),u.style.setProperty("z-index",this.maxZIndex,"important"),{panel:u,tab:e}}bringWindowToFront(e){this.maxZIndex++,e.style.setProperty("z-index",this.maxZIndex,"important")}setupDetachedWindowDrag(e,t,n){let s=!1,r,a,o,l;e.addEventListener("pointerdown",()=>{this.bringWindowToFront(e)});const c=f=>{if(f.target.classList.contains("detached-reattach-btn"))return;this.bringWindowToFront(e),s=!0,t.style.cursor="grabbing",t.setPointerCapture(f.pointerId),r=f.clientX,a=f.clientY;const m=e.getBoundingClientRect();o=m.left,l=m.top},u=f=>{if(!s)return;f.preventDefault();const m=f.clientX,g=f.clientY,x=m-r,v=g-a;let y=o+x,b=l+v;const S=window.innerWidth,T=window.innerHeight,M=e.offsetWidth,C=e.offsetHeight,w=M/2,N=C/2;y+M>S+w&&(y=S+w-M),y<-w&&(y=-w),b+C>T+N&&(b=T+N-C),b<-N&&(b=-N),e.style.left=`${y}px`,e.style.top=`${b}px`;const E=this.panel.getBoundingClientRect();m>=E.left&&m<=E.right&&g>=E.top&&g<=E.bottom?(e.style.opacity="0.5",this.panel.style.outline="2px solid var(--accent-color)"):(e.style.opacity="",this.panel.style.outline="")},h=f=>{if(!s)return;s=!1,t.style.cursor="",e.style.opacity="",this.panel.style.outline="";const m=f.clientX,g=f.clientY;if(m!==void 0&&g!==void 0){const x=this.panel.getBoundingClientRect();m>=x.left&&m<=x.right&&g>=x.top&&g<=x.bottom&&n?this.reattachTab(n):this.saveLayout()}t.removeEventListener("pointermove",u),t.removeEventListener("pointerup",h),t.removeEventListener("pointercancel",h)};t.addEventListener("pointerdown",f=>{c(f),t.addEventListener("pointermove",u),t.addEventListener("pointerup",h),t.addEventListener("pointercancel",h)}),t.style.cursor="grab"}setupDetachedWindowResize(e,t,n,s,r,a){const c=(u,h)=>{let f=!1,m,g,x,v,y,b;const S=C=>{C.preventDefault(),C.stopPropagation(),f=!0,this.bringWindowToFront(e),u.setPointerCapture(C.pointerId),m=C.clientX,g=C.clientY,x=e.offsetWidth,v=e.offsetHeight,y=e.offsetLeft,b=e.offsetTop},T=C=>{if(!f)return;C.preventDefault();const w=C.clientX,N=C.clientY,E=w-m,B=N-g,U=window.innerWidth,H=window.innerHeight;if(h==="right"||h==="corner"){const F=x+E,V=U-y;F>=250&&F<=V&&(e.style.width=`${F}px`)}if(h==="bottom"||h==="corner"){const F=v+B,V=H-b;F>=150&&F<=V&&(e.style.height=`${F}px`)}if(h==="left"){const F=x-E,V=y+x-250;if(F>=250){const Y=y+E;Y>=0&&Y<=V&&(e.style.width=`${F}px`,e.style.left=`${Y}px`)}}if(h==="top"){const F=v-B,V=b+v-150;if(F>=150){const Y=b+B;Y>=0&&Y<=V&&(e.style.height=`${F}px`,e.style.top=`${Y}px`)}}},M=()=>{f=!1,u.removeEventListener("pointermove",T),u.removeEventListener("pointerup",M),u.removeEventListener("pointercancel",M),this.saveLayout()};u.addEventListener("pointerdown",C=>{S(C),u.addEventListener("pointermove",T),u.addEventListener("pointerup",M),u.addEventListener("pointercancel",M)})};c(t,"top"),c(n,"right"),c(s,"bottom"),c(r,"left"),c(a,"corner")}reattachTab(e){if(!e.isDetached)return;if(e.detachedWindow){const a=this.detachedWindows.indexOf(e.detachedWindow);a>-1&&this.detachedWindows.splice(a,1),e.detachedWindow.panel.parentNode&&e.detachedWindow.panel.parentNode.removeChild(e.detachedWindow.panel),e.detachedWindow=null}e.isDetached=!1;const n=Object.values(this.tabs).filter(a=>a.originalIndex!==void 0&&a.isVisible).sort((a,o)=>a.originalIndex-o.originalIndex),s=Array.from(this.tabsContainer.children);let r=0;for(const a of n){if(a.id===e.id)break;a.isDetached||r++}r>=s.length||s.length===0?this.tabsContainer.appendChild(e.button):this.tabsContainer.insertBefore(e.button,s[r]),this.contentWrapper.appendChild(e.content),this.setActiveTab(e.id),this.updatePanelSize(),this.saveLayout()}setActiveTab(e){this.activeTabId&&this.tabs[this.activeTabId]&&!this.tabs[this.activeTabId].isDetached&&this.tabs[this.activeTabId].setActive(!1),this.activeTabId=e,this.tabs[e]&&this.tabs[e].setActive(!0)}togglePanel(){this.panel.classList.toggle("visible"),this.toggleButton.classList.toggle("hidden");const e=this.panel.classList.contains("visible");if(e)this.savedMiniPanelState={isVisible:this.miniPanel.classList.contains("visible"),activeTabId:null,contentMap:{}},this.miniPanel.querySelectorAll(".mini-panel-content").forEach(t=>{t.style.display!=="none"&&t.firstChild&&Object.values(this.tabs).forEach(n=>{n.miniContent===t&&(this.savedMiniPanelState.activeTabId=n.id,n.content.appendChild(t.firstChild))})}),this.miniPanel.classList.remove("visible"),this.miniPanel.querySelectorAll(".mini-panel-content").forEach(t=>{t.style.display="none"}),this.builtinTabsContainer.querySelectorAll(".builtin-tab-btn").forEach(t=>{t.classList.remove("active")});else if(this.savedMiniPanelState&&this.savedMiniPanelState.isVisible&&this.savedMiniPanelState.activeTabId){const t=this.tabs[this.savedMiniPanelState.activeTabId];if(t&&t.miniContent&&t.builtinButton){this.miniPanel.classList.add("visible"),t.miniContent.style.display="block",t.builtinButton.classList.add("active");const n=t.content.querySelector(".list-scroll-wrapper, .profiler-content > *");n&&t.miniContent.appendChild(n)}}this.detachedWindows.forEach(t=>{e?(t.panel.style.opacity="",t.panel.style.visibility="",t.panel.style.pointerEvents=""):(t.panel.style.opacity="0",t.panel.style.visibility="hidden",t.panel.style.pointerEvents="none")})}togglePosition(){const e=this.position==="bottom"?"right":"bottom";this.setPosition(e)}setPosition(e){if(this.position===e)return;this.panel.style.transition="none";const t=this.panel.classList.contains("maximized");e==="right"?(this.position="right",this.floatingBtn.classList.add("active"),this.floatingBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><path d="M3 15h18"></path></svg>',this.floatingBtn.title="Switch to Bottom",this.panel.classList.remove("position-bottom"),this.panel.classList.add("position-right"),this.panel.style.bottom="",this.panel.style.top="0",this.panel.style.right="0",this.panel.style.left="",t?(this.panel.style.width="100vw",this.panel.style.height="100%"):(this.panel.style.width=`${this.lastWidthRight}px`,this.panel.style.height="100%")):(this.position="bottom",this.floatingBtn.classList.remove("active"),this.floatingBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="15" y1="3" x2="15" y2="21"></line></svg>',this.floatingBtn.title="Switch to Right Side",this.panel.classList.remove("position-right"),this.panel.classList.add("position-bottom"),this.panel.style.top="",this.panel.style.right="",this.panel.style.bottom="0",this.panel.style.left="0",t?(this.panel.style.width="100%",this.panel.style.height="100vh"):(this.panel.style.width="100%",this.panel.style.height=`${this.lastHeightBottom}px`)),setTimeout(()=>{this.panel.style.transition=""},50),this.updatePanelSize(),this.saveLayout()}saveLayout(){const e={position:this.position,lastHeightBottom:this.lastHeightBottom,lastWidthRight:this.lastWidthRight,activeTabId:this.activeTabId,detachedTabs:[]};this.detachedWindows.forEach(t=>{const n=t.tab,s=t.panel,r=parseFloat(s.style.left)||s.offsetLeft||0,a=parseFloat(s.style.top)||s.offsetTop||0,o=s.offsetWidth,l=s.offsetHeight;e.detachedTabs.push({tabId:n.id,originalIndex:n.originalIndex!==void 0?n.originalIndex:0,left:r,top:a,width:o,height:l})});try{localStorage.setItem("profiler-layout",JSON.stringify(e))}catch(t){console.warn("Failed to save profiler layout:",t)}}loadLayout(){try{const e=localStorage.getItem("profiler-layout");if(!e)return;const t=JSON.parse(e);if(t.detachedTabs&&t.detachedTabs.length>0){const r=window.innerWidth,a=window.innerHeight;t.detachedTabs=t.detachedTabs.map(o=>{let{left:l,top:c,width:u,height:h}=o;u>r&&(u=r-100),h>a&&(h=a-100);const f=u/2,m=h/2;return l+u>r+f&&(l=r+f-u),l<-f&&(l=-f),c+h>a+m&&(c=a+m-h),c<-m&&(c=-m),{...o,left:l,top:c,width:u,height:h}})}t.position&&(this.position=t.position),t.lastHeightBottom&&(this.lastHeightBottom=t.lastHeightBottom),t.lastWidthRight&&(this.lastWidthRight=t.lastWidthRight);const n=window.innerWidth,s=window.innerHeight;this.lastHeightBottom>s-50&&(this.lastHeightBottom=s-50),this.lastWidthRight>n-50&&(this.lastWidthRight=n-50),this.position==="right"?(this.floatingBtn.classList.add("active"),this.floatingBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><path d="M3 15h18"></path></svg>',this.floatingBtn.title="Switch to Bottom",this.panel.classList.remove("position-bottom"),this.panel.classList.add("position-right"),this.panel.style.bottom="",this.panel.style.top="0",this.panel.style.right="0",this.panel.style.left="",this.panel.style.width=`${this.lastWidthRight}px`,this.panel.style.height="100%"):this.panel.style.height=`${this.lastHeightBottom}px`,t.activeTabId&&t.detachedTabs&&t.detachedTabs.some(a=>a.tabId===t.activeTabId)&&this.setActiveTab(t.activeTabId),t.detachedTabs&&t.detachedTabs.length>0&&(this.pendingDetachedTabs=t.detachedTabs,this.restoreDetachedTabs()),this.updatePanelSize()}catch(e){console.warn("Failed to load profiler layout:",e)}}restoreDetachedTabs(){if(!this.pendingDetachedTabs||this.pendingDetachedTabs.length===0)return;if(this.pendingDetachedTabs.forEach(t=>{const n=this.tabs[t.tabId];if(!n||n.isDetached)return;t.originalIndex!==void 0&&(n.originalIndex=t.originalIndex),n.button.parentNode&&n.button.parentNode.removeChild(n.button),n.content.parentNode&&n.content.parentNode.removeChild(n.content);const s=this.createDetachedWindow(n,0,0);s.panel.style.left=`${t.left}px`,s.panel.style.top=`${t.top}px`,s.panel.style.width=`${t.width}px`,s.panel.style.height=`${t.height}px`,this.constrainWindowToBounds(s.panel),this.detachedWindows.push(s),n.isDetached=!0,n.detachedWindow=s}),this.pendingDetachedTabs=null,this.detachedWindows.forEach(t=>{const n=parseInt(getComputedStyle(t.panel).zIndex)||0;n>this.maxZIndex&&(this.maxZIndex=n)}),!this.activeTabId||!this.tabs[this.activeTabId]||this.tabs[this.activeTabId].isDetached||!this.tabs[this.activeTabId].isVisible){const n=Object.keys(this.tabs).filter(s=>!this.tabs[s].isDetached&&this.tabs[s].isVisible);if(n.length>0){const r=Array.from(this.tabsContainer.children).map(a=>Object.keys(this.tabs).find(o=>this.tabs[o].button===a)).filter(a=>a!==void 0&&!this.tabs[a].isDetached&&this.tabs[a].isVisible);this.setActiveTab(r[0]||n[0])}else this.activeTabId=null}this.updatePanelSize()}}class pw{constructor(e,t={}){this.id=e.toLowerCase(),this.button=document.createElement("button"),this.button.className="tab-btn",this.button.textContent=e,this.content=document.createElement("div"),this.content.id=`${this.id}-content`,this.content.className="profiler-content",this.isActive=!1,this.isVisible=!0,this.isDetached=!1,this.detachedWindow=null,this.allowDetach=t.allowDetach!==void 0?t.allowDetach:!0,this.builtin=t.builtin!==void 0?t.builtin:!1,this.icon=t.icon||null,this.builtinButton=null,this.miniContent=null,this.profiler=null,this.onVisibilityChange=null}setActive(e){this.button.classList.toggle("active",e),this.content.classList.toggle("active",e),this.isActive=e}show(){this.content.style.display="",this.button.style.display="",this.isVisible=!0,this.isDetached&&this.detachedWindow&&(this.detachedWindow.panel.style.display=""),this.onVisibilityChange&&this.onVisibilityChange(),this.showBuiltin()}hide(){this.content.style.display="none",this.button.style.display="none",this.isVisible=!1,this.isDetached&&this.detachedWindow&&(this.detachedWindow.panel.style.display="none"),this.onVisibilityChange&&this.onVisibilityChange(),this.hideBuiltin()}showBuiltin(){if(!(!this.builtin||(this.profiler&&this.profiler.builtinTabsContainer&&(this.profiler.builtinTabsContainer.style.display=""),this.builtinButton&&(this.builtinButton.style.display=""),!(this.profiler&&this.profiler.panel&&this.profiler.panel.classList.contains("visible"))))&&this.miniContent&&this.profiler){if(this.profiler.miniPanel.querySelectorAll(".mini-panel-content").forEach(t=>{t.style.display="none"}),this.profiler.builtinTabsContainer.querySelectorAll(".builtin-tab-btn").forEach(t=>{t.classList.remove("active")}),this.builtinButton&&this.builtinButton.classList.add("active"),!this.miniContent.firstChild){const t=this.content.querySelector(".list-scroll-wrapper")||this.content.firstElementChild;t&&this.miniContent.appendChild(t)}this.miniContent.style.display="block",this.profiler.miniPanel.classList.add("visible")}}hideBuiltin(){this.builtin&&(this.builtinButton&&(this.builtinButton.style.display="none"),this.miniContent&&(this.miniContent.style.display="none",this.miniContent.firstChild&&this.content.appendChild(this.miniContent.firstChild)),this.builtinButton&&this.builtinButton.classList.remove("active"),this.profiler&&(Array.from(this.profiler.miniPanel.querySelectorAll(".mini-panel-content")).some(n=>n.style.display!=="none")||this.profiler.miniPanel.classList.remove("visible"),Array.from(this.profiler.builtinTabsContainer.querySelectorAll(".builtin-tab-btn")).some(n=>n.style.display!=="none")||(this.profiler.builtinTabsContainer.style.display="none")))}}class ZP{constructor(...e){this.headers=e,this.children=[],this.domElement=document.createElement("div"),this.domElement.className="list-container",this.domElement.style.padding="10px",this.id=`list-${Math.random().toString(36).substr(2,9)}`,this.domElement.dataset.listId=this.id,this.gridStyleElement=document.createElement("style"),this.domElement.appendChild(this.gridStyleElement);const t=document.createElement("div");t.className="list-header",this.headers.forEach(n=>{const s=document.createElement("div");s.className="list-header-cell",s.textContent=n,t.appendChild(s)}),this.domElement.appendChild(t)}setGridStyle(e){this.gridStyleElement.textContent=`
[data-list-id="${this.id}"] > .list-header,
[data-list-id="${this.id}"] .list-item-row {
	grid-template-columns: ${e};
}
`}add(e){e.parent!==null&&e.parent.remove(e),e.domElement.classList.add("header-wrapper","section-start"),e.parent=this,this.children.push(e),this.domElement.appendChild(e.domElement)}remove(e){const t=this.children.indexOf(e);return t!==-1&&(this.children.splice(t,1),this.domElement.removeChild(e.domElement),e.parent=null),this}}class kpe{constructor(e=512){this.maxPoints=e,this.lines={},this.limit=0,this.limitIndex=0,this.domElement=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.domElement.setAttribute("class","graph-svg")}addLine(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("class","graph-path"),n.style.stroke=`var(${t})`,n.style.fill=`var(${t})`,this.domElement.appendChild(n),this.lines[e]={path:n,color:t,points:[]}}addPoint(e,t){const n=this.lines[e];n&&(n.points.push(t),n.points.length>this.maxPoints&&n.points.shift(),t>this.limit&&(this.limit=t,this.limitIndex=0))}resetLimit(){this.limit=0,this.limitIndex=0}update(){const e=this.domElement.clientWidth,t=this.domElement.clientHeight;if(e===0)return;const n=e/(this.maxPoints-1);for(const s in this.lines){const r=this.lines[s];let a=`M 0,${t}`;for(let l=0;l<r.points.length;l++){const c=l*n,u=t-r.points[l]/this.limit*t;a+=` L ${c},${u}`}a+=` L ${(r.points.length-1)*n},${t} Z`;const o=e-(r.points.length-1)*n;r.path.setAttribute("transform",`translate(${o}, 0)`),r.path.setAttribute("d",a)}this.limitIndex++>this.maxPoints&&this.resetLimit()}}class Da{constructor(...e){this.children=[],this.isOpen=!0,this.childrenContainer=null,this.parent=null,this.domElement=document.createElement("div"),this.domElement.className="list-item-wrapper",this.itemRow=document.createElement("div"),this.itemRow.className="list-item-row",this.userData={},this.data=e,this.data.forEach(t=>{const n=document.createElement("div");n.className="list-item-cell",t instanceof HTMLElement?n.appendChild(t):n.append(String(t)),this.itemRow.appendChild(n)}),this.domElement.appendChild(this.itemRow),this.onItemClick=this.onItemClick.bind(this)}onItemClick(e){e.target.closest("button, a, input, label")||this.toggle()}add(e,t=this.children.length){return e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.splice(t,0,e),this.itemRow.classList.add("collapsible"),this.childrenContainer||(this.childrenContainer=document.createElement("div"),this.childrenContainer.className="list-children-container",this.childrenContainer.classList.toggle("closed",!this.isOpen),this.domElement.appendChild(this.childrenContainer),this.itemRow.addEventListener("click",this.onItemClick)),this.childrenContainer.insertBefore(e.domElement,this.childrenContainer.children[t]||null),this.updateToggler(),this}remove(e){const t=this.children.indexOf(e);return t!==-1&&(this.children.splice(t,1),this.childrenContainer.removeChild(e.domElement),e.parent=null,this.children.length===0&&(this.itemRow.classList.remove("collapsible"),this.itemRow.removeEventListener("click",this.onItemClick),this.childrenContainer.remove(),this.childrenContainer=null),this.updateToggler()),this}updateToggler(){const e=this.itemRow.querySelector(".list-item-cell:first-child");let t=this.itemRow.querySelector(".item-toggler");this.children.length>0?(t||(t=document.createElement("span"),t.className="item-toggler",e.prepend(t)),this.isOpen&&this.itemRow.classList.add("open")):t&&t.remove()}toggle(){return this.isOpen=!this.isOpen,this.itemRow.classList.toggle("open",this.isOpen),this.childrenContainer&&this.childrenContainer.classList.toggle("closed",!this.isOpen),this}close(){return this.isOpen&&this.toggle(),this}}function br(i=null){const e=document.createElement("span");return e.className="value",i!==null&&(e.id=i),e}function Lo(i,e){const t=i instanceof HTMLElement?i:document.getElementById(i);t&&t.textContent!==e&&(t.textContent=e)}function Wpe(i){const e=i.lastIndexOf("/");if(e===-1)return{path:"",name:i.trim()};const t=i.substring(0,e).trim(),n=i.substring(e+1).trim();return{path:t,name:n}}function Xpe(i){return i.replace(/([a-z0-9])([A-Z])/g,"$1 $2").trim()}class qpe extends pw{constructor(e={}){super("Performance",e);const t=new ZP("Name","CPU","GPU","Total");t.setGridStyle("minmax(200px, 2fr) 80px 80px 80px"),t.domElement.style.minWidth="600px";const n=document.createElement("div");n.className="list-scroll-wrapper",n.appendChild(t.domElement),this.content.appendChild(n);const s=document.createElement("div");s.className="graph-container";const r=new kpe;r.addLine("fps","--accent-color"),s.append(r.domElement);const a=new Da("Graph Stats",br(),br(),br("graph-fps-counter"));t.add(a);const o=new Da(s);o.itemRow.childNodes[0].style.gridColumn="1 / -1",a.add(o);const l=new Da("Frame Stats",br(),br(),br());t.add(l);const c=new Da("Miscellaneous & Idle",br(),br(),br());c.domElement.firstChild.style.backgroundColor="#00ff0b1a",c.domElement.firstChild.classList.add("no-hover"),l.add(c),this.notInUse=new Map,this.frameStats=l,this.graphStats=a,this.graph=r,this.miscellaneous=c,this.currentRender=null,this.currentItem=null,this.frameItems=new Map}resolveStats(e,t){const n=e.getStatsData(t.cid);let s=n.item;if(s===void 0)s=new Da(br(),br(),br(),br()),t.name?t.isComputeStats===!0&&(t.name=`${t.name} [ Compute ]`):t.name=`Unnamed ${t.cid}`,s.userData.name=t.name,this.currentItem.add(s),n.item=s;else{s.userData.name=t.name,this.notInUse.has(t.cid)&&(s.domElement.firstElementChild.classList.remove("alert"),this.notInUse.delete(t.cid));const o=t.parent.children.indexOf(t);(s.parent===null||s.parent.children.indexOf(s)!==o)&&this.currentItem.add(s,o)}let r=s.userData.name;t.isComputeStats&&(r+=" [ Compute ]"),Lo(s.data[0],r),Lo(s.data[1],n.cpu.toFixed(2)),Lo(s.data[2],t.gpuNotAvailable===!0?"-":n.gpu.toFixed(2)),Lo(s.data[3],n.total.toFixed(2));const a=this.currentItem;this.currentItem=s;for(const o of t.children)this.resolveStats(e,o);this.currentItem=a,this.frameItems.set(t.cid,s)}updateGraph(e){this.graph.addPoint("fps",e.fps),this.graph.update()}addNotInUse(e,t){t.domElement.firstElementChild.classList.add("alert"),this.notInUse.set(e,{item:t,time:performance.now()}),this.updateNotInUse(e)}updateNotInUse(e){const{item:t,time:n}=this.notInUse.get(e),s=performance.now(),a=5-Math.floor((s-n)/1e3);if(a>=0){const o="*".repeat(Math.max(0,a)),l=t.domElement.querySelector(".list-item-cell .value");Lo(l,t.userData.name+" (not in use) "+o)}else t.domElement.firstElementChild.classList.remove("alert"),t.parent.remove(t),this.notInUse.delete(e)}updateText(e,t){const n=new Map(this.frameItems);this.frameItems.clear(),this.currentItem=this.frameStats;for(const s of t.children)this.resolveStats(e,s);for(const[s,r]of n)this.frameItems.has(s)||(this.addNotInUse(s,r),n.delete(s));for(const s of this.notInUse.keys())this.updateNotInUse(s);Lo("graph-fps-counter",e.fps.toFixed()+" FPS"),Lo(this.frameStats.data[1],t.cpu.toFixed(2)),Lo(this.frameStats.data[2],t.gpu.toFixed(2)),Lo(this.frameStats.data[3],t.total.toFixed(2)),Lo(this.miscellaneous.data[1],t.miscellaneous.toFixed(2)),Lo(this.miscellaneous.data[2],"-"),Lo(this.miscellaneous.data[3],t.miscellaneous.toFixed(2)),this.currentItem=null}}class jpe extends pw{constructor(e={}){super("Console",e),this.filters={info:!0,warn:!0,error:!0},this.filterText="",this.buildHeader(),this.logContainer=document.createElement("div"),this.logContainer.id="console-log",this.content.appendChild(this.logContainer)}buildHeader(){const e=document.createElement("div");e.className="console-header";const t=document.createElement("input");t.type="text",t.className="console-filter-input",t.placeholder="Filter...",t.addEventListener("input",s=>{this.filterText=s.target.value.toLowerCase(),this.applyFilters()});const n=document.createElement("div");n.className="console-filters-group",Object.keys(this.filters).forEach(s=>{const r=document.createElement("label");r.className="custom-checkbox",r.style.color=`var(--${s==="info"?"text-primary":"color-"+(s==="warn"?"yellow":"red")})`;const a=document.createElement("input");a.type="checkbox",a.checked=this.filters[s],a.dataset.type=s;const o=document.createElement("span");o.className="checkmark",r.appendChild(a),r.appendChild(o),r.append(s.charAt(0).toUpperCase()+s.slice(1)),n.appendChild(r)}),n.addEventListener("change",s=>{const r=s.target.dataset.type;r in this.filters&&(this.filters[r]=s.target.checked,this.applyFilters())}),e.appendChild(t),e.appendChild(n),this.content.appendChild(e)}applyFilters(){this.logContainer.querySelectorAll(".log-message").forEach(t=>{const n=t.dataset.type,s=t.dataset.rawText.toLowerCase(),r=this.filters[n],a=s.includes(this.filterText);t.classList.toggle("hidden",!(r&&a))})}_getIcon(e,t){let n;return t==="tip"?n="":t==="tsl"?n="":t==="webgpurenderer"?n="":e==="warn"?n="":e==="error"?n="":e==="info"&&(n=""),n}_formatMessage(e,t){const n=document.createDocumentFragment(),s=t.match(/^([\w\.]+:\s)/);let r=t;if(s){const o=s[0],l=o.slice(0,-2).split("."),c=(l.length>1?l[l.length-1]:l[0])+":",u=this._getIcon(e,c.split(":")[0].toLowerCase());n.appendChild(document.createTextNode(u+" "));const h=document.createElement("span");h.className="log-prefix",h.textContent=c,n.appendChild(h),r=t.substring(o.length)}const a=r.split(/(".*?"|'.*?'|`.*?`)/g).map(o=>o.trim()).filter(Boolean);return a.forEach((o,l)=>{if(/^("|'|`)/.test(o)){const c=document.createElement("span");c.className="log-code",c.textContent=o.slice(1,-1),n.appendChild(c)}else l>0&&(o=" "+o),l<a.length-1&&(o+=" "),n.appendChild(document.createTextNode(o))}),n}addMessage(e,t){const n=document.createElement("div");n.className=`log-message ${e}`,n.dataset.type=e,n.dataset.rawText=t,n.appendChild(this._formatMessage(e,t));const s=this.filters[e],r=t.toLowerCase().includes(this.filterText);n.classList.toggle("hidden",!(s&&r)),this.logContainer.appendChild(n),this.logContainer.scrollTop=this.logContainer.scrollHeight,this.logContainer.children.length>200&&this.logContainer.removeChild(this.logContainer.firstChild)}}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function AK(){let i=null,e=!1,t=null,n=null;function s(r,a){t(r,a),n=i.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(s),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){i=r}}}function Ype(i){const e=new WeakMap;function t(o,l){const c=o.array,u=o.usage,h=c.byteLength,f=i.createBuffer();i.bindBuffer(l,f),i.bufferData(l,c,u),o.onUploadCallback();let m;if(c instanceof Float32Array)m=i.FLOAT;else if(typeof Float16Array<"u"&&c instanceof Float16Array)m=i.HALF_FLOAT;else if(c instanceof Uint16Array)o.isFloat16BufferAttribute?m=i.HALF_FLOAT:m=i.UNSIGNED_SHORT;else if(c instanceof Int16Array)m=i.SHORT;else if(c instanceof Uint32Array)m=i.UNSIGNED_INT;else if(c instanceof Int32Array)m=i.INT;else if(c instanceof Int8Array)m=i.BYTE;else if(c instanceof Uint8Array)m=i.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)m=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:f,type:m,bytesPerElement:c.BYTES_PER_ELEMENT,version:o.version,size:h}}function n(o,l,c){const u=l.array,h=l.updateRanges;if(i.bindBuffer(c,o),h.length===0)i.bufferSubData(c,0,u);else{h.sort((m,g)=>m.start-g.start);let f=0;for(let m=1;m<h.length;m++){const g=h[f],x=h[m];x.start<=g.start+g.count+1?g.count=Math.max(g.count,x.start+x.count-g.start):(++f,h[f]=x)}h.length=f+1;for(let m=0,g=h.length;m<g;m++){const x=h[m];i.bufferSubData(c,x.start*u.BYTES_PER_ELEMENT,u,x.start,x.count)}l.clearUpdateRanges()}l.onUploadCallback()}function s(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function r(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=e.get(o);l&&(i.deleteBuffer(l.buffer),e.delete(o))}function a(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const u=e.get(o);(!u||u.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const c=e.get(o);if(c===void 0)e.set(o,t(o,l));else if(c.version<o.version){if(c.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(c.buffer,o,l),c.version=o.version}}return{get:s,remove:r,update:a}}var Kpe=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Zpe=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Jpe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Qpe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,$pe=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,eme=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,tme=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,nme=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,ime=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,sme=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,rme=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,ame=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,ome=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,lme=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,cme=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,ume=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,hme=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,dme=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,fme=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,pme=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,mme=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,gme=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,yme=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,xme=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,_me=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,vme=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,bme=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Sme=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Tme=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Ame=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Mme="gl_FragColor = linearToOutputTexel( gl_FragColor );",Eme=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Cme=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,wme=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,Rme=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Nme=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Bme=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Dme=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Lme=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Ume=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Ime=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Pme=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Ome=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Fme=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Gme=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,zme=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Vme=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Hme=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,kme=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Wme=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Xme=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,qme=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.diffuseContribution = diffuseColor.rgb * ( 1.0 - metalnessFactor );
material.metalness = metalnessFactor;
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor;
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = vec3( 0.04 );
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.0001, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,jme=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	vec3 diffuseContribution;
	vec3 specularColor;
	vec3 specularColorBlended;
	float roughness;
	float metalness;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
		vec3 iridescenceFresnelDielectric;
		vec3 iridescenceFresnelMetallic;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return v;
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColorBlended;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float rInv = 1.0 / ( roughness + 0.1 );
	float a = -1.9362 + 1.0678 * roughness + 0.4573 * r2 - 0.8469 * rInv;
	float b = -0.6014 + 0.5538 * roughness - 0.4670 * r2 - 0.1255 * rInv;
	float DG = exp( a * dotNV + b );
	return saturate( DG );
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = texture2D( dfgLUT, vec2( material.roughness, dotNV ) ).rg;
	vec2 dfgL = texture2D( dfgLUT, vec2( material.roughness, dotNL ) ).rg;
	vec3 FssEss_V = material.specularColorBlended * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColorBlended * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColorBlended + ( 1.0 - material.specularColorBlended ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColorBlended * t2.x + ( vec3( 1.0 ) - material.specularColorBlended ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseContribution * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
 
 		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
 
 		float sheenAlbedoV = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
 		float sheenAlbedoL = IBLSheenBRDF( geometryNormal, directLight.direction, material.sheenRoughness );
 
 		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * max( sheenAlbedoV, sheenAlbedoL );
 
 		irradiance *= sheenEnergyComp;
 
 	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseContribution );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 diffuse = irradiance * BRDF_Lambert( material.diffuseContribution );
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		diffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectDiffuse += diffuse;
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness ) * RECIPROCAL_PI;
 	#endif
	vec3 singleScatteringDielectric = vec3( 0.0 );
	vec3 multiScatteringDielectric = vec3( 0.0 );
	vec3 singleScatteringMetallic = vec3( 0.0 );
	vec3 multiScatteringMetallic = vec3( 0.0 );
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnelDielectric, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.iridescence, material.iridescenceFresnelMetallic, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscattering( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#endif
	vec3 singleScattering = mix( singleScatteringDielectric, singleScatteringMetallic, material.metalness );
	vec3 multiScattering = mix( multiScatteringDielectric, multiScatteringMetallic, material.metalness );
	vec3 totalScatteringDielectric = singleScatteringDielectric + multiScatteringDielectric;
	vec3 diffuse = material.diffuseContribution * ( 1.0 - totalScatteringDielectric );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	vec3 indirectSpecular = radiance * singleScattering;
	indirectSpecular += multiScattering * cosineWeightedIrradiance;
	vec3 indirectDiffuse = diffuse * cosineWeightedIrradiance;
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		indirectSpecular *= sheenEnergyComp;
		indirectDiffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectSpecular += indirectSpecular;
	reflectedLight.indirectDiffuse += indirectDiffuse;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Yme=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnelDielectric = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceFresnelMetallic = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.diffuseColor );
		material.iridescenceFresnel = mix( material.iridescenceFresnelDielectric, material.iridescenceFresnelMetallic, material.metalness );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS ) && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Kme=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Zme=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,Jme=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Qme=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,$me=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,ege=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,tge=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,nge=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,ige=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,sge=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,rge=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,age=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,oge=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,lge=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,cge=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,uge=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,hge=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,dge=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,fge=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,pge=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,mge=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,gge=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,yge=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,xge=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,_ge=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,vge=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,bge=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Sge=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Tge=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Age=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Mge=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Ege=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Cge=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,wge=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Rge=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Nge=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#else
			uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#endif
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#else
			uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#endif
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform samplerCubeShadow pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#elif defined( SHADOWMAP_TYPE_BASIC )
			uniform samplerCube pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#endif
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float interleavedGradientNoise( vec2 position ) {
			return fract( 52.9829189 * fract( dot( position, vec2( 0.06711056, 0.00583715 ) ) ) );
		}
		vec2 vogelDiskSample( int sampleIndex, int samplesCount, float phi ) {
			const float goldenAngle = 2.399963229728653;
			float r = sqrt( ( float( sampleIndex ) + 0.5 ) / float( samplesCount ) );
			float theta = float( sampleIndex ) * goldenAngle + phi;
			return vec2( cos( theta ), sin( theta ) ) * r;
		}
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float getShadow( sampler2DShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
				float radius = shadowRadius * texelSize.x;
				float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
				shadow = (
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 0, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 1, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 2, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 3, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 4, 5, phi ) * radius, shadowCoord.z ) )
				) * 0.2;
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#elif defined( SHADOWMAP_TYPE_VSM )
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 distribution = texture2D( shadowMap, shadowCoord.xy ).rg;
				float mean = distribution.x;
				float variance = distribution.y * distribution.y;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					float hard_shadow = step( mean, shadowCoord.z );
				#else
					float hard_shadow = step( shadowCoord.z, mean );
				#endif
				if ( hard_shadow == 1.0 ) {
					shadow = 1.0;
				} else {
					variance = max( variance, 0.0000001 );
					float d = shadowCoord.z - mean;
					float p_max = variance / ( variance + d * d );
					p_max = clamp( ( p_max - 0.3 ) / 0.65, 0.0, 1.0 );
					shadow = max( hard_shadow, p_max );
				}
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#else
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				float depth = texture2D( shadowMap, shadowCoord.xy ).r;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					shadow = step( depth, shadowCoord.z );
				#else
					shadow = step( shadowCoord.z, depth );
				#endif
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#if defined( SHADOWMAP_TYPE_PCF )
	float getPointShadow( samplerCubeShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float texelSize = shadowRadius / shadowMapSize.x;
			vec3 absDir = abs( bd3D );
			vec3 tangent = absDir.x > absDir.z ? vec3( 0.0, 1.0, 0.0 ) : vec3( 1.0, 0.0, 0.0 );
			tangent = normalize( cross( bd3D, tangent ) );
			vec3 bitangent = cross( bd3D, tangent );
			float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
			shadow = (
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 0, 5, phi ).x + bitangent * vogelDiskSample( 0, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 1, 5, phi ).x + bitangent * vogelDiskSample( 1, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 2, 5, phi ).x + bitangent * vogelDiskSample( 2, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 3, 5, phi ).x + bitangent * vogelDiskSample( 3, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 4, 5, phi ).x + bitangent * vogelDiskSample( 4, 5, phi ).y ) * texelSize, dp ) )
			) * 0.2;
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#elif defined( SHADOWMAP_TYPE_BASIC )
	float getPointShadow( samplerCube shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float depth = textureCube( shadowMap, bd3D ).r;
			#ifdef USE_REVERSED_DEPTH_BUFFER
				shadow = step( depth, dp );
			#else
				shadow = step( dp, depth );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#endif
	#endif
#endif`,Bge=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Dge=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Lge=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0 && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Uge=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Ige=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Pge=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Oge=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Fge=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Gge=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,zge=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Vge=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Hge=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseContribution, material.specularColorBlended, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,kge=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,Wge=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Xge=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,qge=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,jge=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Yge=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Kge=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Zge=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Jge=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Qge=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,$ge=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,e0e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,t0e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,n0e=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,i0e=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = vec4( dist, 0.0, 0.0, 1.0 );
}`,s0e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,r0e=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,a0e=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,o0e=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,l0e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,c0e=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,u0e=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,h0e=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,d0e=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,f0e=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,p0e=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,m0e=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( normalize( normal ) * 0.5 + 0.5, diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,g0e=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,y0e=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,x0e=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,_0e=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
 
		outgoingLight = outgoingLight + sheenSpecularDirect + sheenSpecularIndirect;
 
 	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,v0e=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,b0e=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,S0e=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,T0e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,A0e=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,M0e=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,E0e=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,C0e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,En={alphahash_fragment:Kpe,alphahash_pars_fragment:Zpe,alphamap_fragment:Jpe,alphamap_pars_fragment:Qpe,alphatest_fragment:$pe,alphatest_pars_fragment:eme,aomap_fragment:tme,aomap_pars_fragment:nme,batching_pars_vertex:ime,batching_vertex:sme,begin_vertex:rme,beginnormal_vertex:ame,bsdfs:ome,iridescence_fragment:lme,bumpmap_pars_fragment:cme,clipping_planes_fragment:ume,clipping_planes_pars_fragment:hme,clipping_planes_pars_vertex:dme,clipping_planes_vertex:fme,color_fragment:pme,color_pars_fragment:mme,color_pars_vertex:gme,color_vertex:yme,common:xme,cube_uv_reflection_fragment:_me,defaultnormal_vertex:vme,displacementmap_pars_vertex:bme,displacementmap_vertex:Sme,emissivemap_fragment:Tme,emissivemap_pars_fragment:Ame,colorspace_fragment:Mme,colorspace_pars_fragment:Eme,envmap_fragment:Cme,envmap_common_pars_fragment:wme,envmap_pars_fragment:Rme,envmap_pars_vertex:Nme,envmap_physical_pars_fragment:Vme,envmap_vertex:Bme,fog_vertex:Dme,fog_pars_vertex:Lme,fog_fragment:Ume,fog_pars_fragment:Ime,gradientmap_pars_fragment:Pme,lightmap_pars_fragment:Ome,lights_lambert_fragment:Fme,lights_lambert_pars_fragment:Gme,lights_pars_begin:zme,lights_toon_fragment:Hme,lights_toon_pars_fragment:kme,lights_phong_fragment:Wme,lights_phong_pars_fragment:Xme,lights_physical_fragment:qme,lights_physical_pars_fragment:jme,lights_fragment_begin:Yme,lights_fragment_maps:Kme,lights_fragment_end:Zme,logdepthbuf_fragment:Jme,logdepthbuf_pars_fragment:Qme,logdepthbuf_pars_vertex:$me,logdepthbuf_vertex:ege,map_fragment:tge,map_pars_fragment:nge,map_particle_fragment:ige,map_particle_pars_fragment:sge,metalnessmap_fragment:rge,metalnessmap_pars_fragment:age,morphinstance_vertex:oge,morphcolor_vertex:lge,morphnormal_vertex:cge,morphtarget_pars_vertex:uge,morphtarget_vertex:hge,normal_fragment_begin:dge,normal_fragment_maps:fge,normal_pars_fragment:pge,normal_pars_vertex:mge,normal_vertex:gge,normalmap_pars_fragment:yge,clearcoat_normal_fragment_begin:xge,clearcoat_normal_fragment_maps:_ge,clearcoat_pars_fragment:vge,iridescence_pars_fragment:bge,opaque_fragment:Sge,packing:Tge,premultiplied_alpha_fragment:Age,project_vertex:Mge,dithering_fragment:Ege,dithering_pars_fragment:Cge,roughnessmap_fragment:wge,roughnessmap_pars_fragment:Rge,shadowmap_pars_fragment:Nge,shadowmap_pars_vertex:Bge,shadowmap_vertex:Dge,shadowmask_pars_fragment:Lge,skinbase_vertex:Uge,skinning_pars_vertex:Ige,skinning_vertex:Pge,skinnormal_vertex:Oge,specularmap_fragment:Fge,specularmap_pars_fragment:Gge,tonemapping_fragment:zge,tonemapping_pars_fragment:Vge,transmission_fragment:Hge,transmission_pars_fragment:kge,uv_pars_fragment:Wge,uv_pars_vertex:Xge,uv_vertex:qge,worldpos_vertex:jge,background_vert:Yge,background_frag:Kge,backgroundCube_vert:Zge,backgroundCube_frag:Jge,cube_vert:Qge,cube_frag:$ge,depth_vert:e0e,depth_frag:t0e,distance_vert:n0e,distance_frag:i0e,equirect_vert:s0e,equirect_frag:r0e,linedashed_vert:a0e,linedashed_frag:o0e,meshbasic_vert:l0e,meshbasic_frag:c0e,meshlambert_vert:u0e,meshlambert_frag:h0e,meshmatcap_vert:d0e,meshmatcap_frag:f0e,meshnormal_vert:p0e,meshnormal_frag:m0e,meshphong_vert:g0e,meshphong_frag:y0e,meshphysical_vert:x0e,meshphysical_frag:_0e,meshtoon_vert:v0e,meshtoon_frag:b0e,points_vert:S0e,points_frag:T0e,shadow_vert:A0e,shadow_frag:M0e,sprite_vert:E0e,sprite_frag:C0e},Ot={common:{diffuse:{value:new Ye(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new gn},alphaMap:{value:null},alphaMapTransform:{value:new gn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new gn}},envmap:{envMap:{value:null},envMapRotation:{value:new gn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new gn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new gn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new gn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new gn},normalScale:{value:new Ae(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new gn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new gn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new gn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new gn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ye(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ye(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new gn},alphaTest:{value:0},uvTransform:{value:new gn}},sprite:{diffuse:{value:new Ye(16777215)},opacity:{value:1},center:{value:new Ae(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new gn},alphaMap:{value:null},alphaMapTransform:{value:new gn},alphaTest:{value:0}}},pc={basic:{uniforms:Ra([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.fog]),vertexShader:En.meshbasic_vert,fragmentShader:En.meshbasic_frag},lambert:{uniforms:Ra([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,Ot.lights,{emissive:{value:new Ye(0)}}]),vertexShader:En.meshlambert_vert,fragmentShader:En.meshlambert_frag},phong:{uniforms:Ra([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,Ot.lights,{emissive:{value:new Ye(0)},specular:{value:new Ye(1118481)},shininess:{value:30}}]),vertexShader:En.meshphong_vert,fragmentShader:En.meshphong_frag},standard:{uniforms:Ra([Ot.common,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.roughnessmap,Ot.metalnessmap,Ot.fog,Ot.lights,{emissive:{value:new Ye(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:En.meshphysical_vert,fragmentShader:En.meshphysical_frag},toon:{uniforms:Ra([Ot.common,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.gradientmap,Ot.fog,Ot.lights,{emissive:{value:new Ye(0)}}]),vertexShader:En.meshtoon_vert,fragmentShader:En.meshtoon_frag},matcap:{uniforms:Ra([Ot.common,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,{matcap:{value:null}}]),vertexShader:En.meshmatcap_vert,fragmentShader:En.meshmatcap_frag},points:{uniforms:Ra([Ot.points,Ot.fog]),vertexShader:En.points_vert,fragmentShader:En.points_frag},dashed:{uniforms:Ra([Ot.common,Ot.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:En.linedashed_vert,fragmentShader:En.linedashed_frag},depth:{uniforms:Ra([Ot.common,Ot.displacementmap]),vertexShader:En.depth_vert,fragmentShader:En.depth_frag},normal:{uniforms:Ra([Ot.common,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,{opacity:{value:1}}]),vertexShader:En.meshnormal_vert,fragmentShader:En.meshnormal_frag},sprite:{uniforms:Ra([Ot.sprite,Ot.fog]),vertexShader:En.sprite_vert,fragmentShader:En.sprite_frag},background:{uniforms:{uvTransform:{value:new gn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:En.background_vert,fragmentShader:En.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new gn}},vertexShader:En.backgroundCube_vert,fragmentShader:En.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:En.cube_vert,fragmentShader:En.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:En.equirect_vert,fragmentShader:En.equirect_frag},distance:{uniforms:Ra([Ot.common,Ot.displacementmap,{referencePosition:{value:new z},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:En.distance_vert,fragmentShader:En.distance_frag},shadow:{uniforms:Ra([Ot.lights,Ot.fog,{color:{value:new Ye(0)},opacity:{value:1}}]),vertexShader:En.shadow_vert,fragmentShader:En.shadow_frag}};pc.physical={uniforms:Ra([pc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new gn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new gn},clearcoatNormalScale:{value:new Ae(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new gn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new gn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new gn},sheen:{value:0},sheenColor:{value:new Ye(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new gn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new gn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new gn},transmissionSamplerSize:{value:new Ae},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new gn},attenuationDistance:{value:0},attenuationColor:{value:new Ye(0)},specularColor:{value:new Ye(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new gn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new gn},anisotropyVector:{value:new Ae},anisotropyMap:{value:null},anisotropyMapTransform:{value:new gn}}]),vertexShader:En.meshphysical_vert,fragmentShader:En.meshphysical_frag};const gA={r:0,b:0,g:0},jp=new Lr,w0e=new Lt;function R0e(i,e,t,n,s,r,a){const o=new Ye(0);let l=r===!0?0:1,c,u,h=null,f=0,m=null;function g(S){let T=S.isScene===!0?S.background:null;return T&&T.isTexture&&(T=(S.backgroundBlurriness>0?t:e).get(T)),T}function x(S){let T=!1;const M=g(S);M===null?y(o,l):M&&M.isColor&&(y(M,1),T=!0);const C=i.xr.getEnvironmentBlendMode();C==="additive"?n.buffers.color.setClear(0,0,0,1,a):C==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,a),(i.autoClear||T)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil))}function v(S,T){const M=g(T);M&&(M.isCubeTexture||M.mapping===du)?(u===void 0&&(u=new Kn(new Su(1,1,1),new Za({name:"BackgroundCubeMaterial",uniforms:qy(pc.backgroundCube.uniforms),vertexShader:pc.backgroundCube.vertexShader,fragmentShader:pc.backgroundCube.fragmentShader,side:hi,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(C,w,N){this.matrixWorld.copyPosition(N.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(u)),jp.copy(T.backgroundRotation),jp.x*=-1,jp.y*=-1,jp.z*=-1,M.isCubeTexture&&M.isRenderTargetTexture===!1&&(jp.y*=-1,jp.z*=-1),u.material.uniforms.envMap.value=M,u.material.uniforms.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=T.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=T.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(w0e.makeRotationFromEuler(jp)),u.material.toneMapped=en.getTransfer(M.colorSpace)!==Ft,(h!==M||f!==M.version||m!==i.toneMapping)&&(u.material.needsUpdate=!0,h=M,f=M.version,m=i.toneMapping),u.layers.enableAll(),S.unshift(u,u.geometry,u.material,0,0,null)):M&&M.isTexture&&(c===void 0&&(c=new Kn(new Cc(2,2),new Za({name:"BackgroundMaterial",uniforms:qy(pc.background.uniforms),vertexShader:pc.background.vertexShader,fragmentShader:pc.background.fragmentShader,side:jr,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(c)),c.material.uniforms.t2D.value=M,c.material.uniforms.backgroundIntensity.value=T.backgroundIntensity,c.material.toneMapped=en.getTransfer(M.colorSpace)!==Ft,M.matrixAutoUpdate===!0&&M.updateMatrix(),c.material.uniforms.uvTransform.value.copy(M.matrix),(h!==M||f!==M.version||m!==i.toneMapping)&&(c.material.needsUpdate=!0,h=M,f=M.version,m=i.toneMapping),c.layers.enableAll(),S.unshift(c,c.geometry,c.material,0,0,null))}function y(S,T){S.getRGB(gA,I9(i)),n.buffers.color.setClear(gA.r,gA.g,gA.b,T,a)}function b(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return o},setClearColor:function(S,T=1){o.set(S),l=T,y(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(S){l=S,y(o,l)},render:x,addToRenderList:v,dispose:b}}function N0e(i,e){const t=i.getParameter(i.MAX_VERTEX_ATTRIBS),n={},s=f(null);let r=s,a=!1;function o(B,U,H,F,V){let Y=!1;const P=h(F,H,U);r!==P&&(r=P,c(r.object)),Y=m(B,F,H,V),Y&&g(B,F,H,V),V!==null&&e.update(V,i.ELEMENT_ARRAY_BUFFER),(Y||a)&&(a=!1,T(B,U,H,F),V!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.get(V).buffer))}function l(){return i.createVertexArray()}function c(B){return i.bindVertexArray(B)}function u(B){return i.deleteVertexArray(B)}function h(B,U,H){const F=H.wireframe===!0;let V=n[B.id];V===void 0&&(V={},n[B.id]=V);let Y=V[U.id];Y===void 0&&(Y={},V[U.id]=Y);let P=Y[F];return P===void 0&&(P=f(l()),Y[F]=P),P}function f(B){const U=[],H=[],F=[];for(let V=0;V<t;V++)U[V]=0,H[V]=0,F[V]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:U,enabledAttributes:H,attributeDivisors:F,object:B,attributes:{},index:null}}function m(B,U,H,F){const V=r.attributes,Y=U.attributes;let P=0;const X=H.getAttributes();for(const J in X)if(X[J].location>=0){const ne=V[J];let ge=Y[J];if(ge===void 0&&(J==="instanceMatrix"&&B.instanceMatrix&&(ge=B.instanceMatrix),J==="instanceColor"&&B.instanceColor&&(ge=B.instanceColor)),ne===void 0||ne.attribute!==ge||ge&&ne.data!==ge.data)return!0;P++}return r.attributesNum!==P||r.index!==F}function g(B,U,H,F){const V={},Y=U.attributes;let P=0;const X=H.getAttributes();for(const J in X)if(X[J].location>=0){let ne=Y[J];ne===void 0&&(J==="instanceMatrix"&&B.instanceMatrix&&(ne=B.instanceMatrix),J==="instanceColor"&&B.instanceColor&&(ne=B.instanceColor));const ge={};ge.attribute=ne,ne&&ne.data&&(ge.data=ne.data),V[J]=ge,P++}r.attributes=V,r.attributesNum=P,r.index=F}function x(){const B=r.newAttributes;for(let U=0,H=B.length;U<H;U++)B[U]=0}function v(B){y(B,0)}function y(B,U){const H=r.newAttributes,F=r.enabledAttributes,V=r.attributeDivisors;H[B]=1,F[B]===0&&(i.enableVertexAttribArray(B),F[B]=1),V[B]!==U&&(i.vertexAttribDivisor(B,U),V[B]=U)}function b(){const B=r.newAttributes,U=r.enabledAttributes;for(let H=0,F=U.length;H<F;H++)U[H]!==B[H]&&(i.disableVertexAttribArray(H),U[H]=0)}function S(B,U,H,F,V,Y,P){P===!0?i.vertexAttribIPointer(B,U,H,V,Y):i.vertexAttribPointer(B,U,H,F,V,Y)}function T(B,U,H,F){x();const V=F.attributes,Y=H.getAttributes(),P=U.defaultAttributeValues;for(const X in Y){const J=Y[X];if(J.location>=0){let re=V[X];if(re===void 0&&(X==="instanceMatrix"&&B.instanceMatrix&&(re=B.instanceMatrix),X==="instanceColor"&&B.instanceColor&&(re=B.instanceColor)),re!==void 0){const ne=re.normalized,ge=re.itemSize,Te=e.get(re);if(Te===void 0)continue;const Be=Te.buffer,et=Te.type,wt=Te.bytesPerElement,be=et===i.INT||et===i.UNSIGNED_INT||re.gpuType===Is;if(re.isInterleavedBufferAttribute){const Re=re.data,tt=Re.stride,Bt=re.offset;if(Re.isInstancedInterleavedBuffer){for(let ht=0;ht<J.locationSize;ht++)y(J.location+ht,Re.meshPerAttribute);B.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=Re.meshPerAttribute*Re.count)}else for(let ht=0;ht<J.locationSize;ht++)v(J.location+ht);i.bindBuffer(i.ARRAY_BUFFER,Be);for(let ht=0;ht<J.locationSize;ht++)S(J.location+ht,ge/J.locationSize,et,ne,tt*wt,(Bt+ge/J.locationSize*ht)*wt,be)}else{if(re.isInstancedBufferAttribute){for(let Re=0;Re<J.locationSize;Re++)y(J.location+Re,re.meshPerAttribute);B.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=re.meshPerAttribute*re.count)}else for(let Re=0;Re<J.locationSize;Re++)v(J.location+Re);i.bindBuffer(i.ARRAY_BUFFER,Be);for(let Re=0;Re<J.locationSize;Re++)S(J.location+Re,ge/J.locationSize,et,ne,ge*wt,ge/J.locationSize*Re*wt,be)}}else if(P!==void 0){const ne=P[X];if(ne!==void 0)switch(ne.length){case 2:i.vertexAttrib2fv(J.location,ne);break;case 3:i.vertexAttrib3fv(J.location,ne);break;case 4:i.vertexAttrib4fv(J.location,ne);break;default:i.vertexAttrib1fv(J.location,ne)}}}}b()}function M(){N();for(const B in n){const U=n[B];for(const H in U){const F=U[H];for(const V in F)u(F[V].object),delete F[V];delete U[H]}delete n[B]}}function C(B){if(n[B.id]===void 0)return;const U=n[B.id];for(const H in U){const F=U[H];for(const V in F)u(F[V].object),delete F[V];delete U[H]}delete n[B.id]}function w(B){for(const U in n){const H=n[U];if(H[B.id]===void 0)continue;const F=H[B.id];for(const V in F)u(F[V].object),delete F[V];delete H[B.id]}}function N(){E(),a=!0,r!==s&&(r=s,c(r.object))}function E(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:o,reset:N,resetDefaultState:E,dispose:M,releaseStatesOfGeometry:C,releaseStatesOfProgram:w,initAttributes:x,enableAttribute:v,disableUnusedAttributes:b}}function B0e(i,e,t){let n;function s(c){n=c}function r(c,u){i.drawArrays(n,c,u),t.update(u,n,1)}function a(c,u,h){h!==0&&(i.drawArraysInstanced(n,c,u,h),t.update(u,n,h))}function o(c,u,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,c,0,u,0,h);let m=0;for(let g=0;g<h;g++)m+=u[g];t.update(m,n,1)}function l(c,u,h,f){if(h===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let g=0;g<c.length;g++)a(c[g],u[g],f[g]);else{m.multiDrawArraysInstancedWEBGL(n,c,0,u,0,f,0,h);let g=0;for(let x=0;x<h;x++)g+=u[x]*f[x];t.update(g,n,1)}}this.setMode=s,this.render=r,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function D0e(i,e,t,n){let s;function r(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const w=e.get("EXT_texture_filter_anisotropic");s=i.getParameter(w.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function a(w){return!(w!==ii&&n.convert(w)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(w){const N=w===ln&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(w!==ei&&n.convert(w)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)&&w!==Rn&&!N)}function l(w){if(w==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";w="mediump"}return w==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const u=l(c);u!==c&&(Se("WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const h=t.logarithmicDepthBuffer===!0,f=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),m=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),g=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),x=i.getParameter(i.MAX_TEXTURE_SIZE),v=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),y=i.getParameter(i.MAX_VERTEX_ATTRIBS),b=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),S=i.getParameter(i.MAX_VARYING_VECTORS),T=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),M=i.getParameter(i.MAX_SAMPLES),C=i.getParameter(i.SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:r,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:o,precision:c,logarithmicDepthBuffer:h,reversedDepthBuffer:f,maxTextures:m,maxVertexTextures:g,maxTextureSize:x,maxCubemapSize:v,maxAttributes:y,maxVertexUniforms:b,maxVaryings:S,maxFragmentUniforms:T,maxSamples:M,samples:C}}function L0e(i){const e=this;let t=null,n=0,s=!1,r=!1;const a=new El,o=new gn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,f){const m=h.length!==0||f||n!==0||s;return s=f,n=h.length,m},this.beginShadows=function(){r=!0,u(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(h,f){t=u(h,f,0)},this.setState=function(h,f,m){const g=h.clippingPlanes,x=h.clipIntersection,v=h.clipShadows,y=i.get(h);if(!s||g===null||g.length===0||r&&!v)r?u(null):c();else{const b=r?0:n,S=b*4;let T=y.clippingState||null;l.value=T,T=u(g,f,S,m);for(let M=0;M!==S;++M)T[M]=t[M];y.clippingState=T,this.numIntersection=x?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(h,f,m,g){const x=h!==null?h.length:0;let v=null;if(x!==0){if(v=l.value,g!==!0||v===null){const y=m+x*4,b=f.matrixWorldInverse;o.getNormalMatrix(b),(v===null||v.length<y)&&(v=new Float32Array(y));for(let S=0,T=m;S!==x;++S,T+=4)a.copy(h[S]).applyMatrix4(b,o),a.normal.toArray(v,T),v[T+3]=a.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=x,e.numIntersection=0,v}}function U0e(i){let e=new WeakMap;function t(a,o){return o===_c?a.mapping=Sa:o===wh&&(a.mapping=el),a}function n(a){if(a&&a.isTexture){const o=a.mapping;if(o===_c||o===wh)if(e.has(a)){const l=e.get(a).texture;return t(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new RS(l.height);return c.fromEquirectangularTexture(i,a),e.set(a,c),a.addEventListener("dispose",s),t(c.texture,a.mapping)}else return null}}return a}function s(a){const o=a.target;o.removeEventListener("dispose",s);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}const Hd=4,z5=[.125,.215,.35,.446,.526,.582],rm=20,I0e=256,Q_=new Dr,V5=new Ye;let F2=null,G2=0,z2=0,V2=!1;const P0e=new z;class r3{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,t=0,n=.1,s=100,r={}){const{size:a=256,position:o=P0e}=r;F2=this._renderer.getRenderTarget(),G2=this._renderer.getActiveCubeFace(),z2=this._renderer.getActiveMipmapLevel(),V2=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,n,s,l,o),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=W5(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=k5(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(F2,G2,z2),this._renderer.xr.enabled=V2,e.scissorTest=!1,L0(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Sa||e.mapping===el?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),F2=this._renderer.getRenderTarget(),G2=this._renderer.getActiveCubeFace(),z2=this._renderer.getActiveMipmapLevel(),V2=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Jt,minFilter:Jt,generateMipmaps:!1,type:ln,format:ii,colorSpace:Jr,depthBuffer:!1},s=H5(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=H5(e,t,n);const{_lodMax:r}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=O0e(r)),this._blurMaterial=G0e(r,e,t),this._ggxMaterial=F0e(r,e,t)}return s}_compileMaterial(e){const t=new Kn(new pn,e);this._renderer.compile(t,Q_)}_sceneToCubeUV(e,t,n,s,r){const l=new Ci(90,1,t,n),c=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],h=this._renderer,f=h.autoClear,m=h.toneMapping;h.getClearColor(V5),h.toneMapping=Ki,h.autoClear=!1,h.state.buffers.depth.getReversed()&&(h.setRenderTarget(s),h.clearDepth(),h.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new Kn(new Su,new Ts({name:"PMREM.Background",side:hi,depthWrite:!1,depthTest:!1})));const x=this._backgroundBox,v=x.material;let y=!1;const b=e.background;b?b.isColor&&(v.color.copy(b),e.background=null,y=!0):(v.color.copy(V5),y=!0);for(let S=0;S<6;S++){const T=S%3;T===0?(l.up.set(0,c[S],0),l.position.set(r.x,r.y,r.z),l.lookAt(r.x+u[S],r.y,r.z)):T===1?(l.up.set(0,0,c[S]),l.position.set(r.x,r.y,r.z),l.lookAt(r.x,r.y+u[S],r.z)):(l.up.set(0,c[S],0),l.position.set(r.x,r.y,r.z),l.lookAt(r.x,r.y,r.z+u[S]));const M=this._cubeSize;L0(s,T*M,S>2?M:0,M,M),h.setRenderTarget(s),y&&h.render(x,l),h.render(e,l)}h.toneMapping=m,h.autoClear=f,e.background=b}_textureToCubeUV(e,t){const n=this._renderer,s=e.mapping===Sa||e.mapping===el;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=W5()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=k5());const r=s?this._cubemapMaterial:this._equirectMaterial,a=this._lodMeshes[0];a.material=r;const o=r.uniforms;o.envMap.value=e;const l=this._cubeSize;L0(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(a,Q_)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const s=this._lodMeshes.length;for(let r=1;r<s;r++)this._applyGGXFilter(e,r-1,r);t.autoClear=n}_applyGGXFilter(e,t,n){const s=this._renderer,r=this._pingPongRenderTarget,a=this._ggxMaterial,o=this._lodMeshes[n];o.material=a;const l=a.uniforms,c=n/(this._lodMeshes.length-1),u=t/(this._lodMeshes.length-1),h=Math.sqrt(c*c-u*u),f=0+c*1.25,m=h*f,{_lodMax:g}=this,x=this._sizeLods[n],v=3*x*(n>g-Hd?n-g+Hd:0),y=4*(this._cubeSize-x);l.envMap.value=e.texture,l.roughness.value=m,l.mipInt.value=g-t,L0(r,v,y,3*x,2*x),s.setRenderTarget(r),s.render(o,Q_),l.envMap.value=r.texture,l.roughness.value=0,l.mipInt.value=g-n,L0(e,v,y,3*x,2*x),s.setRenderTarget(e),s.render(o,Q_)}_blur(e,t,n,s,r){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,s,"latitudinal",r),this._halfBlur(a,e,n,n,s,"longitudinal",r)}_halfBlur(e,t,n,s,r,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&De("blur direction must be either latitudinal or longitudinal!");const u=3,h=this._lodMeshes[s];h.material=c;const f=c.uniforms,m=this._sizeLods[n]-1,g=isFinite(r)?Math.PI/(2*m):2*Math.PI/(2*rm-1),x=r/g,v=isFinite(r)?1+Math.floor(u*x):rm;v>rm&&Se(`sigmaRadians, ${r}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${rm}`);const y=[];let b=0;for(let w=0;w<rm;++w){const N=w/x,E=Math.exp(-N*N/2);y.push(E),w===0?b+=E:w<v&&(b+=2*E)}for(let w=0;w<y.length;w++)y[w]=y[w]/b;f.envMap.value=e.texture,f.samples.value=v,f.weights.value=y,f.latitudinal.value=a==="latitudinal",o&&(f.poleAxis.value=o);const{_lodMax:S}=this;f.dTheta.value=g,f.mipInt.value=S-n;const T=this._sizeLods[s],M=3*T*(s>S-Hd?s-S+Hd:0),C=4*(this._cubeSize-T);L0(t,M,C,3*T,2*T),l.setRenderTarget(t),l.render(h,Q_)}}function O0e(i){const e=[],t=[],n=[];let s=i;const r=i-Hd+1+z5.length;for(let a=0;a<r;a++){const o=Math.pow(2,s);e.push(o);let l=1/o;a>i-Hd?l=z5[a-i+Hd-1]:a===0&&(l=0),t.push(l);const c=1/(o-2),u=-c,h=1+c,f=[u,u,h,u,h,h,u,u,h,h,u,h],m=6,g=6,x=3,v=2,y=1,b=new Float32Array(x*g*m),S=new Float32Array(v*g*m),T=new Float32Array(y*g*m);for(let C=0;C<m;C++){const w=C%3*2/3-1,N=C>2?0:-1,E=[w,N,0,w+2/3,N,0,w+2/3,N+1,0,w,N,0,w+2/3,N+1,0,w,N+1,0];b.set(E,x*g*C),S.set(f,v*g*C);const B=[C,C,C,C,C,C];T.set(B,y*g*C)}const M=new pn;M.setAttribute("position",new Nn(b,x)),M.setAttribute("uv",new Nn(S,v)),M.setAttribute("faceIndex",new Nn(T,y)),n.push(new Kn(M,null)),s>Hd&&s--}return{lodMeshes:n,sizeLods:e,sigmas:t}}function H5(i,e,t){const n=new xa(i,e,t);return n.texture.mapping=du,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function L0(i,e,t,n,s){i.viewport.set(e,t,n,s),i.scissor.set(e,t,n,s)}function F0e(i,e,t){return new Za({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:I0e,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:mw(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:Nr,depthTest:!1,depthWrite:!1})}function G0e(i,e,t){const n=new Float32Array(rm),s=new z(0,1,0);return new Za({name:"SphericalGaussianBlur",defines:{n:rm,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:mw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Nr,depthTest:!1,depthWrite:!1})}function k5(){return new Za({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:mw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Nr,depthTest:!1,depthWrite:!1})}function W5(){return new Za({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:mw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Nr,depthTest:!1,depthWrite:!1})}function mw(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function z0e(i){let e=new WeakMap,t=null;function n(o){if(o&&o.isTexture){const l=o.mapping,c=l===_c||l===wh,u=l===Sa||l===el;if(c||u){let h=e.get(o);const f=h!==void 0?h.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==f)return t===null&&(t=new r3(i)),h=c?t.fromEquirectangular(o,h):t.fromCubemap(o,h),h.texture.pmremVersion=o.pmremVersion,e.set(o,h),h.texture;if(h!==void 0)return h.texture;{const m=o.image;return c&&m&&m.height>0||u&&m&&s(m)?(t===null&&(t=new r3(i)),h=c?t.fromEquirectangular(o):t.fromCubemap(o),h.texture.pmremVersion=o.pmremVersion,e.set(o,h),o.addEventListener("dispose",r),h.texture):null}}}return o}function s(o){let l=0;const c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function r(o){const l=o.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:a}}function V0e(i){const e={};function t(n){if(e[n]!==void 0)return e[n];const s=i.getExtension(n);return e[n]=s,s}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const s=t(n);return s===null&&oi("WebGLRenderer: "+n+" extension not supported."),s}}}function H0e(i,e,t,n){const s={},r=new WeakMap;function a(h){const f=h.target;f.index!==null&&e.remove(f.index);for(const g in f.attributes)e.remove(f.attributes[g]);f.removeEventListener("dispose",a),delete s[f.id];const m=r.get(f);m&&(e.remove(m),r.delete(f)),n.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function o(h,f){return s[f.id]===!0||(f.addEventListener("dispose",a),s[f.id]=!0,t.memory.geometries++),f}function l(h){const f=h.attributes;for(const m in f)e.update(f[m],i.ARRAY_BUFFER)}function c(h){const f=[],m=h.index,g=h.attributes.position;let x=0;if(m!==null){const b=m.array;x=m.version;for(let S=0,T=b.length;S<T;S+=3){const M=b[S+0],C=b[S+1],w=b[S+2];f.push(M,C,C,w,w,M)}}else if(g!==void 0){const b=g.array;x=g.version;for(let S=0,T=b.length/3-1;S<T;S+=3){const M=S+0,C=S+1,w=S+2;f.push(M,C,C,w,w,M)}}else return;const v=new(mU(f)?wS:CS)(f,1);v.version=x;const y=r.get(h);y&&e.remove(y),r.set(h,v)}function u(h){const f=r.get(h);if(f){const m=h.index;m!==null&&f.version<m.version&&c(h)}else c(h);return r.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function k0e(i,e,t){let n;function s(f){n=f}let r,a;function o(f){r=f.type,a=f.bytesPerElement}function l(f,m){i.drawElements(n,m,r,f*a),t.update(m,n,1)}function c(f,m,g){g!==0&&(i.drawElementsInstanced(n,m,r,f*a,g),t.update(m,n,g))}function u(f,m,g){if(g===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,m,0,r,f,0,g);let v=0;for(let y=0;y<g;y++)v+=m[y];t.update(v,n,1)}function h(f,m,g,x){if(g===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let y=0;y<f.length;y++)c(f[y]/a,m[y],x[y]);else{v.multiDrawElementsInstancedWEBGL(n,m,0,r,f,0,x,0,g);let y=0;for(let b=0;b<g;b++)y+=m[b]*x[b];t.update(y,n,1)}}this.setMode=s,this.setIndex=o,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function W0e(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,a,o){switch(t.calls++,a){case i.TRIANGLES:t.triangles+=o*(r/3);break;case i.LINES:t.lines+=o*(r/2);break;case i.LINE_STRIP:t.lines+=o*(r-1);break;case i.LINE_LOOP:t.lines+=o*r;break;case i.POINTS:t.points+=o*r;break;default:De("WebGLInfo: Unknown draw mode:",a);break}}function s(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:n}}function X0e(i,e,t){const n=new WeakMap,s=new un;function r(a,o,l){const c=a.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,h=u!==void 0?u.length:0;let f=n.get(o);if(f===void 0||f.count!==h){let B=function(){N.dispose(),n.delete(o),o.removeEventListener("dispose",B)};var m=B;f!==void 0&&f.texture.dispose();const g=o.morphAttributes.position!==void 0,x=o.morphAttributes.normal!==void 0,v=o.morphAttributes.color!==void 0,y=o.morphAttributes.position||[],b=o.morphAttributes.normal||[],S=o.morphAttributes.color||[];let T=0;g===!0&&(T=1),x===!0&&(T=2),v===!0&&(T=3);let M=o.attributes.position.count*T,C=1;M>e.maxTextureSize&&(C=Math.ceil(M/e.maxTextureSize),M=e.maxTextureSize);const w=new Float32Array(M*C*4*h),N=new Ex(w,M,C,h);N.type=Rn,N.needsUpdate=!0;const E=T*4;for(let U=0;U<h;U++){const H=y[U],F=b[U],V=S[U],Y=M*C*4*U;for(let P=0;P<H.count;P++){const X=P*E;g===!0&&(s.fromBufferAttribute(H,P),w[Y+X+0]=s.x,w[Y+X+1]=s.y,w[Y+X+2]=s.z,w[Y+X+3]=0),x===!0&&(s.fromBufferAttribute(F,P),w[Y+X+4]=s.x,w[Y+X+5]=s.y,w[Y+X+6]=s.z,w[Y+X+7]=0),v===!0&&(s.fromBufferAttribute(V,P),w[Y+X+8]=s.x,w[Y+X+9]=s.y,w[Y+X+10]=s.z,w[Y+X+11]=V.itemSize===4?s.w:1)}}f={count:h,texture:N,size:new Ae(M,C)},n.set(o,f),o.addEventListener("dispose",B)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(i,"morphTexture",a.morphTexture,t);else{let g=0;for(let v=0;v<c.length;v++)g+=c[v];const x=o.morphTargetsRelative?1:1-g;l.getUniforms().setValue(i,"morphTargetBaseInfluence",x),l.getUniforms().setValue(i,"morphTargetInfluences",c)}l.getUniforms().setValue(i,"morphTargetsTexture",f.texture,t),l.getUniforms().setValue(i,"morphTargetsTextureSize",f.size)}return{update:r}}function q0e(i,e,t,n){let s=new WeakMap;function r(l){const c=n.render.frame,u=l.geometry,h=e.get(l,u);if(s.get(h)!==c&&(e.update(h),s.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),s.get(l)!==c&&(t.update(l.instanceMatrix,i.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,i.ARRAY_BUFFER),s.set(l,c))),l.isSkinnedMesh){const f=l.skeleton;s.get(f)!==c&&(f.update(),s.set(f,c))}return h}function a(){s=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:a}}const j0e={[yx]:"LINEAR_TONE_MAPPING",[xx]:"REINHARD_TONE_MAPPING",[_x]:"CINEON_TONE_MAPPING",[pg]:"ACES_FILMIC_TONE_MAPPING",[vx]:"AGX_TONE_MAPPING",[bx]:"NEUTRAL_TONE_MAPPING",[kE]:"CUSTOM_TONE_MAPPING"};function Y0e(i,e,t,n,s){const r=new xa(e,t,{type:i,depthBuffer:n,stencilBuffer:s}),a=new xa(e,t,{type:ln,depthBuffer:!1,stencilBuffer:!1}),o=new pn;o.setAttribute("position",new qt([-1,3,0,-1,-1,0,3,-1,0],3)),o.setAttribute("uv",new qt([0,2,0,0,2,0],2));const l=new cC({uniforms:{tDiffuse:{value:null}},vertexShader:`
			precision highp float;

			uniform mat4 modelViewMatrix;
			uniform mat4 projectionMatrix;

			attribute vec3 position;
			attribute vec2 uv;

			varying vec2 vUv;

			void main() {
				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}`,fragmentShader:`
			precision highp float;

			uniform sampler2D tDiffuse;

			varying vec2 vUv;

			#include <tonemapping_pars_fragment>
			#include <colorspace_pars_fragment>

			void main() {
				gl_FragColor = texture2D( tDiffuse, vUv );

				#ifdef LINEAR_TONE_MAPPING
					gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );
				#elif defined( REINHARD_TONE_MAPPING )
					gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );
				#elif defined( CINEON_TONE_MAPPING )
					gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );
				#elif defined( ACES_FILMIC_TONE_MAPPING )
					gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );
				#elif defined( AGX_TONE_MAPPING )
					gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );
				#elif defined( NEUTRAL_TONE_MAPPING )
					gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );
				#elif defined( CUSTOM_TONE_MAPPING )
					gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );
				#endif

				#ifdef SRGB_TRANSFER
					gl_FragColor = sRGBTransferOETF( gl_FragColor );
				#endif
			}`,depthTest:!1,depthWrite:!1}),c=new Kn(o,l),u=new Dr(-1,1,1,-1,0,1);let h=null,f=null,m=!1,g,x=null,v=[],y=!1;this.setSize=function(b,S){r.setSize(b,S),a.setSize(b,S);for(let T=0;T<v.length;T++){const M=v[T];M.setSize&&M.setSize(b,S)}},this.setEffects=function(b){v=b,y=v.length>0&&v[0].isRenderPass===!0;const S=r.width,T=r.height;for(let M=0;M<v.length;M++){const C=v[M];C.setSize&&C.setSize(S,T)}},this.begin=function(b,S){if(m||b.toneMapping===Ki&&v.length===0)return!1;if(x=S,S!==null){const T=S.width,M=S.height;(r.width!==T||r.height!==M)&&this.setSize(T,M)}return y===!1&&b.setRenderTarget(r),g=b.toneMapping,b.toneMapping=Ki,!0},this.hasRenderPass=function(){return y},this.end=function(b,S){b.toneMapping=g,m=!0;let T=r,M=a;for(let C=0;C<v.length;C++){const w=v[C];if(w.enabled!==!1&&(w.render(b,M,T,S),w.needsSwap!==!1)){const N=T;T=M,M=N}}if(h!==b.outputColorSpace||f!==b.toneMapping){h=b.outputColorSpace,f=b.toneMapping,l.defines={},en.getTransfer(h)===Ft&&(l.defines.SRGB_TRANSFER="");const C=j0e[f];C&&(l.defines[C]=""),l.needsUpdate=!0}l.uniforms.tDiffuse.value=T.texture,b.setRenderTarget(x),b.render(c,u),x=null,m=!1},this.isCompositing=function(){return m},this.dispose=function(){r.dispose(),a.dispose(),o.dispose(),l.dispose()}}const MK=new In,a3=new tr(1,1),EK=new Ex,CK=new ES,wK=new Gh,X5=[],q5=[],j5=new Float32Array(16),Y5=new Float32Array(9),K5=new Float32Array(4);function kx(i,e,t){const n=i[0];if(n<=0||n>0)return i;const s=e*t;let r=X5[s];if(r===void 0&&(r=new Float32Array(s),X5[s]=r),e!==0){n.toArray(r,0);for(let a=1,o=0;a!==e;++a)o+=t,i[a].toArray(r,o)}return r}function hr(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function dr(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function gw(i,e){let t=q5[e];t===void 0&&(t=new Int32Array(e),q5[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function K0e(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function Z0e(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(hr(t,e))return;i.uniform2fv(this.addr,e),dr(t,e)}}function J0e(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(hr(t,e))return;i.uniform3fv(this.addr,e),dr(t,e)}}function Q0e(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(hr(t,e))return;i.uniform4fv(this.addr,e),dr(t,e)}}function $0e(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(hr(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),dr(t,e)}else{if(hr(t,n))return;K5.set(n),i.uniformMatrix2fv(this.addr,!1,K5),dr(t,n)}}function eye(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(hr(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),dr(t,e)}else{if(hr(t,n))return;Y5.set(n),i.uniformMatrix3fv(this.addr,!1,Y5),dr(t,n)}}function tye(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(hr(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),dr(t,e)}else{if(hr(t,n))return;j5.set(n),i.uniformMatrix4fv(this.addr,!1,j5),dr(t,n)}}function nye(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function iye(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(hr(t,e))return;i.uniform2iv(this.addr,e),dr(t,e)}}function sye(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(hr(t,e))return;i.uniform3iv(this.addr,e),dr(t,e)}}function rye(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(hr(t,e))return;i.uniform4iv(this.addr,e),dr(t,e)}}function aye(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function oye(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(hr(t,e))return;i.uniform2uiv(this.addr,e),dr(t,e)}}function lye(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(hr(t,e))return;i.uniform3uiv(this.addr,e),dr(t,e)}}function cye(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(hr(t,e))return;i.uniform4uiv(this.addr,e),dr(t,e)}}function uye(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s);let r;this.type===i.SAMPLER_2D_SHADOW?(a3.compareFunction=t.isReversedDepthBuffer()?_g:xg,r=a3):r=MK,t.setTexture2D(e||r,s)}function hye(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture3D(e||CK,s)}function dye(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTextureCube(e||wK,s)}function fye(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture2DArray(e||EK,s)}function pye(i){switch(i){case 5126:return K0e;case 35664:return Z0e;case 35665:return J0e;case 35666:return Q0e;case 35674:return $0e;case 35675:return eye;case 35676:return tye;case 5124:case 35670:return nye;case 35667:case 35671:return iye;case 35668:case 35672:return sye;case 35669:case 35673:return rye;case 5125:return aye;case 36294:return oye;case 36295:return lye;case 36296:return cye;case 35678:case 36198:case 36298:case 36306:case 35682:return uye;case 35679:case 36299:case 36307:return hye;case 35680:case 36300:case 36308:case 36293:return dye;case 36289:case 36303:case 36311:case 36292:return fye}}function mye(i,e){i.uniform1fv(this.addr,e)}function gye(i,e){const t=kx(e,this.size,2);i.uniform2fv(this.addr,t)}function yye(i,e){const t=kx(e,this.size,3);i.uniform3fv(this.addr,t)}function xye(i,e){const t=kx(e,this.size,4);i.uniform4fv(this.addr,t)}function _ye(i,e){const t=kx(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function vye(i,e){const t=kx(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function bye(i,e){const t=kx(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function Sye(i,e){i.uniform1iv(this.addr,e)}function Tye(i,e){i.uniform2iv(this.addr,e)}function Aye(i,e){i.uniform3iv(this.addr,e)}function Mye(i,e){i.uniform4iv(this.addr,e)}function Eye(i,e){i.uniform1uiv(this.addr,e)}function Cye(i,e){i.uniform2uiv(this.addr,e)}function wye(i,e){i.uniform3uiv(this.addr,e)}function Rye(i,e){i.uniform4uiv(this.addr,e)}function Nye(i,e,t){const n=this.cache,s=e.length,r=gw(t,s);hr(n,r)||(i.uniform1iv(this.addr,r),dr(n,r));let a;this.type===i.SAMPLER_2D_SHADOW?a=a3:a=MK;for(let o=0;o!==s;++o)t.setTexture2D(e[o]||a,r[o])}function Bye(i,e,t){const n=this.cache,s=e.length,r=gw(t,s);hr(n,r)||(i.uniform1iv(this.addr,r),dr(n,r));for(let a=0;a!==s;++a)t.setTexture3D(e[a]||CK,r[a])}function Dye(i,e,t){const n=this.cache,s=e.length,r=gw(t,s);hr(n,r)||(i.uniform1iv(this.addr,r),dr(n,r));for(let a=0;a!==s;++a)t.setTextureCube(e[a]||wK,r[a])}function Lye(i,e,t){const n=this.cache,s=e.length,r=gw(t,s);hr(n,r)||(i.uniform1iv(this.addr,r),dr(n,r));for(let a=0;a!==s;++a)t.setTexture2DArray(e[a]||EK,r[a])}function Uye(i){switch(i){case 5126:return mye;case 35664:return gye;case 35665:return yye;case 35666:return xye;case 35674:return _ye;case 35675:return vye;case 35676:return bye;case 5124:case 35670:return Sye;case 35667:case 35671:return Tye;case 35668:case 35672:return Aye;case 35669:case 35673:return Mye;case 5125:return Eye;case 36294:return Cye;case 36295:return wye;case 36296:return Rye;case 35678:case 36198:case 36298:case 36306:case 35682:return Nye;case 35679:case 36299:case 36307:return Bye;case 35680:case 36300:case 36308:case 36293:return Dye;case 36289:case 36303:case 36311:case 36292:return Lye}}class Iye{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=pye(t.type)}}class Pye{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=Uye(t.type)}}class Oye{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const s=this.seq;for(let r=0,a=s.length;r!==a;++r){const o=s[r];o.setValue(e,t[o.id],n)}}}const H2=/(\w+)(\])?(\[|\.)?/g;function Z5(i,e){i.seq.push(e),i.map[e.id]=e}function Fye(i,e,t){const n=i.name,s=n.length;for(H2.lastIndex=0;;){const r=H2.exec(n),a=H2.lastIndex;let o=r[1];const l=r[2]==="]",c=r[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===s){Z5(t,c===void 0?new Iye(o,i,e):new Pye(o,i,e));break}else{let h=t.map[o];h===void 0&&(h=new Oye(o),Z5(t,h)),t=h}}}class YA{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let a=0;a<n;++a){const o=e.getActiveUniform(t,a),l=e.getUniformLocation(t,o.name);Fye(o,l,this)}const s=[],r=[];for(const a of this.seq)a.type===e.SAMPLER_2D_SHADOW||a.type===e.SAMPLER_CUBE_SHADOW||a.type===e.SAMPLER_2D_ARRAY_SHADOW?s.push(a):r.push(a);s.length>0&&(this.seq=s.concat(r))}setValue(e,t,n,s){const r=this.map[t];r!==void 0&&r.setValue(e,n,s)}setOptional(e,t,n){const s=t[n];s!==void 0&&this.setValue(e,n,s)}static upload(e,t,n,s){for(let r=0,a=t.length;r!==a;++r){const o=t[r],l=n[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,s)}}static seqWithValue(e,t){const n=[];for(let s=0,r=e.length;s!==r;++s){const a=e[s];a.id in t&&n.push(a)}return n}}function J5(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const Gye=37297;let zye=0;function Vye(i,e){const t=i.split(`
`),n=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let a=s;a<r;a++){const o=a+1;n.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return n.join(`
`)}const Q5=new gn;function Hye(i){en._getMatrix(Q5,en.workingColorSpace,i);const e=`mat3( ${Q5.elements.map(t=>t.toFixed(4))} )`;switch(en.getTransfer(i)){case Of:return[e,"LinearTransferOETF"];case Ft:return[e,"sRGBTransferOETF"];default:return Se("WebGLProgram: Unsupported color space: ",i),[e,"LinearTransferOETF"]}}function $5(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),r=(i.getShaderInfoLog(e)||"").trim();if(n&&r==="")return"";const a=/ERROR: 0:(\d+)/.exec(r);if(a){const o=parseInt(a[1]);return t.toUpperCase()+`

`+r+`

`+Vye(i.getShaderSource(e),o)}else return r}function kye(i,e){const t=Hye(e);return[`vec4 ${i}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}const Wye={[yx]:"Linear",[xx]:"Reinhard",[_x]:"Cineon",[pg]:"ACESFilmic",[vx]:"AgX",[bx]:"Neutral",[kE]:"Custom"};function Xye(i,e){const t=Wye[e];return t===void 0?(Se("WebGLProgram: Unsupported toneMapping:",e),"vec3 "+i+"( vec3 color ) { return LinearToneMapping( color ); }"):"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const yA=new z;function qye(){en.getLuminanceCoefficients(yA);const i=yA.x.toFixed(4),e=yA.y.toFixed(4),t=yA.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${i}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function jye(i){return[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",i.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(pv).join(`
`)}function Yye(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function Kye(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){const r=i.getActiveAttrib(e,s),a=r.name;let o=1;r.type===i.FLOAT_MAT2&&(o=2),r.type===i.FLOAT_MAT3&&(o=3),r.type===i.FLOAT_MAT4&&(o=4),t[a]={type:r.type,location:i.getAttribLocation(e,a),locationSize:o}}return t}function pv(i){return i!==""}function eH(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function tH(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Zye=/^[ \t]*#include +<([\w\d./]+)>/gm;function o3(i){return i.replace(Zye,Qye)}const Jye=new Map;function Qye(i,e){let t=En[e];if(t===void 0){const n=Jye.get(e);if(n!==void 0)t=En[n],Se('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return o3(t)}const $ye=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function nH(i){return i.replace($ye,exe)}function exe(i,e,t,n){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function iH(i){let e=`precision ${i.precision} float;
	precision ${i.precision} int;
	precision ${i.precision} sampler2D;
	precision ${i.precision} samplerCube;
	precision ${i.precision} sampler3D;
	precision ${i.precision} sampler2DArray;
	precision ${i.precision} sampler2DShadow;
	precision ${i.precision} samplerCubeShadow;
	precision ${i.precision} sampler2DArrayShadow;
	precision ${i.precision} isampler2D;
	precision ${i.precision} isampler3D;
	precision ${i.precision} isamplerCube;
	precision ${i.precision} isampler2DArray;
	precision ${i.precision} usampler2D;
	precision ${i.precision} usampler3D;
	precision ${i.precision} usamplerCube;
	precision ${i.precision} usampler2DArray;
	`;return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}const txe={[tf]:"SHADOWMAP_TYPE_PCF",[Dl]:"SHADOWMAP_TYPE_VSM"};function nxe(i){return txe[i.shadowMapType]||"SHADOWMAP_TYPE_BASIC"}const ixe={[Sa]:"ENVMAP_TYPE_CUBE",[el]:"ENVMAP_TYPE_CUBE",[du]:"ENVMAP_TYPE_CUBE_UV"};function sxe(i){return i.envMap===!1?"ENVMAP_TYPE_CUBE":ixe[i.envMapMode]||"ENVMAP_TYPE_CUBE"}const rxe={[el]:"ENVMAP_MODE_REFRACTION"};function axe(i){return i.envMap===!1?"ENVMAP_MODE_REFLECTION":rxe[i.envMapMode]||"ENVMAP_MODE_REFLECTION"}const oxe={[fg]:"ENVMAP_BLENDING_MULTIPLY",[VE]:"ENVMAP_BLENDING_MIX",[HE]:"ENVMAP_BLENDING_ADD"};function lxe(i){return i.envMap===!1?"ENVMAP_BLENDING_NONE":oxe[i.combine]||"ENVMAP_BLENDING_NONE"}function cxe(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function uxe(i,e,t,n){const s=i.getContext(),r=t.defines;let a=t.vertexShader,o=t.fragmentShader;const l=nxe(t),c=sxe(t),u=axe(t),h=lxe(t),f=cxe(t),m=jye(t),g=Yye(r),x=s.createProgram();let v,y,b=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(pv).join(`
`),v.length>0&&(v+=`
`),y=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(pv).join(`
`),y.length>0&&(y+=`
`)):(v=[iH(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(pv).join(`
`),y=[iH(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Ki?"#define TONE_MAPPING":"",t.toneMapping!==Ki?En.tonemapping_pars_fragment:"",t.toneMapping!==Ki?Xye("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",En.colorspace_pars_fragment,kye("linearToOutputTexel",t.outputColorSpace),qye(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(pv).join(`
`)),a=o3(a),a=eH(a,t),a=tH(a,t),o=o3(o),o=eH(o,t),o=tH(o,t),a=nH(a),o=nH(o),t.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,v=[m,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,y=["#define varying in",t.glslVersion===BM?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===BM?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const S=b+v+a,T=b+y+o,M=J5(s,s.VERTEX_SHADER,S),C=J5(s,s.FRAGMENT_SHADER,T);s.attachShader(x,M),s.attachShader(x,C),t.index0AttributeName!==void 0?s.bindAttribLocation(x,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(x,0,"position"),s.linkProgram(x);function w(U){if(i.debug.checkShaderErrors){const H=s.getProgramInfoLog(x)||"",F=s.getShaderInfoLog(M)||"",V=s.getShaderInfoLog(C)||"",Y=H.trim(),P=F.trim(),X=V.trim();let J=!0,re=!0;if(s.getProgramParameter(x,s.LINK_STATUS)===!1)if(J=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(s,x,M,C);else{const ne=$5(s,M,"vertex"),ge=$5(s,C,"fragment");De("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(x,s.VALIDATE_STATUS)+`

Material Name: `+U.name+`
Material Type: `+U.type+`

Program Info Log: `+Y+`
`+ne+`
`+ge)}else Y!==""?Se("WebGLProgram: Program Info Log:",Y):(P===""||X==="")&&(re=!1);re&&(U.diagnostics={runnable:J,programLog:Y,vertexShader:{log:P,prefix:v},fragmentShader:{log:X,prefix:y}})}s.deleteShader(M),s.deleteShader(C),N=new YA(s,x),E=Kye(s,x)}let N;this.getUniforms=function(){return N===void 0&&w(this),N};let E;this.getAttributes=function(){return E===void 0&&w(this),E};let B=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return B===!1&&(B=s.getProgramParameter(x,Gye)),B},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(x),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=zye++,this.cacheKey=e,this.usedTimes=1,this.program=x,this.vertexShader=M,this.fragmentShader=C,this}let hxe=0;class dxe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return a.has(s)===!1&&(a.add(s),s.usedTimes++),a.has(r)===!1&&(a.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new fxe(e),t.set(e,n)),n}}class fxe{constructor(e){this.id=hxe++,this.code=e,this.usedTimes=0}}function pxe(i,e,t,n,s,r,a){const o=new $m,l=new dxe,c=new Set,u=[],h=new Map,f=s.logarithmicDepthBuffer;let m=s.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distance",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function x(E){return c.add(E),E===0?"uv":`uv${E}`}function v(E,B,U,H,F){const V=H.fog,Y=F.geometry,P=E.isMeshStandardMaterial?H.environment:null,X=(E.isMeshStandardMaterial?t:e).get(E.envMap||P),J=X&&X.mapping===du?X.image.height:null,re=g[E.type];E.precision!==null&&(m=s.getMaxPrecision(E.precision),m!==E.precision&&Se("WebGLProgram.getParameters:",E.precision,"not supported, using",m,"instead."));const ne=Y.morphAttributes.position||Y.morphAttributes.normal||Y.morphAttributes.color,ge=ne!==void 0?ne.length:0;let Te=0;Y.morphAttributes.position!==void 0&&(Te=1),Y.morphAttributes.normal!==void 0&&(Te=2),Y.morphAttributes.color!==void 0&&(Te=3);let Be,et,wt,be;if(re){const xn=pc[re];Be=xn.vertexShader,et=xn.fragmentShader}else Be=E.vertexShader,et=E.fragmentShader,l.update(E),wt=l.getVertexShaderID(E),be=l.getFragmentShaderID(E);const Re=i.getRenderTarget(),tt=i.state.buffers.depth.getReversed(),Bt=F.isInstancedMesh===!0,ht=F.isBatchedMesh===!0,Ke=!!E.map,jt=!!E.matcap,Mt=!!X,Ie=!!E.aoMap,ke=!!E.lightMap,Ve=!!E.bumpMap,at=!!E.normalMap,Z=!!E.displacementMap,zt=!!E.emissiveMap,st=!!E.metalnessMap,Vt=!!E.roughnessMap,Je=E.anisotropy>0,K=E.clearcoat>0,I=E.dispersion>0,ue=E.iridescence>0,Ne=E.sheen>0,ze=E.transmission>0,we=Je&&!!E.anisotropyMap,Ut=K&&!!E.clearcoatMap,dt=K&&!!E.clearcoatNormalMap,Pt=K&&!!E.clearcoatRoughnessMap,Qt=ue&&!!E.iridescenceMap,Xe=ue&&!!E.iridescenceThicknessMap,Qe=Ne&&!!E.sheenColorMap,Et=Ne&&!!E.sheenRoughnessMap,ee=!!E.specularMap,me=!!E.specularColorMap,Me=!!E.specularIntensityMap,Q=ze&&!!E.transmissionMap,pe=ze&&!!E.thicknessMap,He=!!E.gradientMap,it=!!E.alphaMap,qe=E.alphaTest>0,We=!!E.alphaHash,lt=!!E.extensions;let Dt=Ki;E.toneMapped&&(Re===null||Re.isXRRenderTarget===!0)&&(Dt=i.toneMapping);const mn={shaderID:re,shaderType:E.type,shaderName:E.name,vertexShader:Be,fragmentShader:et,defines:E.defines,customVertexShaderID:wt,customFragmentShaderID:be,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:m,batching:ht,batchingColor:ht&&F._colorsTexture!==null,instancing:Bt,instancingColor:Bt&&F.instanceColor!==null,instancingMorph:Bt&&F.morphTexture!==null,outputColorSpace:Re===null?i.outputColorSpace:Re.isXRRenderTarget===!0?Re.texture.colorSpace:Jr,alphaToCoverage:!!E.alphaToCoverage,map:Ke,matcap:jt,envMap:Mt,envMapMode:Mt&&X.mapping,envMapCubeUVHeight:J,aoMap:Ie,lightMap:ke,bumpMap:Ve,normalMap:at,displacementMap:Z,emissiveMap:zt,normalMapObjectSpace:at&&E.normalMapType===qE,normalMapTangentSpace:at&&E.normalMapType===Vl,metalnessMap:st,roughnessMap:Vt,anisotropy:Je,anisotropyMap:we,clearcoat:K,clearcoatMap:Ut,clearcoatNormalMap:dt,clearcoatRoughnessMap:Pt,dispersion:I,iridescence:ue,iridescenceMap:Qt,iridescenceThicknessMap:Xe,sheen:Ne,sheenColorMap:Qe,sheenRoughnessMap:Et,specularMap:ee,specularColorMap:me,specularIntensityMap:Me,transmission:ze,transmissionMap:Q,thicknessMap:pe,gradientMap:He,opaque:E.transparent===!1&&E.blending===qa&&E.alphaToCoverage===!1,alphaMap:it,alphaTest:qe,alphaHash:We,combine:E.combine,mapUv:Ke&&x(E.map.channel),aoMapUv:Ie&&x(E.aoMap.channel),lightMapUv:ke&&x(E.lightMap.channel),bumpMapUv:Ve&&x(E.bumpMap.channel),normalMapUv:at&&x(E.normalMap.channel),displacementMapUv:Z&&x(E.displacementMap.channel),emissiveMapUv:zt&&x(E.emissiveMap.channel),metalnessMapUv:st&&x(E.metalnessMap.channel),roughnessMapUv:Vt&&x(E.roughnessMap.channel),anisotropyMapUv:we&&x(E.anisotropyMap.channel),clearcoatMapUv:Ut&&x(E.clearcoatMap.channel),clearcoatNormalMapUv:dt&&x(E.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Pt&&x(E.clearcoatRoughnessMap.channel),iridescenceMapUv:Qt&&x(E.iridescenceMap.channel),iridescenceThicknessMapUv:Xe&&x(E.iridescenceThicknessMap.channel),sheenColorMapUv:Qe&&x(E.sheenColorMap.channel),sheenRoughnessMapUv:Et&&x(E.sheenRoughnessMap.channel),specularMapUv:ee&&x(E.specularMap.channel),specularColorMapUv:me&&x(E.specularColorMap.channel),specularIntensityMapUv:Me&&x(E.specularIntensityMap.channel),transmissionMapUv:Q&&x(E.transmissionMap.channel),thicknessMapUv:pe&&x(E.thicknessMap.channel),alphaMapUv:it&&x(E.alphaMap.channel),vertexTangents:!!Y.attributes.tangent&&(at||Je),vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!Y.attributes.color&&Y.attributes.color.itemSize===4,pointsUvs:F.isPoints===!0&&!!Y.attributes.uv&&(Ke||it),fog:!!V,useFog:E.fog===!0,fogExp2:!!V&&V.isFogExp2,flatShading:E.flatShading===!0&&E.wireframe===!1,sizeAttenuation:E.sizeAttenuation===!0,logarithmicDepthBuffer:f,reversedDepthBuffer:tt,skinning:F.isSkinnedMesh===!0,morphTargets:Y.morphAttributes.position!==void 0,morphNormals:Y.morphAttributes.normal!==void 0,morphColors:Y.morphAttributes.color!==void 0,morphTargetsCount:ge,morphTextureStride:Te,numDirLights:B.directional.length,numPointLights:B.point.length,numSpotLights:B.spot.length,numSpotLightMaps:B.spotLightMap.length,numRectAreaLights:B.rectArea.length,numHemiLights:B.hemi.length,numDirLightShadows:B.directionalShadowMap.length,numPointLightShadows:B.pointShadowMap.length,numSpotLightShadows:B.spotShadowMap.length,numSpotLightShadowsWithMaps:B.numSpotLightShadowsWithMaps,numLightProbes:B.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:E.dithering,shadowMapEnabled:i.shadowMap.enabled&&U.length>0,shadowMapType:i.shadowMap.type,toneMapping:Dt,decodeVideoTexture:Ke&&E.map.isVideoTexture===!0&&en.getTransfer(E.map.colorSpace)===Ft,decodeVideoTextureEmissive:zt&&E.emissiveMap.isVideoTexture===!0&&en.getTransfer(E.emissiveMap.colorSpace)===Ft,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===Ps,flipSided:E.side===hi,useDepthPacking:E.depthPacking>=0,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionClipCullDistance:lt&&E.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(lt&&E.extensions.multiDraw===!0||ht)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:E.customProgramCacheKey()};return mn.vertexUv1s=c.has(1),mn.vertexUv2s=c.has(2),mn.vertexUv3s=c.has(3),c.clear(),mn}function y(E){const B=[];if(E.shaderID?B.push(E.shaderID):(B.push(E.customVertexShaderID),B.push(E.customFragmentShaderID)),E.defines!==void 0)for(const U in E.defines)B.push(U),B.push(E.defines[U]);return E.isRawShaderMaterial===!1&&(b(B,E),S(B,E),B.push(i.outputColorSpace)),B.push(E.customProgramCacheKey),B.join()}function b(E,B){E.push(B.precision),E.push(B.outputColorSpace),E.push(B.envMapMode),E.push(B.envMapCubeUVHeight),E.push(B.mapUv),E.push(B.alphaMapUv),E.push(B.lightMapUv),E.push(B.aoMapUv),E.push(B.bumpMapUv),E.push(B.normalMapUv),E.push(B.displacementMapUv),E.push(B.emissiveMapUv),E.push(B.metalnessMapUv),E.push(B.roughnessMapUv),E.push(B.anisotropyMapUv),E.push(B.clearcoatMapUv),E.push(B.clearcoatNormalMapUv),E.push(B.clearcoatRoughnessMapUv),E.push(B.iridescenceMapUv),E.push(B.iridescenceThicknessMapUv),E.push(B.sheenColorMapUv),E.push(B.sheenRoughnessMapUv),E.push(B.specularMapUv),E.push(B.specularColorMapUv),E.push(B.specularIntensityMapUv),E.push(B.transmissionMapUv),E.push(B.thicknessMapUv),E.push(B.combine),E.push(B.fogExp2),E.push(B.sizeAttenuation),E.push(B.morphTargetsCount),E.push(B.morphAttributeCount),E.push(B.numDirLights),E.push(B.numPointLights),E.push(B.numSpotLights),E.push(B.numSpotLightMaps),E.push(B.numHemiLights),E.push(B.numRectAreaLights),E.push(B.numDirLightShadows),E.push(B.numPointLightShadows),E.push(B.numSpotLightShadows),E.push(B.numSpotLightShadowsWithMaps),E.push(B.numLightProbes),E.push(B.shadowMapType),E.push(B.toneMapping),E.push(B.numClippingPlanes),E.push(B.numClipIntersection),E.push(B.depthPacking)}function S(E,B){o.disableAll(),B.instancing&&o.enable(0),B.instancingColor&&o.enable(1),B.instancingMorph&&o.enable(2),B.matcap&&o.enable(3),B.envMap&&o.enable(4),B.normalMapObjectSpace&&o.enable(5),B.normalMapTangentSpace&&o.enable(6),B.clearcoat&&o.enable(7),B.iridescence&&o.enable(8),B.alphaTest&&o.enable(9),B.vertexColors&&o.enable(10),B.vertexAlphas&&o.enable(11),B.vertexUv1s&&o.enable(12),B.vertexUv2s&&o.enable(13),B.vertexUv3s&&o.enable(14),B.vertexTangents&&o.enable(15),B.anisotropy&&o.enable(16),B.alphaHash&&o.enable(17),B.batching&&o.enable(18),B.dispersion&&o.enable(19),B.batchingColor&&o.enable(20),B.gradientMap&&o.enable(21),E.push(o.mask),o.disableAll(),B.fog&&o.enable(0),B.useFog&&o.enable(1),B.flatShading&&o.enable(2),B.logarithmicDepthBuffer&&o.enable(3),B.reversedDepthBuffer&&o.enable(4),B.skinning&&o.enable(5),B.morphTargets&&o.enable(6),B.morphNormals&&o.enable(7),B.morphColors&&o.enable(8),B.premultipliedAlpha&&o.enable(9),B.shadowMapEnabled&&o.enable(10),B.doubleSided&&o.enable(11),B.flipSided&&o.enable(12),B.useDepthPacking&&o.enable(13),B.dithering&&o.enable(14),B.transmission&&o.enable(15),B.sheen&&o.enable(16),B.opaque&&o.enable(17),B.pointsUvs&&o.enable(18),B.decodeVideoTexture&&o.enable(19),B.decodeVideoTextureEmissive&&o.enable(20),B.alphaToCoverage&&o.enable(21),E.push(o.mask)}function T(E){const B=g[E.type];let U;if(B){const H=pc[B];U=P9.clone(H.uniforms)}else U=E.uniforms;return U}function M(E,B){let U=h.get(B);return U!==void 0?++U.usedTimes:(U=new uxe(i,B,E,r),u.push(U),h.set(B,U)),U}function C(E){if(--E.usedTimes===0){const B=u.indexOf(E);u[B]=u[u.length-1],u.pop(),h.delete(E.cacheKey),E.destroy()}}function w(E){l.remove(E)}function N(){l.dispose()}return{getParameters:v,getProgramCacheKey:y,getUniforms:T,acquireProgram:M,releaseProgram:C,releaseShaderCache:w,programs:u,dispose:N}}function mxe(){let i=new WeakMap;function e(a){return i.has(a)}function t(a){let o=i.get(a);return o===void 0&&(o={},i.set(a,o)),o}function n(a){i.delete(a)}function s(a,o,l){i.get(a)[o]=l}function r(){i=new WeakMap}return{has:e,get:t,remove:n,update:s,dispose:r}}function gxe(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function sH(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function rH(){const i=[];let e=0;const t=[],n=[],s=[];function r(){e=0,t.length=0,n.length=0,s.length=0}function a(h,f,m,g,x,v){let y=i[e];return y===void 0?(y={id:h.id,object:h,geometry:f,material:m,groupOrder:g,renderOrder:h.renderOrder,z:x,group:v},i[e]=y):(y.id=h.id,y.object=h,y.geometry=f,y.material=m,y.groupOrder=g,y.renderOrder=h.renderOrder,y.z=x,y.group=v),e++,y}function o(h,f,m,g,x,v){const y=a(h,f,m,g,x,v);m.transmission>0?n.push(y):m.transparent===!0?s.push(y):t.push(y)}function l(h,f,m,g,x,v){const y=a(h,f,m,g,x,v);m.transmission>0?n.unshift(y):m.transparent===!0?s.unshift(y):t.unshift(y)}function c(h,f){t.length>1&&t.sort(h||gxe),n.length>1&&n.sort(f||sH),s.length>1&&s.sort(f||sH)}function u(){for(let h=e,f=i.length;h<f;h++){const m=i[h];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:t,transmissive:n,transparent:s,init:r,push:o,unshift:l,finish:u,sort:c}}function yxe(){let i=new WeakMap;function e(n,s){const r=i.get(n);let a;return r===void 0?(a=new rH,i.set(n,[a])):s>=r.length?(a=new rH,r.push(a)):a=r[s],a}function t(){i=new WeakMap}return{get:e,dispose:t}}function xxe(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new z,color:new Ye};break;case"SpotLight":t={position:new z,direction:new z,color:new Ye,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new z,color:new Ye,distance:0,decay:0};break;case"HemisphereLight":t={direction:new z,skyColor:new Ye,groundColor:new Ye};break;case"RectAreaLight":t={color:new Ye,position:new z,halfWidth:new z,halfHeight:new z};break}return i[e.id]=t,t}}}function _xe(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ae};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ae};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ae,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let vxe=0;function bxe(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function Sxe(i){const e=new xxe,t=_xe(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)n.probe.push(new z);const s=new z,r=new Lt,a=new Lt;function o(c){let u=0,h=0,f=0;for(let E=0;E<9;E++)n.probe[E].set(0,0,0);let m=0,g=0,x=0,v=0,y=0,b=0,S=0,T=0,M=0,C=0,w=0;c.sort(bxe);for(let E=0,B=c.length;E<B;E++){const U=c[E],H=U.color,F=U.intensity,V=U.distance;let Y=null;if(U.shadow&&U.shadow.map&&(U.shadow.map.texture.format===Wr?Y=U.shadow.map.texture:Y=U.shadow.map.depthTexture||U.shadow.map.texture),U.isAmbientLight)u+=H.r*F,h+=H.g*F,f+=H.b*F;else if(U.isLightProbe){for(let P=0;P<9;P++)n.probe[P].addScaledVector(U.sh.coefficients[P],F);w++}else if(U.isDirectionalLight){const P=e.get(U);if(P.color.copy(U.color).multiplyScalar(U.intensity),U.castShadow){const X=U.shadow,J=t.get(U);J.shadowIntensity=X.intensity,J.shadowBias=X.bias,J.shadowNormalBias=X.normalBias,J.shadowRadius=X.radius,J.shadowMapSize=X.mapSize,n.directionalShadow[m]=J,n.directionalShadowMap[m]=Y,n.directionalShadowMatrix[m]=U.shadow.matrix,b++}n.directional[m]=P,m++}else if(U.isSpotLight){const P=e.get(U);P.position.setFromMatrixPosition(U.matrixWorld),P.color.copy(H).multiplyScalar(F),P.distance=V,P.coneCos=Math.cos(U.angle),P.penumbraCos=Math.cos(U.angle*(1-U.penumbra)),P.decay=U.decay,n.spot[x]=P;const X=U.shadow;if(U.map&&(n.spotLightMap[M]=U.map,M++,X.updateMatrices(U),U.castShadow&&C++),n.spotLightMatrix[x]=X.matrix,U.castShadow){const J=t.get(U);J.shadowIntensity=X.intensity,J.shadowBias=X.bias,J.shadowNormalBias=X.normalBias,J.shadowRadius=X.radius,J.shadowMapSize=X.mapSize,n.spotShadow[x]=J,n.spotShadowMap[x]=Y,T++}x++}else if(U.isRectAreaLight){const P=e.get(U);P.color.copy(H).multiplyScalar(F),P.halfWidth.set(U.width*.5,0,0),P.halfHeight.set(0,U.height*.5,0),n.rectArea[v]=P,v++}else if(U.isPointLight){const P=e.get(U);if(P.color.copy(U.color).multiplyScalar(U.intensity),P.distance=U.distance,P.decay=U.decay,U.castShadow){const X=U.shadow,J=t.get(U);J.shadowIntensity=X.intensity,J.shadowBias=X.bias,J.shadowNormalBias=X.normalBias,J.shadowRadius=X.radius,J.shadowMapSize=X.mapSize,J.shadowCameraNear=X.camera.near,J.shadowCameraFar=X.camera.far,n.pointShadow[g]=J,n.pointShadowMap[g]=Y,n.pointShadowMatrix[g]=U.shadow.matrix,S++}n.point[g]=P,g++}else if(U.isHemisphereLight){const P=e.get(U);P.skyColor.copy(U.color).multiplyScalar(F),P.groundColor.copy(U.groundColor).multiplyScalar(F),n.hemi[y]=P,y++}}v>0&&(i.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Ot.LTC_FLOAT_1,n.rectAreaLTC2=Ot.LTC_FLOAT_2):(n.rectAreaLTC1=Ot.LTC_HALF_1,n.rectAreaLTC2=Ot.LTC_HALF_2)),n.ambient[0]=u,n.ambient[1]=h,n.ambient[2]=f;const N=n.hash;(N.directionalLength!==m||N.pointLength!==g||N.spotLength!==x||N.rectAreaLength!==v||N.hemiLength!==y||N.numDirectionalShadows!==b||N.numPointShadows!==S||N.numSpotShadows!==T||N.numSpotMaps!==M||N.numLightProbes!==w)&&(n.directional.length=m,n.spot.length=x,n.rectArea.length=v,n.point.length=g,n.hemi.length=y,n.directionalShadow.length=b,n.directionalShadowMap.length=b,n.pointShadow.length=S,n.pointShadowMap.length=S,n.spotShadow.length=T,n.spotShadowMap.length=T,n.directionalShadowMatrix.length=b,n.pointShadowMatrix.length=S,n.spotLightMatrix.length=T+M-C,n.spotLightMap.length=M,n.numSpotLightShadowsWithMaps=C,n.numLightProbes=w,N.directionalLength=m,N.pointLength=g,N.spotLength=x,N.rectAreaLength=v,N.hemiLength=y,N.numDirectionalShadows=b,N.numPointShadows=S,N.numSpotShadows=T,N.numSpotMaps=M,N.numLightProbes=w,n.version=vxe++)}function l(c,u){let h=0,f=0,m=0,g=0,x=0;const v=u.matrixWorldInverse;for(let y=0,b=c.length;y<b;y++){const S=c[y];if(S.isDirectionalLight){const T=n.directional[h];T.direction.setFromMatrixPosition(S.matrixWorld),s.setFromMatrixPosition(S.target.matrixWorld),T.direction.sub(s),T.direction.transformDirection(v),h++}else if(S.isSpotLight){const T=n.spot[m];T.position.setFromMatrixPosition(S.matrixWorld),T.position.applyMatrix4(v),T.direction.setFromMatrixPosition(S.matrixWorld),s.setFromMatrixPosition(S.target.matrixWorld),T.direction.sub(s),T.direction.transformDirection(v),m++}else if(S.isRectAreaLight){const T=n.rectArea[g];T.position.setFromMatrixPosition(S.matrixWorld),T.position.applyMatrix4(v),a.identity(),r.copy(S.matrixWorld),r.premultiply(v),a.extractRotation(r),T.halfWidth.set(S.width*.5,0,0),T.halfHeight.set(0,S.height*.5,0),T.halfWidth.applyMatrix4(a),T.halfHeight.applyMatrix4(a),g++}else if(S.isPointLight){const T=n.point[f];T.position.setFromMatrixPosition(S.matrixWorld),T.position.applyMatrix4(v),f++}else if(S.isHemisphereLight){const T=n.hemi[x];T.direction.setFromMatrixPosition(S.matrixWorld),T.direction.transformDirection(v),x++}}}return{setup:o,setupView:l,state:n}}function aH(i){const e=new Sxe(i),t=[],n=[];function s(u){c.camera=u,t.length=0,n.length=0}function r(u){t.push(u)}function a(u){n.push(u)}function o(){e.setup(t)}function l(u){e.setupView(t,u)}const c={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:s,state:c,setupLights:o,setupLightsView:l,pushLight:r,pushShadow:a}}function Txe(i){let e=new WeakMap;function t(s,r=0){const a=e.get(s);let o;return a===void 0?(o=new aH(i),e.set(s,[o])):r>=a.length?(o=new aH(i),a.push(o)):o=a[r],o}function n(){e=new WeakMap}return{get:t,dispose:n}}const Axe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Mxe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ).rg;
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ).r;
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( max( 0.0, squared_mean - mean * mean ) );
	gl_FragColor = vec4( mean, std_dev, 0.0, 1.0 );
}`,Exe=[new z(1,0,0),new z(-1,0,0),new z(0,1,0),new z(0,-1,0),new z(0,0,1),new z(0,0,-1)],Cxe=[new z(0,-1,0),new z(0,-1,0),new z(0,0,1),new z(0,0,-1),new z(0,-1,0),new z(0,-1,0)],oH=new Lt,$_=new z,k2=new z;function wxe(i,e,t){let n=new zh;const s=new Ae,r=new Ae,a=new un,o=new pC,l=new mC,c={},u=t.maxTextureSize,h={[jr]:hi,[hi]:jr,[Ps]:Ps},f=new Za({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ae},radius:{value:4}},vertexShader:Axe,fragmentShader:Mxe}),m=f.clone();m.defines.HORIZONTAL_PASS=1;const g=new pn;g.setAttribute("position",new Nn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new Kn(g,f),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=tf;let y=this.type;this.render=function(C,w,N){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||C.length===0)return;C.type===gy&&(Se("WebGLShadowMap: PCFSoftShadowMap has been deprecated. Using PCFShadowMap instead."),C.type=tf);const E=i.getRenderTarget(),B=i.getActiveCubeFace(),U=i.getActiveMipmapLevel(),H=i.state;H.setBlending(Nr),H.buffers.depth.getReversed()===!0?H.buffers.color.setClear(0,0,0,0):H.buffers.color.setClear(1,1,1,1),H.buffers.depth.setTest(!0),H.setScissorTest(!1);const F=y!==this.type;F&&w.traverse(function(V){V.material&&(Array.isArray(V.material)?V.material.forEach(Y=>Y.needsUpdate=!0):V.material.needsUpdate=!0)});for(let V=0,Y=C.length;V<Y;V++){const P=C[V],X=P.shadow;if(X===void 0){Se("WebGLShadowMap:",P,"has no shadow.");continue}if(X.autoUpdate===!1&&X.needsUpdate===!1)continue;s.copy(X.mapSize);const J=X.getFrameExtents();if(s.multiply(J),r.copy(X.mapSize),(s.x>u||s.y>u)&&(s.x>u&&(r.x=Math.floor(u/J.x),s.x=r.x*J.x,X.mapSize.x=r.x),s.y>u&&(r.y=Math.floor(u/J.y),s.y=r.y*J.y,X.mapSize.y=r.y)),X.map===null||F===!0){if(X.map!==null&&(X.map.depthTexture!==null&&(X.map.depthTexture.dispose(),X.map.depthTexture=null),X.map.dispose()),this.type===Dl){if(P.isPointLight){Se("WebGLShadowMap: VSM shadow maps are not supported for PointLights. Use PCF or BasicShadowMap instead.");continue}X.map=new xa(s.x,s.y,{format:Wr,type:ln,minFilter:Jt,magFilter:Jt,generateMipmaps:!1}),X.map.texture.name=P.name+".shadowMap",X.map.depthTexture=new tr(s.x,s.y,Rn),X.map.depthTexture.name=P.name+".shadowMapDepth",X.map.depthTexture.format=lr,X.map.depthTexture.compareFunction=null,X.map.depthTexture.minFilter=$n,X.map.depthTexture.magFilter=$n}else{P.isPointLight?(X.map=new RS(s.x),X.map.depthTexture=new tC(s.x,Jn)):(X.map=new xa(s.x,s.y),X.map.depthTexture=new tr(s.x,s.y,Jn)),X.map.depthTexture.name=P.name+".shadowMap",X.map.depthTexture.format=lr;const ne=i.state.buffers.depth.getReversed();this.type===tf?(X.map.depthTexture.compareFunction=ne?_g:xg,X.map.depthTexture.minFilter=Jt,X.map.depthTexture.magFilter=Jt):(X.map.depthTexture.compareFunction=null,X.map.depthTexture.minFilter=$n,X.map.depthTexture.magFilter=$n)}X.camera.updateProjectionMatrix()}const re=X.map.isWebGLCubeRenderTarget?6:1;for(let ne=0;ne<re;ne++){if(X.map.isWebGLCubeRenderTarget)i.setRenderTarget(X.map,ne),i.clear();else{ne===0&&(i.setRenderTarget(X.map),i.clear());const ge=X.getViewport(ne);a.set(r.x*ge.x,r.y*ge.y,r.x*ge.z,r.y*ge.w),H.viewport(a)}if(P.isPointLight){const ge=X.camera,Te=X.matrix,Be=P.distance||ge.far;Be!==ge.far&&(ge.far=Be,ge.updateProjectionMatrix()),$_.setFromMatrixPosition(P.matrixWorld),ge.position.copy($_),k2.copy(ge.position),k2.add(Exe[ne]),ge.up.copy(Cxe[ne]),ge.lookAt(k2),ge.updateMatrixWorld(),Te.makeTranslation(-$_.x,-$_.y,-$_.z),oH.multiplyMatrices(ge.projectionMatrix,ge.matrixWorldInverse),X._frustum.setFromProjectionMatrix(oH,ge.coordinateSystem,ge.reversedDepth)}else X.updateMatrices(P);n=X.getFrustum(),T(w,N,X.camera,P,this.type)}X.isPointLightShadow!==!0&&this.type===Dl&&b(X,N),X.needsUpdate=!1}y=this.type,v.needsUpdate=!1,i.setRenderTarget(E,B,U)};function b(C,w){const N=e.update(x);f.defines.VSM_SAMPLES!==C.blurSamples&&(f.defines.VSM_SAMPLES=C.blurSamples,m.defines.VSM_SAMPLES=C.blurSamples,f.needsUpdate=!0,m.needsUpdate=!0),C.mapPass===null&&(C.mapPass=new xa(s.x,s.y,{format:Wr,type:ln})),f.uniforms.shadow_pass.value=C.map.depthTexture,f.uniforms.resolution.value=C.mapSize,f.uniforms.radius.value=C.radius,i.setRenderTarget(C.mapPass),i.clear(),i.renderBufferDirect(w,null,N,f,x,null),m.uniforms.shadow_pass.value=C.mapPass.texture,m.uniforms.resolution.value=C.mapSize,m.uniforms.radius.value=C.radius,i.setRenderTarget(C.map),i.clear(),i.renderBufferDirect(w,null,N,m,x,null)}function S(C,w,N,E){let B=null;const U=N.isPointLight===!0?C.customDistanceMaterial:C.customDepthMaterial;if(U!==void 0)B=U;else if(B=N.isPointLight===!0?l:o,i.localClippingEnabled&&w.clipShadows===!0&&Array.isArray(w.clippingPlanes)&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0||w.map&&w.alphaTest>0||w.alphaToCoverage===!0){const H=B.uuid,F=w.uuid;let V=c[H];V===void 0&&(V={},c[H]=V);let Y=V[F];Y===void 0&&(Y=B.clone(),V[F]=Y,w.addEventListener("dispose",M)),B=Y}if(B.visible=w.visible,B.wireframe=w.wireframe,E===Dl?B.side=w.shadowSide!==null?w.shadowSide:w.side:B.side=w.shadowSide!==null?w.shadowSide:h[w.side],B.alphaMap=w.alphaMap,B.alphaTest=w.alphaToCoverage===!0?.5:w.alphaTest,B.map=w.map,B.clipShadows=w.clipShadows,B.clippingPlanes=w.clippingPlanes,B.clipIntersection=w.clipIntersection,B.displacementMap=w.displacementMap,B.displacementScale=w.displacementScale,B.displacementBias=w.displacementBias,B.wireframeLinewidth=w.wireframeLinewidth,B.linewidth=w.linewidth,N.isPointLight===!0&&B.isMeshDistanceMaterial===!0){const H=i.properties.get(B);H.light=N}return B}function T(C,w,N,E,B){if(C.visible===!1)return;if(C.layers.test(w.layers)&&(C.isMesh||C.isLine||C.isPoints)&&(C.castShadow||C.receiveShadow&&B===Dl)&&(!C.frustumCulled||n.intersectsObject(C))){C.modelViewMatrix.multiplyMatrices(N.matrixWorldInverse,C.matrixWorld);const F=e.update(C),V=C.material;if(Array.isArray(V)){const Y=F.groups;for(let P=0,X=Y.length;P<X;P++){const J=Y[P],re=V[J.materialIndex];if(re&&re.visible){const ne=S(C,re,E,B);C.onBeforeShadow(i,C,w,N,F,ne,J),i.renderBufferDirect(N,null,F,ne,C,J),C.onAfterShadow(i,C,w,N,F,ne,J)}}}else if(V.visible){const Y=S(C,V,E,B);C.onBeforeShadow(i,C,w,N,F,Y,null),i.renderBufferDirect(N,null,F,Y,C,null),C.onAfterShadow(i,C,w,N,F,Y,null)}}const H=C.children;for(let F=0,V=H.length;F<V;F++)T(H[F],w,N,E,B)}function M(C){C.target.removeEventListener("dispose",M);for(const N in c){const E=c[N],B=C.target.uuid;B in E&&(E[B].dispose(),delete E[B])}}}const Rxe={[Fm]:Gm,[zm]:km,[Vm]:Wm,[uu]:Hm,[Gm]:Fm,[km]:zm,[Wm]:Vm,[Hm]:uu};function Nxe(i,e){function t(){let Q=!1;const pe=new un;let He=null;const it=new un(0,0,0,0);return{setMask:function(qe){He!==qe&&!Q&&(i.colorMask(qe,qe,qe,qe),He=qe)},setLocked:function(qe){Q=qe},setClear:function(qe,We,lt,Dt,mn){mn===!0&&(qe*=Dt,We*=Dt,lt*=Dt),pe.set(qe,We,lt,Dt),it.equals(pe)===!1&&(i.clearColor(qe,We,lt,Dt),it.copy(pe))},reset:function(){Q=!1,He=null,it.set(-1,0,0,0)}}}function n(){let Q=!1,pe=!1,He=null,it=null,qe=null;return{setReversed:function(We){if(pe!==We){const lt=e.get("EXT_clip_control");We?lt.clipControlEXT(lt.LOWER_LEFT_EXT,lt.ZERO_TO_ONE_EXT):lt.clipControlEXT(lt.LOWER_LEFT_EXT,lt.NEGATIVE_ONE_TO_ONE_EXT),pe=We;const Dt=qe;qe=null,this.setClear(Dt)}},getReversed:function(){return pe},setTest:function(We){We?Re(i.DEPTH_TEST):tt(i.DEPTH_TEST)},setMask:function(We){He!==We&&!Q&&(i.depthMask(We),He=We)},setFunc:function(We){if(pe&&(We=Rxe[We]),it!==We){switch(We){case Fm:i.depthFunc(i.NEVER);break;case Gm:i.depthFunc(i.ALWAYS);break;case zm:i.depthFunc(i.LESS);break;case uu:i.depthFunc(i.LEQUAL);break;case Vm:i.depthFunc(i.EQUAL);break;case Hm:i.depthFunc(i.GEQUAL);break;case km:i.depthFunc(i.GREATER);break;case Wm:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}it=We}},setLocked:function(We){Q=We},setClear:function(We){qe!==We&&(pe&&(We=1-We),i.clearDepth(We),qe=We)},reset:function(){Q=!1,He=null,it=null,qe=null,pe=!1}}}function s(){let Q=!1,pe=null,He=null,it=null,qe=null,We=null,lt=null,Dt=null,mn=null;return{setTest:function(xn){Q||(xn?Re(i.STENCIL_TEST):tt(i.STENCIL_TEST))},setMask:function(xn){pe!==xn&&!Q&&(i.stencilMask(xn),pe=xn)},setFunc:function(xn,Oi,Vi){(He!==xn||it!==Oi||qe!==Vi)&&(i.stencilFunc(xn,Oi,Vi),He=xn,it=Oi,qe=Vi)},setOp:function(xn,Oi,Vi){(We!==xn||lt!==Oi||Dt!==Vi)&&(i.stencilOp(xn,Oi,Vi),We=xn,lt=Oi,Dt=Vi)},setLocked:function(xn){Q=xn},setClear:function(xn){mn!==xn&&(i.clearStencil(xn),mn=xn)},reset:function(){Q=!1,pe=null,He=null,it=null,qe=null,We=null,lt=null,Dt=null,mn=null}}}const r=new t,a=new n,o=new s,l=new WeakMap,c=new WeakMap;let u={},h={},f=new WeakMap,m=[],g=null,x=!1,v=null,y=null,b=null,S=null,T=null,M=null,C=null,w=new Ye(0,0,0),N=0,E=!1,B=null,U=null,H=null,F=null,V=null;const Y=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let P=!1,X=0;const J=i.getParameter(i.VERSION);J.indexOf("WebGL")!==-1?(X=parseFloat(/^WebGL (\d)/.exec(J)[1]),P=X>=1):J.indexOf("OpenGL ES")!==-1&&(X=parseFloat(/^OpenGL ES (\d)/.exec(J)[1]),P=X>=2);let re=null,ne={};const ge=i.getParameter(i.SCISSOR_BOX),Te=i.getParameter(i.VIEWPORT),Be=new un().fromArray(ge),et=new un().fromArray(Te);function wt(Q,pe,He,it){const qe=new Uint8Array(4),We=i.createTexture();i.bindTexture(Q,We),i.texParameteri(Q,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(Q,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let lt=0;lt<He;lt++)Q===i.TEXTURE_3D||Q===i.TEXTURE_2D_ARRAY?i.texImage3D(pe,0,i.RGBA,1,1,it,0,i.RGBA,i.UNSIGNED_BYTE,qe):i.texImage2D(pe+lt,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,qe);return We}const be={};be[i.TEXTURE_2D]=wt(i.TEXTURE_2D,i.TEXTURE_2D,1),be[i.TEXTURE_CUBE_MAP]=wt(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),be[i.TEXTURE_2D_ARRAY]=wt(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),be[i.TEXTURE_3D]=wt(i.TEXTURE_3D,i.TEXTURE_3D,1,1),r.setClear(0,0,0,1),a.setClear(1),o.setClear(0),Re(i.DEPTH_TEST),a.setFunc(uu),Ve(!1),at(gb),Re(i.CULL_FACE),Ie(Nr);function Re(Q){u[Q]!==!0&&(i.enable(Q),u[Q]=!0)}function tt(Q){u[Q]!==!1&&(i.disable(Q),u[Q]=!1)}function Bt(Q,pe){return h[Q]!==pe?(i.bindFramebuffer(Q,pe),h[Q]=pe,Q===i.DRAW_FRAMEBUFFER&&(h[i.FRAMEBUFFER]=pe),Q===i.FRAMEBUFFER&&(h[i.DRAW_FRAMEBUFFER]=pe),!0):!1}function ht(Q,pe){let He=m,it=!1;if(Q){He=f.get(pe),He===void 0&&(He=[],f.set(pe,He));const qe=Q.textures;if(He.length!==qe.length||He[0]!==i.COLOR_ATTACHMENT0){for(let We=0,lt=qe.length;We<lt;We++)He[We]=i.COLOR_ATTACHMENT0+We;He.length=qe.length,it=!0}}else He[0]!==i.BACK&&(He[0]=i.BACK,it=!0);it&&i.drawBuffers(He)}function Ke(Q){return g!==Q?(i.useProgram(Q),g=Q,!0):!1}const jt={[Mr]:i.FUNC_ADD,[cS]:i.FUNC_SUBTRACT,[uS]:i.FUNC_REVERSE_SUBTRACT};jt[GE]=i.MIN,jt[zE]=i.MAX;const Mt={[dc]:i.ZERO,[hS]:i.ONE,[dS]:i.SRC_COLOR,[Pm]:i.SRC_ALPHA,[xS]:i.SRC_ALPHA_SATURATE,[gS]:i.DST_COLOR,[pS]:i.DST_ALPHA,[fS]:i.ONE_MINUS_SRC_COLOR,[Om]:i.ONE_MINUS_SRC_ALPHA,[yS]:i.ONE_MINUS_DST_COLOR,[mS]:i.ONE_MINUS_DST_ALPHA,[kL]:i.CONSTANT_COLOR,[WL]:i.ONE_MINUS_CONSTANT_COLOR,[XL]:i.CONSTANT_ALPHA,[qL]:i.ONE_MINUS_CONSTANT_ALPHA};function Ie(Q,pe,He,it,qe,We,lt,Dt,mn,xn){if(Q===Nr){x===!0&&(tt(i.BLEND),x=!1);return}if(x===!1&&(Re(i.BLEND),x=!0),Q!==nf){if(Q!==v||xn!==E){if((y!==Mr||T!==Mr)&&(i.blendEquation(i.FUNC_ADD),y=Mr,T=Mr),xn)switch(Q){case qa:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case hf:i.blendFunc(i.ONE,i.ONE);break;case df:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case Ch:i.blendFuncSeparate(i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ZERO,i.ONE);break;default:De("WebGLState: Invalid blending: ",Q);break}else switch(Q){case qa:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case hf:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE,i.ONE,i.ONE);break;case df:De("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Ch:De("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:De("WebGLState: Invalid blending: ",Q);break}b=null,S=null,M=null,C=null,w.set(0,0,0),N=0,v=Q,E=xn}return}qe=qe||pe,We=We||He,lt=lt||it,(pe!==y||qe!==T)&&(i.blendEquationSeparate(jt[pe],jt[qe]),y=pe,T=qe),(He!==b||it!==S||We!==M||lt!==C)&&(i.blendFuncSeparate(Mt[He],Mt[it],Mt[We],Mt[lt]),b=He,S=it,M=We,C=lt),(Dt.equals(w)===!1||mn!==N)&&(i.blendColor(Dt.r,Dt.g,Dt.b,mn),w.copy(Dt),N=mn),v=Q,E=!1}function ke(Q,pe){Q.side===Ps?tt(i.CULL_FACE):Re(i.CULL_FACE);let He=Q.side===hi;pe&&(He=!He),Ve(He),Q.blending===qa&&Q.transparent===!1?Ie(Nr):Ie(Q.blending,Q.blendEquation,Q.blendSrc,Q.blendDst,Q.blendEquationAlpha,Q.blendSrcAlpha,Q.blendDstAlpha,Q.blendColor,Q.blendAlpha,Q.premultipliedAlpha),a.setFunc(Q.depthFunc),a.setTest(Q.depthTest),a.setMask(Q.depthWrite),r.setMask(Q.colorWrite);const it=Q.stencilWrite;o.setTest(it),it&&(o.setMask(Q.stencilWriteMask),o.setFunc(Q.stencilFunc,Q.stencilRef,Q.stencilFuncMask),o.setOp(Q.stencilFail,Q.stencilZFail,Q.stencilZPass)),zt(Q.polygonOffset,Q.polygonOffsetFactor,Q.polygonOffsetUnits),Q.alphaToCoverage===!0?Re(i.SAMPLE_ALPHA_TO_COVERAGE):tt(i.SAMPLE_ALPHA_TO_COVERAGE)}function Ve(Q){B!==Q&&(Q?i.frontFace(i.CW):i.frontFace(i.CCW),B=Q)}function at(Q){Q!==PE?(Re(i.CULL_FACE),Q!==U&&(Q===gb?i.cullFace(i.BACK):Q===OE?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):tt(i.CULL_FACE),U=Q}function Z(Q){Q!==H&&(P&&i.lineWidth(Q),H=Q)}function zt(Q,pe,He){Q?(Re(i.POLYGON_OFFSET_FILL),(F!==pe||V!==He)&&(i.polygonOffset(pe,He),F=pe,V=He)):tt(i.POLYGON_OFFSET_FILL)}function st(Q){Q?Re(i.SCISSOR_TEST):tt(i.SCISSOR_TEST)}function Vt(Q){Q===void 0&&(Q=i.TEXTURE0+Y-1),re!==Q&&(i.activeTexture(Q),re=Q)}function Je(Q,pe,He){He===void 0&&(re===null?He=i.TEXTURE0+Y-1:He=re);let it=ne[He];it===void 0&&(it={type:void 0,texture:void 0},ne[He]=it),(it.type!==Q||it.texture!==pe)&&(re!==He&&(i.activeTexture(He),re=He),i.bindTexture(Q,pe||be[Q]),it.type=Q,it.texture=pe)}function K(){const Q=ne[re];Q!==void 0&&Q.type!==void 0&&(i.bindTexture(Q.type,null),Q.type=void 0,Q.texture=void 0)}function I(){try{i.compressedTexImage2D(...arguments)}catch(Q){De("WebGLState:",Q)}}function ue(){try{i.compressedTexImage3D(...arguments)}catch(Q){De("WebGLState:",Q)}}function Ne(){try{i.texSubImage2D(...arguments)}catch(Q){De("WebGLState:",Q)}}function ze(){try{i.texSubImage3D(...arguments)}catch(Q){De("WebGLState:",Q)}}function we(){try{i.compressedTexSubImage2D(...arguments)}catch(Q){De("WebGLState:",Q)}}function Ut(){try{i.compressedTexSubImage3D(...arguments)}catch(Q){De("WebGLState:",Q)}}function dt(){try{i.texStorage2D(...arguments)}catch(Q){De("WebGLState:",Q)}}function Pt(){try{i.texStorage3D(...arguments)}catch(Q){De("WebGLState:",Q)}}function Qt(){try{i.texImage2D(...arguments)}catch(Q){De("WebGLState:",Q)}}function Xe(){try{i.texImage3D(...arguments)}catch(Q){De("WebGLState:",Q)}}function Qe(Q){Be.equals(Q)===!1&&(i.scissor(Q.x,Q.y,Q.z,Q.w),Be.copy(Q))}function Et(Q){et.equals(Q)===!1&&(i.viewport(Q.x,Q.y,Q.z,Q.w),et.copy(Q))}function ee(Q,pe){let He=c.get(pe);He===void 0&&(He=new WeakMap,c.set(pe,He));let it=He.get(Q);it===void 0&&(it=i.getUniformBlockIndex(pe,Q.name),He.set(Q,it))}function me(Q,pe){const it=c.get(pe).get(Q);l.get(pe)!==it&&(i.uniformBlockBinding(pe,it,Q.__bindingPointIndex),l.set(pe,it))}function Me(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),a.setReversed(!1),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),u={},re=null,ne={},h={},f=new WeakMap,m=[],g=null,x=!1,v=null,y=null,b=null,S=null,T=null,M=null,C=null,w=new Ye(0,0,0),N=0,E=!1,B=null,U=null,H=null,F=null,V=null,Be.set(0,0,i.canvas.width,i.canvas.height),et.set(0,0,i.canvas.width,i.canvas.height),r.reset(),a.reset(),o.reset()}return{buffers:{color:r,depth:a,stencil:o},enable:Re,disable:tt,bindFramebuffer:Bt,drawBuffers:ht,useProgram:Ke,setBlending:Ie,setMaterial:ke,setFlipSided:Ve,setCullFace:at,setLineWidth:Z,setPolygonOffset:zt,setScissorTest:st,activeTexture:Vt,bindTexture:Je,unbindTexture:K,compressedTexImage2D:I,compressedTexImage3D:ue,texImage2D:Qt,texImage3D:Xe,updateUBOMapping:ee,uniformBlockBinding:me,texStorage2D:dt,texStorage3D:Pt,texSubImage2D:Ne,texSubImage3D:ze,compressedTexSubImage2D:we,compressedTexSubImage3D:Ut,scissor:Qe,viewport:Et,reset:Me}}function Bxe(i,e,t,n,s,r,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new Ae,u=new WeakMap;let h;const f=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function g(K,I){return m?new OffscreenCanvas(K,I):Sb("canvas")}function x(K,I,ue){let Ne=1;const ze=Je(K);if((ze.width>ue||ze.height>ue)&&(Ne=ue/Math.max(ze.width,ze.height)),Ne<1)if(typeof HTMLImageElement<"u"&&K instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&K instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&K instanceof ImageBitmap||typeof VideoFrame<"u"&&K instanceof VideoFrame){const we=Math.floor(Ne*ze.width),Ut=Math.floor(Ne*ze.height);h===void 0&&(h=g(we,Ut));const dt=I?g(we,Ut):h;return dt.width=we,dt.height=Ut,dt.getContext("2d").drawImage(K,0,0,we,Ut),Se("WebGLRenderer: Texture has been resized from ("+ze.width+"x"+ze.height+") to ("+we+"x"+Ut+")."),dt}else return"data"in K&&Se("WebGLRenderer: Image in DataTexture is too big ("+ze.width+"x"+ze.height+")."),K;return K}function v(K){return K.generateMipmaps}function y(K){i.generateMipmap(K)}function b(K){return K.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:K.isWebGL3DRenderTarget?i.TEXTURE_3D:K.isWebGLArrayRenderTarget||K.isCompressedArrayTexture?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D}function S(K,I,ue,Ne,ze=!1){if(K!==null){if(i[K]!==void 0)return i[K];Se("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+K+"'")}let we=I;if(I===i.RED&&(ue===i.FLOAT&&(we=i.R32F),ue===i.HALF_FLOAT&&(we=i.R16F),ue===i.UNSIGNED_BYTE&&(we=i.R8)),I===i.RED_INTEGER&&(ue===i.UNSIGNED_BYTE&&(we=i.R8UI),ue===i.UNSIGNED_SHORT&&(we=i.R16UI),ue===i.UNSIGNED_INT&&(we=i.R32UI),ue===i.BYTE&&(we=i.R8I),ue===i.SHORT&&(we=i.R16I),ue===i.INT&&(we=i.R32I)),I===i.RG&&(ue===i.FLOAT&&(we=i.RG32F),ue===i.HALF_FLOAT&&(we=i.RG16F),ue===i.UNSIGNED_BYTE&&(we=i.RG8)),I===i.RG_INTEGER&&(ue===i.UNSIGNED_BYTE&&(we=i.RG8UI),ue===i.UNSIGNED_SHORT&&(we=i.RG16UI),ue===i.UNSIGNED_INT&&(we=i.RG32UI),ue===i.BYTE&&(we=i.RG8I),ue===i.SHORT&&(we=i.RG16I),ue===i.INT&&(we=i.RG32I)),I===i.RGB_INTEGER&&(ue===i.UNSIGNED_BYTE&&(we=i.RGB8UI),ue===i.UNSIGNED_SHORT&&(we=i.RGB16UI),ue===i.UNSIGNED_INT&&(we=i.RGB32UI),ue===i.BYTE&&(we=i.RGB8I),ue===i.SHORT&&(we=i.RGB16I),ue===i.INT&&(we=i.RGB32I)),I===i.RGBA_INTEGER&&(ue===i.UNSIGNED_BYTE&&(we=i.RGBA8UI),ue===i.UNSIGNED_SHORT&&(we=i.RGBA16UI),ue===i.UNSIGNED_INT&&(we=i.RGBA32UI),ue===i.BYTE&&(we=i.RGBA8I),ue===i.SHORT&&(we=i.RGBA16I),ue===i.INT&&(we=i.RGBA32I)),I===i.RGB&&(ue===i.UNSIGNED_INT_5_9_9_9_REV&&(we=i.RGB9_E5),ue===i.UNSIGNED_INT_10F_11F_11F_REV&&(we=i.R11F_G11F_B10F)),I===i.RGBA){const Ut=ze?Of:en.getTransfer(Ne);ue===i.FLOAT&&(we=i.RGBA32F),ue===i.HALF_FLOAT&&(we=i.RGBA16F),ue===i.UNSIGNED_BYTE&&(we=Ut===Ft?i.SRGB8_ALPHA8:i.RGBA8),ue===i.UNSIGNED_SHORT_4_4_4_4&&(we=i.RGBA4),ue===i.UNSIGNED_SHORT_5_5_5_1&&(we=i.RGB5_A1)}return(we===i.R16F||we===i.R32F||we===i.RG16F||we===i.RG32F||we===i.RGBA16F||we===i.RGBA32F)&&e.get("EXT_color_buffer_float"),we}function T(K,I){let ue;return K?I===null||I===Jn||I===ja?ue=i.DEPTH24_STENCIL8:I===Rn?ue=i.DEPTH32F_STENCIL8:I===ko&&(ue=i.DEPTH24_STENCIL8,Se("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):I===null||I===Jn||I===ja?ue=i.DEPTH_COMPONENT24:I===Rn?ue=i.DEPTH_COMPONENT32F:I===ko&&(ue=i.DEPTH_COMPONENT16),ue}function M(K,I){return v(K)===!0||K.isFramebufferTexture&&K.minFilter!==$n&&K.minFilter!==Jt?Math.log2(Math.max(I.width,I.height))+1:K.mipmaps!==void 0&&K.mipmaps.length>0?K.mipmaps.length:K.isCompressedTexture&&Array.isArray(K.image)?I.mipmaps.length:1}function C(K){const I=K.target;I.removeEventListener("dispose",C),N(I),I.isVideoTexture&&u.delete(I)}function w(K){const I=K.target;I.removeEventListener("dispose",w),B(I)}function N(K){const I=n.get(K);if(I.__webglInit===void 0)return;const ue=K.source,Ne=f.get(ue);if(Ne){const ze=Ne[I.__cacheKey];ze.usedTimes--,ze.usedTimes===0&&E(K),Object.keys(Ne).length===0&&f.delete(ue)}n.remove(K)}function E(K){const I=n.get(K);i.deleteTexture(I.__webglTexture);const ue=K.source,Ne=f.get(ue);delete Ne[I.__cacheKey],a.memory.textures--}function B(K){const I=n.get(K);if(K.depthTexture&&(K.depthTexture.dispose(),n.remove(K.depthTexture)),K.isWebGLCubeRenderTarget)for(let Ne=0;Ne<6;Ne++){if(Array.isArray(I.__webglFramebuffer[Ne]))for(let ze=0;ze<I.__webglFramebuffer[Ne].length;ze++)i.deleteFramebuffer(I.__webglFramebuffer[Ne][ze]);else i.deleteFramebuffer(I.__webglFramebuffer[Ne]);I.__webglDepthbuffer&&i.deleteRenderbuffer(I.__webglDepthbuffer[Ne])}else{if(Array.isArray(I.__webglFramebuffer))for(let Ne=0;Ne<I.__webglFramebuffer.length;Ne++)i.deleteFramebuffer(I.__webglFramebuffer[Ne]);else i.deleteFramebuffer(I.__webglFramebuffer);if(I.__webglDepthbuffer&&i.deleteRenderbuffer(I.__webglDepthbuffer),I.__webglMultisampledFramebuffer&&i.deleteFramebuffer(I.__webglMultisampledFramebuffer),I.__webglColorRenderbuffer)for(let Ne=0;Ne<I.__webglColorRenderbuffer.length;Ne++)I.__webglColorRenderbuffer[Ne]&&i.deleteRenderbuffer(I.__webglColorRenderbuffer[Ne]);I.__webglDepthRenderbuffer&&i.deleteRenderbuffer(I.__webglDepthRenderbuffer)}const ue=K.textures;for(let Ne=0,ze=ue.length;Ne<ze;Ne++){const we=n.get(ue[Ne]);we.__webglTexture&&(i.deleteTexture(we.__webglTexture),a.memory.textures--),n.remove(ue[Ne])}n.remove(K)}let U=0;function H(){U=0}function F(){const K=U;return K>=s.maxTextures&&Se("WebGLTextures: Trying to use "+K+" texture units while this GPU supports only "+s.maxTextures),U+=1,K}function V(K){const I=[];return I.push(K.wrapS),I.push(K.wrapT),I.push(K.wrapR||0),I.push(K.magFilter),I.push(K.minFilter),I.push(K.anisotropy),I.push(K.internalFormat),I.push(K.format),I.push(K.type),I.push(K.generateMipmaps),I.push(K.premultiplyAlpha),I.push(K.flipY),I.push(K.unpackAlignment),I.push(K.colorSpace),I.join()}function Y(K,I){const ue=n.get(K);if(K.isVideoTexture&&st(K),K.isRenderTargetTexture===!1&&K.isExternalTexture!==!0&&K.version>0&&ue.__version!==K.version){const Ne=K.image;if(Ne===null)Se("WebGLRenderer: Texture marked for update but no image data found.");else if(Ne.complete===!1)Se("WebGLRenderer: Texture marked for update but image is incomplete");else{be(ue,K,I);return}}else K.isExternalTexture&&(ue.__webglTexture=K.sourceTexture?K.sourceTexture:null);t.bindTexture(i.TEXTURE_2D,ue.__webglTexture,i.TEXTURE0+I)}function P(K,I){const ue=n.get(K);if(K.isRenderTargetTexture===!1&&K.version>0&&ue.__version!==K.version){be(ue,K,I);return}else K.isExternalTexture&&(ue.__webglTexture=K.sourceTexture?K.sourceTexture:null);t.bindTexture(i.TEXTURE_2D_ARRAY,ue.__webglTexture,i.TEXTURE0+I)}function X(K,I){const ue=n.get(K);if(K.isRenderTargetTexture===!1&&K.version>0&&ue.__version!==K.version){be(ue,K,I);return}t.bindTexture(i.TEXTURE_3D,ue.__webglTexture,i.TEXTURE0+I)}function J(K,I){const ue=n.get(K);if(K.isCubeDepthTexture!==!0&&K.version>0&&ue.__version!==K.version){Re(ue,K,I);return}t.bindTexture(i.TEXTURE_CUBE_MAP,ue.__webglTexture,i.TEXTURE0+I)}const re={[Zr]:i.REPEAT,[ui]:i.CLAMP_TO_EDGE,[vc]:i.MIRRORED_REPEAT},ne={[$n]:i.NEAREST,[mg]:i.NEAREST_MIPMAP_NEAREST,[Ho]:i.NEAREST_MIPMAP_LINEAR,[Jt]:i.LINEAR,[Qc]:i.LINEAR_MIPMAP_NEAREST,[$s]:i.LINEAR_MIPMAP_LINEAR},ge={[bS]:i.NEVER,[MS]:i.ALWAYS,[yg]:i.LESS,[xg]:i.LEQUAL,[SS]:i.EQUAL,[_g]:i.GEQUAL,[TS]:i.GREATER,[AS]:i.NOTEQUAL};function Te(K,I){if(I.type===Rn&&e.has("OES_texture_float_linear")===!1&&(I.magFilter===Jt||I.magFilter===Qc||I.magFilter===Ho||I.magFilter===$s||I.minFilter===Jt||I.minFilter===Qc||I.minFilter===Ho||I.minFilter===$s)&&Se("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),i.texParameteri(K,i.TEXTURE_WRAP_S,re[I.wrapS]),i.texParameteri(K,i.TEXTURE_WRAP_T,re[I.wrapT]),(K===i.TEXTURE_3D||K===i.TEXTURE_2D_ARRAY)&&i.texParameteri(K,i.TEXTURE_WRAP_R,re[I.wrapR]),i.texParameteri(K,i.TEXTURE_MAG_FILTER,ne[I.magFilter]),i.texParameteri(K,i.TEXTURE_MIN_FILTER,ne[I.minFilter]),I.compareFunction&&(i.texParameteri(K,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(K,i.TEXTURE_COMPARE_FUNC,ge[I.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(I.magFilter===$n||I.minFilter!==Ho&&I.minFilter!==$s||I.type===Rn&&e.has("OES_texture_float_linear")===!1)return;if(I.anisotropy>1||n.get(I).__currentAnisotropy){const ue=e.get("EXT_texture_filter_anisotropic");i.texParameterf(K,ue.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(I.anisotropy,s.getMaxAnisotropy())),n.get(I).__currentAnisotropy=I.anisotropy}}}function Be(K,I){let ue=!1;K.__webglInit===void 0&&(K.__webglInit=!0,I.addEventListener("dispose",C));const Ne=I.source;let ze=f.get(Ne);ze===void 0&&(ze={},f.set(Ne,ze));const we=V(I);if(we!==K.__cacheKey){ze[we]===void 0&&(ze[we]={texture:i.createTexture(),usedTimes:0},a.memory.textures++,ue=!0),ze[we].usedTimes++;const Ut=ze[K.__cacheKey];Ut!==void 0&&(ze[K.__cacheKey].usedTimes--,Ut.usedTimes===0&&E(I)),K.__cacheKey=we,K.__webglTexture=ze[we].texture}return ue}function et(K,I,ue){return Math.floor(Math.floor(K/ue)/I)}function wt(K,I,ue,Ne){const we=K.updateRanges;if(we.length===0)t.texSubImage2D(i.TEXTURE_2D,0,0,0,I.width,I.height,ue,Ne,I.data);else{we.sort((Xe,Qe)=>Xe.start-Qe.start);let Ut=0;for(let Xe=1;Xe<we.length;Xe++){const Qe=we[Ut],Et=we[Xe],ee=Qe.start+Qe.count,me=et(Et.start,I.width,4),Me=et(Qe.start,I.width,4);Et.start<=ee+1&&me===Me&&et(Et.start+Et.count-1,I.width,4)===me?Qe.count=Math.max(Qe.count,Et.start+Et.count-Qe.start):(++Ut,we[Ut]=Et)}we.length=Ut+1;const dt=i.getParameter(i.UNPACK_ROW_LENGTH),Pt=i.getParameter(i.UNPACK_SKIP_PIXELS),Qt=i.getParameter(i.UNPACK_SKIP_ROWS);i.pixelStorei(i.UNPACK_ROW_LENGTH,I.width);for(let Xe=0,Qe=we.length;Xe<Qe;Xe++){const Et=we[Xe],ee=Math.floor(Et.start/4),me=Math.ceil(Et.count/4),Me=ee%I.width,Q=Math.floor(ee/I.width),pe=me,He=1;i.pixelStorei(i.UNPACK_SKIP_PIXELS,Me),i.pixelStorei(i.UNPACK_SKIP_ROWS,Q),t.texSubImage2D(i.TEXTURE_2D,0,Me,Q,pe,He,ue,Ne,I.data)}K.clearUpdateRanges(),i.pixelStorei(i.UNPACK_ROW_LENGTH,dt),i.pixelStorei(i.UNPACK_SKIP_PIXELS,Pt),i.pixelStorei(i.UNPACK_SKIP_ROWS,Qt)}}function be(K,I,ue){let Ne=i.TEXTURE_2D;(I.isDataArrayTexture||I.isCompressedArrayTexture)&&(Ne=i.TEXTURE_2D_ARRAY),I.isData3DTexture&&(Ne=i.TEXTURE_3D);const ze=Be(K,I),we=I.source;t.bindTexture(Ne,K.__webglTexture,i.TEXTURE0+ue);const Ut=n.get(we);if(we.version!==Ut.__version||ze===!0){t.activeTexture(i.TEXTURE0+ue);const dt=en.getPrimaries(en.workingColorSpace),Pt=I.colorSpace===ha?null:en.getPrimaries(I.colorSpace),Qt=I.colorSpace===ha||dt===Pt?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,I.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,I.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,I.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Qt);let Xe=x(I.image,!1,s.maxTextureSize);Xe=Vt(I,Xe);const Qe=r.convert(I.format,I.colorSpace),Et=r.convert(I.type);let ee=S(I.internalFormat,Qe,Et,I.colorSpace,I.isVideoTexture);Te(Ne,I);let me;const Me=I.mipmaps,Q=I.isVideoTexture!==!0,pe=Ut.__version===void 0||ze===!0,He=we.dataReady,it=M(I,Xe);if(I.isDepthTexture)ee=T(I.format===kr,I.type),pe&&(Q?t.texStorage2D(i.TEXTURE_2D,1,ee,Xe.width,Xe.height):t.texImage2D(i.TEXTURE_2D,0,ee,Xe.width,Xe.height,0,Qe,Et,null));else if(I.isDataTexture)if(Me.length>0){Q&&pe&&t.texStorage2D(i.TEXTURE_2D,it,ee,Me[0].width,Me[0].height);for(let qe=0,We=Me.length;qe<We;qe++)me=Me[qe],Q?He&&t.texSubImage2D(i.TEXTURE_2D,qe,0,0,me.width,me.height,Qe,Et,me.data):t.texImage2D(i.TEXTURE_2D,qe,ee,me.width,me.height,0,Qe,Et,me.data);I.generateMipmaps=!1}else Q?(pe&&t.texStorage2D(i.TEXTURE_2D,it,ee,Xe.width,Xe.height),He&&wt(I,Xe,Qe,Et)):t.texImage2D(i.TEXTURE_2D,0,ee,Xe.width,Xe.height,0,Qe,Et,Xe.data);else if(I.isCompressedTexture)if(I.isCompressedArrayTexture){Q&&pe&&t.texStorage3D(i.TEXTURE_2D_ARRAY,it,ee,Me[0].width,Me[0].height,Xe.depth);for(let qe=0,We=Me.length;qe<We;qe++)if(me=Me[qe],I.format!==ii)if(Qe!==null)if(Q){if(He)if(I.layerUpdates.size>0){const lt=IM(me.width,me.height,I.format,I.type);for(const Dt of I.layerUpdates){const mn=me.data.subarray(Dt*lt/me.data.BYTES_PER_ELEMENT,(Dt+1)*lt/me.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,qe,0,0,Dt,me.width,me.height,1,Qe,mn)}I.clearLayerUpdates()}else t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,qe,0,0,0,me.width,me.height,Xe.depth,Qe,me.data)}else t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,qe,ee,me.width,me.height,Xe.depth,0,me.data,0,0);else Se("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Q?He&&t.texSubImage3D(i.TEXTURE_2D_ARRAY,qe,0,0,0,me.width,me.height,Xe.depth,Qe,Et,me.data):t.texImage3D(i.TEXTURE_2D_ARRAY,qe,ee,me.width,me.height,Xe.depth,0,Qe,Et,me.data)}else{Q&&pe&&t.texStorage2D(i.TEXTURE_2D,it,ee,Me[0].width,Me[0].height);for(let qe=0,We=Me.length;qe<We;qe++)me=Me[qe],I.format!==ii?Qe!==null?Q?He&&t.compressedTexSubImage2D(i.TEXTURE_2D,qe,0,0,me.width,me.height,Qe,me.data):t.compressedTexImage2D(i.TEXTURE_2D,qe,ee,me.width,me.height,0,me.data):Se("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Q?He&&t.texSubImage2D(i.TEXTURE_2D,qe,0,0,me.width,me.height,Qe,Et,me.data):t.texImage2D(i.TEXTURE_2D,qe,ee,me.width,me.height,0,Qe,Et,me.data)}else if(I.isDataArrayTexture)if(Q){if(pe&&t.texStorage3D(i.TEXTURE_2D_ARRAY,it,ee,Xe.width,Xe.height,Xe.depth),He)if(I.layerUpdates.size>0){const qe=IM(Xe.width,Xe.height,I.format,I.type);for(const We of I.layerUpdates){const lt=Xe.data.subarray(We*qe/Xe.data.BYTES_PER_ELEMENT,(We+1)*qe/Xe.data.BYTES_PER_ELEMENT);t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,We,Xe.width,Xe.height,1,Qe,Et,lt)}I.clearLayerUpdates()}else t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,Xe.width,Xe.height,Xe.depth,Qe,Et,Xe.data)}else t.texImage3D(i.TEXTURE_2D_ARRAY,0,ee,Xe.width,Xe.height,Xe.depth,0,Qe,Et,Xe.data);else if(I.isData3DTexture)Q?(pe&&t.texStorage3D(i.TEXTURE_3D,it,ee,Xe.width,Xe.height,Xe.depth),He&&t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,Xe.width,Xe.height,Xe.depth,Qe,Et,Xe.data)):t.texImage3D(i.TEXTURE_3D,0,ee,Xe.width,Xe.height,Xe.depth,0,Qe,Et,Xe.data);else if(I.isFramebufferTexture){if(pe)if(Q)t.texStorage2D(i.TEXTURE_2D,it,ee,Xe.width,Xe.height);else{let qe=Xe.width,We=Xe.height;for(let lt=0;lt<it;lt++)t.texImage2D(i.TEXTURE_2D,lt,ee,qe,We,0,Qe,Et,null),qe>>=1,We>>=1}}else if(Me.length>0){if(Q&&pe){const qe=Je(Me[0]);t.texStorage2D(i.TEXTURE_2D,it,ee,qe.width,qe.height)}for(let qe=0,We=Me.length;qe<We;qe++)me=Me[qe],Q?He&&t.texSubImage2D(i.TEXTURE_2D,qe,0,0,Qe,Et,me):t.texImage2D(i.TEXTURE_2D,qe,ee,Qe,Et,me);I.generateMipmaps=!1}else if(Q){if(pe){const qe=Je(Xe);t.texStorage2D(i.TEXTURE_2D,it,ee,qe.width,qe.height)}He&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,Qe,Et,Xe)}else t.texImage2D(i.TEXTURE_2D,0,ee,Qe,Et,Xe);v(I)&&y(Ne),Ut.__version=we.version,I.onUpdate&&I.onUpdate(I)}K.__version=I.version}function Re(K,I,ue){if(I.image.length!==6)return;const Ne=Be(K,I),ze=I.source;t.bindTexture(i.TEXTURE_CUBE_MAP,K.__webglTexture,i.TEXTURE0+ue);const we=n.get(ze);if(ze.version!==we.__version||Ne===!0){t.activeTexture(i.TEXTURE0+ue);const Ut=en.getPrimaries(en.workingColorSpace),dt=I.colorSpace===ha?null:en.getPrimaries(I.colorSpace),Pt=I.colorSpace===ha||Ut===dt?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,I.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,I.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,I.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Pt);const Qt=I.isCompressedTexture||I.image[0].isCompressedTexture,Xe=I.image[0]&&I.image[0].isDataTexture,Qe=[];for(let We=0;We<6;We++)!Qt&&!Xe?Qe[We]=x(I.image[We],!0,s.maxCubemapSize):Qe[We]=Xe?I.image[We].image:I.image[We],Qe[We]=Vt(I,Qe[We]);const Et=Qe[0],ee=r.convert(I.format,I.colorSpace),me=r.convert(I.type),Me=S(I.internalFormat,ee,me,I.colorSpace),Q=I.isVideoTexture!==!0,pe=we.__version===void 0||Ne===!0,He=ze.dataReady;let it=M(I,Et);Te(i.TEXTURE_CUBE_MAP,I);let qe;if(Qt){Q&&pe&&t.texStorage2D(i.TEXTURE_CUBE_MAP,it,Me,Et.width,Et.height);for(let We=0;We<6;We++){qe=Qe[We].mipmaps;for(let lt=0;lt<qe.length;lt++){const Dt=qe[lt];I.format!==ii?ee!==null?Q?He&&t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+We,lt,0,0,Dt.width,Dt.height,ee,Dt.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+We,lt,Me,Dt.width,Dt.height,0,Dt.data):Se("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Q?He&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+We,lt,0,0,Dt.width,Dt.height,ee,me,Dt.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+We,lt,Me,Dt.width,Dt.height,0,ee,me,Dt.data)}}}else{if(qe=I.mipmaps,Q&&pe){qe.length>0&&it++;const We=Je(Qe[0]);t.texStorage2D(i.TEXTURE_CUBE_MAP,it,Me,We.width,We.height)}for(let We=0;We<6;We++)if(Xe){Q?He&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+We,0,0,0,Qe[We].width,Qe[We].height,ee,me,Qe[We].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+We,0,Me,Qe[We].width,Qe[We].height,0,ee,me,Qe[We].data);for(let lt=0;lt<qe.length;lt++){const mn=qe[lt].image[We].image;Q?He&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+We,lt+1,0,0,mn.width,mn.height,ee,me,mn.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+We,lt+1,Me,mn.width,mn.height,0,ee,me,mn.data)}}else{Q?He&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+We,0,0,0,ee,me,Qe[We]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+We,0,Me,ee,me,Qe[We]);for(let lt=0;lt<qe.length;lt++){const Dt=qe[lt];Q?He&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+We,lt+1,0,0,ee,me,Dt.image[We]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+We,lt+1,Me,ee,me,Dt.image[We])}}}v(I)&&y(i.TEXTURE_CUBE_MAP),we.__version=ze.version,I.onUpdate&&I.onUpdate(I)}K.__version=I.version}function tt(K,I,ue,Ne,ze,we){const Ut=r.convert(ue.format,ue.colorSpace),dt=r.convert(ue.type),Pt=S(ue.internalFormat,Ut,dt,ue.colorSpace),Qt=n.get(I),Xe=n.get(ue);if(Xe.__renderTarget=I,!Qt.__hasExternalTextures){const Qe=Math.max(1,I.width>>we),Et=Math.max(1,I.height>>we);ze===i.TEXTURE_3D||ze===i.TEXTURE_2D_ARRAY?t.texImage3D(ze,we,Pt,Qe,Et,I.depth,0,Ut,dt,null):t.texImage2D(ze,we,Pt,Qe,Et,0,Ut,dt,null)}t.bindFramebuffer(i.FRAMEBUFFER,K),zt(I)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,Ne,ze,Xe.__webglTexture,0,Z(I)):(ze===i.TEXTURE_2D||ze>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&ze<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,Ne,ze,Xe.__webglTexture,we),t.bindFramebuffer(i.FRAMEBUFFER,null)}function Bt(K,I,ue){if(i.bindRenderbuffer(i.RENDERBUFFER,K),I.depthBuffer){const Ne=I.depthTexture,ze=Ne&&Ne.isDepthTexture?Ne.type:null,we=T(I.stencilBuffer,ze),Ut=I.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;zt(I)?o.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Z(I),we,I.width,I.height):ue?i.renderbufferStorageMultisample(i.RENDERBUFFER,Z(I),we,I.width,I.height):i.renderbufferStorage(i.RENDERBUFFER,we,I.width,I.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,Ut,i.RENDERBUFFER,K)}else{const Ne=I.textures;for(let ze=0;ze<Ne.length;ze++){const we=Ne[ze],Ut=r.convert(we.format,we.colorSpace),dt=r.convert(we.type),Pt=S(we.internalFormat,Ut,dt,we.colorSpace);zt(I)?o.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Z(I),Pt,I.width,I.height):ue?i.renderbufferStorageMultisample(i.RENDERBUFFER,Z(I),Pt,I.width,I.height):i.renderbufferStorage(i.RENDERBUFFER,Pt,I.width,I.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function ht(K,I,ue){const Ne=I.isWebGLCubeRenderTarget===!0;if(t.bindFramebuffer(i.FRAMEBUFFER,K),!(I.depthTexture&&I.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const ze=n.get(I.depthTexture);if(ze.__renderTarget=I,(!ze.__webglTexture||I.depthTexture.image.width!==I.width||I.depthTexture.image.height!==I.height)&&(I.depthTexture.image.width=I.width,I.depthTexture.image.height=I.height,I.depthTexture.needsUpdate=!0),Ne){if(ze.__webglInit===void 0&&(ze.__webglInit=!0,I.depthTexture.addEventListener("dispose",C)),ze.__webglTexture===void 0){ze.__webglTexture=i.createTexture(),t.bindTexture(i.TEXTURE_CUBE_MAP,ze.__webglTexture),Te(i.TEXTURE_CUBE_MAP,I.depthTexture);const Qt=r.convert(I.depthTexture.format),Xe=r.convert(I.depthTexture.type);let Qe;I.depthTexture.format===lr?Qe=i.DEPTH_COMPONENT24:I.depthTexture.format===kr&&(Qe=i.DEPTH24_STENCIL8);for(let Et=0;Et<6;Et++)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Et,0,Qe,I.width,I.height,0,Qt,Xe,null)}}else Y(I.depthTexture,0);const we=ze.__webglTexture,Ut=Z(I),dt=Ne?i.TEXTURE_CUBE_MAP_POSITIVE_X+ue:i.TEXTURE_2D,Pt=I.depthTexture.format===kr?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;if(I.depthTexture.format===lr)zt(I)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,Pt,dt,we,0,Ut):i.framebufferTexture2D(i.FRAMEBUFFER,Pt,dt,we,0);else if(I.depthTexture.format===kr)zt(I)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,Pt,dt,we,0,Ut):i.framebufferTexture2D(i.FRAMEBUFFER,Pt,dt,we,0);else throw new Error("Unknown depthTexture format")}function Ke(K){const I=n.get(K),ue=K.isWebGLCubeRenderTarget===!0;if(I.__boundDepthTexture!==K.depthTexture){const Ne=K.depthTexture;if(I.__depthDisposeCallback&&I.__depthDisposeCallback(),Ne){const ze=()=>{delete I.__boundDepthTexture,delete I.__depthDisposeCallback,Ne.removeEventListener("dispose",ze)};Ne.addEventListener("dispose",ze),I.__depthDisposeCallback=ze}I.__boundDepthTexture=Ne}if(K.depthTexture&&!I.__autoAllocateDepthBuffer)if(ue)for(let Ne=0;Ne<6;Ne++)ht(I.__webglFramebuffer[Ne],K,Ne);else{const Ne=K.texture.mipmaps;Ne&&Ne.length>0?ht(I.__webglFramebuffer[0],K,0):ht(I.__webglFramebuffer,K,0)}else if(ue){I.__webglDepthbuffer=[];for(let Ne=0;Ne<6;Ne++)if(t.bindFramebuffer(i.FRAMEBUFFER,I.__webglFramebuffer[Ne]),I.__webglDepthbuffer[Ne]===void 0)I.__webglDepthbuffer[Ne]=i.createRenderbuffer(),Bt(I.__webglDepthbuffer[Ne],K,!1);else{const ze=K.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,we=I.__webglDepthbuffer[Ne];i.bindRenderbuffer(i.RENDERBUFFER,we),i.framebufferRenderbuffer(i.FRAMEBUFFER,ze,i.RENDERBUFFER,we)}}else{const Ne=K.texture.mipmaps;if(Ne&&Ne.length>0?t.bindFramebuffer(i.FRAMEBUFFER,I.__webglFramebuffer[0]):t.bindFramebuffer(i.FRAMEBUFFER,I.__webglFramebuffer),I.__webglDepthbuffer===void 0)I.__webglDepthbuffer=i.createRenderbuffer(),Bt(I.__webglDepthbuffer,K,!1);else{const ze=K.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,we=I.__webglDepthbuffer;i.bindRenderbuffer(i.RENDERBUFFER,we),i.framebufferRenderbuffer(i.FRAMEBUFFER,ze,i.RENDERBUFFER,we)}}t.bindFramebuffer(i.FRAMEBUFFER,null)}function jt(K,I,ue){const Ne=n.get(K);I!==void 0&&tt(Ne.__webglFramebuffer,K,K.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),ue!==void 0&&Ke(K)}function Mt(K){const I=K.texture,ue=n.get(K),Ne=n.get(I);K.addEventListener("dispose",w);const ze=K.textures,we=K.isWebGLCubeRenderTarget===!0,Ut=ze.length>1;if(Ut||(Ne.__webglTexture===void 0&&(Ne.__webglTexture=i.createTexture()),Ne.__version=I.version,a.memory.textures++),we){ue.__webglFramebuffer=[];for(let dt=0;dt<6;dt++)if(I.mipmaps&&I.mipmaps.length>0){ue.__webglFramebuffer[dt]=[];for(let Pt=0;Pt<I.mipmaps.length;Pt++)ue.__webglFramebuffer[dt][Pt]=i.createFramebuffer()}else ue.__webglFramebuffer[dt]=i.createFramebuffer()}else{if(I.mipmaps&&I.mipmaps.length>0){ue.__webglFramebuffer=[];for(let dt=0;dt<I.mipmaps.length;dt++)ue.__webglFramebuffer[dt]=i.createFramebuffer()}else ue.__webglFramebuffer=i.createFramebuffer();if(Ut)for(let dt=0,Pt=ze.length;dt<Pt;dt++){const Qt=n.get(ze[dt]);Qt.__webglTexture===void 0&&(Qt.__webglTexture=i.createTexture(),a.memory.textures++)}if(K.samples>0&&zt(K)===!1){ue.__webglMultisampledFramebuffer=i.createFramebuffer(),ue.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,ue.__webglMultisampledFramebuffer);for(let dt=0;dt<ze.length;dt++){const Pt=ze[dt];ue.__webglColorRenderbuffer[dt]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,ue.__webglColorRenderbuffer[dt]);const Qt=r.convert(Pt.format,Pt.colorSpace),Xe=r.convert(Pt.type),Qe=S(Pt.internalFormat,Qt,Xe,Pt.colorSpace,K.isXRRenderTarget===!0),Et=Z(K);i.renderbufferStorageMultisample(i.RENDERBUFFER,Et,Qe,K.width,K.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+dt,i.RENDERBUFFER,ue.__webglColorRenderbuffer[dt])}i.bindRenderbuffer(i.RENDERBUFFER,null),K.depthBuffer&&(ue.__webglDepthRenderbuffer=i.createRenderbuffer(),Bt(ue.__webglDepthRenderbuffer,K,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(we){t.bindTexture(i.TEXTURE_CUBE_MAP,Ne.__webglTexture),Te(i.TEXTURE_CUBE_MAP,I);for(let dt=0;dt<6;dt++)if(I.mipmaps&&I.mipmaps.length>0)for(let Pt=0;Pt<I.mipmaps.length;Pt++)tt(ue.__webglFramebuffer[dt][Pt],K,I,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+dt,Pt);else tt(ue.__webglFramebuffer[dt],K,I,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+dt,0);v(I)&&y(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Ut){for(let dt=0,Pt=ze.length;dt<Pt;dt++){const Qt=ze[dt],Xe=n.get(Qt);let Qe=i.TEXTURE_2D;(K.isWebGL3DRenderTarget||K.isWebGLArrayRenderTarget)&&(Qe=K.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(Qe,Xe.__webglTexture),Te(Qe,Qt),tt(ue.__webglFramebuffer,K,Qt,i.COLOR_ATTACHMENT0+dt,Qe,0),v(Qt)&&y(Qe)}t.unbindTexture()}else{let dt=i.TEXTURE_2D;if((K.isWebGL3DRenderTarget||K.isWebGLArrayRenderTarget)&&(dt=K.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(dt,Ne.__webglTexture),Te(dt,I),I.mipmaps&&I.mipmaps.length>0)for(let Pt=0;Pt<I.mipmaps.length;Pt++)tt(ue.__webglFramebuffer[Pt],K,I,i.COLOR_ATTACHMENT0,dt,Pt);else tt(ue.__webglFramebuffer,K,I,i.COLOR_ATTACHMENT0,dt,0);v(I)&&y(dt),t.unbindTexture()}K.depthBuffer&&Ke(K)}function Ie(K){const I=K.textures;for(let ue=0,Ne=I.length;ue<Ne;ue++){const ze=I[ue];if(v(ze)){const we=b(K),Ut=n.get(ze).__webglTexture;t.bindTexture(we,Ut),y(we),t.unbindTexture()}}}const ke=[],Ve=[];function at(K){if(K.samples>0){if(zt(K)===!1){const I=K.textures,ue=K.width,Ne=K.height;let ze=i.COLOR_BUFFER_BIT;const we=K.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Ut=n.get(K),dt=I.length>1;if(dt)for(let Qt=0;Qt<I.length;Qt++)t.bindFramebuffer(i.FRAMEBUFFER,Ut.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Qt,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,Ut.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Qt,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,Ut.__webglMultisampledFramebuffer);const Pt=K.texture.mipmaps;Pt&&Pt.length>0?t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Ut.__webglFramebuffer[0]):t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Ut.__webglFramebuffer);for(let Qt=0;Qt<I.length;Qt++){if(K.resolveDepthBuffer&&(K.depthBuffer&&(ze|=i.DEPTH_BUFFER_BIT),K.stencilBuffer&&K.resolveStencilBuffer&&(ze|=i.STENCIL_BUFFER_BIT)),dt){i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,Ut.__webglColorRenderbuffer[Qt]);const Xe=n.get(I[Qt]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,Xe,0)}i.blitFramebuffer(0,0,ue,Ne,0,0,ue,Ne,ze,i.NEAREST),l===!0&&(ke.length=0,Ve.length=0,ke.push(i.COLOR_ATTACHMENT0+Qt),K.depthBuffer&&K.resolveDepthBuffer===!1&&(ke.push(we),Ve.push(we),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,Ve)),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,ke))}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),dt)for(let Qt=0;Qt<I.length;Qt++){t.bindFramebuffer(i.FRAMEBUFFER,Ut.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Qt,i.RENDERBUFFER,Ut.__webglColorRenderbuffer[Qt]);const Xe=n.get(I[Qt]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,Ut.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Qt,i.TEXTURE_2D,Xe,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Ut.__webglMultisampledFramebuffer)}else if(K.depthBuffer&&K.resolveDepthBuffer===!1&&l){const I=K.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[I])}}}function Z(K){return Math.min(s.maxSamples,K.samples)}function zt(K){const I=n.get(K);return K.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&I.__useRenderToTexture!==!1}function st(K){const I=a.render.frame;u.get(K)!==I&&(u.set(K,I),K.update())}function Vt(K,I){const ue=K.colorSpace,Ne=K.format,ze=K.type;return K.isCompressedTexture===!0||K.isVideoTexture===!0||ue!==Jr&&ue!==ha&&(en.getTransfer(ue)===Ft?(Ne!==ii||ze!==ei)&&Se("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):De("WebGLTextures: Unsupported texture color space:",ue)),I}function Je(K){return typeof HTMLImageElement<"u"&&K instanceof HTMLImageElement?(c.width=K.naturalWidth||K.width,c.height=K.naturalHeight||K.height):typeof VideoFrame<"u"&&K instanceof VideoFrame?(c.width=K.displayWidth,c.height=K.displayHeight):(c.width=K.width,c.height=K.height),c}this.allocateTextureUnit=F,this.resetTextureUnits=H,this.setTexture2D=Y,this.setTexture2DArray=P,this.setTexture3D=X,this.setTextureCube=J,this.rebindTextures=jt,this.setupRenderTarget=Mt,this.updateRenderTargetMipmap=Ie,this.updateMultisampleRenderTarget=at,this.setupDepthRenderbuffer=Ke,this.setupFrameBufferTexture=tt,this.useMultisampledRTT=zt,this.isReversedDepthBuffer=function(){return t.buffers.depth.getReversed()}}function RK(i,e){function t(n,s=ha){let r;const a=en.getTransfer(s);if(n===ei)return i.UNSIGNED_BYTE;if(n===Sx)return i.UNSIGNED_SHORT_4_4_4_4;if(n===Tx)return i.UNSIGNED_SHORT_5_5_5_1;if(n===Ax)return i.UNSIGNED_INT_5_9_9_9_REV;if(n===Mx)return i.UNSIGNED_INT_10F_11F_11F_REV;if(n===$c)return i.BYTE;if(n===eu)return i.SHORT;if(n===ko)return i.UNSIGNED_SHORT;if(n===Is)return i.INT;if(n===Jn)return i.UNSIGNED_INT;if(n===Rn)return i.FLOAT;if(n===ln)return i.HALF_FLOAT;if(n===_S)return i.ALPHA;if(n===gg)return i.RGB;if(n===ii)return i.RGBA;if(n===lr)return i.DEPTH_COMPONENT;if(n===kr)return i.DEPTH_STENCIL;if(n===ql)return i.RED;if(n===Oh)return i.RED_INTEGER;if(n===Wr)return i.RG;if(n===Yf)return i.RG_INTEGER;if(n===Kf)return i.RGBA_INTEGER;if(n===tu||n===nu||n===iu||n===su)if(a===Ft)if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(n===tu)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===nu)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===iu)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===su)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=e.get("WEBGL_compressed_texture_s3tc"),r!==null){if(n===tu)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===nu)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===iu)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===su)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===Xm||n===qm||n===jm||n===Ym)if(r=e.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(n===Xm)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===qm)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===jm)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Ym)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===ff||n===pf||n===mf||n===gf||n===yf||n===Rh||n===xf)if(r=e.get("WEBGL_compressed_texture_etc"),r!==null){if(n===ff||n===pf)return a===Ft?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===mf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC;if(n===gf)return r.COMPRESSED_R11_EAC;if(n===yf)return r.COMPRESSED_SIGNED_R11_EAC;if(n===Rh)return r.COMPRESSED_RG11_EAC;if(n===xf)return r.COMPRESSED_SIGNED_RG11_EAC}else return null;if(n===_f||n===vf||n===bf||n===Sf||n===Tf||n===Af||n===Mf||n===Ef||n===Cf||n===wf||n===Rf||n===Nf||n===Bf||n===Df)if(r=e.get("WEBGL_compressed_texture_astc"),r!==null){if(n===_f)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===vf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===bf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Sf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Tf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Af)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Mf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Ef)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Cf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===wf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Rf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Nf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Bf)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Df)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===Lf||n===xb||n===_b)if(r=e.get("EXT_texture_compression_bptc"),r!==null){if(n===Lf)return a===Ft?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===xb)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===_b)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===Uf||n===If||n===Nh||n===Pf)if(r=e.get("EXT_texture_compression_rgtc"),r!==null){if(n===Uf)return r.COMPRESSED_RED_RGTC1_EXT;if(n===If)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Nh)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Pf)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===ja?i.UNSIGNED_INT_24_8:i[n]!==void 0?i[n]:null}return{convert:t}}const Dxe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Lxe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Uxe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const n=new nC(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new Za({vertexShader:Dxe,fragmentShader:Lxe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Kn(new Cc(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Ixe extends Ta{constructor(e,t){super();const n=this;let s=null,r=1,a=null,o="local-floor",l=1,c=null,u=null,h=null,f=null,m=null,g=null;const x=typeof XRWebGLBinding<"u",v=new Uxe,y={},b=t.getContextAttributes();let S=null,T=null;const M=[],C=[],w=new Ae;let N=null;const E=new Ci;E.viewport=new un;const B=new Ci;B.viewport=new un;const U=[E,B],H=new MC;let F=null,V=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(be){let Re=M[be];return Re===void 0&&(Re=new xy,M[be]=Re),Re.getTargetRaySpace()},this.getControllerGrip=function(be){let Re=M[be];return Re===void 0&&(Re=new xy,M[be]=Re),Re.getGripSpace()},this.getHand=function(be){let Re=M[be];return Re===void 0&&(Re=new xy,M[be]=Re),Re.getHandSpace()};function Y(be){const Re=C.indexOf(be.inputSource);if(Re===-1)return;const tt=M[Re];tt!==void 0&&(tt.update(be.inputSource,be.frame,c||a),tt.dispatchEvent({type:be.type,data:be.inputSource}))}function P(){s.removeEventListener("select",Y),s.removeEventListener("selectstart",Y),s.removeEventListener("selectend",Y),s.removeEventListener("squeeze",Y),s.removeEventListener("squeezestart",Y),s.removeEventListener("squeezeend",Y),s.removeEventListener("end",P),s.removeEventListener("inputsourceschange",X);for(let be=0;be<M.length;be++){const Re=C[be];Re!==null&&(C[be]=null,M[be].disconnect(Re))}F=null,V=null,v.reset();for(const be in y)delete y[be];e.setRenderTarget(S),m=null,f=null,h=null,s=null,T=null,wt.stop(),n.isPresenting=!1,e.setPixelRatio(N),e.setSize(w.width,w.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(be){r=be,n.isPresenting===!0&&Se("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(be){o=be,n.isPresenting===!0&&Se("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(be){c=be},this.getBaseLayer=function(){return f!==null?f:m},this.getBinding=function(){return h===null&&x&&(h=new XRWebGLBinding(s,t)),h},this.getFrame=function(){return g},this.getSession=function(){return s},this.setSession=async function(be){if(s=be,s!==null){if(S=e.getRenderTarget(),s.addEventListener("select",Y),s.addEventListener("selectstart",Y),s.addEventListener("selectend",Y),s.addEventListener("squeeze",Y),s.addEventListener("squeezestart",Y),s.addEventListener("squeezeend",Y),s.addEventListener("end",P),s.addEventListener("inputsourceschange",X),b.xrCompatible!==!0&&await t.makeXRCompatible(),N=e.getPixelRatio(),e.getSize(w),x&&"createProjectionLayer"in XRWebGLBinding.prototype){let tt=null,Bt=null,ht=null;b.depth&&(ht=b.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,tt=b.stencil?kr:lr,Bt=b.stencil?ja:Jn);const Ke={colorFormat:t.RGBA8,depthFormat:ht,scaleFactor:r};h=this.getBinding(),f=h.createProjectionLayer(Ke),s.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),T=new xa(f.textureWidth,f.textureHeight,{format:ii,type:ei,depthTexture:new tr(f.textureWidth,f.textureHeight,Bt,void 0,void 0,void 0,void 0,void 0,void 0,tt),stencilBuffer:b.stencil,colorSpace:e.outputColorSpace,samples:b.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}else{const tt={antialias:b.antialias,alpha:!0,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:r};m=new XRWebGLLayer(s,t,tt),s.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),T=new xa(m.framebufferWidth,m.framebufferHeight,{format:ii,type:ei,colorSpace:e.outputColorSpace,stencilBuffer:b.stencil,resolveDepthBuffer:m.ignoreDepthValues===!1,resolveStencilBuffer:m.ignoreDepthValues===!1})}T.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await s.requestReferenceSpace(o),wt.setContext(s),wt.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode},this.getDepthTexture=function(){return v.getDepthTexture()};function X(be){for(let Re=0;Re<be.removed.length;Re++){const tt=be.removed[Re],Bt=C.indexOf(tt);Bt>=0&&(C[Bt]=null,M[Bt].disconnect(tt))}for(let Re=0;Re<be.added.length;Re++){const tt=be.added[Re];let Bt=C.indexOf(tt);if(Bt===-1){for(let Ke=0;Ke<M.length;Ke++)if(Ke>=C.length){C.push(tt),Bt=Ke;break}else if(C[Ke]===null){C[Ke]=tt,Bt=Ke;break}if(Bt===-1)break}const ht=M[Bt];ht&&ht.connect(tt)}}const J=new z,re=new z;function ne(be,Re,tt){J.setFromMatrixPosition(Re.matrixWorld),re.setFromMatrixPosition(tt.matrixWorld);const Bt=J.distanceTo(re),ht=Re.projectionMatrix.elements,Ke=tt.projectionMatrix.elements,jt=ht[14]/(ht[10]-1),Mt=ht[14]/(ht[10]+1),Ie=(ht[9]+1)/ht[5],ke=(ht[9]-1)/ht[5],Ve=(ht[8]-1)/ht[0],at=(Ke[8]+1)/Ke[0],Z=jt*Ve,zt=jt*at,st=Bt/(-Ve+at),Vt=st*-Ve;if(Re.matrixWorld.decompose(be.position,be.quaternion,be.scale),be.translateX(Vt),be.translateZ(st),be.matrixWorld.compose(be.position,be.quaternion,be.scale),be.matrixWorldInverse.copy(be.matrixWorld).invert(),ht[10]===-1)be.projectionMatrix.copy(Re.projectionMatrix),be.projectionMatrixInverse.copy(Re.projectionMatrixInverse);else{const Je=jt+st,K=Mt+st,I=Z-Vt,ue=zt+(Bt-Vt),Ne=Ie*Mt/K*Je,ze=ke*Mt/K*Je;be.projectionMatrix.makePerspective(I,ue,Ne,ze,Je,K),be.projectionMatrixInverse.copy(be.projectionMatrix).invert()}}function ge(be,Re){Re===null?be.matrixWorld.copy(be.matrix):be.matrixWorld.multiplyMatrices(Re.matrixWorld,be.matrix),be.matrixWorldInverse.copy(be.matrixWorld).invert()}this.updateCamera=function(be){if(s===null)return;let Re=be.near,tt=be.far;v.texture!==null&&(v.depthNear>0&&(Re=v.depthNear),v.depthFar>0&&(tt=v.depthFar)),H.near=B.near=E.near=Re,H.far=B.far=E.far=tt,(F!==H.near||V!==H.far)&&(s.updateRenderState({depthNear:H.near,depthFar:H.far}),F=H.near,V=H.far),H.layers.mask=be.layers.mask|6,E.layers.mask=H.layers.mask&3,B.layers.mask=H.layers.mask&5;const Bt=be.parent,ht=H.cameras;ge(H,Bt);for(let Ke=0;Ke<ht.length;Ke++)ge(ht[Ke],Bt);ht.length===2?ne(H,E,B):H.projectionMatrix.copy(E.projectionMatrix),Te(be,H,Bt)};function Te(be,Re,tt){tt===null?be.matrix.copy(Re.matrixWorld):(be.matrix.copy(tt.matrixWorld),be.matrix.invert(),be.matrix.multiply(Re.matrixWorld)),be.matrix.decompose(be.position,be.quaternion,be.scale),be.updateMatrixWorld(!0),be.projectionMatrix.copy(Re.projectionMatrix),be.projectionMatrixInverse.copy(Re.projectionMatrixInverse),be.isPerspectiveCamera&&(be.fov=Qm*2*Math.atan(1/be.projectionMatrix.elements[5]),be.zoom=1)}this.getCamera=function(){return H},this.getFoveation=function(){if(!(f===null&&m===null))return l},this.setFoveation=function(be){l=be,f!==null&&(f.fixedFoveation=be),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=be)},this.hasDepthSensing=function(){return v.texture!==null},this.getDepthSensingMesh=function(){return v.getMesh(H)},this.getCameraTexture=function(be){return y[be]};let Be=null;function et(be,Re){if(u=Re.getViewerPose(c||a),g=Re,u!==null){const tt=u.views;m!==null&&(e.setRenderTargetFramebuffer(T,m.framebuffer),e.setRenderTarget(T));let Bt=!1;tt.length!==H.cameras.length&&(H.cameras.length=0,Bt=!0);for(let Mt=0;Mt<tt.length;Mt++){const Ie=tt[Mt];let ke=null;if(m!==null)ke=m.getViewport(Ie);else{const at=h.getViewSubImage(f,Ie);ke=at.viewport,Mt===0&&(e.setRenderTargetTextures(T,at.colorTexture,at.depthStencilTexture),e.setRenderTarget(T))}let Ve=U[Mt];Ve===void 0&&(Ve=new Ci,Ve.layers.enable(Mt),Ve.viewport=new un,U[Mt]=Ve),Ve.matrix.fromArray(Ie.transform.matrix),Ve.matrix.decompose(Ve.position,Ve.quaternion,Ve.scale),Ve.projectionMatrix.fromArray(Ie.projectionMatrix),Ve.projectionMatrixInverse.copy(Ve.projectionMatrix).invert(),Ve.viewport.set(ke.x,ke.y,ke.width,ke.height),Mt===0&&(H.matrix.copy(Ve.matrix),H.matrix.decompose(H.position,H.quaternion,H.scale)),Bt===!0&&H.cameras.push(Ve)}const ht=s.enabledFeatures;if(ht&&ht.includes("depth-sensing")&&s.depthUsage=="gpu-optimized"&&x){h=n.getBinding();const Mt=h.getDepthInformation(tt[0]);Mt&&Mt.isValid&&Mt.texture&&v.init(Mt,s.renderState)}if(ht&&ht.includes("camera-access")&&x){e.state.unbindTexture(),h=n.getBinding();for(let Mt=0;Mt<tt.length;Mt++){const Ie=tt[Mt].camera;if(Ie){let ke=y[Ie];ke||(ke=new nC,y[Ie]=ke);const Ve=h.getCameraImage(Ie);ke.sourceTexture=Ve}}}}for(let tt=0;tt<M.length;tt++){const Bt=C[tt],ht=M[tt];Bt!==null&&ht!==void 0&&ht.update(Bt,Re,c||a)}Be&&Be(be,Re),Re.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Re}),g=null}const wt=new AK;wt.setAnimationLoop(et),this.setAnimationLoop=function(be){Be=be},this.dispose=function(){}}}const Yp=new Lr,Pxe=new Lt;function Oxe(i,e){function t(v,y){v.matrixAutoUpdate===!0&&v.updateMatrix(),y.value.copy(v.matrix)}function n(v,y){y.color.getRGB(v.fogColor.value,I9(i)),y.isFog?(v.fogNear.value=y.near,v.fogFar.value=y.far):y.isFogExp2&&(v.fogDensity.value=y.density)}function s(v,y,b,S,T){y.isMeshBasicMaterial||y.isMeshLambertMaterial?r(v,y):y.isMeshToonMaterial?(r(v,y),h(v,y)):y.isMeshPhongMaterial?(r(v,y),u(v,y)):y.isMeshStandardMaterial?(r(v,y),f(v,y),y.isMeshPhysicalMaterial&&m(v,y,T)):y.isMeshMatcapMaterial?(r(v,y),g(v,y)):y.isMeshDepthMaterial?r(v,y):y.isMeshDistanceMaterial?(r(v,y),x(v,y)):y.isMeshNormalMaterial?r(v,y):y.isLineBasicMaterial?(a(v,y),y.isLineDashedMaterial&&o(v,y)):y.isPointsMaterial?l(v,y,b,S):y.isSpriteMaterial?c(v,y):y.isShadowMaterial?(v.color.value.copy(y.color),v.opacity.value=y.opacity):y.isShaderMaterial&&(y.uniformsNeedUpdate=!1)}function r(v,y){v.opacity.value=y.opacity,y.color&&v.diffuse.value.copy(y.color),y.emissive&&v.emissive.value.copy(y.emissive).multiplyScalar(y.emissiveIntensity),y.map&&(v.map.value=y.map,t(y.map,v.mapTransform)),y.alphaMap&&(v.alphaMap.value=y.alphaMap,t(y.alphaMap,v.alphaMapTransform)),y.bumpMap&&(v.bumpMap.value=y.bumpMap,t(y.bumpMap,v.bumpMapTransform),v.bumpScale.value=y.bumpScale,y.side===hi&&(v.bumpScale.value*=-1)),y.normalMap&&(v.normalMap.value=y.normalMap,t(y.normalMap,v.normalMapTransform),v.normalScale.value.copy(y.normalScale),y.side===hi&&v.normalScale.value.negate()),y.displacementMap&&(v.displacementMap.value=y.displacementMap,t(y.displacementMap,v.displacementMapTransform),v.displacementScale.value=y.displacementScale,v.displacementBias.value=y.displacementBias),y.emissiveMap&&(v.emissiveMap.value=y.emissiveMap,t(y.emissiveMap,v.emissiveMapTransform)),y.specularMap&&(v.specularMap.value=y.specularMap,t(y.specularMap,v.specularMapTransform)),y.alphaTest>0&&(v.alphaTest.value=y.alphaTest);const b=e.get(y),S=b.envMap,T=b.envMapRotation;S&&(v.envMap.value=S,Yp.copy(T),Yp.x*=-1,Yp.y*=-1,Yp.z*=-1,S.isCubeTexture&&S.isRenderTargetTexture===!1&&(Yp.y*=-1,Yp.z*=-1),v.envMapRotation.value.setFromMatrix4(Pxe.makeRotationFromEuler(Yp)),v.flipEnvMap.value=S.isCubeTexture&&S.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=y.reflectivity,v.ior.value=y.ior,v.refractionRatio.value=y.refractionRatio),y.lightMap&&(v.lightMap.value=y.lightMap,v.lightMapIntensity.value=y.lightMapIntensity,t(y.lightMap,v.lightMapTransform)),y.aoMap&&(v.aoMap.value=y.aoMap,v.aoMapIntensity.value=y.aoMapIntensity,t(y.aoMap,v.aoMapTransform))}function a(v,y){v.diffuse.value.copy(y.color),v.opacity.value=y.opacity,y.map&&(v.map.value=y.map,t(y.map,v.mapTransform))}function o(v,y){v.dashSize.value=y.dashSize,v.totalSize.value=y.dashSize+y.gapSize,v.scale.value=y.scale}function l(v,y,b,S){v.diffuse.value.copy(y.color),v.opacity.value=y.opacity,v.size.value=y.size*b,v.scale.value=S*.5,y.map&&(v.map.value=y.map,t(y.map,v.uvTransform)),y.alphaMap&&(v.alphaMap.value=y.alphaMap,t(y.alphaMap,v.alphaMapTransform)),y.alphaTest>0&&(v.alphaTest.value=y.alphaTest)}function c(v,y){v.diffuse.value.copy(y.color),v.opacity.value=y.opacity,v.rotation.value=y.rotation,y.map&&(v.map.value=y.map,t(y.map,v.mapTransform)),y.alphaMap&&(v.alphaMap.value=y.alphaMap,t(y.alphaMap,v.alphaMapTransform)),y.alphaTest>0&&(v.alphaTest.value=y.alphaTest)}function u(v,y){v.specular.value.copy(y.specular),v.shininess.value=Math.max(y.shininess,1e-4)}function h(v,y){y.gradientMap&&(v.gradientMap.value=y.gradientMap)}function f(v,y){v.metalness.value=y.metalness,y.metalnessMap&&(v.metalnessMap.value=y.metalnessMap,t(y.metalnessMap,v.metalnessMapTransform)),v.roughness.value=y.roughness,y.roughnessMap&&(v.roughnessMap.value=y.roughnessMap,t(y.roughnessMap,v.roughnessMapTransform)),y.envMap&&(v.envMapIntensity.value=y.envMapIntensity)}function m(v,y,b){v.ior.value=y.ior,y.sheen>0&&(v.sheenColor.value.copy(y.sheenColor).multiplyScalar(y.sheen),v.sheenRoughness.value=y.sheenRoughness,y.sheenColorMap&&(v.sheenColorMap.value=y.sheenColorMap,t(y.sheenColorMap,v.sheenColorMapTransform)),y.sheenRoughnessMap&&(v.sheenRoughnessMap.value=y.sheenRoughnessMap,t(y.sheenRoughnessMap,v.sheenRoughnessMapTransform))),y.clearcoat>0&&(v.clearcoat.value=y.clearcoat,v.clearcoatRoughness.value=y.clearcoatRoughness,y.clearcoatMap&&(v.clearcoatMap.value=y.clearcoatMap,t(y.clearcoatMap,v.clearcoatMapTransform)),y.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=y.clearcoatRoughnessMap,t(y.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),y.clearcoatNormalMap&&(v.clearcoatNormalMap.value=y.clearcoatNormalMap,t(y.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(y.clearcoatNormalScale),y.side===hi&&v.clearcoatNormalScale.value.negate())),y.dispersion>0&&(v.dispersion.value=y.dispersion),y.iridescence>0&&(v.iridescence.value=y.iridescence,v.iridescenceIOR.value=y.iridescenceIOR,v.iridescenceThicknessMinimum.value=y.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=y.iridescenceThicknessRange[1],y.iridescenceMap&&(v.iridescenceMap.value=y.iridescenceMap,t(y.iridescenceMap,v.iridescenceMapTransform)),y.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=y.iridescenceThicknessMap,t(y.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),y.transmission>0&&(v.transmission.value=y.transmission,v.transmissionSamplerMap.value=b.texture,v.transmissionSamplerSize.value.set(b.width,b.height),y.transmissionMap&&(v.transmissionMap.value=y.transmissionMap,t(y.transmissionMap,v.transmissionMapTransform)),v.thickness.value=y.thickness,y.thicknessMap&&(v.thicknessMap.value=y.thicknessMap,t(y.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=y.attenuationDistance,v.attenuationColor.value.copy(y.attenuationColor)),y.anisotropy>0&&(v.anisotropyVector.value.set(y.anisotropy*Math.cos(y.anisotropyRotation),y.anisotropy*Math.sin(y.anisotropyRotation)),y.anisotropyMap&&(v.anisotropyMap.value=y.anisotropyMap,t(y.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=y.specularIntensity,v.specularColor.value.copy(y.specularColor),y.specularColorMap&&(v.specularColorMap.value=y.specularColorMap,t(y.specularColorMap,v.specularColorMapTransform)),y.specularIntensityMap&&(v.specularIntensityMap.value=y.specularIntensityMap,t(y.specularIntensityMap,v.specularIntensityMapTransform))}function g(v,y){y.matcap&&(v.matcap.value=y.matcap)}function x(v,y){const b=e.get(y).light;v.referencePosition.value.setFromMatrixPosition(b.matrixWorld),v.nearDistance.value=b.shadow.camera.near,v.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:s}}function Fxe(i,e,t,n){let s={},r={},a=[];const o=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS);function l(b,S){const T=S.program;n.uniformBlockBinding(b,T)}function c(b,S){let T=s[b.id];T===void 0&&(g(b),T=u(b),s[b.id]=T,b.addEventListener("dispose",v));const M=S.program;n.updateUBOMapping(b,M);const C=e.render.frame;r[b.id]!==C&&(f(b),r[b.id]=C)}function u(b){const S=h();b.__bindingPointIndex=S;const T=i.createBuffer(),M=b.__size,C=b.usage;return i.bindBuffer(i.UNIFORM_BUFFER,T),i.bufferData(i.UNIFORM_BUFFER,M,C),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,S,T),T}function h(){for(let b=0;b<o;b++)if(a.indexOf(b)===-1)return a.push(b),b;return De("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(b){const S=s[b.id],T=b.uniforms,M=b.__cache;i.bindBuffer(i.UNIFORM_BUFFER,S);for(let C=0,w=T.length;C<w;C++){const N=Array.isArray(T[C])?T[C]:[T[C]];for(let E=0,B=N.length;E<B;E++){const U=N[E];if(m(U,C,E,M)===!0){const H=U.__offset,F=Array.isArray(U.value)?U.value:[U.value];let V=0;for(let Y=0;Y<F.length;Y++){const P=F[Y],X=x(P);typeof P=="number"||typeof P=="boolean"?(U.__data[0]=P,i.bufferSubData(i.UNIFORM_BUFFER,H+V,U.__data)):P.isMatrix3?(U.__data[0]=P.elements[0],U.__data[1]=P.elements[1],U.__data[2]=P.elements[2],U.__data[3]=0,U.__data[4]=P.elements[3],U.__data[5]=P.elements[4],U.__data[6]=P.elements[5],U.__data[7]=0,U.__data[8]=P.elements[6],U.__data[9]=P.elements[7],U.__data[10]=P.elements[8],U.__data[11]=0):(P.toArray(U.__data,V),V+=X.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,H,U.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function m(b,S,T,M){const C=b.value,w=S+"_"+T;if(M[w]===void 0)return typeof C=="number"||typeof C=="boolean"?M[w]=C:M[w]=C.clone(),!0;{const N=M[w];if(typeof C=="number"||typeof C=="boolean"){if(N!==C)return M[w]=C,!0}else if(N.equals(C)===!1)return N.copy(C),!0}return!1}function g(b){const S=b.uniforms;let T=0;const M=16;for(let w=0,N=S.length;w<N;w++){const E=Array.isArray(S[w])?S[w]:[S[w]];for(let B=0,U=E.length;B<U;B++){const H=E[B],F=Array.isArray(H.value)?H.value:[H.value];for(let V=0,Y=F.length;V<Y;V++){const P=F[V],X=x(P),J=T%M,re=J%X.boundary,ne=J+re;T+=re,ne!==0&&M-ne<X.storage&&(T+=M-ne),H.__data=new Float32Array(X.storage/Float32Array.BYTES_PER_ELEMENT),H.__offset=T,T+=X.storage}}}const C=T%M;return C>0&&(T+=M-C),b.__size=T,b.__cache={},this}function x(b){const S={boundary:0,storage:0};return typeof b=="number"||typeof b=="boolean"?(S.boundary=4,S.storage=4):b.isVector2?(S.boundary=8,S.storage=8):b.isVector3||b.isColor?(S.boundary=16,S.storage=12):b.isVector4?(S.boundary=16,S.storage=16):b.isMatrix3?(S.boundary=48,S.storage=48):b.isMatrix4?(S.boundary=64,S.storage=64):b.isTexture?Se("WebGLRenderer: Texture samplers can not be part of an uniforms group."):Se("WebGLRenderer: Unsupported uniform value type.",b),S}function v(b){const S=b.target;S.removeEventListener("dispose",v);const T=a.indexOf(S.__bindingPointIndex);a.splice(T,1),i.deleteBuffer(s[S.id]),delete s[S.id],delete r[S.id]}function y(){for(const b in s)i.deleteBuffer(s[b]);a=[],s={},r={}}return{bind:l,update:c,dispose:y}}const Gxe=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let Vc=null;function zxe(){return Vc===null&&(Vc=new _a(Gxe,16,16,Wr,ln),Vc.name="DFG_LUT",Vc.minFilter=Jt,Vc.magFilter=Jt,Vc.wrapS=ui,Vc.wrapT=ui,Vc.generateMipmaps=!1,Vc.needsUpdate=!0),Vc}class yw{constructor(e={}){const{canvas:t=YE(),context:n=null,depth:s=!0,stencil:r=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1,reversedDepthBuffer:f=!1,outputBufferType:m=ei}=e;this.isWebGLRenderer=!0;let g;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");g=n.getContextAttributes().alpha}else g=a;const x=m,v=new Set([Kf,Yf,Oh]),y=new Set([ei,Jn,ko,ja,Sx,Tx]),b=new Uint32Array(4),S=new Int32Array(4);let T=null,M=null;const C=[],w=[];let N=null;this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Ki,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const E=this;let B=!1;this._outputColorSpace=Js;let U=0,H=0,F=null,V=-1,Y=null;const P=new un,X=new un;let J=null;const re=new Ye(0);let ne=0,ge=t.width,Te=t.height,Be=1,et=null,wt=null;const be=new un(0,0,ge,Te),Re=new un(0,0,ge,Te);let tt=!1;const Bt=new zh;let ht=!1,Ke=!1;const jt=new Lt,Mt=new z,Ie=new un,ke={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Ve=!1;function at(){return F===null?Be:1}let Z=n;function zt(k,ie){return t.getContext(k,ie)}try{const k={alpha:!0,depth:s,stencil:r,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${bu}`),t.addEventListener("webglcontextlost",Dt,!1),t.addEventListener("webglcontextrestored",mn,!1),t.addEventListener("webglcontextcreationerror",xn,!1),Z===null){const ie="webgl2";if(Z=zt(ie,k),Z===null)throw zt(ie)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(k){throw De("WebGLRenderer: "+k.message),k}let st,Vt,Je,K,I,ue,Ne,ze,we,Ut,dt,Pt,Qt,Xe,Qe,Et,ee,me,Me,Q,pe,He,it,qe;function We(){st=new V0e(Z),st.init(),He=new RK(Z,st),Vt=new D0e(Z,st,e,He),Je=new Nxe(Z,st),Vt.reversedDepthBuffer&&f&&Je.buffers.depth.setReversed(!0),K=new W0e(Z),I=new mxe,ue=new Bxe(Z,st,Je,I,Vt,He,K),Ne=new U0e(E),ze=new z0e(E),we=new Ype(Z),it=new N0e(Z,we),Ut=new H0e(Z,we,K,it),dt=new q0e(Z,Ut,we,K),Me=new X0e(Z,Vt,ue),Et=new L0e(I),Pt=new pxe(E,Ne,ze,st,Vt,it,Et),Qt=new Oxe(E,I),Xe=new yxe,Qe=new Txe(st),me=new R0e(E,Ne,ze,Je,dt,g,l),ee=new wxe(E,dt,Vt),qe=new Fxe(Z,K,Vt,Je),Q=new B0e(Z,st,K),pe=new k0e(Z,st,K),K.programs=Pt.programs,E.capabilities=Vt,E.extensions=st,E.properties=I,E.renderLists=Xe,E.shadowMap=ee,E.state=Je,E.info=K}We(),x!==ei&&(N=new Y0e(x,t.width,t.height,s,r));const lt=new Ixe(E,Z);this.xr=lt,this.getContext=function(){return Z},this.getContextAttributes=function(){return Z.getContextAttributes()},this.forceContextLoss=function(){const k=st.get("WEBGL_lose_context");k&&k.loseContext()},this.forceContextRestore=function(){const k=st.get("WEBGL_lose_context");k&&k.restoreContext()},this.getPixelRatio=function(){return Be},this.setPixelRatio=function(k){k!==void 0&&(Be=k,this.setSize(ge,Te,!1))},this.getSize=function(k){return k.set(ge,Te)},this.setSize=function(k,ie,de=!0){if(lt.isPresenting){Se("WebGLRenderer: Can't change size while VR device is presenting.");return}ge=k,Te=ie,t.width=Math.floor(k*Be),t.height=Math.floor(ie*Be),de===!0&&(t.style.width=k+"px",t.style.height=ie+"px"),N!==null&&N.setSize(t.width,t.height),this.setViewport(0,0,k,ie)},this.getDrawingBufferSize=function(k){return k.set(ge*Be,Te*Be).floor()},this.setDrawingBufferSize=function(k,ie,de){ge=k,Te=ie,Be=de,t.width=Math.floor(k*de),t.height=Math.floor(ie*de),this.setViewport(0,0,k,ie)},this.setEffects=function(k){if(x===ei){console.error("THREE.WebGLRenderer: setEffects() requires outputBufferType set to HalfFloatType or FloatType.");return}if(k){for(let ie=0;ie<k.length;ie++)if(k[ie].isOutputPass===!0){console.warn("THREE.WebGLRenderer: OutputPass is not needed in setEffects(). Tone mapping and color space conversion are applied automatically.");break}}N.setEffects(k||[])},this.getCurrentViewport=function(k){return k.copy(P)},this.getViewport=function(k){return k.copy(be)},this.setViewport=function(k,ie,de,fe){k.isVector4?be.set(k.x,k.y,k.z,k.w):be.set(k,ie,de,fe),Je.viewport(P.copy(be).multiplyScalar(Be).round())},this.getScissor=function(k){return k.copy(Re)},this.setScissor=function(k,ie,de,fe){k.isVector4?Re.set(k.x,k.y,k.z,k.w):Re.set(k,ie,de,fe),Je.scissor(X.copy(Re).multiplyScalar(Be).round())},this.getScissorTest=function(){return tt},this.setScissorTest=function(k){Je.setScissorTest(tt=k)},this.setOpaqueSort=function(k){et=k},this.setTransparentSort=function(k){wt=k},this.getClearColor=function(k){return k.copy(me.getClearColor())},this.setClearColor=function(){me.setClearColor(...arguments)},this.getClearAlpha=function(){return me.getClearAlpha()},this.setClearAlpha=function(){me.setClearAlpha(...arguments)},this.clear=function(k=!0,ie=!0,de=!0){let fe=0;if(k){let he=!1;if(F!==null){const rt=F.texture.format;he=v.has(rt)}if(he){const rt=F.texture.type,mt=y.has(rt),gt=me.getClearColor(),Rt=me.getClearAlpha(),At=gt.r,$t=gt.g,Nt=gt.b;mt?(b[0]=At,b[1]=$t,b[2]=Nt,b[3]=Rt,Z.clearBufferuiv(Z.COLOR,0,b)):(S[0]=At,S[1]=$t,S[2]=Nt,S[3]=Rt,Z.clearBufferiv(Z.COLOR,0,S))}else fe|=Z.COLOR_BUFFER_BIT}ie&&(fe|=Z.DEPTH_BUFFER_BIT),de&&(fe|=Z.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Z.clear(fe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Dt,!1),t.removeEventListener("webglcontextrestored",mn,!1),t.removeEventListener("webglcontextcreationerror",xn,!1),me.dispose(),Xe.dispose(),Qe.dispose(),I.dispose(),Ne.dispose(),ze.dispose(),dt.dispose(),it.dispose(),qe.dispose(),Pt.dispose(),lt.dispose(),lt.removeEventListener("sessionstart",Qi),lt.removeEventListener("sessionend",ws),sn.stop()};function Dt(k){k.preventDefault(),Jm("WebGLRenderer: Context Lost."),B=!0}function mn(){Jm("WebGLRenderer: Context Restored."),B=!1;const k=K.autoReset,ie=ee.enabled,de=ee.autoUpdate,fe=ee.needsUpdate,he=ee.type;We(),K.autoReset=k,ee.enabled=ie,ee.autoUpdate=de,ee.needsUpdate=fe,ee.type=he}function xn(k){De("WebGLRenderer: A WebGL context could not be created. Reason: ",k.statusMessage)}function Oi(k){const ie=k.target;ie.removeEventListener("dispose",Oi),Vi(ie)}function Vi(k){ea(k),I.remove(k)}function ea(k){const ie=I.get(k).programs;ie!==void 0&&(ie.forEach(function(de){Pt.releaseProgram(de)}),k.isShaderMaterial&&Pt.releaseShaderCache(k))}this.renderBufferDirect=function(k,ie,de,fe,he,rt){ie===null&&(ie=ke);const mt=he.isMesh&&he.matrixWorld.determinant()<0,gt=yt(k,ie,de,fe,he);Je.setMaterial(fe,mt);let Rt=de.index,At=1;if(fe.wireframe===!0){if(Rt=Ut.getWireframeAttribute(de),Rt===void 0)return;At=2}const $t=de.drawRange,Nt=de.attributes.position;let tn=$t.start*At,Cn=($t.start+$t.count)*At;rt!==null&&(tn=Math.max(tn,rt.start*At),Cn=Math.min(Cn,(rt.start+rt.count)*At)),Rt!==null?(tn=Math.max(tn,0),Cn=Math.min(Cn,Rt.count)):Nt!=null&&(tn=Math.max(tn,0),Cn=Math.min(Cn,Nt.count));const di=Cn-tn;if(di<0||di===1/0)return;it.setup(he,fe,gt,de,Rt);let Pn,nn=Q;if(Rt!==null&&(Pn=we.get(Rt),nn=pe,nn.setIndex(Pn)),he.isMesh)fe.wireframe===!0?(Je.setLineWidth(fe.wireframeLinewidth*at()),nn.setMode(Z.LINES)):nn.setMode(Z.TRIANGLES);else if(he.isLine){let Ht=fe.linewidth;Ht===void 0&&(Ht=1),Je.setLineWidth(Ht*at()),he.isLineSegments?nn.setMode(Z.LINES):he.isLineLoop?nn.setMode(Z.LINE_LOOP):nn.setMode(Z.LINE_STRIP)}else he.isPoints?nn.setMode(Z.POINTS):he.isSprite&&nn.setMode(Z.TRIANGLES);if(he.isBatchedMesh)if(he._multiDrawInstances!==null)oi("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),nn.renderMultiDrawInstances(he._multiDrawStarts,he._multiDrawCounts,he._multiDrawCount,he._multiDrawInstances);else if(st.get("WEBGL_multi_draw"))nn.renderMultiDraw(he._multiDrawStarts,he._multiDrawCounts,he._multiDrawCount);else{const Ht=he._multiDrawStarts,rn=he._multiDrawCounts,Zt=he._multiDrawCount,Ti=Rt?we.get(Rt).bytesPerElement:1,Pr=I.get(fe).currentProgram.getUniforms();for(let xi=0;xi<Zt;xi++)Pr.setValue(Z,"_gl_DrawID",xi),nn.render(Ht[xi]/Ti,rn[xi])}else if(he.isInstancedMesh)nn.renderInstances(tn,di,he.count);else if(de.isInstancedBufferGeometry){const Ht=de._maxInstanceCount!==void 0?de._maxInstanceCount:1/0,rn=Math.min(de.instanceCount,Ht);nn.renderInstances(tn,di,rn)}else nn.render(tn,di)};function ta(k,ie,de){k.transparent===!0&&k.side===Ps&&k.forceSinglePass===!1?(k.side=hi,k.needsUpdate=!0,Ee(k,ie,de),k.side=jr,k.needsUpdate=!0,Ee(k,ie,de),k.side=Ps):Ee(k,ie,de)}this.compile=function(k,ie,de=null){de===null&&(de=k),M=Qe.get(de),M.init(ie),w.push(M),de.traverseVisible(function(he){he.isLight&&he.layers.test(ie.layers)&&(M.pushLight(he),he.castShadow&&M.pushShadow(he))}),k!==de&&k.traverseVisible(function(he){he.isLight&&he.layers.test(ie.layers)&&(M.pushLight(he),he.castShadow&&M.pushShadow(he))}),M.setupLights();const fe=new Set;return k.traverse(function(he){if(!(he.isMesh||he.isPoints||he.isLine||he.isSprite))return;const rt=he.material;if(rt)if(Array.isArray(rt))for(let mt=0;mt<rt.length;mt++){const gt=rt[mt];ta(gt,de,he),fe.add(gt)}else ta(rt,de,he),fe.add(rt)}),M=w.pop(),fe},this.compileAsync=function(k,ie,de=null){const fe=this.compile(k,ie,de);return new Promise(he=>{function rt(){if(fe.forEach(function(mt){I.get(mt).currentProgram.isReady()&&fe.delete(mt)}),fe.size===0){he(k);return}setTimeout(rt,10)}st.get("KHR_parallel_shader_compile")!==null?rt():setTimeout(rt,10)})};let Cs=null;function gr(k){Cs&&Cs(k)}function Qi(){sn.stop()}function ws(){sn.start()}const sn=new AK;sn.setAnimationLoop(gr),typeof self<"u"&&sn.setContext(self),this.setAnimationLoop=function(k){Cs=k,lt.setAnimationLoop(k),k===null?sn.stop():sn.start()},lt.addEventListener("sessionstart",Qi),lt.addEventListener("sessionend",ws),this.render=function(k,ie){if(ie!==void 0&&ie.isCamera!==!0){De("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(B===!0)return;const de=lt.enabled===!0&&lt.isPresenting===!0,fe=N!==null&&(F===null||de)&&N.begin(E,F);if(k.matrixWorldAutoUpdate===!0&&k.updateMatrixWorld(),ie.parent===null&&ie.matrixWorldAutoUpdate===!0&&ie.updateMatrixWorld(),lt.enabled===!0&&lt.isPresenting===!0&&(N===null||N.isCompositing()===!1)&&(lt.cameraAutoUpdate===!0&&lt.updateCamera(ie),ie=lt.getCamera()),k.isScene===!0&&k.onBeforeRender(E,k,ie,F),M=Qe.get(k,w.length),M.init(ie),w.push(M),jt.multiplyMatrices(ie.projectionMatrix,ie.matrixWorldInverse),Bt.setFromProjectionMatrix(jt,Cr,ie.reversedDepth),Ke=this.localClippingEnabled,ht=Et.init(this.clippingPlanes,Ke),T=Xe.get(k,C.length),T.init(),C.push(T),lt.enabled===!0&&lt.isPresenting===!0){const mt=E.xr.getDepthSensingMesh();mt!==null&&na(mt,ie,-1/0,E.sortObjects)}na(k,ie,0,E.sortObjects),T.finish(),E.sortObjects===!0&&T.sort(et,wt),Ve=lt.enabled===!1||lt.isPresenting===!1||lt.hasDepthSensing()===!1,Ve&&me.addToRenderList(T,k),this.info.render.frame++,ht===!0&&Et.beginShadows();const he=M.state.shadowsArray;if(ee.render(he,k,ie),ht===!0&&Et.endShadows(),this.info.autoReset===!0&&this.info.reset(),(fe&&N.hasRenderPass())===!1){const mt=T.opaque,gt=T.transmissive;if(M.setupLights(),ie.isArrayCamera){const Rt=ie.cameras;if(gt.length>0)for(let At=0,$t=Rt.length;At<$t;At++){const Nt=Rt[At];O(mt,gt,k,Nt)}Ve&&me.render(k);for(let At=0,$t=Rt.length;At<$t;At++){const Nt=Rt[At];Ri(T,k,Nt,Nt.viewport)}}else gt.length>0&&O(mt,gt,k,ie),Ve&&me.render(k),Ri(T,k,ie)}F!==null&&H===0&&(ue.updateMultisampleRenderTarget(F),ue.updateRenderTargetMipmap(F)),fe&&N.end(E),k.isScene===!0&&k.onAfterRender(E,k,ie),it.resetDefaultState(),V=-1,Y=null,w.pop(),w.length>0?(M=w[w.length-1],ht===!0&&Et.setGlobalState(E.clippingPlanes,M.state.camera)):M=null,C.pop(),C.length>0?T=C[C.length-1]:T=null};function na(k,ie,de,fe){if(k.visible===!1)return;if(k.layers.test(ie.layers)){if(k.isGroup)de=k.renderOrder;else if(k.isLOD)k.autoUpdate===!0&&k.update(ie);else if(k.isLight)M.pushLight(k),k.castShadow&&M.pushShadow(k);else if(k.isSprite){if(!k.frustumCulled||Bt.intersectsSprite(k)){fe&&Ie.setFromMatrixPosition(k.matrixWorld).applyMatrix4(jt);const mt=dt.update(k),gt=k.material;gt.visible&&T.push(k,mt,gt,de,Ie.z,null)}}else if((k.isMesh||k.isLine||k.isPoints)&&(!k.frustumCulled||Bt.intersectsObject(k))){const mt=dt.update(k),gt=k.material;if(fe&&(k.boundingSphere!==void 0?(k.boundingSphere===null&&k.computeBoundingSphere(),Ie.copy(k.boundingSphere.center)):(mt.boundingSphere===null&&mt.computeBoundingSphere(),Ie.copy(mt.boundingSphere.center)),Ie.applyMatrix4(k.matrixWorld).applyMatrix4(jt)),Array.isArray(gt)){const Rt=mt.groups;for(let At=0,$t=Rt.length;At<$t;At++){const Nt=Rt[At],tn=gt[Nt.materialIndex];tn&&tn.visible&&T.push(k,mt,tn,de,Ie.z,Nt)}}else gt.visible&&T.push(k,mt,gt,de,Ie.z,null)}}const rt=k.children;for(let mt=0,gt=rt.length;mt<gt;mt++)na(rt[mt],ie,de,fe)}function Ri(k,ie,de,fe){const{opaque:he,transmissive:rt,transparent:mt}=k;M.setupLightsView(de),ht===!0&&Et.setGlobalState(E.clippingPlanes,de),fe&&Je.viewport(P.copy(fe)),he.length>0&&j(he,ie,de),rt.length>0&&j(rt,ie,de),mt.length>0&&j(mt,ie,de),Je.buffers.depth.setTest(!0),Je.buffers.depth.setMask(!0),Je.buffers.color.setMask(!0),Je.setPolygonOffset(!1)}function O(k,ie,de,fe){if((de.isScene===!0?de.overrideMaterial:null)!==null)return;if(M.state.transmissionRenderTarget[fe.id]===void 0){const tn=st.has("EXT_color_buffer_half_float")||st.has("EXT_color_buffer_float");M.state.transmissionRenderTarget[fe.id]=new xa(1,1,{generateMipmaps:!0,type:tn?ln:ei,minFilter:$s,samples:Vt.samples,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:en.workingColorSpace})}const rt=M.state.transmissionRenderTarget[fe.id],mt=fe.viewport||P;rt.setSize(mt.z*E.transmissionResolutionScale,mt.w*E.transmissionResolutionScale);const gt=E.getRenderTarget(),Rt=E.getActiveCubeFace(),At=E.getActiveMipmapLevel();E.setRenderTarget(rt),E.getClearColor(re),ne=E.getClearAlpha(),ne<1&&E.setClearColor(16777215,.5),E.clear(),Ve&&me.render(de);const $t=E.toneMapping;E.toneMapping=Ki;const Nt=fe.viewport;if(fe.viewport!==void 0&&(fe.viewport=void 0),M.setupLightsView(fe),ht===!0&&Et.setGlobalState(E.clippingPlanes,fe),j(k,de,fe),ue.updateMultisampleRenderTarget(rt),ue.updateRenderTargetMipmap(rt),st.has("WEBGL_multisampled_render_to_texture")===!1){let tn=!1;for(let Cn=0,di=ie.length;Cn<di;Cn++){const Pn=ie[Cn],{object:nn,geometry:Ht,material:rn,group:Zt}=Pn;if(rn.side===Ps&&nn.layers.test(fe.layers)){const Ti=rn.side;rn.side=hi,rn.needsUpdate=!0,ce(nn,de,fe,Ht,rn,Zt),rn.side=Ti,rn.needsUpdate=!0,tn=!0}}tn===!0&&(ue.updateMultisampleRenderTarget(rt),ue.updateRenderTargetMipmap(rt))}E.setRenderTarget(gt,Rt,At),E.setClearColor(re,ne),Nt!==void 0&&(fe.viewport=Nt),E.toneMapping=$t}function j(k,ie,de){const fe=ie.isScene===!0?ie.overrideMaterial:null;for(let he=0,rt=k.length;he<rt;he++){const mt=k[he],{object:gt,geometry:Rt,group:At}=mt;let $t=mt.material;$t.allowOverride===!0&&fe!==null&&($t=fe),gt.layers.test(de.layers)&&ce(gt,ie,de,Rt,$t,At)}}function ce(k,ie,de,fe,he,rt){k.onBeforeRender(E,ie,de,fe,he,rt),k.modelViewMatrix.multiplyMatrices(de.matrixWorldInverse,k.matrixWorld),k.normalMatrix.getNormalMatrix(k.modelViewMatrix),he.onBeforeRender(E,ie,de,fe,k,rt),he.transparent===!0&&he.side===Ps&&he.forceSinglePass===!1?(he.side=hi,he.needsUpdate=!0,E.renderBufferDirect(de,ie,fe,he,k,rt),he.side=jr,he.needsUpdate=!0,E.renderBufferDirect(de,ie,fe,he,k,rt),he.side=Ps):E.renderBufferDirect(de,ie,fe,he,k,rt),k.onAfterRender(E,ie,de,fe,he,rt)}function Ee(k,ie,de){ie.isScene!==!0&&(ie=ke);const fe=I.get(k),he=M.state.lights,rt=M.state.shadowsArray,mt=he.state.version,gt=Pt.getParameters(k,he.state,rt,ie,de),Rt=Pt.getProgramCacheKey(gt);let At=fe.programs;fe.environment=k.isMeshStandardMaterial?ie.environment:null,fe.fog=ie.fog,fe.envMap=(k.isMeshStandardMaterial?ze:Ne).get(k.envMap||fe.environment),fe.envMapRotation=fe.environment!==null&&k.envMap===null?ie.environmentRotation:k.envMapRotation,At===void 0&&(k.addEventListener("dispose",Oi),At=new Map,fe.programs=At);let $t=At.get(Rt);if($t!==void 0){if(fe.currentProgram===$t&&fe.lightsStateVersion===mt)return Pe(k,gt),$t}else gt.uniforms=Pt.getUniforms(k),k.onBeforeCompile(gt,E),$t=Pt.acquireProgram(gt,Rt),At.set(Rt,$t),fe.uniforms=gt.uniforms;const Nt=fe.uniforms;return(!k.isShaderMaterial&&!k.isRawShaderMaterial||k.clipping===!0)&&(Nt.clippingPlanes=Et.uniform),Pe(k,gt),fe.needsLights=pt(k),fe.lightsStateVersion=mt,fe.needsLights&&(Nt.ambientLightColor.value=he.state.ambient,Nt.lightProbe.value=he.state.probe,Nt.directionalLights.value=he.state.directional,Nt.directionalLightShadows.value=he.state.directionalShadow,Nt.spotLights.value=he.state.spot,Nt.spotLightShadows.value=he.state.spotShadow,Nt.rectAreaLights.value=he.state.rectArea,Nt.ltc_1.value=he.state.rectAreaLTC1,Nt.ltc_2.value=he.state.rectAreaLTC2,Nt.pointLights.value=he.state.point,Nt.pointLightShadows.value=he.state.pointShadow,Nt.hemisphereLights.value=he.state.hemi,Nt.directionalShadowMap.value=he.state.directionalShadowMap,Nt.directionalShadowMatrix.value=he.state.directionalShadowMatrix,Nt.spotShadowMap.value=he.state.spotShadowMap,Nt.spotLightMatrix.value=he.state.spotLightMatrix,Nt.spotLightMap.value=he.state.spotLightMap,Nt.pointShadowMap.value=he.state.pointShadowMap,Nt.pointShadowMatrix.value=he.state.pointShadowMatrix),fe.currentProgram=$t,fe.uniformsList=null,$t}function Ge(k){if(k.uniformsList===null){const ie=k.currentProgram.getUniforms();k.uniformsList=YA.seqWithValue(ie.seq,k.uniforms)}return k.uniformsList}function Pe(k,ie){const de=I.get(k);de.outputColorSpace=ie.outputColorSpace,de.batching=ie.batching,de.batchingColor=ie.batchingColor,de.instancing=ie.instancing,de.instancingColor=ie.instancingColor,de.instancingMorph=ie.instancingMorph,de.skinning=ie.skinning,de.morphTargets=ie.morphTargets,de.morphNormals=ie.morphNormals,de.morphColors=ie.morphColors,de.morphTargetsCount=ie.morphTargetsCount,de.numClippingPlanes=ie.numClippingPlanes,de.numIntersection=ie.numClipIntersection,de.vertexAlphas=ie.vertexAlphas,de.vertexTangents=ie.vertexTangents,de.toneMapping=ie.toneMapping}function yt(k,ie,de,fe,he){ie.isScene!==!0&&(ie=ke),ue.resetTextureUnits();const rt=ie.fog,mt=fe.isMeshStandardMaterial?ie.environment:null,gt=F===null?E.outputColorSpace:F.isXRRenderTarget===!0?F.texture.colorSpace:Jr,Rt=(fe.isMeshStandardMaterial?ze:Ne).get(fe.envMap||mt),At=fe.vertexColors===!0&&!!de.attributes.color&&de.attributes.color.itemSize===4,$t=!!de.attributes.tangent&&(!!fe.normalMap||fe.anisotropy>0),Nt=!!de.morphAttributes.position,tn=!!de.morphAttributes.normal,Cn=!!de.morphAttributes.color;let di=Ki;fe.toneMapped&&(F===null||F.isXRRenderTarget===!0)&&(di=E.toneMapping);const Pn=de.morphAttributes.position||de.morphAttributes.normal||de.morphAttributes.color,nn=Pn!==void 0?Pn.length:0,Ht=I.get(fe),rn=M.state.lights;if(ht===!0&&(Ke===!0||k!==Y)){const Hs=k===Y&&fe.id===V;Et.setState(fe,k,Hs)}let Zt=!1;fe.version===Ht.__version?(Ht.needsLights&&Ht.lightsStateVersion!==rn.state.version||Ht.outputColorSpace!==gt||he.isBatchedMesh&&Ht.batching===!1||!he.isBatchedMesh&&Ht.batching===!0||he.isBatchedMesh&&Ht.batchingColor===!0&&he.colorTexture===null||he.isBatchedMesh&&Ht.batchingColor===!1&&he.colorTexture!==null||he.isInstancedMesh&&Ht.instancing===!1||!he.isInstancedMesh&&Ht.instancing===!0||he.isSkinnedMesh&&Ht.skinning===!1||!he.isSkinnedMesh&&Ht.skinning===!0||he.isInstancedMesh&&Ht.instancingColor===!0&&he.instanceColor===null||he.isInstancedMesh&&Ht.instancingColor===!1&&he.instanceColor!==null||he.isInstancedMesh&&Ht.instancingMorph===!0&&he.morphTexture===null||he.isInstancedMesh&&Ht.instancingMorph===!1&&he.morphTexture!==null||Ht.envMap!==Rt||fe.fog===!0&&Ht.fog!==rt||Ht.numClippingPlanes!==void 0&&(Ht.numClippingPlanes!==Et.numPlanes||Ht.numIntersection!==Et.numIntersection)||Ht.vertexAlphas!==At||Ht.vertexTangents!==$t||Ht.morphTargets!==Nt||Ht.morphNormals!==tn||Ht.morphColors!==Cn||Ht.toneMapping!==di||Ht.morphTargetsCount!==nn)&&(Zt=!0):(Zt=!0,Ht.__version=fe.version);let Ti=Ht.currentProgram;Zt===!0&&(Ti=Ee(fe,ie,he));let Pr=!1,xi=!1,ia=!1;const Ai=Ti.getUniforms(),Rs=Ht.uniforms;if(Je.useProgram(Ti.program)&&(Pr=!0,xi=!0,ia=!0),fe.id!==V&&(V=fe.id,xi=!0),Pr||Y!==k){Je.buffers.depth.getReversed()&&k.reversedDepth!==!0&&(k._reversedDepth=!0,k.updateProjectionMatrix()),Ai.setValue(Z,"projectionMatrix",k.projectionMatrix),Ai.setValue(Z,"viewMatrix",k.matrixWorldInverse);const ir=Ai.map.cameraPosition;ir!==void 0&&ir.setValue(Z,Mt.setFromMatrixPosition(k.matrixWorld)),Vt.logarithmicDepthBuffer&&Ai.setValue(Z,"logDepthBufFC",2/(Math.log(k.far+1)/Math.LN2)),(fe.isMeshPhongMaterial||fe.isMeshToonMaterial||fe.isMeshLambertMaterial||fe.isMeshBasicMaterial||fe.isMeshStandardMaterial||fe.isShaderMaterial)&&Ai.setValue(Z,"isOrthographic",k.isOrthographicCamera===!0),Y!==k&&(Y=k,xi=!0,ia=!0)}if(Ht.needsLights&&(rn.state.directionalShadowMap.length>0&&Ai.setValue(Z,"directionalShadowMap",rn.state.directionalShadowMap,ue),rn.state.spotShadowMap.length>0&&Ai.setValue(Z,"spotShadowMap",rn.state.spotShadowMap,ue),rn.state.pointShadowMap.length>0&&Ai.setValue(Z,"pointShadowMap",rn.state.pointShadowMap,ue)),he.isSkinnedMesh){Ai.setOptional(Z,he,"bindMatrix"),Ai.setOptional(Z,he,"bindMatrixInverse");const Hs=he.skeleton;Hs&&(Hs.boneTexture===null&&Hs.computeBoneTexture(),Ai.setValue(Z,"boneTexture",Hs.boneTexture,ue))}he.isBatchedMesh&&(Ai.setOptional(Z,he,"batchingTexture"),Ai.setValue(Z,"batchingTexture",he._matricesTexture,ue),Ai.setOptional(Z,he,"batchingIdTexture"),Ai.setValue(Z,"batchingIdTexture",he._indirectTexture,ue),Ai.setOptional(Z,he,"batchingColorTexture"),he._colorsTexture!==null&&Ai.setValue(Z,"batchingColorTexture",he._colorsTexture,ue));const Ma=de.morphAttributes;if((Ma.position!==void 0||Ma.normal!==void 0||Ma.color!==void 0)&&Me.update(he,de,Ti),(xi||Ht.receiveShadow!==he.receiveShadow)&&(Ht.receiveShadow=he.receiveShadow,Ai.setValue(Z,"receiveShadow",he.receiveShadow)),fe.isMeshGouraudMaterial&&fe.envMap!==null&&(Rs.envMap.value=Rt,Rs.flipEnvMap.value=Rt.isCubeTexture&&Rt.isRenderTargetTexture===!1?-1:1),fe.isMeshStandardMaterial&&fe.envMap===null&&ie.environment!==null&&(Rs.envMapIntensity.value=ie.environmentIntensity),Rs.dfgLUT!==void 0&&(Rs.dfgLUT.value=zxe()),xi&&(Ai.setValue(Z,"toneMappingExposure",E.toneMappingExposure),Ht.needsLights&&ft(Rs,ia),rt&&fe.fog===!0&&Qt.refreshFogUniforms(Rs,rt),Qt.refreshMaterialUniforms(Rs,fe,Be,Te,M.state.transmissionRenderTarget[k.id]),YA.upload(Z,Ge(Ht),Rs,ue)),fe.isShaderMaterial&&fe.uniformsNeedUpdate===!0&&(YA.upload(Z,Ge(Ht),Rs,ue),fe.uniformsNeedUpdate=!1),fe.isSpriteMaterial&&Ai.setValue(Z,"center",he.center),Ai.setValue(Z,"modelViewMatrix",he.modelViewMatrix),Ai.setValue(Z,"normalMatrix",he.normalMatrix),Ai.setValue(Z,"modelMatrix",he.matrixWorld),fe.isShaderMaterial||fe.isRawShaderMaterial){const Hs=fe.uniformsGroups;for(let ir=0,Dg=Hs.length;ir<Dg;ir++){const Ql=Hs[ir];qe.update(Ql,Ti),qe.bind(Ql,Ti)}}return Ti}function ft(k,ie){k.ambientLightColor.needsUpdate=ie,k.lightProbe.needsUpdate=ie,k.directionalLights.needsUpdate=ie,k.directionalLightShadows.needsUpdate=ie,k.pointLights.needsUpdate=ie,k.pointLightShadows.needsUpdate=ie,k.spotLights.needsUpdate=ie,k.spotLightShadows.needsUpdate=ie,k.rectAreaLights.needsUpdate=ie,k.hemisphereLights.needsUpdate=ie}function pt(k){return k.isMeshLambertMaterial||k.isMeshToonMaterial||k.isMeshPhongMaterial||k.isMeshStandardMaterial||k.isShadowMaterial||k.isShaderMaterial&&k.lights===!0}this.getActiveCubeFace=function(){return U},this.getActiveMipmapLevel=function(){return H},this.getRenderTarget=function(){return F},this.setRenderTargetTextures=function(k,ie,de){const fe=I.get(k);fe.__autoAllocateDepthBuffer=k.resolveDepthBuffer===!1,fe.__autoAllocateDepthBuffer===!1&&(fe.__useRenderToTexture=!1),I.get(k.texture).__webglTexture=ie,I.get(k.depthTexture).__webglTexture=fe.__autoAllocateDepthBuffer?void 0:de,fe.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(k,ie){const de=I.get(k);de.__webglFramebuffer=ie,de.__useDefaultFramebuffer=ie===void 0};const ct=Z.createFramebuffer();this.setRenderTarget=function(k,ie=0,de=0){F=k,U=ie,H=de;let fe=null,he=!1,rt=!1;if(k){const gt=I.get(k);if(gt.__useDefaultFramebuffer!==void 0){Je.bindFramebuffer(Z.FRAMEBUFFER,gt.__webglFramebuffer),P.copy(k.viewport),X.copy(k.scissor),J=k.scissorTest,Je.viewport(P),Je.scissor(X),Je.setScissorTest(J),V=-1;return}else if(gt.__webglFramebuffer===void 0)ue.setupRenderTarget(k);else if(gt.__hasExternalTextures)ue.rebindTextures(k,I.get(k.texture).__webglTexture,I.get(k.depthTexture).__webglTexture);else if(k.depthBuffer){const $t=k.depthTexture;if(gt.__boundDepthTexture!==$t){if($t!==null&&I.has($t)&&(k.width!==$t.image.width||k.height!==$t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ue.setupDepthRenderbuffer(k)}}const Rt=k.texture;(Rt.isData3DTexture||Rt.isDataArrayTexture||Rt.isCompressedArrayTexture)&&(rt=!0);const At=I.get(k).__webglFramebuffer;k.isWebGLCubeRenderTarget?(Array.isArray(At[ie])?fe=At[ie][de]:fe=At[ie],he=!0):k.samples>0&&ue.useMultisampledRTT(k)===!1?fe=I.get(k).__webglMultisampledFramebuffer:Array.isArray(At)?fe=At[de]:fe=At,P.copy(k.viewport),X.copy(k.scissor),J=k.scissorTest}else P.copy(be).multiplyScalar(Be).floor(),X.copy(Re).multiplyScalar(Be).floor(),J=tt;if(de!==0&&(fe=ct),Je.bindFramebuffer(Z.FRAMEBUFFER,fe)&&Je.drawBuffers(k,fe),Je.viewport(P),Je.scissor(X),Je.setScissorTest(J),he){const gt=I.get(k.texture);Z.framebufferTexture2D(Z.FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Z.TEXTURE_CUBE_MAP_POSITIVE_X+ie,gt.__webglTexture,de)}else if(rt){const gt=ie;for(let Rt=0;Rt<k.textures.length;Rt++){const At=I.get(k.textures[Rt]);Z.framebufferTextureLayer(Z.FRAMEBUFFER,Z.COLOR_ATTACHMENT0+Rt,At.__webglTexture,de,gt)}}else if(k!==null&&de!==0){const gt=I.get(k.texture);Z.framebufferTexture2D(Z.FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Z.TEXTURE_2D,gt.__webglTexture,de)}V=-1},this.readRenderTargetPixels=function(k,ie,de,fe,he,rt,mt,gt=0){if(!(k&&k.isWebGLRenderTarget)){De("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Rt=I.get(k).__webglFramebuffer;if(k.isWebGLCubeRenderTarget&&mt!==void 0&&(Rt=Rt[mt]),Rt){Je.bindFramebuffer(Z.FRAMEBUFFER,Rt);try{const At=k.textures[gt],$t=At.format,Nt=At.type;if(!Vt.textureFormatReadable($t)){De("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Vt.textureTypeReadable(Nt)){De("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ie>=0&&ie<=k.width-fe&&de>=0&&de<=k.height-he&&(k.textures.length>1&&Z.readBuffer(Z.COLOR_ATTACHMENT0+gt),Z.readPixels(ie,de,fe,he,He.convert($t),He.convert(Nt),rt))}finally{const At=F!==null?I.get(F).__webglFramebuffer:null;Je.bindFramebuffer(Z.FRAMEBUFFER,At)}}},this.readRenderTargetPixelsAsync=async function(k,ie,de,fe,he,rt,mt,gt=0){if(!(k&&k.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Rt=I.get(k).__webglFramebuffer;if(k.isWebGLCubeRenderTarget&&mt!==void 0&&(Rt=Rt[mt]),Rt)if(ie>=0&&ie<=k.width-fe&&de>=0&&de<=k.height-he){Je.bindFramebuffer(Z.FRAMEBUFFER,Rt);const At=k.textures[gt],$t=At.format,Nt=At.type;if(!Vt.textureFormatReadable($t))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Vt.textureTypeReadable(Nt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const tn=Z.createBuffer();Z.bindBuffer(Z.PIXEL_PACK_BUFFER,tn),Z.bufferData(Z.PIXEL_PACK_BUFFER,rt.byteLength,Z.STREAM_READ),k.textures.length>1&&Z.readBuffer(Z.COLOR_ATTACHMENT0+gt),Z.readPixels(ie,de,fe,he,He.convert($t),He.convert(Nt),0);const Cn=F!==null?I.get(F).__webglFramebuffer:null;Je.bindFramebuffer(Z.FRAMEBUFFER,Cn);const di=Z.fenceSync(Z.SYNC_GPU_COMMANDS_COMPLETE,0);return Z.flush(),await zne(Z,di,4),Z.bindBuffer(Z.PIXEL_PACK_BUFFER,tn),Z.getBufferSubData(Z.PIXEL_PACK_BUFFER,0,rt),Z.deleteBuffer(tn),Z.deleteSync(di),rt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(k,ie=null,de=0){const fe=Math.pow(2,-de),he=Math.floor(k.image.width*fe),rt=Math.floor(k.image.height*fe),mt=ie!==null?ie.x:0,gt=ie!==null?ie.y:0;ue.setTexture2D(k,0),Z.copyTexSubImage2D(Z.TEXTURE_2D,de,0,0,mt,gt,he,rt),Je.unbindTexture()};const Tt=Z.createFramebuffer(),vt=Z.createFramebuffer();this.copyTextureToTexture=function(k,ie,de=null,fe=null,he=0,rt=null){rt===null&&(he!==0?(oi("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),rt=he,he=0):rt=0);let mt,gt,Rt,At,$t,Nt,tn,Cn,di;const Pn=k.isCompressedTexture?k.mipmaps[rt]:k.image;if(de!==null)mt=de.max.x-de.min.x,gt=de.max.y-de.min.y,Rt=de.isBox3?de.max.z-de.min.z:1,At=de.min.x,$t=de.min.y,Nt=de.isBox3?de.min.z:0;else{const Ma=Math.pow(2,-he);mt=Math.floor(Pn.width*Ma),gt=Math.floor(Pn.height*Ma),k.isDataArrayTexture?Rt=Pn.depth:k.isData3DTexture?Rt=Math.floor(Pn.depth*Ma):Rt=1,At=0,$t=0,Nt=0}fe!==null?(tn=fe.x,Cn=fe.y,di=fe.z):(tn=0,Cn=0,di=0);const nn=He.convert(ie.format),Ht=He.convert(ie.type);let rn;ie.isData3DTexture?(ue.setTexture3D(ie,0),rn=Z.TEXTURE_3D):ie.isDataArrayTexture||ie.isCompressedArrayTexture?(ue.setTexture2DArray(ie,0),rn=Z.TEXTURE_2D_ARRAY):(ue.setTexture2D(ie,0),rn=Z.TEXTURE_2D),Z.pixelStorei(Z.UNPACK_FLIP_Y_WEBGL,ie.flipY),Z.pixelStorei(Z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ie.premultiplyAlpha),Z.pixelStorei(Z.UNPACK_ALIGNMENT,ie.unpackAlignment);const Zt=Z.getParameter(Z.UNPACK_ROW_LENGTH),Ti=Z.getParameter(Z.UNPACK_IMAGE_HEIGHT),Pr=Z.getParameter(Z.UNPACK_SKIP_PIXELS),xi=Z.getParameter(Z.UNPACK_SKIP_ROWS),ia=Z.getParameter(Z.UNPACK_SKIP_IMAGES);Z.pixelStorei(Z.UNPACK_ROW_LENGTH,Pn.width),Z.pixelStorei(Z.UNPACK_IMAGE_HEIGHT,Pn.height),Z.pixelStorei(Z.UNPACK_SKIP_PIXELS,At),Z.pixelStorei(Z.UNPACK_SKIP_ROWS,$t),Z.pixelStorei(Z.UNPACK_SKIP_IMAGES,Nt);const Ai=k.isDataArrayTexture||k.isData3DTexture,Rs=ie.isDataArrayTexture||ie.isData3DTexture;if(k.isDepthTexture){const Ma=I.get(k),Hs=I.get(ie),ir=I.get(Ma.__renderTarget),Dg=I.get(Hs.__renderTarget);Je.bindFramebuffer(Z.READ_FRAMEBUFFER,ir.__webglFramebuffer),Je.bindFramebuffer(Z.DRAW_FRAMEBUFFER,Dg.__webglFramebuffer);for(let Ql=0;Ql<Rt;Ql++)Ai&&(Z.framebufferTextureLayer(Z.READ_FRAMEBUFFER,Z.COLOR_ATTACHMENT0,I.get(k).__webglTexture,he,Nt+Ql),Z.framebufferTextureLayer(Z.DRAW_FRAMEBUFFER,Z.COLOR_ATTACHMENT0,I.get(ie).__webglTexture,rt,di+Ql)),Z.blitFramebuffer(At,$t,mt,gt,tn,Cn,mt,gt,Z.DEPTH_BUFFER_BIT,Z.NEAREST);Je.bindFramebuffer(Z.READ_FRAMEBUFFER,null),Je.bindFramebuffer(Z.DRAW_FRAMEBUFFER,null)}else if(he!==0||k.isRenderTargetTexture||I.has(k)){const Ma=I.get(k),Hs=I.get(ie);Je.bindFramebuffer(Z.READ_FRAMEBUFFER,Tt),Je.bindFramebuffer(Z.DRAW_FRAMEBUFFER,vt);for(let ir=0;ir<Rt;ir++)Ai?Z.framebufferTextureLayer(Z.READ_FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Ma.__webglTexture,he,Nt+ir):Z.framebufferTexture2D(Z.READ_FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Z.TEXTURE_2D,Ma.__webglTexture,he),Rs?Z.framebufferTextureLayer(Z.DRAW_FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Hs.__webglTexture,rt,di+ir):Z.framebufferTexture2D(Z.DRAW_FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Z.TEXTURE_2D,Hs.__webglTexture,rt),he!==0?Z.blitFramebuffer(At,$t,mt,gt,tn,Cn,mt,gt,Z.COLOR_BUFFER_BIT,Z.NEAREST):Rs?Z.copyTexSubImage3D(rn,rt,tn,Cn,di+ir,At,$t,mt,gt):Z.copyTexSubImage2D(rn,rt,tn,Cn,At,$t,mt,gt);Je.bindFramebuffer(Z.READ_FRAMEBUFFER,null),Je.bindFramebuffer(Z.DRAW_FRAMEBUFFER,null)}else Rs?k.isDataTexture||k.isData3DTexture?Z.texSubImage3D(rn,rt,tn,Cn,di,mt,gt,Rt,nn,Ht,Pn.data):ie.isCompressedArrayTexture?Z.compressedTexSubImage3D(rn,rt,tn,Cn,di,mt,gt,Rt,nn,Pn.data):Z.texSubImage3D(rn,rt,tn,Cn,di,mt,gt,Rt,nn,Ht,Pn):k.isDataTexture?Z.texSubImage2D(Z.TEXTURE_2D,rt,tn,Cn,mt,gt,nn,Ht,Pn.data):k.isCompressedTexture?Z.compressedTexSubImage2D(Z.TEXTURE_2D,rt,tn,Cn,Pn.width,Pn.height,nn,Pn.data):Z.texSubImage2D(Z.TEXTURE_2D,rt,tn,Cn,mt,gt,nn,Ht,Pn);Z.pixelStorei(Z.UNPACK_ROW_LENGTH,Zt),Z.pixelStorei(Z.UNPACK_IMAGE_HEIGHT,Ti),Z.pixelStorei(Z.UNPACK_SKIP_PIXELS,Pr),Z.pixelStorei(Z.UNPACK_SKIP_ROWS,xi),Z.pixelStorei(Z.UNPACK_SKIP_IMAGES,ia),rt===0&&ie.generateMipmaps&&Z.generateMipmap(rn),Je.unbindTexture()},this.initRenderTarget=function(k){I.get(k).__webglFramebuffer===void 0&&ue.setupRenderTarget(k)},this.initTexture=function(k){k.isCubeTexture?ue.setTextureCube(k,0):k.isData3DTexture?ue.setTexture3D(k,0):k.isDataArrayTexture||k.isCompressedArrayTexture?ue.setTexture2DArray(k,0):ue.setTexture2D(k,0),Je.unbindTexture()},this.resetState=function(){U=0,H=0,F=null,Je.reset(),it.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Cr}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=en._getDrawingBufferColorSpace(e),t.unpackColorSpace=en._getUnpackColorSpace()}}const Vxe=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:pg,AddEquation:Mr,AddOperation:HE,AdditiveAnimationBlendMode:WE,AdditiveBlending:hf,AgXToneMapping:vx,AlphaFormat:_S,AlwaysCompare:MS,AlwaysDepth:Gm,AlwaysStencilFunc:bb,AmbientLight:vC,AnimationAction:qU,AnimationClip:tg,AnimationLoader:j9,AnimationMixer:tW,AnimationObjectGroup:eW,AnimationUtils:q9,ArcCurve:MU,ArrayCamera:MC,ArrowHelper:TW,AttachedBindMode:NM,Audio:HU,AudioAnalyser:$9,AudioContext:AC,AudioListener:J9,AudioLoader:K9,AxesHelper:AW,BackSide:hi,BasicDepthPacking:$L,BasicShadowMap:FE,BatchedMesh:bU,Bone:LS,BooleanKeyframeTrack:Jf,Box2:cW,Box3:Br,Box3Helper:bW,BoxGeometry:Su,BoxHelper:vW,BufferAttribute:Nn,BufferGeometry:pn,BufferGeometryLoader:GU,ByteType:$c,Cache:gc,Camera:Cx,CameraHelper:_W,CanvasTexture:TU,CapsuleGeometry:PS,CatmullRomCurve3:CU,CineonToneMapping:_x,CircleGeometry:OS,ClampToEdgeWrapping:ui,Clock:EC,Color:Ye,ColorKeyframeTrack:xC,ColorManagement:en,CompressedArrayTexture:G9,CompressedCubeTexture:z9,CompressedTexture:IS,CompressedTextureLoader:Y9,ConeGeometry:Bx,ConstantAlphaFactor:XL,ConstantColorFactor:kL,Controls:EW,CubeCamera:ZE,CubeDepthTexture:tC,CubeReflectionMapping:Sa,CubeRefractionMapping:el,CubeTexture:Gh,CubeTextureLoader:PU,CubeUVReflectionMapping:du,CubicBezierCurve:iC,CubicBezierCurve3:wU,CubicInterpolant:LU,CullFaceBack:gb,CullFaceFront:OE,CullFaceFrontBack:c9,CullFaceNone:PE,Curve:Jl,CurvePath:NU,CustomBlending:nf,CustomToneMapping:kE,CylinderGeometry:bg,Cylindrical:lW,Data3DTexture:ES,DataArrayTexture:Ex,DataTexture:_a,DataTextureLoader:ZS,DataUtils:Ll,DecrementStencilOp:sU,DecrementWrapStencilOp:aU,DefaultLoadingManager:lm,DepthFormat:lr,DepthStencilFormat:kr,DepthTexture:tr,DetachedBindMode:jL,DirectionalLight:ng,DirectionalLightHelper:xW,DiscreteInterpolant:UU,DodecahedronGeometry:FS,DoubleSide:Ps,DstAlphaFactor:pS,DstColorFactor:gS,DynamicCopyUsage:b9,DynamicDrawUsage:hh,DynamicReadUsage:x9,EdgesGeometry:AU,EllipseCurve:GS,EqualCompare:SS,EqualDepth:Vm,EqualStencilFunc:uU,EquirectangularReflectionMapping:_c,EquirectangularRefractionMapping:wh,Euler:Lr,EventDispatcher:Ta,ExternalTexture:nC,ExtrudeGeometry:zS,FileLoader:cr,Float16BufferAttribute:KE,Float32BufferAttribute:qt,FloatType:Rn,Fog:BS,FogExp2:NS,FramebufferTexture:US,FrontSide:jr,Frustum:zh,FrustumArray:Rx,GLBufferAttribute:aW,GLSL1:T9,GLSL3:BM,GreaterCompare:TS,GreaterDepth:km,GreaterEqualCompare:_g,GreaterEqualDepth:Hm,GreaterEqualStencilFunc:pU,GreaterStencilFunc:dU,GridHelper:gW,Group:ao,HalfFloatType:ln,HemisphereLight:_C,HemisphereLightHelper:mW,IcosahedronGeometry:Dx,ImageBitmapLoader:VU,ImageLoader:Yy,ImageUtils:xU,IncrementStencilOp:iU,IncrementWrapStencilOp:rU,InstancedBufferAttribute:Yr,InstancedBufferGeometry:FU,InstancedInterleavedBuffer:jU,InstancedMesh:QE,Int16BufferAttribute:L9,Int32BufferAttribute:U9,Int8BufferAttribute:N9,IntType:Is,InterleavedBuffer:vg,InterleavedBufferAttribute:pu,Interpolant:Ag,InterpolateDiscrete:Km,InterpolateLinear:Zm,InterpolateSmooth:Uv,InterpolationSamplingMode:M9,InterpolationSamplingType:A9,InvertStencilOp:oU,KeepStencilOp:Zu,KeyframeTrack:al,LOD:vU,LatheGeometry:VS,Layers:$m,LessCompare:yg,LessDepth:zm,LessEqualCompare:xg,LessEqualDepth:uu,LessEqualStencilFunc:hU,LessStencilFunc:cU,Light:Hh,LightProbe:TC,Line:mu,Line3:uW,LineBasicMaterial:Ir,LineCurve:sC,LineCurve3:RU,LineDashedMaterial:YS,LineLoop:$E,LineSegments:Zl,LinearFilter:Jt,LinearInterpolant:yC,LinearMipMapLinearFilter:yb,LinearMipMapNearestFilter:d9,LinearMipmapLinearFilter:$s,LinearMipmapNearestFilter:Qc,LinearSRGBColorSpace:Jr,LinearToneMapping:yx,LinearTransfer:Of,Loader:fr,LoaderUtils:xh,LoadingManager:KS,LoopOnce:KL,LoopPingPong:JL,LoopRepeat:ZL,MOUSE:Td,Material:Es,MaterialLoader:Ux,MathUtils:Fh,Matrix2:Ix,Matrix3:gn,Matrix4:Lt,MaxEquation:zE,Mesh:Kn,MeshBasicMaterial:Ts,MeshDepthMaterial:pC,MeshDistanceMaterial:mC,MeshLambertMaterial:fC,MeshMatcapMaterial:gC,MeshNormalMaterial:dC,MeshPhongMaterial:uC,MeshPhysicalMaterial:yo,MeshStandardMaterial:Tg,MeshToonMaterial:hC,MinEquation:GE,MirroredRepeatWrapping:vc,MixOperation:VE,MultiplyBlending:Ch,MultiplyOperation:fg,NearestFilter:$n,NearestMipMapLinearFilter:h9,NearestMipMapNearestFilter:u9,NearestMipmapLinearFilter:Ho,NearestMipmapNearestFilter:mg,NeutralToneMapping:bx,NeverCompare:bS,NeverDepth:Fm,NeverStencilFunc:lU,NoBlending:Nr,NoColorSpace:ha,NoNormalPacking:Iv,NoToneMapping:Ki,NormalAnimationBlendMode:vS,NormalBlending:qa,NormalGAPacking:eU,NormalRGPacking:jE,NotEqualCompare:AS,NotEqualDepth:Wm,NotEqualStencilFunc:fU,NumberKeyframeTrack:Gf,Object3D:Fn,ObjectLoader:zU,ObjectSpaceNormalMap:qE,OctahedronGeometry:Lx,OneFactor:hS,OneMinusConstantAlphaFactor:qL,OneMinusConstantColorFactor:WL,OneMinusDstAlphaFactor:mS,OneMinusDstColorFactor:yS,OneMinusSrcAlphaFactor:Om,OneMinusSrcColorFactor:fS,OrthographicCamera:Dr,PCFShadowMap:tf,PCFSoftShadowMap:gy,PMREMGenerator:r3,Path:Tb,PerspectiveCamera:Ci,Plane:El,PlaneGeometry:Cc,PlaneHelper:SW,PointLight:JS,PointLightHelper:pW,Points:eC,PointsMaterial:Nx,PolarGridHelper:yW,PolyhedronGeometry:Vh,PositionalAudio:Q9,PropertyBinding:qn,PropertyMixer:kU,QuadraticBezierCurve:rC,QuadraticBezierCurve3:aC,Quaternion:Fs,QuaternionKeyframeTrack:zf,QuaternionLinearInterpolant:IU,R11_EAC_Format:gf,RED_GREEN_RGTC2_Format:Nh,RED_RGTC1_Format:Uf,REVISION:bu,RG11_EAC_Format:Rh,RGBADepthPacking:f9,RGBAFormat:ii,RGBAIntegerFormat:Kf,RGBA_ASTC_10x10_Format:Nf,RGBA_ASTC_10x5_Format:Cf,RGBA_ASTC_10x6_Format:wf,RGBA_ASTC_10x8_Format:Rf,RGBA_ASTC_12x10_Format:Bf,RGBA_ASTC_12x12_Format:Df,RGBA_ASTC_4x4_Format:_f,RGBA_ASTC_5x4_Format:vf,RGBA_ASTC_5x5_Format:bf,RGBA_ASTC_6x5_Format:Sf,RGBA_ASTC_6x6_Format:Tf,RGBA_ASTC_8x5_Format:Af,RGBA_ASTC_8x6_Format:Mf,RGBA_ASTC_8x8_Format:Ef,RGBA_BPTC_Format:Lf,RGBA_ETC2_EAC_Format:mf,RGBA_PVRTC_2BPPV1_Format:Ym,RGBA_PVRTC_4BPPV1_Format:jm,RGBA_S3TC_DXT1_Format:nu,RGBA_S3TC_DXT3_Format:iu,RGBA_S3TC_DXT5_Format:su,RGBDepthPacking:p9,RGBFormat:gg,RGBIntegerFormat:YL,RGB_BPTC_SIGNED_Format:xb,RGB_BPTC_UNSIGNED_Format:_b,RGB_ETC1_Format:ff,RGB_ETC2_Format:pf,RGB_PVRTC_2BPPV1_Format:qm,RGB_PVRTC_4BPPV1_Format:Xm,RGB_S3TC_DXT1_Format:tu,RGDepthPacking:m9,RGFormat:Wr,RGIntegerFormat:Yf,RawShaderMaterial:cC,Ray:Zf,Raycaster:YU,RectAreaLight:bC,RedFormat:ql,RedIntegerFormat:Oh,ReinhardToneMapping:xx,RenderTarget:Si,RenderTarget3D:nW,RepeatWrapping:Zr,ReplaceStencilOp:nU,ReverseSubtractEquation:uS,RingGeometry:HS,SIGNED_R11_EAC_Format:yf,SIGNED_RED_GREEN_RGTC2_Format:Pf,SIGNED_RED_RGTC1_Format:If,SIGNED_RG11_EAC_Format:xf,SRGBColorSpace:Js,SRGBTransfer:Ft,Scene:fu,ShaderChunk:En,ShaderLib:pc,ShaderMaterial:Za,ShadowMaterial:lC,Shape:sf,ShapeGeometry:kS,ShapePath:MW,ShapeUtils:Ul,ShortType:eu,Skeleton:wx,SkeletonHelper:dW,SkinnedMesh:JE,Source:dh,Sphere:Gs,SphereGeometry:Sg,Spherical:Cb,SphericalHarmonics3:SC,SplineCurve:oC,SpotLight:Mg,SpotLightHelper:hW,Sprite:_U,SpriteMaterial:DS,SrcAlphaFactor:Pm,SrcAlphaSaturateFactor:xS,SrcColorFactor:dS,StaticCopyUsage:v9,StaticDrawUsage:Bh,StaticReadUsage:y9,StereoCamera:Z9,StreamCopyUsage:S9,StreamDrawUsage:g9,StreamReadUsage:_9,StringKeyframeTrack:Qf,SubtractEquation:cS,SubtractiveBlending:df,TOUCH:Ad,TangentSpaceNormalMap:Vl,TetrahedronGeometry:WS,Texture:In,TextureLoader:$f,TextureUtils:CW,Timer:oW,TimestampQuery:ga,TorusGeometry:XS,TorusKnotGeometry:qS,Triangle:Ga,TriangleFanDrawMode:vb,TriangleStripDrawMode:XE,TrianglesDrawMode:QL,TubeGeometry:jS,UVMapping:hu,Uint16BufferAttribute:CS,Uint32BufferAttribute:wS,Uint8BufferAttribute:B9,Uint8ClampedBufferAttribute:D9,Uniform:iW,UniformsGroup:rW,UniformsLib:Ot,UniformsUtils:P9,UnsignedByteType:ei,UnsignedInt101111Type:Mx,UnsignedInt248Type:ja,UnsignedInt5999Type:Ax,UnsignedIntType:Jn,UnsignedShort4444Type:Sx,UnsignedShort5551Type:Tx,UnsignedShortType:ko,VSMShadowMap:Dl,Vector2:Ae,Vector3:z,Vector4:un,VectorKeyframeTrack:Vf,VideoFrameTexture:F9,VideoTexture:SU,WebGL3DRenderTarget:w9,WebGLArrayRenderTarget:C9,WebGLCoordinateSystem:Cr,WebGLCubeRenderTarget:RS,WebGLRenderTarget:xa,WebGLRenderer:yw,WebGLUtils:RK,WebGPUCoordinateSystem:Ka,WebXRController:xy,WireframeGeometry:BU,WrapAroundEnding:Wy,ZeroCurvatureEnding:Fd,ZeroFactor:dc,ZeroSlopeEnding:Gd,ZeroStencilOp:tU,createCanvasElement:YE,error:De,getConsoleFunction:E9,log:Jm,setConsoleFunction:gU,warn:Se,warnOnce:oi},Symbol.toStringTag,{value:"Module"}));class Wx extends Ta{constructor(){super(),this.domElement=document.createElement("div"),this.domElement.className="param-control",this._onChangeFunction=null,this.addEventListener("change",e=>{requestAnimationFrame(()=>{this._onChangeFunction&&this._onChangeFunction(e.value)})})}setValue(){return this.dispatchChange(),this}getValue(){return null}dispatchChange(){this.dispatchEvent({type:"change",value:this.getValue()})}onChange(e){return this._onChangeFunction=e,this}}class NK extends Wx{constructor({value:e=0,step:t=.1,min:n=-1/0,max:s=1/0}){super(),this.input=document.createElement("input"),this.input.type="number",this.input.value=e,this.input.step=t,this.input.min=n,this.input.max=s,this.input.addEventListener("change",this._onChangeValue.bind(this)),this.domElement.appendChild(this.input),this.addDragHandler()}_onChangeValue(){const e=parseFloat(this.input.value),t=parseFloat(this.input.min),n=parseFloat(this.input.max);e>n?this.input.value=n:e<t?this.input.value=t:isNaN(e)&&(this.input.value=t),this.dispatchChange()}addDragHandler(){let e=!1,t,n;this.input.addEventListener("mousedown",s=>{e=!0,t=s.clientY,n=parseFloat(this.input.value),document.body.style.cursor="ns-resize"}),document.addEventListener("mousemove",s=>{if(e){const r=t-s.clientY,a=parseFloat(this.input.step)||1,o=parseFloat(this.input.min),l=parseFloat(this.input.max);let c=a;!isNaN(l)&&isFinite(o)&&(c=(l-o)/100);const u=r*c;let h=n+u;h=Math.max(o,Math.min(h,l));const f=(String(a).split(".")[1]||[]).length;this.input.value=h.toFixed(f),this.input.dispatchEvent(new Event("input")),this.dispatchChange()}}),document.addEventListener("mouseup",()=>{e&&(e=!1,document.body.style.cursor="default")})}setValue(e){return this.input.value=e,super.setValue(e)}getValue(){return parseFloat(this.input.value)}}class Hxe extends Wx{constructor({value:e=!1}){super();const t=document.createElement("label");t.className="custom-checkbox";const n=document.createElement("input");n.type="checkbox",n.checked=e,this.checkbox=n;const s=document.createElement("span");s.className="checkmark",t.appendChild(n),t.appendChild(s),this.domElement.appendChild(t),n.addEventListener("change",()=>{this.dispatchChange()})}setValue(e){return this.checkbox.value=e,super.setValue(e)}getValue(){return this.checkbox.checked}}class kxe extends Wx{constructor({value:e=0,min:t=0,max:n=1,step:s=.01}){super(),this.slider=document.createElement("input"),this.slider.type="range",this.slider.min=t,this.slider.max=n,this.slider.step=s;const r=new NK({value:e,min:t,max:n,step:s});this.numberInput=r.input,this.numberInput.style.flexBasis="80px",this.numberInput.style.flexShrink="0",this.slider.value=e,this.domElement.append(this.slider,this.numberInput),this.slider.addEventListener("input",()=>{this.numberInput.value=this.slider.value,this.dispatchChange()}),r.addEventListener("change",()=>{this.slider.value=parseFloat(this.numberInput.value),this.dispatchChange()})}setValue(e){return this.slider.value=e,this.numberInput.value=e,super.setValue(e)}getValue(){return parseFloat(this.slider.value)}step(e){return this.slider.step=e,this.numberInput.step=e,this}}class Wxe extends Wx{constructor({options:e=[],value:t=""}){super();const n=document.createElement("select"),s=(r,a)=>{const o=document.createElement("option");return o.value=r,o.textContent=r,a==t&&(o.selected=!0),n.appendChild(o),o};Array.isArray(e)?e.forEach(r=>s(r,r)):Object.entries(e).forEach(([r,a])=>s(r,a)),this.domElement.appendChild(n),n.addEventListener("change",()=>{this.dispatchChange()}),this.options=e,this.select=n}getValue(){const e=this.options;return Array.isArray(e)?e[this.select.selectedIndex]:e[this.select.value]}}class Xxe extends Wx{constructor({value:e="#ffffff"}){super();const t=document.createElement("input");t.type="color",t.value=this._getColorHex(e),this.colorInput=t,this._value=e,t.addEventListener("input",()=>{const n=t.value;this._value.isColor?this._value.setHex(parseInt(n.slice(1),16)):this._value=n,this.dispatchChange()}),this.domElement.appendChild(t)}_getColorHex(e){return e.isColor&&(e=e.getHex()),typeof e=="number"?e=`#${e.toString(16)}`:e[0]!=="#"&&(e="#"+e),e}getValue(){let e=this._value;return typeof e=="string"&&(e=parseInt(e.slice(1),16)),e}}class qxe extends Wx{constructor({text:e="Button",value:t=()=>{}}){super();const n=document.createElement("button");n.textContent=e,n.onclick=t,this.domElement.appendChild(n)}}class JP{constructor(e,t){this.parameters=e,this.name=t,this.paramList=new Da(t)}close(){return this.paramList.close(),this}add(e,t,...n){const r=typeof e[t];let a=null;return typeof n[0]=="object"?a=this.addSelect(e,t,n[0]):r==="number"?n.length>=2?a=this.addSlider(e,t,...n):a=this.addNumber(e,t,...n):r==="boolean"?a=this.addBoolean(e,t):r==="function"&&(a=this.addButton(e,t,...n)),a}_addParameter(e,t,n,s){n.name=r=>(s.data[0].textContent=r,n),n.listen=()=>{const r=()=>{const a=n.getValue(),o=e[t];a!==o&&n.setValue(o),requestAnimationFrame(r)};return requestAnimationFrame(r),n}}addFolder(e){const t=new JP(this.parameters,e);return this.paramList.add(t.paramList),t}addBoolean(e,t){const n=e[t],s=new Hxe({value:n});s.addEventListener("change",({value:l})=>{e[t]=l});const r=br();r.textContent=t;const a=new Da(r,s.domElement);this.paramList.add(a);const o=a.domElement.firstChild;return o.classList.add("actionable"),o.addEventListener("click",l=>{if(l.target.closest("label"))return;const c=o.querySelector('input[type="checkbox"]');c&&(c.checked=!c.checked,c.dispatchEvent(new Event("change")))}),this._addParameter(e,t,s,a),s}addSelect(e,t,n){const s=e[t],r=new Wxe({options:n,value:s});r.addEventListener("change",({value:c})=>{e[t]=c});const a=br();a.textContent=t;const o=new Da(a,r.domElement);return this.paramList.add(o),o.domElement.firstChild.classList.add("actionable"),this._addParameter(e,t,r,o),r}addColor(e,t){const n=e[t],s=new Xxe({value:n});s.addEventListener("change",({value:l})=>{e[t]=l});const r=br();r.textContent=t;const a=new Da(r,s.domElement);return this.paramList.add(a),a.domElement.firstChild.classList.add("actionable"),this._addParameter(e,t,s,a),s}addSlider(e,t,n=0,s=1,r=.01){const a=e[t],o=new kxe({value:a,min:n,max:s,step:r});o.addEventListener("change",({value:h})=>{e[t]=h});const l=br();l.textContent=t;const c=new Da(l,o.domElement);return this.paramList.add(c),c.domElement.firstChild.classList.add("actionable"),this._addParameter(e,t,o,c),o}addNumber(e,t,...n){const s=e[t],[r,a]=n,o=new NK({value:s,min:r,max:a});o.addEventListener("change",({value:h})=>{e[t]=h});const l=br();l.textContent=t;const c=new Da(l,o.domElement);return this.paramList.add(c),c.domElement.firstChild.classList.add("actionable"),this._addParameter(e,t,o,c),o}addButton(e,t){const n=e[t],s=new qxe({text:t,value:n});s.addEventListener("change",({value:o})=>{e[t]=o});const r=new Da(s.domElement);return r.itemRow.childNodes[0].style.gridColumn="1 / -1",this.paramList.add(r),r.domElement.firstChild.classList.add("actionable"),s.name=o=>(s.domElement.childNodes[0].textContent=o,s),s}}class jxe extends pw{constructor(e={}){super("Parameters",e);const t=new ZP("Property","Value");t.domElement.classList.add("parameters"),t.setGridStyle(".5fr 1fr"),t.domElement.style.minWidth="300px";const n=document.createElement("div");n.className="list-scroll-wrapper",n.appendChild(t.domElement),this.content.appendChild(n),this.paramList=t}createGroup(e){const t=new JP(this,e);return this.paramList.add(t.paramList),t}}class Yxe extends pw{constructor(e={}){super("Viewer",e);const t=new ZP("Viewer","Name");t.setGridStyle("150px minmax(200px, 2fr)"),t.domElement.style.minWidth="400px";const n=document.createElement("div");n.className="list-scroll-wrapper",n.appendChild(t.domElement),this.content.appendChild(n);const s=new Da("Nodes");t.add(s),this.itemLibrary=new Map,this.folderLibrary=new Map,this.currentDataList=[],this.nodeList=t,this.nodes=s}getFolder(e){let t=this.folderLibrary.get(e);return t===void 0&&(t=new Da(e),this.folderLibrary.set(e,t),this.nodeList.add(t)),t}addNodeItem(e){let t=this.itemLibrary.get(e.id);if(t===void 0){const n=e.name,s=e.canvasTarget.domElement;t=new Da(s,n),t.itemRow.children[1].style["justify-content"]="flex-start",this.itemLibrary.set(e.id,t)}return t}update(e,t){if(!this.isActive&&!this.isDetached)return;const n=[...this.currentDataList];for(const r of n)if(this.itemLibrary.has(r.id)&&t.indexOf(r)===-1){const a=this.itemLibrary.get(r.id),o=a.parent;o.remove(a),this.folderLibrary.has(o.data[0])&&o.children.length===0&&(o.parent.remove(o),this.folderLibrary.delete(o.data[0])),this.itemLibrary.delete(r.id)}const s={};for(const r of t){const a=this.addNodeItem(r),o=e.getCanvasTarget(),l=r.path;if(l){const u=this.getFolder(l);s[l]===void 0&&(s[l]=0),(u.parent===null||a.parent!==u||u.children.indexOf(a)!==s[l])&&u.add(a),s[l]++}else a.parent||this.nodes.add(a);this.currentDataList=t;const c=Vs.resetRendererState(e);e.toneMapping=Ki,e.outputColorSpace=Jr,e.setCanvasTarget(r.canvasTarget),r.quad.render(e),e.setCanvasTarget(o),Vs.restoreRendererState(e,c)}}}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */D.BRDF_GGX;D.BRDF_Lambert;D.BasicPointShadowFilter;D.BasicShadowFilter;const Kxe=D.Break;D.Const;D.Continue;D.DFGLUT;D.D_GGX;D.Discard;D.EPSILON;D.F_Schlick;const bn=D.Fn;D.INFINITY;const zo=D.If,rg=D.Loop;D.NodeAccess;D.NodeShaderStage;D.NodeType;const oT=D.NodeUpdateType;D.PCFShadowFilter;D.PCFSoftShadowFilter;const mv=D.PI;D.PI2;D.TWO_PI;const lH=D.HALF_PI;D.PointShadowFilter;D.Return;D.Schlick_to_F0;D.ScriptableNodeResources;D.ShaderNode;D.Stack;D.Switch;D.TBNViewMatrix;D.VSMShadowFilter;D.V_GGX_SmithCorrelated;D.Var;D.VarIntent;const ro=D.abs;D.acesFilmicToneMapping;const l3=D.acos,eE=D.add;D.addMethodChaining;D.addNodeElement;D.agxToneMapping;D.all;D.alphaT;D.and;D.anisotropy;D.anisotropyB;D.anisotropyT;D.any;D.append;D.array;D.arrayBuffer;D.asin;D.assign;const W2=D.atan;D.atan2;D.atomicAdd;D.atomicAnd;D.atomicFunc;D.atomicLoad;D.atomicMax;D.atomicMin;D.atomicOr;D.atomicStore;D.atomicSub;D.atomicXor;D.attenuationColor;D.attenuationDistance;const X2=D.attribute;D.attributeArray;D.backgroundBlurriness;D.backgroundIntensity;D.backgroundRotation;D.batch;D.bentNormalView;D.billboarding;D.bitAnd;D.bitNot;D.bitOr;D.bitXor;D.bitangentGeometry;D.bitangentLocal;D.bitangentView;D.bitangentWorld;D.bitcast;D.blendBurn;D.blendColor;D.blendDodge;D.blendOverlay;D.blendScreen;D.blur;const cH=D.bool;D.buffer;D.bufferAttribute;D.bumpMap;D.burn;D.builtin;D.builtinAOContext;D.builtinShadowContext;D.bvec2;D.bvec3;D.bvec4;D.bypass;D.cache;D.call;D.cameraFar;D.cameraIndex;D.cameraNear;D.cameraNormalMatrix;const Zxe=D.cameraPosition;D.cameraProjectionMatrix;D.cameraProjectionMatrixInverse;D.cameraViewMatrix;D.cameraViewport;D.cameraWorldMatrix;D.cbrt;D.cdl;const Jxe=D.ceil;D.checker;D.cineonToneMapping;const Xc=D.clamp;D.clearcoat;D.clearcoatNormalView;D.clearcoatRoughness;D.code;const uH=D.color;D.colorSpaceToWorking;const Qxe=D.colorToDirection;D.compute;D.computeKernel;D.computeSkinning;D.context;D.convert;D.convertColorSpace;const Ng=D.convertToTexture;D.countLeadingZeros;const hH=D.countOneBits;D.countTrailingZeros;const Ey=D.cos,Yv=D.cross;D.cubeTexture;D.cubeTextureBase;D.dFdx;D.dFdy;D.dashSize;D.debug;D.decrement;D.decrementBefore;D.defaultBuildStages;D.defaultShaderStages;D.defined;D.degrees;D.deltaTime;D.densityFog;D.densityFogFactor;D.depth;D.depthPass;D.determinant;D.difference;const $xe=D.diffuseColor;D.directPointLight;const e_e=D.directionToColor;D.directionToFaceDirection;D.dispersion;D.distance;const BK=D.div;D.dodge;const li=D.dot;D.drawIndex;D.dynamicBufferAttribute;D.element;D.emissive;D.equal;D.equals;const t_e=D.equirectUV,n_e=D.exp;D.exp2;D.expression;D.faceDirection;D.faceForward;D.faceforward;const _e=D.float;D.floatBitsToInt;D.floatBitsToUint;const i_e=D.floor,s_e=D.fog,am=D.fract;D.frameGroup;D.frameId;D.frontFacing;D.fwidth;D.gain;D.gapSize;D.getConstNodeType;D.getCurrentStack;D.getDirection;D.getDistanceAttenuation;D.getGeometryRoughness;const DK=D.getNormalFromDepth,r_e=D.interleavedGradientNoise;D.vogelDiskSample;D.getParallaxCorrectNormal;D.getRoughness;const dH=D.getScreenPosition;D.getShIrradianceAt;D.getShadowMaterial;D.getShadowRenderObjectFunction;D.getTextureIndex;const Cy=D.getViewPosition;D.globalId;D.glsl;D.glslFn;D.grayscale;D.greaterThan;D.greaterThanEqual;D.hash;D.highpModelNormalViewMatrix;D.highpModelViewMatrix;D.hue;D.increment;D.incrementBefore;D.instance;D.instanceIndex;D.instancedArray;D.instancedBufferAttribute;D.instancedDynamicBufferAttribute;D.instancedMesh;const c3=D.int;D.intBitsToFloat;D.inverse;D.inverseSqrt;D.inversesqrt;D.invocationLocalIndex;D.invocationSubgroupIndex;D.ior;D.iridescence;D.iridescenceIOR;D.iridescenceThickness;const a_e=D.ivec2;D.ivec3;D.ivec4;D.js;D.label;const yd=D.length;D.lengthSq;D.lessThan;D.lessThanEqual;D.lightPosition;D.lightProjectionUV;D.lightShadowMatrix;D.lightTargetDirection;D.lightTargetPosition;D.lightViewPosition;D.lightingContext;D.lights;D.linearDepth;D.linearToneMapping;D.localId;D.log;D.log2;const LK=D.logarithmicDepthToViewZ,Pb=D.luminance;D.mat2;const o_e=D.mat3;D.mat4;D.matcapUV;D.materialAO;D.materialAlphaTest;D.materialAnisotropy;D.materialAnisotropyVector;D.materialAttenuationColor;D.materialAttenuationDistance;D.materialClearcoat;D.materialClearcoatNormal;D.materialClearcoatRoughness;D.materialColor;D.materialDispersion;D.materialEmissive;D.materialEnvIntensity;D.materialEnvRotation;D.materialIOR;D.materialIridescence;D.materialIridescenceIOR;D.materialIridescenceThickness;D.materialLightMap;D.materialLineDashOffset;D.materialLineDashSize;D.materialLineGapSize;D.materialLineScale;D.materialLineWidth;D.materialMetalness;D.materialNormal;D.materialOpacity;D.materialPointSize;D.materialReference;D.materialReflectivity;D.materialRefractionRatio;D.materialRotation;D.materialRoughness;D.materialSheen;D.materialSheenRoughness;D.materialShininess;D.materialSpecular;D.materialSpecularColor;D.materialSpecularIntensity;D.materialSpecularStrength;D.materialThickness;D.materialTransmission;const Rl=D.max;D.maxMipLevel;D.mediumpModelViewMatrix;D.metalness;const tE=D.min,qs=D.mix;D.mixElement;const l_e=D.mod;D.modInt;D.modelDirection;D.modelNormalMatrix;D.modelPosition;D.modelRadius;D.modelScale;D.modelViewMatrix;D.modelViewPosition;D.modelViewProjection;D.modelWorldMatrix;D.modelWorldMatrixInverse;D.morphReference;const c_e=D.mrt,sh=D.mul;D.mx_aastep;D.mx_add;D.mx_atan2;D.mx_cell_noise_float;D.mx_contrast;D.mx_divide;D.mx_fractal_noise_float;D.mx_fractal_noise_vec2;D.mx_fractal_noise_vec3;D.mx_fractal_noise_vec4;D.mx_frame;D.mx_heighttonormal;D.mx_hsvtorgb;D.mx_ifequal;D.mx_ifgreater;D.mx_ifgreatereq;D.mx_invert;D.mx_modulo;D.mx_multiply;D.mx_noise_float;D.mx_noise_vec3;D.mx_noise_vec4;D.mx_place2d;D.mx_power;D.mx_ramp4;D.mx_ramplr;D.mx_ramptb;D.mx_rgbtohsv;D.mx_rotate2d;D.mx_rotate3d;D.mx_safepower;D.mx_separate;D.mx_splitlr;D.mx_splittb;D.mx_srgb_texture_to_lin_rec709;D.mx_subtract;D.mx_timer;D.mx_transform_uv;D.mx_unifiednoise2d;D.mx_unifiednoise3d;D.mx_worley_noise_float;D.mx_worley_noise_vec2;D.mx_worley_noise_vec3;D.negate;D.neutralToneMapping;D.nodeArray;D.nodeImmutable;const ps=D.nodeObject;D.nodeObjectIntent;D.nodeObjects;D.nodeProxy;D.nodeProxyIntent;D.normalFlat;D.normalGeometry;D.normalLocal;D.normalMap;const u_e=D.normalView;D.normalViewGeometry;D.normalWorld;D.normalWorldGeometry;const Pa=D.normalize;D.not;D.notEqual;D.numWorkgroups;D.objectDirection;D.objectGroup;D.objectPosition;D.objectRadius;D.objectScale;D.objectViewPosition;D.objectWorldMatrix;D.OnBeforeObjectUpdate;D.OnBeforeMaterialUpdate;D.OnObjectUpdate;const h_e=D.OnMaterialUpdate;D.oneMinus;D.or;D.orthographicDepthToViewZ;D.oscSawtooth;D.oscSine;D.oscSquare;D.oscTriangle;const d_e=D.output,f_e=D.outputStruct;D.overlay;D.overloadingFn;D.packHalf2x16;D.packSnorm2x16;D.packUnorm2x16;D.parabola;D.parallaxDirection;D.parallaxUV;D.parameter;const p_e=D.pass,op=D.passTexture;D.pcurve;D.perspectiveDepthToViewZ;D.pmremTexture;D.pointShadow;D.pointUV;D.pointWidth;D.positionGeometry;D.positionLocal;D.positionPrevious;const fH=D.positionView;D.positionViewDirection;const UK=D.positionWorld;D.positionWorldDirection;D.posterize;const rh=D.pow;D.pow2;D.pow3;D.pow4;const m_e=D.premultiplyAlpha,pH=D.property;D.radians;const IK=D.rand;D.range;D.rangeFog;D.rangeFogFactor;D.reciprocal;const nE=D.reference;D.referenceBuffer;D.reflect;D.reflectVector;D.reflectView;D.reflector;D.refract;D.refractVector;D.refractView;D.reinhardToneMapping;D.remap;D.remapClamp;D.renderGroup;const g_e=D.renderOutput;D.rendererReference;D.replaceDefaultUV;D.rotate;D.rotateUV;D.roughness;D.round;D.rtt;D.sRGBTransferEOTF;D.sRGBTransferOETF;const y_e=D.sample;D.sampler;D.samplerComparison;D.saturate;D.saturation;D.screen;const mH=D.screenCoordinate;D.screenDPR;D.screenSize;const x_e=D.screenUV;D.scriptable;D.scriptableValue;D.select;D.setCurrentStack;D.setName;D.shaderStages;D.shadow;D.shadowPositionWorld;D.shapeCircle;D.sharedUniformGroup;D.sheen;D.sheenRoughness;D.shiftLeft;const __e=D.shiftRight;D.shininess;const gH=D.sign,hc=D.sin;D.sinc;D.skinning;const ju=D.smoothstep;D.smoothstepElement;D.specularColor;D.specularF90;D.spherizeUV;D.split;D.spritesheetUV;const QP=D.sqrt;D.stack;const fm=D.step;D.stepElement;D.storage;D.storageBarrier;D.storageObject;D.storageTexture;D.string;const v_e=D.struct,u3=D.sub;D.subgroupAdd;D.subgroupAll;D.subgroupAnd;D.subgroupAny;D.subgroupBallot;D.subgroupBroadcast;D.subgroupBroadcastFirst;D.subBuild;D.subgroupElect;D.subgroupExclusiveAdd;D.subgroupExclusiveMul;D.subgroupInclusiveAdd;D.subgroupInclusiveMul;D.subgroupIndex;D.subgroupMax;D.subgroupMin;D.subgroupMul;D.subgroupOr;D.subgroupShuffle;D.subgroupShuffleDown;D.subgroupShuffleUp;D.subgroupShuffleXor;D.subgroupSize;D.subgroupXor;D.tan;D.tangentGeometry;D.tangentLocal;D.tangentView;D.tangentWorld;const bs=D.texture;D.texture3D;D.textureBarrier;D.textureBicubic;D.textureBicubicLevel;const b_e=D.textureCubeUV;D.textureLoad;const S_e=D.textureSize;D.textureLevel;D.textureStore;D.thickness;D.time;D.toneMapping;D.toneMappingExposure;D.toonOutlinePass;D.transformDirection;D.transformNormal;D.transformNormalToView;D.transformedClearcoatNormalView;D.transformedNormalView;D.transformedNormalWorld;D.transmission;D.transpose;D.triNoise3D;D.triplanarTexture;D.triplanarTextures;D.trunc;const oc=D.uint;D.uintBitsToFloat;const ut=D.uniform,Kv=D.uniformArray;D.uniformCubeTexture;D.uniformGroup;D.uniformFlow;D.uniformTexture;D.unpackHalf2x16;D.unpackSnorm2x16;D.unpackUnorm2x16;const T_e=D.unpremultiplyAlpha;D.userData;const kl=D.uv;D.uvec2;D.uvec3;D.uvec4;D.varying;D.varyingProperty;const Ui=D.vec2,an=D.vec3,ns=D.vec4;D.vectorComponents;const h3=D.velocity;D.vertexColor;D.vertexIndex;D.vertexStage;D.vibrance;D.viewZToLogarithmicDepth;D.viewZToOrthographicDepth;const $P=D.viewZToPerspectiveDepth;D.viewport;D.viewportCoordinate;D.viewportDepthTexture;D.viewportLinearDepth;D.viewportMipTexture;D.viewportResolution;D.viewportSafeUV;D.viewportSharedTexture;D.viewportSize;D.viewportTexture;D.viewportUV;D.wgsl;D.wgslFn;D.workgroupArray;D.workgroupBarrier;D.workgroupId;D.workingToColorSpace;D.xor;const A_e=bn(([i,e])=>{const t=ut(0);h_e(()=>{const{width:o,height:l}=e.value;t.value=o/l});const n=i.sub(.5),r=Ui(n.x.div(t),n.y).add(.5),a=fm(0,r.x).mul(fm(r.x,1)).mul(fm(0,r.y)).mul(fm(r.y,1));return an(r,a)});class M_e extends zpe{constructor(){super();const e=new Hpe,t=new jxe({builtin:!1,icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M4 6l8 0" /><path d="M16 6l4 0" /><path d="M8 12m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M4 12l2 0" /><path d="M10 12l10 0" /><path d="M17 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M4 18l11 0" /><path d="M19 18l1 0" /></svg>'});t.hide(),e.addTab(t);const n=new Yxe;n.hide(),e.addTab(n);const s=new qpe;e.addTab(s);const r=new jpe;e.addTab(r),e.loadLayout(),e.activeTabId||e.setActiveTab(s.id),e.panel.classList.add("hidden"),e.toggleButton.classList.add("hidden"),e.miniPanel.classList.remove("visible"),e.miniPanel.querySelectorAll(".mini-panel-content").forEach(a=>{a.style.display="none"}),e.builtinTabsContainer&&e.builtinTabsContainer.querySelectorAll(".builtin-tab-btn").forEach(a=>{a.classList.remove("active")}),this.statsData=new Map,this.canvasNodes=new Map,this.profiler=e,this.performance=s,this.console=r,this.parameters=t,this.viewer=n,this.once={},this.displayCycle={text:{needsUpdate:!1,duration:.25,time:0},graph:{needsUpdate:!1,duration:.02,time:0}}}get domElement(){return this.profiler.domElement}resolveConsoleOnce(e,t){const n=e+t;this.once[n]!==!0&&(this.resolveConsole(e,t),this.once[n]=!0)}resolveConsole(e,t){switch(e){case"log":this.console.addMessage("info",t),console.log(t);break;case"warn":this.console.addMessage("warn",t),console.warn(t);break;case"error":this.console.addMessage("error",t),console.error(t);break}}init(){const e=this.getRenderer();let t=`THREE.WebGPURenderer: ${bu} [ "`;e.backend.isWebGPUBackend?t+="WebGPU":e.backend.isWebGLBackend&&(t+="WebGL2"),t+='" ]',this.console.addMessage("info",t),e.inspector.domElement.parentElement===null&&e.domElement.parentElement!==null&&e.domElement.parentElement.appendChild(e.inspector.domElement),this.setupKeyboardShortcut()}setupKeyboardShortcut(){const e=t=>{(t.ctrlKey||t.metaKey)&&t.key==="d"&&(t.preventDefault(),t.stopPropagation(),this.profiler.togglePanel())};document.addEventListener("keydown",e),this._keyboardHandler=e}setRenderer(e){return super.setRenderer(e),e!==null&&(gU(this.resolveConsole.bind(this)),this.isAvailable&&(e.backend.trackTimestamp=!0,e.init().then(()=>{e.hasFeature("timestamp-query")!==!0&&this.console.addMessage("error","THREE.Inspector: GPU Timestamp Queries not available.")}))),this}createParameters(e){return this.parameters.isVisible===!1&&(this.parameters.show(),this.parameters.isDetached===!1&&this.profiler.setActiveTab(this.parameters.id)),this.parameters.createGroup(e)}getStatsData(e){let t=this.statsData.get(e);return t===void 0&&(t={},this.statsData.set(e,t)),t}resolveStats(e){const t=this.getStatsData(e.cid);t.initialized!==!0&&(t.cpu=e.cpu,t.gpu=e.gpu,t.stats=[],t.initialized=!0),t.stats.length>this.maxFrames&&t.stats.shift(),t.stats.push(e),t.cpu=this.getAverageDeltaTime(t,"cpu"),t.gpu=this.getAverageDeltaTime(t,"gpu"),t.total=t.cpu+t.gpu;for(const n of e.children){this.resolveStats(n);const s=this.getStatsData(n.cid);t.cpu+=s.cpu,t.gpu+=s.gpu,t.total+=s.total}}getCanvasDataByNode(e){let t=this.canvasNodes.get(e);if(t===void 0){const n=this.getRenderer(),s=document.createElement("canvas"),r=new KP(s);r.setPixelRatio(window.devicePixelRatio),r.setSize(140,140);const a=e.id,{path:o,name:l}=Wpe(Xpe(e.getName()||"(unnamed)")),c=e.context({getUV:m=>{const g=A_e(x_e,m),x=g.xy,v=g.z;return x.mul(v)}});let u=ns(an(c),1);u=g_e(u,Ki,n.outputColorSpace),u=u.context({inspector:!0});const h=new Tn;h.outputNode=u;const f=new Aa(h);f.name="Viewer - "+l,t={id:a,name:l,path:o,node:e,quad:f,canvasTarget:r,material:h},this.canvasNodes.set(e,t)}return t}resolveViewer(){const e=this.currentNodes,t=this.getRenderer();if(e.length===0)return;if(!t.backend.isWebGPUBackend){this.resolveConsoleOnce("warn","Inspector: Viewer is only available with WebGPU.");return}this.viewer.isVisible||this.viewer.show();const n=e.map(s=>this.getCanvasDataByNode(s));this.viewer.update(t,n)}getAverageDeltaTime(e,t,n=this.fps){const s=e.stats;let r=0,a=0;for(let o=s.length-1;o>=0&&a<n;o--){const c=s[o][t];c>0&&(r+=c,a++)}return a>0?r/a:0}resolveFrame(e){const t=this.getFrameById(e.frameId+1);if(t){e.cpu=0,e.gpu=0,e.total=0;for(const n of e.children){this.resolveStats(n);const s=this.getStatsData(n.cid);e.cpu+=s.cpu,e.gpu+=s.gpu,e.total+=s.total}e.deltaTime=t.startTime-e.startTime,e.miscellaneous=e.deltaTime-e.total,e.miscellaneous<0&&(e.miscellaneous=0),this.updateCycle(this.displayCycle.text),this.updateCycle(this.displayCycle.graph),this.displayCycle.text.needsUpdate&&(Lo("fps-counter",this.fps.toFixed()),this.performance.updateText(this,e)),this.displayCycle.graph.needsUpdate&&this.performance.updateGraph(this,e),this.displayCycle.text.needsUpdate=!1,this.displayCycle.graph.needsUpdate=!1}}updateCycle(e){e.time+=this.nodeFrame.deltaTime,e.time>=e.duration&&(e.needsUpdate=!0,e.time=0)}}var PK={exports:{}},lp={};/**
 * @license React
 * react-reconciler-constants.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */lp.ConcurrentRoot=1;lp.ContinuousEventPriority=8;lp.DefaultEventPriority=32;lp.DiscreteEventPriority=2;lp.IdleEventPriority=268435456;lp.LegacyRoot=0;lp.NoEventPriority=0;PK.exports=lp;var KA=PK.exports,OK={exports:{}},FK={},GK={exports:{}},zK={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ex=$;function E_e(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var C_e=typeof Object.is=="function"?Object.is:E_e,w_e=ex.useState,R_e=ex.useEffect,N_e=ex.useLayoutEffect,B_e=ex.useDebugValue;function D_e(i,e){var t=e(),n=w_e({inst:{value:t,getSnapshot:e}}),s=n[0].inst,r=n[1];return N_e(function(){s.value=t,s.getSnapshot=e,q2(s)&&r({inst:s})},[i,t,e]),R_e(function(){return q2(s)&&r({inst:s}),i(function(){q2(s)&&r({inst:s})})},[i]),B_e(t),t}function q2(i){var e=i.getSnapshot;i=i.value;try{var t=e();return!C_e(i,t)}catch{return!0}}function L_e(i,e){return e()}var U_e=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?L_e:D_e;zK.useSyncExternalStore=ex.useSyncExternalStore!==void 0?ex.useSyncExternalStore:U_e;GK.exports=zK;var I_e=GK.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xw=$,P_e=I_e;function O_e(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var F_e=typeof Object.is=="function"?Object.is:O_e,G_e=P_e.useSyncExternalStore,z_e=xw.useRef,V_e=xw.useEffect,H_e=xw.useMemo,k_e=xw.useDebugValue;FK.useSyncExternalStoreWithSelector=function(i,e,t,n,s){var r=z_e(null);if(r.current===null){var a={hasValue:!1,value:null};r.current=a}else a=r.current;r=H_e(function(){function l(m){if(!c){if(c=!0,u=m,m=n(m),s!==void 0&&a.hasValue){var g=a.value;if(s(g,m))return h=g}return h=m}if(g=h,F_e(u,m))return g;var x=n(m);return s!==void 0&&s(g,x)?(u=m,g):(u=m,h=x)}var c=!1,u,h,f=t===void 0?null:t;return[function(){return l(e())},f===null?void 0:function(){return l(f())}]},[e,t,n,s]);var o=G_e(i,r[0],r[1]);return V_e(function(){a.hasValue=!0,a.value=o},[o]),k_e(o),o};OK.exports=FK;var W_e=OK.exports;const X_e=k3(W_e),yH=i=>{let e;const t=new Set,n=(c,u)=>{const h=typeof c=="function"?c(e):c;if(!Object.is(h,e)){const f=e;e=u??(typeof h!="object"||h===null)?h:Object.assign({},e,h),t.forEach(m=>m(e,f))}},s=()=>e,o={setState:n,getState:s,getInitialState:()=>l,subscribe:c=>(t.add(c),()=>t.delete(c))},l=e=i(n,s,o);return o},VK=i=>i?yH(i):yH,{useSyncExternalStoreWithSelector:q_e}=X_e,j_e=i=>i;function Y_e(i,e=j_e,t){const n=q_e(i.subscribe,i.getState,i.getInitialState,e,t);return Ld.useDebugValue(n),n}const xH=(i,e)=>{const t=VK(i),n=(s,r=e)=>Y_e(t,s,r);return Object.assign(n,t),n},K_e=(i,e)=>i?xH(i,e):xH,Z_e=i=>typeof i=="object"&&typeof i.then=="function",pm=[];function HK(i,e,t=(n,s)=>n===s){if(i===e)return!0;if(!i||!e)return!1;const n=i.length;if(e.length!==n)return!1;for(let s=0;s<n;s++)if(!t(i[s],e[s]))return!1;return!0}function kK(i,e=null,t=!1,n={}){e===null&&(e=[i]);for(const r of pm)if(HK(e,r.keys,r.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(r,"error"))throw r.error;if(Object.prototype.hasOwnProperty.call(r,"response"))return n.lifespan&&n.lifespan>0&&(r.timeout&&clearTimeout(r.timeout),r.timeout=setTimeout(r.remove,n.lifespan)),r.response;if(!t)throw r.promise}const s={keys:e,equal:n.equal,remove:()=>{const r=pm.indexOf(s);r!==-1&&pm.splice(r,1)},promise:(Z_e(i)?i:i(...e)).then(r=>{s.response=r,n.lifespan&&n.lifespan>0&&(s.timeout=setTimeout(s.remove,n.lifespan))}).catch(r=>s.error=r)};if(pm.push(s),!t)throw s.promise}const J_e=(i,e,t)=>kK(i,e,!1,t),Q_e=(i,e,t)=>void kK(i,e,!0,t),$_e=i=>{if(i===void 0||i.length===0)pm.splice(0,pm.length);else{const e=pm.find(t=>HK(i,t.keys,t.equal));e&&e.remove()}};var WK={exports:{}},XK={exports:{}},qK={exports:{}},jK={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(P,X){var J=P.length;P.push(X);e:for(;0<J;){var re=J-1>>>1,ne=P[re];if(0<s(ne,X))P[re]=X,P[J]=ne,J=re;else break e}}function t(P){return P.length===0?null:P[0]}function n(P){if(P.length===0)return null;var X=P[0],J=P.pop();if(J!==X){P[0]=J;e:for(var re=0,ne=P.length,ge=ne>>>1;re<ge;){var Te=2*(re+1)-1,Be=P[Te],et=Te+1,wt=P[et];if(0>s(Be,J))et<ne&&0>s(wt,Be)?(P[re]=wt,P[et]=J,re=et):(P[re]=Be,P[Te]=J,re=Te);else if(et<ne&&0>s(wt,J))P[re]=wt,P[et]=J,re=et;else break e}}return X}function s(P,X){var J=P.sortIndex-X.sortIndex;return J!==0?J:P.id-X.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;i.unstable_now=function(){return r.now()}}else{var a=Date,o=a.now();i.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,f=3,m=!1,g=!1,x=!1,v=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;function S(P){for(var X=t(c);X!==null;){if(X.callback===null)n(c);else if(X.startTime<=P)n(c),X.sortIndex=X.expirationTime,e(l,X);else break;X=t(c)}}function T(P){if(x=!1,S(P),!g)if(t(l)!==null)g=!0,V();else{var X=t(c);X!==null&&Y(T,X.startTime-P)}}var M=!1,C=-1,w=5,N=-1;function E(){return!(i.unstable_now()-N<w)}function B(){if(M){var P=i.unstable_now();N=P;var X=!0;try{e:{g=!1,x&&(x=!1,y(C),C=-1),m=!0;var J=f;try{t:{for(S(P),h=t(l);h!==null&&!(h.expirationTime>P&&E());){var re=h.callback;if(typeof re=="function"){h.callback=null,f=h.priorityLevel;var ne=re(h.expirationTime<=P);if(P=i.unstable_now(),typeof ne=="function"){h.callback=ne,S(P),X=!0;break t}h===t(l)&&n(l),S(P)}else n(l);h=t(l)}if(h!==null)X=!0;else{var ge=t(c);ge!==null&&Y(T,ge.startTime-P),X=!1}}break e}finally{h=null,f=J,m=!1}X=void 0}}finally{X?U():M=!1}}}var U;if(typeof b=="function")U=function(){b(B)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,F=H.port2;H.port1.onmessage=B,U=function(){F.postMessage(null)}}else U=function(){v(B,0)};function V(){M||(M=!0,U())}function Y(P,X){C=v(function(){P(i.unstable_now())},X)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(P){P.callback=null},i.unstable_continueExecution=function(){g||m||(g=!0,V())},i.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):w=0<P?Math.floor(1e3/P):5},i.unstable_getCurrentPriorityLevel=function(){return f},i.unstable_getFirstCallbackNode=function(){return t(l)},i.unstable_next=function(P){switch(f){case 1:case 2:case 3:var X=3;break;default:X=f}var J=f;f=X;try{return P()}finally{f=J}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(P,X){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var J=f;f=P;try{return X()}finally{f=J}},i.unstable_scheduleCallback=function(P,X,J){var re=i.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?re+J:re):J=re,P){case 1:var ne=-1;break;case 2:ne=250;break;case 5:ne=1073741823;break;case 4:ne=1e4;break;default:ne=5e3}return ne=J+ne,P={id:u++,callback:X,priorityLevel:P,startTime:J,expirationTime:ne,sortIndex:-1},J>re?(P.sortIndex=J,e(c,P),t(l)===null&&P===t(c)&&(x?(y(C),C=-1):x=!0,Y(T,J-re))):(P.sortIndex=ne,e(l,P),g||m||(g=!0,V())),P},i.unstable_shouldYield=E,i.unstable_wrapCallback=function(P){var X=f;return function(){var J=f;f=X;try{return P.apply(this,arguments)}finally{f=J}}}})(jK);qK.exports=jK;var d3=qK.exports;/**
 * @license React
 * react-reconciler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){i.exports=function(e){function t(d,p,_,A){return new rQ(d,p,_,A)}function n(){}function s(d){var p="https://react.dev/errors/"+d;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var _=2;_<arguments.length;_++)p+="&args[]="+encodeURIComponent(arguments[_])}return"Minified React error #"+d+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(d){return d===null||typeof d!="object"?null:(d=cG&&d[cG]||d["@@iterator"],typeof d=="function"?d:null)}function a(d){if(d==null)return null;if(typeof d=="function")return d.$$typeof===hQ?null:d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case Fg:return"Fragment";case Og:return"Portal";case uR:return"Profiler";case aG:return"StrictMode";case dR:return"Suspense";case fR:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case Zh:return(d.displayName||"Context")+".Provider";case oG:return(d._context.displayName||"Context")+".Consumer";case hR:var p=d.render;return d=d.displayName,d||(d=p.displayName||p.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case pR:return p=d.displayName||null,p!==null?p:a(d.type)||"Memo";case Jh:p=d._payload,d=d._init;try{return a(d(p))}catch{}}return null}function o(d){if(mR===void 0)try{throw Error()}catch(_){var p=_.stack.trim().match(/\n( *(at )?)/);mR=p&&p[1]||"",uG=-1<_.stack.indexOf(`
    at`)?" (<anonymous>)":-1<_.stack.indexOf("@")?"@unknown:0:0":""}return`
`+mR+d+uG}function l(d,p){if(!d||gR)return"";gR=!0;var _=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var A={DetermineComponentFrameRoot:function(){try{if(p){var kt=function(){throw Error()};if(Object.defineProperty(kt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(kt,[])}catch(An){var Xt=An}Reflect.construct(d,[],kt)}else{try{kt.call()}catch(An){Xt=An}d.call(kt.prototype)}}else{try{throw Error()}catch(An){Xt=An}(kt=d())&&typeof kt.catch=="function"&&kt.catch(function(){})}}catch(An){if(An&&Xt&&typeof An.stack=="string")return[An.stack,Xt.stack]}return[null,null]}};A.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var R=Object.getOwnPropertyDescriptor(A.DetermineComponentFrameRoot,"name");R&&R.configurable&&Object.defineProperty(A.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var L=A.DetermineComponentFrameRoot(),q=L[0],oe=L[1];if(q&&oe){var ve=q.split(`
`),je=oe.split(`
`);for(R=A=0;A<ve.length&&!ve[A].includes("DetermineComponentFrameRoot");)A++;for(;R<je.length&&!je[R].includes("DetermineComponentFrameRoot");)R++;if(A===ve.length||R===je.length)for(A=ve.length-1,R=je.length-1;1<=A&&0<=R&&ve[A]!==je[R];)R--;for(;1<=A&&0<=R;A--,R--)if(ve[A]!==je[R]){if(A!==1||R!==1)do if(A--,R--,0>R||ve[A]!==je[R]){var bt=`
`+ve[A].replace(" at new "," at ");return d.displayName&&bt.includes("<anonymous>")&&(bt=bt.replace("<anonymous>",d.displayName)),bt}while(1<=A&&0<=R);break}}}finally{gR=!1,Error.prepareStackTrace=_}return(_=d?d.displayName||d.name:"")?o(_):""}function c(d){switch(d.tag){case 26:case 27:case 5:return o(d.type);case 16:return o("Lazy");case 13:return o("Suspense");case 19:return o("SuspenseList");case 0:case 15:return d=l(d.type,!1),d;case 11:return d=l(d.type.render,!1),d;case 1:return d=l(d.type,!0),d;default:return""}}function u(d){try{var p="";do p+=c(d),d=d.return;while(d);return p}catch(_){return`
Error generating stack: `+_.message+`
`+_.stack}}function h(d){var p=d,_=d;if(d.alternate)for(;p.return;)p=p.return;else{d=p;do p=d,p.flags&4098&&(_=p.return),d=p.return;while(d)}return p.tag===3?_:null}function f(d){if(h(d)!==d)throw Error(s(188))}function m(d){var p=d.alternate;if(!p){if(p=h(d),p===null)throw Error(s(188));return p!==d?null:d}for(var _=d,A=p;;){var R=_.return;if(R===null)break;var L=R.alternate;if(L===null){if(A=R.return,A!==null){_=A;continue}break}if(R.child===L.child){for(L=R.child;L;){if(L===_)return f(R),d;if(L===A)return f(R),p;L=L.sibling}throw Error(s(188))}if(_.return!==A.return)_=R,A=L;else{for(var q=!1,oe=R.child;oe;){if(oe===_){q=!0,_=R,A=L;break}if(oe===A){q=!0,A=R,_=L;break}oe=oe.sibling}if(!q){for(oe=L.child;oe;){if(oe===_){q=!0,_=L,A=R;break}if(oe===A){q=!0,A=L,_=R;break}oe=oe.sibling}if(!q)throw Error(s(189))}}if(_.alternate!==A)throw Error(s(190))}if(_.tag!==3)throw Error(s(188));return _.stateNode.current===_?d:p}function g(d){var p=d.tag;if(p===5||p===26||p===27||p===6)return d;for(d=d.child;d!==null;){if(p=g(d),p!==null)return p;d=d.sibling}return null}function x(d){var p=d.tag;if(p===5||p===26||p===27||p===6)return d;for(d=d.child;d!==null;){if(d.tag!==4&&(p=x(d),p!==null))return p;d=d.sibling}return null}function v(d){return{current:d}}function y(d){0>zg||(d.current=SR[zg],SR[zg]=null,zg--)}function b(d,p){zg++,SR[zg]=d.current,d.current=p}function S(d){return d>>>=0,d===0?32:31-(E$(d)/C$|0)|0}function T(d){var p=d&42;if(p!==0)return p;switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return d&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return d}}function M(d,p){var _=d.pendingLanes;if(_===0)return 0;var A=0,R=d.suspendedLanes,L=d.pingedLanes,q=d.warmLanes;d=d.finishedLanes!==0;var oe=_&134217727;return oe!==0?(_=oe&~R,_!==0?A=T(_):(L&=oe,L!==0?A=T(L):d||(q=oe&~q,q!==0&&(A=T(q))))):(oe=_&~R,oe!==0?A=T(oe):L!==0?A=T(L):d||(q=_&~q,q!==0&&(A=T(q)))),A===0?0:p!==0&&p!==A&&!(p&R)&&(R=A&-A,q=p&-p,R>=q||R===32&&(q&4194176)!==0)?p:A}function C(d,p){return(d.pendingLanes&~(d.suspendedLanes&~d.pingedLanes)&p)===0}function w(d,p){switch(d){case 1:case 2:case 4:case 8:return p+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function N(){var d=ET;return ET<<=1,!(ET&4194176)&&(ET=128),d}function E(){var d=CT;return CT<<=1,!(CT&62914560)&&(CT=4194304),d}function B(d){for(var p=[],_=0;31>_;_++)p.push(d);return p}function U(d,p){d.pendingLanes|=p,p!==268435456&&(d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0)}function H(d,p,_,A,R,L){var q=d.pendingLanes;d.pendingLanes=_,d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0,d.expiredLanes&=_,d.entangledLanes&=_,d.errorRecoveryDisabledLanes&=_,d.shellSuspendCounter=0;var oe=d.entanglements,ve=d.expirationTimes,je=d.hiddenUpdates;for(_=q&~_;0<_;){var bt=31-To(_),kt=1<<bt;oe[bt]=0,ve[bt]=-1;var Xt=je[bt];if(Xt!==null)for(je[bt]=null,bt=0;bt<Xt.length;bt++){var An=Xt[bt];An!==null&&(An.lane&=-536870913)}_&=~kt}A!==0&&F(d,A,0),L!==0&&R===0&&d.tag!==0&&(d.suspendedLanes|=L&~(q&~p))}function F(d,p,_){d.pendingLanes|=p,d.suspendedLanes&=~p;var A=31-To(p);d.entangledLanes|=p,d.entanglements[A]=d.entanglements[A]|1073741824|_&4194218}function V(d,p){var _=d.entangledLanes|=p;for(d=d.entanglements;_;){var A=31-To(_),R=1<<A;R&p|d[A]&p&&(d[A]|=p),_&=~R}}function Y(d){return d&=-d,2<d?8<d?d&134217727?32:268435456:8:2}function P(d){if(Ao&&typeof Ao.onCommitFiberRoot=="function")try{Ao.onCommitFiberRoot(i_,d,void 0,(d.current.flags&128)===128)}catch{}}function X(d){if(typeof D$=="function"&&L$(d),Ao&&typeof Ao.setStrictMode=="function")try{Ao.setStrictMode(i_,d)}catch{}}function J(d,p){return d===p&&(d!==0||1/d===1/p)||d!==d&&p!==p}function re(d,p){if(typeof d=="object"&&d!==null){var _=PG.get(d);return _!==void 0?_:(p={value:d,source:p,stack:u(p)},PG.set(d,p),p)}return{value:d,source:p,stack:u(p)}}function ne(d,p){Hg[kg++]=NT,Hg[kg++]=RT,RT=d,NT=p}function ge(d,p,_){hl[dl++]=Nu,hl[dl++]=Bu,hl[dl++]=xp,xp=d;var A=Nu;d=Bu;var R=32-To(A)-1;A&=~(1<<R),_+=1;var L=32-To(p)+R;if(30<L){var q=R-R%5;L=(A&(1<<q)-1).toString(32),A>>=q,R-=q,Nu=1<<32-To(p)+R|_<<R|A,Bu=L+d}else Nu=1<<L|_<<R|A,Bu=d}function Te(d){d.return!==null&&(ne(d,1),ge(d,1,0))}function Be(d){for(;d===RT;)RT=Hg[--kg],Hg[kg]=null,NT=Hg[--kg],Hg[kg]=null;for(;d===xp;)xp=hl[--dl],hl[dl]=null,Bu=hl[--dl],hl[dl]=null,Nu=hl[--dl],hl[dl]=null}function et(d,p){b($h,p),b(s_,d),b(Fr,null),d=pQ(p),y(Fr),b(Fr,d)}function wt(){y(Fr),y(s_),y($h)}function be(d){d.memoizedState!==null&&b(BT,d);var p=Fr.current,_=mQ(p,d.type);p!==_&&(b(s_,d),b(Fr,_))}function Re(d){s_.current===d&&(y(Fr),y(s_)),BT.current===d&&(y(BT),Ru?yp._currentValue=Gg:yp._currentValue2=Gg)}function tt(d){var p=Error(s(418,""));throw Mt(re(p,d)),MR}function Bt(d,p){if(!cl)throw Error(s(175));l$(d.stateNode,d.type,d.memoizedProps,p,d)||tt(d)}function ht(d){for(Ca=d.return;Ca;)switch(Ca.tag){case 3:case 27:wc=!0;return;case 5:case 13:wc=!1;return;default:Ca=Ca.return}}function Ke(d){if(!cl||d!==Ca)return!1;if(!si)return ht(d),si=!0,!1;var p=!1;if(aa?d.tag!==3&&d.tag!==27&&(d.tag!==5||MG(d.type)&&!MT(d.type,d.memoizedProps))&&(p=!0):d.tag!==3&&(d.tag!==5||MG(d.type)&&!MT(d.type,d.memoizedProps))&&(p=!0),p&&oa&&tt(d),ht(d),d.tag===13){if(!cl)throw Error(s(316));if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(s(317));oa=h$(d)}else oa=Ca?TG(d.stateNode):null;return!0}function jt(){cl&&(oa=Ca=null,si=!1)}function Mt(d){tc===null?tc=[d]:tc.push(d)}function Ie(){for(var d=Wg,p=ER=Wg=0;p<d;){var _=fl[p];fl[p++]=null;var A=fl[p];fl[p++]=null;var R=fl[p];fl[p++]=null;var L=fl[p];if(fl[p++]=null,A!==null&&R!==null){var q=A.pending;q===null?R.next=R:(R.next=q.next,q.next=R),A.pending=R}L!==0&&Z(_,R,L)}}function ke(d,p,_,A){fl[Wg++]=d,fl[Wg++]=p,fl[Wg++]=_,fl[Wg++]=A,ER|=A,d.lanes|=A,d=d.alternate,d!==null&&(d.lanes|=A)}function Ve(d,p,_,A){return ke(d,p,_,A),zt(d)}function at(d,p){return ke(d,null,null,p),zt(d)}function Z(d,p,_){d.lanes|=_;var A=d.alternate;A!==null&&(A.lanes|=_);for(var R=!1,L=d.return;L!==null;)L.childLanes|=_,A=L.alternate,A!==null&&(A.childLanes|=_),L.tag===22&&(d=L.stateNode,d===null||d._visibility&1||(R=!0)),d=L,L=L.return;R&&p!==null&&d.tag===3&&(L=d.stateNode,R=31-To(_),L=L.hiddenUpdates,d=L[R],d===null?L[R]=[p]:d.push(p),p.lane=_|536870912)}function zt(d){if(50<f_)throw f_=0,HR=null,Error(s(185));for(var p=d.return;p!==null;)d=p,p=d.return;return d.tag===3?d.stateNode:null}function st(d){d!==Xg&&d.next===null&&(Xg===null?DT=Xg=d:Xg=Xg.next=d),LT=!0,CR||(CR=!0,Ne(Je))}function Vt(d,p){if(!wR&&LT){wR=!0;do for(var _=!1,A=DT;A!==null;){if(d!==0){var R=A.pendingLanes;if(R===0)var L=0;else{var q=A.suspendedLanes,oe=A.pingedLanes;L=(1<<31-To(42|d)+1)-1,L&=R&~(q&~oe),L=L&201326677?L&201326677|1:L?L|2:0}L!==0&&(_=!0,ue(A,L))}else L=Zn,L=M(A,A===Hi?L:0),!(L&3)||C(A,L)||(_=!0,ue(A,L));A=A.next}while(_);wR=!1}}function Je(){LT=CR=!1;var d=0;qg!==0&&(TQ()&&(d=qg),qg=0);for(var p=ec(),_=null,A=DT;A!==null;){var R=A.next,L=K(A,p);L===0?(A.next=null,_===null?DT=R:_.next=R,R===null&&(Xg=_)):(_=A,(d!==0||L&3)&&(LT=!0)),A=R}Vt(d)}function K(d,p){for(var _=d.suspendedLanes,A=d.pingedLanes,R=d.expirationTimes,L=d.pendingLanes&-62914561;0<L;){var q=31-To(L),oe=1<<q,ve=R[q];ve===-1?(!(oe&_)||oe&A)&&(R[q]=w(oe,p)):ve<=p&&(d.expiredLanes|=oe),L&=~oe}if(p=Hi,_=Zn,_=M(d,d===p?_:0),A=d.callbackNode,_===0||d===p&&ki===2||d.cancelPendingCommit!==null)return A!==null&&A!==null&&TR(A),d.callbackNode=null,d.callbackPriority=0;if(!(_&3)||C(d,_)){if(p=_&-_,p===d.callbackPriority)return p;switch(A!==null&&TR(A),Y(_)){case 2:case 8:_=N$;break;case 32:_=AR;break;case 268435456:_=B$;break;default:_=AR}return A=I.bind(null,d),_=wT(_,A),d.callbackPriority=p,d.callbackNode=_,p}return A!==null&&A!==null&&TR(A),d.callbackPriority=2,d.callbackNode=null,2}function I(d,p){var _=d.callbackNode;if(pp()&&d.callbackNode!==_)return null;var A=Zn;return A=M(d,d===Hi?A:0),A===0?null:(GF(d,A,p),K(d,ec()),d.callbackNode!=null&&d.callbackNode===_?I.bind(null,d):null)}function ue(d,p){if(pp())return null;GF(d,p,!0)}function Ne(d){RQ?NQ(function(){Bi&6?wT(IG,d):d()}):wT(IG,d)}function ze(){return qg===0&&(qg=N()),qg}function we(d,p){if(r_===null){var _=r_=[];RR=0,jg=ze(),Yg={status:"pending",value:void 0,then:function(A){_.push(A)}}}return RR++,p.then(Ut,Ut),p}function Ut(){if(--RR===0&&r_!==null){Yg!==null&&(Yg.status="fulfilled");var d=r_;r_=null,jg=0,Yg=null;for(var p=0;p<d.length;p++)(0,d[p])()}}function dt(d,p){var _=[],A={status:"pending",value:null,reason:null,then:function(R){_.push(R)}};return d.then(function(){A.status="fulfilled",A.value=p;for(var R=0;R<_.length;R++)(0,_[R])(p)},function(R){for(A.status="rejected",A.reason=R,R=0;R<_.length;R++)(0,_[R])(void 0)}),A}function Pt(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Qt(d,p){d=d.updateQueue,p.updateQueue===d&&(p.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,callbacks:null})}function Xe(d){return{lane:d,tag:0,payload:null,callback:null,next:null}}function Qe(d,p,_){var A=d.updateQueue;if(A===null)return null;if(A=A.shared,Bi&2){var R=A.pending;return R===null?p.next=p:(p.next=R.next,R.next=p),A.pending=p,p=zt(d),Z(d,null,_),p}return ke(d,A,p,_),zt(d)}function Et(d,p,_){if(p=p.updateQueue,p!==null&&(p=p.shared,(_&4194176)!==0)){var A=p.lanes;A&=d.pendingLanes,_|=A,p.lanes=_,V(d,_)}}function ee(d,p){var _=d.updateQueue,A=d.alternate;if(A!==null&&(A=A.updateQueue,_===A)){var R=null,L=null;if(_=_.firstBaseUpdate,_!==null){do{var q={lane:_.lane,tag:_.tag,payload:_.payload,callback:null,next:null};L===null?R=L=q:L=L.next=q,_=_.next}while(_!==null);L===null?R=L=p:L=L.next=p}else R=L=p;_={baseState:A.baseState,firstBaseUpdate:R,lastBaseUpdate:L,shared:A.shared,callbacks:A.callbacks},d.updateQueue=_;return}d=_.lastBaseUpdate,d===null?_.firstBaseUpdate=p:d.next=p,_.lastBaseUpdate=p}function me(){if(NR){var d=Yg;if(d!==null)throw d}}function Me(d,p,_,A){NR=!1;var R=d.updateQueue;ed=!1;var L=R.firstBaseUpdate,q=R.lastBaseUpdate,oe=R.shared.pending;if(oe!==null){R.shared.pending=null;var ve=oe,je=ve.next;ve.next=null,q===null?L=je:q.next=je,q=ve;var bt=d.alternate;bt!==null&&(bt=bt.updateQueue,oe=bt.lastBaseUpdate,oe!==q&&(oe===null?bt.firstBaseUpdate=je:oe.next=je,bt.lastBaseUpdate=ve))}if(L!==null){var kt=R.baseState;q=0,bt=je=ve=null,oe=L;do{var Xt=oe.lane&-536870913,An=Xt!==oe.lane;if(An?(Zn&Xt)===Xt:(A&Xt)===Xt){Xt!==0&&Xt===jg&&(NR=!0),bt!==null&&(bt=bt.next={lane:0,tag:oe.tag,payload:oe.payload,callback:null,next:null});e:{var gl=d,p_=oe;Xt=p;var Cp=_;switch(p_.tag){case 1:if(gl=p_.payload,typeof gl=="function"){kt=gl.call(Cp,kt,Xt);break e}kt=gl;break e;case 3:gl.flags=gl.flags&-65537|128;case 0:if(gl=p_.payload,Xt=typeof gl=="function"?gl.call(Cp,kt,Xt):gl,Xt==null)break e;kt=cR({},kt,Xt);break e;case 2:ed=!0}}Xt=oe.callback,Xt!==null&&(d.flags|=64,An&&(d.flags|=8192),An=R.callbacks,An===null?R.callbacks=[Xt]:An.push(Xt))}else An={lane:Xt,tag:oe.tag,payload:oe.payload,callback:oe.callback,next:null},bt===null?(je=bt=An,ve=kt):bt=bt.next=An,q|=Xt;if(oe=oe.next,oe===null){if(oe=R.shared.pending,oe===null)break;An=oe,oe=An.next,An.next=null,R.lastBaseUpdate=An,R.shared.pending=null}}while(!0);bt===null&&(ve=kt),R.baseState=ve,R.firstBaseUpdate=je,R.lastBaseUpdate=bt,L===null&&(R.shared.lanes=0),id|=q,d.lanes=q,d.memoizedState=kt}}function Q(d,p){if(typeof d!="function")throw Error(s(191,d));d.call(p)}function pe(d,p){var _=d.callbacks;if(_!==null)for(d.callbacks=null,d=0;d<_.length;d++)Q(_[d],p)}function He(d,p){if(Mo(d,p))return!0;if(typeof d!="object"||d===null||typeof p!="object"||p===null)return!1;var _=Object.keys(d),A=Object.keys(p);if(_.length!==A.length)return!1;for(A=0;A<_.length;A++){var R=_[A];if(!U$.call(p,R)||!Mo(d[R],p[R]))return!1}return!0}function it(d){return d=d.status,d==="fulfilled"||d==="rejected"}function qe(){}function We(d,p,_){switch(_=d[_],_===void 0?d.push(p):_!==p&&(p.then(qe,qe),p=_),p.status){case"fulfilled":return p.value;case"rejected":throw d=p.reason,d===a_?Error(s(483)):d;default:if(typeof p.status=="string")p.then(qe,qe);else{if(d=Hi,d!==null&&100<d.shellSuspendCounter)throw Error(s(482));d=p,d.status="pending",d.then(function(A){if(p.status==="pending"){var R=p;R.status="fulfilled",R.value=A}},function(A){if(p.status==="pending"){var R=p;R.status="rejected",R.reason=A}})}switch(p.status){case"fulfilled":return p.value;case"rejected":throw d=p.reason,d===a_?Error(s(483)):d}throw Kg=p,a_}}function lt(){if(Kg===null)throw Error(s(459));var d=Kg;return Kg=null,d}function Dt(d){var p=o_;return o_+=1,Zg===null&&(Zg=[]),We(Zg,d,p)}function mn(d,p){p=p.props.ref,d.ref=p!==void 0?p:null}function xn(d,p){throw p.$$typeof===lQ?Error(s(525)):(d=Object.prototype.toString.call(p),Error(s(31,d==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":d)))}function Oi(d){var p=d._init;return p(d._payload)}function Vi(d){function p(Ce,ye){if(d){var Le=Ce.deletions;Le===null?(Ce.deletions=[ye],Ce.flags|=16):Le.push(ye)}}function _(Ce,ye){if(!d)return null;for(;ye!==null;)p(Ce,ye),ye=ye.sibling;return null}function A(Ce){for(var ye=new Map;Ce!==null;)Ce.key!==null?ye.set(Ce.key,Ce):ye.set(Ce.index,Ce),Ce=Ce.sibling;return ye}function R(Ce,ye){return Ce=Kh(Ce,ye),Ce.index=0,Ce.sibling=null,Ce}function L(Ce,ye,Le){return Ce.index=Le,d?(Le=Ce.alternate,Le!==null?(Le=Le.index,Le<ye?(Ce.flags|=33554434,ye):Le):(Ce.flags|=33554434,ye)):(Ce.flags|=1048576,ye)}function q(Ce){return d&&Ce.alternate===null&&(Ce.flags|=33554434),Ce}function oe(Ce,ye,Le,xt){return ye===null||ye.tag!==6?(ye=aR(Le,Ce.mode,xt),ye.return=Ce,ye):(ye=R(ye,Le),ye.return=Ce,ye)}function ve(Ce,ye,Le,xt){var cn=Le.type;return cn===Fg?bt(Ce,ye,Le.props.children,xt,Le.key):ye!==null&&(ye.elementType===cn||typeof cn=="object"&&cn!==null&&cn.$$typeof===Jh&&Oi(cn)===ye.type)?(ye=R(ye,Le.props),mn(ye,Le),ye.return=Ce,ye):(ye=ST(Le.type,Le.key,Le.props,null,Ce.mode,xt),mn(ye,Le),ye.return=Ce,ye)}function je(Ce,ye,Le,xt){return ye===null||ye.tag!==4||ye.stateNode.containerInfo!==Le.containerInfo||ye.stateNode.implementation!==Le.implementation?(ye=oR(Le,Ce.mode,xt),ye.return=Ce,ye):(ye=R(ye,Le.children||[]),ye.return=Ce,ye)}function bt(Ce,ye,Le,xt,cn){return ye===null||ye.tag!==7?(ye=mp(Le,Ce.mode,xt,cn),ye.return=Ce,ye):(ye=R(ye,Le),ye.return=Ce,ye)}function kt(Ce,ye,Le){if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return ye=aR(""+ye,Ce.mode,Le),ye.return=Ce,ye;if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case TT:return Le=ST(ye.type,ye.key,ye.props,null,Ce.mode,Le),mn(Le,ye),Le.return=Ce,Le;case Og:return ye=oR(ye,Ce.mode,Le),ye.return=Ce,ye;case Jh:var xt=ye._init;return ye=xt(ye._payload),kt(Ce,ye,Le)}if(AT(ye)||r(ye))return ye=mp(ye,Ce.mode,Le,null),ye.return=Ce,ye;if(typeof ye.then=="function")return kt(Ce,Dt(ye),Le);if(ye.$$typeof===Zh)return kt(Ce,gT(Ce,ye),Le);xn(Ce,ye)}return null}function Xt(Ce,ye,Le,xt){var cn=ye!==null?ye.key:null;if(typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint")return cn!==null?null:oe(Ce,ye,""+Le,xt);if(typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case TT:return Le.key===cn?ve(Ce,ye,Le,xt):null;case Og:return Le.key===cn?je(Ce,ye,Le,xt):null;case Jh:return cn=Le._init,Le=cn(Le._payload),Xt(Ce,ye,Le,xt)}if(AT(Le)||r(Le))return cn!==null?null:bt(Ce,ye,Le,xt,null);if(typeof Le.then=="function")return Xt(Ce,ye,Dt(Le),xt);if(Le.$$typeof===Zh)return Xt(Ce,ye,gT(Ce,Le),xt);xn(Ce,Le)}return null}function An(Ce,ye,Le,xt,cn){if(typeof xt=="string"&&xt!==""||typeof xt=="number"||typeof xt=="bigint")return Ce=Ce.get(Le)||null,oe(ye,Ce,""+xt,cn);if(typeof xt=="object"&&xt!==null){switch(xt.$$typeof){case TT:return Ce=Ce.get(xt.key===null?Le:xt.key)||null,ve(ye,Ce,xt,cn);case Og:return Ce=Ce.get(xt.key===null?Le:xt.key)||null,je(ye,Ce,xt,cn);case Jh:var ji=xt._init;return xt=ji(xt._payload),An(Ce,ye,Le,xt,cn)}if(AT(xt)||r(xt))return Ce=Ce.get(Le)||null,bt(ye,Ce,xt,cn,null);if(typeof xt.then=="function")return An(Ce,ye,Le,Dt(xt),cn);if(xt.$$typeof===Zh)return An(Ce,ye,Le,gT(ye,xt),cn);xn(ye,xt)}return null}function gl(Ce,ye,Le,xt){for(var cn=null,ji=null,vn=ye,ri=ye=0,_r=null;vn!==null&&ri<Le.length;ri++){vn.index>ri?(_r=vn,vn=null):_r=vn.sibling;var ai=Xt(Ce,vn,Le[ri],xt);if(ai===null){vn===null&&(vn=_r);break}d&&vn&&ai.alternate===null&&p(Ce,vn),ye=L(ai,ye,ri),ji===null?cn=ai:ji.sibling=ai,ji=ai,vn=_r}if(ri===Le.length)return _(Ce,vn),si&&ne(Ce,ri),cn;if(vn===null){for(;ri<Le.length;ri++)vn=kt(Ce,Le[ri],xt),vn!==null&&(ye=L(vn,ye,ri),ji===null?cn=vn:ji.sibling=vn,ji=vn);return si&&ne(Ce,ri),cn}for(vn=A(vn);ri<Le.length;ri++)_r=An(vn,Ce,ri,Le[ri],xt),_r!==null&&(d&&_r.alternate!==null&&vn.delete(_r.key===null?ri:_r.key),ye=L(_r,ye,ri),ji===null?cn=_r:ji.sibling=_r,ji=_r);return d&&vn.forEach(function(rd){return p(Ce,rd)}),si&&ne(Ce,ri),cn}function p_(Ce,ye,Le,xt){if(Le==null)throw Error(s(151));for(var cn=null,ji=null,vn=ye,ri=ye=0,_r=null,ai=Le.next();vn!==null&&!ai.done;ri++,ai=Le.next()){vn.index>ri?(_r=vn,vn=null):_r=vn.sibling;var rd=Xt(Ce,vn,ai.value,xt);if(rd===null){vn===null&&(vn=_r);break}d&&vn&&rd.alternate===null&&p(Ce,vn),ye=L(rd,ye,ri),ji===null?cn=rd:ji.sibling=rd,ji=rd,vn=_r}if(ai.done)return _(Ce,vn),si&&ne(Ce,ri),cn;if(vn===null){for(;!ai.done;ri++,ai=Le.next())ai=kt(Ce,ai.value,xt),ai!==null&&(ye=L(ai,ye,ri),ji===null?cn=ai:ji.sibling=ai,ji=ai);return si&&ne(Ce,ri),cn}for(vn=A(vn);!ai.done;ri++,ai=Le.next())ai=An(vn,Ce,ri,ai.value,xt),ai!==null&&(d&&ai.alternate!==null&&vn.delete(ai.key===null?ri:ai.key),ye=L(ai,ye,ri),ji===null?cn=ai:ji.sibling=ai,ji=ai);return d&&vn.forEach(function(V$){return p(Ce,V$)}),si&&ne(Ce,ri),cn}function Cp(Ce,ye,Le,xt){if(typeof Le=="object"&&Le!==null&&Le.type===Fg&&Le.key===null&&(Le=Le.props.children),typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case TT:e:{for(var cn=Le.key;ye!==null;){if(ye.key===cn){if(cn=Le.type,cn===Fg){if(ye.tag===7){_(Ce,ye.sibling),xt=R(ye,Le.props.children),xt.return=Ce,Ce=xt;break e}}else if(ye.elementType===cn||typeof cn=="object"&&cn!==null&&cn.$$typeof===Jh&&Oi(cn)===ye.type){_(Ce,ye.sibling),xt=R(ye,Le.props),mn(xt,Le),xt.return=Ce,Ce=xt;break e}_(Ce,ye);break}else p(Ce,ye);ye=ye.sibling}Le.type===Fg?(xt=mp(Le.props.children,Ce.mode,xt,Le.key),xt.return=Ce,Ce=xt):(xt=ST(Le.type,Le.key,Le.props,null,Ce.mode,xt),mn(xt,Le),xt.return=Ce,Ce=xt)}return q(Ce);case Og:e:{for(cn=Le.key;ye!==null;){if(ye.key===cn)if(ye.tag===4&&ye.stateNode.containerInfo===Le.containerInfo&&ye.stateNode.implementation===Le.implementation){_(Ce,ye.sibling),xt=R(ye,Le.children||[]),xt.return=Ce,Ce=xt;break e}else{_(Ce,ye);break}else p(Ce,ye);ye=ye.sibling}xt=oR(Le,Ce.mode,xt),xt.return=Ce,Ce=xt}return q(Ce);case Jh:return cn=Le._init,Le=cn(Le._payload),Cp(Ce,ye,Le,xt)}if(AT(Le))return gl(Ce,ye,Le,xt);if(r(Le)){if(cn=r(Le),typeof cn!="function")throw Error(s(150));return Le=cn.call(Le),p_(Ce,ye,Le,xt)}if(typeof Le.then=="function")return Cp(Ce,ye,Dt(Le),xt);if(Le.$$typeof===Zh)return Cp(Ce,ye,gT(Ce,Le),xt);xn(Ce,Le)}return typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint"?(Le=""+Le,ye!==null&&ye.tag===6?(_(Ce,ye.sibling),xt=R(ye,Le),xt.return=Ce,Ce=xt):(_(Ce,ye),xt=aR(Le,Ce.mode,xt),xt.return=Ce,Ce=xt),q(Ce)):_(Ce,ye)}return function(Ce,ye,Le,xt){try{o_=0;var cn=Cp(Ce,ye,Le,xt);return Zg=null,cn}catch(vn){if(vn===a_)throw vn;var ji=t(29,vn,null,Ce.mode);return ji.lanes=xt,ji.return=Ce,ji}finally{}}}function ea(d,p){d=Iu,b(IT,d),b(Jg,p),Iu=d|p.baseLanes}function ta(){b(IT,Iu),b(Jg,Jg.current)}function Cs(){Iu=IT.current,y(Jg),y(IT)}function gr(d){var p=d.alternate;b(sr,sr.current&1),b(pl,d),Rc===null&&(p===null||Jg.current!==null||p.memoizedState!==null)&&(Rc=d)}function Qi(d){if(d.tag===22){if(b(sr,sr.current),b(pl,d),Rc===null){var p=d.alternate;p!==null&&p.memoizedState!==null&&(Rc=d)}}else ws()}function ws(){b(sr,sr.current),b(pl,pl.current)}function sn(d){y(pl),Rc===d&&(Rc=null),y(sr)}function na(d){for(var p=d;p!==null;){if(p.tag===13){var _=p.memoizedState;if(_!==null&&(_=_.dehydrated,_===null||_R(_)||vR(_)))return p}else if(p.tag===19&&p.memoizedProps.revealOrder!==void 0){if(p.flags&128)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}function Ri(){throw Error(s(321))}function O(d,p){if(p===null)return!1;for(var _=0;_<p.length&&_<d.length;_++)if(!Mo(d[_],p[_]))return!1;return!0}function j(d,p,_,A,R,L){return td=L,Dn=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,Sn.H=d===null||d.memoizedState===null?bp:nd,vp=!1,L=_(A,R),vp=!1,Qg&&(L=Ee(p,_,A,R)),ce(d),L}function ce(d){Sn.H=Nc;var p=Ni!==null&&Ni.next!==null;if(td=0,ks=Ni=Dn=null,PT=!1,l_=0,$g=null,p)throw Error(s(300));d===null||yr||(d=d.dependencies,d!==null&&mT(d)&&(yr=!0))}function Ee(d,p,_,A){Dn=d;var R=0;do{if(Qg&&($g=null),l_=0,Qg=!1,25<=R)throw Error(s(301));if(R+=1,ks=Ni=null,d.updateQueue!=null){var L=d.updateQueue;L.lastEffect=null,L.events=null,L.stores=null,L.memoCache!=null&&(L.memoCache.index=0)}Sn.H=Sp,L=p(_,A)}while(Qg);return L}function Ge(){var d=Sn.H,p=d.useState()[0];return p=typeof p.then=="function"?Tt(p):p,d=d.useState()[0],(Ni!==null?Ni.memoizedState:null)!==d&&(Dn.flags|=1024),p}function Pe(){var d=OT!==0;return OT=0,d}function yt(d,p,_){p.updateQueue=d.updateQueue,p.flags&=-2053,d.lanes&=~_}function ft(d){if(PT){for(d=d.memoizedState;d!==null;){var p=d.queue;p!==null&&(p.pending=null),d=d.next}PT=!1}td=0,ks=Ni=Dn=null,Qg=!1,l_=OT=0,$g=null}function pt(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ks===null?Dn.memoizedState=ks=d:ks=ks.next=d,ks}function ct(){if(Ni===null){var d=Dn.alternate;d=d!==null?d.memoizedState:null}else d=Ni.next;var p=ks===null?Dn.memoizedState:ks.next;if(p!==null)ks=p,Ni=d;else{if(d===null)throw Dn.alternate===null?Error(s(467)):Error(s(310));Ni=d,d={memoizedState:Ni.memoizedState,baseState:Ni.baseState,baseQueue:Ni.baseQueue,queue:Ni.queue,next:null},ks===null?Dn.memoizedState=ks=d:ks=ks.next=d}return ks}function Tt(d){var p=l_;return l_+=1,$g===null&&($g=[]),d=We($g,d,p),p=Dn,(ks===null?p.memoizedState:ks.next)===null&&(p=p.alternate,Sn.H=p===null||p.memoizedState===null?bp:nd),d}function vt(d){if(d!==null&&typeof d=="object"){if(typeof d.then=="function")return Tt(d);if(d.$$typeof===Zh)return sa(d)}throw Error(s(438,String(d)))}function k(d){var p=null,_=Dn.updateQueue;if(_!==null&&(p=_.memoCache),p==null){var A=Dn.alternate;A!==null&&(A=A.updateQueue,A!==null&&(A=A.memoCache,A!=null&&(p={data:A.data.map(function(R){return R.slice()}),index:0})))}if(p==null&&(p={data:[],index:0}),_===null&&(_=DR(),Dn.updateQueue=_),_.memoCache=p,_=p.data[p.index],_===void 0)for(_=p.data[p.index]=Array(d),A=0;A<d;A++)_[A]=uQ;return p.index++,_}function ie(d,p){return typeof p=="function"?p(d):p}function de(d){var p=ct();return fe(p,Ni,d)}function fe(d,p,_){var A=d.queue;if(A===null)throw Error(s(311));A.lastRenderedReducer=_;var R=d.baseQueue,L=A.pending;if(L!==null){if(R!==null){var q=R.next;R.next=L.next,L.next=q}p.baseQueue=R=L,A.pending=null}if(L=d.baseState,R===null)d.memoizedState=L;else{p=R.next;var oe=q=null,ve=null,je=p,bt=!1;do{var kt=je.lane&-536870913;if(kt!==je.lane?(Zn&kt)===kt:(td&kt)===kt){var Xt=je.revertLane;if(Xt===0)ve!==null&&(ve=ve.next={lane:0,revertLane:0,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null}),kt===jg&&(bt=!0);else if((td&Xt)===Xt){je=je.next,Xt===jg&&(bt=!0);continue}else kt={lane:0,revertLane:je.revertLane,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null},ve===null?(oe=ve=kt,q=L):ve=ve.next=kt,Dn.lanes|=Xt,id|=Xt;kt=je.action,vp&&_(L,kt),L=je.hasEagerState?je.eagerState:_(L,kt)}else Xt={lane:kt,revertLane:je.revertLane,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null},ve===null?(oe=ve=Xt,q=L):ve=ve.next=Xt,Dn.lanes|=kt,id|=kt;je=je.next}while(je!==null&&je!==p);if(ve===null?q=L:ve.next=oe,!Mo(L,d.memoizedState)&&(yr=!0,bt&&(_=Yg,_!==null)))throw _;d.memoizedState=L,d.baseState=q,d.baseQueue=ve,A.lastRenderedState=L}return R===null&&(A.lanes=0),[d.memoizedState,A.dispatch]}function he(d){var p=ct(),_=p.queue;if(_===null)throw Error(s(311));_.lastRenderedReducer=d;var A=_.dispatch,R=_.pending,L=p.memoizedState;if(R!==null){_.pending=null;var q=R=R.next;do L=d(L,q.action),q=q.next;while(q!==R);Mo(L,p.memoizedState)||(yr=!0),p.memoizedState=L,p.baseQueue===null&&(p.baseState=L),_.lastRenderedState=L}return[L,A]}function rt(d,p,_){var A=Dn,R=ct(),L=si;if(L){if(_===void 0)throw Error(s(407));_=_()}else _=p();var q=!Mo((Ni||R).memoizedState,_);if(q&&(R.memoizedState=_,yr=!0),R=R.queue,Ql(Rt.bind(null,A,R,d),[d]),R.getSnapshot!==p||q||ks!==null&&ks.memoizedState.tag&1){if(A.flags|=2048,Rs(9,gt.bind(null,A,R,_,p),{destroy:void 0},null),Hi===null)throw Error(s(349));L||td&60||mt(A,p,_)}return _}function mt(d,p,_){d.flags|=16384,d={getSnapshot:p,value:_},p=Dn.updateQueue,p===null?(p=DR(),Dn.updateQueue=p,p.stores=[d]):(_=p.stores,_===null?p.stores=[d]:_.push(d))}function gt(d,p,_,A){p.value=_,p.getSnapshot=A,At(p)&&$t(d)}function Rt(d,p,_){return _(function(){At(p)&&$t(d)})}function At(d){var p=d.getSnapshot;d=d.value;try{var _=p();return!Mo(d,_)}catch{return!0}}function $t(d){var p=at(d,2);p!==null&&Ea(p,d,2)}function Nt(d){var p=pt();if(typeof d=="function"){var _=d;if(d=_(),vp){X(!0);try{_()}finally{X(!1)}}}return p.memoizedState=p.baseState=d,p.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ie,lastRenderedState:d},p}function tn(d,p,_,A){return d.baseState=_,fe(d,Ni,typeof A=="function"?A:ie)}function Cn(d,p,_,A,R){if(fT(d))throw Error(s(485));if(d=p.action,d!==null){var L={payload:R,action:d,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(q){L.listeners.push(q)}};Sn.T!==null?_(!0):L.isTransition=!1,A(L),_=p.pending,_===null?(L.next=p.pending=L,di(p,L)):(L.next=_.next,p.pending=_.next=L)}}function di(d,p){var _=p.action,A=p.payload,R=d.state;if(p.isTransition){var L=Sn.T,q={};Sn.T=q;try{var oe=_(R,A),ve=Sn.S;ve!==null&&ve(q,oe),Pn(d,p,oe)}catch(je){Ht(d,p,je)}finally{Sn.T=L}}else try{L=_(R,A),Pn(d,p,L)}catch(je){Ht(d,p,je)}}function Pn(d,p,_){_!==null&&typeof _=="object"&&typeof _.then=="function"?_.then(function(A){nn(d,p,A)},function(A){return Ht(d,p,A)}):nn(d,p,_)}function nn(d,p,_){p.status="fulfilled",p.value=_,rn(p),d.state=_,p=d.pending,p!==null&&(_=p.next,_===p?d.pending=null:(_=_.next,p.next=_,di(d,_)))}function Ht(d,p,_){var A=d.pending;if(d.pending=null,A!==null){A=A.next;do p.status="rejected",p.reason=_,rn(p),p=p.next;while(p!==A)}d.action=null}function rn(d){d=d.listeners;for(var p=0;p<d.length;p++)(0,d[p])()}function Zt(d,p){return p}function Ti(d,p){if(si){var _=Hi.formState;if(_!==null){e:{var A=Dn;if(si){if(oa){var R=t$(oa,wc);if(R){oa=TG(R),A=n$(R);break e}}tt(A)}A=!1}A&&(p=_[0])}}_=pt(),_.memoizedState=_.baseState=p,A={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zt,lastRenderedState:p},_.queue=A,_=YO.bind(null,Dn,A),A.dispatch=_,A=Nt(!1);var L=Ew.bind(null,Dn,!1,A.queue);return A=pt(),R={state:p,dispatch:null,action:d,pending:null},A.queue=R,_=Cn.bind(null,Dn,R,L,_),R.dispatch=_,A.memoizedState=d,[p,_,!1]}function Pr(d){var p=ct();return xi(p,Ni,d)}function xi(d,p,_){p=fe(d,p,Zt)[0],d=de(ie)[0],p=typeof p=="object"&&p!==null&&typeof p.then=="function"?Tt(p):p;var A=ct(),R=A.queue,L=R.dispatch;return _!==A.memoizedState&&(Dn.flags|=2048,Rs(9,ia.bind(null,R,_),{destroy:void 0},null)),[p,L,d]}function ia(d,p){d.action=p}function Ai(d){var p=ct(),_=Ni;if(_!==null)return xi(p,_,d);ct(),p=p.memoizedState,_=ct();var A=_.queue.dispatch;return _.memoizedState=d,[p,A,!1]}function Rs(d,p,_,A){return d={tag:d,create:p,inst:_,deps:A,next:null},p=Dn.updateQueue,p===null&&(p=DR(),Dn.updateQueue=p),_=p.lastEffect,_===null?p.lastEffect=d.next=d:(A=_.next,_.next=d,d.next=A,p.lastEffect=d),d}function Ma(){return ct().memoizedState}function Hs(d,p,_,A){var R=pt();Dn.flags|=d,R.memoizedState=Rs(1|p,_,{destroy:void 0},A===void 0?null:A)}function ir(d,p,_,A){var R=ct();A=A===void 0?null:A;var L=R.memoizedState.inst;Ni!==null&&A!==null&&O(A,Ni.memoizedState.deps)?R.memoizedState=Rs(p,_,L,A):(Dn.flags|=d,R.memoizedState=Rs(1|p,_,L,A))}function Dg(d,p){Hs(8390656,8,d,p)}function Ql(d,p){ir(2048,8,d,p)}function OO(d,p){return ir(4,2,d,p)}function FO(d,p){return ir(4,4,d,p)}function GO(d,p){if(typeof p=="function"){d=d();var _=p(d);return function(){typeof _=="function"?_():p(null)}}if(p!=null)return d=d(),p.current=d,function(){p.current=null}}function zO(d,p,_){_=_!=null?_.concat([d]):null,ir(4,4,GO.bind(null,p,d),_)}function Tw(){}function VO(d,p){var _=ct();p=p===void 0?null:p;var A=_.memoizedState;return p!==null&&O(p,A[1])?A[0]:(_.memoizedState=[d,p],d)}function HO(d,p){var _=ct();p=p===void 0?null:p;var A=_.memoizedState;if(p!==null&&O(p,A[1]))return A[0];if(A=d(),vp){X(!0);try{d()}finally{X(!1)}}return _.memoizedState=[A,p],A}function Aw(d,p,_){return _===void 0||td&1073741824?d.memoizedState=p:(d.memoizedState=_,d=FF(),Dn.lanes|=d,id|=d,_)}function kO(d,p,_,A){return Mo(_,p)?_:Jg.current!==null?(d=Aw(d,_,A),Mo(d,p)||(yr=!0),d):td&42?(d=FF(),Dn.lanes|=d,id|=d,p):(yr=!0,d.memoizedState=_)}function WO(d,p,_,A,R){var L=gp();$a(L!==0&&8>L?L:8);var q=Sn.T,oe={};Sn.T=oe,Ew(d,!1,p,_);try{var ve=R(),je=Sn.S;if(je!==null&&je(oe,ve),ve!==null&&typeof ve=="object"&&typeof ve.then=="function"){var bt=dt(ve,A);qx(d,p,bt,bo(d))}else qx(d,p,A,bo(d))}catch(kt){qx(d,p,{then:function(){},status:"rejected",reason:kt},bo())}finally{$a(L),Sn.T=q}}function XO(d){var p=d.memoizedState;if(p!==null)return p;p={memoizedState:Gg,baseState:Gg,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ie,lastRenderedState:Gg},next:null};var _={};return p.next={memoizedState:_,baseState:_,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ie,lastRenderedState:_},next:null},d.memoizedState=p,d=d.alternate,d!==null&&(d.memoizedState=p),p}function Mw(){return sa(yp)}function qO(){return ct().memoizedState}function jO(){return ct().memoizedState}function HJ(d){for(var p=d.return;p!==null;){switch(p.tag){case 24:case 3:var _=bo();d=Xe(_);var A=Qe(p,d,_);A!==null&&(Ea(A,p,_),Et(A,p,_)),p={cache:Gw()},d.payload=p;return}p=p.return}}function kJ(d,p,_){var A=bo();_={lane:A,revertLane:0,action:_,hasEagerState:!1,eagerState:null,next:null},fT(d)?KO(p,_):(_=Ve(d,p,_,A),_!==null&&(Ea(_,d,A),ZO(_,p,A)))}function YO(d,p,_){var A=bo();qx(d,p,_,A)}function qx(d,p,_,A){var R={lane:A,revertLane:0,action:_,hasEagerState:!1,eagerState:null,next:null};if(fT(d))KO(p,R);else{var L=d.alternate;if(d.lanes===0&&(L===null||L.lanes===0)&&(L=p.lastRenderedReducer,L!==null))try{var q=p.lastRenderedState,oe=L(q,_);if(R.hasEagerState=!0,R.eagerState=oe,Mo(oe,q))return ke(d,p,R,0),Hi===null&&Ie(),!1}catch{}finally{}if(_=Ve(d,p,R,A),_!==null)return Ea(_,d,A),ZO(_,p,A),!0}return!1}function Ew(d,p,_,A){if(A={lane:2,revertLane:ze(),action:A,hasEagerState:!1,eagerState:null,next:null},fT(d)){if(p)throw Error(s(479))}else p=Ve(d,_,A,2),p!==null&&Ea(p,d,2)}function fT(d){var p=d.alternate;return d===Dn||p!==null&&p===Dn}function KO(d,p){Qg=PT=!0;var _=d.pending;_===null?p.next=p:(p.next=_.next,_.next=p),d.pending=p}function ZO(d,p,_){if(_&4194176){var A=p.lanes;A&=d.pendingLanes,_|=A,p.lanes=_,V(d,_)}}function Cw(d,p,_,A){p=d.memoizedState,_=_(A,p),_=_==null?p:cR({},p,_),d.memoizedState=_,d.lanes===0&&(d.updateQueue.baseState=_)}function JO(d,p,_,A,R,L,q){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(A,L,q):p.prototype&&p.prototype.isPureReactComponent?!He(_,A)||!He(R,L):!0}function QO(d,p,_,A){d=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(_,A),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(_,A),p.state!==d&&LR.enqueueReplaceState(p,p.state,null)}function up(d,p){var _=p;if("ref"in p){_={};for(var A in p)A!=="ref"&&(_[A]=p[A])}if(d=d.defaultProps){_===p&&(_=cR({},_));for(var R in d)_[R]===void 0&&(_[R]=d[R])}return _}function pT(d,p){try{var _=d.onUncaughtError;_(p.value,{componentStack:p.stack})}catch(A){setTimeout(function(){throw A})}}function $O(d,p,_){try{var A=d.onCaughtError;A(_.value,{componentStack:_.stack,errorBoundary:p.tag===1?p.stateNode:null})}catch(R){setTimeout(function(){throw R})}}function ww(d,p,_){return _=Xe(_),_.tag=3,_.payload={element:null},_.callback=function(){pT(d,p)},_}function eF(d){return d=Xe(d),d.tag=3,d}function tF(d,p,_,A){var R=_.type.getDerivedStateFromError;if(typeof R=="function"){var L=A.value;d.payload=function(){return R(L)},d.callback=function(){$O(p,_,A)}}var q=_.stateNode;q!==null&&typeof q.componentDidCatch=="function"&&(d.callback=function(){$O(p,_,A),typeof R!="function"&&(sd===null?sd=new Set([this]):sd.add(this));var oe=A.stack;this.componentDidCatch(A.value,{componentStack:oe!==null?oe:""})})}function WJ(d,p,_,A,R){if(_.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){if(p=_.alternate,p!==null&&Yx(p,_,R,!0),_=pl.current,_!==null){switch(_.tag){case 13:return Rc===null?nR():_.alternate===null&&xs===0&&(xs=3),_.flags&=-257,_.flags|=65536,_.lanes=R,A===UT?_.flags|=16384:(p=_.updateQueue,p===null?_.updateQueue=new Set([A]):p.add(A),sR(d,A,R)),!1;case 22:return _.flags|=65536,A===UT?_.flags|=16384:(p=_.updateQueue,p===null?(p={transitions:null,markerInstances:null,retryQueue:new Set([A])},_.updateQueue=p):(_=p.retryQueue,_===null?p.retryQueue=new Set([A]):_.add(A)),sR(d,A,R)),!1}throw Error(s(435,_.tag))}return sR(d,A,R),nR(),!1}if(si)return p=pl.current,p!==null?(!(p.flags&65536)&&(p.flags|=256),p.flags|=65536,p.lanes=R,A!==MR&&(d=Error(s(422),{cause:A}),Mt(re(d,_)))):(A!==MR&&(p=Error(s(423),{cause:A}),Mt(re(p,_))),d=d.current.alternate,d.flags|=65536,R&=-R,d.lanes|=R,A=re(A,_),R=ww(d.stateNode,A,R),ee(d,R),xs!==4&&(xs=2)),!1;var L=Error(s(520),{cause:A});if(L=re(L,_),u_===null?u_=[L]:u_.push(L),xs!==4&&(xs=2),p===null)return!0;A=re(A,_),_=p;do{switch(_.tag){case 3:return _.flags|=65536,d=R&-R,_.lanes|=d,d=ww(_.stateNode,A,d),ee(_,d),!1;case 1:if(p=_.type,L=_.stateNode,(_.flags&128)===0&&(typeof p.getDerivedStateFromError=="function"||L!==null&&typeof L.componentDidCatch=="function"&&(sd===null||!sd.has(L))))return _.flags|=65536,R&=-R,_.lanes|=R,R=eF(R),tF(R,d,_,A),ee(_,R),!1}_=_.return}while(_!==null);return!1}function Or(d,p,_,A){p.child=d===null?OG(p,null,_,A):_p(p,d.child,_,A)}function nF(d,p,_,A,R){_=_.render;var L=p.ref;if("ref"in A){var q={};for(var oe in A)oe!=="ref"&&(q[oe]=A[oe])}else q=A;return hp(p),A=j(d,p,_,q,L,R),oe=Pe(),d!==null&&!yr?(yt(d,p,R),Mu(d,p,R)):(si&&oe&&Te(p),p.flags|=1,Or(d,p,A,R),p.child)}function iF(d,p,_,A,R){if(d===null){var L=_.type;return typeof L=="function"&&!rR(L)&&L.defaultProps===void 0&&_.compare===null?(p.tag=15,p.type=L,sF(d,p,L,A,R)):(d=ST(_.type,null,A,p,p.mode,R),d.ref=p.ref,d.return=p,p.child=d)}if(L=d.child,!Pw(d,R)){var q=L.memoizedProps;if(_=_.compare,_=_!==null?_:He,_(q,A)&&d.ref===p.ref)return Mu(d,p,R)}return p.flags|=1,d=Kh(L,A),d.ref=p.ref,d.return=p,p.child=d}function sF(d,p,_,A,R){if(d!==null){var L=d.memoizedProps;if(He(L,A)&&d.ref===p.ref)if(yr=!1,p.pendingProps=A=L,Pw(d,R))d.flags&131072&&(yr=!0);else return p.lanes=d.lanes,Mu(d,p,R)}return Rw(d,p,_,A,R)}function rF(d,p,_){var A=p.pendingProps,R=A.children,L=(p.stateNode._pendingVisibility&2)!==0,q=d!==null?d.memoizedState:null;if(jx(d,p),A.mode==="hidden"||L){if(p.flags&128){if(A=q!==null?q.baseLanes|_:_,d!==null){for(R=p.child=d.child,L=0;R!==null;)L=L|R.lanes|R.childLanes,R=R.sibling;p.childLanes=L&~A}else p.childLanes=0,p.child=null;return aF(d,p,A,_)}if(_&536870912)p.memoizedState={baseLanes:0,cachePool:null},d!==null&&yT(p,q!==null?q.cachePool:null),q!==null?ea(p,q):ta(),Qi(p);else return p.lanes=p.childLanes=536870912,aF(d,p,q!==null?q.baseLanes|_:_,_)}else q!==null?(yT(p,q.cachePool),ea(p,q),ws(),p.memoizedState=null):(d!==null&&yT(p,null),ta(),ws());return Or(d,p,R,_),p.child}function aF(d,p,_,A){var R=zw();return R=R===null?null:{parent:Ru?gs._currentValue:gs._currentValue2,pool:R},p.memoizedState={baseLanes:_,cachePool:R},d!==null&&yT(p,null),ta(),Qi(p),d!==null&&Yx(d,p,A,!0),null}function jx(d,p){var _=p.ref;if(_===null)d!==null&&d.ref!==null&&(p.flags|=2097664);else{if(typeof _!="function"&&typeof _!="object")throw Error(s(284));(d===null||d.ref!==_)&&(p.flags|=2097664)}}function Rw(d,p,_,A,R){return hp(p),_=j(d,p,_,A,void 0,R),A=Pe(),d!==null&&!yr?(yt(d,p,R),Mu(d,p,R)):(si&&A&&Te(p),p.flags|=1,Or(d,p,_,R),p.child)}function oF(d,p,_,A,R,L){return hp(p),p.updateQueue=null,_=Ee(p,A,_,R),ce(d),A=Pe(),d!==null&&!yr?(yt(d,p,L),Mu(d,p,L)):(si&&A&&Te(p),p.flags|=1,Or(d,p,_,L),p.child)}function lF(d,p,_,A,R){if(hp(p),p.stateNode===null){var L=Vg,q=_.contextType;typeof q=="object"&&q!==null&&(L=sa(q)),L=new _(A,L),p.memoizedState=L.state!==null&&L.state!==void 0?L.state:null,L.updater=LR,p.stateNode=L,L._reactInternals=p,L=p.stateNode,L.props=A,L.state=p.memoizedState,L.refs={},Pt(p),q=_.contextType,L.context=typeof q=="object"&&q!==null?sa(q):Vg,L.state=p.memoizedState,q=_.getDerivedStateFromProps,typeof q=="function"&&(Cw(p,_,q,A),L.state=p.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof L.getSnapshotBeforeUpdate=="function"||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(q=L.state,typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount(),q!==L.state&&LR.enqueueReplaceState(L,L.state,null),Me(p,A,L,R),me(),L.state=p.memoizedState),typeof L.componentDidMount=="function"&&(p.flags|=4194308),A=!0}else if(d===null){L=p.stateNode;var oe=p.memoizedProps,ve=up(_,oe);L.props=ve;var je=L.context,bt=_.contextType;q=Vg,typeof bt=="object"&&bt!==null&&(q=sa(bt));var kt=_.getDerivedStateFromProps;bt=typeof kt=="function"||typeof L.getSnapshotBeforeUpdate=="function",oe=p.pendingProps!==oe,bt||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(oe||je!==q)&&QO(p,L,A,q),ed=!1;var Xt=p.memoizedState;L.state=Xt,Me(p,A,L,R),me(),je=p.memoizedState,oe||Xt!==je||ed?(typeof kt=="function"&&(Cw(p,_,kt,A),je=p.memoizedState),(ve=ed||JO(p,_,ve,A,Xt,je,q))?(bt||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(p.flags|=4194308)):(typeof L.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=A,p.memoizedState=je),L.props=A,L.state=je,L.context=q,A=ve):(typeof L.componentDidMount=="function"&&(p.flags|=4194308),A=!1)}else{L=p.stateNode,Qt(d,p),q=p.memoizedProps,bt=up(_,q),L.props=bt,kt=p.pendingProps,Xt=L.context,je=_.contextType,ve=Vg,typeof je=="object"&&je!==null&&(ve=sa(je)),oe=_.getDerivedStateFromProps,(je=typeof oe=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(q!==kt||Xt!==ve)&&QO(p,L,A,ve),ed=!1,Xt=p.memoizedState,L.state=Xt,Me(p,A,L,R),me();var An=p.memoizedState;q!==kt||Xt!==An||ed||d!==null&&d.dependencies!==null&&mT(d.dependencies)?(typeof oe=="function"&&(Cw(p,_,oe,A),An=p.memoizedState),(bt=ed||JO(p,_,bt,A,Xt,An,ve)||d!==null&&d.dependencies!==null&&mT(d.dependencies))?(je||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(A,An,ve),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(A,An,ve)),typeof L.componentDidUpdate=="function"&&(p.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof L.componentDidUpdate!="function"||q===d.memoizedProps&&Xt===d.memoizedState||(p.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||q===d.memoizedProps&&Xt===d.memoizedState||(p.flags|=1024),p.memoizedProps=A,p.memoizedState=An),L.props=A,L.state=An,L.context=ve,A=bt):(typeof L.componentDidUpdate!="function"||q===d.memoizedProps&&Xt===d.memoizedState||(p.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||q===d.memoizedProps&&Xt===d.memoizedState||(p.flags|=1024),A=!1)}return L=A,jx(d,p),A=(p.flags&128)!==0,L||A?(L=p.stateNode,_=A&&typeof _.getDerivedStateFromError!="function"?null:L.render(),p.flags|=1,d!==null&&A?(p.child=_p(p,d.child,null,R),p.child=_p(p,null,_,R)):Or(d,p,_,R),p.memoizedState=L.state,d=p.child):d=Mu(d,p,R),d}function cF(d,p,_,A){return jt(),p.flags|=256,Or(d,p,_,A),p.child}function Nw(d){return{baseLanes:d,cachePool:mF()}}function Bw(d,p,_){return d=d!==null?d.childLanes&~_:0,p&&(d|=ml),d}function uF(d,p,_){var A=p.pendingProps,R=!1,L=(p.flags&128)!==0,q;if((q=L)||(q=d!==null&&d.memoizedState===null?!1:(sr.current&2)!==0),q&&(R=!0,p.flags&=-129),q=(p.flags&32)!==0,p.flags&=-33,d===null){if(si){if(R?gr(p):ws(),si){var oe=oa,ve;(ve=oe)&&(oe=o$(oe,wc),oe!==null?(p.memoizedState={dehydrated:oe,treeContext:xp!==null?{id:Nu,overflow:Bu}:null,retryLane:536870912},ve=t(18,null,null,0),ve.stateNode=oe,ve.return=p,p.child=ve,Ca=p,oa=null,ve=!0):ve=!1),ve||tt(p)}if(oe=p.memoizedState,oe!==null&&(oe=oe.dehydrated,oe!==null))return vR(oe)?p.lanes=16:p.lanes=536870912,null;sn(p)}return oe=A.children,A=A.fallback,R?(ws(),R=p.mode,oe=Lw({mode:"hidden",children:oe},R),A=mp(A,R,_,null),oe.return=p,A.return=p,oe.sibling=A,p.child=oe,R=p.child,R.memoizedState=Nw(_),R.childLanes=Bw(d,q,_),p.memoizedState=UR,A):(gr(p),Dw(p,oe))}if(ve=d.memoizedState,ve!==null&&(oe=ve.dehydrated,oe!==null)){if(L)p.flags&256?(gr(p),p.flags&=-257,p=Uw(d,p,_)):p.memoizedState!==null?(ws(),p.child=d.child,p.flags|=128,p=null):(ws(),R=A.fallback,oe=p.mode,A=Lw({mode:"visible",children:A.children},oe),R=mp(R,oe,_,null),R.flags|=2,A.return=p,R.return=p,A.sibling=R,p.child=A,_p(p,d.child,null,_),A=p.child,A.memoizedState=Nw(_),A.childLanes=Bw(d,q,_),p.memoizedState=UR,p=R);else if(gr(p),vR(oe))q=$Q(oe).digest,A=Error(s(419)),A.stack="",A.digest=q,Mt({value:A,source:null,stack:null}),p=Uw(d,p,_);else if(yr||Yx(d,p,_,!1),q=(_&d.childLanes)!==0,yr||q){if(q=Hi,q!==null){if(A=_&-_,A&42)A=1;else switch(A){case 2:A=1;break;case 8:A=4;break;case 32:A=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:A=64;break;case 268435456:A=134217728;break;default:A=0}if(A=A&(q.suspendedLanes|_)?0:A,A!==0&&A!==ve.retryLane)throw ve.retryLane=A,at(d,A),Ea(q,d,A),GG}_R(oe)||nR(),p=Uw(d,p,_)}else _R(oe)?(p.flags|=128,p.child=d.child,p=nQ.bind(null,d),e$(oe,p),p=null):(d=ve.treeContext,cl&&(oa=s$(oe),Ca=p,si=!0,tc=null,wc=!1,d!==null&&(hl[dl++]=Nu,hl[dl++]=Bu,hl[dl++]=xp,Nu=d.id,Bu=d.overflow,xp=p)),p=Dw(p,A.children),p.flags|=4096);return p}return R?(ws(),R=A.fallback,oe=p.mode,ve=d.child,L=ve.sibling,A=Kh(ve,{mode:"hidden",children:A.children}),A.subtreeFlags=ve.subtreeFlags&31457280,L!==null?R=Kh(L,R):(R=mp(R,oe,_,null),R.flags|=2),R.return=p,A.return=p,A.sibling=R,p.child=A,A=R,R=p.child,oe=d.child.memoizedState,oe===null?oe=Nw(_):(ve=oe.cachePool,ve!==null?(L=Ru?gs._currentValue:gs._currentValue2,ve=ve.parent!==L?{parent:L,pool:L}:ve):ve=mF(),oe={baseLanes:oe.baseLanes|_,cachePool:ve}),R.memoizedState=oe,R.childLanes=Bw(d,q,_),p.memoizedState=UR,A):(gr(p),_=d.child,d=_.sibling,_=Kh(_,{mode:"visible",children:A.children}),_.return=p,_.sibling=null,d!==null&&(q=p.deletions,q===null?(p.deletions=[d],p.flags|=16):q.push(d)),p.child=_,p.memoizedState=null,_)}function Dw(d,p){return p=Lw({mode:"visible",children:p},d.mode),p.return=d,d.child=p}function Lw(d,p){return eG(d,p,0,null)}function Uw(d,p,_){return _p(p,d.child,null,_),d=Dw(p,p.pendingProps.children),d.flags|=2,p.memoizedState=null,d}function hF(d,p,_){d.lanes|=p;var A=d.alternate;A!==null&&(A.lanes|=p),Ow(d.return,p,_)}function Iw(d,p,_,A,R){var L=d.memoizedState;L===null?d.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:A,tail:_,tailMode:R}:(L.isBackwards=p,L.rendering=null,L.renderingStartTime=0,L.last=A,L.tail=_,L.tailMode=R)}function dF(d,p,_){var A=p.pendingProps,R=A.revealOrder,L=A.tail;if(Or(d,p,A.children,_),A=sr.current,A&2)A=A&1|2,p.flags|=128;else{if(d!==null&&d.flags&128)e:for(d=p.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&hF(d,_,p);else if(d.tag===19)hF(d,_,p);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===p)break e;for(;d.sibling===null;){if(d.return===null||d.return===p)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}A&=1}switch(b(sr,A),R){case"forwards":for(_=p.child,R=null;_!==null;)d=_.alternate,d!==null&&na(d)===null&&(R=_),_=_.sibling;_=R,_===null?(R=p.child,p.child=null):(R=_.sibling,_.sibling=null),Iw(p,!1,R,_,L);break;case"backwards":for(_=null,R=p.child,p.child=null;R!==null;){if(d=R.alternate,d!==null&&na(d)===null){p.child=R;break}d=R.sibling,R.sibling=_,_=R,R=d}Iw(p,!0,_,null,L);break;case"together":Iw(p,!1,null,null,void 0);break;default:p.memoizedState=null}return p.child}function Mu(d,p,_){if(d!==null&&(p.dependencies=d.dependencies),id|=p.lanes,!(_&p.childLanes))if(d!==null){if(Yx(d,p,_,!1),(_&p.childLanes)===0)return null}else return null;if(d!==null&&p.child!==d.child)throw Error(s(153));if(p.child!==null){for(d=p.child,_=Kh(d,d.pendingProps),p.child=_,_.return=p;d.sibling!==null;)d=d.sibling,_=_.sibling=Kh(d,d.pendingProps),_.return=p;_.sibling=null}return p.child}function Pw(d,p){return d.lanes&p?!0:(d=d.dependencies,!!(d!==null&&mT(d)))}function XJ(d,p,_){switch(p.tag){case 3:et(p,p.stateNode.containerInfo),Xh(p,gs,d.memoizedState.cache),jt();break;case 27:case 5:be(p);break;case 4:et(p,p.stateNode.containerInfo);break;case 10:Xh(p,p.type,p.memoizedProps.value);break;case 13:var A=p.memoizedState;if(A!==null)return A.dehydrated!==null?(gr(p),p.flags|=128,null):_&p.child.childLanes?uF(d,p,_):(gr(p),d=Mu(d,p,_),d!==null?d.sibling:null);gr(p);break;case 19:var R=(d.flags&128)!==0;if(A=(_&p.childLanes)!==0,A||(Yx(d,p,_,!1),A=(_&p.childLanes)!==0),R){if(A)return dF(d,p,_);p.flags|=128}if(R=p.memoizedState,R!==null&&(R.rendering=null,R.tail=null,R.lastEffect=null),b(sr,sr.current),A)break;return null;case 22:case 23:return p.lanes=0,rF(d,p,_);case 24:Xh(p,gs,d.memoizedState.cache)}return Mu(d,p,_)}function fF(d,p,_){if(d!==null)if(d.memoizedProps!==p.pendingProps)yr=!0;else{if(!Pw(d,_)&&!(p.flags&128))return yr=!1,XJ(d,p,_);yr=!!(d.flags&131072)}else yr=!1,si&&p.flags&1048576&&ge(p,NT,p.index);switch(p.lanes=0,p.tag){case 16:e:{d=p.pendingProps;var A=p.elementType,R=A._init;if(A=R(A._payload),p.type=A,typeof A=="function")rR(A)?(d=up(A,d),p.tag=1,p=lF(null,p,A,d,_)):(p.tag=0,p=Rw(null,p,A,d,_));else{if(A!=null){if(R=A.$$typeof,R===hR){p.tag=11,p=nF(null,p,A,d,_);break e}else if(R===pR){p.tag=14,p=iF(null,p,A,d,_);break e}}throw p=a(A)||A,Error(s(306,p,""))}}return p;case 0:return Rw(d,p,p.type,p.pendingProps,_);case 1:return A=p.type,R=up(A,p.pendingProps),lF(d,p,A,R,_);case 3:e:{if(et(p,p.stateNode.containerInfo),d===null)throw Error(s(387));var L=p.pendingProps;R=p.memoizedState,A=R.element,Qt(d,p),Me(p,L,null,_);var q=p.memoizedState;if(L=q.cache,Xh(p,gs,L),L!==R.cache&&Fw(p,[gs],_,!0),me(),L=q.element,cl&&R.isDehydrated)if(R={element:L,isDehydrated:!1,cache:q.cache},p.updateQueue.baseState=R,p.memoizedState=R,p.flags&256){p=cF(d,p,L,_);break e}else if(L!==A){A=re(Error(s(424)),p),Mt(A),p=cF(d,p,L,_);break e}else for(cl&&(oa=i$(p.stateNode.containerInfo),Ca=p,si=!0,tc=null,wc=!0),_=OG(p,null,L,_),p.child=_;_;)_.flags=_.flags&-3|4096,_=_.sibling;else{if(jt(),L===A){p=Mu(d,p,_);break e}Or(d,p,L,_)}p=p.child}return p;case 26:if(ul)return jx(d,p),d===null?(_=CG(p.type,null,p.pendingProps,null))?p.memoizedState=_:si||(p.stateNode=_$(p.type,p.pendingProps,$h.current,p)):p.memoizedState=CG(p.type,d.memoizedProps,p.pendingProps,d.memoizedState),null;case 27:if(aa)return be(p),d===null&&aa&&si&&(A=p.stateNode=LG(p.type,p.pendingProps,$h.current,Fr.current,!1),Ca=p,wc=!0,oa=AG(A)),A=p.pendingProps.children,d!==null||si?Or(d,p,A,_):p.child=_p(p,null,A,_),jx(d,p),p.child;case 5:return d===null&&si&&(g$(p.type,p.pendingProps,Fr.current),(R=A=oa)&&(A=r$(A,p.type,p.pendingProps,wc),A!==null?(p.stateNode=A,Ca=p,oa=AG(A),wc=!1,R=!0):R=!1),R||tt(p)),be(p),R=p.type,L=p.pendingProps,q=d!==null?d.memoizedProps:null,A=L.children,MT(R,L)?A=null:q!==null&&MT(R,q)&&(p.flags|=32),p.memoizedState!==null&&(R=j(d,p,Ge,null,null,_),Ru?yp._currentValue=R:yp._currentValue2=R),jx(d,p),Or(d,p,A,_),p.child;case 6:return d===null&&si&&(y$(p.pendingProps,Fr.current),(d=_=oa)&&(_=a$(_,p.pendingProps,wc),_!==null?(p.stateNode=_,Ca=p,oa=null,d=!0):d=!1),d||tt(p)),null;case 13:return uF(d,p,_);case 4:return et(p,p.stateNode.containerInfo),A=p.pendingProps,d===null?p.child=_p(p,null,A,_):Or(d,p,A,_),p.child;case 11:return nF(d,p,p.type,p.pendingProps,_);case 7:return Or(d,p,p.pendingProps,_),p.child;case 8:return Or(d,p,p.pendingProps.children,_),p.child;case 12:return Or(d,p,p.pendingProps.children,_),p.child;case 10:return A=p.pendingProps,Xh(p,p.type,A.value),Or(d,p,A.children,_),p.child;case 9:return R=p.type._context,A=p.pendingProps.children,hp(p),R=sa(R),A=A(R),p.flags|=1,Or(d,p,A,_),p.child;case 14:return iF(d,p,p.type,p.pendingProps,_);case 15:return sF(d,p,p.type,p.pendingProps,_);case 19:return dF(d,p,_);case 22:return rF(d,p,_);case 24:return hp(p),A=sa(gs),d===null?(R=zw(),R===null&&(R=Hi,L=Gw(),R.pooledCache=L,L.refCount++,L!==null&&(R.pooledCacheLanes|=_),R=L),p.memoizedState={parent:A,cache:R},Pt(p),Xh(p,gs,R)):(d.lanes&_&&(Qt(d,p),Me(p,null,null,_),me()),R=d.memoizedState,L=p.memoizedState,R.parent!==A?(R={parent:A,cache:A},p.memoizedState=R,p.lanes===0&&(p.memoizedState=p.updateQueue.baseState=R),Xh(p,gs,A)):(A=L.cache,Xh(p,gs,A),A!==R.cache&&Fw(p,[gs],_,!0))),Or(d,p,p.pendingProps.children,_),p.child;case 29:throw p.pendingProps}throw Error(s(156,p.tag))}function Xh(d,p,_){Ru?(b(FT,p._currentValue),p._currentValue=_):(b(FT,p._currentValue2),p._currentValue2=_)}function Eu(d){var p=FT.current;Ru?d._currentValue=p:d._currentValue2=p,y(FT)}function Ow(d,p,_){for(;d!==null;){var A=d.alternate;if((d.childLanes&p)!==p?(d.childLanes|=p,A!==null&&(A.childLanes|=p)):A!==null&&(A.childLanes&p)!==p&&(A.childLanes|=p),d===_)break;d=d.return}}function Fw(d,p,_,A){var R=d.child;for(R!==null&&(R.return=d);R!==null;){var L=R.dependencies;if(L!==null){var q=R.child;L=L.firstContext;e:for(;L!==null;){var oe=L;L=R;for(var ve=0;ve<p.length;ve++)if(oe.context===p[ve]){L.lanes|=_,oe=L.alternate,oe!==null&&(oe.lanes|=_),Ow(L.return,_,d),A||(q=null);break e}L=oe.next}}else if(R.tag===18){if(q=R.return,q===null)throw Error(s(341));q.lanes|=_,L=q.alternate,L!==null&&(L.lanes|=_),Ow(q,_,d),q=null}else q=R.child;if(q!==null)q.return=R;else for(q=R;q!==null;){if(q===d){q=null;break}if(R=q.sibling,R!==null){R.return=q.return,q=R;break}q=q.return}R=q}}function Yx(d,p,_,A){d=null;for(var R=p,L=!1;R!==null;){if(!L){if(R.flags&524288)L=!0;else if(R.flags&262144)break}if(R.tag===10){var q=R.alternate;if(q===null)throw Error(s(387));if(q=q.memoizedProps,q!==null){var oe=R.type;Mo(R.pendingProps.value,q.value)||(d!==null?d.push(oe):d=[oe])}}else if(R===BT.current){if(q=R.alternate,q===null)throw Error(s(387));q.memoizedState.memoizedState!==R.memoizedState.memoizedState&&(d!==null?d.push(yp):d=[yp])}R=R.return}d!==null&&Fw(p,d,_,A),p.flags|=262144}function mT(d){for(d=d.firstContext;d!==null;){var p=d.context;if(!Mo(Ru?p._currentValue:p._currentValue2,d.memoizedValue))return!0;d=d.next}return!1}function hp(d){Tp=d,Du=null,d=d.dependencies,d!==null&&(d.firstContext=null)}function sa(d){return pF(Tp,d)}function gT(d,p){return Tp===null&&hp(d),pF(d,p)}function pF(d,p){var _=Ru?p._currentValue:p._currentValue2;if(p={context:p,memoizedValue:_,next:null},Du===null){if(d===null)throw Error(s(308));Du=p,d.dependencies={lanes:0,firstContext:p},d.flags|=524288}else Du=Du.next=p;return _}function Gw(){return{controller:new P$,data:new Map,refCount:0}}function Kx(d){d.refCount--,d.refCount===0&&O$(F$,function(){d.controller.abort()})}function zw(){var d=Ap.current;return d!==null?d:Hi.pooledCache}function yT(d,p){p===null?b(Ap,Ap.current):b(Ap,p.pool)}function mF(){var d=zw();return d===null?null:{parent:Ru?gs._currentValue:gs._currentValue2,pool:d}}function xo(d){d.flags|=4}function gF(d,p){if(d!==null&&d.child===p.child)return!1;if(p.flags&16)return!0;for(d=p.child;d!==null;){if(d.flags&13878||d.subtreeFlags&13878)return!0;d=d.sibling}return!1}function Vw(d,p,_,A){if(ra)for(_=p.child;_!==null;){if(_.tag===5||_.tag===6)yR(d,_.stateNode);else if(!(_.tag===4||aa&&_.tag===27)&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===p)break;for(;_.sibling===null;){if(_.return===null||_.return===p)return;_=_.return}_.sibling.return=_.return,_=_.sibling}else if(Qh)for(var R=p.child;R!==null;){if(R.tag===5){var L=R.stateNode;_&&A&&(L=bG(L,R.type,R.memoizedProps)),yR(d,L)}else if(R.tag===6)L=R.stateNode,_&&A&&(L=SG(L,R.memoizedProps)),yR(d,L);else if(R.tag!==4){if(R.tag===22&&R.memoizedState!==null)L=R.child,L!==null&&(L.return=R),Vw(d,R,!0,!0);else if(R.child!==null){R.child.return=R,R=R.child;continue}}if(R===p)break;for(;R.sibling===null;){if(R.return===null||R.return===p)return;R=R.return}R.sibling.return=R.return,R=R.sibling}}function yF(d,p,_,A){if(Qh)for(var R=p.child;R!==null;){if(R.tag===5){var L=R.stateNode;_&&A&&(L=bG(L,R.type,R.memoizedProps)),_G(d,L)}else if(R.tag===6)L=R.stateNode,_&&A&&(L=SG(L,R.memoizedProps)),_G(d,L);else if(R.tag!==4){if(R.tag===22&&R.memoizedState!==null)L=R.child,L!==null&&(L.return=R),yF(d,R,!(R.memoizedProps!==null&&R.memoizedProps.mode==="manual"),!0);else if(R.child!==null){R.child.return=R,R=R.child;continue}}if(R===p)break;for(;R.sibling===null;){if(R.return===null||R.return===p)return;R=R.return}R.sibling.return=R.return,R=R.sibling}}function xF(d,p){if(Qh&&gF(d,p)){d=p.stateNode;var _=d.containerInfo,A=xG();yF(A,p,!1,!1),d.pendingChildren=A,xo(p),QQ(_,A)}}function Hw(d,p,_,A){if(ra)d.memoizedProps!==A&&xo(p);else if(Qh){var R=d.stateNode,L=d.memoizedProps;if((d=gF(d,p))||L!==A){var q=Fr.current;L=JQ(R,_,L,A,!d,null),L===R?p.stateNode=R:(dG(L,_,A,q)&&xo(p),p.stateNode=L,d?Vw(L,p,!1,!1):xo(p))}else p.stateNode=R}}function kw(d,p,_){if(MQ(p,_)){if(d.flags|=16777216,!mG(p,_))if(kF())d.flags|=8192;else throw Kg=UT,BR}else d.flags&=-16777217}function _F(d,p){if(b$(p)){if(d.flags|=16777216,!DG(p))if(kF())d.flags|=8192;else throw Kg=UT,BR}else d.flags&=-16777217}function xT(d,p){p!==null&&(d.flags|=4),d.flags&16384&&(p=d.tag!==22?E():536870912,d.lanes|=p,n0|=p)}function Zx(d,p){if(!si)switch(d.tailMode){case"hidden":p=d.tail;for(var _=null;p!==null;)p.alternate!==null&&(_=p),p=p.sibling;_===null?d.tail=null:_.sibling=null;break;case"collapsed":_=d.tail;for(var A=null;_!==null;)_.alternate!==null&&(A=_),_=_.sibling;A===null?p||d.tail===null?d.tail=null:d.tail.sibling=null:A.sibling=null}}function cs(d){var p=d.alternate!==null&&d.alternate.child===d.child,_=0,A=0;if(p)for(var R=d.child;R!==null;)_|=R.lanes|R.childLanes,A|=R.subtreeFlags&31457280,A|=R.flags&31457280,R.return=d,R=R.sibling;else for(R=d.child;R!==null;)_|=R.lanes|R.childLanes,A|=R.subtreeFlags,A|=R.flags,R.return=d,R=R.sibling;return d.subtreeFlags|=A,d.childLanes=_,p}function qJ(d,p,_){var A=p.pendingProps;switch(Be(p),p.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return cs(p),null;case 1:return cs(p),null;case 3:return _=p.stateNode,A=null,d!==null&&(A=d.memoizedState.cache),p.memoizedState.cache!==A&&(p.flags|=2048),Eu(gs),wt(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(d===null||d.child===null)&&(Ke(p)?xo(p):d===null||d.memoizedState.isDehydrated&&!(p.flags&256)||(p.flags|=1024,tc!==null&&(eR(tc),tc=null))),xF(d,p),cs(p),null;case 26:if(ul){_=p.type;var R=p.memoizedState;return d===null?(xo(p),R!==null?(cs(p),_F(p,R)):(cs(p),kw(p,_,A))):R?R!==d.memoizedState?(xo(p),cs(p),_F(p,R)):(cs(p),p.flags&=-16777217):(ra?d.memoizedProps!==A&&xo(p):Hw(d,p,_,A),cs(p),kw(p,_,A)),null}case 27:if(aa){if(Re(p),_=$h.current,R=p.type,d!==null&&p.stateNode!=null)ra?d.memoizedProps!==A&&xo(p):Hw(d,p,R,A);else{if(!A){if(p.stateNode===null)throw Error(s(166));return cs(p),null}d=Fr.current,Ke(p)?Bt(p,d):(d=LG(R,A,_,d,!0),p.stateNode=d,xo(p))}return cs(p),null}case 5:if(Re(p),_=p.type,d!==null&&p.stateNode!=null)Hw(d,p,_,A);else{if(!A){if(p.stateNode===null)throw Error(s(166));return cs(p),null}d=Fr.current,Ke(p)?Bt(p,d):(R=xQ(_,A,$h.current,d,p),Vw(R,p,!1,!1),p.stateNode=R,dG(R,_,A,d)&&xo(p))}return cs(p),kw(p,p.type,p.pendingProps),null;case 6:if(d&&p.stateNode!=null)_=d.memoizedProps,ra?_!==A&&xo(p):Qh&&(_!==A?(p.stateNode=fG(A,$h.current,Fr.current,p),xo(p)):p.stateNode=d.stateNode);else{if(typeof A!="string"&&p.stateNode===null)throw Error(s(166));if(d=$h.current,_=Fr.current,Ke(p)){if(!cl)throw Error(s(176));if(d=p.stateNode,_=p.memoizedProps,A=null,R=Ca,R!==null)switch(R.tag){case 27:case 5:A=R.memoizedProps}c$(d,_,p,A)||tt(p)}else p.stateNode=fG(A,d,_,p)}return cs(p),null;case 13:if(A=p.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(R=Ke(p),A!==null&&A.dehydrated!==null){if(d===null){if(!R)throw Error(s(318));if(!cl)throw Error(s(344));if(R=p.memoizedState,R=R!==null?R.dehydrated:null,!R)throw Error(s(317));u$(R,p)}else jt(),!(p.flags&128)&&(p.memoizedState=null),p.flags|=4;cs(p),R=!1}else tc!==null&&(eR(tc),tc=null),R=!0;if(!R)return p.flags&256?(sn(p),p):(sn(p),null)}if(sn(p),p.flags&128)return p.lanes=_,p;if(_=A!==null,d=d!==null&&d.memoizedState!==null,_){A=p.child,R=null,A.alternate!==null&&A.alternate.memoizedState!==null&&A.alternate.memoizedState.cachePool!==null&&(R=A.alternate.memoizedState.cachePool.pool);var L=null;A.memoizedState!==null&&A.memoizedState.cachePool!==null&&(L=A.memoizedState.cachePool.pool),L!==R&&(A.flags|=2048)}return _!==d&&_&&(p.child.flags|=8192),xT(p,p.updateQueue),cs(p),null;case 4:return wt(),xF(d,p),d===null&&bQ(p.stateNode.containerInfo),cs(p),null;case 10:return Eu(p.type),cs(p),null;case 19:if(y(sr),R=p.memoizedState,R===null)return cs(p),null;if(A=(p.flags&128)!==0,L=R.rendering,L===null)if(A)Zx(R,!1);else{if(xs!==0||d!==null&&d.flags&128)for(d=p.child;d!==null;){if(L=na(d),L!==null){for(p.flags|=128,Zx(R,!1),d=L.updateQueue,p.updateQueue=d,xT(p,d),p.subtreeFlags=0,d=_,_=p.child;_!==null;)$F(_,d),_=_.sibling;return b(sr,sr.current&1|2),p.child}d=d.sibling}R.tail!==null&&ec()>h_&&(p.flags|=128,A=!0,Zx(R,!1),p.lanes=4194304)}else{if(!A)if(d=na(L),d!==null){if(p.flags|=128,A=!0,d=d.updateQueue,p.updateQueue=d,xT(p,d),Zx(R,!0),R.tail===null&&R.tailMode==="hidden"&&!L.alternate&&!si)return cs(p),null}else 2*ec()-R.renderingStartTime>h_&&_!==536870912&&(p.flags|=128,A=!0,Zx(R,!1),p.lanes=4194304);R.isBackwards?(L.sibling=p.child,p.child=L):(d=R.last,d!==null?d.sibling=L:p.child=L,R.last=L)}return R.tail!==null?(p=R.tail,R.rendering=p,R.tail=p.sibling,R.renderingStartTime=ec(),p.sibling=null,d=sr.current,b(sr,A?d&1|2:d&1),p):(cs(p),null);case 22:case 23:return sn(p),Cs(),A=p.memoizedState!==null,d!==null?d.memoizedState!==null!==A&&(p.flags|=8192):A&&(p.flags|=8192),A?_&536870912&&!(p.flags&128)&&(cs(p),p.subtreeFlags&6&&(p.flags|=8192)):cs(p),_=p.updateQueue,_!==null&&xT(p,_.retryQueue),_=null,d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(_=d.memoizedState.cachePool.pool),A=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(A=p.memoizedState.cachePool.pool),A!==_&&(p.flags|=2048),d!==null&&y(Ap),null;case 24:return _=null,d!==null&&(_=d.memoizedState.cache),p.memoizedState.cache!==_&&(p.flags|=2048),Eu(gs),cs(p),null;case 25:return null}throw Error(s(156,p.tag))}function jJ(d,p){switch(Be(p),p.tag){case 1:return d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 3:return Eu(gs),wt(),d=p.flags,d&65536&&!(d&128)?(p.flags=d&-65537|128,p):null;case 26:case 27:case 5:return Re(p),null;case 13:if(sn(p),d=p.memoizedState,d!==null&&d.dehydrated!==null){if(p.alternate===null)throw Error(s(340));jt()}return d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 19:return y(sr),null;case 4:return wt(),null;case 10:return Eu(p.type),null;case 22:case 23:return sn(p),Cs(),d!==null&&y(Ap),d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 24:return Eu(gs),null;case 25:return null;default:return null}}function vF(d,p){switch(Be(p),p.tag){case 3:Eu(gs),wt();break;case 26:case 27:case 5:Re(p);break;case 4:wt();break;case 13:sn(p);break;case 19:y(sr);break;case 10:Eu(p.type);break;case 22:case 23:sn(p),Cs(),d!==null&&y(Ap);break;case 24:Eu(gs)}}function Jx(d,p){try{var _=p.updateQueue,A=_!==null?_.lastEffect:null;if(A!==null){var R=A.next;_=R;do{if((_.tag&d)===d){A=void 0;var L=_.create,q=_.inst;A=L(),q.destroy=A}_=_.next}while(_!==R)}}catch(oe){Mi(p,p.return,oe)}}function qh(d,p,_){try{var A=p.updateQueue,R=A!==null?A.lastEffect:null;if(R!==null){var L=R.next;A=L;do{if((A.tag&d)===d){var q=A.inst,oe=q.destroy;if(oe!==void 0){q.destroy=void 0,R=p;var ve=_;try{oe()}catch(je){Mi(R,ve,je)}}}A=A.next}while(A!==L)}}catch(je){Mi(p,p.return,je)}}function bF(d){var p=d.updateQueue;if(p!==null){var _=d.stateNode;try{pe(p,_)}catch(A){Mi(d,d.return,A)}}}function SF(d,p,_){_.props=up(d.type,d.memoizedProps),_.state=d.memoizedState;try{_.componentWillUnmount()}catch(A){Mi(d,p,A)}}function dp(d,p){try{var _=d.ref;if(_!==null){var A=d.stateNode;switch(d.tag){case 26:case 27:case 5:var R=e_(A);break;default:R=A}typeof _=="function"?d.refCleanup=_(R):_.current=R}}catch(L){Mi(d,p,L)}}function _o(d,p){var _=d.ref,A=d.refCleanup;if(_!==null)if(typeof A=="function")try{A()}catch(R){Mi(d,p,R)}finally{d.refCleanup=null,d=d.alternate,d!=null&&(d.refCleanup=null)}else if(typeof _=="function")try{_(null)}catch(R){Mi(d,p,R)}else _.current=null}function TF(d){var p=d.type,_=d.memoizedProps,A=d.stateNode;try{zQ(A,p,_,d)}catch(R){Mi(d,d.return,R)}}function AF(d,p,_){try{VQ(d.stateNode,d.type,_,p,d)}catch(A){Mi(d,d.return,A)}}function MF(d){return d.tag===5||d.tag===3||(ul?d.tag===26:!1)||(aa?d.tag===27:!1)||d.tag===4}function Ww(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||MF(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&(!aa||d.tag!==27)&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function Xw(d,p,_){var A=d.tag;if(A===5||A===6)d=d.stateNode,p?kQ(_,d,p):FQ(_,d);else if(!(A===4||aa&&A===27)&&(d=d.child,d!==null))for(Xw(d,p,_),d=d.sibling;d!==null;)Xw(d,p,_),d=d.sibling}function _T(d,p,_){var A=d.tag;if(A===5||A===6)d=d.stateNode,p?HQ(_,d,p):OQ(_,d);else if(!(A===4||aa&&A===27)&&(d=d.child,d!==null))for(_T(d,p,_),d=d.sibling;d!==null;)_T(d,p,_),d=d.sibling}function EF(d,p,_){d=d.containerInfo;try{vG(d,_)}catch(A){Mi(p,p.return,A)}}function YJ(d,p){for(gQ(d.containerInfo),xr=p;xr!==null;)if(d=xr,p=d.child,(d.subtreeFlags&1028)!==0&&p!==null)p.return=d,xr=p;else for(;xr!==null;){d=xr;var _=d.alternate;switch(p=d.flags,d.tag){case 0:break;case 11:case 15:break;case 1:if(p&1024&&_!==null){p=void 0;var A=d,R=_.memoizedProps;_=_.memoizedState;var L=A.stateNode;try{var q=up(A.type,R,A.elementType===A.type);p=L.getSnapshotBeforeUpdate(q,_),L.__reactInternalSnapshotBeforeUpdate=p}catch(oe){Mi(A,A.return,oe)}}break;case 3:p&1024&&ra&&ZQ(d.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(p&1024)throw Error(s(163))}if(p=d.sibling,p!==null){p.return=d.return,xr=p;break}xr=d.return}return q=HG,HG=!1,q}function CF(d,p,_){var A=_.flags;switch(_.tag){case 0:case 11:case 15:Cu(d,_),A&4&&Jx(5,_);break;case 1:if(Cu(d,_),A&4)if(d=_.stateNode,p===null)try{d.componentDidMount()}catch(oe){Mi(_,_.return,oe)}else{var R=up(_.type,p.memoizedProps);p=p.memoizedState;try{d.componentDidUpdate(R,p,d.__reactInternalSnapshotBeforeUpdate)}catch(oe){Mi(_,_.return,oe)}}A&64&&bF(_),A&512&&dp(_,_.return);break;case 3:if(Cu(d,_),A&64&&(A=_.updateQueue,A!==null)){if(d=null,_.child!==null)switch(_.child.tag){case 27:case 5:d=e_(_.child.stateNode);break;case 1:d=_.child.stateNode}try{pe(A,d)}catch(oe){Mi(_,_.return,oe)}}break;case 26:if(ul){Cu(d,_),A&512&&dp(_,_.return);break}case 27:case 5:Cu(d,_),p===null&&A&4&&TF(_),A&512&&dp(_,_.return);break;case 12:Cu(d,_);break;case 13:Cu(d,_),A&4&&RF(d,_);break;case 22:if(R=_.memoizedState!==null||Lu,!R){p=p!==null&&p.memoizedState!==null||ys;var L=Lu,q=ys;Lu=R,(ys=p)&&!q?jh(d,_,(_.subtreeFlags&8772)!==0):Cu(d,_),Lu=L,ys=q}A&512&&(_.memoizedProps.mode==="manual"?dp(_,_.return):_o(_,_.return));break;default:Cu(d,_)}}function wF(d){var p=d.alternate;p!==null&&(d.alternate=null,wF(p)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(p=d.stateNode,p!==null&&AQ(p)),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function $l(d,p,_){for(_=_.child;_!==null;)qw(d,p,_),_=_.sibling}function qw(d,p,_){if(Ao&&typeof Ao.onCommitFiberUnmount=="function")try{Ao.onCommitFiberUnmount(i_,_)}catch{}switch(_.tag){case 26:if(ul){ys||_o(_,p),$l(d,p,_),_.memoizedState?RG(_.memoizedState):_.stateNode&&BG(_.stateNode);break}case 27:if(aa){ys||_o(_,p);var A=Ws,R=Eo;Ws=_.stateNode,$l(d,p,_),M$(_.stateNode),Ws=A,Eo=R;break}case 5:ys||_o(_,p);case 6:if(ra){if(A=Ws,R=Eo,Ws=null,$l(d,p,_),Ws=A,Eo=R,Ws!==null)if(Eo)try{XQ(Ws,_.stateNode)}catch(L){Mi(_,p,L)}else try{WQ(Ws,_.stateNode)}catch(L){Mi(_,p,L)}}else $l(d,p,_);break;case 18:ra&&Ws!==null&&(Eo?m$(Ws,_.stateNode):p$(Ws,_.stateNode));break;case 4:ra?(A=Ws,R=Eo,Ws=_.stateNode.containerInfo,Eo=!0,$l(d,p,_),Ws=A,Eo=R):(Qh&&EF(_.stateNode,_,xG()),$l(d,p,_));break;case 0:case 11:case 14:case 15:ys||qh(2,_,p),ys||qh(4,_,p),$l(d,p,_);break;case 1:ys||(_o(_,p),A=_.stateNode,typeof A.componentWillUnmount=="function"&&SF(_,p,A)),$l(d,p,_);break;case 21:$l(d,p,_);break;case 22:ys||_o(_,p),ys=(A=ys)||_.memoizedState!==null,$l(d,p,_),ys=A;break;default:$l(d,p,_)}}function RF(d,p){if(cl&&p.memoizedState===null&&(d=p.alternate,d!==null&&(d=d.memoizedState,d!==null&&(d=d.dehydrated,d!==null))))try{f$(d)}catch(_){Mi(p,p.return,_)}}function KJ(d){switch(d.tag){case 13:case 19:var p=d.stateNode;return p===null&&(p=d.stateNode=new VG),p;case 22:return d=d.stateNode,p=d._retryCache,p===null&&(p=d._retryCache=new VG),p;default:throw Error(s(435,d.tag))}}function jw(d,p){var _=KJ(d);p.forEach(function(A){var R=iQ.bind(null,d,A);_.has(A)||(_.add(A),A.then(R,R))})}function Qa(d,p){var _=p.deletions;if(_!==null)for(var A=0;A<_.length;A++){var R=_[A],L=d,q=p;if(ra){var oe=q;e:for(;oe!==null;){switch(oe.tag){case 27:case 5:Ws=oe.stateNode,Eo=!1;break e;case 3:Ws=oe.stateNode.containerInfo,Eo=!0;break e;case 4:Ws=oe.stateNode.containerInfo,Eo=!0;break e}oe=oe.return}if(Ws===null)throw Error(s(160));qw(L,q,R),Ws=null,Eo=!1}else qw(L,q,R);L=R.alternate,L!==null&&(L.return=null),R.return=null}if(p.subtreeFlags&13878)for(p=p.child;p!==null;)NF(p,d),p=p.sibling}function NF(d,p){var _=d.alternate,A=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:Qa(p,d),vo(d),A&4&&(qh(3,d,d.return),Jx(3,d),qh(5,d,d.return));break;case 1:Qa(p,d),vo(d),A&512&&(ys||_===null||_o(_,_.return)),A&64&&Lu&&(d=d.updateQueue,d!==null&&(A=d.callbacks,A!==null&&(_=d.shared.hiddenCallbacks,d.shared.hiddenCallbacks=_===null?A:_.concat(A))));break;case 26:if(ul){var R=nc;Qa(p,d),vo(d),A&512&&(ys||_===null||_o(_,_.return)),A&4&&(A=_!==null?_.memoizedState:null,p=d.memoizedState,_===null?p===null?d.stateNode===null?d.stateNode=x$(R,d.type,d.memoizedProps,d):NG(R,d.type,d.stateNode):d.stateNode=wG(R,p,d.memoizedProps):A!==p?(A===null?_.stateNode!==null&&BG(_.stateNode):RG(A),p===null?NG(R,d.type,d.stateNode):wG(R,p,d.memoizedProps)):p===null&&d.stateNode!==null&&AF(d,d.memoizedProps,_.memoizedProps));break}case 27:if(aa&&A&4&&d.alternate===null){R=d.stateNode;var L=d.memoizedProps;try{T$(R),A$(d.type,L,R,d)}catch(bt){Mi(d,d.return,bt)}}case 5:if(Qa(p,d),vo(d),A&512&&(ys||_===null||_o(_,_.return)),ra){if(d.flags&32){p=d.stateNode;try{yG(p)}catch(bt){Mi(d,d.return,bt)}}A&4&&d.stateNode!=null&&(p=d.memoizedProps,AF(d,p,_!==null?_.memoizedProps:p)),A&1024&&(IR=!0)}break;case 6:if(Qa(p,d),vo(d),A&4&&ra){if(d.stateNode===null)throw Error(s(162));A=d.memoizedProps,_=_!==null?_.memoizedProps:A,p=d.stateNode;try{GQ(p,_,A)}catch(bt){Mi(d,d.return,bt)}}break;case 3:if(ul?(v$(),R=nc,nc=bR(p.containerInfo),Qa(p,d),nc=R):Qa(p,d),vo(d),A&4){if(ra&&cl&&_!==null&&_.memoizedState.isDehydrated)try{d$(p.containerInfo)}catch(bt){Mi(d,d.return,bt)}if(Qh){A=p.containerInfo,_=p.pendingChildren;try{vG(A,_)}catch(bt){Mi(d,d.return,bt)}}}IR&&(IR=!1,BF(d));break;case 4:ul?(_=nc,nc=bR(d.stateNode.containerInfo),Qa(p,d),vo(d),nc=_):(Qa(p,d),vo(d)),A&4&&Qh&&EF(d.stateNode,d,d.stateNode.pendingChildren);break;case 12:Qa(p,d),vo(d);break;case 13:Qa(p,d),vo(d),d.child.flags&8192&&d.memoizedState!==null!=(_!==null&&_.memoizedState!==null)&&(GR=ec()),A&4&&(A=d.updateQueue,A!==null&&(d.updateQueue=null,jw(d,A)));break;case 22:A&512&&(ys||_===null||_o(_,_.return)),R=d.memoizedState!==null;var q=_!==null&&_.memoizedState!==null,oe=Lu,ve=ys;if(Lu=oe||R,ys=ve||q,Qa(p,d),ys=ve,Lu=oe,vo(d),p=d.stateNode,p._current=d,p._visibility&=-3,p._visibility|=p._pendingVisibility&2,A&8192&&(p._visibility=R?p._visibility&-2:p._visibility|1,R&&(p=Lu||ys,_===null||q||p||Lg(d)),ra&&(d.memoizedProps===null||d.memoizedProps.mode!=="manual"))){e:if(_=null,ra)for(p=d;;){if(p.tag===5||ul&&p.tag===26||aa&&p.tag===27){if(_===null){q=_=p;try{L=q.stateNode,R?qQ(L):YQ(q.stateNode,q.memoizedProps)}catch(bt){Mi(q,q.return,bt)}}}else if(p.tag===6){if(_===null){q=p;try{var je=q.stateNode;R?jQ(je):KQ(je,q.memoizedProps)}catch(bt){Mi(q,q.return,bt)}}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===d)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===d)break e;for(;p.sibling===null;){if(p.return===null||p.return===d)break e;_===p&&(_=null),p=p.return}_===p&&(_=null),p.sibling.return=p.return,p=p.sibling}}A&4&&(A=d.updateQueue,A!==null&&(_=A.retryQueue,_!==null&&(A.retryQueue=null,jw(d,_))));break;case 19:Qa(p,d),vo(d),A&4&&(A=d.updateQueue,A!==null&&(d.updateQueue=null,jw(d,A)));break;case 21:break;default:Qa(p,d),vo(d)}}function vo(d){var p=d.flags;if(p&2){try{if(ra&&(!aa||d.tag!==27)){e:{for(var _=d.return;_!==null;){if(MF(_)){var A=_;break e}_=_.return}throw Error(s(160))}switch(A.tag){case 27:if(aa){var R=A.stateNode,L=Ww(d);_T(d,L,R);break}case 5:var q=A.stateNode;A.flags&32&&(yG(q),A.flags&=-33);var oe=Ww(d);_T(d,oe,q);break;case 3:case 4:var ve=A.stateNode.containerInfo,je=Ww(d);Xw(d,je,ve);break;default:throw Error(s(161))}}}catch(bt){Mi(d,d.return,bt)}d.flags&=-3}p&4096&&(d.flags&=-4097)}function BF(d){if(d.subtreeFlags&1024)for(d=d.child;d!==null;){var p=d;BF(p),p.tag===5&&p.flags&1024&&wQ(p.stateNode),d=d.sibling}}function Cu(d,p){if(p.subtreeFlags&8772)for(p=p.child;p!==null;)CF(d,p.alternate,p),p=p.sibling}function Lg(d){for(d=d.child;d!==null;){var p=d;switch(p.tag){case 0:case 11:case 14:case 15:qh(4,p,p.return),Lg(p);break;case 1:_o(p,p.return);var _=p.stateNode;typeof _.componentWillUnmount=="function"&&SF(p,p.return,_),Lg(p);break;case 26:case 27:case 5:_o(p,p.return),Lg(p);break;case 22:_o(p,p.return),p.memoizedState===null&&Lg(p);break;default:Lg(p)}d=d.sibling}}function jh(d,p,_){for(_=_&&(p.subtreeFlags&8772)!==0,p=p.child;p!==null;){var A=p.alternate,R=d,L=p,q=L.flags;switch(L.tag){case 0:case 11:case 15:jh(R,L,_),Jx(4,L);break;case 1:if(jh(R,L,_),A=L,R=A.stateNode,typeof R.componentDidMount=="function")try{R.componentDidMount()}catch(je){Mi(A,A.return,je)}if(A=L,R=A.updateQueue,R!==null){var oe=A.stateNode;try{var ve=R.shared.hiddenCallbacks;if(ve!==null)for(R.shared.hiddenCallbacks=null,R=0;R<ve.length;R++)Q(ve[R],oe)}catch(je){Mi(A,A.return,je)}}_&&q&64&&bF(L),dp(L,L.return);break;case 26:case 27:case 5:jh(R,L,_),_&&A===null&&q&4&&TF(L),dp(L,L.return);break;case 12:jh(R,L,_);break;case 13:jh(R,L,_),_&&q&4&&RF(R,L);break;case 22:L.memoizedState===null&&jh(R,L,_),dp(L,L.return);break;default:jh(R,L,_)}p=p.sibling}}function Yw(d,p){var _=null;d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(_=d.memoizedState.cachePool.pool),d=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(d=p.memoizedState.cachePool.pool),d!==_&&(d!=null&&d.refCount++,_!=null&&Kx(_))}function Kw(d,p){d=null,p.alternate!==null&&(d=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==d&&(p.refCount++,d!=null&&Kx(d))}function Yh(d,p,_,A){if(p.subtreeFlags&10256)for(p=p.child;p!==null;)DF(d,p,_,A),p=p.sibling}function DF(d,p,_,A){var R=p.flags;switch(p.tag){case 0:case 11:case 15:Yh(d,p,_,A),R&2048&&Jx(9,p);break;case 3:Yh(d,p,_,A),R&2048&&(d=null,p.alternate!==null&&(d=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==d&&(p.refCount++,d!=null&&Kx(d)));break;case 12:if(R&2048){Yh(d,p,_,A),d=p.stateNode;try{var L=p.memoizedProps,q=L.id,oe=L.onPostCommit;typeof oe=="function"&&oe(q,p.alternate===null?"mount":"update",d.passiveEffectDuration,-0)}catch(ve){Mi(p,p.return,ve)}}else Yh(d,p,_,A);break;case 23:break;case 22:L=p.stateNode,p.memoizedState!==null?L._visibility&4?Yh(d,p,_,A):Qx(d,p):L._visibility&4?Yh(d,p,_,A):(L._visibility|=4,Ug(d,p,_,A,(p.subtreeFlags&10256)!==0)),R&2048&&Yw(p.alternate,p);break;case 24:Yh(d,p,_,A),R&2048&&Kw(p.alternate,p);break;default:Yh(d,p,_,A)}}function Ug(d,p,_,A,R){for(R=R&&(p.subtreeFlags&10256)!==0,p=p.child;p!==null;){var L=d,q=p,oe=_,ve=A,je=q.flags;switch(q.tag){case 0:case 11:case 15:Ug(L,q,oe,ve,R),Jx(8,q);break;case 23:break;case 22:var bt=q.stateNode;q.memoizedState!==null?bt._visibility&4?Ug(L,q,oe,ve,R):Qx(L,q):(bt._visibility|=4,Ug(L,q,oe,ve,R)),R&&je&2048&&Yw(q.alternate,q);break;case 24:Ug(L,q,oe,ve,R),R&&je&2048&&Kw(q.alternate,q);break;default:Ug(L,q,oe,ve,R)}p=p.sibling}}function Qx(d,p){if(p.subtreeFlags&10256)for(p=p.child;p!==null;){var _=d,A=p,R=A.flags;switch(A.tag){case 22:Qx(_,A),R&2048&&Yw(A.alternate,A);break;case 24:Qx(_,A),R&2048&&Kw(A.alternate,A);break;default:Qx(_,A)}p=p.sibling}}function fp(d){if(d.subtreeFlags&e0)for(d=d.child;d!==null;)LF(d),d=d.sibling}function LF(d){switch(d.tag){case 26:fp(d),d.flags&e0&&(d.memoizedState!==null?S$(nc,d.memoizedState,d.memoizedProps):gG(d.type,d.memoizedProps));break;case 5:fp(d),d.flags&e0&&gG(d.type,d.memoizedProps);break;case 3:case 4:if(ul){var p=nc;nc=bR(d.stateNode.containerInfo),fp(d),nc=p}else fp(d);break;case 22:d.memoizedState===null&&(p=d.alternate,p!==null&&p.memoizedState!==null?(p=e0,e0=16777216,fp(d),e0=p):fp(d));break;default:fp(d)}}function UF(d){var p=d.alternate;if(p!==null&&(d=p.child,d!==null)){p.child=null;do p=d.sibling,d.sibling=null,d=p;while(d!==null)}}function $x(d){var p=d.deletions;if(d.flags&16){if(p!==null)for(var _=0;_<p.length;_++){var A=p[_];xr=A,PF(A,d)}UF(d)}if(d.subtreeFlags&10256)for(d=d.child;d!==null;)IF(d),d=d.sibling}function IF(d){switch(d.tag){case 0:case 11:case 15:$x(d),d.flags&2048&&qh(9,d,d.return);break;case 3:$x(d);break;case 12:$x(d);break;case 22:var p=d.stateNode;d.memoizedState!==null&&p._visibility&4&&(d.return===null||d.return.tag!==13)?(p._visibility&=-5,vT(d)):$x(d);break;default:$x(d)}}function vT(d){var p=d.deletions;if(d.flags&16){if(p!==null)for(var _=0;_<p.length;_++){var A=p[_];xr=A,PF(A,d)}UF(d)}for(d=d.child;d!==null;){switch(p=d,p.tag){case 0:case 11:case 15:qh(8,p,p.return),vT(p);break;case 22:_=p.stateNode,_._visibility&4&&(_._visibility&=-5,vT(p));break;default:vT(p)}d=d.sibling}}function PF(d,p){for(;xr!==null;){var _=xr;switch(_.tag){case 0:case 11:case 15:qh(8,_,p);break;case 23:case 22:if(_.memoizedState!==null&&_.memoizedState.cachePool!==null){var A=_.memoizedState.cachePool.pool;A!=null&&A.refCount++}break;case 24:Kx(_.memoizedState.cache)}if(A=_.child,A!==null)A.return=_,xr=A;else e:for(_=d;xr!==null;){A=xr;var R=A.sibling,L=A.return;if(wF(A),A===_){xr=null;break e}if(R!==null){R.return=L,xr=R;break e}xr=L}}}function Zw(d){var p=pG(d);if(p!=null){if(typeof p.memoizedProps["data-testname"]!="string")throw Error(s(364));return p}if(d=BQ(d),d===null)throw Error(s(362));return d.stateNode.current}function Jw(d,p){var _=d.tag;switch(p.$$typeof){case GT:if(d.type===p.value)return!0;break;case zT:e:{for(p=p.value,d=[d,0],_=0;_<d.length;){var A=d[_++],R=A.tag,L=d[_++],q=p[L];if(R!==5&&R!==26&&R!==27||!n_(A)){for(;q!=null&&Jw(A,q);)L++,q=p[L];if(L===p.length){p=!0;break e}else for(A=A.child;A!==null;)d.push(A,L),A=A.sibling}}p=!1}return p;case VT:if((_===5||_===26||_===27)&&UQ(d.stateNode,p.value))return!0;break;case kT:if((_===5||_===6||_===26||_===27)&&(d=LQ(d),d!==null&&0<=d.indexOf(p.value)))return!0;break;case HT:if((_===5||_===26||_===27)&&(d=d.memoizedProps["data-testname"],typeof d=="string"&&d.toLowerCase()===p.value.toLowerCase()))return!0;break;default:throw Error(s(365))}return!1}function Qw(d){switch(d.$$typeof){case GT:return"<"+(a(d.value)||"Unknown")+">";case zT:return":has("+(Qw(d)||"")+")";case VT:return'[role="'+d.value+'"]';case kT:return'"'+d.value+'"';case HT:return'[data-testname="'+d.value+'"]';default:throw Error(s(365))}}function OF(d,p){var _=[];d=[d,0];for(var A=0;A<d.length;){var R=d[A++],L=R.tag,q=d[A++],oe=p[q];if(L!==5&&L!==26&&L!==27||!n_(R)){for(;oe!=null&&Jw(R,oe);)q++,oe=p[q];if(q===p.length)_.push(R);else for(R=R.child;R!==null;)d.push(R,q),R=R.sibling}}return _}function $w(d,p){if(!t_)throw Error(s(363));d=Zw(d),d=OF(d,p),p=[],d=Array.from(d);for(var _=0;_<d.length;){var A=d[_++],R=A.tag;if(R===5||R===26||R===27)n_(A)||p.push(A.stateNode);else for(A=A.child;A!==null;)d.push(A),A=A.sibling}return p}function bo(){if(Bi&2&&Zn!==0)return Zn&-Zn;if(Sn.T!==null){var d=jg;return d!==0?d:ze()}return SQ()}function FF(){ml===0&&(ml=!(Zn&536870912)||si?N():536870912);var d=pl.current;return d!==null&&(d.flags|=32),ml}function Ea(d,p,_){(d===Hi&&ki===2||d.cancelPendingCommit!==null)&&(Ig(d,0),wu(d,Zn,ml,!1)),U(d,_),(!(Bi&2)||d!==Hi)&&(d===Hi&&(!(Bi&2)&&(Mp|=_),xs===4&&wu(d,Zn,ml,!1)),st(d))}function GF(d,p,_){if(Bi&6)throw Error(s(327));var A=!_&&(p&60)===0&&(p&d.expiredLanes)===0||C(d,p),R=A?QJ(d,p):iR(d,p,!0),L=A;do{if(R===0){t0&&!A&&wu(d,p,0,!1);break}else if(R===6)wu(d,p,0,!Uu);else{if(_=d.current.alternate,L&&!ZJ(_)){R=iR(d,p,!1),L=!1;continue}if(R===2){if(L=p,d.errorRecoveryDisabledLanes&L)var q=0;else q=d.pendingLanes&-536870913,q=q!==0?q:q&536870912?536870912:0;if(q!==0){p=q;e:{var oe=d;R=u_;var ve=cl&&oe.current.memoizedState.isDehydrated;if(ve&&(Ig(oe,q).flags|=256),q=iR(oe,q,!1),q!==2){if(PR&&!ve){oe.errorRecoveryDisabledLanes|=L,Mp|=L,R=4;break e}L=Bc,Bc=R,L!==null&&eR(L)}R=q}if(L=!1,R!==2)continue}}if(R===1){Ig(d,0),wu(d,p,0,!0);break}e:{switch(A=d,R){case 0:case 1:throw Error(s(345));case 4:if((p&4194176)===p){wu(A,p,ml,!Uu);break e}break;case 2:Bc=null;break;case 3:case 5:break;default:throw Error(s(329))}if(A.finishedWork=_,A.finishedLanes=p,(p&62914560)===p&&(L=GR+300-ec(),10<L)){if(wu(A,p,ml,!Uu),M(A,0)!==0)break e;A.timeoutHandle=_Q(zF.bind(null,A,_,Bc,WT,FR,p,ml,Mp,n0,Uu,2,-0,0),L);break e}zF(A,_,Bc,WT,FR,p,ml,Mp,n0,Uu,0,-0,0)}}break}while(!0);st(d)}function eR(d){Bc===null?Bc=d:Bc.push.apply(Bc,d)}function zF(d,p,_,A,R,L,q,oe,ve,je,bt,kt,Xt){var An=p.subtreeFlags;if((An&8192||(An&16785408)===16785408)&&(EQ(),LF(p),p=CQ(),p!==null)){d.cancelPendingCommit=p(KF.bind(null,d,_,A,R,q,oe,ve,1,kt,Xt)),wu(d,L,q,!je);return}KF(d,_,A,R,q,oe,ve,bt,kt,Xt)}function ZJ(d){for(var p=d;;){var _=p.tag;if((_===0||_===11||_===15)&&p.flags&16384&&(_=p.updateQueue,_!==null&&(_=_.stores,_!==null)))for(var A=0;A<_.length;A++){var R=_[A],L=R.getSnapshot;R=R.value;try{if(!Mo(L(),R))return!1}catch{return!1}}if(_=p.child,p.subtreeFlags&16384&&_!==null)_.return=p,p=_;else{if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function wu(d,p,_,A){p&=~OR,p&=~Mp,d.suspendedLanes|=p,d.pingedLanes&=~p,A&&(d.warmLanes|=p),A=d.expirationTimes;for(var R=p;0<R;){var L=31-To(R),q=1<<L;A[L]=-1,R&=~q}_!==0&&F(d,_,p)}function VF(){return Bi&6?!0:(Vt(0),!1)}function tR(){if(zn!==null){if(ki===0)var d=zn.return;else d=zn,Du=Tp=null,ft(d),Zg=null,o_=0,d=zn;for(;d!==null;)vF(d.alternate,d),d=d.return;zn=null}}function Ig(d,p){d.finishedWork=null,d.finishedLanes=0;var _=d.timeoutHandle;_!==xR&&(d.timeoutHandle=xR,vQ(_)),_=d.cancelPendingCommit,_!==null&&(d.cancelPendingCommit=null,_()),tR(),Hi=d,zn=_=Kh(d.current,null),Zn=p,ki=0,Co=null,Uu=!1,t0=C(d,p),PR=!1,n0=ml=OR=Mp=id=xs=0,Bc=u_=null,FR=!1,p&8&&(p|=p&32);var A=d.entangledLanes;if(A!==0)for(d=d.entanglements,A&=p;0<A;){var R=31-To(A),L=1<<R;p|=d[R],A&=~L}return Iu=p,Ie(),_}function HF(d,p){Dn=null,Sn.H=Nc,p===a_?(p=lt(),ki=3):p===BR?(p=lt(),ki=4):ki=p===GG?8:p!==null&&typeof p=="object"&&typeof p.then=="function"?6:1,Co=p,zn===null&&(xs=1,pT(d,re(p,d.current)))}function kF(){var d=pl.current;return d===null?!0:(Zn&4194176)===Zn?Rc===null:(Zn&62914560)===Zn||Zn&536870912?d===Rc:!1}function WF(){var d=Sn.H;return Sn.H=Nc,d===null?Nc:d}function XF(){var d=Sn.A;return Sn.A=G$,d}function nR(){xs=4,Uu||(Zn&4194176)!==Zn&&pl.current!==null||(t0=!0),!(id&134217727)&&!(Mp&134217727)||Hi===null||wu(Hi,Zn,ml,!1)}function iR(d,p,_){var A=Bi;Bi|=2;var R=WF(),L=XF();(Hi!==d||Zn!==p)&&(WT=null,Ig(d,p)),p=!1;var q=xs;e:do try{if(ki!==0&&zn!==null){var oe=zn,ve=Co;switch(ki){case 8:tR(),q=6;break e;case 3:case 2:case 6:pl.current===null&&(p=!0);var je=ki;if(ki=0,Co=null,Pg(d,oe,ve,je),_&&t0){q=0;break e}break;default:je=ki,ki=0,Co=null,Pg(d,oe,ve,je)}}JJ(),q=xs;break}catch(bt){HF(d,bt)}while(!0);return p&&d.shellSuspendCounter++,Du=Tp=null,Bi=A,Sn.H=R,Sn.A=L,zn===null&&(Hi=null,Zn=0,Ie()),q}function JJ(){for(;zn!==null;)qF(zn)}function QJ(d,p){var _=Bi;Bi|=2;var A=WF(),R=XF();Hi!==d||Zn!==p?(WT=null,h_=ec()+500,Ig(d,p)):t0=C(d,p);e:do try{if(ki!==0&&zn!==null){p=zn;var L=Co;t:switch(ki){case 1:ki=0,Co=null,Pg(d,p,L,1);break;case 2:if(it(L)){ki=0,Co=null,jF(p);break}p=function(){ki===2&&Hi===d&&(ki=7),st(d)},L.then(p,p);break e;case 3:ki=7;break e;case 4:ki=5;break e;case 7:it(L)?(ki=0,Co=null,jF(p)):(ki=0,Co=null,Pg(d,p,L,7));break;case 5:var q=null;switch(zn.tag){case 26:q=zn.memoizedState;case 5:case 27:var oe=zn,ve=oe.type,je=oe.pendingProps;if(q?DG(q):mG(ve,je)){ki=0,Co=null;var bt=oe.sibling;if(bt!==null)zn=bt;else{var kt=oe.return;kt!==null?(zn=kt,bT(kt)):zn=null}break t}}ki=0,Co=null,Pg(d,p,L,5);break;case 6:ki=0,Co=null,Pg(d,p,L,6);break;case 8:tR(),xs=6;break e;default:throw Error(s(462))}}$J();break}catch(Xt){HF(d,Xt)}while(!0);return Du=Tp=null,Sn.H=A,Sn.A=R,Bi=_,zn!==null?0:(Hi=null,Zn=0,Ie(),xs)}function $J(){for(;zn!==null&&!w$();)qF(zn)}function qF(d){var p=fF(d.alternate,d,Iu);d.memoizedProps=d.pendingProps,p===null?bT(d):zn=p}function jF(d){var p=d,_=p.alternate;switch(p.tag){case 15:case 0:p=oF(_,p,p.pendingProps,p.type,void 0,Zn);break;case 11:p=oF(_,p,p.pendingProps,p.type.render,p.ref,Zn);break;case 5:ft(p);default:vF(_,p),p=zn=$F(p,Iu),p=fF(_,p,Iu)}d.memoizedProps=d.pendingProps,p===null?bT(d):zn=p}function Pg(d,p,_,A){Du=Tp=null,ft(p),Zg=null,o_=0;var R=p.return;try{if(WJ(d,R,p,_,Zn)){xs=1,pT(d,re(_,d.current)),zn=null;return}}catch(L){if(R!==null)throw zn=R,L;xs=1,pT(d,re(_,d.current)),zn=null;return}p.flags&32768?(si||A===1?d=!0:t0||Zn&536870912?d=!1:(Uu=d=!0,(A===2||A===3||A===6)&&(A=pl.current,A!==null&&A.tag===13&&(A.flags|=16384))),YF(p,d)):bT(p)}function bT(d){var p=d;do{if(p.flags&32768){YF(p,Uu);return}d=p.return;var _=qJ(p.alternate,p,Iu);if(_!==null){zn=_;return}if(p=p.sibling,p!==null){zn=p;return}zn=p=d}while(p!==null);xs===0&&(xs=5)}function YF(d,p){do{var _=jJ(d.alternate,d);if(_!==null){_.flags&=32767,zn=_;return}if(_=d.return,_!==null&&(_.flags|=32768,_.subtreeFlags=0,_.deletions=null),!p&&(d=d.sibling,d!==null)){zn=d;return}zn=d=_}while(d!==null);xs=6,zn=null}function KF(d,p,_,A,R,L,q,oe,ve,je){var bt=Sn.T,kt=gp();try{$a(2),Sn.T=null,eQ(d,p,_,A,kt,R,L,q,oe,ve,je)}finally{Sn.T=bt,$a(kt)}}function eQ(d,p,_,A,R,L,q,oe){do pp();while(Ep!==null);if(Bi&6)throw Error(s(327));var ve=d.finishedWork;if(A=d.finishedLanes,ve===null)return null;if(d.finishedWork=null,d.finishedLanes=0,ve===d.current)throw Error(s(177));d.callbackNode=null,d.callbackPriority=0,d.cancelPendingCommit=null;var je=ve.lanes|ve.childLanes;if(je|=ER,H(d,A,je,L,q,oe),d===Hi&&(zn=Hi=null,Zn=0),!(ve.subtreeFlags&10256)&&!(ve.flags&10256)||XT||(XT=!0,zR=je,VR=_,sQ(AR,function(){return pp(),null})),_=(ve.flags&15990)!==0,ve.subtreeFlags&15990||_?(_=Sn.T,Sn.T=null,L=gp(),$a(2),q=Bi,Bi|=4,YJ(d,ve),NF(ve,d),yQ(d.containerInfo),d.current=ve,CF(d,ve.alternate,ve),R$(),Bi=q,$a(L),Sn.T=_):d.current=ve,XT?(XT=!1,Ep=d,d_=A):ZF(d,je),je=d.pendingLanes,je===0&&(sd=null),P(ve.stateNode),st(d),p!==null)for(R=d.onRecoverableError,ve=0;ve<p.length;ve++)je=p[ve],R(je.value,{componentStack:je.stack});return d_&3&&pp(),je=d.pendingLanes,A&4194218&&je&42?d===HR?f_++:(f_=0,HR=d):f_=0,Vt(0),null}function ZF(d,p){(d.pooledCacheLanes&=p)===0&&(p=d.pooledCache,p!=null&&(d.pooledCache=null,Kx(p)))}function pp(){if(Ep!==null){var d=Ep,p=zR;zR=0;var _=Y(d_),A=32>_?32:_;_=Sn.T;var R=gp();try{if($a(A),Sn.T=null,Ep===null)var L=!1;else{A=VR,VR=null;var q=Ep,oe=d_;if(Ep=null,d_=0,Bi&6)throw Error(s(331));var ve=Bi;if(Bi|=4,IF(q.current),DF(q,q.current,oe,A),Bi=ve,Vt(0,!1),Ao&&typeof Ao.onPostCommitFiberRoot=="function")try{Ao.onPostCommitFiberRoot(i_,q)}catch{}L=!0}return L}finally{$a(R),Sn.T=_,ZF(d,p)}}return!1}function JF(d,p,_){p=re(_,p),p=ww(d.stateNode,p,2),d=Qe(d,p,2),d!==null&&(U(d,2),st(d))}function Mi(d,p,_){if(d.tag===3)JF(d,d,_);else for(;p!==null;){if(p.tag===3){JF(p,d,_);break}else if(p.tag===1){var A=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(sd===null||!sd.has(A))){d=re(_,d),_=eF(2),A=Qe(p,_,2),A!==null&&(tF(_,A,p,d),U(A,2),st(A));break}}p=p.return}}function sR(d,p,_){var A=d.pingCache;if(A===null){A=d.pingCache=new z$;var R=new Set;A.set(p,R)}else R=A.get(p),R===void 0&&(R=new Set,A.set(p,R));R.has(_)||(PR=!0,R.add(_),d=tQ.bind(null,d,p,_),p.then(d,d))}function tQ(d,p,_){var A=d.pingCache;A!==null&&A.delete(p),d.pingedLanes|=d.suspendedLanes&_,d.warmLanes&=~_,Hi===d&&(Zn&_)===_&&(xs===4||xs===3&&(Zn&62914560)===Zn&&300>ec()-GR?!(Bi&2)&&Ig(d,0):OR|=_,n0===Zn&&(n0=0)),st(d)}function QF(d,p){p===0&&(p=E()),d=at(d,p),d!==null&&(U(d,p),st(d))}function nQ(d){var p=d.memoizedState,_=0;p!==null&&(_=p.retryLane),QF(d,_)}function iQ(d,p){var _=0;switch(d.tag){case 13:var A=d.stateNode,R=d.memoizedState;R!==null&&(_=R.retryLane);break;case 19:A=d.stateNode;break;case 22:A=d.stateNode._retryCache;break;default:throw Error(s(314))}A!==null&&A.delete(p),QF(d,_)}function sQ(d,p){return wT(d,p)}function rQ(d,p,_,A){this.tag=d,this.key=_,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function rR(d){return d=d.prototype,!(!d||!d.isReactComponent)}function Kh(d,p){var _=d.alternate;return _===null?(_=t(d.tag,p,d.key,d.mode),_.elementType=d.elementType,_.type=d.type,_.stateNode=d.stateNode,_.alternate=d,d.alternate=_):(_.pendingProps=p,_.type=d.type,_.flags=0,_.subtreeFlags=0,_.deletions=null),_.flags=d.flags&31457280,_.childLanes=d.childLanes,_.lanes=d.lanes,_.child=d.child,_.memoizedProps=d.memoizedProps,_.memoizedState=d.memoizedState,_.updateQueue=d.updateQueue,p=d.dependencies,_.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},_.sibling=d.sibling,_.index=d.index,_.ref=d.ref,_.refCleanup=d.refCleanup,_}function $F(d,p){d.flags&=31457282;var _=d.alternate;return _===null?(d.childLanes=0,d.lanes=p,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=_.childLanes,d.lanes=_.lanes,d.child=_.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=_.memoizedProps,d.memoizedState=_.memoizedState,d.updateQueue=_.updateQueue,d.type=_.type,p=_.dependencies,d.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),d}function ST(d,p,_,A,R,L){var q=0;if(A=d,typeof d=="function")rR(d)&&(q=1);else if(typeof d=="string")q=ul&&aa?EG(d,_,Fr.current)?26:UG(d)?27:5:ul?EG(d,_,Fr.current)?26:5:aa&&UG(d)?27:5;else e:switch(d){case Fg:return mp(_.children,R,L,p);case aG:q=8,R|=24;break;case uR:return d=t(12,_,p,R|2),d.elementType=uR,d.lanes=L,d;case dR:return d=t(13,_,p,R),d.elementType=dR,d.lanes=L,d;case fR:return d=t(19,_,p,R),d.elementType=fR,d.lanes=L,d;case lG:return eG(_,R,L,p);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case cQ:case Zh:q=10;break e;case oG:q=9;break e;case hR:q=11;break e;case pR:q=14;break e;case Jh:q=16,A=null;break e}q=29,_=Error(s(130,d===null?"null":typeof d,"")),A=null}return p=t(q,_,p,R),p.elementType=d,p.type=A,p.lanes=L,p}function mp(d,p,_,A){return d=t(7,d,A,p),d.lanes=_,d}function eG(d,p,_,A){d=t(22,d,A,p),d.elementType=lG,d.lanes=_;var R={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var L=R._current;if(L===null)throw Error(s(456));if(!(R._pendingVisibility&2)){var q=at(L,2);q!==null&&(R._pendingVisibility|=2,Ea(q,L,2))}},attach:function(){var L=R._current;if(L===null)throw Error(s(456));if(R._pendingVisibility&2){var q=at(L,2);q!==null&&(R._pendingVisibility&=-3,Ea(q,L,2))}}};return d.stateNode=R,d}function aR(d,p,_){return d=t(6,d,null,p),d.lanes=_,d}function oR(d,p,_){return p=t(4,d.children!==null?d.children:[],d.key,p),p.lanes=_,p.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},p}function aQ(d,p,_,A,R,L,q,oe){this.tag=1,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=xR,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=B(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=B(0),this.hiddenUpdates=B(null),this.identifierPrefix=A,this.onUncaughtError=R,this.onCaughtError=L,this.onRecoverableError=q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=oe,this.incompleteTransitions=new Map}function tG(d,p,_,A,R,L,q,oe,ve,je,bt,kt){return d=new aQ(d,p,_,q,oe,ve,je,kt),p=1,L===!0&&(p|=24),L=t(3,null,null,p),d.current=L,L.stateNode=d,p=Gw(),p.refCount++,d.pooledCache=p,p.refCount++,L.memoizedState={element:A,isDehydrated:_,cache:p},Pt(L),d}function nG(d){return d?(d=Vg,d):Vg}function iG(d){var p=d._reactInternals;if(p===void 0)throw typeof d.render=="function"?Error(s(188)):(d=Object.keys(d).join(","),Error(s(268,d)));return d=m(p),d=d!==null?g(d):null,d===null?null:e_(d.stateNode)}function sG(d,p,_,A,R,L){R=nG(R),A.context===null?A.context=R:A.pendingContext=R,A=Xe(p),A.payload={element:_},L=L===void 0?null:L,L!==null&&(A.callback=L),_=Qe(d,A,p),_!==null&&(Ea(_,d,p),Et(_,d,p))}function rG(d,p){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var _=d.retryLane;d.retryLane=_!==0&&_<p?_:p}}function lR(d,p){rG(d,p),(d=d.alternate)&&rG(d,p)}var Gn={},oQ=$,So=d3,cR=Object.assign,lQ=Symbol.for("react.element"),TT=Symbol.for("react.transitional.element"),Og=Symbol.for("react.portal"),Fg=Symbol.for("react.fragment"),aG=Symbol.for("react.strict_mode"),uR=Symbol.for("react.profiler"),cQ=Symbol.for("react.provider"),oG=Symbol.for("react.consumer"),Zh=Symbol.for("react.context"),hR=Symbol.for("react.forward_ref"),dR=Symbol.for("react.suspense"),fR=Symbol.for("react.suspense_list"),pR=Symbol.for("react.memo"),Jh=Symbol.for("react.lazy"),lG=Symbol.for("react.offscreen"),uQ=Symbol.for("react.memo_cache_sentinel"),cG=Symbol.iterator,hQ=Symbol.for("react.client.reference"),Sn=oQ.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,mR,uG,gR=!1,AT=Array.isArray,dQ=e.rendererVersion,fQ=e.rendererPackageName,hG=e.extraDevToolsConfig,e_=e.getPublicInstance,pQ=e.getRootHostContext,mQ=e.getChildHostContext,gQ=e.prepareForCommit,yQ=e.resetAfterCommit,xQ=e.createInstance,yR=e.appendInitialChild,dG=e.finalizeInitialChildren,MT=e.shouldSetTextContent,fG=e.createTextInstance,_Q=e.scheduleTimeout,vQ=e.cancelTimeout,xR=e.noTimeout,Ru=e.isPrimaryRenderer;e.warnsIfNotActing;var ra=e.supportsMutation,Qh=e.supportsPersistence,cl=e.supportsHydration,pG=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var bQ=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var $a=e.setCurrentUpdatePriority,gp=e.getCurrentUpdatePriority,SQ=e.resolveUpdatePriority;e.resolveEventType,e.resolveEventTimeStamp;var TQ=e.shouldAttemptEagerTransition,AQ=e.detachDeletedInstance;e.requestPostPaintCallback;var MQ=e.maySuspendCommit,mG=e.preloadInstance,EQ=e.startSuspendingCommit,gG=e.suspendInstance,CQ=e.waitForCommitToBeReady,Gg=e.NotPendingTransition,yp=e.HostTransitionContext,wQ=e.resetFormInstance;e.bindToConsole;var RQ=e.supportsMicrotasks,NQ=e.scheduleMicrotask,t_=e.supportsTestSelectors,BQ=e.findFiberRoot,DQ=e.getBoundingRect,LQ=e.getTextContent,n_=e.isHiddenSubtree,UQ=e.matchAccessibilityRole,IQ=e.setFocusIfFocusable,PQ=e.setupIntersectionObserver,OQ=e.appendChild,FQ=e.appendChildToContainer,GQ=e.commitTextUpdate,zQ=e.commitMount,VQ=e.commitUpdate,HQ=e.insertBefore,kQ=e.insertInContainerBefore,WQ=e.removeChild,XQ=e.removeChildFromContainer,yG=e.resetTextContent,qQ=e.hideInstance,jQ=e.hideTextInstance,YQ=e.unhideInstance,KQ=e.unhideTextInstance,ZQ=e.clearContainer,JQ=e.cloneInstance,xG=e.createContainerChildSet,_G=e.appendChildToContainerChildSet,QQ=e.finalizeContainerChildren,vG=e.replaceContainerChildren,bG=e.cloneHiddenInstance,SG=e.cloneHiddenTextInstance,_R=e.isSuspenseInstancePending,vR=e.isSuspenseInstanceFallback,$Q=e.getSuspenseInstanceFallbackErrorDetails,e$=e.registerSuspenseInstanceRetry,t$=e.canHydrateFormStateMarker,n$=e.isFormStateMarkerMatching,TG=e.getNextHydratableSibling,AG=e.getFirstHydratableChild,i$=e.getFirstHydratableChildWithinContainer,s$=e.getFirstHydratableChildWithinSuspenseInstance,r$=e.canHydrateInstance,a$=e.canHydrateTextInstance,o$=e.canHydrateSuspenseInstance,l$=e.hydrateInstance,c$=e.hydrateTextInstance,u$=e.hydrateSuspenseInstance,h$=e.getNextHydratableInstanceAfterSuspenseInstance,d$=e.commitHydratedContainer,f$=e.commitHydratedSuspenseInstance,p$=e.clearSuspenseBoundary,m$=e.clearSuspenseBoundaryFromContainer,MG=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var g$=e.validateHydratableInstance,y$=e.validateHydratableTextInstance,ul=e.supportsResources,EG=e.isHostHoistableType,bR=e.getHoistableRoot,CG=e.getResource,wG=e.acquireResource,RG=e.releaseResource,x$=e.hydrateHoistable,NG=e.mountHoistable,BG=e.unmountHoistable,_$=e.createHoistableInstance,v$=e.prepareToCommitHoistables,b$=e.mayResourceSuspendCommit,DG=e.preloadResource,S$=e.suspendResource,aa=e.supportsSingletons,LG=e.resolveSingletonInstance,T$=e.clearSingleton,A$=e.acquireSingletonInstance,M$=e.releaseSingletonInstance,UG=e.isHostSingletonType,SR=[],zg=-1,Vg={},To=Math.clz32?Math.clz32:S,E$=Math.log,C$=Math.LN2,ET=128,CT=4194304,wT=So.unstable_scheduleCallback,TR=So.unstable_cancelCallback,w$=So.unstable_shouldYield,R$=So.unstable_requestPaint,ec=So.unstable_now,IG=So.unstable_ImmediatePriority,N$=So.unstable_UserBlockingPriority,AR=So.unstable_NormalPriority,B$=So.unstable_IdlePriority,D$=So.log,L$=So.unstable_setDisableYieldValue,i_=null,Ao=null,Mo=typeof Object.is=="function"?Object.is:J,PG=new WeakMap,Hg=[],kg=0,RT=null,NT=0,hl=[],dl=0,xp=null,Nu=1,Bu="",Fr=v(null),s_=v(null),$h=v(null),BT=v(null),Ca=null,oa=null,si=!1,tc=null,wc=!1,MR=Error(s(519)),fl=[],Wg=0,ER=0,DT=null,Xg=null,CR=!1,LT=!1,wR=!1,qg=0,r_=null,RR=0,jg=0,Yg=null,ed=!1,NR=!1,U$=Object.prototype.hasOwnProperty,a_=Error(s(460)),BR=Error(s(474)),UT={then:function(){}},Kg=null,Zg=null,o_=0,_p=Vi(!0),OG=Vi(!1),Jg=v(null),IT=v(0),pl=v(null),Rc=null,sr=v(0),td=0,Dn=null,Ni=null,ks=null,PT=!1,Qg=!1,vp=!1,OT=0,l_=0,$g=null,I$=0,DR=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},Nc={readContext:sa,use:vt,useCallback:Ri,useContext:Ri,useEffect:Ri,useImperativeHandle:Ri,useLayoutEffect:Ri,useInsertionEffect:Ri,useMemo:Ri,useReducer:Ri,useRef:Ri,useState:Ri,useDebugValue:Ri,useDeferredValue:Ri,useTransition:Ri,useSyncExternalStore:Ri,useId:Ri};Nc.useCacheRefresh=Ri,Nc.useMemoCache=Ri,Nc.useHostTransitionStatus=Ri,Nc.useFormState=Ri,Nc.useActionState=Ri,Nc.useOptimistic=Ri;var bp={readContext:sa,use:vt,useCallback:function(d,p){return pt().memoizedState=[d,p===void 0?null:p],d},useContext:sa,useEffect:Dg,useImperativeHandle:function(d,p,_){_=_!=null?_.concat([d]):null,Hs(4194308,4,GO.bind(null,p,d),_)},useLayoutEffect:function(d,p){return Hs(4194308,4,d,p)},useInsertionEffect:function(d,p){Hs(4,2,d,p)},useMemo:function(d,p){var _=pt();p=p===void 0?null:p;var A=d();if(vp){X(!0);try{d()}finally{X(!1)}}return _.memoizedState=[A,p],A},useReducer:function(d,p,_){var A=pt();if(_!==void 0){var R=_(p);if(vp){X(!0);try{_(p)}finally{X(!1)}}}else R=p;return A.memoizedState=A.baseState=R,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:R},A.queue=d,d=d.dispatch=kJ.bind(null,Dn,d),[A.memoizedState,d]},useRef:function(d){var p=pt();return d={current:d},p.memoizedState=d},useState:function(d){d=Nt(d);var p=d.queue,_=YO.bind(null,Dn,p);return p.dispatch=_,[d.memoizedState,_]},useDebugValue:Tw,useDeferredValue:function(d,p){var _=pt();return Aw(_,d,p)},useTransition:function(){var d=Nt(!1);return d=WO.bind(null,Dn,d.queue,!0,!1),pt().memoizedState=d,[!1,d]},useSyncExternalStore:function(d,p,_){var A=Dn,R=pt();if(si){if(_===void 0)throw Error(s(407));_=_()}else{if(_=p(),Hi===null)throw Error(s(349));Zn&60||mt(A,p,_)}R.memoizedState=_;var L={value:_,getSnapshot:p};return R.queue=L,Dg(Rt.bind(null,A,L,d),[d]),A.flags|=2048,Rs(9,gt.bind(null,A,L,_,p),{destroy:void 0},null),_},useId:function(){var d=pt(),p=Hi.identifierPrefix;if(si){var _=Bu,A=Nu;_=(A&~(1<<32-To(A)-1)).toString(32)+_,p=":"+p+"R"+_,_=OT++,0<_&&(p+="H"+_.toString(32)),p+=":"}else _=I$++,p=":"+p+"r"+_.toString(32)+":";return d.memoizedState=p},useCacheRefresh:function(){return pt().memoizedState=HJ.bind(null,Dn)}};bp.useMemoCache=k,bp.useHostTransitionStatus=Mw,bp.useFormState=Ti,bp.useActionState=Ti,bp.useOptimistic=function(d){var p=pt();p.memoizedState=p.baseState=d;var _={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return p.queue=_,p=Ew.bind(null,Dn,!0,_),_.dispatch=p,[d,p]};var nd={readContext:sa,use:vt,useCallback:VO,useContext:sa,useEffect:Ql,useImperativeHandle:zO,useInsertionEffect:OO,useLayoutEffect:FO,useMemo:HO,useReducer:de,useRef:Ma,useState:function(){return de(ie)},useDebugValue:Tw,useDeferredValue:function(d,p){var _=ct();return kO(_,Ni.memoizedState,d,p)},useTransition:function(){var d=de(ie)[0],p=ct().memoizedState;return[typeof d=="boolean"?d:Tt(d),p]},useSyncExternalStore:rt,useId:qO};nd.useCacheRefresh=jO,nd.useMemoCache=k,nd.useHostTransitionStatus=Mw,nd.useFormState=Pr,nd.useActionState=Pr,nd.useOptimistic=function(d,p){var _=ct();return tn(_,Ni,d,p)};var Sp={readContext:sa,use:vt,useCallback:VO,useContext:sa,useEffect:Ql,useImperativeHandle:zO,useInsertionEffect:OO,useLayoutEffect:FO,useMemo:HO,useReducer:he,useRef:Ma,useState:function(){return he(ie)},useDebugValue:Tw,useDeferredValue:function(d,p){var _=ct();return Ni===null?Aw(_,d,p):kO(_,Ni.memoizedState,d,p)},useTransition:function(){var d=he(ie)[0],p=ct().memoizedState;return[typeof d=="boolean"?d:Tt(d),p]},useSyncExternalStore:rt,useId:qO};Sp.useCacheRefresh=jO,Sp.useMemoCache=k,Sp.useHostTransitionStatus=Mw,Sp.useFormState=Ai,Sp.useActionState=Ai,Sp.useOptimistic=function(d,p){var _=ct();return Ni!==null?tn(_,Ni,d,p):(_.baseState=d,[d,_.queue.dispatch])};var LR={isMounted:function(d){return(d=d._reactInternals)?h(d)===d:!1},enqueueSetState:function(d,p,_){d=d._reactInternals;var A=bo(),R=Xe(A);R.payload=p,_!=null&&(R.callback=_),p=Qe(d,R,A),p!==null&&(Ea(p,d,A),Et(p,d,A))},enqueueReplaceState:function(d,p,_){d=d._reactInternals;var A=bo(),R=Xe(A);R.tag=1,R.payload=p,_!=null&&(R.callback=_),p=Qe(d,R,A),p!==null&&(Ea(p,d,A),Et(p,d,A))},enqueueForceUpdate:function(d,p){d=d._reactInternals;var _=bo(),A=Xe(_);A.tag=2,p!=null&&(A.callback=p),p=Qe(d,A,_),p!==null&&(Ea(p,d,_),Et(p,d,_))}},FG=typeof reportError=="function"?reportError:function(d){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var p=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof d=="object"&&d!==null&&typeof d.message=="string"?String(d.message):String(d),error:d});if(!window.dispatchEvent(p))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",d);return}console.error(d)},GG=Error(s(461)),yr=!1,UR={dehydrated:null,treeContext:null,retryLane:0},FT=v(null),Tp=null,Du=null,P$=typeof AbortController<"u"?AbortController:function(){var d=[],p=this.signal={aborted:!1,addEventListener:function(_,A){d.push(A)}};this.abort=function(){p.aborted=!0,d.forEach(function(_){return _()})}},O$=So.unstable_scheduleCallback,F$=So.unstable_NormalPriority,gs={$$typeof:Zh,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},zG=Sn.S;Sn.S=function(d,p){typeof p=="object"&&p!==null&&typeof p.then=="function"&&we(d,p),zG!==null&&zG(d,p)};var Ap=v(null),Lu=!1,ys=!1,IR=!1,VG=typeof WeakSet=="function"?WeakSet:Set,xr=null,HG=!1,Ws=null,Eo=!1,nc=null,e0=8192,G$={getCacheForType:function(d){var p=sa(gs),_=p.data.get(d);return _===void 0&&(_=d(),p.data.set(d,_)),_}},GT=0,zT=1,VT=2,HT=3,kT=4;if(typeof Symbol=="function"&&Symbol.for){var c_=Symbol.for;GT=c_("selector.component"),zT=c_("selector.has_pseudo_class"),VT=c_("selector.role"),HT=c_("selector.test_id"),kT=c_("selector.text")}var z$=typeof WeakMap=="function"?WeakMap:Map,Bi=0,Hi=null,zn=null,Zn=0,ki=0,Co=null,Uu=!1,t0=!1,PR=!1,Iu=0,xs=0,id=0,Mp=0,OR=0,ml=0,n0=0,u_=null,Bc=null,FR=!1,GR=0,h_=1/0,WT=null,sd=null,XT=!1,Ep=null,d_=0,zR=0,VR=null,f_=0,HR=null;return Gn.attemptContinuousHydration=function(d){if(d.tag===13){var p=at(d,67108864);p!==null&&Ea(p,d,67108864),lR(d,67108864)}},Gn.attemptHydrationAtCurrentPriority=function(d){if(d.tag===13){var p=bo(),_=at(d,p);_!==null&&Ea(_,d,p),lR(d,p)}},Gn.attemptSynchronousHydration=function(d){switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var p=T(d.pendingLanes);if(p!==0){for(d.pendingLanes|=2,d.entangledLanes|=2;p;){var _=1<<31-To(p);d.entanglements[1]|=_,p&=~_}st(d),!(Bi&6)&&(h_=ec()+500,Vt(0))}}break;case 13:p=at(d,2),p!==null&&Ea(p,d,2),VF(),lR(d,2)}},Gn.batchedUpdates=function(d,p){return d(p)},Gn.createComponentSelector=function(d){return{$$typeof:GT,value:d}},Gn.createContainer=function(d,p,_,A,R,L,q,oe,ve,je){return tG(d,p,!1,null,_,A,L,q,oe,ve,je,null)},Gn.createHasPseudoClassSelector=function(d){return{$$typeof:zT,value:d}},Gn.createHydrationContainer=function(d,p,_,A,R,L,q,oe,ve,je,bt,kt,Xt){return d=tG(_,A,!0,d,R,L,oe,ve,je,bt,kt,Xt),d.context=nG(null),_=d.current,A=bo(),R=Xe(A),R.callback=p??null,Qe(_,R,A),d.current.lanes=A,U(d,A),st(d),d},Gn.createPortal=function(d,p,_){var A=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Og,key:A==null?null:""+A,children:d,containerInfo:p,implementation:_}},Gn.createRoleSelector=function(d){return{$$typeof:VT,value:d}},Gn.createTestNameSelector=function(d){return{$$typeof:HT,value:d}},Gn.createTextSelector=function(d){return{$$typeof:kT,value:d}},Gn.defaultOnCaughtError=function(d){console.error(d)},Gn.defaultOnRecoverableError=function(d){FG(d)},Gn.defaultOnUncaughtError=function(d){FG(d)},Gn.deferredUpdates=function(d){var p=Sn.T,_=gp();try{return $a(32),Sn.T=null,d()}finally{$a(_),Sn.T=p}},Gn.discreteUpdates=function(d,p,_,A,R){var L=Sn.T,q=gp();try{return $a(2),Sn.T=null,d(p,_,A,R)}finally{$a(q),Sn.T=L,Bi===0&&(h_=ec()+500)}},Gn.findAllNodes=$w,Gn.findBoundingRects=function(d,p){if(!t_)throw Error(s(363));p=$w(d,p),d=[];for(var _=0;_<p.length;_++)d.push(DQ(p[_]));for(p=d.length-1;0<p;p--){_=d[p];for(var A=_.x,R=A+_.width,L=_.y,q=L+_.height,oe=p-1;0<=oe;oe--)if(p!==oe){var ve=d[oe],je=ve.x,bt=je+ve.width,kt=ve.y,Xt=kt+ve.height;if(A>=je&&L>=kt&&R<=bt&&q<=Xt){d.splice(p,1);break}else if(A!==je||_.width!==ve.width||Xt<L||kt>q){if(!(L!==kt||_.height!==ve.height||bt<A||je>R)){je>A&&(ve.width+=je-A,ve.x=A),bt<R&&(ve.width=R-je),d.splice(p,1);break}}else{kt>L&&(ve.height+=kt-L,ve.y=L),Xt<q&&(ve.height=q-kt),d.splice(p,1);break}}}return d},Gn.findHostInstance=iG,Gn.findHostInstanceWithNoPortals=function(d){return d=m(d),d=d!==null?x(d):null,d===null?null:e_(d.stateNode)},Gn.findHostInstanceWithWarning=function(d){return iG(d)},Gn.flushPassiveEffects=pp,Gn.flushSyncFromReconciler=function(d){var p=Bi;Bi|=1;var _=Sn.T,A=gp();try{if($a(2),Sn.T=null,d)return d()}finally{$a(A),Sn.T=_,Bi=p,!(Bi&6)&&Vt(0)}},Gn.flushSyncWork=VF,Gn.focusWithin=function(d,p){if(!t_)throw Error(s(363));for(d=Zw(d),p=OF(d,p),p=Array.from(p),d=0;d<p.length;){var _=p[d++],A=_.tag;if(!n_(_)){if((A===5||A===26||A===27)&&IQ(_.stateNode))return!0;for(_=_.child;_!==null;)p.push(_),_=_.sibling}}return!1},Gn.getFindAllNodesFailureDescription=function(d,p){if(!t_)throw Error(s(363));var _=0,A=[];d=[Zw(d),0];for(var R=0;R<d.length;){var L=d[R++],q=L.tag,oe=d[R++],ve=p[oe];if((q!==5&&q!==26&&q!==27||!n_(L))&&(Jw(L,ve)&&(A.push(Qw(ve)),oe++,oe>_&&(_=oe)),oe<p.length))for(L=L.child;L!==null;)d.push(L,oe),L=L.sibling}if(_<p.length){for(d=[];_<p.length;_++)d.push(Qw(p[_]));return`findAllNodes was able to match part of the selector:
  `+(A.join(" > ")+`

No matching component was found for:
  `)+d.join(" > ")}return null},Gn.getPublicRootInstance=function(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 27:case 5:return e_(d.child.stateNode);default:return d.child.stateNode}},Gn.injectIntoDevTools=function(){var d={bundleType:0,version:dQ,rendererPackageName:fQ,currentDispatcherRef:Sn,findFiberByHostInstance:pG,reconcilerVersion:"19.0.0"};if(hG!==null&&(d.rendererConfig=hG),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")d=!1;else{var p=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(p.isDisabled||!p.supportsFiber)d=!0;else{try{i_=p.inject(d),Ao=p}catch{}d=!!p.checkDCE}}return d},Gn.isAlreadyRendering=function(){return!1},Gn.observeVisibleRects=function(d,p,_,A){if(!t_)throw Error(s(363));d=$w(d,p);var R=PQ(d,_,A).disconnect;return{disconnect:function(){R()}}},Gn.shouldError=function(){return null},Gn.shouldSuspend=function(){return!1},Gn.startHostTransition=function(d,p,_,A){if(d.tag!==5)throw Error(s(476));var R=XO(d).queue;WO(d,R,p,Gg,_===null?n:function(){var L=XO(d).next.queue;return qx(d,L,{},bo()),_(A)})},Gn.updateContainer=function(d,p,_,A){var R=p.current,L=bo();return sG(R,L,d,p,_,A),L},Gn.updateContainerSync=function(d,p,_,A){return p.tag===0&&pp(),sG(p.current,2,d,p,_,A),2},Gn},i.exports.default=i.exports,Object.defineProperty(i.exports,"__esModule",{value:!0})})(XK);var eve=XK.exports;WK.exports=eve;var tve=WK.exports;const nve=k3(tve);function eO(i,e,t){if(!i)return;if(t(i)===!0)return i;let n=e?i.return:i.child;for(;n;){const s=eO(n,e,t);if(s)return s;n=e?null:n.sibling}}function YK(i){try{return Object.defineProperties(i,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return i}}const tO=YK($.createContext(null));class KK extends $.Component{render(){return $.createElement(tO.Provider,{value:this._reactInternals},this.props.children)}}function ZK(){const i=$.useContext(tO);if(i===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=$.useId();return $.useMemo(()=>{for(const t of[i,i==null?void 0:i.alternate]){if(!t)continue;const n=eO(t,!1,s=>{let r=s.memoizedState;for(;r;){if(r.memoizedState===e)return!0;r=r.next}});if(n)return n}},[i,e])}const ive=Symbol.for("react.context"),sve=i=>i!==null&&typeof i=="object"&&"$$typeof"in i&&i.$$typeof===ive;function rve(){const i=ZK(),[e]=$.useState(()=>new Map);e.clear();let t=i;for(;t;){const n=t.type;sve(n)&&n!==tO&&!e.has(n)&&e.set(n,$.use(YK(n))),t=t.return}return e}function ave(){const i=rve();return $.useMemo(()=>Array.from(i.keys()).reduce((e,t)=>n=>$.createElement(e,null,$.createElement(t.Provider,{...n,value:i.get(t)})),e=>$.createElement(KK,{...e})),[i])}function JK(i){let e=i.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const QK=i=>i&&i.isOrthographicCamera,ove=i=>i&&i.hasOwnProperty("current"),lve=i=>i!=null&&(typeof i=="string"||typeof i=="number"||i.isColor),lT=((i,e)=>typeof window<"u"&&(((i=window.document)==null?void 0:i.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?$.useLayoutEffect:$.useEffect;function $K(i){const e=$.useRef(i);return lT(()=>void(e.current=i),[i]),e}function cve(){const i=ZK(),e=ave();return $.useMemo(()=>({children:t})=>{const s=!!eO(i,!0,r=>r.type===$.StrictMode)?$.StrictMode:$.Fragment;return G.jsx(s,{children:G.jsx(e,{children:t})})},[i,e])}function uve({set:i}){return lT(()=>(i(new Promise(()=>null)),()=>i(!1)),[i]),null}const hve=(i=>(i=class extends $.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}},i.getDerivedStateFromError=()=>({error:!0}),i))();function eZ(i){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(i)?Math.min(Math.max(i[0],t),i[1]):i}function U0(i){var e;return(e=i.__r3f)==null?void 0:e.root.getState()}const es={obj:i=>i===Object(i)&&!es.arr(i)&&typeof i!="function",fun:i=>typeof i=="function",str:i=>typeof i=="string",num:i=>typeof i=="number",boo:i=>typeof i=="boolean",und:i=>i===void 0,nul:i=>i===null,arr:i=>Array.isArray(i),equ(i,e,{arrays:t="shallow",objects:n="reference",strict:s=!0}={}){if(typeof i!=typeof e||!!i!=!!e)return!1;if(es.str(i)||es.num(i)||es.boo(i))return i===e;const r=es.obj(i);if(r&&n==="reference")return i===e;const a=es.arr(i);if(a&&t==="reference")return i===e;if((a||r)&&i===e)return!0;let o;for(o in i)if(!(o in e))return!1;if(r&&t==="shallow"&&n==="shallow"){for(o in s?e:i)if(!es.equ(i[o],e[o],{strict:s,objects:"reference"}))return!1}else for(o in s?e:i)if(i[o]!==e[o])return!1;if(es.und(o)){if(a&&i.length===0&&e.length===0||r&&Object.keys(i).length===0&&Object.keys(e).length===0)return!0;if(i!==e)return!1}return!0}};function dve(i){const e={nodes:{},materials:{},meshes:{}};return i&&i.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material),t.isMesh&&!e.meshes[t.name]&&(e.meshes[t.name]=t)}),e}function fve(i){i.type!=="Scene"&&(i.dispose==null||i.dispose());for(const e in i){const t=i[e];(t==null?void 0:t.type)!=="Scene"&&(t==null||t.dispose==null||t.dispose())}}const tZ=["children","key","ref"];function pve(i){const e={};for(const t in i)tZ.includes(t)||(e[t]=i[t]);return e}function iE(i,e,t,n){const s=i;let r=s==null?void 0:s.__r3f;return r||(r={root:e,type:t,parent:null,children:[],props:pve(n),object:s,eventCount:0,handlers:{},isHidden:!1},s&&(s.__r3f=r)),r}function Ob(i,e){if(!e.includes("-"))return{root:i,key:e,target:i[e]};if(e in i)return{root:i,key:e,target:i[e]};let t=i;const n=e.split("-");for(const s of n){if(typeof t!="object"||t===null){if(t!==void 0){const r=n.slice(n.indexOf(s)).join("-");return{root:t,key:r,target:void 0}}return{root:i,key:e,target:void 0}}e=s,i=t,t=t[e]}return{root:i,key:e,target:t}}const _H=/-\d+$/;function sE(i,e){if(es.str(e.props.attach)){if(_H.test(e.props.attach)){const s=e.props.attach.replace(_H,""),{root:r,key:a}=Ob(i.object,s);Array.isArray(r[a])||(r[a]=[])}const{root:t,key:n}=Ob(i.object,e.props.attach);e.previousAttach=t[n],t[n]=e.object}else es.fun(e.props.attach)&&(e.previousAttach=e.props.attach(i.object,e.object))}function rE(i,e){if(es.str(e.props.attach)){const{root:t,key:n}=Ob(i.object,e.props.attach),s=e.previousAttach;s===void 0?delete t[n]:t[n]=s}else e.previousAttach==null||e.previousAttach(i.object,e.object);delete e.previousAttach}const f3=[...tZ,"args","dispose","attach","object","onUpdate","dispose"],vH=new Map;function mve(i){let e=vH.get(i.constructor);try{e||(e=new i.constructor,vH.set(i.constructor,e))}catch{}return e}function gve(i,e){const t={};for(const n in e)if(!f3.includes(n)&&!es.equ(e[n],i.props[n])){t[n]=e[n];for(const s in e)s.startsWith(`${n}-`)&&(t[s]=e[s])}for(const n in i.props){if(f3.includes(n)||e.hasOwnProperty(n))continue;const{root:s,key:r}=Ob(i.object,n);if(s.constructor&&s.constructor.length===0){const a=mve(s);es.und(a)||(t[r]=a[r])}else t[r]=0}return t}const yve=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],xve=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function Dd(i,e){var t;const n=i.__r3f,s=n&&JK(n).getState(),r=n==null?void 0:n.eventCount;for(const o in e){let l=e[o];if(f3.includes(o))continue;if(n&&xve.test(o)){typeof l=="function"?n.handlers[o]=l:delete n.handlers[o],n.eventCount=Object.keys(n.handlers).length;continue}if(l===void 0)continue;let{root:c,key:u,target:h}=Ob(i,o);if(h===void 0&&(typeof c!="object"||c===null))throw Error(`R3F: Cannot set "${o}". Ensure it is an object before setting "${u}".`);if(h instanceof $m&&l instanceof $m)h.mask=l.mask;else if(h instanceof Ye&&lve(l))h.set(l);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof h.copy=="function"&&l!=null&&l.constructor&&h.constructor===l.constructor)h.copy(l);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&Array.isArray(l))typeof h.fromArray=="function"?h.fromArray(l):h.set(...l);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof l=="number")typeof h.setScalar=="function"?h.setScalar(l):h.set(l);else{var a;c[u]=l,s&&!s.linear&&yve.includes(u)&&(a=c[u])!=null&&a.isTexture&&c[u].format===ii&&c[u].type===ei&&(c[u].colorSpace=Js)}}if(n!=null&&n.parent&&s!=null&&s.internal&&(t=n.object)!=null&&t.isObject3D&&r!==n.eventCount){const o=n.object,l=s.internal.interaction.indexOf(o);l>-1&&s.internal.interaction.splice(l,1),n.eventCount&&o.raycast!==null&&s.internal.interaction.push(o)}return n&&n.props.attach===void 0&&(n.object.isBufferGeometry?n.props.attach="geometry":n.object.isMaterial&&(n.props.attach="material")),n&&Xx(n),i}function Xx(i){var e;if(!i.parent)return;i.props.onUpdate==null||i.props.onUpdate(i.object);const t=(e=i.root)==null||e.getState==null?void 0:e.getState();t&&t.internal.frames===0&&t.invalidate()}function _ve(i,e){i.manual||(QK(i)?(i.left=e.width/-2,i.right=e.width/2,i.top=e.height/2,i.bottom=e.height/-2):i.aspect=e.width/e.height,i.updateProjectionMatrix())}const Ba=i=>i==null?void 0:i.isObject3D;function xA(i){return(i.eventObject||i.object).uuid+"/"+i.index+i.instanceId}function nZ(i,e,t,n){const s=t.get(e);s&&(t.delete(e),t.size===0&&(i.delete(n),s.target.releasePointerCapture(n)))}function vve(i,e){const{internal:t}=i.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,s)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(s)}),t.capturedMap.forEach((n,s)=>{nZ(t.capturedMap,e,n,s)})}function bve(i){function e(l){const{internal:c}=i.getState(),u=l.offsetX-c.initialClick[0],h=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function t(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=c.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function n(l,c){const u=i.getState(),h=new Set,f=[],m=c?c(u.internal.interaction):u.internal.interaction;for(let y=0;y<m.length;y++){const b=U0(m[y]);b&&(b.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(l,u);function g(y){const b=U0(y);if(!b||!b.events.enabled||b.raycaster.camera===null)return[];if(b.raycaster.camera===void 0){var S;b.events.compute==null||b.events.compute(l,b,(S=b.previousRoot)==null?void 0:S.getState()),b.raycaster.camera===void 0&&(b.raycaster.camera=null)}return b.raycaster.camera?b.raycaster.intersectObject(y,!0):[]}let x=m.flatMap(g).sort((y,b)=>{const S=U0(y.object),T=U0(b.object);return!S||!T?y.distance-b.distance:T.events.priority-S.events.priority||y.distance-b.distance}).filter(y=>{const b=xA(y);return h.has(b)?!1:(h.add(b),!0)});u.events.filter&&(x=u.events.filter(x,u));for(const y of x){let b=y.object;for(;b;){var v;(v=b.__r3f)!=null&&v.eventCount&&f.push({...y,eventObject:b}),b=b.parent}}if("pointerId"in l&&u.internal.capturedMap.has(l.pointerId))for(let y of u.internal.capturedMap.get(l.pointerId).values())h.has(xA(y.intersection))||f.push(y.intersection);return f}function s(l,c,u,h){if(l.length){const f={stopped:!1};for(const m of l){let g=U0(m.object);if(g||m.object.traverseAncestors(x=>{const v=U0(x);if(v)return g=v,!1}),g){const{raycaster:x,pointer:v,camera:y,internal:b}=g,S=new z(v.x,v.y,0).unproject(y),T=E=>{var B,U;return(B=(U=b.capturedMap.get(E))==null?void 0:U.has(m.eventObject))!=null?B:!1},M=E=>{const B={intersection:m,target:c.target};b.capturedMap.has(E)?b.capturedMap.get(E).set(m.eventObject,B):b.capturedMap.set(E,new Map([[m.eventObject,B]])),c.target.setPointerCapture(E)},C=E=>{const B=b.capturedMap.get(E);B&&nZ(b.capturedMap,m.eventObject,B,E)};let w={};for(let E in c){let B=c[E];typeof B!="function"&&(w[E]=B)}let N={...m,...w,pointer:v,intersections:l,stopped:f.stopped,delta:u,unprojectedPoint:S,ray:x.ray,camera:y,stopPropagation(){const E="pointerId"in c&&b.capturedMap.get(c.pointerId);if((!E||E.has(m.eventObject))&&(N.stopped=f.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(B=>B.eventObject===m.eventObject))){const B=l.slice(0,l.indexOf(m));r([...B,m])}},target:{hasPointerCapture:T,setPointerCapture:M,releasePointerCapture:C},currentTarget:{hasPointerCapture:T,setPointerCapture:M,releasePointerCapture:C},nativeEvent:c};if(h(N),f.stopped===!0)break}}}return l}function r(l){const{internal:c}=i.getState();for(const u of c.hovered.values())if(!l.length||!l.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const f=u.eventObject.__r3f;if(c.hovered.delete(xA(u)),f!=null&&f.eventCount){const m=f.handlers,g={...u,intersections:l};m.onPointerOut==null||m.onPointerOut(g),m.onPointerLeave==null||m.onPointerLeave(g)}}}function a(l,c){for(let u=0;u<c.length;u++){const h=c[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>r([]);case"onLostPointerCapture":return c=>{const{internal:u}=i.getState();"pointerId"in c&&u.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(c.pointerId)&&(u.capturedMap.delete(c.pointerId),r([]))})}}return function(u){const{onPointerMissed:h,internal:f}=i.getState();f.lastEvent.current=u;const m=l==="onPointerMove",g=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",v=n(u,m?t:void 0),y=g?e(u):0;l==="onPointerDown"&&(f.initialClick=[u.offsetX,u.offsetY],f.initialHits=v.map(S=>S.eventObject)),g&&!v.length&&y<=2&&(a(u,f.interaction),h&&h(u)),m&&r(v);function b(S){const T=S.eventObject,M=T.__r3f;if(!(M!=null&&M.eventCount))return;const C=M.handlers;if(m){if(C.onPointerOver||C.onPointerEnter||C.onPointerOut||C.onPointerLeave){const w=xA(S),N=f.hovered.get(w);N?N.stopped&&S.stopPropagation():(f.hovered.set(w,S),C.onPointerOver==null||C.onPointerOver(S),C.onPointerEnter==null||C.onPointerEnter(S))}C.onPointerMove==null||C.onPointerMove(S)}else{const w=C[l];w?(!g||f.initialHits.includes(T))&&(a(u,f.interaction.filter(N=>!f.initialHits.includes(N))),w(S)):g&&f.initialHits.includes(T)&&a(u,f.interaction.filter(N=>!f.initialHits.includes(N)))}}s(v,u,y,b)}}return{handlePointer:o}}const bH=i=>!!(i!=null&&i.render),iZ=$.createContext(null),Sve=(i,e)=>{const t=K_e((o,l)=>{const c=new z,u=new z,h=new z;function f(y=l().camera,b=u,S=l().size){const{width:T,height:M,top:C,left:w}=S,N=T/M;b.isVector3?h.copy(b):h.set(...b);const E=y.getWorldPosition(c).distanceTo(h);if(QK(y))return{width:T/y.zoom,height:M/y.zoom,top:C,left:w,factor:1,distance:E,aspect:N};{const B=y.fov*Math.PI/180,U=2*Math.tan(B/2)*E,H=U*(T/M);return{width:H,height:U,top:C,left:w,factor:T/H,distance:E,aspect:N}}}let m;const g=y=>o(b=>({performance:{...b.performance,current:y}})),x=new Ae;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(y=1)=>i(l(),y),advance:(y,b)=>e(y,b,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new EC,pointer:x,mouse:x,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const y=l();m&&clearTimeout(m),y.performance.current!==y.performance.min&&g(y.performance.min),m=setTimeout(()=>g(l().performance.max),y.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:f},setEvents:y=>o(b=>({...b,events:{...b.events,...y}})),setSize:(y,b,S=0,T=0)=>{const M=l().camera,C={width:y,height:b,top:S,left:T};o(w=>({size:C,viewport:{...w.viewport,...f(M,u,C)}}))},setDpr:y=>o(b=>{const S=eZ(y);return{viewport:{...b.viewport,dpr:S,initialDpr:b.viewport.initialDpr||S}}}),setFrameloop:(y="always")=>{const b=l().clock;b.stop(),b.elapsedTime=0,y!=="never"&&(b.start(),b.elapsedTime=0),o(()=>({frameloop:y}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:$.createRef(),active:!1,frames:0,priority:0,subscribe:(y,b,S)=>{const T=l().internal;return T.priority=T.priority+(b>0?1:0),T.subscribers.push({ref:y,priority:b,store:S}),T.subscribers=T.subscribers.sort((M,C)=>M.priority-C.priority),()=>{const M=l().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(b>0?1:0),M.subscribers=M.subscribers.filter(C=>C.ref!==y))}}}}}),n=t.getState();let s=n.size,r=n.viewport.dpr,a=n.camera;return t.subscribe(()=>{const{camera:o,size:l,viewport:c,gl:u,set:h}=t.getState();if(l.width!==s.width||l.height!==s.height||c.dpr!==r){s=l,r=c.dpr,_ve(o,l),c.dpr>0&&u.setPixelRatio(c.dpr);const f=typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(l.width,l.height,f)}o!==a&&(a=o,h(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(o)}})))}),t.subscribe(o=>i(o)),t};function sZ(){const i=$.useContext(iZ);if(!i)throw new Error("R3F: Hooks can only be used within the Canvas component!");return i}function ts(i=t=>t,e){return sZ()(i,e)}function yu(i,e=0){const t=sZ(),n=t.getState().internal.subscribe,s=$K(i);return lT(()=>n(s,e,t),[e,n,t]),null}const SH=new WeakMap,Tve=i=>{var e;return typeof i=="function"&&(i==null||(e=i.prototype)==null?void 0:e.constructor)===i};function rZ(i,e){return function(t,...n){let s;return Tve(t)?(s=SH.get(t),s||(s=new t,SH.set(t,s))):s=t,i&&i(s),Promise.all(n.map(r=>new Promise((a,o)=>s.load(r,l=>{Ba(l==null?void 0:l.scene)&&Object.assign(l,dve(l.scene)),a(l)},e,l=>o(new Error(`Could not load ${r}: ${l==null?void 0:l.message}`))))))}}function Kl(i,e,t,n){const s=Array.isArray(e)?e:[e],r=J_e(rZ(t,n),[i,...s],{equal:es.equ});return Array.isArray(e)?r:r[0]}Kl.preload=function(i,e,t){const n=Array.isArray(e)?e:[e];return Q_e(rZ(t),[i,...n])};Kl.clear=function(i,e){const t=Array.isArray(e)?e:[e];return $_e([i,...t])};function Ave(i){const e=nve(i);return e.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:$.version}),e}const aZ=0,tx={},Mve=/^three(?=[A-Z])/,_w=i=>`${i[0].toUpperCase()}${i.slice(1)}`;let Eve=0;const Cve=i=>typeof i=="function";function oZ(i){if(Cve(i)){const e=`${Eve++}`;return tx[e]=i,e}else Object.assign(tx,i)}function lZ(i,e){const t=_w(i),n=tx[t];if(i!=="primitive"&&!n)throw new Error(`R3F: ${t} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(i==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function wve(i,e,t){var n;return i=_w(i)in tx?i:i.replace(Mve,""),lZ(i,e),i==="primitive"&&(n=e.object)!=null&&n.__r3f&&delete e.object.__r3f,iE(e.object,t,i,e)}function Rve(i){if(!i.isHidden){var e;i.props.attach&&(e=i.parent)!=null&&e.object?rE(i.parent,i):Ba(i.object)&&(i.object.visible=!1),i.isHidden=!0,Xx(i)}}function cZ(i){if(i.isHidden){var e;i.props.attach&&(e=i.parent)!=null&&e.object?sE(i.parent,i):Ba(i.object)&&i.props.visible!==!1&&(i.object.visible=!0),i.isHidden=!1,Xx(i)}}function nO(i,e,t){const n=e.root.getState();if(!(!i.parent&&i.object!==n.scene)){if(!e.object){var s,r;const a=tx[_w(e.type)];e.object=(s=e.props.object)!=null?s:new a(...(r=e.props.args)!=null?r:[]),e.object.__r3f=e}if(Dd(e.object,e.props),e.props.attach)sE(i,e);else if(Ba(e.object)&&Ba(i.object)){const a=i.object.children.indexOf(t==null?void 0:t.object);if(t&&a!==-1){const o=i.object.children.indexOf(e.object);if(o!==-1){i.object.children.splice(o,1);const l=o<a?a-1:a;i.object.children.splice(l,0,e.object)}else e.object.parent=i.object,i.object.children.splice(a,0,e.object),e.object.dispatchEvent({type:"added"}),i.object.dispatchEvent({type:"childadded",child:e.object})}else i.object.add(e.object)}for(const a of e.children)nO(e,a);Xx(e)}}function j2(i,e){e&&(e.parent=i,i.children.push(e),nO(i,e))}function TH(i,e,t){if(!e||!t)return;e.parent=i;const n=i.children.indexOf(t);n!==-1?i.children.splice(n,0,e):i.children.push(e),nO(i,e,t)}function uZ(i){if(typeof i.dispose=="function"){const e=()=>{try{i.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():d3.unstable_scheduleCallback(d3.unstable_IdlePriority,e)}}function p3(i,e,t){if(!e)return;e.parent=null;const n=i.children.indexOf(e);n!==-1&&i.children.splice(n,1),e.props.attach?rE(i,e):Ba(e.object)&&Ba(i.object)&&(i.object.remove(e.object),vve(JK(e),e.object));const s=e.props.dispose!==null&&t!==!1;for(let r=e.children.length-1;r>=0;r--){const a=e.children[r];p3(e,a,s)}e.children.length=0,delete e.object.__r3f,s&&e.type!=="primitive"&&e.object.type!=="Scene"&&uZ(e.object),t===void 0&&Xx(e)}function Nve(i,e){for(const t of[i,i.alternate])if(t!==null)if(typeof t.ref=="function"){t.refCleanup==null||t.refCleanup();const n=t.ref(e);typeof n=="function"&&(t.refCleanup=n)}else t.ref&&(t.ref.current=e)}const ZA=[];function Bve(){for(const[t]of ZA){const n=t.parent;if(n){t.props.attach?rE(n,t):Ba(t.object)&&Ba(n.object)&&n.object.remove(t.object);for(const s of t.children)s.props.attach?rE(t,s):Ba(s.object)&&Ba(t.object)&&t.object.remove(s.object)}t.isHidden&&cZ(t),t.object.__r3f&&delete t.object.__r3f,t.type!=="primitive"&&uZ(t.object)}for(const[t,n,s]of ZA){t.props=n;const r=t.parent;if(r){var i,e;const a=tx[_w(t.type)];t.object=(i=t.props.object)!=null?i:new a(...(e=t.props.args)!=null?e:[]),t.object.__r3f=t,Nve(s,t.object),Dd(t.object,t.props),t.props.attach?sE(r,t):Ba(t.object)&&Ba(r.object)&&r.object.add(t.object);for(const o of t.children)o.props.attach?sE(t,o):Ba(o.object)&&Ba(t.object)&&t.object.add(o.object);Xx(t)}}ZA.length=0}const Y2=()=>{},AH={};let _A=aZ;const Dve=0,Lve=4,m3=Ave({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:wve,removeChild:p3,appendChild:j2,appendInitialChild:j2,insertBefore:TH,appendChildToContainer(i,e){const t=i.getState().scene.__r3f;!e||!t||j2(t,e)},removeChildFromContainer(i,e){const t=i.getState().scene.__r3f;!e||!t||p3(t,e)},insertInContainerBefore(i,e,t){const n=i.getState().scene.__r3f;!e||!t||!n||TH(n,e,t)},getRootHostContext:()=>AH,getChildHostContext:()=>AH,commitUpdate(i,e,t,n,s){var r,a,o;lZ(e,n);let l=!1;if((i.type==="primitive"&&t.object!==n.object||((r=n.args)==null?void 0:r.length)!==((a=t.args)==null?void 0:a.length)||(o=n.args)!=null&&o.some((u,h)=>{var f;return u!==((f=t.args)==null?void 0:f[h])}))&&(l=!0),l)ZA.push([i,{...n},s]);else{const u=gve(i,n);Object.keys(u).length&&(Object.assign(i.props,u),Dd(i.object,u))}(s.sibling===null||(s.flags&Lve)===Dve)&&Bve()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:i=>i==null?void 0:i.object,prepareForCommit:()=>null,preparePortalMount:i=>iE(i.getState().scene,i,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:Rve,unhideInstance:cZ,createTextInstance:Y2,hideTextInstance:Y2,unhideTextInstance:Y2,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:$.createContext(null),setCurrentUpdatePriority(i){_A=i},getCurrentUpdatePriority(){return _A},resolveUpdatePriority(){var i;if(_A!==aZ)return _A;switch(typeof window<"u"&&((i=window.event)==null?void 0:i.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return KA.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return KA.ContinuousEventPriority;default:return KA.DefaultEventPriority}},resetFormInstance(){}}),ag=new Map,I0={objects:"shallow",strict:!1};function Uve(i,e){if(!e&&typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement&&i.parentElement){const{width:t,height:n,top:s,left:r}=i.parentElement.getBoundingClientRect();return{width:t,height:n,top:s,left:r}}else if(!e&&typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function Ive(i){const e=ag.get(i),t=e==null?void 0:e.fiber,n=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,r=n||Sve(x3,EH),a=t||m3.createContainer(r,KA.ConcurrentRoot,null,!1,null,"",s,s,s,null);e||ag.set(i,{fiber:a,store:r});let o,l,c=!1,u=null;return{async configure(h={}){let f;u=new Promise(ge=>f=ge);let{gl:m,size:g,scene:x,events:v,onCreated:y,shadows:b=!1,linear:S=!1,flat:T=!1,legacy:M=!1,orthographic:C=!1,frameloop:w="always",dpr:N=[1,2],performance:E,raycaster:B,camera:U,onPointerMissed:H}=h,F=r.getState(),V=F.gl;if(!F.gl){const ge={canvas:i,powerPreference:"high-performance",antialias:!0,alpha:!0},Te=typeof m=="function"?await m(ge):m;bH(Te)?V=Te:V=new yw({...ge,...m}),F.set({gl:V})}let Y=F.raycaster;Y||F.set({raycaster:Y=new YU});const{params:P,...X}=B||{};if(es.equ(X,Y,I0)||Dd(Y,{...X}),es.equ(P,Y.params,I0)||Dd(Y,{params:{...Y.params,...P}}),!F.camera||F.camera===l&&!es.equ(l,U,I0)){l=U;const ge=U==null?void 0:U.isCamera,Te=ge?U:C?new Dr(0,0,0,0,.1,1e3):new Ci(75,0,.1,1e3);ge||(Te.position.z=5,U&&(Dd(Te,U),Te.manual||("aspect"in U||"left"in U||"right"in U||"bottom"in U||"top"in U)&&(Te.manual=!0,Te.updateProjectionMatrix())),!F.camera&&!(U!=null&&U.rotation)&&Te.lookAt(0,0,0)),F.set({camera:Te}),Y.camera=Te}if(!F.scene){let ge;x!=null&&x.isScene?(ge=x,iE(ge,r,"",{})):(ge=new fu,iE(ge,r,"",{}),x&&Dd(ge,x)),F.set({scene:ge})}v&&!F.events.handlers&&F.set({events:v(r)});const J=Uve(i,g);if(es.equ(J,F.size,I0)||F.setSize(J.width,J.height,J.top,J.left),N&&F.viewport.dpr!==eZ(N)&&F.setDpr(N),F.frameloop!==w&&F.setFrameloop(w),F.onPointerMissed||F.set({onPointerMissed:H}),E&&!es.equ(E,F.performance,I0)&&F.set(ge=>({performance:{...ge.performance,...E}})),!F.xr){var re;const ge=(et,wt)=>{const be=r.getState();be.frameloop!=="never"&&EH(et,!0,be,wt)},Te=()=>{const et=r.getState();et.gl.xr.enabled=et.gl.xr.isPresenting,et.gl.xr.setAnimationLoop(et.gl.xr.isPresenting?ge:null),et.gl.xr.isPresenting||x3(et)},Be={connect(){const et=r.getState().gl;et.xr.addEventListener("sessionstart",Te),et.xr.addEventListener("sessionend",Te)},disconnect(){const et=r.getState().gl;et.xr.removeEventListener("sessionstart",Te),et.xr.removeEventListener("sessionend",Te)}};typeof((re=V.xr)==null?void 0:re.addEventListener)=="function"&&Be.connect(),F.set({xr:Be})}if(V.shadowMap){const ge=V.shadowMap.enabled,Te=V.shadowMap.type;if(V.shadowMap.enabled=!!b,es.boo(b))V.shadowMap.type=gy;else if(es.str(b)){var ne;const Be={basic:FE,percentage:tf,soft:gy,variance:Dl};V.shadowMap.type=(ne=Be[b])!=null?ne:gy}else es.obj(b)&&Object.assign(V.shadowMap,b);(ge!==V.shadowMap.enabled||Te!==V.shadowMap.type)&&(V.shadowMap.needsUpdate=!0)}return en.enabled=!M,c||(V.outputColorSpace=S?Jr:Js,V.toneMapping=T?Ki:pg),F.legacy!==M&&F.set(()=>({legacy:M})),F.linear!==S&&F.set(()=>({linear:S})),F.flat!==T&&F.set(()=>({flat:T})),m&&!es.fun(m)&&!bH(m)&&!es.equ(m,V,I0)&&Dd(V,m),o=y,c=!0,f(),this},render(h){return!c&&!u&&this.configure(),u.then(()=>{m3.updateContainer(G.jsx(Pve,{store:r,children:h,onCreated:o,rootElement:i}),a,null,()=>{})}),r},unmount(){hZ(i)}}}function Pve({store:i,children:e,onCreated:t,rootElement:n}){return lT(()=>{const s=i.getState();s.set(r=>({internal:{...r.internal,active:!0}})),t&&t(s),i.getState().events.connected||s.events.connect==null||s.events.connect(n)},[]),G.jsx(iZ.Provider,{value:i,children:e})}function hZ(i,e){const t=ag.get(i),n=t==null?void 0:t.fiber;if(n){const s=t==null?void 0:t.store.getState();s&&(s.internal.active=!1),m3.updateContainer(null,n,null,()=>{s&&setTimeout(()=>{try{var r,a,o,l;s.events.disconnect==null||s.events.disconnect(),(r=s.gl)==null||(a=r.renderLists)==null||a.dispose==null||a.dispose(),(o=s.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=s.gl)!=null&&l.xr&&s.xr.disconnect(),fve(s.scene),ag.delete(i)}catch{}},500)})}}const Ove=new Set,Fve=new Set,Gve=new Set;function K2(i,e){if(i.size)for(const{callback:t}of i.values())t(e)}function Zv(i,e){switch(i){case"before":return K2(Ove,e);case"after":return K2(Fve,e);case"tail":return K2(Gve,e)}}let Z2,J2;function g3(i,e,t){let n=e.clock.getDelta();e.frameloop==="never"&&typeof i=="number"&&(n=i-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=i),Z2=e.internal.subscribers;for(let s=0;s<Z2.length;s++)J2=Z2[s],J2.ref.current(J2.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let aE=!1,y3=!1,Q2,MH,P0;function dZ(i){MH=requestAnimationFrame(dZ),aE=!0,Q2=0,Zv("before",i),y3=!0;for(const t of ag.values()){var e;P0=t.store.getState(),P0.internal.active&&(P0.frameloop==="always"||P0.internal.frames>0)&&!((e=P0.gl.xr)!=null&&e.isPresenting)&&(Q2+=g3(i,P0))}if(y3=!1,Zv("after",i),Q2===0)return Zv("tail",i),aE=!1,cancelAnimationFrame(MH)}function x3(i,e=1){var t;if(!i)return ag.forEach(n=>x3(n.store.getState(),e));(t=i.gl.xr)!=null&&t.isPresenting||!i.internal.active||i.frameloop==="never"||(e>1?i.internal.frames=Math.min(60,i.internal.frames+e):y3?i.internal.frames=2:i.internal.frames=1,aE||(aE=!0,requestAnimationFrame(dZ)))}function EH(i,e=!0,t,n){if(e&&Zv("before",i),t)g3(i,t,n);else for(const s of ag.values())g3(i,s.store.getState());e&&Zv("after",i)}const $2={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function zve(i){const{handlePointer:e}=bve(i);return{priority:1,enabled:!0,compute(t,n,s){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys($2).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:s}=i.getState();(t=s.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(s.lastEvent.current)},connect:t=>{const{set:n,events:s}=i.getState();if(s.disconnect==null||s.disconnect(),n(r=>({events:{...r.events,connected:t}})),s.handlers)for(const r in s.handlers){const a=s.handlers[r],[o,l]=$2[r];t.addEventListener(o,a,{passive:l})}},disconnect:()=>{const{set:t,events:n}=i.getState();if(n.connected){if(n.handlers)for(const s in n.handlers){const r=n.handlers[s],[a]=$2[s];n.connected.removeEventListener(a,r)}t(s=>({events:{...s.events,connected:void 0}}))}}}}function CH(i,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>i(...n),e)}}function Vve({debounce:i,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const s=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[r,a]=$.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=$.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:r,orientationHandler:null}),l=i?typeof i=="number"?i:i.scroll:null,c=i?typeof i=="number"?i:i.resize:null,u=$.useRef(!1);$.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,f,m]=$.useMemo(()=>{const y=()=>{if(!o.current.element)return;const{left:b,top:S,width:T,height:M,bottom:C,right:w,x:N,y:E}=o.current.element.getBoundingClientRect(),B={left:b,top:S,width:T,height:M,bottom:C,right:w,x:N,y:E};o.current.element instanceof HTMLElement&&n&&(B.height=o.current.element.offsetHeight,B.width=o.current.element.offsetWidth),Object.freeze(B),u.current&&!Xve(o.current.lastBounds,B)&&a(o.current.lastBounds=B)};return[y,c?CH(y,c):y,l?CH(y,l):y]},[a,n,l,c]);function g(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(y=>y.removeEventListener("scroll",m,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function x(){o.current.element&&(o.current.resizeObserver=new s(m),o.current.resizeObserver.observe(o.current.element),e&&o.current.scrollContainers&&o.current.scrollContainers.forEach(y=>y.addEventListener("scroll",m,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{m()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const v=y=>{!y||y===o.current.element||(g(),o.current.element=y,o.current.scrollContainers=fZ(y),x())};return kve(m,!!e),Hve(f),$.useEffect(()=>{g(),x()},[e,m,f]),$.useEffect(()=>g,[]),[v,r,h]}function Hve(i){$.useEffect(()=>{const e=i;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[i])}function kve(i,e){$.useEffect(()=>{if(e){const t=i;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[i,e])}function fZ(i){const e=[];if(!i||i===document.body)return e;const{overflow:t,overflowX:n,overflowY:s}=window.getComputedStyle(i);return[t,n,s].some(r=>r==="auto"||r==="scroll")&&e.push(i),[...e,...fZ(i.parentElement)]}const Wve=["x","y","top","bottom","left","right","width","height"],Xve=(i,e)=>Wve.every(t=>i[t]===e[t]);function qve({ref:i,children:e,fallback:t,resize:n,style:s,gl:r,events:a=zve,eventSource:o,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:f,orthographic:m,frameloop:g,dpr:x,performance:v,raycaster:y,camera:b,scene:S,onPointerMissed:T,onCreated:M,...C}){$.useMemo(()=>oZ(Vxe),[]);const w=cve(),[N,E]=Vve({scroll:!0,debounce:{scroll:50,resize:0},...n}),B=$.useRef(null),U=$.useRef(null);$.useImperativeHandle(i,()=>B.current);const H=$K(T),[F,V]=$.useState(!1),[Y,P]=$.useState(!1);if(F)throw F;if(Y)throw Y;const X=$.useRef(null);lT(()=>{const re=B.current;if(E.width>0&&E.height>0&&re){X.current||(X.current=Ive(re));async function ne(){await X.current.configure({gl:r,scene:S,events:a,shadows:c,linear:u,flat:h,legacy:f,orthographic:m,frameloop:g,dpr:x,performance:v,raycaster:y,camera:b,size:E,onPointerMissed:(...ge)=>H.current==null?void 0:H.current(...ge),onCreated:ge=>{ge.events.connect==null||ge.events.connect(o?ove(o)?o.current:o:U.current),l&&ge.setEvents({compute:(Te,Be)=>{const et=Te[l+"X"],wt=Te[l+"Y"];Be.pointer.set(et/Be.size.width*2-1,-(wt/Be.size.height)*2+1),Be.raycaster.setFromCamera(Be.pointer,Be.camera)}}),M==null||M(ge)}}),X.current.render(G.jsx(w,{children:G.jsx(hve,{set:P,children:G.jsx($.Suspense,{fallback:G.jsx(uve,{set:V}),children:e??null})})}))}ne()}}),$.useEffect(()=>{const re=B.current;if(re)return()=>hZ(re)},[]);const J=o?"none":"auto";return G.jsx("div",{ref:U,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:J,...s},...C,children:G.jsx("div",{ref:N,style:{width:"100%",height:"100%"},children:G.jsx("canvas",{ref:B,style:{display:"block"},children:t})})})}function jve(i){return G.jsx(KK,{children:G.jsx(qve,{...i})})}const Yve=Symbol(),iO=Symbol(),gv="a",pZ="f",wH="p",mZ="c",gZ="t",sO="h",Jv="w",rO="o",aO="k";let Kve=(i,e)=>new Proxy(i,e);const _3=Object.getPrototypeOf,v3=new WeakMap,yZ=i=>i&&(v3.has(i)?v3.get(i):_3(i)===Object.prototype||_3(i)===Array.prototype),oE=i=>typeof i=="object"&&i!==null,Zve=i=>Object.values(Object.getOwnPropertyDescriptors(i)).some(e=>!e.configurable&&!e.writable),Jve=i=>{if(Array.isArray(i))return Array.from(i);const e=Object.getOwnPropertyDescriptors(i);return Object.values(e).forEach(t=>{t.configurable=!0}),Object.create(_3(i),e)},Qve=(i,e)=>{const t={[pZ]:e};let n=!1;const s=(o,l)=>{if(!n){let c=t[gv].get(i);if(c||(c={},t[gv].set(i,c)),o===Jv)c[Jv]=!0;else{let u=c[o];u||(u=new Set,c[o]=u),u.add(l)}}},r=()=>{n=!0,t[gv].delete(i)},a={get(o,l){return l===iO?i:(s(aO,l),xZ(Reflect.get(o,l),t[gv],t[mZ],t[gZ]))},has(o,l){return l===Yve?(r(),!0):(s(sO,l),Reflect.has(o,l))},getOwnPropertyDescriptor(o,l){return s(rO,l),Reflect.getOwnPropertyDescriptor(o,l)},ownKeys(o){return s(Jv),Reflect.ownKeys(o)}};return e&&(a.set=a.deleteProperty=()=>!1),[a,t]},oO=i=>i[iO]||i,xZ=(i,e,t,n)=>{if(!yZ(i))return i;let s=n&&n.get(i);if(!s){const l=oO(i);Zve(l)?s=[l,Jve(l)]:s=[l],n==null||n.set(i,s)}const[r,a]=s;let o=t&&t.get(r);return(!o||o[1][pZ]!==!!a)&&(o=Qve(r,!!a),o[1][wH]=Kve(a||r,o[0]),t&&t.set(r,o)),o[1][gv]=e,o[1][mZ]=t,o[1][gZ]=n,o[1][wH]},$ve=(i,e)=>{const t=Reflect.ownKeys(i),n=Reflect.ownKeys(e);return t.length!==n.length||t.some((s,r)=>s!==n[r])},_Z=(i,e,t,n,s=Object.is)=>{if(s(i,e))return!1;if(!oE(i)||!oE(e))return!0;const r=t.get(oO(i));if(!r)return!0;if(n){if(n.get(i)===e)return!1;n.set(i,e)}let a=null;for(const o of r[sO]||[])if(a=Reflect.has(i,o)!==Reflect.has(e,o),a)return a;if(r[Jv]===!0){if(a=$ve(i,e),a)return a}else for(const o of r[rO]||[]){const l=!!Reflect.getOwnPropertyDescriptor(i,o),c=!!Reflect.getOwnPropertyDescriptor(e,o);if(a=l!==c,a)return a}for(const o of r[aO]||[])if(a=_Z(i[o],e[o],t,n,s),a)return a;if(a===null)throw new Error("invalid used");return a},ebe=i=>yZ(i)&&i[iO]||null,RH=(i,e=!0)=>{v3.set(i,e)},tbe=(i,e,t)=>{const n=[],s=new WeakSet,r=(a,o)=>{var l,c,u;if(s.has(a))return;oE(a)&&s.add(a);const h=oE(a)&&e.get(oO(a));if(h){if((l=h[sO])===null||l===void 0||l.forEach(f=>{const m=`:has(${String(f)})`;n.push(o?[...o,m]:[m])}),h[Jv]===!0){const f=":ownKeys";n.push(o?[...o,f]:[f])}else(c=h[rO])===null||c===void 0||c.forEach(f=>{const m=`:hasOwn(${String(f)})`;n.push(o?[...o,m]:[m])});(u=h[aO])===null||u===void 0||u.forEach(f=>{"value"in(Object.getOwnPropertyDescriptor(a,f)||{})&&r(a[f],o?[...o,f]:[f])})}else o&&n.push(o)};return r(i),n},lE={},lO=i=>typeof i=="object"&&i!==null,nbe=i=>lO(i)&&!cO.has(i)&&(Array.isArray(i)||!(Symbol.iterator in i))&&!(i instanceof WeakMap)&&!(i instanceof WeakSet)&&!(i instanceof Error)&&!(i instanceof Number)&&!(i instanceof Date)&&!(i instanceof String)&&!(i instanceof RegExp)&&!(i instanceof ArrayBuffer)&&!(i instanceof Promise),vZ=(i,e)=>{const t=NH.get(i);if((t==null?void 0:t[0])===e)return t[1];const n=Array.isArray(i)?[]:Object.create(Object.getPrototypeOf(i));return RH(n,!0),NH.set(i,[e,n]),Reflect.ownKeys(i).forEach(s=>{if(Object.getOwnPropertyDescriptor(n,s))return;const r=Reflect.get(i,s),{enumerable:a}=Reflect.getOwnPropertyDescriptor(i,s),o={value:r,enumerable:a,configurable:!0};if(cO.has(r))RH(r,!1);else if(og.has(r)){const[l,c]=og.get(r);o.value=vZ(l,c())}Object.defineProperty(n,s,o)}),Object.preventExtensions(n)},ibe=(i,e,t,n)=>({deleteProperty(s,r){const a=Reflect.get(s,r);t(r);const o=Reflect.deleteProperty(s,r);return o&&n(["delete",[r],a]),o},set(s,r,a,o){const l=!i()&&Reflect.has(s,r),c=Reflect.get(s,r,o);if(l&&(BH(c,a)||cE.has(a)&&BH(c,cE.get(a))))return!0;t(r),lO(a)&&(a=ebe(a)||a);const u=!og.has(a)&&rbe(a)?bZ(a):a;return e(r,u),Reflect.set(s,r,u,o),n(["set",[r],a,c]),!0}}),og=new WeakMap,cO=new WeakSet,NH=new WeakMap,eB=[1],cE=new WeakMap;let BH=Object.is,sbe=(i,e)=>new Proxy(i,e),rbe=nbe,abe=vZ,obe=ibe;function bZ(i={}){if(!lO(i))throw new Error("object required");const e=cE.get(i);if(e)return e;let t=eB[0];const n=new Set,s=(v,y=++eB[0])=>{t!==y&&(r=t=y,n.forEach(b=>b(v,y)))};let r=t;const a=(v=eB[0])=>(r!==v&&(r=v,l.forEach(([y])=>{const b=y[1](v);b>t&&(t=b)})),t),o=v=>(y,b)=>{const S=[...y];S[1]=[v,...S[1]],s(S,b)},l=new Map,c=(v,y)=>{const b=!cO.has(y)&&og.get(y);if(b){if((lE?"production":void 0)!=="production"&&l.has(v))throw new Error("prop listener already exists");if(n.size){const S=b[2](o(v));l.set(v,[b,S])}else l.set(v,[b])}},u=v=>{var y;const b=l.get(v);b&&(l.delete(v),(y=b[1])==null||y.call(b))},h=v=>(n.add(v),n.size===1&&l.forEach(([b,S],T)=>{if((lE?"production":void 0)!=="production"&&S)throw new Error("remove already exists");const M=b[2](o(T));l.set(T,[b,M])}),()=>{n.delete(v),n.size===0&&l.forEach(([b,S],T)=>{S&&(S(),l.set(T,[b]))})});let f=!0;const m=obe(()=>f,c,u,s),g=sbe(i,m);cE.set(i,g);const x=[i,a,h];return og.set(g,x),Reflect.ownKeys(i).forEach(v=>{const y=Object.getOwnPropertyDescriptor(i,v);"value"in y&&y.writable&&(g[v]=i[v])}),f=!1,g}function lbe(i,e,t){const n=og.get(i);(lE?"production":void 0)!=="production"&&!n&&console.warn("Please use proxy object");let s;const r=[],a=n[2];let o=!1;const c=a(u=>{r.push(u),s||(s=Promise.resolve().then(()=>{s=void 0,o&&e(r.splice(0))}))});return o=!0,()=>{o=!1,c()}}function DH(i){const e=og.get(i);(lE?"production":void 0)!=="production"&&!e&&console.warn("Please use proxy object");const[t,n]=e;return abe(t,n())}const cbe={},ube=(i,e)=>{const t=$.useRef(void 0);$.useEffect(()=>{t.current=tbe(i,e)}),$.useDebugValue(t.current)},hbe=ube,dbe=new WeakMap;function qi(i,e){const n=$.useMemo(()=>i&&new WeakMap,[i]),s=$.useRef(void 0);let r=!0;const a=$.useSyncExternalStore($.useCallback(l=>{const c=lbe(i,l);return l(),c},[i,void 0]),()=>{const l=DH(i);try{if(!r&&s.current&&!_Z(s.current,l,n,new WeakMap))return s.current}catch{}return l},()=>DH(i));r=!1,$.useLayoutEffect(()=>{s.current=a}),(cbe?"production":void 0)!=="production"&&hbe(a,n);const o=$.useMemo(()=>new WeakMap,[]);return xZ(a,n,o,dbe)}function Yu(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function SZ(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.__proto__=e}/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var Qo={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},nx={duration:.5,overwrite:!1,delay:0},uO,Kr,is,Fl=1e8,Gi=1/Fl,b3=Math.PI*2,fbe=b3/4,pbe=0,TZ=Math.sqrt,mbe=Math.cos,gbe=Math.sin,Ur=function(e){return typeof e=="string"},Ms=function(e){return typeof e=="function"},Uh=function(e){return typeof e=="number"},hO=function(e){return typeof e>"u"},xu=function(e){return typeof e=="object"},oo=function(e){return e!==!1},dO=function(){return typeof window<"u"},vA=function(e){return Ms(e)||Ur(e)},AZ=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},ba=Array.isArray,S3=/(?:-?\.?\d|\.)+/gi,MZ=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,ay=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,tB=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,EZ=/[+-]=-?[.\d]+/,CZ=/[^,'"\[\]\s]+/gi,ybe=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,ds,Hc,T3,fO,sl={},uE={},wZ,RZ=function(e){return(uE=ix(e,sl))&&mo},pO=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Fb=function(e,t){return!t&&console.warn(e)},NZ=function(e,t){return e&&(sl[e]=t)&&uE&&(uE[e]=t)||sl},Gb=function(){return 0},xbe={suppressEvents:!0,isStart:!0,kill:!1},JA={suppressEvents:!0,kill:!1},_be={suppressEvents:!0},mO={},af=[],A3={},BZ,Fo={},nB={},LH=30,QA=[],gO="",yO=function(e){var t=e[0],n,s;if(xu(t)||Ms(t)||(e=[e]),!(n=(t._gsap||{}).harness)){for(s=QA.length;s--&&!QA[s].targetTest(t););n=QA[s]}for(s=e.length;s--;)e[s]&&(e[s]._gsap||(e[s]._gsap=new tJ(e[s],n)))||e.splice(s,1);return e},wm=function(e){return e._gsap||yO(Gl(e))[0]._gsap},DZ=function(e,t,n){return(n=e[t])&&Ms(n)?e[t]():hO(n)&&e.getAttribute&&e.getAttribute(t)||n},lo=function(e,t){return(e=e.split(",")).forEach(t)||e},Us=function(e){return Math.round(e*1e5)/1e5||0},Qs=function(e){return Math.round(e*1e7)/1e7||0},wy=function(e,t){var n=t.charAt(0),s=parseFloat(t.substr(2));return e=parseFloat(e),n==="+"?e+s:n==="-"?e-s:n==="*"?e*s:e/s},vbe=function(e,t){for(var n=t.length,s=0;e.indexOf(t[s])<0&&++s<n;);return s<n},hE=function(){var e=af.length,t=af.slice(0),n,s;for(A3={},af.length=0,n=0;n<e;n++)s=t[n],s&&s._lazy&&(s.render(s._lazy[0],s._lazy[1],!0)._lazy=0)},xO=function(e){return!!(e._initted||e._startAt||e.add)},LZ=function(e,t,n,s){af.length&&!Kr&&hE(),e.render(t,n,!!(Kr&&t<0&&xO(e))),af.length&&!Kr&&hE()},UZ=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(CZ).length<2?t:Ur(e)?e.trim():e},IZ=function(e){return e},rl=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},bbe=function(e){return function(t,n){for(var s in n)s in t||s==="duration"&&e||s==="ease"||(t[s]=n[s])}},ix=function(e,t){for(var n in t)e[n]=t[n];return e},UH=function i(e,t){for(var n in t)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(e[n]=xu(t[n])?i(e[n]||(e[n]={}),t[n]):t[n]);return e},dE=function(e,t){var n={},s;for(s in e)s in t||(n[s]=e[s]);return n},Qv=function(e){var t=e.parent||ds,n=e.keyframes?bbe(ba(e.keyframes)):rl;if(oo(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},Sbe=function(e,t){for(var n=e.length,s=n===t.length;s&&n--&&e[n]===t[n];);return n<0},PZ=function(e,t,n,s,r){var a=e[s],o;if(r)for(o=t[r];a&&a[r]>o;)a=a._prev;return a?(t._next=a._next,a._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[s]=t,t._prev=a,t.parent=t._dp=e,t},vw=function(e,t,n,s){n===void 0&&(n="_first"),s===void 0&&(s="_last");var r=t._prev,a=t._next;r?r._next=a:e[n]===t&&(e[n]=a),a?a._prev=r:e[s]===t&&(e[s]=r),t._next=t._prev=t.parent=null},Wf=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Rm=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},Tbe=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},M3=function(e,t,n,s){return e._startAt&&(Kr?e._startAt.revert(JA):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,s))},Abe=function i(e){return!e||e._ts&&i(e.parent)},IH=function(e){return e._repeat?sx(e._tTime,e=e.duration()+e._rDelay)*e:0},sx=function(e,t){var n=Math.floor(e=Qs(e/t));return e&&n===e?n-1:n},fE=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},bw=function(e){return e._end=Qs(e._start+(e._tDur/Math.abs(e._ts||e._rts||Gi)||0))},Sw=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=Qs(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),bw(e),n._dirty||Rm(n,e)),e},OZ=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=fE(e.rawTime(),t),(!t._dur||cT(0,t.totalDuration(),n)-t._tTime>Gi)&&t.render(n,!0)),Rm(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-Gi}},qc=function(e,t,n,s){return t.parent&&Wf(t),t._start=Qs((Uh(n)?n:n||e!==ds?xl(e,n,t):e._time)+t._delay),t._end=Qs(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),PZ(e,t,"_first","_last",e._sort?"_start":0),E3(t)||(e._recent=t),s||OZ(e,t),e._ts<0&&Sw(e,e._tTime),e},FZ=function(e,t){return(sl.ScrollTrigger||pO("scrollTrigger",t))&&sl.ScrollTrigger.create(t,e)},GZ=function(e,t,n,s,r){if(vO(e,t,r),!e._initted)return 1;if(!n&&e._pt&&!Kr&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&BZ!==Vo.frame)return af.push(e),e._lazy=[r,s],1},Mbe=function i(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||i(t))},E3=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},Ebe=function(e,t,n,s){var r=e.ratio,a=t<0||!t&&(!e._start&&Mbe(e)&&!(!e._initted&&E3(e))||(e._ts<0||e._dp._ts<0)&&!E3(e))?0:1,o=e._rDelay,l=0,c,u,h;if(o&&e._repeat&&(l=cT(0,e._tDur,t),u=sx(l,o),e._yoyo&&u&1&&(a=1-a),u!==sx(e._tTime,o)&&(r=1-a,e.vars.repeatRefresh&&e._initted&&e.invalidate())),a!==r||Kr||s||e._zTime===Gi||!t&&e._zTime){if(!e._initted&&GZ(e,t,s,n,l))return;for(h=e._zTime,e._zTime=t||(n?Gi:0),n||(n=t&&!h),e.ratio=a,e._from&&(a=1-a),e._time=0,e._tTime=l,c=e._pt;c;)c.r(a,c.d),c=c._next;t<0&&M3(e,t,n,!0),e._onUpdate&&!n&&Wo(e,"onUpdate"),l&&e._repeat&&!n&&e.parent&&Wo(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===a&&(a&&Wf(e,1),!n&&!Kr&&(Wo(e,a?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},Cbe=function(e,t,n){var s;if(n>t)for(s=e._first;s&&s._start<=n;){if(s.data==="isPause"&&s._start>t)return s;s=s._next}else for(s=e._last;s&&s._start>=n;){if(s.data==="isPause"&&s._start<t)return s;s=s._prev}},rx=function(e,t,n,s){var r=e._repeat,a=Qs(t)||0,o=e._tTime/e._tDur;return o&&!s&&(e._time*=a/e._dur),e._dur=a,e._tDur=r?r<0?1e10:Qs(a*(r+1)+e._rDelay*r):a,o>0&&!s&&Sw(e,e._tTime=e._tDur*o),e.parent&&bw(e),n||Rm(e.parent,e),e},PH=function(e){return e instanceof Va?Rm(e):rx(e,e._dur)},wbe={_start:0,endTime:Gb,totalDuration:Gb},xl=function i(e,t,n){var s=e.labels,r=e._recent||wbe,a=e.duration()>=Fl?r.endTime(!1):e._dur,o,l,c;return Ur(t)&&(isNaN(t)||t in s)?(l=t.charAt(0),c=t.substr(-1)==="%",o=t.indexOf("="),l==="<"||l===">"?(o>=0&&(t=t.replace(/=/,"")),(l==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(t.substr(1))||0)*(c?(o<0?r:n).totalDuration()/100:1)):o<0?(t in s||(s[t]=a),s[t]):(l=parseFloat(t.charAt(o-1)+t.substr(o+1)),c&&n&&(l=l/100*(ba(n)?n[0]:n).totalDuration()),o>1?i(e,t.substr(0,o-1),n)+l:a+l)):t==null?a:+t},$v=function(e,t,n){var s=Uh(t[1]),r=(s?2:1)+(e<2?0:1),a=t[r],o,l;if(s&&(a.duration=t[1]),a.parent=n,e){for(o=a,l=n;l&&!("immediateRender"in o);)o=l.vars.defaults||{},l=oo(l.vars.inherit)&&l.parent;a.immediateRender=oo(o.immediateRender),e<2?a.runBackwards=1:a.startAt=t[r-1]}return new Zs(t[0],a,t[r+1])},cp=function(e,t){return e||e===0?t(e):t},cT=function(e,t,n){return n<e?e:n>t?t:n},fa=function(e,t){return!Ur(e)||!(t=ybe.exec(e))?"":t[1]},Rbe=function(e,t,n){return cp(n,function(s){return cT(e,t,s)})},C3=[].slice,zZ=function(e,t){return e&&xu(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&xu(e[0]))&&!e.nodeType&&e!==Hc},Nbe=function(e,t,n){return n===void 0&&(n=[]),e.forEach(function(s){var r;return Ur(s)&&!t||zZ(s,1)?(r=n).push.apply(r,Gl(s)):n.push(s)})||n},Gl=function(e,t,n){return is&&!t&&is.selector?is.selector(e):Ur(e)&&!n&&(T3||!ax())?C3.call((t||fO).querySelectorAll(e),0):ba(e)?Nbe(e,n):zZ(e)?C3.call(e,0):e?[e]:[]},w3=function(e){return e=Gl(e)[0]||Fb("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return Gl(t,n.querySelectorAll?n:n===e?Fb("Invalid scope")||fO.createElement("div"):e)}},VZ=function(e){return e.sort(function(){return .5-Math.random()})},HZ=function(e){if(Ms(e))return e;var t=xu(e)?e:{each:e},n=Nm(t.ease),s=t.from||0,r=parseFloat(t.base)||0,a={},o=s>0&&s<1,l=isNaN(s)||o,c=t.axis,u=s,h=s;return Ur(s)?u=h={center:.5,edges:.5,end:1}[s]||0:!o&&l&&(u=s[0],h=s[1]),function(f,m,g){var x=(g||t).length,v=a[x],y,b,S,T,M,C,w,N,E;if(!v){if(E=t.grid==="auto"?0:(t.grid||[1,Fl])[1],!E){for(w=-Fl;w<(w=g[E++].getBoundingClientRect().left)&&E<x;);E<x&&E--}for(v=a[x]=[],y=l?Math.min(E,x)*u-.5:s%E,b=E===Fl?0:l?x*h/E-.5:s/E|0,w=0,N=Fl,C=0;C<x;C++)S=C%E-y,T=b-(C/E|0),v[C]=M=c?Math.abs(c==="y"?T:S):TZ(S*S+T*T),M>w&&(w=M),M<N&&(N=M);s==="random"&&VZ(v),v.max=w-N,v.min=N,v.v=x=(parseFloat(t.amount)||parseFloat(t.each)*(E>x?x-1:c?c==="y"?x/E:E:Math.max(E,x/E))||0)*(s==="edges"?-1:1),v.b=x<0?r-x:r,v.u=fa(t.amount||t.each)||0,n=n&&x<0?QZ(n):n}return x=(v[f]-v.min)/v.max||0,Qs(v.b+(n?n(x):x)*v.v)+v.u}},R3=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var s=Qs(Math.round(parseFloat(n)/e)*e*t);return(s-s%1)/t+(Uh(n)?0:fa(n))}},kZ=function(e,t){var n=ba(e),s,r;return!n&&xu(e)&&(s=n=e.radius||Fl,e.values?(e=Gl(e.values),(r=!Uh(e[0]))&&(s*=s)):e=R3(e.increment)),cp(t,n?Ms(e)?function(a){return r=e(a),Math.abs(r-a)<=s?r:a}:function(a){for(var o=parseFloat(r?a.x:a),l=parseFloat(r?a.y:0),c=Fl,u=0,h=e.length,f,m;h--;)r?(f=e[h].x-o,m=e[h].y-l,f=f*f+m*m):f=Math.abs(e[h]-o),f<c&&(c=f,u=h);return u=!s||c<=s?e[u]:a,r||u===a||Uh(a)?u:u+fa(a)}:R3(e))},WZ=function(e,t,n,s){return cp(ba(e)?!t:n===!0?!!(n=0):!s,function(){return ba(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(s=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+n*.99))/n)*n*s)/s})},Bbe=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(s){return t.reduce(function(r,a){return a(r)},s)}},Dbe=function(e,t){return function(n){return e(parseFloat(n))+(t||fa(n))}},Lbe=function(e,t,n){return qZ(e,t,0,1,n)},XZ=function(e,t,n){return cp(n,function(s){return e[~~t(s)]})},Ube=function i(e,t,n){var s=t-e;return ba(e)?XZ(e,i(0,e.length),t):cp(n,function(r){return(s+(r-e)%s)%s+e})},Ibe=function i(e,t,n){var s=t-e,r=s*2;return ba(e)?XZ(e,i(0,e.length-1),t):cp(n,function(a){return a=(r+(a-e)%r)%r||0,e+(a>s?r-a:a)})},zb=function(e){for(var t=0,n="",s,r,a,o;~(s=e.indexOf("random(",t));)a=e.indexOf(")",s),o=e.charAt(s+7)==="[",r=e.substr(s+7,a-s-7).match(o?CZ:S3),n+=e.substr(t,s-t)+WZ(o?r:+r[0],o?0:+r[1],+r[2]||1e-5),t=a+1;return n+e.substr(t,e.length-t)},qZ=function(e,t,n,s,r){var a=t-e,o=s-n;return cp(r,function(l){return n+((l-e)/a*o||0)})},Pbe=function i(e,t,n,s){var r=isNaN(e+t)?0:function(m){return(1-m)*e+m*t};if(!r){var a=Ur(e),o={},l,c,u,h,f;if(n===!0&&(s=1)&&(n=null),a)e={p:e},t={p:t};else if(ba(e)&&!ba(t)){for(u=[],h=e.length,f=h-2,c=1;c<h;c++)u.push(i(e[c-1],e[c]));h--,r=function(g){g*=h;var x=Math.min(f,~~g);return u[x](g-x)},n=t}else s||(e=ix(ba(e)?[]:{},e));if(!u){for(l in t)_O.call(o,e,l,"get",t[l]);r=function(g){return TO(g,o)||(a?e.p:e)}}}return cp(n,r)},OH=function(e,t,n){var s=e.labels,r=Fl,a,o,l;for(a in s)o=s[a]-t,o<0==!!n&&o&&r>(o=Math.abs(o))&&(l=a,r=o);return l},Wo=function(e,t,n){var s=e.vars,r=s[t],a=is,o=e._ctx,l,c,u;if(r)return l=s[t+"Params"],c=s.callbackScope||e,n&&af.length&&hE(),o&&(is=o),u=l?r.apply(c,l):r.call(c),is=a,u},yv=function(e){return Wf(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Kr),e.progress()<1&&Wo(e,"onInterrupt"),e},oy,jZ=[],YZ=function(e){if(e)if(e=!e.name&&e.default||e,dO()||e.headless){var t=e.name,n=Ms(e),s=t&&!n&&e.init?function(){this._props=[]}:e,r={init:Gb,render:TO,add:_O,kill:Qbe,modifier:Jbe,rawVars:0},a={targetTest:0,get:0,getSetter:SO,aliases:{},register:0};if(ax(),e!==s){if(Fo[t])return;rl(s,rl(dE(e,r),a)),ix(s.prototype,ix(r,dE(e,a))),Fo[s.prop=t]=s,e.targetTest&&(QA.push(s),mO[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}NZ(t,s),e.register&&e.register(mo,s,co)}else jZ.push(e)},Fi=255,xv={aqua:[0,Fi,Fi],lime:[0,Fi,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Fi],navy:[0,0,128],white:[Fi,Fi,Fi],olive:[128,128,0],yellow:[Fi,Fi,0],orange:[Fi,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Fi,0,0],pink:[Fi,192,203],cyan:[0,Fi,Fi],transparent:[Fi,Fi,Fi,0]},iB=function(e,t,n){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*Fi+.5|0},KZ=function(e,t,n){var s=e?Uh(e)?[e>>16,e>>8&Fi,e&Fi]:0:xv.black,r,a,o,l,c,u,h,f,m,g;if(!s){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),xv[e])s=xv[e];else if(e.charAt(0)==="#"){if(e.length<6&&(r=e.charAt(1),a=e.charAt(2),o=e.charAt(3),e="#"+r+r+a+a+o+o+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return s=parseInt(e.substr(1,6),16),[s>>16,s>>8&Fi,s&Fi,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),s=[e>>16,e>>8&Fi,e&Fi]}else if(e.substr(0,3)==="hsl"){if(s=g=e.match(S3),!t)l=+s[0]%360/360,c=+s[1]/100,u=+s[2]/100,a=u<=.5?u*(c+1):u+c-u*c,r=u*2-a,s.length>3&&(s[3]*=1),s[0]=iB(l+1/3,r,a),s[1]=iB(l,r,a),s[2]=iB(l-1/3,r,a);else if(~e.indexOf("="))return s=e.match(MZ),n&&s.length<4&&(s[3]=1),s}else s=e.match(S3)||xv.transparent;s=s.map(Number)}return t&&!g&&(r=s[0]/Fi,a=s[1]/Fi,o=s[2]/Fi,h=Math.max(r,a,o),f=Math.min(r,a,o),u=(h+f)/2,h===f?l=c=0:(m=h-f,c=u>.5?m/(2-h-f):m/(h+f),l=h===r?(a-o)/m+(a<o?6:0):h===a?(o-r)/m+2:(r-a)/m+4,l*=60),s[0]=~~(l+.5),s[1]=~~(c*100+.5),s[2]=~~(u*100+.5)),n&&s.length<4&&(s[3]=1),s},ZZ=function(e){var t=[],n=[],s=-1;return e.split(of).forEach(function(r){var a=r.match(ay)||[];t.push.apply(t,a),n.push(s+=a.length+1)}),t.c=n,t},FH=function(e,t,n){var s="",r=(e+s).match(of),a=t?"hsla(":"rgba(",o=0,l,c,u,h;if(!r)return e;if(r=r.map(function(f){return(f=KZ(f,t,1))&&a+(t?f[0]+","+f[1]+"%,"+f[2]+"%,"+f[3]:f.join(","))+")"}),n&&(u=ZZ(e),l=n.c,l.join(s)!==u.c.join(s)))for(c=e.replace(of,"1").split(ay),h=c.length-1;o<h;o++)s+=c[o]+(~l.indexOf(o)?r.shift()||a+"0,0,0,0)":(u.length?u:r.length?r:n).shift());if(!c)for(c=e.split(of),h=c.length-1;o<h;o++)s+=c[o]+r[o];return s+c[h]},of=function(){var i="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in xv)i+="|"+e+"\\b";return new RegExp(i+")","gi")}(),Obe=/hsl[a]?\(/,JZ=function(e){var t=e.join(" "),n;if(of.lastIndex=0,of.test(t))return n=Obe.test(t),e[1]=FH(e[1],n),e[0]=FH(e[0],n,ZZ(e[1])),!0},Vb,Vo=function(){var i=Date.now,e=500,t=33,n=i(),s=n,r=1e3/240,a=r,o=[],l,c,u,h,f,m,g=function x(v){var y=i()-s,b=v===!0,S,T,M,C;if((y>e||y<0)&&(n+=y-t),s+=y,M=s-n,S=M-a,(S>0||b)&&(C=++h.frame,f=M-h.time*1e3,h.time=M=M/1e3,a+=S+(S>=r?4:r-S),T=1),b||(l=c(x)),T)for(m=0;m<o.length;m++)o[m](M,f,C,v)};return h={time:0,frame:0,tick:function(){g(!0)},deltaRatio:function(v){return f/(1e3/(v||60))},wake:function(){wZ&&(!T3&&dO()&&(Hc=T3=window,fO=Hc.document||{},sl.gsap=mo,(Hc.gsapVersions||(Hc.gsapVersions=[])).push(mo.version),RZ(uE||Hc.GreenSockGlobals||!Hc.gsap&&Hc||{}),jZ.forEach(YZ)),u=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&h.sleep(),c=u||function(v){return setTimeout(v,a-h.time*1e3+1|0)},Vb=1,g(2))},sleep:function(){(u?cancelAnimationFrame:clearTimeout)(l),Vb=0,c=Gb},lagSmoothing:function(v,y){e=v||1/0,t=Math.min(y||33,e)},fps:function(v){r=1e3/(v||240),a=h.time*1e3+r},add:function(v,y,b){var S=y?function(T,M,C,w){v(T,M,C,w),h.remove(S)}:v;return h.remove(v),o[b?"unshift":"push"](S),ax(),S},remove:function(v,y){~(y=o.indexOf(v))&&o.splice(y,1)&&m>=y&&m--},_listeners:o},h}(),ax=function(){return!Vb&&Vo.wake()},Yn={},Fbe=/^[\d.\-M][\d.\-,\s]/,Gbe=/["']/g,zbe=function(e){for(var t={},n=e.substr(1,e.length-3).split(":"),s=n[0],r=1,a=n.length,o,l,c;r<a;r++)l=n[r],o=r!==a-1?l.lastIndexOf(","):l.length,c=l.substr(0,o),t[s]=isNaN(c)?c.replace(Gbe,"").trim():+c,s=l.substr(o+1).trim();return t},Vbe=function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),s=e.indexOf("(",t);return e.substring(t,~s&&s<n?e.indexOf(")",n+1):n)},Hbe=function(e){var t=(e+"").split("("),n=Yn[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[zbe(t[1])]:Vbe(e).split(",").map(UZ)):Yn._CE&&Fbe.test(e)?Yn._CE("",e):n},QZ=function(e){return function(t){return 1-e(1-t)}},$Z=function i(e,t){for(var n=e._first,s;n;)n instanceof Va?i(n,t):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==t&&(n.timeline?i(n.timeline,t):(s=n._ease,n._ease=n._yEase,n._yEase=s,n._yoyo=t)),n=n._next},Nm=function(e,t){return e&&(Ms(e)?e:Yn[e]||Hbe(e))||t},Bg=function(e,t,n,s){n===void 0&&(n=function(l){return 1-t(1-l)}),s===void 0&&(s=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var r={easeIn:t,easeOut:n,easeInOut:s},a;return lo(e,function(o){Yn[o]=sl[o]=r,Yn[a=o.toLowerCase()]=n;for(var l in r)Yn[a+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=Yn[o+"."+l]=r[l]}),r},eJ=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},sB=function i(e,t,n){var s=t>=1?t:1,r=(n||(e?.3:.45))/(t<1?t:1),a=r/b3*(Math.asin(1/s)||0),o=function(u){return u===1?1:s*Math.pow(2,-10*u)*gbe((u-a)*r)+1},l=e==="out"?o:e==="in"?function(c){return 1-o(1-c)}:eJ(o);return r=b3/r,l.config=function(c,u){return i(e,c,u)},l},rB=function i(e,t){t===void 0&&(t=1.70158);var n=function(a){return a?--a*a*((t+1)*a+t)+1:0},s=e==="out"?n:e==="in"?function(r){return 1-n(1-r)}:eJ(n);return s.config=function(r){return i(e,r)},s};lo("Linear,Quad,Cubic,Quart,Quint,Strong",function(i,e){var t=e<5?e+1:e;Bg(i+",Power"+(t-1),e?function(n){return Math.pow(n,t)}:function(n){return n},function(n){return 1-Math.pow(1-n,t)},function(n){return n<.5?Math.pow(n*2,t)/2:1-Math.pow((1-n)*2,t)/2})});Yn.Linear.easeNone=Yn.none=Yn.Linear.easeIn;Bg("Elastic",sB("in"),sB("out"),sB());(function(i,e){var t=1/e,n=2*t,s=2.5*t,r=function(o){return o<t?i*o*o:o<n?i*Math.pow(o-1.5/e,2)+.75:o<s?i*(o-=2.25/e)*o+.9375:i*Math.pow(o-2.625/e,2)+.984375};Bg("Bounce",function(a){return 1-r(1-a)},r)})(7.5625,2.75);Bg("Expo",function(i){return Math.pow(2,10*(i-1))*i+i*i*i*i*i*i*(1-i)});Bg("Circ",function(i){return-(TZ(1-i*i)-1)});Bg("Sine",function(i){return i===1?1:-mbe(i*fbe)+1});Bg("Back",rB("in"),rB("out"),rB());Yn.SteppedEase=Yn.steps=sl.SteppedEase={config:function(e,t){e===void 0&&(e=1);var n=1/e,s=e+(t?0:1),r=t?1:0,a=1-Gi;return function(o){return((s*cT(0,a,o)|0)+r)*n}}};nx.ease=Yn["quad.out"];lo("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(i){return gO+=i+","+i+"Params,"});var tJ=function(e,t){this.id=pbe++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:DZ,this.set=t?t.getSetter:SO},Hb=function(){function i(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,rx(this,+t.duration,1,1),this.data=t.data,is&&(this._ctx=is,is.data.push(this)),Vb||Vo.wake()}var e=i.prototype;return e.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},e.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},e.totalDuration=function(n){return arguments.length?(this._dirty=0,rx(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(n,s){if(ax(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(Sw(this,n),!r._dp||r.parent||OZ(r,this);r&&r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&qc(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!s||this._initted&&Math.abs(this._zTime)===Gi||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),LZ(this,n,s)),this},e.time=function(n,s){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+IH(this))%(this._dur+this._rDelay)||(n?this._dur:0),s):this._time},e.totalProgress=function(n,s){return arguments.length?this.totalTime(this.totalDuration()*n,s):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(n,s){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+IH(this),s):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(n,s){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*r,s):this._repeat?sx(this._tTime,r)+1:1},e.timeScale=function(n,s){if(!arguments.length)return this._rts===-Gi?0:this._rts;if(this._rts===n)return this;var r=this.parent&&this._ts?fE(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-Gi?0:this._rts,this.totalTime(cT(-Math.abs(this._delay),this.totalDuration(),r),s!==!1),bw(this),Tbe(this)},e.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(ax(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Gi&&(this._tTime-=Gi)))),this):this._ps},e.startTime=function(n){if(arguments.length){this._start=n;var s=this.parent||this._dp;return s&&(s._sort||!this.parent)&&qc(s,this,n-this._delay),this}return this._start},e.endTime=function(n){return this._start+(oo(n)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(n){var s=this.parent||this._dp;return s?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?fE(s.rawTime(n),this):this._tTime:this._tTime},e.revert=function(n){n===void 0&&(n=_be);var s=Kr;return Kr=n,xO(this)&&(this.timeline&&this.timeline.revert(n),this.totalTime(-.01,n.suppressEvents)),this.data!=="nested"&&n.kill!==!1&&this.kill(),Kr=s,this},e.globalTime=function(n){for(var s=this,r=arguments.length?n:s.rawTime();s;)r=s._start+r/(Math.abs(s._ts)||1),s=s._dp;return!this.parent&&this._sat?this._sat.globalTime(n):r},e.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,PH(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(n){if(arguments.length){var s=this._time;return this._rDelay=n,PH(this),s?this.time(s):this}return this._rDelay},e.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},e.seek=function(n,s){return this.totalTime(xl(this,n),oo(s))},e.restart=function(n,s){return this.play().totalTime(n?-this._delay:0,oo(s)),this._dur||(this._zTime=-Gi),this},e.play=function(n,s){return n!=null&&this.seek(n,s),this.reversed(!1).paused(!1)},e.reverse=function(n,s){return n!=null&&this.seek(n||this.totalDuration(),s),this.reversed(!0).paused(!1)},e.pause=function(n,s){return n!=null&&this.seek(n,s),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-Gi:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-Gi,this},e.isActive=function(){var n=this.parent||this._dp,s=this._start,r;return!!(!n||this._ts&&this._initted&&n.isActive()&&(r=n.rawTime(!0))>=s&&r<this.endTime(!0)-Gi)},e.eventCallback=function(n,s,r){var a=this.vars;return arguments.length>1?(s?(a[n]=s,r&&(a[n+"Params"]=r),n==="onUpdate"&&(this._onUpdate=s)):delete a[n],this):a[n]},e.then=function(n){var s=this;return new Promise(function(r){var a=Ms(n)?n:IZ,o=function(){var c=s.then;s.then=null,Ms(a)&&(a=a(s))&&(a.then||a===s)&&(s.then=c),r(a),s.then=c};s._initted&&s.totalProgress()===1&&s._ts>=0||!s._tTime&&s._ts<0?o():s._prom=o})},e.kill=function(){yv(this)},i}();rl(Hb.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Gi,_prom:0,_ps:!1,_rts:1});var Va=function(i){SZ(e,i);function e(n,s){var r;return n===void 0&&(n={}),r=i.call(this,n)||this,r.labels={},r.smoothChildTiming=!!n.smoothChildTiming,r.autoRemoveChildren=!!n.autoRemoveChildren,r._sort=oo(n.sortChildren),ds&&qc(n.parent||ds,Yu(r),s),n.reversed&&r.reverse(),n.paused&&r.paused(!0),n.scrollTrigger&&FZ(Yu(r),n.scrollTrigger),r}var t=e.prototype;return t.to=function(s,r,a){return $v(0,arguments,this),this},t.from=function(s,r,a){return $v(1,arguments,this),this},t.fromTo=function(s,r,a,o){return $v(2,arguments,this),this},t.set=function(s,r,a){return r.duration=0,r.parent=this,Qv(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new Zs(s,r,xl(this,a),1),this},t.call=function(s,r,a){return qc(this,Zs.delayedCall(0,s,r),a)},t.staggerTo=function(s,r,a,o,l,c,u){return a.duration=r,a.stagger=a.stagger||o,a.onComplete=c,a.onCompleteParams=u,a.parent=this,new Zs(s,a,xl(this,l)),this},t.staggerFrom=function(s,r,a,o,l,c,u){return a.runBackwards=1,Qv(a).immediateRender=oo(a.immediateRender),this.staggerTo(s,r,a,o,l,c,u)},t.staggerFromTo=function(s,r,a,o,l,c,u,h){return o.startAt=a,Qv(o).immediateRender=oo(o.immediateRender),this.staggerTo(s,r,o,l,c,u,h)},t.render=function(s,r,a){var o=this._time,l=this._dirty?this.totalDuration():this._tDur,c=this._dur,u=s<=0?0:Qs(s),h=this._zTime<0!=s<0&&(this._initted||!c),f,m,g,x,v,y,b,S,T,M,C,w;if(this!==ds&&u>l&&s>=0&&(u=l),u!==this._tTime||a||h){if(o!==this._time&&c&&(u+=this._time-o,s+=this._time-o),f=u,T=this._start,S=this._ts,y=!S,h&&(c||(o=this._zTime),(s||!r)&&(this._zTime=s)),this._repeat){if(C=this._yoyo,v=c+this._rDelay,this._repeat<-1&&s<0)return this.totalTime(v*100+s,r,a);if(f=Qs(u%v),u===l?(x=this._repeat,f=c):(M=Qs(u/v),x=~~M,x&&x===M&&(f=c,x--),f>c&&(f=c)),M=sx(this._tTime,v),!o&&this._tTime&&M!==x&&this._tTime-M*v-this._dur<=0&&(M=x),C&&x&1&&(f=c-f,w=1),x!==M&&!this._lock){var N=C&&M&1,E=N===(C&&x&1);if(x<M&&(N=!N),o=N?0:u%c?c:u,this._lock=1,this.render(o||(w?0:Qs(x*v)),r,!c)._lock=0,this._tTime=u,!r&&this.parent&&Wo(this,"onRepeat"),this.vars.repeatRefresh&&!w&&(this.invalidate()._lock=1),o&&o!==this._time||y!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,l=this._tDur,E&&(this._lock=2,o=N?c:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!w&&this.invalidate()),this._lock=0,!this._ts&&!y)return this;$Z(this,w)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(b=Cbe(this,Qs(o),Qs(f)),b&&(u-=f-(f=b._start))),this._tTime=u,this._time=f,this._act=!S,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=s,o=0),!o&&u&&!r&&!M&&(Wo(this,"onStart"),this._tTime!==u))return this;if(f>=o&&s>=0)for(m=this._first;m;){if(g=m._next,(m._act||f>=m._start)&&m._ts&&b!==m){if(m.parent!==this)return this.render(s,r,a);if(m.render(m._ts>0?(f-m._start)*m._ts:(m._dirty?m.totalDuration():m._tDur)+(f-m._start)*m._ts,r,a),f!==this._time||!this._ts&&!y){b=0,g&&(u+=this._zTime=-Gi);break}}m=g}else{m=this._last;for(var B=s<0?s:f;m;){if(g=m._prev,(m._act||B<=m._end)&&m._ts&&b!==m){if(m.parent!==this)return this.render(s,r,a);if(m.render(m._ts>0?(B-m._start)*m._ts:(m._dirty?m.totalDuration():m._tDur)+(B-m._start)*m._ts,r,a||Kr&&xO(m)),f!==this._time||!this._ts&&!y){b=0,g&&(u+=this._zTime=B?-Gi:Gi);break}}m=g}}if(b&&!r&&(this.pause(),b.render(f>=o?0:-Gi)._zTime=f>=o?1:-1,this._ts))return this._start=T,bw(this),this.render(s,r,a);this._onUpdate&&!r&&Wo(this,"onUpdate",!0),(u===l&&this._tTime>=this.totalDuration()||!u&&o)&&(T===this._start||Math.abs(S)!==Math.abs(this._ts))&&(this._lock||((s||!c)&&(u===l&&this._ts>0||!u&&this._ts<0)&&Wf(this,1),!r&&!(s<0&&!o)&&(u||o||!l)&&(Wo(this,u===l&&s>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(s,r){var a=this;if(Uh(r)||(r=xl(this,r,s)),!(s instanceof Hb)){if(ba(s))return s.forEach(function(o){return a.add(o,r)}),this;if(Ur(s))return this.addLabel(s,r);if(Ms(s))s=Zs.delayedCall(0,s);else return this}return this!==s?qc(this,s,r):this},t.getChildren=function(s,r,a,o){s===void 0&&(s=!0),r===void 0&&(r=!0),a===void 0&&(a=!0),o===void 0&&(o=-Fl);for(var l=[],c=this._first;c;)c._start>=o&&(c instanceof Zs?r&&l.push(c):(a&&l.push(c),s&&l.push.apply(l,c.getChildren(!0,r,a)))),c=c._next;return l},t.getById=function(s){for(var r=this.getChildren(1,1,1),a=r.length;a--;)if(r[a].vars.id===s)return r[a]},t.remove=function(s){return Ur(s)?this.removeLabel(s):Ms(s)?this.killTweensOf(s):(s.parent===this&&vw(this,s),s===this._recent&&(this._recent=this._last),Rm(this))},t.totalTime=function(s,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Qs(Vo.time-(this._ts>0?s/this._ts:(this.totalDuration()-s)/-this._ts))),i.prototype.totalTime.call(this,s,r),this._forcing=0,this):this._tTime},t.addLabel=function(s,r){return this.labels[s]=xl(this,r),this},t.removeLabel=function(s){return delete this.labels[s],this},t.addPause=function(s,r,a){var o=Zs.delayedCall(0,r||Gb,a);return o.data="isPause",this._hasPause=1,qc(this,o,xl(this,s))},t.removePause=function(s){var r=this._first;for(s=xl(this,s);r;)r._start===s&&r.data==="isPause"&&Wf(r),r=r._next},t.killTweensOf=function(s,r,a){for(var o=this.getTweensOf(s,a),l=o.length;l--;)kd!==o[l]&&o[l].kill(s,r);return this},t.getTweensOf=function(s,r){for(var a=[],o=Gl(s),l=this._first,c=Uh(r),u;l;)l instanceof Zs?vbe(l._targets,o)&&(c?(!kd||l._initted&&l._ts)&&l.globalTime(0)<=r&&l.globalTime(l.totalDuration())>r:!r||l.isActive())&&a.push(l):(u=l.getTweensOf(o,r)).length&&a.push.apply(a,u),l=l._next;return a},t.tweenTo=function(s,r){r=r||{};var a=this,o=xl(a,s),l=r,c=l.startAt,u=l.onStart,h=l.onStartParams,f=l.immediateRender,m,g=Zs.to(a,rl({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:r.duration||Math.abs((o-(c&&"time"in c?c.time:a._time))/a.timeScale())||Gi,onStart:function(){if(a.pause(),!m){var v=r.duration||Math.abs((o-(c&&"time"in c?c.time:a._time))/a.timeScale());g._dur!==v&&rx(g,v,0,1).render(g._time,!0,!0),m=1}u&&u.apply(g,h||[])}},r));return f?g.render(0):g},t.tweenFromTo=function(s,r,a){return this.tweenTo(r,rl({startAt:{time:xl(this,s)}},a))},t.recent=function(){return this._recent},t.nextLabel=function(s){return s===void 0&&(s=this._time),OH(this,xl(this,s))},t.previousLabel=function(s){return s===void 0&&(s=this._time),OH(this,xl(this,s),1)},t.currentLabel=function(s){return arguments.length?this.seek(s,!0):this.previousLabel(this._time+Gi)},t.shiftChildren=function(s,r,a){a===void 0&&(a=0);for(var o=this._first,l=this.labels,c;o;)o._start>=a&&(o._start+=s,o._end+=s),o=o._next;if(r)for(c in l)l[c]>=a&&(l[c]+=s);return Rm(this)},t.invalidate=function(s){var r=this._first;for(this._lock=0;r;)r.invalidate(s),r=r._next;return i.prototype.invalidate.call(this,s)},t.clear=function(s){s===void 0&&(s=!0);for(var r=this._first,a;r;)a=r._next,this.remove(r),r=a;return this._dp&&(this._time=this._tTime=this._pTime=0),s&&(this.labels={}),Rm(this)},t.totalDuration=function(s){var r=0,a=this,o=a._last,l=Fl,c,u,h;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-s:s));if(a._dirty){for(h=a.parent;o;)c=o._prev,o._dirty&&o.totalDuration(),u=o._start,u>l&&a._sort&&o._ts&&!a._lock?(a._lock=1,qc(a,o,u-o._delay,1)._lock=0):l=u,u<0&&o._ts&&(r-=u,(!h&&!a._dp||h&&h.smoothChildTiming)&&(a._start+=u/a._ts,a._time-=u,a._tTime-=u),a.shiftChildren(-u,!1,-1/0),l=0),o._end>r&&o._ts&&(r=o._end),o=c;rx(a,a===ds&&a._time>r?a._time:r,1,1),a._dirty=0}return a._tDur},e.updateRoot=function(s){if(ds._ts&&(LZ(ds,fE(s,ds)),BZ=Vo.frame),Vo.frame>=LH){LH+=Qo.autoSleep||120;var r=ds._first;if((!r||!r._ts)&&Qo.autoSleep&&Vo._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||Vo.sleep()}}},e}(Hb);rl(Va.prototype,{_lock:0,_hasPause:0,_forcing:0});var kbe=function(e,t,n,s,r,a,o){var l=new co(this._pt,e,t,0,1,oJ,null,r),c=0,u=0,h,f,m,g,x,v,y,b;for(l.b=n,l.e=s,n+="",s+="",(y=~s.indexOf("random("))&&(s=zb(s)),a&&(b=[n,s],a(b,e,t),n=b[0],s=b[1]),f=n.match(tB)||[];h=tB.exec(s);)g=h[0],x=s.substring(c,h.index),m?m=(m+1)%5:x.substr(-5)==="rgba("&&(m=1),g!==f[u++]&&(v=parseFloat(f[u-1])||0,l._pt={_next:l._pt,p:x||u===1?x:",",s:v,c:g.charAt(1)==="="?wy(v,g)-v:parseFloat(g)-v,m:m&&m<4?Math.round:0},c=tB.lastIndex);return l.c=c<s.length?s.substring(c,s.length):"",l.fp=o,(EZ.test(s)||y)&&(l.e=0),this._pt=l,l},_O=function(e,t,n,s,r,a,o,l,c,u){Ms(s)&&(s=s(r||0,e,a));var h=e[t],f=n!=="get"?n:Ms(h)?c?e[t.indexOf("set")||!Ms(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():h,m=Ms(h)?c?Ybe:rJ:bO,g;if(Ur(s)&&(~s.indexOf("random(")&&(s=zb(s)),s.charAt(1)==="="&&(g=wy(f,s)+(fa(f)||0),(g||g===0)&&(s=g))),!u||f!==s||N3)return!isNaN(f*s)&&s!==""?(g=new co(this._pt,e,t,+f||0,s-(f||0),typeof h=="boolean"?Zbe:aJ,0,m),c&&(g.fp=c),o&&g.modifier(o,this,e),this._pt=g):(!h&&!(t in e)&&pO(t,s),kbe.call(this,e,t,f,s,m,l||Qo.stringFilter,c))},Wbe=function(e,t,n,s,r){if(Ms(e)&&(e=eb(e,r,t,n,s)),!xu(e)||e.style&&e.nodeType||ba(e)||AZ(e))return Ur(e)?eb(e,r,t,n,s):e;var a={},o;for(o in e)a[o]=eb(e[o],r,t,n,s);return a},nJ=function(e,t,n,s,r,a){var o,l,c,u;if(Fo[e]&&(o=new Fo[e]).init(r,o.rawVars?t[e]:Wbe(t[e],s,r,a,n),n,s,a)!==!1&&(n._pt=l=new co(n._pt,r,e,0,1,o.render,o,0,o.priority),n!==oy))for(c=n._ptLookup[n._targets.indexOf(r)],u=o._props.length;u--;)c[o._props[u]]=l;return o},kd,N3,vO=function i(e,t,n){var s=e.vars,r=s.ease,a=s.startAt,o=s.immediateRender,l=s.lazy,c=s.onUpdate,u=s.runBackwards,h=s.yoyoEase,f=s.keyframes,m=s.autoRevert,g=e._dur,x=e._startAt,v=e._targets,y=e.parent,b=y&&y.data==="nested"?y.vars.targets:v,S=e._overwrite==="auto"&&!uO,T=e.timeline,M,C,w,N,E,B,U,H,F,V,Y,P,X;if(T&&(!f||!r)&&(r="none"),e._ease=Nm(r,nx.ease),e._yEase=h?QZ(Nm(h===!0?r:h,nx.ease)):0,h&&e._yoyo&&!e._repeat&&(h=e._yEase,e._yEase=e._ease,e._ease=h),e._from=!T&&!!s.runBackwards,!T||f&&!s.stagger){if(H=v[0]?wm(v[0]).harness:0,P=H&&s[H.prop],M=dE(s,mO),x&&(x._zTime<0&&x.progress(1),t<0&&u&&o&&!m?x.render(-1,!0):x.revert(u&&g?JA:xbe),x._lazy=0),a){if(Wf(e._startAt=Zs.set(v,rl({data:"isStart",overwrite:!1,parent:y,immediateRender:!0,lazy:!x&&oo(l),startAt:null,delay:0,onUpdate:c&&function(){return Wo(e,"onUpdate")},stagger:0},a))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Kr||!o&&!m)&&e._startAt.revert(JA),o&&g&&t<=0&&n<=0){t&&(e._zTime=t);return}}else if(u&&g&&!x){if(t&&(o=!1),w=rl({overwrite:!1,data:"isFromStart",lazy:o&&!x&&oo(l),immediateRender:o,stagger:0,parent:y},M),P&&(w[H.prop]=P),Wf(e._startAt=Zs.set(v,w)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Kr?e._startAt.revert(JA):e._startAt.render(-1,!0)),e._zTime=t,!o)i(e._startAt,Gi,Gi);else if(!t)return}for(e._pt=e._ptCache=0,l=g&&oo(l)||l&&!g,C=0;C<v.length;C++){if(E=v[C],U=E._gsap||yO(v)[C]._gsap,e._ptLookup[C]=V={},A3[U.id]&&af.length&&hE(),Y=b===v?C:b.indexOf(E),H&&(F=new H).init(E,P||M,e,Y,b)!==!1&&(e._pt=N=new co(e._pt,E,F.name,0,1,F.render,F,0,F.priority),F._props.forEach(function(J){V[J]=N}),F.priority&&(B=1)),!H||P)for(w in M)Fo[w]&&(F=nJ(w,M,e,Y,E,b))?F.priority&&(B=1):V[w]=N=_O.call(e,E,w,"get",M[w],Y,b,0,s.stringFilter);e._op&&e._op[C]&&e.kill(E,e._op[C]),S&&e._pt&&(kd=e,ds.killTweensOf(E,V,e.globalTime(t)),X=!e.parent,kd=0),e._pt&&l&&(A3[U.id]=1)}B&&lJ(e),e._onInit&&e._onInit(e)}e._onUpdate=c,e._initted=(!e._op||e._pt)&&!X,f&&t<=0&&T.render(Fl,!0,!0)},Xbe=function(e,t,n,s,r,a,o,l){var c=(e._pt&&e._ptCache||(e._ptCache={}))[t],u,h,f,m;if(!c)for(c=e._ptCache[t]=[],f=e._ptLookup,m=e._targets.length;m--;){if(u=f[m][t],u&&u.d&&u.d._pt)for(u=u.d._pt;u&&u.p!==t&&u.fp!==t;)u=u._next;if(!u)return N3=1,e.vars[t]="+=0",vO(e,o),N3=0,l?Fb(t+" not eligible for reset"):1;c.push(u)}for(m=c.length;m--;)h=c[m],u=h._pt||h,u.s=(s||s===0)&&!r?s:u.s+(s||0)+a*u.c,u.c=n-u.s,h.e&&(h.e=Us(n)+fa(h.e)),h.b&&(h.b=u.s+fa(h.b))},qbe=function(e,t){var n=e[0]?wm(e[0]).harness:0,s=n&&n.aliases,r,a,o,l;if(!s)return t;r=ix({},t);for(a in s)if(a in r)for(l=s[a].split(","),o=l.length;o--;)r[l[o]]=r[a];return r},jbe=function(e,t,n,s){var r=t.ease||s||"power1.inOut",a,o;if(ba(t))o=n[e]||(n[e]=[]),t.forEach(function(l,c){return o.push({t:c/(t.length-1)*100,v:l,e:r})});else for(a in t)o=n[a]||(n[a]=[]),a==="ease"||o.push({t:parseFloat(e),v:t[a],e:r})},eb=function(e,t,n,s,r){return Ms(e)?e.call(t,n,s,r):Ur(e)&&~e.indexOf("random(")?zb(e):e},iJ=gO+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",sJ={};lo(iJ+",id,stagger,delay,duration,paused,scrollTrigger",function(i){return sJ[i]=1});var Zs=function(i){SZ(e,i);function e(n,s,r,a){var o;typeof s=="number"&&(r.duration=s,s=r,r=null),o=i.call(this,a?s:Qv(s))||this;var l=o.vars,c=l.duration,u=l.delay,h=l.immediateRender,f=l.stagger,m=l.overwrite,g=l.keyframes,x=l.defaults,v=l.scrollTrigger,y=l.yoyoEase,b=s.parent||ds,S=(ba(n)||AZ(n)?Uh(n[0]):"length"in s)?[n]:Gl(n),T,M,C,w,N,E,B,U;if(o._targets=S.length?yO(S):Fb("GSAP target "+n+" not found. https://gsap.com",!Qo.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=m,g||f||vA(c)||vA(u)){if(s=o.vars,T=o.timeline=new Va({data:"nested",defaults:x||{},targets:b&&b.data==="nested"?b.vars.targets:S}),T.kill(),T.parent=T._dp=Yu(o),T._start=0,f||vA(c)||vA(u)){if(w=S.length,B=f&&HZ(f),xu(f))for(N in f)~iJ.indexOf(N)&&(U||(U={}),U[N]=f[N]);for(M=0;M<w;M++)C=dE(s,sJ),C.stagger=0,y&&(C.yoyoEase=y),U&&ix(C,U),E=S[M],C.duration=+eb(c,Yu(o),M,E,S),C.delay=(+eb(u,Yu(o),M,E,S)||0)-o._delay,!f&&w===1&&C.delay&&(o._delay=u=C.delay,o._start+=u,C.delay=0),T.to(E,C,B?B(M,E,S):0),T._ease=Yn.none;T.duration()?c=u=0:o.timeline=0}else if(g){Qv(rl(T.vars.defaults,{ease:"none"})),T._ease=Nm(g.ease||s.ease||"none");var H=0,F,V,Y;if(ba(g))g.forEach(function(P){return T.to(S,P,">")}),T.duration();else{C={};for(N in g)N==="ease"||N==="easeEach"||jbe(N,g[N],C,g.easeEach);for(N in C)for(F=C[N].sort(function(P,X){return P.t-X.t}),H=0,M=0;M<F.length;M++)V=F[M],Y={ease:V.e,duration:(V.t-(M?F[M-1].t:0))/100*c},Y[N]=V.v,T.to(S,Y,H),H+=Y.duration;T.duration()<c&&T.to({},{duration:c-T.duration()})}}c||o.duration(c=T.duration())}else o.timeline=0;return m===!0&&!uO&&(kd=Yu(o),ds.killTweensOf(S),kd=0),qc(b,Yu(o),r),s.reversed&&o.reverse(),s.paused&&o.paused(!0),(h||!c&&!g&&o._start===Qs(b._time)&&oo(h)&&Abe(Yu(o))&&b.data!=="nested")&&(o._tTime=-Gi,o.render(Math.max(0,-u)||0)),v&&FZ(Yu(o),v),o}var t=e.prototype;return t.render=function(s,r,a){var o=this._time,l=this._tDur,c=this._dur,u=s<0,h=s>l-Gi&&!u?l:s<Gi?0:s,f,m,g,x,v,y,b,S,T;if(!c)Ebe(this,s,r,a);else if(h!==this._tTime||!s||a||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==u||this._lazy){if(f=h,S=this.timeline,this._repeat){if(x=c+this._rDelay,this._repeat<-1&&u)return this.totalTime(x*100+s,r,a);if(f=Qs(h%x),h===l?(g=this._repeat,f=c):(v=Qs(h/x),g=~~v,g&&g===v?(f=c,g--):f>c&&(f=c)),y=this._yoyo&&g&1,y&&(T=this._yEase,f=c-f),v=sx(this._tTime,x),f===o&&!a&&this._initted&&g===v)return this._tTime=h,this;g!==v&&(S&&this._yEase&&$Z(S,y),this.vars.repeatRefresh&&!y&&!this._lock&&f!==x&&this._initted&&(this._lock=a=1,this.render(Qs(x*g),!0).invalidate()._lock=0))}if(!this._initted){if(GZ(this,u?s:f,a,r,h))return this._tTime=0,this;if(o!==this._time&&!(a&&this.vars.repeatRefresh&&g!==v))return this;if(c!==this._dur)return this.render(s,r,a)}if(this._tTime=h,this._time=f,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=b=(T||this._ease)(f/c),this._from&&(this.ratio=b=1-b),!o&&h&&!r&&!v&&(Wo(this,"onStart"),this._tTime!==h))return this;for(m=this._pt;m;)m.r(b,m.d),m=m._next;S&&S.render(s<0?s:S._dur*S._ease(f/this._dur),r,a)||this._startAt&&(this._zTime=s),this._onUpdate&&!r&&(u&&M3(this,s,r,a),Wo(this,"onUpdate")),this._repeat&&g!==v&&this.vars.onRepeat&&!r&&this.parent&&Wo(this,"onRepeat"),(h===this._tDur||!h)&&this._tTime===h&&(u&&!this._onUpdate&&M3(this,s,!0,!0),(s||!c)&&(h===this._tDur&&this._ts>0||!h&&this._ts<0)&&Wf(this,1),!r&&!(u&&!o)&&(h||o||y)&&(Wo(this,h===l?"onComplete":"onReverseComplete",!0),this._prom&&!(h<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(s){return(!s||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(s),i.prototype.invalidate.call(this,s)},t.resetTo=function(s,r,a,o,l){Vb||Vo.wake(),this._ts||this.play();var c=Math.min(this._dur,(this._dp._time-this._start)*this._ts),u;return this._initted||vO(this,c),u=this._ease(c/this._dur),Xbe(this,s,r,a,o,u,c,l)?this.resetTo(s,r,a,o,1):(Sw(this,0),this.parent||PZ(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(s,r){if(r===void 0&&(r="all"),!s&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?yv(this):this.scrollTrigger&&this.scrollTrigger.kill(!!Kr),this;if(this.timeline){var a=this.timeline.totalDuration();return this.timeline.killTweensOf(s,r,kd&&kd.vars.overwrite!==!0)._first||yv(this),this.parent&&a!==this.timeline.totalDuration()&&rx(this,this._dur*this.timeline._tDur/a,0,1),this}var o=this._targets,l=s?Gl(s):o,c=this._ptLookup,u=this._pt,h,f,m,g,x,v,y;if((!r||r==="all")&&Sbe(o,l))return r==="all"&&(this._pt=0),yv(this);for(h=this._op=this._op||[],r!=="all"&&(Ur(r)&&(x={},lo(r,function(b){return x[b]=1}),r=x),r=qbe(o,r)),y=o.length;y--;)if(~l.indexOf(o[y])){f=c[y],r==="all"?(h[y]=r,g=f,m={}):(m=h[y]=h[y]||{},g=r);for(x in g)v=f&&f[x],v&&((!("kill"in v.d)||v.d.kill(x)===!0)&&vw(this,v,"_pt"),delete f[x]),m!=="all"&&(m[x]=1)}return this._initted&&!this._pt&&u&&yv(this),this},e.to=function(s,r){return new e(s,r,arguments[2])},e.from=function(s,r){return $v(1,arguments)},e.delayedCall=function(s,r,a,o){return new e(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:s,onComplete:r,onReverseComplete:r,onCompleteParams:a,onReverseCompleteParams:a,callbackScope:o})},e.fromTo=function(s,r,a){return $v(2,arguments)},e.set=function(s,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new e(s,r)},e.killTweensOf=function(s,r,a){return ds.killTweensOf(s,r,a)},e}(Hb);rl(Zs.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});lo("staggerTo,staggerFrom,staggerFromTo",function(i){Zs[i]=function(){var e=new Va,t=C3.call(arguments,0);return t.splice(i==="staggerFromTo"?5:4,0,0),e[i].apply(e,t)}});var bO=function(e,t,n){return e[t]=n},rJ=function(e,t,n){return e[t](n)},Ybe=function(e,t,n,s){return e[t](s.fp,n)},Kbe=function(e,t,n){return e.setAttribute(t,n)},SO=function(e,t){return Ms(e[t])?rJ:hO(e[t])&&e.setAttribute?Kbe:bO},aJ=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},Zbe=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},oJ=function(e,t){var n=t._pt,s="";if(!e&&t.b)s=t.b;else if(e===1&&t.e)s=t.e;else{for(;n;)s=n.p+(n.m?n.m(n.s+n.c*e):Math.round((n.s+n.c*e)*1e4)/1e4)+s,n=n._next;s+=t.c}t.set(t.t,t.p,s,t)},TO=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},Jbe=function(e,t,n,s){for(var r=this._pt,a;r;)a=r._next,r.p===s&&r.modifier(e,t,n),r=a},Qbe=function(e){for(var t=this._pt,n,s;t;)s=t._next,t.p===e&&!t.op||t.op===e?vw(this,t,"_pt"):t.dep||(n=1),t=s;return!n},$be=function(e,t,n,s){s.mSet(e,t,s.m.call(s.tween,n,s.mt),s)},lJ=function(e){for(var t=e._pt,n,s,r,a;t;){for(n=t._next,s=r;s&&s.pr>t.pr;)s=s._next;(t._prev=s?s._prev:a)?t._prev._next=t:r=t,(t._next=s)?s._prev=t:a=t,t=n}e._pt=r},co=function(){function i(t,n,s,r,a,o,l,c,u){this.t=n,this.s=r,this.c=a,this.p=s,this.r=o||aJ,this.d=l||this,this.set=c||bO,this.pr=u||0,this._next=t,t&&(t._prev=this)}var e=i.prototype;return e.modifier=function(n,s,r){this.mSet=this.mSet||this.set,this.set=$be,this.m=n,this.mt=r,this.tween=s},i}();lo(gO+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(i){return mO[i]=1});sl.TweenMax=sl.TweenLite=Zs;sl.TimelineLite=sl.TimelineMax=Va;ds=new Va({sortChildren:!1,defaults:nx,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Qo.stringFilter=JZ;var Bm=[],$A={},eSe=[],GH=0,tSe=0,aB=function(e){return($A[e]||eSe).map(function(t){return t()})},B3=function(){var e=Date.now(),t=[];e-GH>2&&(aB("matchMediaInit"),Bm.forEach(function(n){var s=n.queries,r=n.conditions,a,o,l,c;for(o in s)a=Hc.matchMedia(s[o]).matches,a&&(l=1),a!==r[o]&&(r[o]=a,c=1);c&&(n.revert(),l&&t.push(n))}),aB("matchMediaRevert"),t.forEach(function(n){return n.onMatch(n,function(s){return n.add(null,s)})}),GH=e,aB("matchMedia"))},cJ=function(){function i(t,n){this.selector=n&&w3(n),this.data=[],this._r=[],this.isReverted=!1,this.id=tSe++,t&&this.add(t)}var e=i.prototype;return e.add=function(n,s,r){Ms(n)&&(r=s,s=n,n=Ms);var a=this,o=function(){var c=is,u=a.selector,h;return c&&c!==a&&c.data.push(a),r&&(a.selector=w3(r)),is=a,h=s.apply(a,arguments),Ms(h)&&a._r.push(h),is=c,a.selector=u,a.isReverted=!1,h};return a.last=o,n===Ms?o(a,function(l){return a.add(null,l)}):n?a[n]=o:o},e.ignore=function(n){var s=is;is=null,n(this),is=s},e.getTweens=function(){var n=[];return this.data.forEach(function(s){return s instanceof i?n.push.apply(n,s.getTweens()):s instanceof Zs&&!(s.parent&&s.parent.data==="nested")&&n.push(s)}),n},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(n,s){var r=this;if(n?function(){for(var o=r.getTweens(),l=r.data.length,c;l--;)c=r.data[l],c.data==="isFlip"&&(c.revert(),c.getChildren(!0,!0,!1).forEach(function(u){return o.splice(o.indexOf(u),1)}));for(o.map(function(u){return{g:u._dur||u._delay||u._sat&&!u._sat.vars.immediateRender?u.globalTime(0):-1/0,t:u}}).sort(function(u,h){return h.g-u.g||-1/0}).forEach(function(u){return u.t.revert(n)}),l=r.data.length;l--;)c=r.data[l],c instanceof Va?c.data!=="nested"&&(c.scrollTrigger&&c.scrollTrigger.revert(),c.kill()):!(c instanceof Zs)&&c.revert&&c.revert(n);r._r.forEach(function(u){return u(n,r)}),r.isReverted=!0}():this.data.forEach(function(o){return o.kill&&o.kill()}),this.clear(),s)for(var a=Bm.length;a--;)Bm[a].id===this.id&&Bm.splice(a,1)},e.revert=function(n){this.kill(n||{})},i}(),nSe=function(){function i(t){this.contexts=[],this.scope=t,is&&is.data.push(this)}var e=i.prototype;return e.add=function(n,s,r){xu(n)||(n={matches:n});var a=new cJ(0,r||this.scope),o=a.conditions={},l,c,u;is&&!a.selector&&(a.selector=is.selector),this.contexts.push(a),s=a.add("onMatch",s),a.queries=n;for(c in n)c==="all"?u=1:(l=Hc.matchMedia(n[c]),l&&(Bm.indexOf(a)<0&&Bm.push(a),(o[c]=l.matches)&&(u=1),l.addListener?l.addListener(B3):l.addEventListener("change",B3)));return u&&s(a,function(h){return a.add(null,h)}),this},e.revert=function(n){this.kill(n||{})},e.kill=function(n){this.contexts.forEach(function(s){return s.kill(n,!0)})},i}(),pE={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(s){return YZ(s)})},timeline:function(e){return new Va(e)},getTweensOf:function(e,t){return ds.getTweensOf(e,t)},getProperty:function(e,t,n,s){Ur(e)&&(e=Gl(e)[0]);var r=wm(e||{}).get,a=n?IZ:UZ;return n==="native"&&(n=""),e&&(t?a((Fo[t]&&Fo[t].get||r)(e,t,n,s)):function(o,l,c){return a((Fo[o]&&Fo[o].get||r)(e,o,l,c))})},quickSetter:function(e,t,n){if(e=Gl(e),e.length>1){var s=e.map(function(u){return mo.quickSetter(u,t,n)}),r=s.length;return function(u){for(var h=r;h--;)s[h](u)}}e=e[0]||{};var a=Fo[t],o=wm(e),l=o.harness&&(o.harness.aliases||{})[t]||t,c=a?function(u){var h=new a;oy._pt=0,h.init(e,n?u+n:u,oy,0,[e]),h.render(1,h),oy._pt&&TO(1,oy)}:o.set(e,l);return a?c:function(u){return c(e,l,n?u+n:u,o,1)}},quickTo:function(e,t,n){var s,r=mo.to(e,rl((s={},s[t]="+=0.1",s.paused=!0,s.stagger=0,s),n||{})),a=function(l,c,u){return r.resetTo(t,l,c,u)};return a.tween=r,a},isTweening:function(e){return ds.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Nm(e.ease,nx.ease)),UH(nx,e||{})},config:function(e){return UH(Qo,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,s=e.plugins,r=e.defaults,a=e.extendTimeline;(s||"").split(",").forEach(function(o){return o&&!Fo[o]&&!sl[o]&&Fb(t+" effect requires "+o+" plugin.")}),nB[t]=function(o,l,c){return n(Gl(o),rl(l||{},r),c)},a&&(Va.prototype[t]=function(o,l,c){return this.add(nB[t](o,xu(l)?l:(c=l)&&{},this),c)})},registerEase:function(e,t){Yn[e]=Nm(t)},parseEase:function(e,t){return arguments.length?Nm(e,t):Yn},getById:function(e){return ds.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var n=new Va(e),s,r;for(n.smoothChildTiming=oo(e.smoothChildTiming),ds.remove(n),n._dp=0,n._time=n._tTime=ds._time,s=ds._first;s;)r=s._next,(t||!(!s._dur&&s instanceof Zs&&s.vars.onComplete===s._targets[0]))&&qc(n,s,s._start-s._delay),s=r;return qc(ds,n,0),n},context:function(e,t){return e?new cJ(e,t):is},matchMedia:function(e){return new nSe(e)},matchMediaRefresh:function(){return Bm.forEach(function(e){var t=e.conditions,n,s;for(s in t)t[s]&&(t[s]=!1,n=1);n&&e.revert()})||B3()},addEventListener:function(e,t){var n=$A[e]||($A[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=$A[e],s=n&&n.indexOf(t);s>=0&&n.splice(s,1)},utils:{wrap:Ube,wrapYoyo:Ibe,distribute:HZ,random:WZ,snap:kZ,normalize:Lbe,getUnit:fa,clamp:Rbe,splitColor:KZ,toArray:Gl,selector:w3,mapRange:qZ,pipe:Bbe,unitize:Dbe,interpolate:Pbe,shuffle:VZ},install:RZ,effects:nB,ticker:Vo,updateRoot:Va.updateRoot,plugins:Fo,globalTimeline:ds,core:{PropTween:co,globals:NZ,Tween:Zs,Timeline:Va,Animation:Hb,getCache:wm,_removeLinkedListItem:vw,reverting:function(){return Kr},context:function(e){return e&&is&&(is.data.push(e),e._ctx=is),is},suppressOverwrites:function(e){return uO=e}}};lo("to,from,fromTo,delayedCall,set,killTweensOf",function(i){return pE[i]=Zs[i]});Vo.add(Va.updateRoot);oy=pE.to({},{duration:0});var iSe=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},sSe=function(e,t){var n=e._targets,s,r,a;for(s in t)for(r=n.length;r--;)a=e._ptLookup[r][s],a&&(a=a.d)&&(a._pt&&(a=iSe(a,s)),a&&a.modifier&&a.modifier(t[s],e,n[r],s))},oB=function(e,t){return{name:e,headless:1,rawVars:1,init:function(s,r,a){a._onInit=function(o){var l,c;if(Ur(r)&&(l={},lo(r,function(u){return l[u]=1}),r=l),t){l={};for(c in r)l[c]=t(r[c]);r=l}sSe(o,r)}}}},mo=pE.registerPlugin({name:"attr",init:function(e,t,n,s,r){var a,o,l;this.tween=n;for(a in t)l=e.getAttribute(a)||"",o=this.add(e,"setAttribute",(l||0)+"",t[a],s,r,0,0,a),o.op=a,o.b=l,this._props.push(a)},render:function(e,t){for(var n=t._pt;n;)Kr?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",headless:1,init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},oB("roundProps",R3),oB("modifiers"),oB("snap",kZ))||pE;Zs.version=Va.version=mo.version="3.13.0";wZ=1;dO()&&ax();Yn.Power0;Yn.Power1;Yn.Power2;Yn.Power3;Yn.Power4;Yn.Linear;Yn.Quad;Yn.Cubic;Yn.Quart;Yn.Quint;Yn.Strong;Yn.Elastic;Yn.Back;Yn.SteppedEase;Yn.Bounce;Yn.Sine;Yn.Expo;Yn.Circ;/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var zH,Wd,Ry,AO,mm,VH,MO,rSe=function(){return typeof window<"u"},Ih={},tm=180/Math.PI,Ny=Math.PI/180,O0=Math.atan2,HH=1e8,EO=/([A-Z])/g,aSe=/(left|right|width|margin|padding|x)/i,oSe=/[\s,\(]\S/,Yc={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},D3=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},lSe=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},cSe=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},uSe=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},uJ=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},hJ=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},hSe=function(e,t,n){return e.style[t]=n},dSe=function(e,t,n){return e.style.setProperty(t,n)},fSe=function(e,t,n){return e._gsap[t]=n},pSe=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},mSe=function(e,t,n,s,r){var a=e._gsap;a.scaleX=a.scaleY=n,a.renderTransform(r,a)},gSe=function(e,t,n,s,r){var a=e._gsap;a[t]=n,a.renderTransform(r,a)},ms="transform",uo=ms+"Origin",ySe=function i(e,t){var n=this,s=this.target,r=s.style,a=s._gsap;if(e in Ih&&r){if(this.tfm=this.tfm||{},e!=="transform")e=Yc[e]||e,~e.indexOf(",")?e.split(",").forEach(function(o){return n.tfm[o]=Qu(s,o)}):this.tfm[e]=a.x?a[e]:Qu(s,e),e===uo&&(this.tfm.zOrigin=a.zOrigin);else return Yc.transform.split(",").forEach(function(o){return i.call(n,o,t)});if(this.props.indexOf(ms)>=0)return;a.svg&&(this.svgo=s.getAttribute("data-svg-origin"),this.props.push(uo,t,"")),e=ms}(r||t)&&this.props.push(e,t,r[e])},dJ=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},xSe=function(){var e=this.props,t=this.target,n=t.style,s=t._gsap,r,a;for(r=0;r<e.length;r+=3)e[r+1]?e[r+1]===2?t[e[r]](e[r+2]):t[e[r]]=e[r+2]:e[r+2]?n[e[r]]=e[r+2]:n.removeProperty(e[r].substr(0,2)==="--"?e[r]:e[r].replace(EO,"-$1").toLowerCase());if(this.tfm){for(a in this.tfm)s[a]=this.tfm[a];s.svg&&(s.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),r=MO(),(!r||!r.isStart)&&!n[ms]&&(dJ(n),s.zOrigin&&n[uo]&&(n[uo]+=" "+s.zOrigin+"px",s.zOrigin=0,s.renderTransform()),s.uncache=1)}},fJ=function(e,t){var n={target:e,props:[],revert:xSe,save:ySe};return e._gsap||mo.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(s){return n.save(s)}),n},pJ,L3=function(e,t){var n=Wd.createElementNS?Wd.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Wd.createElement(e);return n&&n.style?n:Wd.createElement(e)},zl=function i(e,t,n){var s=getComputedStyle(e);return s[t]||s.getPropertyValue(t.replace(EO,"-$1").toLowerCase())||s.getPropertyValue(t)||!n&&i(e,ox(t)||t,1)||""},kH="O,Moz,ms,Ms,Webkit".split(","),ox=function(e,t,n){var s=t||mm,r=s.style,a=5;if(e in r&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);a--&&!(kH[a]+e in r););return a<0?null:(a===3?"ms":a>=0?kH[a]:"")+e},U3=function(){rSe()&&window.document&&(zH=window,Wd=zH.document,Ry=Wd.documentElement,mm=L3("div")||{style:{}},L3("div"),ms=ox(ms),uo=ms+"Origin",mm.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",pJ=!!ox("perspective"),MO=mo.core.reverting,AO=1)},WH=function(e){var t=e.ownerSVGElement,n=L3("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=e.cloneNode(!0),r;s.style.display="block",n.appendChild(s),Ry.appendChild(n);try{r=s.getBBox()}catch{}return n.removeChild(s),Ry.removeChild(n),r},XH=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},mJ=function(e){var t,n;try{t=e.getBBox()}catch{t=WH(e),n=1}return t&&(t.width||t.height)||n||(t=WH(e)),t&&!t.width&&!t.x&&!t.y?{x:+XH(e,["x","cx","x1"])||0,y:+XH(e,["y","cy","y1"])||0,width:0,height:0}:t},gJ=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&mJ(e))},lg=function(e,t){if(t){var n=e.style,s;t in Ih&&t!==uo&&(t=ms),n.removeProperty?(s=t.substr(0,2),(s==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),n.removeProperty(s==="--"?t:t.replace(EO,"-$1").toLowerCase())):n.removeAttribute(t)}},Xd=function(e,t,n,s,r,a){var o=new co(e._pt,t,n,0,1,a?hJ:uJ);return e._pt=o,o.b=s,o.e=r,e._props.push(n),o},qH={deg:1,rad:1,turn:1},_Se={grid:1,flex:1},Xf=function i(e,t,n,s){var r=parseFloat(n)||0,a=(n+"").trim().substr((r+"").length)||"px",o=mm.style,l=aSe.test(t),c=e.tagName.toLowerCase()==="svg",u=(c?"client":"offset")+(l?"Width":"Height"),h=100,f=s==="px",m=s==="%",g,x,v,y;if(s===a||!r||qH[s]||qH[a])return r;if(a!=="px"&&!f&&(r=i(e,t,n,"px")),y=e.getCTM&&gJ(e),(m||a==="%")&&(Ih[t]||~t.indexOf("adius")))return g=y?e.getBBox()[l?"width":"height"]:e[u],Us(m?r/g*h:r/100*g);if(o[l?"width":"height"]=h+(f?a:s),x=s!=="rem"&&~t.indexOf("adius")||s==="em"&&e.appendChild&&!c?e:e.parentNode,y&&(x=(e.ownerSVGElement||{}).parentNode),(!x||x===Wd||!x.appendChild)&&(x=Wd.body),v=x._gsap,v&&m&&v.width&&l&&v.time===Vo.time&&!v.uncache)return Us(r/v.width*h);if(m&&(t==="height"||t==="width")){var b=e.style[t];e.style[t]=h+s,g=e[u],b?e.style[t]=b:lg(e,t)}else(m||a==="%")&&!_Se[zl(x,"display")]&&(o.position=zl(e,"position")),x===e&&(o.position="static"),x.appendChild(mm),g=mm[u],x.removeChild(mm),o.position="absolute";return l&&m&&(v=wm(x),v.time=Vo.time,v.width=x[u]),Us(f?g*r/h:g&&r?h/g*r:0)},Qu=function(e,t,n,s){var r;return AO||U3(),t in Yc&&t!=="transform"&&(t=Yc[t],~t.indexOf(",")&&(t=t.split(",")[0])),Ih[t]&&t!=="transform"?(r=Wb(e,s),r=t!=="transformOrigin"?r[t]:r.svg?r.origin:gE(zl(e,uo))+" "+r.zOrigin+"px"):(r=e.style[t],(!r||r==="auto"||s||~(r+"").indexOf("calc("))&&(r=mE[t]&&mE[t](e,t,n)||zl(e,t)||DZ(e,t)||(t==="opacity"?1:0))),n&&!~(r+"").trim().indexOf(" ")?Xf(e,t,r,n)+n:r},vSe=function(e,t,n,s){if(!n||n==="none"){var r=ox(t,e,1),a=r&&zl(e,r,1);a&&a!==n?(t=r,n=a):t==="borderColor"&&(n=zl(e,"borderTopColor"))}var o=new co(this._pt,e.style,t,0,1,oJ),l=0,c=0,u,h,f,m,g,x,v,y,b,S,T,M;if(o.b=n,o.e=s,n+="",s+="",s.substring(0,6)==="var(--"&&(s=zl(e,s.substring(4,s.indexOf(")")))),s==="auto"&&(x=e.style[t],e.style[t]=s,s=zl(e,t)||s,x?e.style[t]=x:lg(e,t)),u=[n,s],JZ(u),n=u[0],s=u[1],f=n.match(ay)||[],M=s.match(ay)||[],M.length){for(;h=ay.exec(s);)v=h[0],b=s.substring(l,h.index),g?g=(g+1)%5:(b.substr(-5)==="rgba("||b.substr(-5)==="hsla(")&&(g=1),v!==(x=f[c++]||"")&&(m=parseFloat(x)||0,T=x.substr((m+"").length),v.charAt(1)==="="&&(v=wy(m,v)+T),y=parseFloat(v),S=v.substr((y+"").length),l=ay.lastIndex-S.length,S||(S=S||Qo.units[t]||T,l===s.length&&(s+=S,o.e+=S)),T!==S&&(m=Xf(e,t,x,S)||0),o._pt={_next:o._pt,p:b||c===1?b:",",s:m,c:y-m,m:g&&g<4||t==="zIndex"?Math.round:0});o.c=l<s.length?s.substring(l,s.length):""}else o.r=t==="display"&&s==="none"?hJ:uJ;return EZ.test(s)&&(o.e=0),this._pt=o,o},jH={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},bSe=function(e){var t=e.split(" "),n=t[0],s=t[1]||"50%";return(n==="top"||n==="bottom"||s==="left"||s==="right")&&(e=n,n=s,s=e),t[0]=jH[n]||n,t[1]=jH[s]||s,t.join(" ")},SSe=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n=t.t,s=n.style,r=t.u,a=n._gsap,o,l,c;if(r==="all"||r===!0)s.cssText="",l=1;else for(r=r.split(","),c=r.length;--c>-1;)o=r[c],Ih[o]&&(l=1,o=o==="transformOrigin"?uo:ms),lg(n,o);l&&(lg(n,ms),a&&(a.svg&&n.removeAttribute("transform"),s.scale=s.rotate=s.translate="none",Wb(n,1),a.uncache=1,dJ(s)))}},mE={clearProps:function(e,t,n,s,r){if(r.data!=="isFromStart"){var a=e._pt=new co(e._pt,t,n,0,0,SSe);return a.u=s,a.pr=-10,a.tween=r,e._props.push(n),1}}},kb=[1,0,0,1,0,0],yJ={},xJ=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},YH=function(e){var t=zl(e,ms);return xJ(t)?kb:t.substr(7).match(MZ).map(Us)},CO=function(e,t){var n=e._gsap||wm(e),s=e.style,r=YH(e),a,o,l,c;return n.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,r=[l.a,l.b,l.c,l.d,l.e,l.f],r.join(",")==="1,0,0,1,0,0"?kb:r):(r===kb&&!e.offsetParent&&e!==Ry&&!n.svg&&(l=s.display,s.display="block",a=e.parentNode,(!a||!e.offsetParent&&!e.getBoundingClientRect().width)&&(c=1,o=e.nextElementSibling,Ry.appendChild(e)),r=YH(e),l?s.display=l:lg(e,"display"),c&&(o?a.insertBefore(e,o):a?a.appendChild(e):Ry.removeChild(e))),t&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},I3=function(e,t,n,s,r,a){var o=e._gsap,l=r||CO(e,!0),c=o.xOrigin||0,u=o.yOrigin||0,h=o.xOffset||0,f=o.yOffset||0,m=l[0],g=l[1],x=l[2],v=l[3],y=l[4],b=l[5],S=t.split(" "),T=parseFloat(S[0])||0,M=parseFloat(S[1])||0,C,w,N,E;n?l!==kb&&(w=m*v-g*x)&&(N=T*(v/w)+M*(-x/w)+(x*b-v*y)/w,E=T*(-g/w)+M*(m/w)-(m*b-g*y)/w,T=N,M=E):(C=mJ(e),T=C.x+(~S[0].indexOf("%")?T/100*C.width:T),M=C.y+(~(S[1]||S[0]).indexOf("%")?M/100*C.height:M)),s||s!==!1&&o.smooth?(y=T-c,b=M-u,o.xOffset=h+(y*m+b*x)-y,o.yOffset=f+(y*g+b*v)-b):o.xOffset=o.yOffset=0,o.xOrigin=T,o.yOrigin=M,o.smooth=!!s,o.origin=t,o.originIsAbsolute=!!n,e.style[uo]="0px 0px",a&&(Xd(a,o,"xOrigin",c,T),Xd(a,o,"yOrigin",u,M),Xd(a,o,"xOffset",h,o.xOffset),Xd(a,o,"yOffset",f,o.yOffset)),e.setAttribute("data-svg-origin",T+" "+M)},Wb=function(e,t){var n=e._gsap||new tJ(e);if("x"in n&&!t&&!n.uncache)return n;var s=e.style,r=n.scaleX<0,a="px",o="deg",l=getComputedStyle(e),c=zl(e,uo)||"0",u,h,f,m,g,x,v,y,b,S,T,M,C,w,N,E,B,U,H,F,V,Y,P,X,J,re,ne,ge,Te,Be,et,wt;return u=h=f=x=v=y=b=S=T=0,m=g=1,n.svg=!!(e.getCTM&&gJ(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(s[ms]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[ms]!=="none"?l[ms]:"")),s.scale=s.rotate=s.translate="none"),w=CO(e,n.svg),n.svg&&(n.uncache?(J=e.getBBox(),c=n.xOrigin-J.x+"px "+(n.yOrigin-J.y)+"px",X=""):X=!t&&e.getAttribute("data-svg-origin"),I3(e,X||c,!!X||n.originIsAbsolute,n.smooth!==!1,w)),M=n.xOrigin||0,C=n.yOrigin||0,w!==kb&&(U=w[0],H=w[1],F=w[2],V=w[3],u=Y=w[4],h=P=w[5],w.length===6?(m=Math.sqrt(U*U+H*H),g=Math.sqrt(V*V+F*F),x=U||H?O0(H,U)*tm:0,b=F||V?O0(F,V)*tm+x:0,b&&(g*=Math.abs(Math.cos(b*Ny))),n.svg&&(u-=M-(M*U+C*F),h-=C-(M*H+C*V))):(wt=w[6],Be=w[7],ne=w[8],ge=w[9],Te=w[10],et=w[11],u=w[12],h=w[13],f=w[14],N=O0(wt,Te),v=N*tm,N&&(E=Math.cos(-N),B=Math.sin(-N),X=Y*E+ne*B,J=P*E+ge*B,re=wt*E+Te*B,ne=Y*-B+ne*E,ge=P*-B+ge*E,Te=wt*-B+Te*E,et=Be*-B+et*E,Y=X,P=J,wt=re),N=O0(-F,Te),y=N*tm,N&&(E=Math.cos(-N),B=Math.sin(-N),X=U*E-ne*B,J=H*E-ge*B,re=F*E-Te*B,et=V*B+et*E,U=X,H=J,F=re),N=O0(H,U),x=N*tm,N&&(E=Math.cos(N),B=Math.sin(N),X=U*E+H*B,J=Y*E+P*B,H=H*E-U*B,P=P*E-Y*B,U=X,Y=J),v&&Math.abs(v)+Math.abs(x)>359.9&&(v=x=0,y=180-y),m=Us(Math.sqrt(U*U+H*H+F*F)),g=Us(Math.sqrt(P*P+wt*wt)),N=O0(Y,P),b=Math.abs(N)>2e-4?N*tm:0,T=et?1/(et<0?-et:et):0),n.svg&&(X=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!xJ(zl(e,ms)),X&&e.setAttribute("transform",X))),Math.abs(b)>90&&Math.abs(b)<270&&(r?(m*=-1,b+=x<=0?180:-180,x+=x<=0?180:-180):(g*=-1,b+=b<=0?180:-180)),t=t||n.uncache,n.x=u-((n.xPercent=u&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-u)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+a,n.y=h-((n.yPercent=h&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-h)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+a,n.z=f+a,n.scaleX=Us(m),n.scaleY=Us(g),n.rotation=Us(x)+o,n.rotationX=Us(v)+o,n.rotationY=Us(y)+o,n.skewX=b+o,n.skewY=S+o,n.transformPerspective=T+a,(n.zOrigin=parseFloat(c.split(" ")[2])||!t&&n.zOrigin||0)&&(s[uo]=gE(c)),n.xOffset=n.yOffset=0,n.force3D=Qo.force3D,n.renderTransform=n.svg?ASe:pJ?_J:TSe,n.uncache=0,n},gE=function(e){return(e=e.split(" "))[0]+" "+e[1]},lB=function(e,t,n){var s=fa(t);return Us(parseFloat(t)+parseFloat(Xf(e,"x",n+"px",s)))+s},TSe=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,_J(e,t)},Kp="0deg",ev="0px",Zp=") ",_J=function(e,t){var n=t||this,s=n.xPercent,r=n.yPercent,a=n.x,o=n.y,l=n.z,c=n.rotation,u=n.rotationY,h=n.rotationX,f=n.skewX,m=n.skewY,g=n.scaleX,x=n.scaleY,v=n.transformPerspective,y=n.force3D,b=n.target,S=n.zOrigin,T="",M=y==="auto"&&e&&e!==1||y===!0;if(S&&(h!==Kp||u!==Kp)){var C=parseFloat(u)*Ny,w=Math.sin(C),N=Math.cos(C),E;C=parseFloat(h)*Ny,E=Math.cos(C),a=lB(b,a,w*E*-S),o=lB(b,o,-Math.sin(C)*-S),l=lB(b,l,N*E*-S+S)}v!==ev&&(T+="perspective("+v+Zp),(s||r)&&(T+="translate("+s+"%, "+r+"%) "),(M||a!==ev||o!==ev||l!==ev)&&(T+=l!==ev||M?"translate3d("+a+", "+o+", "+l+") ":"translate("+a+", "+o+Zp),c!==Kp&&(T+="rotate("+c+Zp),u!==Kp&&(T+="rotateY("+u+Zp),h!==Kp&&(T+="rotateX("+h+Zp),(f!==Kp||m!==Kp)&&(T+="skew("+f+", "+m+Zp),(g!==1||x!==1)&&(T+="scale("+g+", "+x+Zp),b.style[ms]=T||"translate(0, 0)"},ASe=function(e,t){var n=t||this,s=n.xPercent,r=n.yPercent,a=n.x,o=n.y,l=n.rotation,c=n.skewX,u=n.skewY,h=n.scaleX,f=n.scaleY,m=n.target,g=n.xOrigin,x=n.yOrigin,v=n.xOffset,y=n.yOffset,b=n.forceCSS,S=parseFloat(a),T=parseFloat(o),M,C,w,N,E;l=parseFloat(l),c=parseFloat(c),u=parseFloat(u),u&&(u=parseFloat(u),c+=u,l+=u),l||c?(l*=Ny,c*=Ny,M=Math.cos(l)*h,C=Math.sin(l)*h,w=Math.sin(l-c)*-f,N=Math.cos(l-c)*f,c&&(u*=Ny,E=Math.tan(c-u),E=Math.sqrt(1+E*E),w*=E,N*=E,u&&(E=Math.tan(u),E=Math.sqrt(1+E*E),M*=E,C*=E)),M=Us(M),C=Us(C),w=Us(w),N=Us(N)):(M=h,N=f,C=w=0),(S&&!~(a+"").indexOf("px")||T&&!~(o+"").indexOf("px"))&&(S=Xf(m,"x",a,"px"),T=Xf(m,"y",o,"px")),(g||x||v||y)&&(S=Us(S+g-(g*M+x*w)+v),T=Us(T+x-(g*C+x*N)+y)),(s||r)&&(E=m.getBBox(),S=Us(S+s/100*E.width),T=Us(T+r/100*E.height)),E="matrix("+M+","+C+","+w+","+N+","+S+","+T+")",m.setAttribute("transform",E),b&&(m.style[ms]=E)},MSe=function(e,t,n,s,r){var a=360,o=Ur(r),l=parseFloat(r)*(o&&~r.indexOf("rad")?tm:1),c=l-s,u=s+c+"deg",h,f;return o&&(h=r.split("_")[1],h==="short"&&(c%=a,c!==c%(a/2)&&(c+=c<0?a:-a)),h==="cw"&&c<0?c=(c+a*HH)%a-~~(c/a)*a:h==="ccw"&&c>0&&(c=(c-a*HH)%a-~~(c/a)*a)),e._pt=f=new co(e._pt,t,n,s,c,lSe),f.e=u,f.u="deg",e._props.push(n),f},KH=function(e,t){for(var n in t)e[n]=t[n];return e},ESe=function(e,t,n){var s=KH({},n._gsap),r="perspective,force3D,transformOrigin,svgOrigin",a=n.style,o,l,c,u,h,f,m,g;s.svg?(c=n.getAttribute("transform"),n.setAttribute("transform",""),a[ms]=t,o=Wb(n,1),lg(n,ms),n.setAttribute("transform",c)):(c=getComputedStyle(n)[ms],a[ms]=t,o=Wb(n,1),a[ms]=c);for(l in Ih)c=s[l],u=o[l],c!==u&&r.indexOf(l)<0&&(m=fa(c),g=fa(u),h=m!==g?Xf(n,l,c,g):parseFloat(c),f=parseFloat(u),e._pt=new co(e._pt,o,l,h,f-h,D3),e._pt.u=g||0,e._props.push(l));KH(o,s)};lo("padding,margin,Width,Radius",function(i,e){var t="Top",n="Right",s="Bottom",r="Left",a=(e<3?[t,n,s,r]:[t+r,t+n,s+n,s+r]).map(function(o){return e<2?i+o:"border"+o+i});mE[e>1?"border"+i:i]=function(o,l,c,u,h){var f,m;if(arguments.length<4)return f=a.map(function(g){return Qu(o,g,c)}),m=f.join(" "),m.split(f[0]).length===5?f[0]:m;f=(u+"").split(" "),m={},a.forEach(function(g,x){return m[g]=f[x]=f[x]||f[(x-1)/2|0]}),o.init(l,m,h)}});var vJ={name:"css",register:U3,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,s,r){var a=this._props,o=e.style,l=n.vars.startAt,c,u,h,f,m,g,x,v,y,b,S,T,M,C,w,N;AO||U3(),this.styles=this.styles||fJ(e),N=this.styles.props,this.tween=n;for(x in t)if(x!=="autoRound"&&(u=t[x],!(Fo[x]&&nJ(x,t,n,s,e,r)))){if(m=typeof u,g=mE[x],m==="function"&&(u=u.call(n,s,e,r),m=typeof u),m==="string"&&~u.indexOf("random(")&&(u=zb(u)),g)g(this,e,x,u,n)&&(w=1);else if(x.substr(0,2)==="--")c=(getComputedStyle(e).getPropertyValue(x)+"").trim(),u+="",of.lastIndex=0,of.test(c)||(v=fa(c),y=fa(u)),y?v!==y&&(c=Xf(e,x,c,y)+y):v&&(u+=v),this.add(o,"setProperty",c,u,s,r,0,0,x),a.push(x),N.push(x,0,o[x]);else if(m!=="undefined"){if(l&&x in l?(c=typeof l[x]=="function"?l[x].call(n,s,e,r):l[x],Ur(c)&&~c.indexOf("random(")&&(c=zb(c)),fa(c+"")||c==="auto"||(c+=Qo.units[x]||fa(Qu(e,x))||""),(c+"").charAt(1)==="="&&(c=Qu(e,x))):c=Qu(e,x),f=parseFloat(c),b=m==="string"&&u.charAt(1)==="="&&u.substr(0,2),b&&(u=u.substr(2)),h=parseFloat(u),x in Yc&&(x==="autoAlpha"&&(f===1&&Qu(e,"visibility")==="hidden"&&h&&(f=0),N.push("visibility",0,o.visibility),Xd(this,o,"visibility",f?"inherit":"hidden",h?"inherit":"hidden",!h)),x!=="scale"&&x!=="transform"&&(x=Yc[x],~x.indexOf(",")&&(x=x.split(",")[0]))),S=x in Ih,S){if(this.styles.save(x),m==="string"&&u.substring(0,6)==="var(--"&&(u=zl(e,u.substring(4,u.indexOf(")"))),h=parseFloat(u)),T||(M=e._gsap,M.renderTransform&&!t.parseTransform||Wb(e,t.parseTransform),C=t.smoothOrigin!==!1&&M.smooth,T=this._pt=new co(this._pt,o,ms,0,1,M.renderTransform,M,0,-1),T.dep=1),x==="scale")this._pt=new co(this._pt,M,"scaleY",M.scaleY,(b?wy(M.scaleY,b+h):h)-M.scaleY||0,D3),this._pt.u=0,a.push("scaleY",x),x+="X";else if(x==="transformOrigin"){N.push(uo,0,o[uo]),u=bSe(u),M.svg?I3(e,u,0,C,0,this):(y=parseFloat(u.split(" ")[2])||0,y!==M.zOrigin&&Xd(this,M,"zOrigin",M.zOrigin,y),Xd(this,o,x,gE(c),gE(u)));continue}else if(x==="svgOrigin"){I3(e,u,1,C,0,this);continue}else if(x in yJ){MSe(this,M,x,f,b?wy(f,b+u):u);continue}else if(x==="smoothOrigin"){Xd(this,M,"smooth",M.smooth,u);continue}else if(x==="force3D"){M[x]=u;continue}else if(x==="transform"){ESe(this,u,e);continue}}else x in o||(x=ox(x)||x);if(S||(h||h===0)&&(f||f===0)&&!oSe.test(u)&&x in o)v=(c+"").substr((f+"").length),h||(h=0),y=fa(u)||(x in Qo.units?Qo.units[x]:v),v!==y&&(f=Xf(e,x,c,y)),this._pt=new co(this._pt,S?M:o,x,f,(b?wy(f,b+h):h)-f,!S&&(y==="px"||x==="zIndex")&&t.autoRound!==!1?uSe:D3),this._pt.u=y||0,v!==y&&y!=="%"&&(this._pt.b=c,this._pt.r=cSe);else if(x in o)vSe.call(this,e,x,c,b?b+u:u);else if(x in e)this.add(e,x,c||e[x],b?b+u:u,s,r);else if(x!=="parseTransform"){pO(x,u);continue}S||(x in o?N.push(x,0,o[x]):typeof e[x]=="function"?N.push(x,2,e[x]()):N.push(x,1,c||e[x])),a.push(x)}}w&&lJ(this)},render:function(e,t){if(t.tween._time||!MO())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:Qu,aliases:Yc,getSetter:function(e,t,n){var s=Yc[t];return s&&s.indexOf(",")<0&&(t=s),t in Ih&&t!==uo&&(e._gsap.x||Qu(e,"x"))?n&&VH===n?t==="scale"?pSe:fSe:(VH=n||{})&&(t==="scale"?mSe:gSe):e.style&&!hO(e.style[t])?hSe:~t.indexOf("-")?dSe:SO(e,t)},core:{_removeProperty:lg,_getMatrix:CO}};mo.utils.checkPrefix=ox;mo.core.getStyleSaver=fJ;(function(i,e,t,n){var s=lo(i+","+e+","+t,function(r){Ih[r]=1});lo(e,function(r){Qo.units[r]="deg",yJ[r]=1}),Yc[s[13]]=i+","+e,lo(n,function(r){var a=r.split(":");Yc[a[1]]=s[a[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");lo("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(i){Qo.units[i]="px"});mo.registerPlugin(vJ);var uT=mo.registerPlugin(vJ)||mo;uT.core.Tween;const CSe=()=>{var i;try{return((i=window.localStorage)==null?void 0:i.getItem("qualitySettings"))||"balanced"}catch{return"balanced"}},bJ=CSe(),wSe=bJ!=="performance",Oe=bZ({startIntro:!1,width:window.innerWidth,isMobile:window.innerWidth<768,finishedIntro:!1,intro:!1,finishedLoadingAsset:!1,introTransition:null,finishedMainLoading:!1,environmentPreset:null,environmentColors:null,environmentBackgroundIntensity:.1,lightPosition:[2,3.5,0],waterRoughness:0,luminosity:90,controlsEnabled:!0,isDraggingCamera:!1,allowHover:!0,allowClick:!0,viewType:"main",selectedEnvironment:"bedroom",roomLoaderVisible:!1,timeOfDay:6.65,lightRotation:280,isManipulatingSlider:!1,qualitySettings:bJ,postProcessingEnabled:wSe,treesLoaded:!1,sunPosition3D:[0,50,0],sunPositionForLensFlare:[0,850,0],sunColor:"#eed0c2",sunOccluded:!1,openedPanel:null,selectedUnitId:null,unitSearchSurface:50,unitSearchBedroomCount:null,unitSearchBathroomCount:null,unitSearchOrientation:null,unitSearchAvailability:null,resetCamera:!1,isCameraAtDefaultPosition:!1,animateCameraToSurroundings:!1,animateCameraToUnitId:null,isViewingUnit:!1,previousSelectedUnitId:null,restoreDefaultControls:!1,hoveredPointOfInterest:null,hoveredUnitId:null,mousePosition:[0,0],audioVolume:.3}),cB=i=>{i!==void 0?Oe.isMusicPlaying=i:Oe.isMusicPlaying=!Oe.isMusicPlaying};function Xb(){return Xb=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Xb.apply(null,arguments)}const hT=new z,wO=new z,RSe=new z,ZH=new Ae;function NSe(i,e,t){const n=hT.setFromMatrixPosition(i.matrixWorld);n.project(e);const s=t.width/2,r=t.height/2;return[n.x*s+s,-(n.y*r)+r]}function BSe(i,e){const t=hT.setFromMatrixPosition(i.matrixWorld),n=wO.setFromMatrixPosition(e.matrixWorld),s=t.sub(n),r=e.getWorldDirection(RSe);return s.angleTo(r)>Math.PI/2}function DSe(i,e,t,n){const s=hT.setFromMatrixPosition(i.matrixWorld),r=s.clone();r.project(e),ZH.set(r.x,r.y),t.setFromCamera(ZH,e);const a=t.intersectObjects(n,!0);if(a.length){const o=a[0].distance;return s.distanceTo(t.ray.origin)<o}return!0}function LSe(i,e){if(e instanceof Dr)return e.zoom;if(e instanceof Ci){const t=hT.setFromMatrixPosition(i.matrixWorld),n=wO.setFromMatrixPosition(e.matrixWorld),s=e.fov*Math.PI/180,r=t.distanceTo(n);return 1/(2*Math.tan(s/2)*r)}else return 1}function USe(i,e,t){if(e instanceof Ci||e instanceof Dr){const n=hT.setFromMatrixPosition(i.matrixWorld),s=wO.setFromMatrixPosition(e.matrixWorld),r=n.distanceTo(s),a=(t[1]-t[0])/(e.far-e.near),o=t[1]-a*e.far;return Math.round(a*r+o)}}const P3=i=>Math.abs(i)<1e-10?0:i;function SJ(i,e,t=""){let n="matrix3d(";for(let s=0;s!==16;s++)n+=P3(e[s]*i.elements[s])+(s!==15?",":")");return t+n}const ISe=(i=>e=>SJ(e,i))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),PSe=(i=>(e,t)=>SJ(e,i(t),"translate(-50%,-50%)"))(i=>[1/i,1/i,1/i,1,-1/i,-1/i,-1/i,-1,1/i,1/i,1/i,1,1,1,1,1]);function OSe(i){return i&&typeof i=="object"&&"current"in i}const TJ=$.forwardRef(({children:i,eps:e=.001,style:t,className:n,prepend:s,center:r,fullscreen:a,portal:o,distanceFactor:l,sprite:c=!1,transform:u=!1,occlude:h,onOcclude:f,castShadow:m,receiveShadow:g,material:x,geometry:v,zIndexRange:y=[16777271,0],calculatePosition:b=NSe,as:S="div",wrapperClass:T,pointerEvents:M="auto",...C},w)=>{const{gl:N,camera:E,scene:B,size:U,raycaster:H,events:F,viewport:V}=ts(),[Y]=$.useState(()=>document.createElement(S)),P=$.useRef(null),X=$.useRef(null),J=$.useRef(0),re=$.useRef([0,0]),ne=$.useRef(null),ge=$.useRef(null),Te=(o==null?void 0:o.current)||F.connected||N.domElement.parentNode,Be=$.useRef(null),et=$.useRef(!1),wt=$.useMemo(()=>h&&h!=="blending"||Array.isArray(h)&&h.length&&OSe(h[0]),[h]);$.useLayoutEffect(()=>{const ht=N.domElement;h&&h==="blending"?(ht.style.zIndex=`${Math.floor(y[0]/2)}`,ht.style.position="absolute",ht.style.pointerEvents="none"):(ht.style.zIndex=null,ht.style.position=null,ht.style.pointerEvents=null)},[h]),$.useLayoutEffect(()=>{if(X.current){const ht=P.current=l9.createRoot(Y);if(B.updateMatrixWorld(),u)Y.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const Ke=b(X.current,E,U);Y.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${Ke[0]}px,${Ke[1]}px,0);transform-origin:0 0;`}return Te&&(s?Te.prepend(Y):Te.appendChild(Y)),()=>{Te&&Te.removeChild(Y),ht.unmount()}}},[Te,u]),$.useLayoutEffect(()=>{T&&(Y.className=T)},[T]);const be=$.useMemo(()=>u?{position:"absolute",top:0,left:0,width:U.width,height:U.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:r?"translate3d(-50%,-50%,0)":"none",...a&&{top:-U.height/2,left:-U.width/2,width:U.width,height:U.height},...t},[t,r,a,U,u]),Re=$.useMemo(()=>({position:"absolute",pointerEvents:M}),[M]);$.useLayoutEffect(()=>{if(et.current=!1,u){var ht;(ht=P.current)==null||ht.render($.createElement("div",{ref:ne,style:be},$.createElement("div",{ref:ge,style:Re},$.createElement("div",{ref:w,className:n,style:t,children:i}))))}else{var Ke;(Ke=P.current)==null||Ke.render($.createElement("div",{ref:w,style:be,className:n,children:i}))}});const tt=$.useRef(!0);yu(ht=>{if(X.current){E.updateMatrixWorld(),X.current.updateWorldMatrix(!0,!1);const Ke=u?re.current:b(X.current,E,U);if(u||Math.abs(J.current-E.zoom)>e||Math.abs(re.current[0]-Ke[0])>e||Math.abs(re.current[1]-Ke[1])>e){const jt=BSe(X.current,E);let Mt=!1;wt&&(Array.isArray(h)?Mt=h.map(at=>at.current):h!=="blending"&&(Mt=[B]));const Ie=tt.current;if(Mt){const at=DSe(X.current,E,H,Mt);tt.current=at&&!jt}else tt.current=!jt;Ie!==tt.current&&(f?f(!tt.current):Y.style.display=tt.current?"block":"none");const ke=Math.floor(y[0]/2),Ve=h?wt?[y[0],ke]:[ke-1,0]:y;if(Y.style.zIndex=`${USe(X.current,E,Ve)}`,u){const[at,Z]=[U.width/2,U.height/2],zt=E.projectionMatrix.elements[5]*Z,{isOrthographicCamera:st,top:Vt,left:Je,bottom:K,right:I}=E,ue=ISe(E.matrixWorldInverse),Ne=st?`scale(${zt})translate(${P3(-(I+Je)/2)}px,${P3((Vt+K)/2)}px)`:`translateZ(${zt}px)`;let ze=X.current.matrixWorld;c&&(ze=E.matrixWorldInverse.clone().transpose().copyPosition(ze).scale(X.current.scale),ze.elements[3]=ze.elements[7]=ze.elements[11]=0,ze.elements[15]=1),Y.style.width=U.width+"px",Y.style.height=U.height+"px",Y.style.perspective=st?"":`${zt}px`,ne.current&&ge.current&&(ne.current.style.transform=`${Ne}${ue}translate(${at}px,${Z}px)`,ge.current.style.transform=PSe(ze,1/((l||10)/400)))}else{const at=l===void 0?1:LSe(X.current,E)*l;Y.style.transform=`translate3d(${Ke[0]}px,${Ke[1]}px,0) scale(${at})`}re.current=Ke,J.current=E.zoom}}if(!wt&&Be.current&&!et.current)if(u){if(ne.current){const Ke=ne.current.children[0];if(Ke!=null&&Ke.clientWidth&&Ke!=null&&Ke.clientHeight){const{isOrthographicCamera:jt}=E;if(jt||v)C.scale&&(Array.isArray(C.scale)?C.scale instanceof z?Be.current.scale.copy(C.scale.clone().divideScalar(1)):Be.current.scale.set(1/C.scale[0],1/C.scale[1],1/C.scale[2]):Be.current.scale.setScalar(1/C.scale));else{const Mt=(l||10)/400,Ie=Ke.clientWidth*Mt,ke=Ke.clientHeight*Mt;Be.current.scale.set(Ie,ke,1)}et.current=!0}}}else{const Ke=Y.children[0];if(Ke!=null&&Ke.clientWidth&&Ke!=null&&Ke.clientHeight){const jt=1/V.factor,Mt=Ke.clientWidth*jt,Ie=Ke.clientHeight*jt;Be.current.scale.set(Mt,Ie,1),et.current=!0}Be.current.lookAt(ht.camera.position)}});const Bt=$.useMemo(()=>({vertexShader:u?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[u]);return $.createElement("group",Xb({},C,{ref:X}),h&&!wt&&$.createElement("mesh",{castShadow:m,receiveShadow:g,ref:Be},v||$.createElement("planeGeometry",null),x||$.createElement("shaderMaterial",{side:Ps,vertexShader:Bt.vertexShader,fragmentShader:Bt.fragmentShader})))}),FSe=i=>i;function GSe(i,e=FSe){const t=Ld.useSyncExternalStore(i.subscribe,Ld.useCallback(()=>e(i.getState()),[i,e]),Ld.useCallback(()=>e(i.getInitialState()),[i,e]));return Ld.useDebugValue(t),t}const JH=i=>{const e=VK(i),t=n=>GSe(e,n);return Object.assign(t,e),t},zSe=i=>i?JH(i):JH;let tv=0;const VSe=zSe(i=>(lm.onStart=(e,t,n)=>{i({active:!0,item:e,loaded:t,total:n,progress:(t-tv)/(n-tv)*100})},lm.onLoad=()=>{i({active:!1})},lm.onError=e=>i(t=>({errors:[...t.errors,e]})),lm.onProgress=(e,t,n)=>{t===n&&(tv=n),i({active:!0,item:e,loaded:t,total:n,progress:(t-tv)/(n-tv)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),AJ=parseInt(bu.replace(/\D+/g,""));function QH(i,e){if(e===QL)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),i;if(e===vb||e===XE){let t=i.getIndex();if(t===null){const a=[],o=i.getAttribute("position");if(o!==void 0){for(let l=0;l<o.count;l++)a.push(l);i.setIndex(a),t=i.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const n=t.count-2,s=[];if(t)if(e===vb)for(let a=1;a<=n;a++)s.push(t.getX(0)),s.push(t.getX(a)),s.push(t.getX(a+1));else for(let a=0;a<n;a++)a%2===0?(s.push(t.getX(a)),s.push(t.getX(a+1)),s.push(t.getX(a+2))):(s.push(t.getX(a+2)),s.push(t.getX(a+1)),s.push(t.getX(a)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=i.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),i}var Nl=Uint8Array,qd=Uint16Array,O3=Uint32Array,MJ=new Nl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),EJ=new Nl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),HSe=new Nl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),CJ=function(i,e){for(var t=new qd(31),n=0;n<31;++n)t[n]=e+=1<<i[n-1];for(var s=new O3(t[30]),n=1;n<30;++n)for(var r=t[n];r<t[n+1];++r)s[r]=r-t[n]<<5|n;return[t,s]},wJ=CJ(MJ,2),RJ=wJ[0],kSe=wJ[1];RJ[28]=258,kSe[258]=28;var WSe=CJ(EJ,0),XSe=WSe[0],F3=new qd(32768);for(var Yi=0;Yi<32768;++Yi){var xd=(Yi&43690)>>>1|(Yi&21845)<<1;xd=(xd&52428)>>>2|(xd&13107)<<2,xd=(xd&61680)>>>4|(xd&3855)<<4,F3[Yi]=((xd&65280)>>>8|(xd&255)<<8)>>>1}var tb=function(i,e,t){for(var n=i.length,s=0,r=new qd(e);s<n;++s)++r[i[s]-1];var a=new qd(e);for(s=0;s<e;++s)a[s]=a[s-1]+r[s-1]<<1;var o;if(t){o=new qd(1<<e);var l=15-e;for(s=0;s<n;++s)if(i[s])for(var c=s<<4|i[s],u=e-i[s],h=a[i[s]-1]++<<u,f=h|(1<<u)-1;h<=f;++h)o[F3[h]>>>l]=c}else for(o=new qd(n),s=0;s<n;++s)i[s]&&(o[s]=F3[a[i[s]-1]++]>>>15-i[s]);return o},dT=new Nl(288);for(var Yi=0;Yi<144;++Yi)dT[Yi]=8;for(var Yi=144;Yi<256;++Yi)dT[Yi]=9;for(var Yi=256;Yi<280;++Yi)dT[Yi]=7;for(var Yi=280;Yi<288;++Yi)dT[Yi]=8;var NJ=new Nl(32);for(var Yi=0;Yi<32;++Yi)NJ[Yi]=5;var qSe=tb(dT,9,1),jSe=tb(NJ,5,1),uB=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},lc=function(i,e,t){var n=e/8|0;return(i[n]|i[n+1]<<8)>>(e&7)&t},hB=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(e&7)},YSe=function(i){return(i/8|0)+(i&7&&1)},KSe=function(i,e,t){(t==null||t>i.length)&&(t=i.length);var n=new(i instanceof qd?qd:i instanceof O3?O3:Nl)(t-e);return n.set(i.subarray(e,t)),n},ZSe=function(i,e,t){var n=i.length;if(!n||t&&!t.l&&n<5)return e||new Nl(0);var s=!e||t,r=!t||t.i;t||(t={}),e||(e=new Nl(n*3));var a=function(be){var Re=e.length;if(be>Re){var tt=new Nl(Math.max(Re*2,be));tt.set(e),e=tt}},o=t.f||0,l=t.p||0,c=t.b||0,u=t.l,h=t.d,f=t.m,m=t.n,g=n*8;do{if(!u){t.f=o=lc(i,l,1);var x=lc(i,l+1,3);if(l+=3,x)if(x==1)u=qSe,h=jSe,f=9,m=5;else if(x==2){var S=lc(i,l,31)+257,T=lc(i,l+10,15)+4,M=S+lc(i,l+5,31)+1;l+=14;for(var C=new Nl(M),w=new Nl(19),N=0;N<T;++N)w[HSe[N]]=lc(i,l+N*3,7);l+=T*3;for(var E=uB(w),B=(1<<E)-1,U=tb(w,E,1),N=0;N<M;){var H=U[lc(i,l,B)];l+=H&15;var v=H>>>4;if(v<16)C[N++]=v;else{var F=0,V=0;for(v==16?(V=3+lc(i,l,3),l+=2,F=C[N-1]):v==17?(V=3+lc(i,l,7),l+=3):v==18&&(V=11+lc(i,l,127),l+=7);V--;)C[N++]=F}}var Y=C.subarray(0,S),P=C.subarray(S);f=uB(Y),m=uB(P),u=tb(Y,f,1),h=tb(P,m,1)}else throw"invalid block type";else{var v=YSe(l)+4,y=i[v-4]|i[v-3]<<8,b=v+y;if(b>n){if(r)throw"unexpected EOF";break}s&&a(c+y),e.set(i.subarray(v,b),c),t.b=c+=y,t.p=l=b*8;continue}if(l>g){if(r)throw"unexpected EOF";break}}s&&a(c+131072);for(var X=(1<<f)-1,J=(1<<m)-1,re=l;;re=l){var F=u[hB(i,l)&X],ne=F>>>4;if(l+=F&15,l>g){if(r)throw"unexpected EOF";break}if(!F)throw"invalid length/literal";if(ne<256)e[c++]=ne;else if(ne==256){re=l,u=null;break}else{var ge=ne-254;if(ne>264){var N=ne-257,Te=MJ[N];ge=lc(i,l,(1<<Te)-1)+RJ[N],l+=Te}var Be=h[hB(i,l)&J],et=Be>>>4;if(!Be)throw"invalid distance";l+=Be&15;var P=XSe[et];if(et>3){var Te=EJ[et];P+=hB(i,l)&(1<<Te)-1,l+=Te}if(l>g){if(r)throw"unexpected EOF";break}s&&a(c+131072);for(var wt=c+ge;c<wt;c+=4)e[c]=e[c-P],e[c+1]=e[c+1-P],e[c+2]=e[c+2-P],e[c+3]=e[c+3-P];c=wt}}t.l=u,t.p=re,t.b=c,u&&(o=1,t.m=f,t.d=h,t.n=m)}while(!o);return c==e.length?e:KSe(e,0,c)},JSe=new Nl(0),QSe=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function bA(i,e){return ZSe((QSe(i),i.subarray(2,-4)),e)}var $Se=typeof TextDecoder<"u"&&new TextDecoder,eTe=0;try{$Se.decode(JSe,{stream:!0}),eTe=1}catch{}var tTe=Object.defineProperty,nTe=(i,e,t)=>e in i?tTe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,iTe=(i,e,t)=>(nTe(i,e+"",t),t);class sTe{constructor(){iTe(this,"_listeners")}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const s=n.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,e);e.target=null}}}var rTe=Object.defineProperty,aTe=(i,e,t)=>e in i?rTe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,hn=(i,e,t)=>(aTe(i,typeof e!="symbol"?e+"":e,t),t);const SA=new Zf,$H=new El,oTe=Math.cos(70*(Math.PI/180)),ek=(i,e)=>(i%e+e)%e;let lTe=class extends sTe{constructor(e,t){super(),hn(this,"object"),hn(this,"domElement"),hn(this,"enabled",!0),hn(this,"target",new z),hn(this,"minDistance",0),hn(this,"maxDistance",1/0),hn(this,"minZoom",0),hn(this,"maxZoom",1/0),hn(this,"minPolarAngle",0),hn(this,"maxPolarAngle",Math.PI),hn(this,"minAzimuthAngle",-1/0),hn(this,"maxAzimuthAngle",1/0),hn(this,"enableDamping",!1),hn(this,"dampingFactor",.05),hn(this,"enableZoom",!0),hn(this,"zoomSpeed",1),hn(this,"enableRotate",!0),hn(this,"rotateSpeed",1),hn(this,"enablePan",!0),hn(this,"panSpeed",1),hn(this,"screenSpacePanning",!0),hn(this,"keyPanSpeed",7),hn(this,"zoomToCursor",!1),hn(this,"autoRotate",!1),hn(this,"autoRotateSpeed",2),hn(this,"reverseOrbit",!1),hn(this,"reverseHorizontalOrbit",!1),hn(this,"reverseVerticalOrbit",!1),hn(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),hn(this,"mouseButtons",{LEFT:Td.ROTATE,MIDDLE:Td.DOLLY,RIGHT:Td.PAN}),hn(this,"touches",{ONE:Ad.ROTATE,TWO:Ad.DOLLY_PAN}),hn(this,"target0"),hn(this,"position0"),hn(this,"zoom0"),hn(this,"_domElementKeyEvents",null),hn(this,"getPolarAngle"),hn(this,"getAzimuthalAngle"),hn(this,"setPolarAngle"),hn(this,"setAzimuthalAngle"),hn(this,"getDistance"),hn(this,"getZoomScale"),hn(this,"listenToKeyEvents"),hn(this,"stopListenToKeyEvents"),hn(this,"saveState"),hn(this,"reset"),hn(this,"update"),hn(this,"connect"),hn(this,"dispose"),hn(this,"dollyIn"),hn(this,"dollyOut"),hn(this,"getScale"),hn(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=ee=>{let me=ek(ee,2*Math.PI),Me=u.phi;Me<0&&(Me+=2*Math.PI),me<0&&(me+=2*Math.PI);let Q=Math.abs(me-Me);2*Math.PI-Q<Q&&(me<Me?me+=2*Math.PI:Me+=2*Math.PI),h.phi=me-Me,n.update()},this.setAzimuthalAngle=ee=>{let me=ek(ee,2*Math.PI),Me=u.theta;Me<0&&(Me+=2*Math.PI),me<0&&(me+=2*Math.PI);let Q=Math.abs(me-Me);2*Math.PI-Q<Q&&(me<Me?me+=2*Math.PI:Me+=2*Math.PI),h.theta=me-Me,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=ee=>{ee.addEventListener("keydown",we),this._domElementKeyEvents=ee},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",we),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(s),n.update(),l=o.NONE},this.update=(()=>{const ee=new z,me=new z(0,1,0),Me=new Fs().setFromUnitVectors(e.up,me),Q=Me.clone().invert(),pe=new z,He=new Fs,it=2*Math.PI;return function(){const We=n.object.position;Me.setFromUnitVectors(e.up,me),Q.copy(Me).invert(),ee.copy(We).sub(n.target),ee.applyQuaternion(Me),u.setFromVector3(ee),n.autoRotate&&l===o.NONE&&V(H()),n.enableDamping?(u.theta+=h.theta*n.dampingFactor,u.phi+=h.phi*n.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi);let lt=n.minAzimuthAngle,Dt=n.maxAzimuthAngle;isFinite(lt)&&isFinite(Dt)&&(lt<-Math.PI?lt+=it:lt>Math.PI&&(lt-=it),Dt<-Math.PI?Dt+=it:Dt>Math.PI&&(Dt-=it),lt<=Dt?u.theta=Math.max(lt,Math.min(Dt,u.theta)):u.theta=u.theta>(lt+Dt)/2?Math.max(lt,u.theta):Math.min(Dt,u.theta)),u.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,u.phi)),u.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(m,n.dampingFactor):n.target.add(m),n.zoomToCursor&&E||n.object.isOrthographicCamera?u.radius=Be(u.radius):u.radius=Be(u.radius*f),ee.setFromSpherical(u),ee.applyQuaternion(Q),We.copy(n.target).add(ee),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),n.enableDamping===!0?(h.theta*=1-n.dampingFactor,h.phi*=1-n.dampingFactor,m.multiplyScalar(1-n.dampingFactor)):(h.set(0,0,0),m.set(0,0,0));let mn=!1;if(n.zoomToCursor&&E){let xn=null;if(n.object instanceof Ci&&n.object.isPerspectiveCamera){const Oi=ee.length();xn=Be(Oi*f);const Vi=Oi-xn;n.object.position.addScaledVector(w,Vi),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const Oi=new z(N.x,N.y,0);Oi.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/f)),n.object.updateProjectionMatrix(),mn=!0;const Vi=new z(N.x,N.y,0);Vi.unproject(n.object),n.object.position.sub(Vi).add(Oi),n.object.updateMatrixWorld(),xn=ee.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;xn!==null&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(xn).add(n.object.position):(SA.origin.copy(n.object.position),SA.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(SA.direction))<oTe?e.lookAt(n.target):($H.setFromNormalAndCoplanarPoint(n.object.up,n.target),SA.intersectPlane($H,n.target))))}else n.object instanceof Dr&&n.object.isOrthographicCamera&&(mn=f!==1,mn&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/f)),n.object.updateProjectionMatrix()));return f=1,E=!1,mn||pe.distanceToSquared(n.object.position)>c||8*(1-He.dot(n.object.quaternion))>c?(n.dispatchEvent(s),pe.copy(n.object.position),He.copy(n.object.quaternion),mn=!1,!0):!1}})(),this.connect=ee=>{n.domElement=ee,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",Pt),n.domElement.addEventListener("pointerdown",Je),n.domElement.addEventListener("pointercancel",I),n.domElement.addEventListener("wheel",ze)},this.dispose=()=>{var ee,me,Me,Q,pe,He;n.domElement&&(n.domElement.style.touchAction="auto"),(ee=n.domElement)==null||ee.removeEventListener("contextmenu",Pt),(me=n.domElement)==null||me.removeEventListener("pointerdown",Je),(Me=n.domElement)==null||Me.removeEventListener("pointercancel",I),(Q=n.domElement)==null||Q.removeEventListener("wheel",ze),(pe=n.domElement)==null||pe.ownerDocument.removeEventListener("pointermove",K),(He=n.domElement)==null||He.ownerDocument.removeEventListener("pointerup",I),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",we)};const n=this,s={type:"change"},r={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=o.NONE;const c=1e-6,u=new Cb,h=new Cb;let f=1;const m=new z,g=new Ae,x=new Ae,v=new Ae,y=new Ae,b=new Ae,S=new Ae,T=new Ae,M=new Ae,C=new Ae,w=new z,N=new Ae;let E=!1;const B=[],U={};function H(){return 2*Math.PI/60/60*n.autoRotateSpeed}function F(){return Math.pow(.95,n.zoomSpeed)}function V(ee){n.reverseOrbit||n.reverseHorizontalOrbit?h.theta+=ee:h.theta-=ee}function Y(ee){n.reverseOrbit||n.reverseVerticalOrbit?h.phi+=ee:h.phi-=ee}const P=(()=>{const ee=new z;return function(Me,Q){ee.setFromMatrixColumn(Q,0),ee.multiplyScalar(-Me),m.add(ee)}})(),X=(()=>{const ee=new z;return function(Me,Q){n.screenSpacePanning===!0?ee.setFromMatrixColumn(Q,1):(ee.setFromMatrixColumn(Q,0),ee.crossVectors(n.object.up,ee)),ee.multiplyScalar(Me),m.add(ee)}})(),J=(()=>{const ee=new z;return function(Me,Q){const pe=n.domElement;if(pe&&n.object instanceof Ci&&n.object.isPerspectiveCamera){const He=n.object.position;ee.copy(He).sub(n.target);let it=ee.length();it*=Math.tan(n.object.fov/2*Math.PI/180),P(2*Me*it/pe.clientHeight,n.object.matrix),X(2*Q*it/pe.clientHeight,n.object.matrix)}else pe&&n.object instanceof Dr&&n.object.isOrthographicCamera?(P(Me*(n.object.right-n.object.left)/n.object.zoom/pe.clientWidth,n.object.matrix),X(Q*(n.object.top-n.object.bottom)/n.object.zoom/pe.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function re(ee){n.object instanceof Ci&&n.object.isPerspectiveCamera||n.object instanceof Dr&&n.object.isOrthographicCamera?f=ee:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ne(ee){re(f/ee)}function ge(ee){re(f*ee)}function Te(ee){if(!n.zoomToCursor||!n.domElement)return;E=!0;const me=n.domElement.getBoundingClientRect(),Me=ee.clientX-me.left,Q=ee.clientY-me.top,pe=me.width,He=me.height;N.x=Me/pe*2-1,N.y=-(Q/He)*2+1,w.set(N.x,N.y,1).unproject(n.object).sub(n.object.position).normalize()}function Be(ee){return Math.max(n.minDistance,Math.min(n.maxDistance,ee))}function et(ee){g.set(ee.clientX,ee.clientY)}function wt(ee){Te(ee),T.set(ee.clientX,ee.clientY)}function be(ee){y.set(ee.clientX,ee.clientY)}function Re(ee){x.set(ee.clientX,ee.clientY),v.subVectors(x,g).multiplyScalar(n.rotateSpeed);const me=n.domElement;me&&(V(2*Math.PI*v.x/me.clientHeight),Y(2*Math.PI*v.y/me.clientHeight)),g.copy(x),n.update()}function tt(ee){M.set(ee.clientX,ee.clientY),C.subVectors(M,T),C.y>0?ne(F()):C.y<0&&ge(F()),T.copy(M),n.update()}function Bt(ee){b.set(ee.clientX,ee.clientY),S.subVectors(b,y).multiplyScalar(n.panSpeed),J(S.x,S.y),y.copy(b),n.update()}function ht(ee){Te(ee),ee.deltaY<0?ge(F()):ee.deltaY>0&&ne(F()),n.update()}function Ke(ee){let me=!1;switch(ee.code){case n.keys.UP:J(0,n.keyPanSpeed),me=!0;break;case n.keys.BOTTOM:J(0,-n.keyPanSpeed),me=!0;break;case n.keys.LEFT:J(n.keyPanSpeed,0),me=!0;break;case n.keys.RIGHT:J(-n.keyPanSpeed,0),me=!0;break}me&&(ee.preventDefault(),n.update())}function jt(){if(B.length==1)g.set(B[0].pageX,B[0].pageY);else{const ee=.5*(B[0].pageX+B[1].pageX),me=.5*(B[0].pageY+B[1].pageY);g.set(ee,me)}}function Mt(){if(B.length==1)y.set(B[0].pageX,B[0].pageY);else{const ee=.5*(B[0].pageX+B[1].pageX),me=.5*(B[0].pageY+B[1].pageY);y.set(ee,me)}}function Ie(){const ee=B[0].pageX-B[1].pageX,me=B[0].pageY-B[1].pageY,Me=Math.sqrt(ee*ee+me*me);T.set(0,Me)}function ke(){n.enableZoom&&Ie(),n.enablePan&&Mt()}function Ve(){n.enableZoom&&Ie(),n.enableRotate&&jt()}function at(ee){if(B.length==1)x.set(ee.pageX,ee.pageY);else{const Me=Et(ee),Q=.5*(ee.pageX+Me.x),pe=.5*(ee.pageY+Me.y);x.set(Q,pe)}v.subVectors(x,g).multiplyScalar(n.rotateSpeed);const me=n.domElement;me&&(V(2*Math.PI*v.x/me.clientHeight),Y(2*Math.PI*v.y/me.clientHeight)),g.copy(x)}function Z(ee){if(B.length==1)b.set(ee.pageX,ee.pageY);else{const me=Et(ee),Me=.5*(ee.pageX+me.x),Q=.5*(ee.pageY+me.y);b.set(Me,Q)}S.subVectors(b,y).multiplyScalar(n.panSpeed),J(S.x,S.y),y.copy(b)}function zt(ee){const me=Et(ee),Me=ee.pageX-me.x,Q=ee.pageY-me.y,pe=Math.sqrt(Me*Me+Q*Q);M.set(0,pe),C.set(0,Math.pow(M.y/T.y,n.zoomSpeed)),ne(C.y),T.copy(M)}function st(ee){n.enableZoom&&zt(ee),n.enablePan&&Z(ee)}function Vt(ee){n.enableZoom&&zt(ee),n.enableRotate&&at(ee)}function Je(ee){var me,Me;n.enabled!==!1&&(B.length===0&&((me=n.domElement)==null||me.ownerDocument.addEventListener("pointermove",K),(Me=n.domElement)==null||Me.ownerDocument.addEventListener("pointerup",I)),Qt(ee),ee.pointerType==="touch"?Ut(ee):ue(ee))}function K(ee){n.enabled!==!1&&(ee.pointerType==="touch"?dt(ee):Ne(ee))}function I(ee){var me,Me,Q;Xe(ee),B.length===0&&((me=n.domElement)==null||me.releasePointerCapture(ee.pointerId),(Me=n.domElement)==null||Me.ownerDocument.removeEventListener("pointermove",K),(Q=n.domElement)==null||Q.ownerDocument.removeEventListener("pointerup",I)),n.dispatchEvent(a),l=o.NONE}function ue(ee){let me;switch(ee.button){case 0:me=n.mouseButtons.LEFT;break;case 1:me=n.mouseButtons.MIDDLE;break;case 2:me=n.mouseButtons.RIGHT;break;default:me=-1}switch(me){case Td.DOLLY:if(n.enableZoom===!1)return;wt(ee),l=o.DOLLY;break;case Td.ROTATE:if(ee.ctrlKey||ee.metaKey||ee.shiftKey){if(n.enablePan===!1)return;be(ee),l=o.PAN}else{if(n.enableRotate===!1)return;et(ee),l=o.ROTATE}break;case Td.PAN:if(ee.ctrlKey||ee.metaKey||ee.shiftKey){if(n.enableRotate===!1)return;et(ee),l=o.ROTATE}else{if(n.enablePan===!1)return;be(ee),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&n.dispatchEvent(r)}function Ne(ee){if(n.enabled!==!1)switch(l){case o.ROTATE:if(n.enableRotate===!1)return;Re(ee);break;case o.DOLLY:if(n.enableZoom===!1)return;tt(ee);break;case o.PAN:if(n.enablePan===!1)return;Bt(ee);break}}function ze(ee){n.enabled===!1||n.enableZoom===!1||l!==o.NONE&&l!==o.ROTATE||(ee.preventDefault(),n.dispatchEvent(r),ht(ee),n.dispatchEvent(a))}function we(ee){n.enabled===!1||n.enablePan===!1||Ke(ee)}function Ut(ee){switch(Qe(ee),B.length){case 1:switch(n.touches.ONE){case Ad.ROTATE:if(n.enableRotate===!1)return;jt(),l=o.TOUCH_ROTATE;break;case Ad.PAN:if(n.enablePan===!1)return;Mt(),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(n.touches.TWO){case Ad.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;ke(),l=o.TOUCH_DOLLY_PAN;break;case Ad.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Ve(),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&n.dispatchEvent(r)}function dt(ee){switch(Qe(ee),l){case o.TOUCH_ROTATE:if(n.enableRotate===!1)return;at(ee),n.update();break;case o.TOUCH_PAN:if(n.enablePan===!1)return;Z(ee),n.update();break;case o.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;st(ee),n.update();break;case o.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Vt(ee),n.update();break;default:l=o.NONE}}function Pt(ee){n.enabled!==!1&&ee.preventDefault()}function Qt(ee){B.push(ee)}function Xe(ee){delete U[ee.pointerId];for(let me=0;me<B.length;me++)if(B[me].pointerId==ee.pointerId){B.splice(me,1);return}}function Qe(ee){let me=U[ee.pointerId];me===void 0&&(me=new Ae,U[ee.pointerId]=me),me.set(ee.pageX,ee.pageY)}function Et(ee){const me=ee.pointerId===B[0].pointerId?B[1]:B[0];return U[me.pointerId]}this.dollyIn=(ee=F())=>{ge(ee),n.update()},this.dollyOut=(ee=F())=>{ne(ee),n.update()},this.getScale=()=>f,this.setScale=ee=>{re(ee),n.update()},this.getZoomScale=()=>F(),t!==void 0&&this.connect(t),this.update()}};function yE(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);let e="";for(let t=0,n=i.length;t<n;t++)e+=String.fromCharCode(i[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const gm="srgb",Sh="srgb-linear",tk=3001,cTe=3e3;class RO extends fr{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new pTe(t)}),this.register(function(t){return new mTe(t)}),this.register(function(t){return new ATe(t)}),this.register(function(t){return new MTe(t)}),this.register(function(t){return new ETe(t)}),this.register(function(t){return new yTe(t)}),this.register(function(t){return new xTe(t)}),this.register(function(t){return new _Te(t)}),this.register(function(t){return new vTe(t)}),this.register(function(t){return new fTe(t)}),this.register(function(t){return new bTe(t)}),this.register(function(t){return new gTe(t)}),this.register(function(t){return new TTe(t)}),this.register(function(t){return new STe(t)}),this.register(function(t){return new hTe(t)}),this.register(function(t){return new CTe(t)}),this.register(function(t){return new wTe(t)})}load(e,t,n,s){const r=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const c=xh.extractUrlBase(e);a=xh.resolveURL(c,this.path)}else a=xh.extractUrlBase(e);this.manager.itemStart(e);const o=function(c){s?s(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new cr(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,a,function(u){t(u),r.manager.itemEnd(e)},o)}catch(u){o(u)}},n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let r;const a={},o={};if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(yE(new Uint8Array(e.slice(0,4)))===BJ){try{a[Xn.KHR_BINARY_GLTF]=new RTe(e)}catch(u){s&&s(u);return}r=JSON.parse(a[Xn.KHR_BINARY_GLTF].content)}else r=JSON.parse(yE(new Uint8Array(e)));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new HTe(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const u=this.pluginCallbacks[c](l);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[u.name]=u,a[u.name]=!0}if(r.extensionsUsed)for(let c=0;c<r.extensionsUsed.length;++c){const u=r.extensionsUsed[c],h=r.extensionsRequired||[];switch(u){case Xn.KHR_MATERIALS_UNLIT:a[u]=new dTe;break;case Xn.KHR_DRACO_MESH_COMPRESSION:a[u]=new NTe(r,this.dracoLoader);break;case Xn.KHR_TEXTURE_TRANSFORM:a[u]=new BTe;break;case Xn.KHR_MESH_QUANTIZATION:a[u]=new DTe;break;default:h.indexOf(u)>=0&&o[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,r){n.parse(e,t,s,r)})}}function uTe(){let i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const Xn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class hTe{constructor(e){this.parser=e,this.name=Xn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const u=new Ye(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],Sh);const h=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new ng(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new JS(u),c.distance=h;break;case"spot":c=new Mg(u),c.distance=h,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,Ku(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),s=Promise.resolve(c),t.cache.add(n,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(l){return n._getNodeRef(t.cache,o,l)})}}class dTe{constructor(){this.name=Xn.KHR_MATERIALS_UNLIT}getMaterialType(){return Ts}extendParams(e,t,n){const s=[];e.color=new Ye(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const a=r.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],Sh),e.opacity=a[3]}r.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",r.baseColorTexture,gm))}return Promise.all(s)}}class fTe{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class pTe{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:yo}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Ae(o,o)}return Promise.all(r)}}class mTe{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:yo}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}}class gTe{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:yo}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(r)}}class yTe{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:yo}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new Ye(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=s.extensions[this.name];if(a.sheenColorFactor!==void 0){const o=a.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],Sh)}return a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&r.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture,gm)),a.sheenRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(r)}}class xTe{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:yo}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(r)}}class _Te{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:yo}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&r.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return t.attenuationColor=new Ye().setRGB(o[0],o[1],o[2],Sh),Promise.all(r)}}class vTe{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:yo}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class bTe{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:yo}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&r.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return t.specularColor=new Ye().setRGB(o[0],o[1],o[2],Sh),a.specularColorTexture!==void 0&&r.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture,gm)),Promise.all(r)}}class STe{constructor(e){this.parser=e,this.name=Xn.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:yo}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];return t.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&r.push(n.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(r)}}class TTe{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:yo}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],a=s.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&r.push(n.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(r)}}class ATe{constructor(e){this.parser=e,this.name=Xn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,a)}}class MTe{constructor(e){this.parser=e,this.name=Xn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const a=r.extensions[t],o=s.images[a.source];let l=n.textureLoader;if(o.uri){const c=n.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,a.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class ETe{constructor(e){this.parser=e,this.name=Xn.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const a=r.extensions[t],o=s.images[a.source];let l=n.textureLoader;if(o.uri){const c=n.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,a.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class CTe{constructor(e){this.name=Xn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(o){const l=s.byteOffset||0,c=s.byteLength||0,u=s.count,h=s.byteStride,f=new Uint8Array(o,l,c);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(u,h,f,s.mode,s.filter).then(function(m){return m.buffer}):a.ready.then(function(){const m=new ArrayBuffer(u*h);return a.decodeGltfBuffer(new Uint8Array(m),u,h,f,s.mode,s.filter),m})})}else return null}}class wTe{constructor(e){this.name=Xn.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const s=t.meshes[n.mesh];for(const c of s.primitives)if(c.mode!==_l.TRIANGLES&&c.mode!==_l.TRIANGLE_STRIP&&c.mode!==_l.TRIANGLE_FAN&&c.mode!==void 0)return null;const a=n.extensions[this.name].attributes,o=[],l={};for(const c in a)o.push(this.parser.getDependency("accessor",a[c]).then(u=>(l[c]=u,l[c])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(c=>{const u=c.pop(),h=u.isGroup?u.children:[u],f=c[0].count,m=[];for(const g of h){const x=new Lt,v=new z,y=new Fs,b=new z(1,1,1),S=new QE(g.geometry,g.material,f);for(let T=0;T<f;T++)l.TRANSLATION&&v.fromBufferAttribute(l.TRANSLATION,T),l.ROTATION&&y.fromBufferAttribute(l.ROTATION,T),l.SCALE&&b.fromBufferAttribute(l.SCALE,T),S.setMatrixAt(T,x.compose(v,y,b));for(const T in l)if(T==="_COLOR_0"){const M=l[T];S.instanceColor=new Yr(M.array,M.itemSize,M.normalized)}else T!=="TRANSLATION"&&T!=="ROTATION"&&T!=="SCALE"&&g.geometry.setAttribute(T,l[T]);Fn.prototype.copy.call(S,g),this.parser.assignFinalMaterial(S),m.push(S)}return u.isGroup?(u.clear(),u.add(...m),u):m[0]}))}}const BJ="glTF",nv=12,nk={JSON:1313821514,BIN:5130562};class RTe{constructor(e){this.name=Xn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,nv);if(this.header={magic:yE(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==BJ)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-nv,s=new DataView(e,nv);let r=0;for(;r<n;){const a=s.getUint32(r,!0);r+=4;const o=s.getUint32(r,!0);if(r+=4,o===nk.JSON){const l=new Uint8Array(e,nv+r,a);this.content=yE(l)}else if(o===nk.BIN){const l=nv+r;this.body=e.slice(l,l+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class NTe{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Xn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},l={},c={};for(const u in a){const h=G3[u]||u.toLowerCase();o[h]=a[u]}for(const u in e.attributes){const h=G3[u]||u.toLowerCase();if(a[u]!==void 0){const f=n.accessors[e.attributes[u]],m=By[f.componentType];c[h]=m.name,l[h]=f.normalized===!0}}return t.getDependency("bufferView",r).then(function(u){return new Promise(function(h,f){s.decodeDracoFile(u,function(m){for(const g in m.attributes){const x=m.attributes[g],v=l[g];v!==void 0&&(x.normalized=v)}h(m)},o,c,Sh,f)})})}}class BTe{constructor(){this.name=Xn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class DTe{constructor(){this.name=Xn.KHR_MESH_QUANTIZATION}}class DJ extends Ag{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let a=0;a!==s;a++)t[a]=n[r+a];return t}interpolate_(e,t,n,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=o*2,c=o*3,u=s-t,h=(n-t)/u,f=h*h,m=f*h,g=e*c,x=g-c,v=-2*m+3*f,y=m-f,b=1-v,S=y-f+h;for(let T=0;T!==o;T++){const M=a[x+T+o],C=a[x+T+l]*u,w=a[g+T+o],N=a[g+T]*u;r[T]=b*M+S*C+v*w+y*N}return r}}const LTe=new Fs;class UTe extends DJ{interpolate_(e,t,n,s){const r=super.interpolate_(e,t,n,s);return LTe.fromArray(r).normalize().toArray(r),r}}const _l={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},By={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ik={9728:$n,9729:Jt,9984:mg,9985:Qc,9986:Ho,9987:$s},sk={33071:ui,33648:vc,10497:Zr},dB={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},G3={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...AJ>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},_d={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ITe={CUBICSPLINE:void 0,LINEAR:Zm,STEP:Km},fB={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function PTe(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new Tg({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:jr})),i.DefaultMaterial}function Jp(i,e,t){for(const n in t.extensions)i[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Ku(i,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function OTe(i,e,t){let n=!1,s=!1,r=!1;for(let c=0,u=e.length;c<u;c++){const h=e[c];if(h.POSITION!==void 0&&(n=!0),h.NORMAL!==void 0&&(s=!0),h.COLOR_0!==void 0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(i);const a=[],o=[],l=[];for(let c=0,u=e.length;c<u;c++){const h=e[c];if(n){const f=h.POSITION!==void 0?t.getDependency("accessor",h.POSITION):i.attributes.position;a.push(f)}if(s){const f=h.NORMAL!==void 0?t.getDependency("accessor",h.NORMAL):i.attributes.normal;o.push(f)}if(r){const f=h.COLOR_0!==void 0?t.getDependency("accessor",h.COLOR_0):i.attributes.color;l.push(f)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(c){const u=c[0],h=c[1],f=c[2];return n&&(i.morphAttributes.position=u),s&&(i.morphAttributes.normal=h),r&&(i.morphAttributes.color=f),i.morphTargetsRelative=!0,i})}function FTe(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)i.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)i.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function GTe(i){let e;const t=i.extensions&&i.extensions[Xn.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+pB(t.attributes):e=i.indices+":"+pB(i.attributes)+":"+i.mode,i.targets!==void 0)for(let n=0,s=i.targets.length;n<s;n++)e+=":"+pB(i.targets[n]);return e}function pB(i){let e="";const t=Object.keys(i).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+i[t[n]]+";";return e}function z3(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function zTe(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const VTe=new Lt;class HTe{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new uTe,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,s=!1,r=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||s&&r<98?this.textureLoader=new $f(this.options.manager):this.textureLoader=new VU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new cr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const o={scene:a[0][s.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:s.asset,parser:n,userData:{}};return Jp(r,o,s),Ku(o,s),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){for(const l of o.scenes)l.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const a=t[s].joints;for(let o=0,l=a.length;o<l;o++)e[a[o]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const a=e[s];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),r=(a,o)=>{const l=this.associations.get(a);l!=null&&this.associations.set(o,l);for(const[c,u]of a.children.entries())r(u,o.children[c])};return r(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,a){return n.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Xn.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,a){n.load(xh.resolveURL(t.uri,s.path),r,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const a=dB[s.type],o=By[s.componentType],l=s.normalized===!0,c=new o(s.count*a);return Promise.resolve(new Nn(c,a,l))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(a){const o=a[0],l=dB[s.type],c=By[s.componentType],u=c.BYTES_PER_ELEMENT,h=u*l,f=s.byteOffset||0,m=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,g=s.normalized===!0;let x,v;if(m&&m!==h){const y=Math.floor(f/m),b="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+y+":"+s.count;let S=t.cache.get(b);S||(x=new c(o,y*m,s.count*m/u),S=new vg(x,m/u),t.cache.add(b,S)),v=new pu(S,l,f%m/u,g)}else o===null?x=new c(s.count*l):x=new c(o,f,s.count*l),v=new Nn(x,l,g);if(s.sparse!==void 0){const y=dB.SCALAR,b=By[s.sparse.indices.componentType],S=s.sparse.indices.byteOffset||0,T=s.sparse.values.byteOffset||0,M=new b(a[1],S,s.sparse.count*y),C=new c(a[2],T,s.sparse.count*l);o!==null&&(v=new Nn(v.array.slice(),v.itemSize,v.normalized));for(let w=0,N=M.length;w<N;w++){const E=M[w];if(v.setX(E,C[w*l]),l>=2&&v.setY(E,C[w*l+1]),l>=3&&v.setZ(E,C[w*l+2]),l>=4&&v.setW(E,C[w*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,a=t.images[r];let o=this.textureLoader;if(a.uri){const l=n.manager.getHandler(a.uri);l!==null&&(o=l)}return this.loadTextureImage(e,r,o)}loadTextureImage(e,t,n){const s=this,r=this.json,a=r.textures[e],o=r.images[t],l=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,n).then(function(u){u.flipY=!1,u.name=a.name||o.name||"",u.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(u.name=o.uri);const f=(r.samplers||{})[a.sampler]||{};return u.magFilter=ik[f.magFilter]||Jt,u.minFilter=ik[f.minFilter]||$s,u.wrapS=sk[f.wrapS]||Zr,u.wrapT=sk[f.wrapT]||Zr,s.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const n=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const a=s.images[e],o=self.URL||self.webkitURL;let l=a.uri||"",c=!1;if(a.bufferView!==void 0)l=n.getDependency("bufferView",a.bufferView).then(function(h){c=!0;const f=new Blob([h],{type:a.mimeType});return l=o.createObjectURL(f),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(h){return new Promise(function(f,m){let g=f;t.isImageBitmapLoader===!0&&(g=function(x){const v=new In(x);v.needsUpdate=!0,f(v)}),t.load(xh.resolveURL(h,r.path),g,void 0,m)})}).then(function(h){return c===!0&&o.revokeObjectURL(l),Ku(h,a),h.userData.mimeType=a.mimeType||zTe(a.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),h});return this.sourceCache[e]=u,u}assignTexture(e,t,n,s){const r=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(a=a.clone(),a.channel=n.texCoord),r.extensions[Xn.KHR_TEXTURE_TRANSFORM]){const o=n.extensions!==void 0?n.extensions[Xn.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const l=r.associations.get(a);a=r.extensions[Xn.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),r.associations.set(a,l)}}return s!==void 0&&(typeof s=="number"&&(s=s===tk?gm:Sh),"colorSpace"in a?a.colorSpace=s:a.encoding=s===gm?tk:cTe),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+n.uuid;let l=this.cache.get(o);l||(l=new Nx,Es.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(o,l)),n=l}else if(e.isLine){const o="LineBasicMaterial:"+n.uuid;let l=this.cache.get(o);l||(l=new Ir,Es.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,this.cache.add(o,l)),n=l}if(s||r||a){let o="ClonedMaterial:"+n.uuid+":";s&&(o+="derivative-tangents:"),r&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let l=this.cache.get(o);l||(l=n.clone(),r&&(l.vertexColors=!0),a&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(o,l),this.associations.set(l,this.associations.get(n))),n=l}e.material=n}getMaterialType(){return Tg}loadMaterial(e){const t=this,n=this.json,s=this.extensions,r=n.materials[e];let a;const o={},l=r.extensions||{},c=[];if(l[Xn.KHR_MATERIALS_UNLIT]){const h=s[Xn.KHR_MATERIALS_UNLIT];a=h.getMaterialType(),c.push(h.extendParams(o,r,t))}else{const h=r.pbrMetallicRoughness||{};if(o.color=new Ye(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){const f=h.baseColorFactor;o.color.setRGB(f[0],f[1],f[2],Sh),o.opacity=f[3]}h.baseColorTexture!==void 0&&c.push(t.assignTexture(o,"map",h.baseColorTexture,gm)),o.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,o.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),c.push(t.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture))),a=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,o)})))}r.doubleSided===!0&&(o.side=Ps);const u=r.alphaMode||fB.OPAQUE;if(u===fB.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,u===fB.MASK&&(o.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&a!==Ts&&(c.push(t.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new Ae(1,1),r.normalTexture.scale!==void 0)){const h=r.normalTexture.scale;o.normalScale.set(h,h)}if(r.occlusionTexture!==void 0&&a!==Ts&&(c.push(t.assignTexture(o,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&a!==Ts){const h=r.emissiveFactor;o.emissive=new Ye().setRGB(h[0],h[1],h[2],Sh)}return r.emissiveTexture!==void 0&&a!==Ts&&c.push(t.assignTexture(o,"emissiveMap",r.emissiveTexture,gm)),Promise.all(c).then(function(){const h=new a(o);return r.name&&(h.name=r.name),Ku(h,r),t.associations.set(h,{materials:e}),r.extensions&&Jp(s,h,r),h})}createUniqueName(e){const t=qn.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function r(o){return n[Xn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(l){return rk(l,o,t)})}const a=[];for(let o=0,l=e.length;o<l;o++){const c=e[o],u=GTe(c),h=s[u];if(h)a.push(h.promise);else{let f;c.extensions&&c.extensions[Xn.KHR_DRACO_MESH_COMPRESSION]?f=r(c):f=rk(new pn,c,t),s[u]={primitive:c,promise:f},a.push(f)}}return Promise.all(a)}loadMesh(e){const t=this,n=this.json,s=this.extensions,r=n.meshes[e],a=r.primitives,o=[];for(let l=0,c=a.length;l<c;l++){const u=a[l].material===void 0?PTe(this.cache):this.getDependency("material",a[l].material);o.push(u)}return o.push(t.loadGeometries(a)),Promise.all(o).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],h=[];for(let m=0,g=u.length;m<g;m++){const x=u[m],v=a[m];let y;const b=c[m];if(v.mode===_l.TRIANGLES||v.mode===_l.TRIANGLE_STRIP||v.mode===_l.TRIANGLE_FAN||v.mode===void 0)y=r.isSkinnedMesh===!0?new JE(x,b):new Kn(x,b),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),v.mode===_l.TRIANGLE_STRIP?y.geometry=QH(y.geometry,XE):v.mode===_l.TRIANGLE_FAN&&(y.geometry=QH(y.geometry,vb));else if(v.mode===_l.LINES)y=new Zl(x,b);else if(v.mode===_l.LINE_STRIP)y=new mu(x,b);else if(v.mode===_l.LINE_LOOP)y=new $E(x,b);else if(v.mode===_l.POINTS)y=new eC(x,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(y.geometry.morphAttributes).length>0&&FTe(y,r),y.name=t.createUniqueName(r.name||"mesh_"+e),Ku(y,r),v.extensions&&Jp(s,y,v),t.assignFinalMaterial(y),h.push(y)}for(let m=0,g=h.length;m<g;m++)t.associations.set(h[m],{meshes:e,primitives:m});if(h.length===1)return r.extensions&&Jp(s,h[0],r),h[0];const f=new ao;r.extensions&&Jp(s,f,r),t.associations.set(f,{meshes:e});for(let m=0,g=h.length;m<g;m++)f.add(h[m]);return f})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Ci(Fh.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new Dr(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Ku(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let s=0,r=t.joints.length;s<r;s++)n.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(s){const r=s.pop(),a=s,o=[],l=[];for(let c=0,u=a.length;c<u;c++){const h=a[c];if(h){o.push(h);const f=new Lt;r!==null&&f.fromArray(r.array,c*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new wx(o,l)})}loadAnimation(e){const t=this.json,n=this,s=t.animations[e],r=s.name?s.name:"animation_"+e,a=[],o=[],l=[],c=[],u=[];for(let h=0,f=s.channels.length;h<f;h++){const m=s.channels[h],g=s.samplers[m.sampler],x=m.target,v=x.node,y=s.parameters!==void 0?s.parameters[g.input]:g.input,b=s.parameters!==void 0?s.parameters[g.output]:g.output;x.node!==void 0&&(a.push(this.getDependency("node",v)),o.push(this.getDependency("accessor",y)),l.push(this.getDependency("accessor",b)),c.push(g),u.push(x))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(h){const f=h[0],m=h[1],g=h[2],x=h[3],v=h[4],y=[];for(let b=0,S=f.length;b<S;b++){const T=f[b],M=m[b],C=g[b],w=x[b],N=v[b];if(T===void 0)continue;T.updateMatrix&&T.updateMatrix();const E=n._createAnimationTracks(T,M,C,w,N);if(E)for(let B=0;B<E.length;B++)y.push(E[B])}return new tg(r,void 0,y)})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(r){const a=n._getNodeRef(n.meshCache,s.mesh,r);return s.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let l=0,c=s.weights.length;l<c;l++)o.morphTargetInfluences[l]=s.weights[l]}),a})}loadNode(e){const t=this.json,n=this,s=t.nodes[e],r=n._loadNodeShallow(e),a=[],o=s.children||[];for(let c=0,u=o.length;c<u;c++)a.push(n.getDependency("node",o[c]));const l=s.skin===void 0?Promise.resolve(null):n.getDependency("skin",s.skin);return Promise.all([r,Promise.all(a),l]).then(function(c){const u=c[0],h=c[1],f=c[2];f!==null&&u.traverse(function(m){m.isSkinnedMesh&&m.bind(f,VTe)});for(let m=0,g=h.length;m<g;m++)u.add(h[m]);return u})}_loadNodeShallow(e){const t=this.json,n=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],a=r.name?s.createUniqueName(r.name):"",o=[],l=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&o.push(l),r.camera!==void 0&&o.push(s.getDependency("camera",r.camera).then(function(c){return s._getNodeRef(s.cameraCache,r.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){o.push(c)}),this.nodeCache[e]=Promise.all(o).then(function(c){let u;if(r.isBone===!0?u=new LS:c.length>1?u=new ao:c.length===1?u=c[0]:u=new Fn,u!==c[0])for(let h=0,f=c.length;h<f;h++)u.add(c[h]);if(r.name&&(u.userData.name=r.name,u.name=a),Ku(u,r),r.extensions&&Jp(n,u,r),r.matrix!==void 0){const h=new Lt;h.fromArray(r.matrix),u.applyMatrix4(h)}else r.translation!==void 0&&u.position.fromArray(r.translation),r.rotation!==void 0&&u.quaternion.fromArray(r.rotation),r.scale!==void 0&&u.scale.fromArray(r.scale);return s.associations.has(u)||s.associations.set(u,{}),s.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],s=this,r=new ao;n.name&&(r.name=s.createUniqueName(n.name)),Ku(r,n),n.extensions&&Jp(t,r,n);const a=n.nodes||[],o=[];for(let l=0,c=a.length;l<c;l++)o.push(s.getDependency("node",a[l]));return Promise.all(o).then(function(l){for(let u=0,h=l.length;u<h;u++)r.add(l[u]);const c=u=>{const h=new Map;for(const[f,m]of s.associations)(f instanceof Es||f instanceof In)&&h.set(f,m);return u.traverse(f=>{const m=s.associations.get(f);m!=null&&h.set(f,m)}),h};return s.associations=c(r),r})}_createAnimationTracks(e,t,n,s,r){const a=[],o=e.name?e.name:e.uuid,l=[];_d[r.path]===_d.weights?e.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(o);let c;switch(_d[r.path]){case _d.weights:c=Gf;break;case _d.rotation:c=zf;break;case _d.position:case _d.scale:c=Vf;break;default:switch(n.itemSize){case 1:c=Gf;break;case 2:case 3:default:c=Vf;break}break}const u=s.interpolation!==void 0?ITe[s.interpolation]:Zm,h=this._getArrayFromAccessor(n);for(let f=0,m=l.length;f<m;f++){const g=new c(l[f]+"."+_d[r.path],t.array,h,u);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),a.push(g)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=z3(t.constructor),s=new Float32Array(t.length);for(let r=0,a=t.length;r<a;r++)s[r]=t[r]*n;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const s=this instanceof zf?UTe:DJ;return new s(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function kTe(i,e,t){const n=e.attributes,s=new Br;if(n.POSITION!==void 0){const o=t.json.accessors[n.POSITION],l=o.min,c=o.max;if(l!==void 0&&c!==void 0){if(s.set(new z(l[0],l[1],l[2]),new z(c[0],c[1],c[2])),o.normalized){const u=z3(By[o.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const o=new z,l=new z;for(let c=0,u=r.length;c<u;c++){const h=r[c];if(h.POSITION!==void 0){const f=t.json.accessors[h.POSITION],m=f.min,g=f.max;if(m!==void 0&&g!==void 0){if(l.setX(Math.max(Math.abs(m[0]),Math.abs(g[0]))),l.setY(Math.max(Math.abs(m[1]),Math.abs(g[1]))),l.setZ(Math.max(Math.abs(m[2]),Math.abs(g[2]))),f.normalized){const x=z3(By[f.componentType]);l.multiplyScalar(x)}o.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(o)}i.boundingBox=s;const a=new Gs;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,i.boundingSphere=a}function rk(i,e,t){const n=e.attributes,s=[];function r(a,o){return t.getDependency("accessor",a).then(function(l){i.setAttribute(o,l)})}for(const a in n){const o=G3[a]||a.toLowerCase();o in i.attributes||s.push(r(n[a],o))}if(e.indices!==void 0&&!i.index){const a=t.getDependency("accessor",e.indices).then(function(o){i.setIndex(o)});s.push(a)}return Ku(i,e),kTe(i,e,t),Promise.all(s).then(function(){return e.targets!==void 0?OTe(i,e.targets,t):i})}class WTe extends ZS{constructor(e){super(e),this.type=ln}parse(e){const a=function(N,E){switch(N){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(E||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(E||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(E||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(E||""))}},u=`
`,h=function(N,E,B){E=E||1024;let H=N.pos,F=-1,V=0,Y="",P=String.fromCharCode.apply(null,new Uint16Array(N.subarray(H,H+128)));for(;0>(F=P.indexOf(u))&&V<E&&H<N.byteLength;)Y+=P,V+=P.length,H+=128,P+=String.fromCharCode.apply(null,new Uint16Array(N.subarray(H,H+128)));return-1<F?(N.pos+=V+F+1,Y+P.slice(0,F)):!1},f=function(N){const E=/^#\?(\S+)/,B=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,U=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,H=/^\s*FORMAT=(\S+)\s*$/,F=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,V={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Y,P;for((N.pos>=N.byteLength||!(Y=h(N)))&&a(1,"no header found"),(P=Y.match(E))||a(3,"bad initial token"),V.valid|=1,V.programtype=P[1],V.string+=Y+`
`;Y=h(N),Y!==!1;){if(V.string+=Y+`
`,Y.charAt(0)==="#"){V.comments+=Y+`
`;continue}if((P=Y.match(B))&&(V.gamma=parseFloat(P[1])),(P=Y.match(U))&&(V.exposure=parseFloat(P[1])),(P=Y.match(H))&&(V.valid|=2,V.format=P[1]),(P=Y.match(F))&&(V.valid|=4,V.height=parseInt(P[1],10),V.width=parseInt(P[2],10)),V.valid&2&&V.valid&4)break}return V.valid&2||a(3,"missing format specifier"),V.valid&4||a(3,"missing image size specifier"),V},m=function(N,E,B){const U=E;if(U<8||U>32767||N[0]!==2||N[1]!==2||N[2]&128)return new Uint8Array(N);U!==(N[2]<<8|N[3])&&a(3,"wrong scanline width");const H=new Uint8Array(4*E*B);H.length||a(4,"unable to allocate buffer space");let F=0,V=0;const Y=4*U,P=new Uint8Array(4),X=new Uint8Array(Y);let J=B;for(;J>0&&V<N.byteLength;){V+4>N.byteLength&&a(1),P[0]=N[V++],P[1]=N[V++],P[2]=N[V++],P[3]=N[V++],(P[0]!=2||P[1]!=2||(P[2]<<8|P[3])!=U)&&a(3,"bad rgbe scanline format");let re=0,ne;for(;re<Y&&V<N.byteLength;){ne=N[V++];const Te=ne>128;if(Te&&(ne-=128),(ne===0||re+ne>Y)&&a(3,"bad scanline data"),Te){const Be=N[V++];for(let et=0;et<ne;et++)X[re++]=Be}else X.set(N.subarray(V,V+ne),re),re+=ne,V+=ne}const ge=U;for(let Te=0;Te<ge;Te++){let Be=0;H[F]=X[Te+Be],Be+=U,H[F+1]=X[Te+Be],Be+=U,H[F+2]=X[Te+Be],Be+=U,H[F+3]=X[Te+Be],F+=4}J--}return H},g=function(N,E,B,U){const H=N[E+3],F=Math.pow(2,H-128)/255;B[U+0]=N[E+0]*F,B[U+1]=N[E+1]*F,B[U+2]=N[E+2]*F,B[U+3]=1},x=function(N,E,B,U){const H=N[E+3],F=Math.pow(2,H-128)/255;B[U+0]=Ll.toHalfFloat(Math.min(N[E+0]*F,65504)),B[U+1]=Ll.toHalfFloat(Math.min(N[E+1]*F,65504)),B[U+2]=Ll.toHalfFloat(Math.min(N[E+2]*F,65504)),B[U+3]=Ll.toHalfFloat(1)},v=new Uint8Array(e);v.pos=0;const y=f(v),b=y.width,S=y.height,T=m(v.subarray(v.pos),b,S);let M,C,w;switch(this.type){case Rn:w=T.length/4;const N=new Float32Array(w*4);for(let B=0;B<w;B++)g(T,B*4,N,B*4);M=N,C=Rn;break;case ln:w=T.length/4;const E=new Uint16Array(w*4);for(let B=0;B<w;B++)x(T,B*4,E,B*4);M=E,C=ln;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:b,height:S,data:M,header:y.string,gamma:y.gamma,exposure:y.exposure,type:C}}setDataType(e){return this.type=e,this}load(e,t,n,s){function r(a,o){switch(a.type){case Rn:case ln:"colorSpace"in a?a.colorSpace="srgb-linear":a.encoding=3e3,a.minFilter=Jt,a.magFilter=Jt,a.generateMipmaps=!1,a.flipY=!0;break}t&&t(a,o)}return super.load(e,r,n,s)}}const iv=AJ>=152;class XTe extends ZS{constructor(e){super(e),this.type=ln}parse(e){const E=Math.pow(2.7182818,2.2);function B(O,j){for(var ce=0,Ee=0;Ee<65536;++Ee)(Ee==0||O[Ee>>3]&1<<(Ee&7))&&(j[ce++]=Ee);for(var Ge=ce-1;ce<65536;)j[ce++]=0;return Ge}function U(O){for(var j=0;j<16384;j++)O[j]={},O[j].len=0,O[j].lit=0,O[j].p=null}const H={l:0,c:0,lc:0};function F(O,j,ce,Ee,Ge){for(;ce<O;)j=j<<8|Et(Ee,Ge),ce+=8;ce-=O,H.l=j>>ce&(1<<O)-1,H.c=j,H.lc=ce}const V=new Array(59);function Y(O){for(var j=0;j<=58;++j)V[j]=0;for(var j=0;j<65537;++j)V[O[j]]+=1;for(var ce=0,j=58;j>0;--j){var Ee=ce+V[j]>>1;V[j]=ce,ce=Ee}for(var j=0;j<65537;++j){var Ge=O[j];Ge>0&&(O[j]=Ge|V[Ge]++<<6)}}function P(O,j,ce,Ee,Ge,Pe,yt){for(var ft=ce,pt=0,ct=0;Ge<=Pe;Ge++){if(ft.value-ce.value>Ee)return!1;F(6,pt,ct,O,ft);var Tt=H.l;if(pt=H.c,ct=H.lc,yt[Ge]=Tt,Tt==63){if(ft.value-ce.value>Ee)throw"Something wrong with hufUnpackEncTable";F(8,pt,ct,O,ft);var vt=H.l+6;if(pt=H.c,ct=H.lc,Ge+vt>Pe+1)throw"Something wrong with hufUnpackEncTable";for(;vt--;)yt[Ge++]=0;Ge--}else if(Tt>=59){var vt=Tt-59+2;if(Ge+vt>Pe+1)throw"Something wrong with hufUnpackEncTable";for(;vt--;)yt[Ge++]=0;Ge--}}Y(yt)}function X(O){return O&63}function J(O){return O>>6}function re(O,j,ce,Ee){for(;j<=ce;j++){var Ge=J(O[j]),Pe=X(O[j]);if(Ge>>Pe)throw"Invalid table entry";if(Pe>14){var yt=Ee[Ge>>Pe-14];if(yt.len)throw"Invalid table entry";if(yt.lit++,yt.p){var ft=yt.p;yt.p=new Array(yt.lit);for(var pt=0;pt<yt.lit-1;++pt)yt.p[pt]=ft[pt]}else yt.p=new Array(1);yt.p[yt.lit-1]=j}else if(Pe)for(var ct=0,pt=1<<14-Pe;pt>0;pt--){var yt=Ee[(Ge<<14-Pe)+ct];if(yt.len||yt.p)throw"Invalid table entry";yt.len=Pe,yt.lit=j,ct++}}return!0}const ne={c:0,lc:0};function ge(O,j,ce,Ee){O=O<<8|Et(ce,Ee),j+=8,ne.c=O,ne.lc=j}const Te={c:0,lc:0};function Be(O,j,ce,Ee,Ge,Pe,yt,ft,pt,ct){if(O==j){Ee<8&&(ge(ce,Ee,Ge,yt),ce=ne.c,Ee=ne.lc),Ee-=8;var Tt=ce>>Ee,Tt=new Uint8Array([Tt])[0];if(pt.value+Tt>ct)return!1;for(var vt=ft[pt.value-1];Tt-- >0;)ft[pt.value++]=vt}else if(pt.value<ct)ft[pt.value++]=O;else return!1;Te.c=ce,Te.lc=Ee}function et(O){return O&65535}function wt(O){var j=et(O);return j>32767?j-65536:j}const be={a:0,b:0};function Re(O,j){var ce=wt(O),Ee=wt(j),Ge=Ee,Pe=ce+(Ge&1)+(Ge>>1),yt=Pe,ft=Pe-Ge;be.a=yt,be.b=ft}function tt(O,j){var ce=et(O),Ee=et(j),Ge=ce-(Ee>>1)&65535,Pe=Ee+Ge-32768&65535;be.a=Pe,be.b=Ge}function Bt(O,j,ce,Ee,Ge,Pe,yt){for(var ft=yt<16384,pt=ce>Ge?Ge:ce,ct=1,Tt;ct<=pt;)ct<<=1;for(ct>>=1,Tt=ct,ct>>=1;ct>=1;){for(var vt=0,k=vt+Pe*(Ge-Tt),ie=Pe*ct,de=Pe*Tt,fe=Ee*ct,he=Ee*Tt,rt,mt,gt,Rt;vt<=k;vt+=de){for(var At=vt,$t=vt+Ee*(ce-Tt);At<=$t;At+=he){var Nt=At+fe,tn=At+ie,Cn=tn+fe;ft?(Re(O[At+j],O[tn+j]),rt=be.a,gt=be.b,Re(O[Nt+j],O[Cn+j]),mt=be.a,Rt=be.b,Re(rt,mt),O[At+j]=be.a,O[Nt+j]=be.b,Re(gt,Rt),O[tn+j]=be.a,O[Cn+j]=be.b):(tt(O[At+j],O[tn+j]),rt=be.a,gt=be.b,tt(O[Nt+j],O[Cn+j]),mt=be.a,Rt=be.b,tt(rt,mt),O[At+j]=be.a,O[Nt+j]=be.b,tt(gt,Rt),O[tn+j]=be.a,O[Cn+j]=be.b)}if(ce&ct){var tn=At+ie;ft?Re(O[At+j],O[tn+j]):tt(O[At+j],O[tn+j]),rt=be.a,O[tn+j]=be.b,O[At+j]=rt}}if(Ge&ct)for(var At=vt,$t=vt+Ee*(ce-Tt);At<=$t;At+=he){var Nt=At+fe;ft?Re(O[At+j],O[Nt+j]):tt(O[At+j],O[Nt+j]),rt=be.a,O[Nt+j]=be.b,O[At+j]=rt}Tt=ct,ct>>=1}return vt}function ht(O,j,ce,Ee,Ge,Pe,yt,ft,pt,ct){for(var Tt=0,vt=0,k=ft,ie=Math.trunc(Ge.value+(Pe+7)/8);Ge.value<ie;)for(ge(Tt,vt,ce,Ge),Tt=ne.c,vt=ne.lc;vt>=14;){var de=Tt>>vt-14&16383,fe=j[de];if(fe.len)vt-=fe.len,Be(fe.lit,yt,Tt,vt,ce,Ee,Ge,pt,ct,k),Tt=Te.c,vt=Te.lc;else{if(!fe.p)throw"hufDecode issues";var he;for(he=0;he<fe.lit;he++){for(var rt=X(O[fe.p[he]]);vt<rt&&Ge.value<ie;)ge(Tt,vt,ce,Ge),Tt=ne.c,vt=ne.lc;if(vt>=rt&&J(O[fe.p[he]])==(Tt>>vt-rt&(1<<rt)-1)){vt-=rt,Be(fe.p[he],yt,Tt,vt,ce,Ee,Ge,pt,ct,k),Tt=Te.c,vt=Te.lc;break}}if(he==fe.lit)throw"hufDecode issues"}}var mt=8-Pe&7;for(Tt>>=mt,vt-=mt;vt>0;){var fe=j[Tt<<14-vt&16383];if(fe.len)vt-=fe.len,Be(fe.lit,yt,Tt,vt,ce,Ee,Ge,pt,ct,k),Tt=Te.c,vt=Te.lc;else throw"hufDecode issues"}return!0}function Ke(O,j,ce,Ee,Ge,Pe){var yt={value:0},ft=ce.value,pt=Qe(j,ce),ct=Qe(j,ce);ce.value+=4;var Tt=Qe(j,ce);if(ce.value+=4,pt<0||pt>=65537||ct<0||ct>=65537)throw"Something wrong with HUF_ENCSIZE";var vt=new Array(65537),k=new Array(16384);U(k);var ie=Ee-(ce.value-ft);if(P(O,j,ce,ie,pt,ct,vt),Tt>8*(Ee-(ce.value-ft)))throw"Something wrong with hufUncompress";re(vt,pt,ct,k),ht(vt,k,O,j,ce,Tt,ct,Pe,Ge,yt)}function jt(O,j,ce){for(var Ee=0;Ee<ce;++Ee)j[Ee]=O[j[Ee]]}function Mt(O){for(var j=1;j<O.length;j++){var ce=O[j-1]+O[j]-128;O[j]=ce}}function Ie(O,j){for(var ce=0,Ee=Math.floor((O.length+1)/2),Ge=0,Pe=O.length-1;!(Ge>Pe||(j[Ge++]=O[ce++],Ge>Pe));)j[Ge++]=O[Ee++]}function ke(O){for(var j=O.byteLength,ce=new Array,Ee=0,Ge=new DataView(O);j>0;){var Pe=Ge.getInt8(Ee++);if(Pe<0){var yt=-Pe;j-=yt+1;for(var ft=0;ft<yt;ft++)ce.push(Ge.getUint8(Ee++))}else{var yt=Pe;j-=2;for(var pt=Ge.getUint8(Ee++),ft=0;ft<yt+1;ft++)ce.push(pt)}}return ce}function Ve(O,j,ce,Ee,Ge,Pe){var Nt=new DataView(Pe.buffer),yt=ce[O.idx[0]].width,ft=ce[O.idx[0]].height,pt=3,ct=Math.floor(yt/8),Tt=Math.ceil(yt/8),vt=Math.ceil(ft/8),k=yt-(Tt-1)*8,ie=ft-(vt-1)*8,de={value:0},fe=new Array(pt),he=new Array(pt),rt=new Array(pt),mt=new Array(pt),gt=new Array(pt);for(let nn=0;nn<pt;++nn)gt[nn]=j[O.idx[nn]],fe[nn]=nn<1?0:fe[nn-1]+Tt*vt,he[nn]=new Float32Array(64),rt[nn]=new Uint16Array(64),mt[nn]=new Uint16Array(Tt*64);for(let nn=0;nn<vt;++nn){var Rt=8;nn==vt-1&&(Rt=ie);var At=8;for(let rn=0;rn<Tt;++rn){rn==Tt-1&&(At=k);for(let Zt=0;Zt<pt;++Zt)rt[Zt].fill(0),rt[Zt][0]=Ge[fe[Zt]++],at(de,Ee,rt[Zt]),Z(rt[Zt],he[Zt]),zt(he[Zt]);st(he);for(let Zt=0;Zt<pt;++Zt)Vt(he[Zt],mt[Zt],rn*64)}let Ht=0;for(let rn=0;rn<pt;++rn){const Zt=ce[O.idx[rn]].type;for(let Ti=8*nn;Ti<8*nn+Rt;++Ti){Ht=gt[rn][Ti];for(let Pr=0;Pr<ct;++Pr){const xi=Pr*64+(Ti&7)*8;Nt.setUint16(Ht+0*2*Zt,mt[rn][xi+0],!0),Nt.setUint16(Ht+1*2*Zt,mt[rn][xi+1],!0),Nt.setUint16(Ht+2*2*Zt,mt[rn][xi+2],!0),Nt.setUint16(Ht+3*2*Zt,mt[rn][xi+3],!0),Nt.setUint16(Ht+4*2*Zt,mt[rn][xi+4],!0),Nt.setUint16(Ht+5*2*Zt,mt[rn][xi+5],!0),Nt.setUint16(Ht+6*2*Zt,mt[rn][xi+6],!0),Nt.setUint16(Ht+7*2*Zt,mt[rn][xi+7],!0),Ht+=8*2*Zt}}if(ct!=Tt)for(let Ti=8*nn;Ti<8*nn+Rt;++Ti){const Pr=gt[rn][Ti]+8*ct*2*Zt,xi=ct*64+(Ti&7)*8;for(let ia=0;ia<At;++ia)Nt.setUint16(Pr+ia*2*Zt,mt[rn][xi+ia],!0)}}}for(var $t=new Uint16Array(yt),Nt=new DataView(Pe.buffer),tn=0;tn<pt;++tn){ce[O.idx[tn]].decoded=!0;var Cn=ce[O.idx[tn]].type;if(ce[tn].type==2)for(var di=0;di<ft;++di){const nn=gt[tn][di];for(var Pn=0;Pn<yt;++Pn)$t[Pn]=Nt.getUint16(nn+Pn*2*Cn,!0);for(var Pn=0;Pn<yt;++Pn)Nt.setFloat32(nn+Pn*2*Cn,pe($t[Pn]),!0)}}}function at(O,j,ce){for(var Ee,Ge=1;Ge<64;)Ee=j[O.value],Ee==65280?Ge=64:Ee>>8==255?Ge+=Ee&255:(ce[Ge]=Ee,Ge++),O.value++}function Z(O,j){j[0]=pe(O[0]),j[1]=pe(O[1]),j[2]=pe(O[5]),j[3]=pe(O[6]),j[4]=pe(O[14]),j[5]=pe(O[15]),j[6]=pe(O[27]),j[7]=pe(O[28]),j[8]=pe(O[2]),j[9]=pe(O[4]),j[10]=pe(O[7]),j[11]=pe(O[13]),j[12]=pe(O[16]),j[13]=pe(O[26]),j[14]=pe(O[29]),j[15]=pe(O[42]),j[16]=pe(O[3]),j[17]=pe(O[8]),j[18]=pe(O[12]),j[19]=pe(O[17]),j[20]=pe(O[25]),j[21]=pe(O[30]),j[22]=pe(O[41]),j[23]=pe(O[43]),j[24]=pe(O[9]),j[25]=pe(O[11]),j[26]=pe(O[18]),j[27]=pe(O[24]),j[28]=pe(O[31]),j[29]=pe(O[40]),j[30]=pe(O[44]),j[31]=pe(O[53]),j[32]=pe(O[10]),j[33]=pe(O[19]),j[34]=pe(O[23]),j[35]=pe(O[32]),j[36]=pe(O[39]),j[37]=pe(O[45]),j[38]=pe(O[52]),j[39]=pe(O[54]),j[40]=pe(O[20]),j[41]=pe(O[22]),j[42]=pe(O[33]),j[43]=pe(O[38]),j[44]=pe(O[46]),j[45]=pe(O[51]),j[46]=pe(O[55]),j[47]=pe(O[60]),j[48]=pe(O[21]),j[49]=pe(O[34]),j[50]=pe(O[37]),j[51]=pe(O[47]),j[52]=pe(O[50]),j[53]=pe(O[56]),j[54]=pe(O[59]),j[55]=pe(O[61]),j[56]=pe(O[35]),j[57]=pe(O[36]),j[58]=pe(O[48]),j[59]=pe(O[49]),j[60]=pe(O[57]),j[61]=pe(O[58]),j[62]=pe(O[62]),j[63]=pe(O[63])}function zt(O){const j=.5*Math.cos(.7853975),ce=.5*Math.cos(3.14159/16),Ee=.5*Math.cos(3.14159/8),Ge=.5*Math.cos(3*3.14159/16),Pe=.5*Math.cos(5*3.14159/16),yt=.5*Math.cos(3*3.14159/8),ft=.5*Math.cos(7*3.14159/16);for(var pt=new Array(4),ct=new Array(4),Tt=new Array(4),vt=new Array(4),k=0;k<8;++k){var ie=k*8;pt[0]=Ee*O[ie+2],pt[1]=yt*O[ie+2],pt[2]=Ee*O[ie+6],pt[3]=yt*O[ie+6],ct[0]=ce*O[ie+1]+Ge*O[ie+3]+Pe*O[ie+5]+ft*O[ie+7],ct[1]=Ge*O[ie+1]-ft*O[ie+3]-ce*O[ie+5]-Pe*O[ie+7],ct[2]=Pe*O[ie+1]-ce*O[ie+3]+ft*O[ie+5]+Ge*O[ie+7],ct[3]=ft*O[ie+1]-Pe*O[ie+3]+Ge*O[ie+5]-ce*O[ie+7],Tt[0]=j*(O[ie+0]+O[ie+4]),Tt[3]=j*(O[ie+0]-O[ie+4]),Tt[1]=pt[0]+pt[3],Tt[2]=pt[1]-pt[2],vt[0]=Tt[0]+Tt[1],vt[1]=Tt[3]+Tt[2],vt[2]=Tt[3]-Tt[2],vt[3]=Tt[0]-Tt[1],O[ie+0]=vt[0]+ct[0],O[ie+1]=vt[1]+ct[1],O[ie+2]=vt[2]+ct[2],O[ie+3]=vt[3]+ct[3],O[ie+4]=vt[3]-ct[3],O[ie+5]=vt[2]-ct[2],O[ie+6]=vt[1]-ct[1],O[ie+7]=vt[0]-ct[0]}for(var de=0;de<8;++de)pt[0]=Ee*O[16+de],pt[1]=yt*O[16+de],pt[2]=Ee*O[48+de],pt[3]=yt*O[48+de],ct[0]=ce*O[8+de]+Ge*O[24+de]+Pe*O[40+de]+ft*O[56+de],ct[1]=Ge*O[8+de]-ft*O[24+de]-ce*O[40+de]-Pe*O[56+de],ct[2]=Pe*O[8+de]-ce*O[24+de]+ft*O[40+de]+Ge*O[56+de],ct[3]=ft*O[8+de]-Pe*O[24+de]+Ge*O[40+de]-ce*O[56+de],Tt[0]=j*(O[de]+O[32+de]),Tt[3]=j*(O[de]-O[32+de]),Tt[1]=pt[0]+pt[3],Tt[2]=pt[1]-pt[2],vt[0]=Tt[0]+Tt[1],vt[1]=Tt[3]+Tt[2],vt[2]=Tt[3]-Tt[2],vt[3]=Tt[0]-Tt[1],O[0+de]=vt[0]+ct[0],O[8+de]=vt[1]+ct[1],O[16+de]=vt[2]+ct[2],O[24+de]=vt[3]+ct[3],O[32+de]=vt[3]-ct[3],O[40+de]=vt[2]-ct[2],O[48+de]=vt[1]-ct[1],O[56+de]=vt[0]-ct[0]}function st(O){for(var j=0;j<64;++j){var ce=O[0][j],Ee=O[1][j],Ge=O[2][j];O[0][j]=ce+1.5747*Ge,O[1][j]=ce-.1873*Ee-.4682*Ge,O[2][j]=ce+1.8556*Ee}}function Vt(O,j,ce){for(var Ee=0;Ee<64;++Ee)j[ce+Ee]=Ll.toHalfFloat(Je(O[Ee]))}function Je(O){return O<=1?Math.sign(O)*Math.pow(Math.abs(O),2.2):Math.sign(O)*Math.pow(E,Math.abs(O)-1)}function K(O){return new DataView(O.array.buffer,O.offset.value,O.size)}function I(O){var j=O.viewer.buffer.slice(O.offset.value,O.offset.value+O.size),ce=new Uint8Array(ke(j)),Ee=new Uint8Array(ce.length);return Mt(ce),Ie(ce,Ee),new DataView(Ee.buffer)}function ue(O){var j=O.array.slice(O.offset.value,O.offset.value+O.size),ce=bA(j),Ee=new Uint8Array(ce.length);return Mt(ce),Ie(ce,Ee),new DataView(Ee.buffer)}function Ne(O){for(var j=O.viewer,ce={value:O.offset.value},Ee=new Uint16Array(O.width*O.scanlineBlockSize*(O.channels*O.type)),Ge=new Uint8Array(8192),Pe=0,yt=new Array(O.channels),ft=0;ft<O.channels;ft++)yt[ft]={},yt[ft].start=Pe,yt[ft].end=yt[ft].start,yt[ft].nx=O.width,yt[ft].ny=O.lines,yt[ft].size=O.type,Pe+=yt[ft].nx*yt[ft].ny*yt[ft].size;var pt=He(j,ce),ct=He(j,ce);if(ct>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(pt<=ct)for(var ft=0;ft<ct-pt+1;ft++)Ge[ft+pt]=ee(j,ce);var Tt=new Uint16Array(65536),vt=B(Ge,Tt),k=Qe(j,ce);Ke(O.array,j,ce,k,Ee,Pe);for(var ft=0;ft<O.channels;++ft)for(var ie=yt[ft],de=0;de<yt[ft].size;++de)Bt(Ee,ie.start+de,ie.nx,ie.size,ie.ny,ie.nx*ie.size,vt);jt(Tt,Ee,Pe);for(var fe=0,he=new Uint8Array(Ee.buffer.byteLength),rt=0;rt<O.lines;rt++)for(var mt=0;mt<O.channels;mt++){var ie=yt[mt],gt=ie.nx*ie.size,Rt=new Uint8Array(Ee.buffer,ie.end*2,gt*2);he.set(Rt,fe),fe+=gt*2,ie.end+=gt}return new DataView(he.buffer)}function ze(O){var j=O.array.slice(O.offset.value,O.offset.value+O.size),ce=bA(j);const Ee=O.lines*O.channels*O.width,Ge=O.type==1?new Uint16Array(Ee):new Uint32Array(Ee);let Pe=0,yt=0;const ft=new Array(4);for(let pt=0;pt<O.lines;pt++)for(let ct=0;ct<O.channels;ct++){let Tt=0;switch(O.type){case 1:ft[0]=Pe,ft[1]=ft[0]+O.width,Pe=ft[1]+O.width;for(let vt=0;vt<O.width;++vt){const k=ce[ft[0]++]<<8|ce[ft[1]++];Tt+=k,Ge[yt]=Tt,yt++}break;case 2:ft[0]=Pe,ft[1]=ft[0]+O.width,ft[2]=ft[1]+O.width,Pe=ft[2]+O.width;for(let vt=0;vt<O.width;++vt){const k=ce[ft[0]++]<<24|ce[ft[1]++]<<16|ce[ft[2]++]<<8;Tt+=k,Ge[yt]=Tt,yt++}break}}return new DataView(Ge.buffer)}function we(O){var j=O.viewer,ce={value:O.offset.value},Ee=new Uint8Array(O.width*O.lines*(O.channels*O.type*2)),Ge={version:me(j,ce),unknownUncompressedSize:me(j,ce),unknownCompressedSize:me(j,ce),acCompressedSize:me(j,ce),dcCompressedSize:me(j,ce),rleCompressedSize:me(j,ce),rleUncompressedSize:me(j,ce),rleRawSize:me(j,ce),totalAcUncompressedCount:me(j,ce),totalDcUncompressedCount:me(j,ce),acCompression:me(j,ce)};if(Ge.version<2)throw"EXRLoader.parse: "+ws.compression+" version "+Ge.version+" is unsupported";for(var Pe=new Array,yt=He(j,ce)-2;yt>0;){var ft=Ut(j.buffer,ce),pt=ee(j,ce),ct=pt>>2&3,Tt=(pt>>4)-1,vt=new Int8Array([Tt])[0],k=ee(j,ce);Pe.push({name:ft,index:vt,type:k,compression:ct}),yt-=ft.length+3}for(var ie=ws.channels,de=new Array(O.channels),fe=0;fe<O.channels;++fe){var he=de[fe]={},rt=ie[fe];he.name=rt.name,he.compression=0,he.decoded=!1,he.type=rt.pixelType,he.pLinear=rt.pLinear,he.width=O.width,he.height=O.lines}for(var mt={idx:new Array(3)},gt=0;gt<O.channels;++gt)for(var he=de[gt],fe=0;fe<Pe.length;++fe){var Rt=Pe[fe];he.name==Rt.name&&(he.compression=Rt.compression,Rt.index>=0&&(mt.idx[Rt.index]=gt),he.offset=gt)}if(Ge.acCompressedSize>0)switch(Ge.acCompression){case 0:var Nt=new Uint16Array(Ge.totalAcUncompressedCount);Ke(O.array,j,ce,Ge.acCompressedSize,Nt,Ge.totalAcUncompressedCount);break;case 1:var At=O.array.slice(ce.value,ce.value+Ge.totalAcUncompressedCount),$t=bA(At),Nt=new Uint16Array($t.buffer);ce.value+=Ge.totalAcUncompressedCount;break}if(Ge.dcCompressedSize>0){var tn={array:O.array,offset:ce,size:Ge.dcCompressedSize},Cn=new Uint16Array(ue(tn).buffer);ce.value+=Ge.dcCompressedSize}if(Ge.rleRawSize>0){var At=O.array.slice(ce.value,ce.value+Ge.rleCompressedSize),$t=bA(At),di=ke($t.buffer);ce.value+=Ge.rleCompressedSize}for(var Pn=0,nn=new Array(de.length),fe=0;fe<nn.length;++fe)nn[fe]=new Array;for(var Ht=0;Ht<O.lines;++Ht)for(var rn=0;rn<de.length;++rn)nn[rn].push(Pn),Pn+=de[rn].width*O.type*2;Ve(mt,nn,de,Nt,Cn,Ee);for(var fe=0;fe<de.length;++fe){var he=de[fe];if(!he.decoded)switch(he.compression){case 2:for(var Zt=0,Ti=0,Ht=0;Ht<O.lines;++Ht){for(var Pr=nn[fe][Zt],xi=0;xi<he.width;++xi){for(var ia=0;ia<2*he.type;++ia)Ee[Pr++]=di[Ti+ia*he.width*he.height];Ti++}Zt++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(Ee.buffer)}function Ut(O,j){for(var ce=new Uint8Array(O),Ee=0;ce[j.value+Ee]!=0;)Ee+=1;var Ge=new TextDecoder().decode(ce.slice(j.value,j.value+Ee));return j.value=j.value+Ee+1,Ge}function dt(O,j,ce){var Ee=new TextDecoder().decode(new Uint8Array(O).slice(j.value,j.value+ce));return j.value=j.value+ce,Ee}function Pt(O,j){var ce=Xe(O,j),Ee=Qe(O,j);return[ce,Ee]}function Qt(O,j){var ce=Qe(O,j),Ee=Qe(O,j);return[ce,Ee]}function Xe(O,j){var ce=O.getInt32(j.value,!0);return j.value=j.value+4,ce}function Qe(O,j){var ce=O.getUint32(j.value,!0);return j.value=j.value+4,ce}function Et(O,j){var ce=O[j.value];return j.value=j.value+1,ce}function ee(O,j){var ce=O.getUint8(j.value);return j.value=j.value+1,ce}const me=function(O,j){let ce;return"getBigInt64"in DataView.prototype?ce=Number(O.getBigInt64(j.value,!0)):ce=O.getUint32(j.value+4,!0)+Number(O.getUint32(j.value,!0)<<32),j.value+=8,ce};function Me(O,j){var ce=O.getFloat32(j.value,!0);return j.value+=4,ce}function Q(O,j){return Ll.toHalfFloat(Me(O,j))}function pe(O){var j=(O&31744)>>10,ce=O&1023;return(O>>15?-1:1)*(j?j===31?ce?NaN:1/0:Math.pow(2,j-15)*(1+ce/1024):6103515625e-14*(ce/1024))}function He(O,j){var ce=O.getUint16(j.value,!0);return j.value+=2,ce}function it(O,j){return pe(He(O,j))}function qe(O,j,ce,Ee){for(var Ge=ce.value,Pe=[];ce.value<Ge+Ee-1;){var yt=Ut(j,ce),ft=Xe(O,ce),pt=ee(O,ce);ce.value+=3;var ct=Xe(O,ce),Tt=Xe(O,ce);Pe.push({name:yt,pixelType:ft,pLinear:pt,xSampling:ct,ySampling:Tt})}return ce.value+=1,Pe}function We(O,j){var ce=Me(O,j),Ee=Me(O,j),Ge=Me(O,j),Pe=Me(O,j),yt=Me(O,j),ft=Me(O,j),pt=Me(O,j),ct=Me(O,j);return{redX:ce,redY:Ee,greenX:Ge,greenY:Pe,blueX:yt,blueY:ft,whiteX:pt,whiteY:ct}}function lt(O,j){var ce=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],Ee=ee(O,j);return ce[Ee]}function Dt(O,j){var ce=Qe(O,j),Ee=Qe(O,j),Ge=Qe(O,j),Pe=Qe(O,j);return{xMin:ce,yMin:Ee,xMax:Ge,yMax:Pe}}function mn(O,j){var ce=["INCREASING_Y"],Ee=ee(O,j);return ce[Ee]}function xn(O,j){var ce=Me(O,j),Ee=Me(O,j);return[ce,Ee]}function Oi(O,j){var ce=Me(O,j),Ee=Me(O,j),Ge=Me(O,j);return[ce,Ee,Ge]}function Vi(O,j,ce,Ee,Ge){if(Ee==="string"||Ee==="stringvector"||Ee==="iccProfile")return dt(j,ce,Ge);if(Ee==="chlist")return qe(O,j,ce,Ge);if(Ee==="chromaticities")return We(O,ce);if(Ee==="compression")return lt(O,ce);if(Ee==="box2i")return Dt(O,ce);if(Ee==="lineOrder")return mn(O,ce);if(Ee==="float")return Me(O,ce);if(Ee==="v2f")return xn(O,ce);if(Ee==="v3f")return Oi(O,ce);if(Ee==="int")return Xe(O,ce);if(Ee==="rational")return Pt(O,ce);if(Ee==="timecode")return Qt(O,ce);if(Ee==="preview")return ce.value+=Ge,"skipped";ce.value+=Ge}function ea(O,j,ce){const Ee={};if(O.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";Ee.version=O.getUint8(4);const Ge=O.getUint8(5);Ee.spec={singleTile:!!(Ge&2),longName:!!(Ge&4),deepFormat:!!(Ge&8),multiPart:!!(Ge&16)},ce.value=8;for(var Pe=!0;Pe;){var yt=Ut(j,ce);if(yt==0)Pe=!1;else{var ft=Ut(j,ce),pt=Qe(O,ce),ct=Vi(O,j,ce,ft,pt);ct===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${ft}'.`):Ee[yt]=ct}}if(Ge&-5)throw console.error("EXRHeader:",Ee),"THREE.EXRLoader: provided file is currently unsupported.";return Ee}function ta(O,j,ce,Ee,Ge){const Pe={size:0,viewer:j,array:ce,offset:Ee,width:O.dataWindow.xMax-O.dataWindow.xMin+1,height:O.dataWindow.yMax-O.dataWindow.yMin+1,channels:O.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:O.channels[0].pixelType,uncompress:null,getter:null,format:null,[iv?"colorSpace":"encoding"]:null};switch(O.compression){case"NO_COMPRESSION":Pe.lines=1,Pe.uncompress=K;break;case"RLE_COMPRESSION":Pe.lines=1,Pe.uncompress=I;break;case"ZIPS_COMPRESSION":Pe.lines=1,Pe.uncompress=ue;break;case"ZIP_COMPRESSION":Pe.lines=16,Pe.uncompress=ue;break;case"PIZ_COMPRESSION":Pe.lines=32,Pe.uncompress=Ne;break;case"PXR24_COMPRESSION":Pe.lines=16,Pe.uncompress=ze;break;case"DWAA_COMPRESSION":Pe.lines=32,Pe.uncompress=we;break;case"DWAB_COMPRESSION":Pe.lines=256,Pe.uncompress=we;break;default:throw"EXRLoader.parse: "+O.compression+" is unsupported"}if(Pe.scanlineBlockSize=Pe.lines,Pe.type==1)switch(Ge){case Rn:Pe.getter=it,Pe.inputSize=2;break;case ln:Pe.getter=He,Pe.inputSize=2;break}else if(Pe.type==2)switch(Ge){case Rn:Pe.getter=Me,Pe.inputSize=4;break;case ln:Pe.getter=Q,Pe.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+Pe.type+" for "+O.compression+".";Pe.blockCount=(O.dataWindow.yMax+1)/Pe.scanlineBlockSize;for(var yt=0;yt<Pe.blockCount;yt++)me(j,Ee);Pe.outputChannels=Pe.channels==3?4:Pe.channels;const ft=Pe.width*Pe.height*Pe.outputChannels;switch(Ge){case Rn:Pe.byteArray=new Float32Array(ft),Pe.channels<Pe.outputChannels&&Pe.byteArray.fill(1,0,ft);break;case ln:Pe.byteArray=new Uint16Array(ft),Pe.channels<Pe.outputChannels&&Pe.byteArray.fill(15360,0,ft);break;default:console.error("THREE.EXRLoader: unsupported type: ",Ge);break}return Pe.bytesPerLine=Pe.width*Pe.inputSize*Pe.channels,Pe.outputChannels==4?Pe.format=ii:Pe.format=ql,iv?Pe.colorSpace="srgb-linear":Pe.encoding=3e3,Pe}const Cs=new DataView(e),gr=new Uint8Array(e),Qi={value:0},ws=ea(Cs,e,Qi),sn=ta(ws,Cs,gr,Qi,this.type),na={value:0},Ri={R:0,G:1,B:2,A:3,Y:0};for(let O=0;O<sn.height/sn.scanlineBlockSize;O++){const j=Qe(Cs,Qi);sn.size=Qe(Cs,Qi),sn.lines=j+sn.scanlineBlockSize>sn.height?sn.height-j:sn.scanlineBlockSize;const Ee=sn.size<sn.lines*sn.bytesPerLine?sn.uncompress(sn):K(sn);Qi.value+=sn.size;for(let Ge=0;Ge<sn.scanlineBlockSize;Ge++){const Pe=Ge+O*sn.scanlineBlockSize;if(Pe>=sn.height)break;for(let yt=0;yt<sn.channels;yt++){const ft=Ri[ws.channels[yt].name];for(let pt=0;pt<sn.width;pt++){na.value=(Ge*(sn.channels*sn.width)+yt*sn.width+pt)*sn.inputSize;const ct=(sn.height-1-Pe)*(sn.width*sn.outputChannels)+pt*sn.outputChannels+ft;sn.byteArray[ct]=sn.getter(Ee,na)}}}}return{header:ws,width:sn.width,height:sn.height,data:sn.byteArray,format:sn.format,[iv?"colorSpace":"encoding"]:sn[iv?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,s){function r(a,o){iv?a.colorSpace=o.colorSpace:a.encoding=o.encoding,a.minFilter=Jt,a.magFilter=Jt,a.generateMipmaps=!1,a.flipY=!1,t&&t(a,o)}return super.load(e,r,n,s)}}const mB=new WeakMap;class qTe extends fr{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,s){const r=new cr(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,a=>{const o={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(a,o).then(t).catch(s)},n,s)}decodeDracoFile(e,t,n,s){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){for(const l in t.attributeTypes){const c=t.attributeTypes[l];c.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[l]=c.name)}const n=JSON.stringify(t);if(mB.has(e)){const l=mB.get(e);if(l.key===n)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const r=this.workerNextTaskID++,a=e.byteLength,o=this._getWorker(r,a).then(l=>(s=l,new Promise((c,u)=>{s._callbacks[r]={resolve:c,reject:u},s.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),mB.set(e,{key:n,promise:o}),o}_createGeometry(e){const t=new pn;e.index&&t.setIndex(new Nn(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const s=e.attributes[n],r=s.name,a=s.array,o=s.itemSize;t.setAttribute(r,new Nn(a,o))}return t}_loadLibrary(e,t){const n=new cr(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((s,r)=>{n.load(e,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const s=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const r=jTe.toString(),a=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){const a=r.data;switch(a.type){case"decode":s._callbacks[a.id].resolve(a);break;case"error":s._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function jTe(){let i,e;onmessage=function(a){const o=a.data;switch(o.type){case"init":i=o.decoderConfig,e=new Promise(function(u){i.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(i)});break;case"decode":const l=o.buffer,c=o.taskConfig;e.then(u=>{const h=u.draco,f=new h.Decoder,m=new h.DecoderBuffer;m.Init(new Int8Array(l),l.byteLength);try{const g=t(h,f,m,c),x=g.attributes.map(v=>v.array.buffer);g.index&&x.push(g.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:g},x)}catch(g){console.error(g),self.postMessage({type:"error",id:o.id,error:g.message})}finally{h.destroy(m),h.destroy(f)}});break}};function t(a,o,l,c){const u=c.attributeIDs,h=c.attributeTypes;let f,m;const g=o.GetEncodedGeometryType(l);if(g===a.TRIANGULAR_MESH)f=new a.Mesh,m=o.DecodeBufferToMesh(l,f);else if(g===a.POINT_CLOUD)f=new a.PointCloud,m=o.DecodeBufferToPointCloud(l,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!m.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+m.error_msg());const x={index:null,attributes:[]};for(const v in u){const y=self[h[v]];let b,S;if(c.useUniqueIDs)S=u[v],b=o.GetAttributeByUniqueId(f,S);else{if(S=o.GetAttributeId(f,a[u[v]]),S===-1)continue;b=o.GetAttribute(f,S)}x.attributes.push(s(a,o,f,v,y,b))}return g===a.TRIANGULAR_MESH&&(x.index=n(a,o,f)),a.destroy(f),x}function n(a,o,l){const u=l.num_faces()*3,h=u*4,f=a._malloc(h);o.GetTrianglesUInt32Array(l,h,f);const m=new Uint32Array(a.HEAPF32.buffer,f,u).slice();return a._free(f),{array:m,itemSize:1}}function s(a,o,l,c,u,h){const f=h.num_components(),g=l.num_points()*f,x=g*u.BYTES_PER_ELEMENT,v=r(a,u),y=a._malloc(x);o.GetAttributeDataArrayForAllPoints(l,h,v,x,y);const b=new u(a.HEAPF32.buffer,y,g).slice();return a._free(y),{name:c,array:b,itemSize:f}}function r(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}let TA;const gB=()=>{if(TA)return TA;const i="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let s=i;WebAssembly.validate(t)&&(s=e);let r;const a=WebAssembly.instantiate(o(s),{}).then(h=>{r=h.instance,r.exports.__wasm_call_ctors()});function o(h){const f=new Uint8Array(h.length);for(let g=0;g<h.length;++g){const x=h.charCodeAt(g);f[g]=x>96?x-71:x>64?x-65:x>47?x+4:x>46?63:62}let m=0;for(let g=0;g<h.length;++g)f[m++]=f[g]<60?n[f[g]]:(f[g]-60)*64+f[++g];return f.buffer.slice(0,m)}function l(h,f,m,g,x,v){const y=r.exports.sbrk,b=m+3&-4,S=y(b*g),T=y(x.length),M=new Uint8Array(r.exports.memory.buffer);M.set(x,T);const C=h(S,m,g,T,x.length);if(C===0&&v&&v(S,b,g),f.set(M.subarray(S,S+m*g)),y(S-y(0)),C!==0)throw new Error(`Malformed buffer data: ${C}`)}const c={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return TA={ready:a,supported:!0,decodeVertexBuffer(h,f,m,g,x){l(r.exports.meshopt_decodeVertexBuffer,h,f,m,g,r.exports[c[x]])},decodeIndexBuffer(h,f,m,g){l(r.exports.meshopt_decodeIndexBuffer,h,f,m,g)},decodeIndexSequence(h,f,m,g){l(r.exports.meshopt_decodeIndexSequence,h,f,m,g)},decodeGltfBuffer(h,f,m,g,x,v){l(r.exports[u[x]],h,f,m,g,r.exports[c[v]])}},TA},YTe=$.forwardRef(function({children:e,follow:t=!0,lockX:n=!1,lockY:s=!1,lockZ:r=!1,...a},o){const l=$.useRef(null),c=$.useRef(null),u=new Fs;return yu(({camera:h})=>{if(!t||!c.current)return;const f=l.current.rotation.clone();c.current.updateMatrix(),c.current.updateWorldMatrix(!1,!1),c.current.getWorldQuaternion(u),h.getWorldQuaternion(l.current.quaternion).premultiply(u.invert()),n&&(l.current.rotation.x=f.x),s&&(l.current.rotation.y=f.y),r&&(l.current.rotation.z=f.z)}),$.useImperativeHandle(o,()=>c.current,[]),$.createElement("group",Xb({ref:c},a),$.createElement("group",{ref:l},e))}),yB=i=>i===Object(i)&&!Array.isArray(i)&&typeof i!="function";function lx(i,e){const t=ts(r=>r.gl),n=Kl($f,yB(i)?Object.values(i):i);return $.useLayoutEffect(()=>{e==null||e(n)},[e]),$.useEffect(()=>{if("initTexture"in t){let r=[];Array.isArray(n)?r=n:n instanceof In?r=[n]:yB(n)&&(r=Object.values(n)),r.forEach(a=>{a instanceof In&&t.initTexture(a)})}},[t,n]),$.useMemo(()=>{if(yB(i)){const r={};let a=0;for(const o in i)r[o]=n[a++];return r}else return n},[i,n])}lx.preload=i=>Kl.preload($f,i);lx.clear=i=>Kl.clear($f,i);let AA=null,LJ="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function UJ(i=!0,e=!0,t){return n=>{t&&t(n),i&&(AA||(AA=new qTe),AA.setDecoderPath(typeof i=="string"?i:LJ),n.setDRACOLoader(AA)),e&&n.setMeshoptDecoder(typeof gB=="function"?gB():gB)}}const mr=(i,e,t,n)=>Kl(RO,i,UJ(e,t,n));mr.preload=(i,e,t,n)=>Kl.preload(RO,i,UJ(e,t,n));mr.clear=i=>Kl.clear(RO,i);mr.setDecoderPath=i=>{LJ=i};const KTe=$.forwardRef(({makeDefault:i,camera:e,regress:t,domElement:n,enableDamping:s=!0,keyEvents:r=!1,onChange:a,onStart:o,onEnd:l,...c},u)=>{const h=ts(C=>C.invalidate),f=ts(C=>C.camera),m=ts(C=>C.gl),g=ts(C=>C.events),x=ts(C=>C.setEvents),v=ts(C=>C.set),y=ts(C=>C.get),b=ts(C=>C.performance),S=e||f,T=n||g.connected||m.domElement,M=$.useMemo(()=>new lTe(S),[S]);return yu(()=>{M.enabled&&M.update()},-1),$.useEffect(()=>(r&&M.connect(r===!0?T:r),M.connect(T),()=>void M.dispose()),[r,T,t,M,h]),$.useEffect(()=>{const C=E=>{h(),t&&b.regress(),a&&a(E)},w=E=>{o&&o(E)},N=E=>{l&&l(E)};return M.addEventListener("change",C),M.addEventListener("start",w),M.addEventListener("end",N),()=>{M.removeEventListener("start",w),M.removeEventListener("end",N),M.removeEventListener("change",C)}},[a,o,l,M,h,x]),$.useEffect(()=>{if(i){const C=y().controls;return v({controls:M}),()=>v({controls:C})}},[i,M]),$.createElement("primitive",Xb({ref:u,object:M,enableDamping:s},c))}),IJ=(i,e,t)=>{let n;switch(i){case ei:n=new Uint8ClampedArray(e*t*4);break;case ln:n=new Uint16Array(e*t*4);break;case Jn:n=new Uint32Array(e*t*4);break;case $c:n=new Int8Array(e*t*4);break;case eu:n=new Int16Array(e*t*4);break;case Is:n=new Int32Array(e*t*4);break;case Rn:n=new Float32Array(e*t*4);break;default:throw new Error("Unsupported data type")}return n};let MA;const ZTe=(i,e,t,n)=>{if(MA!==void 0)return MA;const s=new xa(1,1,n);e.setRenderTarget(s);const r=new Kn(new Cc,new Ts({color:16777215}));e.render(r,t),e.setRenderTarget(null);const a=IJ(i,s.width,s.height);return e.readRenderTargetPixels(s,0,0,s.width,s.height,a),s.dispose(),r.geometry.dispose(),r.material.dispose(),MA=a[0]!==0,MA};class NO{constructor(e){var t,n,s,r,a,o,l,c,u,h,f,m,g,x,v,y;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(S){throw this._renderer.setRenderTarget(null),S}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const b={format:ii,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((t=e.renderTargetOptions)===null||t===void 0?void 0:t.anisotropy)!==void 0?(n=e.renderTargetOptions)===null||n===void 0?void 0:n.anisotropy:1,generateMipmaps:((s=e.renderTargetOptions)===null||s===void 0?void 0:s.generateMipmaps)!==void 0?(r=e.renderTargetOptions)===null||r===void 0?void 0:r.generateMipmaps:!1,magFilter:((a=e.renderTargetOptions)===null||a===void 0?void 0:a.magFilter)!==void 0?(o=e.renderTargetOptions)===null||o===void 0?void 0:o.magFilter:Jt,minFilter:((l=e.renderTargetOptions)===null||l===void 0?void 0:l.minFilter)!==void 0?(c=e.renderTargetOptions)===null||c===void 0?void 0:c.minFilter:Jt,samples:((u=e.renderTargetOptions)===null||u===void 0?void 0:u.samples)!==void 0?(h=e.renderTargetOptions)===null||h===void 0?void 0:h.samples:void 0,wrapS:((f=e.renderTargetOptions)===null||f===void 0?void 0:f.wrapS)!==void 0?(m=e.renderTargetOptions)===null||m===void 0?void 0:m.wrapS:ui,wrapT:((g=e.renderTargetOptions)===null||g===void 0?void 0:g.wrapT)!==void 0?(x=e.renderTargetOptions)===null||x===void 0?void 0:x.wrapT:ui};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=NO.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new fu,this._camera=new Dr,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!ZTe(this._type,this._renderer,this._camera,b)){let S;switch(this._type){case ln:S=this._renderer.extensions.has("EXT_color_buffer_float")?Rn:void 0;break}S!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Rn}`),this._type=S):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Kn(new Cc,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new xa(this.width,this.height,b),this._renderTarget.texture.mapping=((v=e.renderTargetOptions)===null||v===void 0?void 0:v.mapping)!==void 0?(y=e.renderTargetOptions)===null||y===void 0?void 0:y.mapping:hu}static instantiateRenderer(){const e=new yw;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=IJ(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new _a(this.toArray(),this.width,this.height,ii,this._type,(e==null?void 0:e.mapping)||hu,(e==null?void 0:e.wrapS)||ui,(e==null?void 0:e.wrapT)||ui,(e==null?void 0:e.magFilter)||Jt,(e==null?void 0:e.minFilter)||Jt,(e==null?void 0:e.anisotropy)||1,Jr);return t.generateMipmaps=(e==null?void 0:e.generateMipmaps)!==void 0?e==null?void 0:e.generateMipmaps:!1,t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof Za&&Object.values(this.material.uniforms).forEach(t=>{t.value instanceof In&&t.value.dispose()}),Object.values(this.material).forEach(t=>{t instanceof In&&t.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const JTe=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,QTe=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class $Te extends Za{constructor({gamma:e,offsetHdr:t,offsetSdr:n,gainMapMin:s,gainMapMax:r,maxDisplayBoost:a,hdrCapacityMin:o,hdrCapacityMax:l,sdr:c,gainMap:u}){super({name:"GainMapDecoderMaterial",vertexShader:JTe,fragmentShader:QTe,uniforms:{sdr:{value:c},gainMap:{value:u},gamma:{value:new z(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new z().fromArray(t)},offsetSdr:{value:new z().fromArray(n)},gainMapMin:{value:new z().fromArray(s)},gainMapMax:{value:new z().fromArray(r)},weightFactor:{value:(Math.log2(a)-o)/(l-o)}},blending:Nr,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=a,this._hdrCapacityMin=o,this._hdrCapacityMax=l,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class PJ extends Error{}class OJ extends Error{}const sv=(i,e,t)=>{const n=new RegExp(`${e}="([^"]*)"`,"i").exec(i);if(n)return n[1];const s=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(i);if(s){const r=s[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return r&&r.length===3?r.map(a=>a.replace(/<\/?rdf:li>/g,"")):s[1].trim()}if(t!==void 0)return t;throw new Error(`Can't find ${e} in gainmap metadata`)},e1e=i=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(i):e=i.toString();let t=e.indexOf("<x:xmpmeta");for(;t!==-1;){const n=e.indexOf("x:xmpmeta>",t),s=e.slice(t,n+10);try{const r=sv(s,"hdrgm:GainMapMin","0"),a=sv(s,"hdrgm:GainMapMax"),o=sv(s,"hdrgm:Gamma","1"),l=sv(s,"hdrgm:OffsetSDR","0.015625"),c=sv(s,"hdrgm:OffsetHDR","0.015625"),u=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(s),h=u?u[1]:"0",f=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(s);if(!f)throw new Error("Incomplete gainmap metadata");const m=f[1];return{gainMapMin:Array.isArray(r)?r.map(g=>parseFloat(g)):[parseFloat(r),parseFloat(r),parseFloat(r)],gainMapMax:Array.isArray(a)?a.map(g=>parseFloat(g)):[parseFloat(a),parseFloat(a),parseFloat(a)],gamma:Array.isArray(o)?o.map(g=>parseFloat(g)):[parseFloat(o),parseFloat(o),parseFloat(o)],offsetSdr:Array.isArray(l)?l.map(g=>parseFloat(g)):[parseFloat(l),parseFloat(l),parseFloat(l)],offsetHdr:Array.isArray(c)?c.map(g=>parseFloat(g)):[parseFloat(c),parseFloat(c),parseFloat(c)],hdrCapacityMin:parseFloat(h),hdrCapacityMax:parseFloat(m)}}catch{}t=e.indexOf("<x:xmpmeta",n)}};class t1e{constructor(e){this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((t,n)=>{const s=this.options.debug,r=new DataView(e.buffer);if(r.getUint16(0)!==65496){n(new Error("Not a valid jpeg"));return}const a=r.byteLength;let o=2,l=0,c;for(;o<a;){if(++l>250){n(new Error(`Found no marker after ${l} loops `));return}if(r.getUint8(o)!==255){n(new Error(`Not a valid marker at offset 0x${o.toString(16)}, found: 0x${r.getUint8(o).toString(16)}`));return}if(c=r.getUint8(o+1),s&&console.log(`Marker: ${c.toString(16)}`),c===226){s&&console.log("Found APP2 marker (0xffe2)");const u=o+4;if(r.getUint32(u)===1297106432){const h=u+4;let f;if(r.getUint16(h)===18761)f=!1;else if(r.getUint16(h)===19789)f=!0;else{n(new Error("No valid endianness marker found in TIFF header"));return}if(r.getUint16(h+2,!f)!==42){n(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const m=r.getUint32(h+4,!f);if(m<8){n(new Error("Not valid TIFF data! (First offset less than 8)"));return}const g=h+m,x=r.getUint16(g,!f),v=g+2;let y=0;for(let M=v;M<v+12*x;M+=12)r.getUint16(M,!f)===45057&&(y=r.getUint32(M+8,!f));const S=g+2+x*12+4,T=[];for(let M=S;M<S+y*16;M+=16){const C={MPType:r.getUint32(M,!f),size:r.getUint32(M+4,!f),dataOffset:r.getUint32(M+8,!f),dependantImages:r.getUint32(M+12,!f),start:-1,end:-1,isFII:!1};C.dataOffset?(C.start=h+C.dataOffset,C.isFII=!1):(C.start=0,C.isFII=!0),C.end=C.start+C.size,T.push(C)}if(this.options.extractNonFII&&T.length){const M=new Blob([r]),C=[];for(const w of T){if(w.isFII&&!this.options.extractFII)continue;const N=M.slice(w.start,w.end+1,"image/jpeg");C.push(N)}t(C)}}}o+=2+r.getUint16(o+2)}})}}const n1e=async i=>{const e=e1e(i);if(!e)throw new OJ("Gain map XMP metadata not found");const n=await new t1e({extractFII:!0,extractNonFII:!0}).extract(i);if(n.length!==2)throw new PJ("Gain map recovery image not found");return{sdr:new Uint8Array(await n[0].arrayBuffer()),gainMap:new Uint8Array(await n[1].arrayBuffer()),metadata:e}},ak=i=>new Promise((e,t)=>{const n=document.createElement("img");n.onload=()=>{e(n)},n.onerror=s=>{t(s)},n.src=URL.createObjectURL(i)});class FJ extends fr{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new KS}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=new $Te({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new In,sdr:new In});return new NO({width:16,height:16,type:ln,colorSpace:Jr,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,n,s){const r=s?new Blob([s],{type:"image/jpeg"}):void 0,a=new Blob([n],{type:"image/jpeg"});let o,l,c=!1;if(typeof createImageBitmap>"u"){const f=await Promise.all([r?ak(r):Promise.resolve(void 0),ak(a)]);l=f[0],o=f[1],c=!0}else{const f=await Promise.all([r?createImageBitmap(r,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(a,{imageOrientation:"flipY"})]);l=f[0],o=f[1]}const u=new In(l||new ImageData(2,2),hu,ui,ui,Jt,yb,ii,ei,1,Jr);u.flipY=c,u.needsUpdate=!0;const h=new In(o,hu,ui,ui,Jt,yb,ii,ei,1,Js);h.flipY=c,h.needsUpdate=!0,e.width=o.width,e.height=o.height,e.material.gainMap=u,e.material.sdr=h,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class i1e extends FJ{load([e,t,n],s,r,a){const o=this.prepareQuadRenderer();let l,c,u;const h=async()=>{if(l&&c&&u){try{await this.render(o,u,l,c)}catch(E){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(n),typeof a=="function"&&a(E),o.disposeOnDemandRenderer();return}typeof s=="function"&&s(o),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(n),o.disposeOnDemandRenderer()}};let f=!0,m=0,g=0,x=!0,v=0,y=0,b=!0,S=0,T=0;const M=()=>{if(typeof r=="function"){const E=m+v+S,B=g+y+T,U=f&&x&&b;r(new ProgressEvent("progress",{lengthComputable:U,loaded:B,total:E}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(n);const C=new cr(this._internalLoadingManager);C.setResponseType("arraybuffer"),C.setRequestHeader(this.requestHeader),C.setPath(this.path),C.setWithCredentials(this.withCredentials),C.load(e,async E=>{if(typeof E=="string")throw new Error("Invalid sdr buffer");l=E,await h()},E=>{f=E.lengthComputable,g=E.loaded,m=E.total,M()},E=>{this.manager.itemError(e),typeof a=="function"&&a(E)});const w=new cr(this._internalLoadingManager);w.setResponseType("arraybuffer"),w.setRequestHeader(this.requestHeader),w.setPath(this.path),w.setWithCredentials(this.withCredentials),w.load(t,async E=>{if(typeof E=="string")throw new Error("Invalid gainmap buffer");c=E,await h()},E=>{x=E.lengthComputable,y=E.loaded,v=E.total,M()},E=>{this.manager.itemError(t),typeof a=="function"&&a(E)});const N=new cr(this._internalLoadingManager);return N.setRequestHeader(this.requestHeader),N.setPath(this.path),N.setWithCredentials(this.withCredentials),N.load(n,async E=>{if(typeof E!="string")throw new Error("Invalid metadata string");u=JSON.parse(E),await h()},E=>{b=E.lengthComputable,T=E.loaded,S=E.total,M()},E=>{this.manager.itemError(n),typeof a=="function"&&a(E)}),o}}class s1e extends FJ{load(e,t,n,s){const r=this.prepareQuadRenderer(),a=new cr(this._internalLoadingManager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),this.manager.itemStart(e),a.load(e,async o=>{if(typeof o=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const l=new Uint8Array(o);let c,u,h;try{const f=await n1e(l);c=f.sdr,u=f.gainMap,h=f.metadata}catch(f){if(f instanceof OJ||f instanceof PJ)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),h={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},c=l;else throw f}try{await this.render(r,h,c,u)}catch(f){this.manager.itemError(e),typeof s=="function"&&s(f),r.disposeOnDemandRenderer();return}typeof t=="function"&&t(r),this.manager.itemEnd(e),r.disposeOnDemandRenderer()},n,o=>{this.manager.itemError(e),typeof s=="function"&&s(o)}),r}}const qb={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},GJ="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Dy=i=>Array.isArray(i),BO=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function DO({files:i=BO,path:e="",preset:t=void 0,colorSpace:n=void 0,extensions:s}={}){t&&(LO(t),i=qb[t],e=GJ);const r=Dy(i),{extension:a,isCubemap:o}=UO(i),l=IO(a);if(!l)throw new Error("useEnvironment: Unrecognized file extension: "+i);const c=ts(m=>m.gl);$.useLayoutEffect(()=>{if(a!=="webp"&&a!=="jpg"&&a!=="jpeg")return;function m(){Kl.clear(l,r?[i]:i)}c.domElement.addEventListener("webglcontextlost",m,{once:!0})},[i,c.domElement]);const u=Kl(l,r?[i]:i,m=>{(a==="webp"||a==="jpg"||a==="jpeg")&&m.setRenderer(c),m.setPath==null||m.setPath(e),s&&s(m)});let h=r?u[0]:u;if(a==="jpg"||a==="jpeg"||a==="webp"){var f;h=(f=h.renderTarget)==null?void 0:f.texture}return h.mapping=o?Sa:_c,h.colorSpace=n??(o?"srgb":"srgb-linear"),h}const r1e={files:BO,path:"",preset:void 0,extensions:void 0};DO.preload=i=>{const e={...r1e,...i};let{files:t,path:n=""}=e;const{preset:s,extensions:r}=e;s&&(LO(s),t=qb[s],n=GJ);const{extension:a}=UO(t);if(a==="webp"||a==="jpg"||a==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const o=IO(a);if(!o)throw new Error("useEnvironment: Unrecognized file extension: "+t);Kl.preload(o,Dy(t)?[t]:t,l=>{l.setPath==null||l.setPath(n),r&&r(l)})};const a1e={files:BO,preset:void 0};DO.clear=i=>{const e={...a1e,...i};let{files:t}=e;const{preset:n}=e;n&&(LO(n),t=qb[n]);const{extension:s}=UO(t),r=IO(s);if(!r)throw new Error("useEnvironment: Unrecognized file extension: "+t);Kl.clear(r,Dy(t)?[t]:t)};function LO(i){if(!(i in qb))throw new Error("Preset must be one of: "+Object.keys(qb).join(", "))}function UO(i){var e;const t=Dy(i)&&i.length===6,n=Dy(i)&&i.length===3&&i.some(a=>a.endsWith("json")),s=Dy(i)?i[0]:i;return{extension:t?"cube":n?"webp":s.startsWith("data:application/exr")?"exr":s.startsWith("data:application/hdr")?"hdr":s.startsWith("data:image/jpeg")?"jpg":(e=s.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:t,isGainmap:n}}function IO(i){return i==="cube"?PU:i==="hdr"?WTe:i==="exr"?XTe:i==="jpg"||i==="jpeg"?s1e:i==="webp"?i1e:null}function ok(i=25e5,e=1.25){const t=window.innerWidth,n=window.innerHeight,s=i/(t*n);return Math.max(.9,Math.min(e,s))}function lk(i,e=.9){return Math.max(.9,i*e)}function o1e(i,e){const{camera:t,invalidate:n}=ts(),s=$.useRef(!1),r=$.useRef(null),a=$.useRef(null),o=new z(-5,1.2,5),l=new z(0,1,0);$.useEffect(()=>{if(!e||!i.current||s.current)return;const c=i.current,u=Oe.isViewingUnit,h=Oe.restoreDefaultControls;(u||h)&&(c.maxDistance=1/0,c.minDistance=0,c.maxPolarAngle=Math.PI*2,c.minPolarAngle=0,c.minAzimuthAngle=-1/0,c.maxAzimuthAngle=1/0,c.update());const f=t.position.clone(),m=c.target.clone(),g=t.fov,x=.5,v=.3,y=f.distanceTo(o),b=m.distanceTo(l);if(y<x&&b<v){Oe.resetCamera=!1,Oe.isCameraAtDefaultPosition=!0,Oe.isViewingUnit=!1;return}if(u||h){const M=t.position.clone(),C=c.target.clone();f.copy(M),m.copy(C)}s.current=!0,r.current&&r.current.kill();const S=uT.timeline({onComplete:()=>{u&&h&&(c.maxDistance=25,c.minDistance=4,c.maxPolarAngle=Math.PI/2-.05,c.minPolarAngle=1.1,c.minAzimuthAngle=-1/0,c.maxAzimuthAngle=1/0,Oe.restoreDefaultControls=!1),s.current=!1,Oe.resetCamera=!1,Oe.isCameraAtDefaultPosition=!0,Oe.isViewingUnit=!1}}),T={x:f.x,y:f.y,z:f.z,targetX:m.x,targetY:m.y,targetZ:m.z,fov:g};return S.to(T,{x:o.x,y:o.y,z:o.z,targetX:l.x,targetY:l.y,targetZ:l.z,fov:45,duration:1.5,ease:"power2.inOut",onUpdate:function(){t.position.set(this.targets()[0].x,this.targets()[0].y,this.targets()[0].z),c.target.set(this.targets()[0].targetX,this.targets()[0].targetY,this.targets()[0].targetZ),t.fov=this.targets()[0].fov,t.updateProjectionMatrix(),c.update(),n()}}),r.current=S,()=>{r.current&&r.current.kill(),s.current=!1}},[e,t,i]),$.useEffect(()=>{if(!i.current)return;const c=()=>{if(!i.current||s.current)return;const u=t.position.clone(),h=i.current.target.clone(),f=.5,m=.3,g=u.distanceTo(o),x=h.distanceTo(l);Oe.isCameraAtDefaultPosition=g<f&&x<m};return c(),a.current=setInterval(c,500),()=>{a.current&&clearInterval(a.current)}},[t,i])}function l1e(i,e){const{camera:t,invalidate:n}=ts(),s=$.useRef(!1),r=$.useRef(null),a=new z(-8,12,22),o=new z(0,1,0);$.useEffect(()=>{if(!e||!i.current||s.current)return;const l=i.current,c=t.position.clone(),u=l.target.clone();s.current=!0,r.current&&r.current.kill();const h=uT.timeline({onComplete:()=>{s.current=!1,Oe.animateCameraToSurroundings=!1}});return h.to({x:c.x,y:c.y,z:c.z,targetX:u.x,targetY:u.y,targetZ:u.z},{x:a.x,y:a.y,z:a.z,targetX:o.x,targetY:o.y,targetZ:o.z,duration:1.5,ease:"power2.inOut",onUpdate:function(){t.position.set(this.targets()[0].x,this.targets()[0].y,this.targets()[0].z),l.target.set(this.targets()[0].targetX,this.targets()[0].targetY,this.targets()[0].targetZ),l.update(),n()}}),r.current=h,()=>{r.current&&r.current.kill(),s.current=!1}},[e,t,i,n])}const c1e={"1f_ne":{availability:"AVAILABLE",bathrooms:2,bedrooms:3,surface:95,cameraPosition:[-1.8,.45,-.5],cameraTarget:[-1.8,.45,-.05],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"1f_nw":{availability:"RESERVED",bathrooms:1,bedrooms:2,surface:75,cameraPosition:[1.65,.43,.09],cameraTarget:[1.65,.43,.54],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"1f_se":{availability:"SOLD",bathrooms:2,bedrooms:2,surface:80,cameraPosition:[-1.4,.42,-.5],cameraTarget:[-1.4,.42,-.97],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"1f_sw":{availability:"AVAILABLE",bathrooms:1,bedrooms:1,surface:60,cameraPosition:[2.2,.43,.1],cameraTarget:[2.2,.43,-.32],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"2f_ne":{availability:"RESERVED",bathrooms:2,bedrooms:3,surface:100,cameraPosition:[-1.8,.75,-.5],cameraTarget:[-1.8,.75,-.05],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"2f_nw":{availability:"AVAILABLE",bathrooms:1,bedrooms:2,surface:70,cameraPosition:[1.65,.73,.09],cameraTarget:[1.65,.73,.54],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"2f_se":{availability:"RESERVED",bathrooms:2,bedrooms:2,surface:85,cameraPosition:[-1.4,.43,-.5],cameraTarget:[-1.4,.43,-.97],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"2f_sw":{availability:"AVAILABLE",bathrooms:1,bedrooms:1,surface:65,cameraPosition:[2.2,.73,.1],cameraTarget:[2.2,.73,-.32],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"3f_ne":{availability:"AVAILABLE",bathrooms:2,bedrooms:3,surface:105,cameraPosition:[-1.8,1.05,-.5],cameraTarget:[-1.8,1.05,-.05],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"3f_nw":{availability:"AVAILABLE",bathrooms:2,bedrooms:2,surface:88,cameraPosition:[1.65,1.03,.09],cameraTarget:[1.65,1.03,.54],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"3f_se":{availability:"RESERVED",bathrooms:1,bedrooms:2,surface:75,cameraPosition:[-1.4,.73,-.5],cameraTarget:[-1.4,.73,-.97],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"3f_sw":{availability:"AVAILABLE",bathrooms:2,bedrooms:3,surface:110,cameraPosition:[2.2,1.03,.1],cameraTarget:[2.2,1.03,-.32],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"4f_ne":{availability:"AVAILABLE",bathrooms:2,bedrooms:3,surface:115,cameraPosition:[-1.8,1.35,-.5],cameraTarget:[-1.8,1.35,-.05],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"4f_nw":{availability:"AVAILABLE",bathrooms:2,bedrooms:2,surface:90,cameraPosition:[1.65,1.33,.09],cameraTarget:[1.65,1.33,.54],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"4f_se":{availability:"AVAILABLE",bathrooms:1,bedrooms:2,surface:78,cameraPosition:[-1.4,1.33,-.5],cameraTarget:[-1.4,1.33,-.97],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"4f_sw":{availability:"SOLD",bathrooms:2,bedrooms:3,surface:120,cameraPosition:[2.2,1.33,.1],cameraTarget:[2.2,1.33,-.32],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"5f_ne":{availability:"AVAILABLE",bathrooms:2,bedrooms:3,surface:118,cameraPosition:[-1.8,1.62,-.5],cameraTarget:[-1.8,1.62,-.05],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"5f_nw":{availability:"SOLD",bathrooms:2,bedrooms:2,surface:95,cameraPosition:[1.65,1.63,.09],cameraTarget:[1.65,1.63,.54],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"5f_se":{availability:"RESERVED",bathrooms:1,bedrooms:2,surface:82,cameraPosition:[-1.4,1.63,-.5],cameraTarget:[-1.4,1.63,-.97],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"5f_sw":{availability:"AVAILABLE",bathrooms:2,bedrooms:3,surface:115,cameraPosition:[2.2,1.63,.1],cameraTarget:[2.2,1.63,-.32],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"6f_ne":{availability:"AVAILABLE",bathrooms:2,bedrooms:3,surface:120,cameraPosition:[-1.8,1.9,-.5],cameraTarget:[-1.8,1.9,-.05],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"6f_nw":{availability:"RESERVED",bathrooms:2,bedrooms:3,surface:115,cameraPosition:[1.65,1.93,.09],cameraTarget:[1.65,1.93,.54],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"6f_se":{availability:"AVAILABLE",bathrooms:2,bedrooms:2,surface:100,cameraPosition:[-1.4,1.93,-.5],cameraTarget:[-1.4,1.93,-.97],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}},"6f_sw":{availability:"AVAILABLE",bathrooms:2,bedrooms:3,surface:120,cameraPosition:[2.2,1.93,.1],cameraTarget:[2.2,1.93,-.32],cameraControls:{maxDistance:.45,minDistance:0,maxPolarAngle:Math.PI/2+.05,minPolarAngle:1.5,minAzimuthAngle:1/0,maxAzimuthAngle:-1/0}}};function u1e(i){let e=0;for(let t=0;t<i.length;t++){const n=i.charCodeAt(t);e=(e<<5)-e+n,e=e&e}return()=>(e=(e*9301+49297)%233280/233280,e)}function h1e(i){const e=u1e(i),t=()=>e(),n=i.match(/^(\d+)f_(ne|nw|se|sw)$/i);if(!n)throw new Error(`Invalid unit ID format: ${i}`);const s=parseInt(n[1]),r=n[2].toUpperCase(),a=c1e[i]||{};let o;if(a.surface!==void 0)o=Math.max(50,Math.min(120,a.surface));else{const g=50+(s-1)*8,x=30*t(),v=Math.round(g+x);o=Math.max(50,Math.min(120,v))}let l;a.bedrooms!==void 0?l=Math.max(1,Math.min(3,a.bedrooms)):(o>=80?l=t()<.7?3:t()<.85?2:1:o>=65?l=t()<.6?2:t()<.8?1:3:l=t()<.75?1:2,l=Math.max(1,Math.min(3,l)));const c=a.bathrooms!==void 0?Math.max(1,Math.min(2,a.bathrooms)):(l>=3||o>=90)&&t()>.4?2:1;let u;if(a.availability)u=a.availability;else{const g=t();g<.4?u="AVAILABLE":g<.7?u="RESERVED":u="SOLD"}let h,f;if(a.cameraPosition&&a.cameraTarget)h=a.cameraPosition,f=a.cameraTarget;else{const v=(s-1)*.2+.12,b={NE:{x:.15,z:.15},NW:{x:.15,z:-.15},SE:{x:-.15,z:.15},SW:{x:-.15,z:-.15}}[r]||{x:0,z:0};h=[5.8+b.x,v,1+b.z],f=[5.8+b.x*.5,v,1+b.z*.5]}let m;return a.cameraControls?m=a.cameraControls:m={maxDistance:15,minDistance:2,maxPolarAngle:Math.PI/2-.1,minPolarAngle:.5,minAzimuthAngle:-1/0,maxAzimuthAngle:1/0},{id:i,floor:s,orientation:r,surface:o,bedrooms:l,bathrooms:c,availability:u,cameraPosition:h,cameraTarget:f,cameraControls:m}}const d1e=[1,2,3,4,5,6],f1e=["ne","nw","se","sw"],cx={};d1e.forEach(i=>{f1e.forEach(e=>{const t=`${i}f_${e}`;cx[t]=h1e(t)})});function p1e(i,e){const{camera:t,invalidate:n}=ts(),s=$.useRef(!1),r=$.useRef(null);$.useEffect(()=>{if(!e||!i.current||s.current||!cx[e])return;const a=i.current,o=cx[e],l=new z(...o.cameraPosition),c=new z(...o.cameraTarget),u=o.cameraControls||{maxDistance:15,minDistance:2,maxPolarAngle:Math.PI/2-.1,minPolarAngle:.5,minAzimuthAngle:-1/0,maxAzimuthAngle:1/0},h=t.position.clone(),f=a.target.clone(),m=t.fov;s.current=!0,Oe.isViewingUnit=!0,Oe.openedPanel==="unit-detail"&&Oe.selectedUnitId&&(Oe.previousSelectedUnitId=Oe.selectedUnitId,Oe.openedPanel=null,Oe.selectedUnitId=null),V3(i,!0,1/0,0,Math.PI*2,0,-1/0,1/0),h.distanceTo(f),r.current&&r.current.kill();const g=uT.timeline({onComplete:()=>{V3(i,!0,u.maxDistance,u.minDistance,u.maxPolarAngle,u.minPolarAngle,u.minAzimuthAngle,u.maxAzimuthAngle),s.current=!1,Oe.animateCameraToUnitId=null}}),x={x:f.x,y:f.y,z:f.z},v={x:h.x,y:h.y,z:h.z},y={fov:m};return g.to(v,{x:l.x,y:l.y,z:l.z,duration:1.2,ease:"power2.inOut",onUpdate:function(){a.update(),t.position.set(this.targets()[0].x,this.targets()[0].y,this.targets()[0].z),n()}}).to(y,{fov:75,duration:1.5,ease:"power2.inOut",onUpdate:function(){t.fov=this.targets()[0].fov,t.updateProjectionMatrix(),n()}},"<").to(x,{x:c.x,y:c.y,z:c.z,duration:1.5,ease:"power2.inOut",onUpdate:function(){a.update(),a.target.set(this.targets()[0].x,this.targets()[0].y,this.targets()[0].z),n()}},"<"),r.current=g,()=>{r.current&&r.current.kill(),s.current=!1}},[e,t,i,n])}function V3(i,e,t,n,s,r,a,o){if(!(!i||!i.current))try{i.current.enabled=e,i.current.maxDistance=e?t:1/0,i.current.minDistance=e?n:0,i.current.maxPolarAngle=e?s:Math.PI*2,i.current.minPolarAngle=e?r:0,i.current.minAzimuthAngle=e?a:0,i.current.maxAzimuthAngle=e?o:Math.PI*2}catch{}}function m1e({enabled:i,adaptiveDPR:e=1}){const t=qi(Oe),n=$.useRef(null);ts(N=>N.camera);const s=ts(N=>N.gl),{setDpr:r,invalidate:a}=ts(),o=$.useRef(null),{isMobile:l,radialMenuOpen:c,resetCamera:u,animateCameraToSurroundings:h,animateCameraToUnitId:f,restoreDefaultControls:m,isViewingUnit:g}=qi(Oe),x=$.useRef(null),v=$.useRef(0);o1e(n,u),l1e(n,h),p1e(n,f);const y=$.useRef({x:0,y:0}),b=$.useRef({x:0,y:0}),S=$.useRef(!1),T=$.useRef(!1),M=5;$.useEffect(()=>{if(!s||!s.domElement)return;const N=s.domElement;if(!N)return;const E=H=>{H.button===0&&(S.current=!0,T.current=!1,y.current={x:H.clientX,y:H.clientY},b.current={x:H.clientX,y:H.clientY})},B=H=>{if(!S.current)return;b.current={x:H.clientX,y:H.clientY};const F=b.current.x-y.current.x,V=b.current.y-y.current.y;Math.sqrt(F*F+V*V)>M&&!T.current&&!Oe.radialMenuOpen&&(T.current=!0,o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{Oe.isDraggingCamera=!0},800),Oe.allowHover=!1,Oe.allowClick=!1,Oe.hoveredModel=!1,Oe.hoveredElement=null,Oe.hoveredElementName="")},U=()=>{S.current=!1,T.current&&(Oe.isDraggingCamera=!1,o.current&&(clearTimeout(o.current),o.current=null),!t.intro&&t.finishedIntro&&(Oe.allowHover=!0,Oe.allowClick=!0)),T.current=!1};try{N.addEventListener("pointerdown",E),N.addEventListener("pointermove",B),N.addEventListener("pointerup",U),N.addEventListener("pointercancel",U)}catch{return}return()=>{o.current&&(clearTimeout(o.current),o.current=null);try{N&&N.removeEventListener&&(N.removeEventListener("pointerdown",E),N.removeEventListener("pointermove",B),N.removeEventListener("pointerup",U),N.removeEventListener("pointercancel",U))}catch{}}},[t.intro,t.finishedIntro,s]);function C(N,E,B,U,H,F,V){V3(n,N,E,B,U,H,F,V)}$.useEffect(()=>{C(!0,25,4,Math.PI/2-.05,1.1,-1/0,-1/0),Oe.finishedIntro=!0,Oe.finishedMainLoading=!0},[]),$.useEffect(()=>{if(m&&n.current){if(g||u)return;C(!0,25,4,Math.PI/2-.05,1.1,-1/0,-1/0),Oe.restoreDefaultControls=!1}},[m,g,u]);const w=$.useCallback(()=>{if(l)return;const N=lk(e);r(N),v.current=30,a(),x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{r(e),v.current=30,a()},200)},[r,l,a,e]);return $.useEffect(()=>()=>{x.current&&clearTimeout(x.current)},[]),$.useEffect(()=>{if(l)return;const N=lk(e);t.isManipulatingSlider?(r(N),v.current=30,a()):(r(e),v.current=30,a())},[t.isManipulatingSlider,r,l,a,e]),yu(()=>{v.current>0&&(v.current--,a())}),G.jsx(G.Fragment,{children:G.jsx(KTe,{enabled:!1,ref:n,enablePan:!1,screenSpacePanning:!1,target:[0,1,0],enableDamping:!1,zoomSpeed:.5,onChange:w})})}const g1e=({url:i})=>{const{audioVolume:e,finishedMainLoading:t,isMusicPlaying:n,isDraggingCamera:s}=qi(Oe),r=()=>{},[a,o]=Ld.useState(!1),l=Ld.useRef(null),c=()=>{o(!0),cB(!0)},u=()=>{o(!1),cB(!1)},h=()=>{o(!1),cB(!1)},f=()=>{l.current&&(l.current.play(),l.current.volume=e,l.current.loop=!0)};$.useEffect(()=>{l.current&&(l.current.volume=e)},[e]);const m=()=>{l.current&&l.current.pause()},g=()=>{f()},[x,v]=Ld.useState(!1),y=$.useCallback(()=>{x&&l.current.play()},[x]),b=$.useCallback(()=>{const T=!l.current.paused;v(T),T&&l.current.pause()},[]);return $.useEffect(()=>{o(n)},[n]),$.useEffect(()=>{l.current&&(n&&l.current.paused?l.current.play():!n&&!l.current.paused&&l.current.pause())},[n]),$.useEffect(()=>(window.addEventListener("focus",y),window.addEventListener("blur",b),()=>{window.removeEventListener("focus",y),window.removeEventListener("blur",b)}),[y,b]),G.jsxs(G.Fragment,{children:[G.jsx("button",{id:"buttonAudio",className:`btn ${s?"hidden":""}`,style:{display:t?"flex":"none"},onClick:()=>{a?m():g()},onPointerEnter:r,children:G.jsxs("svg",{id:"wave",className:a?"animated":"",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",children:[G.jsx("path",{id:"Line_1","data-name":"Line 1",fill:"white",d:"M0.91,15L0.78,15A1,1,0,0,0,0,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H0.91Z"}),G.jsx("path",{id:"Line_2","data-name":"Line 2",fill:"white",d:"M6.91,9L6.78,9A1,1,0,0,0,6,10V28a1,1,0,1,0,2,0s0,0,0,0V10A1,1,0,0,0,7,9H6.91Z"}),G.jsx("path",{id:"Line_3","data-name":"Line 3",fill:"white",d:"M12.91,0L12.78,0A1,1,0,0,0,12,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H12.91Z"}),G.jsx("path",{id:"Line_4","data-name":"Line 4",fill:"white",d:"M18.91,10l-0.12,0A1,1,0,0,0,18,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H18.91Z"}),G.jsx("path",{id:"Line_5","data-name":"Line 5",fill:"white",d:"M24.91,15l-0.12,0A1,1,0,0,0,24,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H24.91Z"})]})}),G.jsx("audio",{src:i,ref:l,onPlay:c,onPause:u,onEnded:h,children:"Your browser does not support the <code>audio</code> element."})]})};function y1e(){const{resetCamera:i,isCameraAtDefaultPosition:e,isDraggingCamera:t}=qi(Oe),n=$.useRef(null),s=a=>{n.current&&(clearTimeout(n.current),n.current=null),a.classList.add("hover-active")},r=a=>{n.current=setTimeout(()=>{const o=a.offsetWidth;a.style.width=`${o}px`,a.offsetWidth,a.classList.remove("hover-active"),setTimeout(()=>{a.style.width=""},200)},300)};return G.jsxs("div",{className:`mobile-menu-button home-button ${i||e?"hidden":""} ${t?"hidden dragging":""}`,"cursor-class":"cursor-button",onMouseEnter:a=>s(a.currentTarget),onMouseLeave:a=>r(a.currentTarget),onClick:()=>{e||(Oe.resetCamera=!0)},children:[G.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"",viewBox:"0 0 24 24",children:[G.jsx("path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"}),G.jsx("path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"})]}),G.jsx("span",{className:"menu-text",children:"HOME"})]})}function x1e(){const{isDraggingCamera:i}=qi(Oe),e=$.useRef(null),t=s=>{e.current&&(clearTimeout(e.current),e.current=null),s.classList.add("hover-active")},n=s=>{e.current=setTimeout(()=>{const r=s.offsetWidth;s.style.width=`${r}px`,s.offsetWidth,s.classList.remove("hover-active"),setTimeout(()=>{s.style.width=""},200)},300)};return i?null:G.jsxs("div",{className:"mobile-menu-button home-button","cursor-class":"cursor-button",onMouseEnter:s=>t(s.currentTarget),onMouseLeave:s=>n(s.currentTarget),onClick:()=>{Oe.resetCamera=!0,Oe.openedPanel=null,Oe.selectedUnitId=null},children:[G.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"",viewBox:"0 0 24 24",children:[G.jsx("path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"}),G.jsx("path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"})]}),G.jsx("span",{className:"menu-text",children:"HOME"})]})}function _1e(){const{isDraggingCamera:i}=qi(Oe),e=$.useRef(null),t=s=>{e.current&&(clearTimeout(e.current),e.current=null),s.classList.add("hover-active")},n=s=>{e.current=setTimeout(()=>{const r=s.offsetWidth;s.style.width=`${r}px`,s.offsetWidth,s.classList.remove("hover-active"),setTimeout(()=>{s.style.width=""},200)},300)};return G.jsxs("div",{className:`mobile-menu-button exit-button ${i?"hidden":""}`,"cursor-class":"cursor-button",onMouseEnter:s=>t(s.currentTarget),onMouseLeave:s=>n(s.currentTarget),onClick:()=>{Oe.restoreDefaultControls=!0,Oe.resetCamera=!0,Oe.previousSelectedUnitId?(Oe.openedPanel="unit-detail",Oe.selectedUnitId=Oe.previousSelectedUnitId,Oe.previousSelectedUnitId=null):(Oe.openedPanel=null,Oe.selectedUnitId=null),Oe.animateCameraToUnitId=null,Oe.isViewingUnit=!1},children:[G.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"lucide lucide-x-icon lucide-x",viewBox:"0 0 24 24",children:G.jsx("path",{d:"M18 6 6 18M6 6l12 12"})}),G.jsx("span",{className:"menu-text",children:"EXIT"})]})}function v1e(){const{openedPanel:i,isViewingUnit:e,isDraggingCamera:t}=qi(Oe),n=$.useRef(null),s=a=>{n.current&&(clearTimeout(n.current),n.current=null),a.classList.add("hover-active")},r=a=>{n.current=setTimeout(()=>{const o=a.offsetWidth;a.style.width=`${o}px`,a.offsetWidth,a.classList.remove("hover-active"),setTimeout(()=>{a.style.width=""},200)},300)};return G.jsxs("div",{className:`mobile-menu-button ${i||e||t?"hidden":""}`,"cursor-class":"cursor-button",onMouseEnter:a=>s(a.currentTarget),onMouseLeave:a=>r(a.currentTarget),onClick:()=>{!i&&!e&&(Oe.openedPanel="surroundings-panel",Oe.animateCameraToSurroundings=!0)},children:[G.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"lucide lucide-map-pin-icon lucide-map-pin",viewBox:"0 0 24 24",children:[G.jsx("path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"}),G.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),G.jsx("span",{className:"menu-text",children:"SURROUNDINGS"})]})}function b1e(){const{openedPanel:i,isViewingUnit:e,isDraggingCamera:t}=qi(Oe),n=$.useRef(null),s=a=>{n.current&&(clearTimeout(n.current),n.current=null),a.classList.add("hover-active")},r=a=>{n.current=setTimeout(()=>{const o=a.offsetWidth;a.style.width=`${o}px`,a.offsetWidth,a.classList.remove("hover-active"),setTimeout(()=>{a.style.width=""},200)},300)};return G.jsxs("div",{className:`mobile-menu-button ${i||e||t?"hidden":""}`,"cursor-class":"cursor-button",onMouseEnter:a=>s(a.currentTarget),onMouseLeave:a=>r(a.currentTarget),onClick:()=>{!i&&!e&&(Oe.openedPanel="unit-search")},children:[G.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",className:"lucide lucide-search-icon lucide-search",viewBox:"0 0 24 24",children:[G.jsx("path",{d:"m21 21-4.34-4.34"}),G.jsx("circle",{cx:"11",cy:"11",r:"8"})]}),G.jsx("span",{className:"menu-text",children:"UNIT SEARCH"})]})}function S1e(){const{openedPanel:i,isViewingUnit:e,isDraggingCamera:t}=qi(Oe),n=$.useRef(null),s=a=>{n.current&&(clearTimeout(n.current),n.current=null),a.classList.add("hover-active")},r=a=>{n.current=setTimeout(()=>{const o=a.offsetWidth;a.style.width=`${o}px`,a.offsetWidth,a.classList.remove("hover-active"),setTimeout(()=>{a.style.width=""},200)},300)};return G.jsxs("div",{className:`mobile-menu-button ${i&&!e||t?"hidden":""}`,"cursor-class":"cursor-button",onMouseEnter:a=>s(a.currentTarget),onMouseLeave:a=>r(a.currentTarget),onClick:()=>{(!i||e)&&(Oe.openedPanel="time-of-day")},children:[G.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",children:[G.jsx("circle",{cx:"12",cy:"12",r:"4",fill:"none"}),G.jsx("path",{d:"M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"})]}),G.jsx("span",{className:"menu-text",children:"TIME OF DAY"})]})}function T1e(){const{finishedMainLoading:i,finishedIntro:e,isViewingUnit:t,openedPanel:n}=qi(Oe),s=n==="unit-detail";return G.jsx(G.Fragment,{children:G.jsx("div",{className:"footer-wrapper",children:G.jsx("div",{className:`footer-input-container ${i&&e?"show":""}`,children:G.jsxs("div",{className:"mobile-menu-button-container",children:[t?G.jsx(_1e,{}):s?G.jsx(x1e,{}):G.jsx(y1e,{}),!t&&!s&&G.jsx(v1e,{}),!t&&!s&&G.jsx(b1e,{}),!s&&G.jsx(S1e,{}),G.jsx(g1e,{url:"/music.mp3",startAudio:!0})]})})})})}const xB=new Aa,A1e=new Ae,M1e=[60,300,180,240,120,0];let _B;class E1e extends ti{static get type(){return"GTAONode"}constructor(e,t,n){super("float"),this.depthNode=e,this.normalNode=t,this.resolutionScale=1,this.updateBeforeType=oT.FRAME,this._aoRenderTarget=new Si(1,1,{depthBuffer:!1,format:ql}),this._aoRenderTarget.texture.name="GTAONode.AO",this.radius=ut(.25),this.resolution=ut(new Ae),this.thickness=ut(1),this.distanceExponent=ut(1),this.distanceFallOff=ut(1),this.scale=ut(1),this.samples=ut(16),this.useTemporalFiltering=!1,this._noiseNode=bs(C1e()),this._cameraProjectionMatrix=ut(n.projectionMatrix),this._cameraProjectionMatrixInverse=ut(n.projectionMatrixInverse),this._cameraNear=nE("near","float",n),this._cameraFar=nE("far","float",n),this._temporalDirection=ut(0),this._material=new Tn,this._material.name="GTAO",this._textureNode=op(this,this._aoRenderTarget.texture)}getTextureNode(){return this._textureNode}setSize(e,t){e=Math.round(this.resolutionScale*e),t=Math.round(this.resolutionScale*t),this.resolution.value.set(e,t),this._aoRenderTarget.setSize(e,t)}updateBefore(e){const{renderer:t}=e;if(_B=Vs.resetRendererState(t,_B),this.useTemporalFiltering===!0){const s=e.frameId;this._temporalDirection.value=M1e[s%6]/360}else this._temporalDirection.value=0;const n=t.getDrawingBufferSize(A1e);this.setSize(n.width,n.height),xB.material=this._material,xB.name="AO",t.setClearColor(16777215,1),t.setRenderTarget(this._aoRenderTarget),xB.render(t),Vs.restoreRendererState(t,_B)}setup(e){const t=kl(),n=o=>{const l=this.depthNode.sample(o).r;if(e.renderer.logarithmicDepthBuffer===!0){const c=LK(l,this._cameraNear,this._cameraFar);return $P(c,this._cameraNear,this._cameraFar)}return l},s=o=>this._noiseNode.sample(o),r=o=>this.normalNode!==null?this.normalNode.sample(o).rgb.normalize():DK(o,this.depthNode.value,this._cameraProjectionMatrixInverse),a=bn(()=>{const o=n(t).toVar();o.greaterThanEqual(1).discard();const l=Cy(t,o,this._cameraProjectionMatrixInverse).toVar(),c=r(t).toVar(),u=this.radius,h=S_e(this._noiseNode,0);let f=Ui(t.x,t.y.oneMinus());f=f.mul(this.resolution.div(h));const m=s(f),g=m.xyz.mul(2).sub(1),x=an(g.xy,0).normalize(),v=an(x.y.mul(-1),x.x,0),y=o_e(x,v,an(0,0,1)),b=this.samples.lessThan(30).select(3,5).toVar(),S=eE(this.samples,b.sub(1)).div(b).toVar(),T=_e(0).toVar();return rg({start:c3(0),end:b,type:"int",condition:"<"},({i:M})=>{const C=_e(M).div(_e(b)).mul(mv).add(this._temporalDirection).toVar(),w=ns(Ey(C),hc(C),0,eE(.5,sh(.5,m.w)));w.xyz=Pa(y.mul(w.xyz));const N=Pa(l.xyz.negate()).toVar(),E=Pa(Yv(w.xyz,N)).toVar(),B=Yv(E,N),U=Pa(c.sub(E.mul(li(c,E)))),H=Yv(U,E).toVar(),F=Ui(li(N,H),li(N,H.negate())).toVar();rg({end:S,type:"int",name:"j",condition:"<"},({j:ne})=>{const ge=w.xyz.mul(u).mul(w.w).mul(rh(BK(_e(ne).add(1),_e(S)),this.distanceExponent)),Te=dH(l.add(ge),this._cameraProjectionMatrix).toVar(),Be=n(Te).toVar(),wt=Cy(Te,Be,this._cameraProjectionMatrixInverse).toVar().sub(l).toVar();zo(ro(wt.z).lessThan(this.thickness),()=>{const ht=li(N,Pa(wt));F.x.addAssign(Rl(0,sh(ht.sub(F.x),qs(1,_e(2).div(_e(ne).add(2)),this.distanceFallOff))))});const be=dH(l.sub(ge),this._cameraProjectionMatrix).toVar(),Re=n(be).toVar(),Bt=Cy(be,Re,this._cameraProjectionMatrixInverse).toVar().sub(l).toVar();zo(ro(Bt.z).lessThan(this.thickness),()=>{const ht=li(N,Pa(Bt));F.y.addAssign(Rl(0,sh(ht.sub(F.y),qs(1,_e(2).div(_e(ne).add(2)),this.distanceFallOff))))})});const V=QP(u3(1,F.mul(F))).toVar(),Y=li(U,B),P=li(U,N),X=sh(.5,l3(F.y).sub(l3(F.x)).add(V.x.mul(F.x).sub(V.y.mul(F.y)))),J=sh(.5,u3(2,F.x.mul(F.x)).sub(F.y.mul(F.y))),re=Y.mul(X).add(P.mul(J));T.addAssign(re)}),T.assign(Xc(T.div(b),0,1)),T.assign(rh(T,this.scale)),T});return this._material.fragmentNode=a().context(e.getSharedContext()),this._material.needsUpdate=!0,this._textureNode}dispose(){this._aoRenderTarget.dispose(),this._material.dispose()}}function C1e(i=5){const e=Math.floor(i)%2===0?Math.floor(i)+1:Math.floor(i),t=w1e(e),n=t.length,s=new Uint8Array(n*4);for(let a=0;a<n;++a){const o=t[a],l=2*Math.PI*o/n,c=new z(Math.cos(l),Math.sin(l),0).normalize();s[a*4]=(c.x*.5+.5)*255,s[a*4+1]=(c.y*.5+.5)*255,s[a*4+2]=127,s[a*4+3]=255}const r=new _a(s,e,e);return r.wrapS=Zr,r.wrapT=Zr,r.needsUpdate=!0,r}function w1e(i){const e=Math.floor(i)%2===0?Math.floor(i)+1:Math.floor(i),t=e*e,n=Array(t).fill(0);let s=Math.floor(e/2),r=e-1;for(let a=1;a<=t;){if(s===-1&&r===e?(r=e-2,s=0):(r===e&&(r=0),s<0&&(s=e-1)),n[s*e+r]!==0){r-=2,s++;continue}else n[s*e+r]=a++;r++,s--}return n}const R1e=(i,e,t)=>new E1e(ps(i),ps(e),t),cc=new Aa,N1e=new Ae,B1e=new Ae(1,0),D1e=new Ae(0,1);let vB;class L1e extends ti{static get type(){return"BloomNode"}constructor(e,t=1,n=0,s=0){super("vec4"),this.inputNode=e,this.strength=ut(t),this.radius=ut(n),this.threshold=ut(s),this.smoothWidth=ut(.01),this._renderTargetsHorizontal=[],this._renderTargetsVertical=[],this._nMips=5,this._renderTargetBright=new Si(1,1,{depthBuffer:!1,type:ln}),this._renderTargetBright.texture.name="UnrealBloomPass.bright",this._renderTargetBright.texture.generateMipmaps=!1;for(let r=0;r<this._nMips;r++){const a=new Si(1,1,{depthBuffer:!1,type:ln});a.texture.name="UnrealBloomPass.h"+r,a.texture.generateMipmaps=!1,this._renderTargetsHorizontal.push(a);const o=new Si(1,1,{depthBuffer:!1,type:ln});o.texture.name="UnrealBloomPass.v"+r,o.texture.generateMipmaps=!1,this._renderTargetsVertical.push(o)}this._compositeMaterial=null,this._highPassFilterMaterial=null,this._separableBlurMaterials=[],this._textureNodeBright=bs(this._renderTargetBright.texture),this._textureNodeBlur0=bs(this._renderTargetsVertical[0].texture),this._textureNodeBlur1=bs(this._renderTargetsVertical[1].texture),this._textureNodeBlur2=bs(this._renderTargetsVertical[2].texture),this._textureNodeBlur3=bs(this._renderTargetsVertical[3].texture),this._textureNodeBlur4=bs(this._renderTargetsVertical[4].texture),this._textureOutput=op(this,this._renderTargetsHorizontal[0].texture),this.updateBeforeType=on.FRAME}getTextureNode(){return this._textureOutput}setSize(e,t){let n=Math.round(e/2),s=Math.round(t/2);this._renderTargetBright.setSize(n,s);for(let r=0;r<this._nMips;r++)this._renderTargetsHorizontal[r].setSize(n,s),this._renderTargetsVertical[r].setSize(n,s),this._separableBlurMaterials[r].invSize.value.set(1/n,1/s),n=Math.round(n/2),s=Math.round(s/2)}updateBefore(e){const{renderer:t}=e;vB=Vs.resetRendererState(t,vB);const n=t.getDrawingBufferSize(N1e);this.setSize(n.width,n.height),t.setRenderTarget(this._renderTargetBright),cc.material=this._highPassFilterMaterial,cc.name="Bloom [ High Pass ]",cc.render(t);let s=this._renderTargetBright;for(let r=0;r<this._nMips;r++)cc.material=this._separableBlurMaterials[r],this._separableBlurMaterials[r].colorTexture.value=s.texture,this._separableBlurMaterials[r].direction.value=B1e,t.setRenderTarget(this._renderTargetsHorizontal[r]),cc.name=`Bloom [ Blur Horizontal - ${r} ]`,cc.render(t),this._separableBlurMaterials[r].colorTexture.value=this._renderTargetsHorizontal[r].texture,this._separableBlurMaterials[r].direction.value=D1e,t.setRenderTarget(this._renderTargetsVertical[r]),cc.name=`Bloom [ Blur Vertical - ${r} ]`,cc.render(t),s=this._renderTargetsVertical[r];t.setRenderTarget(this._renderTargetsHorizontal[0]),cc.material=this._compositeMaterial,cc.name="Bloom [ Composite ]",cc.render(t),Vs.restoreRendererState(t,vB)}setup(e){const t=bn(()=>{const l=this.inputNode,c=Pb(l.rgb),u=ju(this.threshold,this.threshold.add(this.smoothWidth),c);return qs(ns(0),l,u)});this._highPassFilterMaterial=this._highPassFilterMaterial||new Tn,this._highPassFilterMaterial.fragmentNode=t().context(e.getSharedContext()),this._highPassFilterMaterial.name="Bloom_highPass",this._highPassFilterMaterial.needsUpdate=!0;const n=[6,10,14,18,22];for(let l=0;l<this._nMips;l++)this._separableBlurMaterials.push(this._getSeparableBlurMaterial(e,n[l]));const s=Kv([1,.8,.6,.4,.2]),r=Kv([new z(1,1,1),new z(1,1,1),new z(1,1,1),new z(1,1,1),new z(1,1,1)]),a=bn(([l,c])=>{const u=_e(1.2).sub(l);return qs(l,u,c)}).setLayout({name:"lerpBloomFactor",type:"float",inputs:[{name:"factor",type:"float"},{name:"radius",type:"float"}]}),o=bn(()=>{const l=a(s.element(0),this.radius).mul(ns(r.element(0),1)).mul(this._textureNodeBlur0),c=a(s.element(1),this.radius).mul(ns(r.element(1),1)).mul(this._textureNodeBlur1),u=a(s.element(2),this.radius).mul(ns(r.element(2),1)).mul(this._textureNodeBlur2),h=a(s.element(3),this.radius).mul(ns(r.element(3),1)).mul(this._textureNodeBlur3),f=a(s.element(4),this.radius).mul(ns(r.element(4),1)).mul(this._textureNodeBlur4);return l.add(c).add(u).add(h).add(f).mul(this.strength)});return this._compositeMaterial=this._compositeMaterial||new Tn,this._compositeMaterial.fragmentNode=o().context(e.getSharedContext()),this._compositeMaterial.name="Bloom_comp",this._compositeMaterial.needsUpdate=!0,this._textureOutput}dispose(){for(let e=0;e<this._renderTargetsHorizontal.length;e++)this._renderTargetsHorizontal[e].dispose();for(let e=0;e<this._renderTargetsVertical.length;e++)this._renderTargetsVertical[e].dispose();this._renderTargetBright.dispose(),this._highPassFilterMaterial!==null&&this._highPassFilterMaterial.dispose(),this._compositeMaterial!==null&&this._compositeMaterial.dispose();for(let e=0;e<this._separableBlurMaterials.length;e++)this._separableBlurMaterials[e].dispose()}_getSeparableBlurMaterial(e,t){const n=[],s=t/3;for(let m=0;m<t;m++)n.push(.39894*Math.exp(-.5*m*m/(s*s))/s);const r=bs(null),a=Kv(n),o=ut(new Ae),l=ut(new Ae(.5,.5)),c=kl(),u=m=>r.sample(m),h=bn(()=>{const m=u(c).rgb.mul(a.element(0)).toVar();return rg({start:c3(1),end:c3(t),type:"int",condition:"<"},({i:g})=>{const x=_e(g),v=a.element(g),y=l.mul(o).mul(x),b=u(c.add(y)).rgb,S=u(c.sub(y)).rgb;m.addAssign(eE(b,S).mul(v))}),ns(m,1)}),f=new Tn;return f.fragmentNode=h().context(e.getSharedContext()),f.name="Bloom_separable",f.needsUpdate=!0,f.colorTexture=r,f.direction=l,f.invSize=o,f}}const U1e=(i,e,t,n)=>ps(new L1e(ps(i),e,t,n)),rv=new Aa;let bB;class I1e extends ti{static get type(){return"GaussianBlurNode"}constructor(e,t=null,n=4,s={}){super("vec4"),this.textureNode=e,this.directionNode=t,this.sigma=n,this._invSize=ut(new Ae),this._passDirection=ut(new Ae),this._horizontalRT=new Si(1,1,{depthBuffer:!1}),this._horizontalRT.texture.name="GaussianBlurNode.horizontal",this._verticalRT=new Si(1,1,{depthBuffer:!1}),this._verticalRT.texture.name="GaussianBlurNode.vertical",this._textureNode=op(this,this._verticalRT.texture),this._textureNode.uvNode=e.uvNode,this.updateBeforeType=on.FRAME,this.resolutionScale=s.resolutionScale||1,this.premultipliedAlpha=s.premultipliedAlpha||!1}setSize(e,t){e=Math.max(Math.round(e*this.resolutionScale),1),t=Math.max(Math.round(t*this.resolutionScale),1),this._invSize.value.set(1/e,1/t),this._horizontalRT.setSize(e,t),this._verticalRT.setSize(e,t)}updateBefore(e){const{renderer:t}=e;bB=Vs.resetRendererState(t,bB);const n=this.textureNode,s=n.value,r=n.value;rv.material=this._material,this.setSize(s.image.width,s.image.height);const a=s.type;this._horizontalRT.texture.type=a,this._verticalRT.texture.type=a,t.setRenderTarget(this._horizontalRT),this._passDirection.value.set(1,0),rv.name="Gaussian Blur [ Horizontal Pass ]",rv.render(t),n.value=this._horizontalRT.texture,t.setRenderTarget(this._verticalRT),this._passDirection.value.set(0,1),rv.name="Gaussian Blur [ Vertical Pass ]",rv.render(t),n.value=r,Vs.restoreRendererState(t,bB)}getTextureNode(){return this._textureNode}setup(e){const t=this.textureNode,n=kl(),s=Ui(this.directionNode||1);let r,a;this.premultipliedAlpha?(r=u=>m_e(t.sample(u)),a=u=>T_e(u)):(r=u=>t.sample(u),a=u=>u);const o=bn(()=>{const u=3+2*this.sigma,h=this._getCoefficients(u),f=this._invSize,m=s.mul(this._passDirection),g=ns(r(n).mul(h[0])).toVar();for(let x=1;x<u;x++){const v=_e(x),y=_e(h[x]),b=Ui(m.mul(f.mul(v))).toVar(),S=r(n.add(b)),T=r(n.sub(b));g.addAssign(S.add(T).mul(y))}return a(g)}),l=this._material||(this._material=new Tn);l.fragmentNode=o().context(e.getSharedContext()),l.name="Gaussian_blur",l.needsUpdate=!0;const c=e.getNodeProperties(this);return c.textureNode=t,this._textureNode}dispose(){this._horizontalRT.dispose(),this._verticalRT.dispose()}_getCoefficients(e){const t=[],n=e/3;for(let s=0;s<e;s++)t.push(.39894*Math.exp(-.5*s*s/(n*n))/n);return t}get resolution(){return console.warn('THREE.GaussianBlurNode: The "resolution" property has been renamed to "resolutionScale" and is now of type `number`.'),new Ae(this.resolutionScale,this.resolutionScale)}set resolution(e){console.warn('THREE.GaussianBlurNode: The "resolution" property has been renamed to "resolutionScale" and is now of type `number`.'),this.resolutionScale=e.x}}const zJ=(i,e,t,n={})=>ps(new I1e(Ng(i),e,t,n)),Ds=new Aa;let SB;class P1e extends ti{static get type(){return"DepthOfFieldNode"}constructor(e,t,n,s,r){super("vec4"),this.textureNode=e,this.viewZNode=t,this.focusDistanceNode=n,this.focalLengthNode=s,this.bokehScaleNode=r,this._invSize=ut(new Ae),this._CoCRT=new Si(1,1,{depthBuffer:!1,type:ln,format:ql,count:2}),this._CoCRT.textures[0].name="DepthOfField.NearField",this._CoCRT.textures[1].name="DepthOfField.FarField",this._CoCBlurredRT=new Si(1,1,{depthBuffer:!1,type:ln,format:ql}),this._CoCBlurredRT.texture.name="DepthOfField.NearFieldBlurred",this._blur64RT=new Si(1,1,{depthBuffer:!1,type:ln}),this._blur64RT.texture.name="DepthOfField.Blur64",this._blur16NearRT=new Si(1,1,{depthBuffer:!1,type:ln}),this._blur16NearRT.texture.name="DepthOfField.Blur16Near",this._blur16FarRT=new Si(1,1,{depthBuffer:!1,type:ln}),this._blur16FarRT.texture.name="DepthOfField.Blur16Far",this._compositeRT=new Si(1,1,{depthBuffer:!1,type:ln}),this._compositeRT.texture.name="DepthOfField.Composite",this._CoCMaterial=new Tn,this._CoCBlurredMaterial=new Tn,this._blur64Material=new Tn,this._blur16Material=new Tn,this._compositeMaterial=new Tn,this._textureNode=bs(this._compositeRT.texture),this._CoCTextureNode=bs(this._CoCRT.texture),this._blur64TextureNode=bs(this._blur64RT.texture),this._blur16NearTextureNode=bs(this._blur16NearRT.texture),this._blur16FarTextureNode=bs(this._blur16FarRT.texture),this.updateBeforeType=on.FRAME}setSize(e,t){this._invSize.value.set(1/e,1/t),this._CoCRT.setSize(e,t),this._compositeRT.setSize(e,t);const n=Math.round(e/2),s=Math.round(t/2);this._CoCBlurredRT.setSize(n,s),this._blur64RT.setSize(n,s),this._blur16NearRT.setSize(n,s),this._blur16FarRT.setSize(n,s)}getTextureNode(){return this._textureNode}updateBefore(e){const{renderer:t}=e,n=this.textureNode.value;this.setSize(n.image.width,n.image.height),SB=Vs.resetRendererState(t,SB),t.setClearColor(0,0),Ds.material=this._CoCMaterial,t.setRenderTarget(this._CoCRT),Ds.name="DoF [ CoC ]",Ds.render(t),this._CoCTextureNode.value=this._CoCRT.textures[0],Ds.material=this._CoCBlurredMaterial,t.setRenderTarget(this._CoCBlurredRT),Ds.name="DoF [ CoC Blur ]",Ds.render(t),this._CoCTextureNode.value=this._CoCBlurredRT.texture,Ds.material=this._blur64Material,t.setRenderTarget(this._blur64RT),Ds.name="DoF [ Blur64 Near ]",Ds.render(t),Ds.material=this._blur16Material,t.setRenderTarget(this._blur16NearRT),Ds.name="DoF [ Blur16 Near ]",Ds.render(t),this._CoCTextureNode.value=this._CoCRT.textures[1],Ds.material=this._blur64Material,t.setRenderTarget(this._blur64RT),Ds.name="DoF [ Blur64 Far ]",Ds.render(t),Ds.material=this._blur16Material,t.setRenderTarget(this._blur16FarRT),Ds.name="DoF [ Blur16 Far ]",Ds.render(t),Ds.material=this._compositeMaterial,t.setRenderTarget(this._compositeRT),Ds.name="DoF [ Composite ]",Ds.render(t),Vs.restoreRendererState(t,SB)}setup(e){const t=this._generateKernels(),n=pH("float"),s=pH("float"),r=f_e(n,s),a=bn(()=>{const f=this.viewZNode.negate().sub(this.focusDistanceNode),m=ju(0,this.focalLengthNode,f.abs());return n.assign(fm(f,0).mul(m)),s.assign(fm(0,f).mul(m)),ns(0)});this._CoCMaterial.colorNode=a().context(e.getSharedContext()),this._CoCMaterial.outputNode=r,this._CoCMaterial.needsUpdate=!0,this._CoCBlurredMaterial.colorNode=zJ(this._CoCTextureNode,1,2),this._CoCBlurredMaterial.needsUpdate=!0;const o=Kv(t.points64),l=bn(()=>{const f=an(),m=kl(),g=this._CoCTextureNode.sample(m).r,x=this._invSize.mul(this.bokehScaleNode).mul(g);return rg(64,({i:v})=>{const y=m.add(x.mul(o.element(v))),b=this.textureNode.sample(y);f.addAssign(b.rgb)}),f.divAssign(64),ns(f,g)});this._blur64Material.fragmentNode=l().context(e.getSharedContext()),this._blur64Material.needsUpdate=!0;const c=Kv(t.points16),u=bn(()=>{const f=kl(),m=this._blur64TextureNode.sample(f).toVar(),g=m.rgb,x=m.a,v=this._invSize.mul(this.bokehScaleNode).mul(x);return rg(16,({i:y})=>{const b=f.add(v.mul(c.element(y))),S=this._blur64TextureNode.sample(b);g.assign(Rl(S.rgb,g))}),ns(g,x)});this._blur16Material.fragmentNode=u().context(e.getSharedContext()),this._blur16Material.needsUpdate=!0;const h=bn(()=>{const f=kl(),m=this._blur16NearTextureNode.sample(f),g=this._blur16FarTextureNode.sample(f),x=this.textureNode.sample(f),v=tE(m.a,.5).mul(2),y=tE(g.a,.5).mul(2),b=ns(0,0,0,1).toVar();return b.rgb=qs(x.rgb,g.rgb,y),b.rgb=qs(b.rgb,m.rgb,v),b});return this._compositeMaterial.fragmentNode=h().context(e.getSharedContext()),this._compositeMaterial.needsUpdate=!0,this._textureNode}_generateKernels(){const e=2.39996323,t=80,n=[],s=[];let r=0,a=0;for(let o=0;o<t;o++){const l=o*e,c=Math.sqrt(o)/Math.sqrt(t),u=new Ae(c*Math.cos(l),c*Math.sin(l));o%5===0?(s[a]=u,a++):(n[r]=u,r++)}return{points16:s,points64:n}}dispose(){this._CoCRT.dispose(),this._CoCBlurredRT.dispose(),this._blur64RT.dispose(),this._blur16NearRT.dispose(),this._blur16FarRT.dispose(),this._compositeRT.dispose(),this._CoCMaterial.dispose(),this._CoCBlurredMaterial.dispose(),this._blur64Material.dispose(),this._blur16Material.dispose(),this._compositeMaterial.dispose()}}const O1e=(i,e,t=1,n=1,s=1)=>ps(new P1e(Ng(i),ps(e),ps(t),ps(n),ps(s))),TB=new Aa,F1e=new Ae,G1e=[60,300,180,240,120,0],z1e=[0,.5,.25,.75];let AB;class V1e extends ti{static get type(){return"SSGINode"}constructor(e,t,n,s){super("vec4"),this.beautyNode=e,this.depthNode=t,this.normalNode=n,this.updateBeforeType=oT.FRAME,this.sliceCount=ut(1,"uint"),this.stepCount=ut(12,"uint"),this.aoIntensity=ut(1,"float"),this.giIntensity=ut(10,"float"),this.radius=ut(12,"float"),this.useScreenSpaceSampling=ut(!0,"bool"),this.expFactor=ut(2,"float"),this.thickness=ut(1,"float"),this.useLinearThickness=ut(!1,"bool"),this.backfaceLighting=ut(0,"float"),this.useTemporalFiltering=!0,this._resolution=ut(new Ae),this._halfProjScale=ut(1),this._temporalDirection=ut(0),this._temporalOffset=ut(0),this._cameraProjectionMatrix=ut(s.projectionMatrix),this._cameraProjectionMatrixInverse=ut(s.projectionMatrixInverse),this._cameraNear=nE("near","float",s),this._cameraFar=nE("far","float",s),this._camera=s,this._ssgiRenderTarget=new Si(1,1,{depthBuffer:!1}),this._ssgiRenderTarget.texture.name="SSGI",this._material=new Tn,this._material.name="SSGI",this._textureNode=op(this,this._ssgiRenderTarget.texture)}getTextureNode(){return this._textureNode}setSize(e,t){this._resolution.value.set(e,t),this._ssgiRenderTarget.setSize(e,t),this._halfProjScale.value=t/(Math.tan(this._camera.fov*Fh.DEG2RAD*.5)*2)*.5}updateBefore(e){const{renderer:t}=e;AB=Vs.resetRendererState(t,AB);const n=t.getDrawingBufferSize(F1e);if(this.setSize(n.width,n.height),this.useTemporalFiltering===!0){const s=e.frameId;this._temporalDirection.value=G1e[s%6]/360,this._temporalOffset.value=z1e[s%4]}else this._temporalDirection.value=1,this._temporalOffset.value=1;TB.material=this._material,TB.name="SSGI",t.setClearColor(0,1),t.setRenderTarget(this._ssgiRenderTarget),TB.render(t),Vs.restoreRendererState(t,AB)}setup(e){const t=kl(),n=oc(32),s=oc(0),r=f=>{const m=this.depthNode.sample(f).r;if(e.renderer.logarithmicDepthBuffer===!0){const g=LK(m,this._cameraNear,this._cameraFar);return $P(g,this._cameraNear,this._cameraFar)}return m},a=f=>this.normalNode!==null?this.normalNode.sample(f).rgb.normalize():DK(f,this.depthNode.value,this._cameraProjectionMatrixInverse),o=f=>this.beautyNode.sample(f),l=bn(([f])=>_e(.25).mul(u3(f.y,f.x).bitAnd(3))).setLayout({name:"spatialOffsets",type:"float",inputs:[{name:"position",type:"vec2"}]}),c=bn(([f])=>{const m=ro(f).mul(_e(-.156583)).add(lH);m.mulAssign(QP(ro(f).oneMinus()));const g=f.x.greaterThanEqual(0).select(m.x,mv.sub(m.x)),x=f.y.greaterThanEqual(0).select(m.y,mv.sub(m.y));return Ui(g,x)}).setLayout({name:"GTAOFastAcos",type:"vec2",inputs:[{name:"value",type:"vec2"}]}),u=bn(([f,m,g,x,v,y,b,S,T])=>{const M=this.stepCount.toConst(),C=this.expFactor.toConst(),w=this.thickness.toConst(),N=this.backfaceLighting.toConst(),E=_e(0);zo(this.useScreenSpaceSampling.equal(!0),()=>{E.assign(m.mul(this._resolution.x.div(2)).div(_e(16)))}).Else(()=>{E.assign(Rl(m.mul(this._halfProjScale).div(g.z.negate()),_e(M)))}),E.divAssign(_e(M).add(1));const B=Rl(1,_e(M.sub(1))).mul(E),U=f.equal(!0).select(Ui(1,-1),Ui(-1,1)),H=f.equal(!0).select(1,-1),F=an(0),V=an(g).toVar();return rg({start:oc(0),end:M,type:"uint",condition:"<"},({i:Y})=>{const P=rh(ro(sh(E,_e(Y).add(v)).div(B)),C).mul(B).toConst(),X=x.mul(Rl(P,_e(Y).add(1))).toConst(),J=y.add(X.mul(U)).toConst();zo(J.x.lessThanEqual(0).or(J.y.lessThanEqual(0)).or(J.x.greaterThanEqual(1)).or(J.y.greaterThanEqual(1)),()=>{Kxe()});const re=Cy(J,r(J),this._cameraProjectionMatrixInverse).toConst(),ne=re.sub(g).normalize().toConst(),ge=this.useLinearThickness.equal(!0).select(re.z.negate().div(this._cameraFar).clamp().mul(100),_e(1)),Te=Pa(re.sub(ge.mul(b).mul(w)).sub(g));let Be=Ui(li(ne,b),li(Te,b));Be=c(Xc(Be,-1,1)),Be=Xc(BK(sh(H,Be.negate()).sub(T.sub(lH)),mv)),Be=f.equal(!0).select(Be.yx,Be.xy);const et=Be.x.toConst(),wt=Be.y.toConst(),be=oc(Be.mul(_e(n))).toConst(),Re=oc(Jxe(wt.sub(et).mul(_e(n)))).toConst();let Bt=Re.greaterThan(oc(0)).select(oc(__e(oc(4294967295),oc(32).sub(n).add(n.sub(Re)))),oc(0)).toConst().shiftLeft(be);Bt=Bt.bitAnd(s.bitNot()),s.assign(s.bitOr(Bt));const ht=hH(Bt);zo(ht.greaterThan(0),()=>{const Ke=o(J);zo(Pb(Ke).greaterThan(.001),()=>{const jt=Pa(ne),Mt=Xc(li(S,jt));zo(Mt.greaterThan(.001),()=>{const Ie=a(J);let ke=li(Ie,jt.negate());const Ve=gH(ke).lessThan(0).select(ro(ke).mul(N),ro(ke));ke=N.greaterThan(0).and(li(Ie,b).greaterThan(0)).select(Ve,Xc(ke)),F.rgb.addAssign(_e(ht).div(_e(n)).mul(Ke).mul(Mt).mul(ke))})})}),V.assign(re)}),an(F)}),h=bn(()=>{const f=r(t).toVar();f.greaterThanEqual(1).discard();const m=Cy(t,f,this._cameraProjectionMatrixInverse).toVar(),g=a(t).toVar(),x=Pa(m.xyz.negate()).toVar(),v=l(mH),y=r_e(mH),b=this._temporalDirection.mul(.02),S=am(v.add(this._temporalOffset)).add(IK(t.add(b).mul(2).sub(1))),T=_e(0),M=an(0),C=this.sliceCount.toConst(),w=this.aoIntensity.toConst(),N=this.giIntensity.toConst(),E=this.radius.toConst();rg({start:oc(0),end:C,type:"uint",condition:"<"},({i:F})=>{const V=sh(_e(F).add(y).add(this._temporalDirection),mv.div(_e(C))).toConst(),Y=an(Ui(Ey(V),hc(V)),0).toConst(),P=Y.xy.mul(_e(1).div(this._resolution)).toConst(),X=Pa(Yv(Y,x)).toConst(),J=Yv(x,X).toConst(),re=g.sub(X.mul(li(g,X))).toConst(),ne=Pa(re).toConst(),ge=Xc(li(ne,x),-1,1).toConst(),Te=gH(li(re,J)).negate().mul(l3(ge)).toConst();s.assign(0),M.addAssign(u(cH(!0),E,m,P,S,t,x,g,Te)),M.addAssign(u(cH(!1),E,m,P,S,t,x,g,Te)),T.addAssign(_e(hH(s)).div(_e(n)))}),T.divAssign(_e(C)),T.assign(rh(T.clamp().oneMinus(),w).clamp()),M.divAssign(_e(C)),M.mulAssign(N);const B=_e(7).toConst(),U=Pb(M),H=U.greaterThan(B).select(B.div(U),_e(1));return M.mulAssign(H),ns(M,T)});return this._material.fragmentNode=h().context(e.getSharedContext()),this._material.needsUpdate=!0,this._textureNode}dispose(){this._ssgiRenderTarget.dispose(),this._material.dispose()}}const H1e=(i,e,t,n)=>ps(new V1e(Ng(i),e,t,n)),MB=new Aa,ck=new Ae;let EB;class k1e extends ti{static get type(){return"TRAANode"}constructor(e,t,n,s){super("vec4"),this.isTRAANode=!0,this.updateBeforeType=on.FRAME,this.beautyNode=e,this.depthNode=t,this.velocityNode=n,this.camera=s,this.depthThreshold=5e-4,this.edgeDepthDiff=.001,this.maxVelocityLength=128,this.useSubpixelCorrection=!0,this._jitterIndex=0,this._invSize=ut(new Ae),this._historyRenderTarget=new Si(1,1,{depthBuffer:!1,type:ln,depthTexture:new tr}),this._historyRenderTarget.texture.name="TRAANode.history",this._resolveRenderTarget=new Si(1,1,{depthBuffer:!1,type:ln}),this._resolveRenderTarget.texture.name="TRAANode.resolve",this._resolveMaterial=new Tn,this._resolveMaterial.name="TRAA.resolve",this._textureNode=op(this,this._resolveRenderTarget.texture),this._originalProjectionMatrix=new Lt,this._cameraNearFar=ut(new Ae),this._cameraWorldMatrix=ut(new Lt),this._cameraWorldMatrixInverse=ut(new Lt),this._cameraProjectionMatrixInverse=ut(new Lt),this._previousCameraWorldMatrix=ut(new Lt),this._previousCameraProjectionMatrixInverse=ut(new Lt),this._previousDepthNode=bs(new tr(1,1)),this._needsPostProcessingSync=!1}getTextureNode(){return this._textureNode}setSize(e,t){this._historyRenderTarget.setSize(e,t),this._resolveRenderTarget.setSize(e,t),this._invSize.value.set(1/e,1/t)}setViewOffset(e,t){this.camera.updateProjectionMatrix(),this._originalProjectionMatrix.copy(this.camera.projectionMatrix),h3.setProjectionMatrix(this._originalProjectionMatrix);const n={fullWidth:e,fullHeight:t,offsetX:0,offsetY:0,width:e,height:t},s=hk[this._jitterIndex];this.camera.setViewOffset(n.fullWidth,n.fullHeight,n.offsetX+s[0]-.5,n.offsetY+s[1]-.5,n.width,n.height)}clearViewOffset(){this.camera.clearViewOffset(),h3.setProjectionMatrix(null),this._jitterIndex++,this._jitterIndex=this._jitterIndex%(hk.length-1)}updateBefore(e){const{renderer:t}=e;this._previousCameraWorldMatrix.value.copy(this._cameraWorldMatrix.value),this._previousCameraProjectionMatrixInverse.value.copy(this._cameraProjectionMatrixInverse.value),this._cameraNearFar.value.set(this.camera.near,this.camera.far),this._cameraWorldMatrix.value.copy(this.camera.matrixWorld),this._cameraWorldMatrixInverse.value.copy(this.camera.matrixWorldInverse),this._cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse);const n=this.beautyNode.isRTTNode?this.beautyNode.renderTarget:this.beautyNode.passNode.renderTarget,s=n.texture.width,r=n.texture.height;this._needsPostProcessingSync===!0&&(this.setViewOffset(s,r),this._needsPostProcessingSync=!1),EB=Vs.resetRendererState(t,EB);const a=this._historyRenderTarget.width!==s||this._historyRenderTarget.height!==r;this.setSize(s,r),a===!0&&(t.setRenderTarget(this._historyRenderTarget),t.clear(),t.setRenderTarget(this._resolveRenderTarget),t.clear(),t.copyTextureToTexture(n.texture,this._historyRenderTarget.texture)),t.setRenderTarget(this._resolveRenderTarget),MB.material=this._resolveMaterial,MB.name="TRAA",MB.render(t),t.setRenderTarget(null),t.copyTextureToTexture(this._resolveRenderTarget.texture,this._historyRenderTarget.texture);const o=t.getDrawingBufferSize(ck);if(this._historyRenderTarget.height===o.height&&this._historyRenderTarget.width===o.width){const l=this.depthNode.value;t.copyTextureToTexture(l,this._historyRenderTarget.depthTexture),this._previousDepthNode.value=this._historyRenderTarget.depthTexture}Vs.restoreRendererState(t,EB)}setup(e){const t=e.context.postProcessing;t&&(this._needsPostProcessingSync=!0,t.context.onBeforePostProcessing=()=>{const f=e.renderer.getDrawingBufferSize(ck);this.setViewOffset(f.width,f.height)},t.context.onAfterPostProcessing=()=>{this.clearViewOffset()});const n=v_e({closestDepth:"float",closestPositionTexel:"vec2",farthestDepth:"float"}),s=bn(([f])=>{const m=_e(2).toVar(),g=Ui(0).toVar(),x=_e(-1).toVar();for(let v=-1;v<=1;++v)for(let y=-1;y<=1;++y){const b=f.add(Ui(v,y)).toVar(),S=this.depthNode.load(b).r.toVar();zo(S.lessThan(m),()=>{m.assign(S),g.assign(b)}),zo(S.greaterThan(x),()=>{x.assign(S)})}return n(m,g,x)}),r=f=>{const m=this._previousDepthNode.sample(f).r,g=Cy(f,m,this._previousCameraProjectionMatrixInverse),x=this._previousCameraWorldMatrix.mul(ns(g,1)).xyz,v=this._cameraWorldMatrixInverse.mul(ns(x,1)).z;return $P(v,this._cameraNearFar.x,this._cameraNearFar.y)},a=bn(([f,m,g,x])=>{const v=x.rgb.add(g.rgb).mul(.5),y=x.rgb.sub(g.rgb).mul(.5).add(1e-7),b=m.sub(ns(v,f.a)),T=b.xyz.div(y).abs(),M=Rl(T.x,T.y,T.z);return M.greaterThan(1).select(ns(v,f.a).add(b.div(M)),m)}).setLayout({name:"clipAABB",type:"vec4",inputs:[{name:"currentColor",type:"vec4"},{name:"historyColor",type:"vec4"},{name:"minColor",type:"vec4"},{name:"maxColor",type:"vec4"}]}),o=bn(([f,m,g,x])=>{const v=[[-1,-1],[-1,1],[1,-1],[1,1],[1,0],[0,-1],[0,1],[-1,0]],y=m.toVar(),b=m.pow2().toVar();for(const[N,E]of v){const B=this.beautyNode.offset(a_e(N,E)).load(f).max(0);y.addAssign(B),b.addAssign(B.pow2())}const S=_e(v.length+1),T=y.div(S),M=b.div(S).sub(T.pow2()).max(0).sqrt().mul(x),C=T.sub(M),w=T.add(M);return a(T.clamp(C,w),g,C,w)}),l=bn(([f,m])=>{const x=f.mul(m).fract().abs(),v=Rl(x,x.oneMinus());return v.x.mul(v.y).oneMinus().div(.75)}).setLayout({name:"subpixelCorrection",type:"float",inputs:[{name:"velocityUV",type:"vec2"},{name:"textureSize",type:"ivec2"}]}),c=bn(([f,m,g])=>{const x=g.oneMinus(),v=f.mul(_e(1).div(Rl(f.r,f.g,f.b).add(1))),y=m.mul(_e(1).div(Rl(m.r,m.g,m.b).add(1))),b=Pb(v.rgb),S=Pb(y.rgb);return g.mulAssign(_e(1).div(b.add(1))),x.mulAssign(_e(1).div(S.add(1))),eE(f.mul(g),m.mul(x)).div(Rl(g.add(x),1e-5)).toVar()}),u=bs(this._historyRenderTarget.texture),h=bn(()=>{const f=kl(),m=this.beautyNode.size(),g=f.mul(m),x=s(g),v=x.get("closestDepth"),y=x.get("closestPositionTexel"),b=x.get("farthestDepth"),S=this.velocityNode.load(y).xy.mul(Ui(.5,-.5)),T=f.sub(S),M=r(T),C=T.greaterThanEqual(0).all().and(T.lessThanEqual(1).all()),w=b.sub(v).greaterThan(this.edgeDepthDiff),N=v.sub(M).greaterThan(this.depthThreshold),E=C.and(w.or(N.not())),B=this.beautyNode.sample(f),U=u.sample(f.sub(S)),H=f.sub(T).mul(m).length().div(this.maxVelocityLength).saturate(),F=_e(.05).toVar();this.useSubpixelCorrection&&F.addAssign(l(S,m).mul(.25)),F.assign(E.select(F.add(H).saturate(),1));const V=qs(.5,1,H.oneMinus().pow2()),Y=o(g,B,U,V);return c(B,Y,F)});return this._resolveMaterial.colorNode=h(),this._textureNode}dispose(){this._historyRenderTarget.dispose(),this._resolveRenderTarget.dispose(),this._resolveMaterial.dispose()}}function uk(i,e){let t=1,n=0;for(;i>0;)t/=e,n+=t*(i%e),i=Math.floor(i/e);return n}const hk=Array.from({length:32},(i,e)=>[uk(e+1,2),uk(e+1,3)]),W1e=(i,e,t,n)=>ps(new k1e(Ng(i),e,t,n)),CB=new Aa,X1e=new Ae;let wB;class q1e extends ti{static get type(){return"EdgeChromaticAberrationNode"}constructor(e,t,n,s){super("vec4"),this.textureNode=e,this.updateBeforeType=oT.FRAME,this.strengthNode=t,this.edgeFalloffNode=n,this.centerNode=s,this._invSize=ut(new Ae),this._renderTarget=new Si(1,1,{depthBuffer:!1,type:ln}),this._renderTarget.texture.name="EdgeChromaticAberration",this._material=new Tn,this._material.name="EdgeChromaticAberration",this._textureNode=op(this,this._renderTarget.texture)}setSize(e,t){this._renderTarget.setSize(e,t),this._invSize.value.set(1/e,1/t)}updateBefore(e){const{renderer:t}=e;if(!this._material||!this._material.fragmentNode)return;wB=Vs.resetRendererState(t,wB);const n=t.getDrawingBufferSize(X1e);this.setSize(n.width,n.height),CB.material=this._material,CB.name="EdgeChromaticAberration",t.setRenderTarget(this._renderTarget),CB.render(t),Vs.restoreRendererState(t,wB)}setup(e){const t=this.textureNode,n=t.uvNode||kl(),s=bn(([o])=>am(hc(li(o,Ui(12.9898,78.233))).mul(_e(43758.5453))).sub(_e(.5)).mul(_e(2)).mul(_e(.004))).setLayout({name:"Dither",type:"float",inputs:[{name:"screenPos",type:"vec2"}]}),r=bn(([o,l,c,u,h])=>{const f=o.sub(u),m=f.length(),g=_e(1).sub(_e(1).div(_e(1).add(m.mul(c).pow(2)))),x=l.mul(g),v=f.mul(_e(1).add(x.mul(.015))),y=f,b=f.mul(_e(1).sub(x.mul(.015))),S=u.add(v),T=u.add(y),M=u.add(b),C=t.sample(S).r,w=t.sample(T).g,N=t.sample(M).b,E=t.sample(o).a,B=o.div(h),U=s(B),H=C.add(U),F=w.add(U),V=N.add(U);return ns(H,F,V,E)}).setLayout({name:"EdgeChromaticAberrationShader",type:"vec4",inputs:[{name:"uv",type:"vec2"},{name:"strength",type:"float"},{name:"edgeFalloff",type:"float"},{name:"center",type:"vec2"},{name:"invSize",type:"vec2"}]}),a=bn(()=>r(n,this.strengthNode,this.edgeFalloffNode,this.centerNode,this._invSize));return this._material.fragmentNode=a().context(e.getSharedContext()),this._material.needsUpdate=!0,this._textureNode}dispose(){this._renderTarget.dispose(),this._material.dispose()}}const j1e=(i,e=1,t=3,n=null)=>(n===null&&(n=Ui(.5,.5)),ps(new q1e(Ng(i),ps(e),ps(t),ps(n)))),RB=new Aa,Y1e=new Ae;let NB;class K1e extends ti{static get type(){return"ColorAdjustNode"}constructor(e,t,n,s,r){super("vec4"),this.textureNode=e,this.updateBeforeType=oT.FRAME,this.hueNode=t,this.saturationNode=n,this.brightnessNode=s,this.contrastNode=r,this._renderTarget=new Si(1,1,{depthBuffer:!1,type:ln}),this._renderTarget.texture.name="ColorAdjust",this._material=new Tn,this._material.name="ColorAdjust",this._textureNode=op(this,this._renderTarget.texture)}setSize(e,t){this._renderTarget.setSize(e,t)}updateBefore(e){const{renderer:t}=e;if(!this._material||!this._material.fragmentNode)return;NB=Vs.resetRendererState(t,NB);const n=t.getDrawingBufferSize(Y1e);this.setSize(n.width,n.height),RB.material=this._material,RB.name="ColorAdjust",t.setRenderTarget(this._renderTarget),RB.render(t),Vs.restoreRendererState(t,NB)}setup(e){const t=this.textureNode,n=t.uvNode||kl(),s=bn(([a,o,l,c,u])=>{const h=t.sample(a),f=h.rgb,m=an(li(f,an(.299,.587,.114)),li(f,an(.595716,-.274453,-.321263)),li(f,an(.211456,-.522591,.311135))),g=Ey(o),x=hc(o),v=an(m.x,m.y.mul(g).sub(m.z.mul(x)),m.y.mul(x).add(m.z.mul(g))),y=an(li(v,an(1,.9563,.621)),li(v,an(1,-.2721,-.6474)),li(v,an(1,-1.107,1.7046))),b=li(y,an(.2126,.7152,.0722)),M=qs(an(b),y,l).sub(an(.5)).mul(u).add(an(.5)).add(an(c)),C=IK(a.mul(Ui(137,311))).sub(_e(.5)).mul(_e(.004)),w=M.add(an(C)),N=Xc(w,an(0),an(1));return ns(N,h.a)}).setLayout({name:"ColorAdjustShader",type:"vec4",inputs:[{name:"uv",type:"vec2"},{name:"hueShift",type:"float"},{name:"saturation",type:"float"},{name:"brightness",type:"float"},{name:"contrast",type:"float"}]}),r=bn(()=>s(n,this.hueNode,this.saturationNode,this.brightnessNode,this.contrastNode));return this._material.fragmentNode=r().context(e.getSharedContext()),this._material.needsUpdate=!0,this._textureNode}dispose(){this._renderTarget.dispose(),this._material.dispose()}}const Z1e=(i,e=0,t=1,n=0,s=1)=>ps(new K1e(Ng(i),ps(e),ps(t),ps(n),ps(s))),BB=new Aa,J1e=new Ae;let DB;class Q1e extends ti{static get type(){return"LensFlareNode"}constructor(e,t={}){super("vec4");const{lensPosition:n=[.01,.01],glareSize:s=.2,starSize:r=s,starIntensity:a=1,starRayLength:o=1,starPoints:l=6,flareSize:c=.01,flareSpeed:u=.01,flareShape:h=.01,animated:f=!0,anamorphic:m=!1,colorGain:g=new Ye(20,20,20),lensDirtTexture:x=null,modTexture:v=null,haloScale:y=.5,secondaryGhosts:b=!0,aditionalStreaks:S=!0,ghostScale:T=0,opacity:M=1,starBurst:C=!1,enabled:w=!0,glareStarStrength:N=.2,glareStarOffset:E=.3,glareDistanceScale:B=16,glareDistanceBias:U=.2,flareBladePower:H=12,anamorphicBladePower:F=100,flareCenterThreshold:V=.9,flareCenterBoost:Y=3,streaksCount:P=10,streaksSizeMin:X=1,streaksSizeMax:J=2.5,streaksSizePower:re=.1,streaksDistanceMin:ne=-.3,streaksDistanceMax:ge=2.7,streaksIntensity:Te=1,mainGlowSharpness:Be=1}=t;this.textureNode=e,this.updateBeforeType=oT.FRAME,this.lensPositionNode=ut(new Ae(n[0],n[1])),this.iTimeNode=ut(0),this.iResolutionNode=ut(new Ae),this.glareSizeNode=ut(s),this.starSizeNode=ut(r),this.starIntensityNode=ut(a),this.starRayLengthNode=ut(o),this.starPointsNode=ut(l),this.flareSizeNode=ut(c),this.flareSpeedNode=ut(u),this.flareShapeNode=ut(h),this.animatedNode=ut(f),this.anamorphicNode=ut(m),this.colorGainNode=ut(g),this.haloScaleNode=ut(y),this.secondaryGhostsNode=ut(b),this.aditionalStreaksNode=ut(S),this.ghostScaleNode=ut(T),this.opacityNode=ut(M),this.starBurstNode=ut(C),this.enabledNode=ut(w),this.glareStarStrengthNode=ut(N),this.glareStarOffsetNode=ut(E),this.glareDistanceScaleNode=ut(B),this.glareDistanceBiasNode=ut(U),this.flareBladePowerNode=ut(H),this.anamorphicBladePowerNode=ut(F),this.flareCenterThresholdNode=ut(V),this.flareCenterBoostNode=ut(Y),this.streaksCountNode=ut(P),this.streaksSizeMinNode=ut(X),this.streaksSizeMaxNode=ut(J),this.streaksSizePowerNode=ut(re),this.streaksDistanceMinNode=ut(ne),this.streaksDistanceMaxNode=ut(ge),this.streaksIntensityNode=ut(Te),this.mainGlowSharpnessNode=ut(Be),this.lensDirtTextureNode=x?bs(x):null,this.modTextureNode=v?bs(v):null,this._renderTarget=new Si(1,1,{depthBuffer:!1,type:ln}),this._renderTarget.texture.name="LensFlare",this._material=new Tn,this._material.name="LensFlare",this._textureNode=op(this,this._renderTarget.texture)}setSize(e,t){this._renderTarget.setSize(e,t);const n=window.innerWidth||e,s=window.innerHeight||t;this.iResolutionNode.value.set(n,s)}setTime(e){this.iTimeNode.value=e}setLensPosition(e,t){this.lensPositionNode.value.set(e,t)}setStarSize(e){this.starSizeNode.value=e}setStarIntensity(e){this.starIntensityNode.value=e}setStarRayLength(e){this.starRayLengthNode.value=e}setOpacity(e){this.opacityNode.value=e}setEnabled(e){this.enabledNode.value=e}setModTexture(e){this.modTextureNode=e?bs(e):null}setGlareStarParams(e,t){this.glareStarStrengthNode.value=e,this.glareStarOffsetNode.value=t}setGlareFalloff(e,t){this.glareDistanceScaleNode.value=e,this.glareDistanceBiasNode.value=t}setFlareBladeParams(e,t){this.flareBladePowerNode.value=e,this.anamorphicBladePowerNode.value=t}setFlareCenterParams(e,t){this.flareCenterThresholdNode.value=e,this.flareCenterBoostNode.value=t}setStreaksParams({count:e,sizeMin:t,sizeMax:n,sizePower:s,distanceMin:r,distanceMax:a,intensity:o}){e!==void 0&&(this.streaksCountNode.value=e),t!==void 0&&(this.streaksSizeMinNode.value=t),n!==void 0&&(this.streaksSizeMaxNode.value=n),s!==void 0&&(this.streaksSizePowerNode.value=s),r!==void 0&&(this.streaksDistanceMinNode.value=r),a!==void 0&&(this.streaksDistanceMaxNode.value=a),o!==void 0&&(this.streaksIntensityNode.value=o)}setMainGlowSharpness(e){this.mainGlowSharpnessNode.value=e}updateBefore(e){const{renderer:t}=e;if(!this._material||!this._material.fragmentNode)return;this.iTimeNode&&this.animatedNode.value?this.iTimeNode.value+=e.deltaTime||.016:this.iTimeNode&&!this.animatedNode.value&&(this.iTimeNode.value=0),DB=Vs.resetRendererState(t,DB);const n=t.getDrawingBufferSize(J1e);this.setSize(n.width,n.height),BB.material=this._material,BB.name="LensFlare",t.setRenderTarget(this._renderTarget),BB.render(t),Vs.restoreRendererState(t,DB)}setup(e){const t=this.textureNode,n=t.uvNode||kl(),s=bn(([T])=>am(hc(li(T,Ui(12.9898,78.233))).mul(_e(43758.5453))).sub(_e(.5)).mul(_e(2)).mul(_e(.004))).setLayout({name:"Dither",type:"float",inputs:[{name:"screenPos",type:"vec2"}]}),r=bn(([T])=>am(hc(T).mul(43758.5453123))).setLayout({name:"randomFloat",type:"float",inputs:[{name:"seed",type:"float"}]}),a=bn(([T])=>{const M=i_e(T),C=am(T);return qs(r(M),r(M.add(1)),C)}).setLayout({name:"noise1D",type:"float",inputs:[{name:"p",type:"float"}]});bn(([T])=>{const M=ns(1,.6666666666666666,.3333333333333333,3),C=an(T.x,T.x,T.x),w=an(M.x,M.y,M.z),N=an(M.w,M.w,M.w),E=ro(am(C.add(w)).mul(6).sub(N));return T.z.mul(qs(w,Xc(E.sub(w),_e(0),_e(1)),T.y))}).setLayout({name:"hsvToRgb",type:"vec3",inputs:[{name:"hsvColor",type:"vec3"}]});const o=bn(([T])=>Xc(T,_e(0),_e(1))).setLayout({name:"saturate",type:"float",inputs:[{name:"x",type:"float"}]}),l=bn(([T,M])=>{const C=Ey(M),w=hc(M);return Ui(C.mul(T.x).add(w.mul(T.y)),C.mul(T.y).sub(w.mul(T.x)))}).setLayout({name:"rotateUV",type:"vec2",inputs:[{name:"uv",type:"vec2"},{name:"rotationAngle",type:"float"}]}),c=bn(([T,M,C,w,N,E,B,U,H,F,V,Y,P,X])=>{const re=yd(T).mul(am(C).mul(_e(.66)).add(_e(.33))),ne=_e(1).div(n_e(re)),ge=U.equal(!0).select(_e(1),B),Te=yd(T.mul(H).mul(hc(ge.mul(W2(T.x,T.y)))));let Be=rh(_e(1).sub(o(Te)),U.equal(!0).select(Y,V));return Be=Be.add(o(ne.sub(P)).mul(X)),Be=rh(Be.mul(ne),_e(8).add(_e(1).sub(M).mul(5))),an(Be).mul(F).mul(15)}).setLayout({name:"drawFlare",type:"vec3",inputs:[{name:"position",type:"vec2"},{name:"intensity",type:"float"},{name:"randomSeed",type:"float"},{name:"timeSpeed",type:"float"},{name:"flareId",type:"int"},{name:"flareSpeed",type:"float"},{name:"starPoints",type:"float"},{name:"anamorphic",type:"bool"},{name:"flareShape",type:"float"},{name:"flareSize",type:"float"},{name:"flareBladePower",type:"float"},{name:"anamorphicBladePower",type:"float"},{name:"flareCenterThreshold",type:"float"},{name:"flareCenterBoost",type:"float"}]}),u=bn(([T,M,C,w,N,E,B,U,H,F,V])=>{const Y=N.equal(!0).select(l(T.sub(M),w.mul(_e(.1))),T.sub(M)),P=W2(Y.y,Y.x).mul(E.equal(!0).select(_e(1),B));let X=yd(Y);X=rh(X,.9);const J=_e(1).div(yd(T.sub(M)).mul(_e(1).div(C).mul(U)).add(H));return J.add(J.mul(hc(P).mul(F).add(V)))}).setLayout({name:"computeGlare",type:"float",inputs:[{name:"uv",type:"vec2"},{name:"lightPos",type:"vec2"},{name:"glareSize",type:"float"},{name:"iTime",type:"float"},{name:"animated",type:"bool"},{name:"anamorphic",type:"bool"},{name:"starPoints",type:"float"},{name:"glareDistanceScale",type:"float"},{name:"glareDistanceBias",type:"float"},{name:"glareStarStrength",type:"float"},{name:"glareStarOffset",type:"float"}]}),h=bn(([T])=>{const M=ro(T),C=Ui(M.x.mul(_e(2)).mul(_e(.5773503)),M.y.add(M.x.mul(_e(.5773503)))),w=Ui(C.x,C.y),N=Ui(C.y,C.x);return li(fm(w,N),Ui(1).sub(N))}).setLayout({name:"signedDistanceHexagon",type:"float",inputs:[{name:"p",type:"vec2"}]}),f=bn(([T,M,C])=>Xc(C.sub(T).div(M.sub(T)),_e(0),_e(1))).setLayout({name:"inverseLerp",type:"float",inputs:[{name:"a",type:"float"},{name:"b",type:"float"},{name:"v",type:"float"}]}),m=bn(([T,M])=>T.lessThan(_e(.5)).select(_e(2).mul(T).mul(M),_e(1).sub(_e(2).mul(_e(1).sub(T)).mul(_e(1).sub(M))))).setLayout({name:"blendOverlayFloat",type:"float",inputs:[{name:"base",type:"float"},{name:"blend",type:"float"}]}),g=bn(([T,M])=>an(m(T.r,M.r),m(T.g,M.g),m(T.b,M.b))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),x=bn(([T,M])=>T.greaterThan(M).select(rh(T.sub(M).div(_e(1).sub(M)),2),_e(0))).setLayout({name:"falloffPower",type:"float",inputs:[{name:"x",type:"float"},{name:"threshold",type:"float"}]}),v=bn(([T,M,C,w])=>{const N=T.sub(M);return ro(N.x).lessThan(_e(.2).mul(C)).and(ro(N.y).lessThan(_e(.2).mul(C))).select(qs(an(0),qs(an(0),w,_e(.1).add(x(yd(N.div(C)),_e(.1)).mul(_e(10)))),ju(_e(0),_e(.1),h(N.mul(_e(20)).div(C)))),an(0))}).setLayout({name:"renderHexagonGhost",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"ghostPos",type:"vec2"},{name:"scale",type:"float"},{name:"color",type:"vec3"}]}),y=bn(([T,M,C,w,N])=>{const E=T.sub(M),B=yd(E);W2(E.x,E.y);let U=an(0);const H=_e(0).add(w.mul(.95)),F=B.div(H.mul(2)),V=ju(_e(0),N,F),Y=H.div(B.add(.001)).mul(_e(1).sub(V.mul(.7)));return U=U.add(an(Y)),U}).setLayout({name:"computeSimpleLensFlare",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"lightPos",type:"vec2"},{name:"iTime",type:"float"},{name:"glareSize",type:"float"},{name:"mainGlowSharpness",type:"float"}]}),b=bn(([T,M])=>{const C=T.sub(_e(.5)),w=Ui(C.x,C.y.mul(this.iResolutionNode.y.div(this.iResolutionNode.x))),N=this.lensPositionNode.mul(_e(.5)),E=Ui(N.x,N.y.mul(this.iResolutionNode.y.div(this.iResolutionNode.x)));let B=y(w,E,this.iTimeNode,this.glareSizeNode,this.mainGlowSharpnessNode).mul(this.colorGainNode).div(_e(25));const U=this.glareDistanceScaleNode.div(Rl(_e(.001),this.starRayLengthNode)),H=an(u(w,E,this.starSizeNode,this.iTimeNode,this.animatedNode,this.anamorphicNode,this.starPointsNode,U,this.glareDistanceBiasNode,this.glareStarStrengthNode,this.glareStarOffsetNode)),F=w.sub(E),V=l(F,this.iTimeNode.mul(_e(.1))),Y=l(F,_e(1.570796)),P=this.anamorphicNode.equal(!0).select(Y,F),X=this.animatedNode.equal(!0).select(V,P),J=c(X,_e(1),_e(.1),this.iTimeNode,1,this.flareSpeedNode,this.starPointsNode,this.anamorphicNode,this.flareShapeNode,this.flareSizeNode,this.flareBladePowerNode,this.anamorphicBladePowerNode,this.flareCenterThresholdNode,this.flareCenterBoostNode);B=B.add(H.add(J).mul(this.starIntensityNode).mul(this.colorGainNode).div(_e(25)));let re=an(0);if(this.modTextureNode){const Re=Ui(this.iResolutionNode.x.div(this.iResolutionNode.y),_e(1)),tt=yd(this.lensPositionNode.mul(Re)),Bt=qs(_e(.85),_e(.5),ju(_e(0),_e(2),tt)),ht=this.lensPositionNode.mul(_e(.5)),Ke=T.sub(ht).sub(_e(.5)).mul(_e(.5)).mul(Re),jt=_e(.0125),Mt=this.iTimeNode.mul(jt),Ie=this.iTimeNode.mul(jt).negate().add(_e(3.14159)),ke=Ey(Mt),Ve=hc(Mt),at=Ey(Ie),Z=hc(Ie),zt=Ui(ke.mul(Ke.x).sub(Ve.mul(Ke.y)),Ve.mul(Ke.x).add(ke.mul(Ke.y))).mul(Bt).add(_e(.5)),st=Ui(at.mul(Ke.x).sub(Z.mul(Ke.y)),Z.mul(Ke.x).add(at.mul(Ke.y))).mul(Bt).add(_e(.5)),Vt=this.modTextureNode.sample(zt).rgb,Je=this.modTextureNode.sample(st).rgb,K=g(Vt,Je),I=ju(_e(-1.5),_e(-1),this.lensPositionNode.x).mul(ju(_e(-1.5),_e(-1),this.lensPositionNode.y)).mul(ju(_e(1.5),_e(1),this.lensPositionNode.x)).mul(ju(_e(1.5),_e(1),this.lensPositionNode.y)),ue=C.mul(this.iResolutionNode),Ne=this.lensPositionNode.mul(_e(.5)).mul(this.iResolutionNode),ze=_e(4),we=tt.greaterThan(_e(.001)).select(Pa(this.lensPositionNode),this.lensPositionNode),Ut=yd(ue.sub(Ne.add(we.mul(ze)))),dt=Pa(C.mul(_e(2)).sub(this.lensPositionNode)),Pt=ro(li(we,dt)),Qt=rh(Pt,_e(16)),Xe=_e(50),Qe=qs(_e(8.5),_e(10),a(Ut.mul(_e(.01)).add(li(this.lensPositionNode,this.lensPositionNode)))),Et=l_e(Ut,Xe.mul(Qe)).sub(Xe.mul(Qe).mul(_e(.5))),ee=f(Xe.mul(_e(5)),_e(0),ro(Et)),me=qs(_e(.025),_e(.1),f(_e(0),_e(.5),tt)),Me=an(0,1,0),Q=an(1,0,0),pe=an(1,1,0),He=qs(Me,pe,f(Xe.negate(),_e(0),Et));re=qs(He,Q,f(_e(0),Xe,Et)).mul(ee).mul(K).mul(tE(_e(1),Xe.div(ro(Et)))).mul(Qt).mul(me).mul(I)}B=B.add(re.mul(this.starBurstNode.equal(!0).select(_e(1),_e(0))));let ne=an(0);ne=ne.add(v(w,this.lensPositionNode.mul(_e(-.25)),this.ghostScaleNode.mul(_e(1.4)),an(.25,.25,.5))),ne=ne.add(v(w,this.lensPositionNode.mul(_e(.25)),this.ghostScaleNode.mul(_e(.5)),an(1,.5,.5))),ne=ne.add(v(w,this.lensPositionNode.mul(_e(.12)),this.ghostScaleNode.mul(_e(1.6)),an(1))),ne=ne.add(v(w,this.lensPositionNode.mul(_e(.69)),this.ghostScaleNode.mul(_e(.6)),an(0,.5,.75))),ne=ne.add(v(w,this.lensPositionNode.mul(_e(.6)),this.ghostScaleNode.mul(_e(.3)),an(.5,.5,.5))),B=B.add(ne.mul(this.secondaryGhostsNode.equal(!0).select(_e(1),_e(0))));let Te=qs(B,an(0),this.opacityNode).add(M.rgb);const Be=T.mul(this.iResolutionNode),et=s(Be),wt=Te.add(an(et));return this.enabledNode.equal(!0).select(ns(wt,M.a),M)}).setLayout({name:"LensFlareShader",type:"vec4",inputs:[{name:"uv",type:"vec2"},{name:"inputColor",type:"vec4"}]}),S=bn(()=>{const T=t.sample(n);return b(n,T)});return this._material.fragmentNode=S().context(e.getSharedContext()),this._material.needsUpdate=!0,this._textureNode}dispose(){this._renderTarget.dispose(),this._material.dispose()}}const $1e=(i,e={})=>ps(new Q1e(Ng(i),e));function eAe(){const{postProcessingEnabled:i,sunPositionForLensFlare:e}=qi(Oe);qi(Oe);const{gl:t,scene:n,camera:s,size:r,invalidate:a}=ts(),o=lx("/lens-mod.png");o.generateMipmaps=!1,o.wrapS=ui,o.wrapT=ui,o.minFilter=Jt,o.magFilter=Jt,o.flipY=!1;const l=$.useRef(ut(new Ye("#ffffff"))).current,c=$.useMemo(()=>new z,[]),u=$.useRef(0);$.useRef(null);const h=$.useRef(ut(500)).current,f=$.useRef(ut(200)).current,m=$.useRef(ut(10)).current,[g]=$.useState(()=>new vK(t)),x=$.useRef(ut(i?0:1)),v=$.useRef(0),y=$.useRef({scenePass:null,scenePassColor:null,compositePass:null,bloomPass:null,aoPass:null,colorAdjustParams:null,lensFlareNode:null}),b=$.useRef(null),S=$.useRef(null);$.useLayoutEffect(()=>{if(!n||!s){console.warn("Effects: Scene or camera not ready, skipping setup");return}try{const T=p_e(n,s,{minFilter:Jt,magFilter:Jt,generateMipmaps:!1});T.setMRT(c_e({output:d_e,diffuse:$xe,normal:e_e(u_e),velocity:h3}));const M=T.getTextureNode("output"),C=T.getTextureNode("diffuse"),w=T.getTextureNode("depth"),N=T.getTextureNode("normal"),E=T.getTextureNode("velocity"),B=ut(1.5);if(!M||!C||!w||!N||!E){console.error("Effects: Failed to create scene pass texture nodes");return}const U=T.getTexture("diffuse");U&&(U.type=ei);const H=T.getTexture("normal");H&&(H.type=ei);const F=y_e(Vt=>Qxe(N.sample(Vt))),V=H1e(M.rgb,w,F,s);V.sliceCount.value=2,V.stepCount.value=4,V.radius.value=12,V.giIntensity.value=6,V.aoIntensity.value=0,V.useTemporalFiltering=!1,V.thickness.value=.2,V.resolutionScale=.5,V.useScreenSpaceSampling.value=!0,V.useLinearThickness.value=!1,V.backfaceLighting.value=.02;const Y=U1e(M,.055,1,.4),P=ut(.95),J=zJ(V.rgb,P,16),re=V.a,ne=R1e(w,F,s);ne.radius=.1,ne.scale=1,ne.resolutionScale=1,ne.distanceFallOff.value=.8,ne.thickness=5;const ge=ne.getTextureNode();if(!ge){console.error("Effects: Failed to create AO texture node");return}const Te=ut(-.1),Be=ut(1.1),et=ut(.03),wt=ut(1),be={AgX:vx,ACES:pg,Neutral:bx,Reinhard:xx,Cineon:_x,Linear:yx,None:Ki},Re=Object.keys(be),tt="Neutral",Bt=M.rgb.add(J).mul(ge.r).add(Y.rgb),ht=$1e(Bt,{lensPosition:[0,0],glareSize:1.5,starRayLength:.1,mainGlowSharpness:.01,starPoints:16,starIntensity:10,starSize:.9,colorGain:l,modTexture:o,secondaryGhosts:!0,ghostScale:.3,starBurst:!0,enabled:!0,opacity:0}),Ke={toneMappingExposure:B,focusDistance:ut(0),focalLength:ut(150),bokehScale:ut(6),hue:Te,saturation:Be,brightness:et,contrast:wt,toneMappingMode:tt},jt=t==null?void 0:t.inspector;if(jt&&typeof jt.createParameters=="function"){const Vt=b.current&&b.current.inspector===jt?b.current.group:null,Je=Vt||jt.createParameters("Post-Processing");if(!S.current){const K=Je.add({enabled:i},"enabled").name("enable effects");K.onChange(I=>{Oe.postProcessingEnabled=I}),K.listen(),S.current=K}if(!Vt){Je.add(Ke.toneMappingExposure,"value",.1,5).name("tone exposure"),Je.add(Ke.focusDistance,"value",0,3e3).name("focus distance"),Je.add(Ke.focalLength,"value",0,750).name("focal length"),Je.add(Ke.bokehScale,"value",6,20).name("bokeh scale");const K=Je.add(Ke,"toneMappingMode",Re).name("tone mapping");K.onChange(I=>{var Ne;const ue=be[I];(Ne=y.current.toneMappingParams)!=null&&Ne.node&&(y.current.toneMappingParams.node.setToneMapping(ue),y.current.toneMappingParams.mode=I,g.needsUpdate=!0,v.current=Math.max(v.current,3),a())}),K.listen(),Je.add(Ke.hue,"value",-Math.PI,Math.PI).name("hue offset"),Je.add(Ke.saturation,"value",.5,1.5).name("saturation"),Je.add(Ke.brightness,"value",-.2,.2).name("brightness"),Je.add(Ke.contrast,"value",.5,2).name("contrast"),b.current={inspector:jt,group:Je}}}else b.current||console.warn("Effects: Inspector parameters tab unavailable");const Mt=T.getViewZNode(),Ie=O1e(ht,Mt,Ke.focusDistance,Ke.focalLength,Ke.bokehScale),ke=ns(Ie.r,Ie.g,Ie.b,Ie.a),Ve=qs(ke,T,x.current),at=W1e(Ve,w,E,s),Z=Z1e(at,Ke.hue,Ke.saturation,Ke.brightness,Ke.contrast),st=j1e(Z,2.5,.8).toneMapping(be[tt],B);y.current={scenePass:T,scenePassColor:M,compositePass:ke,bloomPass:Y,aoPass:ne,colorAdjustParams:{hueUniform:Ke.hue,saturationUniform:Ke.saturation,brightnessUniform:Ke.brightness,contrastUniform:Ke.contrast},toneMappingParams:{exposure:B,mode:Ke.toneMappingMode,node:st},dofParams:{focusDistance:h,focalLength:f,bokehScale:m},lensFlareNode:ht},g.outputNode=st,g.needsUpdate=!0}catch(T){console.error("Effects: Error setting up post-processing:",T);try{g.outputNode=bs(n),g.needsUpdate=!0}catch(M){console.error("Effects: Fallback setup also failed:",M)}}},[n,s]),$.useEffect(()=>{x.current.value=i?0:1,v.current=5,a(),S.current&&S.current.object&&(S.current.object.enabled=i,S.current.updateDisplay())},[i,a]),$.useEffect(()=>{s&&(s.aspect=r.width/r.height,s.updateProjectionMatrix()),g.needsUpdate=!0,v.current=10,a()},[r.width,r.height,s,g,a]),yu((T,M)=>{var U;const[C,w,N]=Oe.sunPositionForLensFlare;if(c.set(C,w,N),c.project(s),(U=y.current)!=null&&U.lensFlareNode){const H=y.current.lensFlareNode;if(c.z<=1){const V=c.x,Y=-c.y;H.setLensPosition(V,Y)}else H.setLensPosition(10,10);const F=c.z<=1&&Oe.sunOccluded?1:0;u.current=Fh.damp(u.current,F,80,M),typeof H.setOpacity=="function"&&H.setOpacity(u.current)}const E=Oe.timeOfDay;let B;if(E>=5&&E<8)B=new Ye("#cab8b5");else if(E>=8&&E<12){const H=(E-8)/4,F=new Ye("#cab8b5"),V=new Ye("#cab8b5");B=F.lerp(V,H)}else if(E>=12&&E<19){const H=(E-12)/5,F=new Ye("#ded6d1"),V=new Ye("#ffe2d1");B=F.lerp(V,H)}else if(E>=19&&E<=21){const H=(E-17)/4,F=new Ye("#ffb489"),V=new Ye("#ff9673");B=F.lerp(V,H)}else B=new Ye("#ffffff");l.value.copy(B)},0),yu(()=>{const T=t==null?void 0:t.inspector;let M=!1;if(T&&typeof T.begin=="function"&&(T.begin(),M=!0),g&&g.outputNode)try{g.render()}catch(C){console.error("Effects: Render error:",C)}M&&typeof T.finish=="function"&&T.finish(),v.current>0&&(v.current--,a())},1)}function tAe(){const{progress:i}=VSe(),{finishedLoadingAsset:e,finishedIntro:t}=qi(Oe),[n,s]=$.useState(!1),r=$.useRef(),a=$.useRef();return $.useEffect(()=>(r&&r.current&&document.documentElement.style.setProperty("--progress",Math.floor(i)),i===100&&(a.current=setTimeout(()=>{Oe.finishedLoadingAsset=!0,Oe.entered=!0},500)),()=>{a.current&&clearTimeout(a.current)}),[i]),G.jsx(G.Fragment,{children:!t&&G.jsx("div",{className:`loader-wrapper ${e?"finished-loading":""}`,children:G.jsx("div",{className:"main-loader",ref:r,children:G.jsxs("svg",{width:"100",height:"100",className:"circular-progress",viewBox:"0 0 100 100",opacity:n?0:1,children:[G.jsx("circle",{cy:50,cx:50,r:46,className:"bg"}),G.jsx("circle",{cy:50,cx:50,r:46,className:"fg"})]})})})})}class nAe extends ZS{constructor(e){super(e),this.type=ln}parse(e){const a=function(N,E){switch(N){case 1:throw new Error("THREE.HDRLoader: Read Error: "+(E||""));case 2:throw new Error("THREE.HDRLoader: Write Error: "+(E||""));case 3:throw new Error("THREE.HDRLoader: Bad File Format: "+(E||""));default:case 4:throw new Error("THREE.HDRLoader: Memory Error: "+(E||""))}},u=`
`,h=function(N,E,B){E=E||1024;let H=N.pos,F=-1,V=0,Y="",P=String.fromCharCode.apply(null,new Uint16Array(N.subarray(H,H+128)));for(;0>(F=P.indexOf(u))&&V<E&&H<N.byteLength;)Y+=P,V+=P.length,H+=128,P+=String.fromCharCode.apply(null,new Uint16Array(N.subarray(H,H+128)));return-1<F?(N.pos+=V+F+1,Y+P.slice(0,F)):!1},f=function(N){const E=/^#\?(\S+)/,B=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,U=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,H=/^\s*FORMAT=(\S+)\s*$/,F=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,V={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Y,P;for((N.pos>=N.byteLength||!(Y=h(N)))&&a(1,"no header found"),(P=Y.match(E))||a(3,"bad initial token"),V.valid|=1,V.programtype=P[1],V.string+=Y+`
`;Y=h(N),Y!==!1;){if(V.string+=Y+`
`,Y.charAt(0)==="#"){V.comments+=Y+`
`;continue}if((P=Y.match(B))&&(V.gamma=parseFloat(P[1])),(P=Y.match(U))&&(V.exposure=parseFloat(P[1])),(P=Y.match(H))&&(V.valid|=2,V.format=P[1]),(P=Y.match(F))&&(V.valid|=4,V.height=parseInt(P[1],10),V.width=parseInt(P[2],10)),V.valid&2&&V.valid&4)break}return V.valid&2||a(3,"missing format specifier"),V.valid&4||a(3,"missing image size specifier"),V},m=function(N,E,B){const U=E;if(U<8||U>32767||N[0]!==2||N[1]!==2||N[2]&128)return new Uint8Array(N);U!==(N[2]<<8|N[3])&&a(3,"wrong scanline width");const H=new Uint8Array(4*E*B);H.length||a(4,"unable to allocate buffer space");let F=0,V=0;const Y=4*U,P=new Uint8Array(4),X=new Uint8Array(Y);let J=B;for(;J>0&&V<N.byteLength;){V+4>N.byteLength&&a(1),P[0]=N[V++],P[1]=N[V++],P[2]=N[V++],P[3]=N[V++],(P[0]!=2||P[1]!=2||(P[2]<<8|P[3])!=U)&&a(3,"bad rgbe scanline format");let re=0,ne;for(;re<Y&&V<N.byteLength;){ne=N[V++];const Te=ne>128;if(Te&&(ne-=128),(ne===0||re+ne>Y)&&a(3,"bad scanline data"),Te){const Be=N[V++];for(let et=0;et<ne;et++)X[re++]=Be}else X.set(N.subarray(V,V+ne),re),re+=ne,V+=ne}const ge=U;for(let Te=0;Te<ge;Te++){let Be=0;H[F]=X[Te+Be],Be+=U,H[F+1]=X[Te+Be],Be+=U,H[F+2]=X[Te+Be],Be+=U,H[F+3]=X[Te+Be],F+=4}J--}return H},g=function(N,E,B,U){const H=N[E+3],F=Math.pow(2,H-128)/255;B[U+0]=N[E+0]*F,B[U+1]=N[E+1]*F,B[U+2]=N[E+2]*F,B[U+3]=1},x=function(N,E,B,U){const H=N[E+3],F=Math.pow(2,H-128)/255;B[U+0]=Ll.toHalfFloat(Math.min(N[E+0]*F,65504)),B[U+1]=Ll.toHalfFloat(Math.min(N[E+1]*F,65504)),B[U+2]=Ll.toHalfFloat(Math.min(N[E+2]*F,65504)),B[U+3]=Ll.toHalfFloat(1)},v=new Uint8Array(e);v.pos=0;const y=f(v),b=y.width,S=y.height,T=m(v.subarray(v.pos),b,S);let M,C,w;switch(this.type){case Rn:w=T.length/4;const N=new Float32Array(w*4);for(let B=0;B<w;B++)g(T,B*4,N,B*4);M=N,C=Rn;break;case ln:w=T.length/4;const E=new Uint16Array(w*4);for(let B=0;B<w;B++)x(T,B*4,E,B*4);M=E,C=ln;break;default:throw new Error("THREE.HDRLoader: Unsupported type: "+this.type)}return{width:b,height:S,data:M,header:y.string,gamma:y.gamma,exposure:y.exposure,type:C}}setDataType(e){return this.type=e,this}load(e,t,n,s){function r(a,o){switch(a.type){case Rn:case ln:a.colorSpace=Jr,a.minFilter=Jt,a.magFilter=Jt,a.generateMipmaps=!1,a.flipY=!0;break}t&&t(a,o)}return super.load(e,r,n,s)}}class iAe extends Kn{constructor(e,{height:t=15,radius:n=100,geometryDetail:s=16,cubeUVParams:r,intensity:a=.6}={}){const o=new Dx(1,s),l=new gP;l.side=hi,l.depthWrite=!1,l.toneMapped=!1,l.fog=!0,super(o,l),this.isGroundProjectedEnvMesh=!0,this._mapNode=bs(e),this._radiusNode=ut(n),this._heightNode=ut(t),this._intensityNode=ut(a);const c=(e==null?void 0:e.isCubeTexture)===!0,u=c?this._setupCubeUVParams(e,r):null;this._assignMaterialNodes({isCubeTexture:c,cubeUV:u}),this.frustumCulled=!1,this.renderOrder=-1}_setupCubeUVParams(e,t){const n=t??this._computeCubeUVParams(e);return{texelWidth:ut(n.texelWidth),texelHeight:ut(n.texelHeight),maxMip:ut(n.maxMip)}}_computeCubeUVParams(e){var o;const t=e==null?void 0:e.image,s=(Array.isArray(t)?((o=t[0])==null?void 0:o.width)??1024:(t==null?void 0:t.width)??1024)/4,r=Math.floor(Math.log2(s)),a=Math.pow(2,r);return{texelWidth:1/(3*Math.max(a,16*7)),texelHeight:1/(4*a),maxMip:r}}_assignMaterialNodes({isCubeTexture:e,cubeUV:t}){const n=this.material,s=this._radiusNode,r=this._heightNode,a=this._mapNode,o=bn(([u,h,f,m,g])=>{const x=_e(1e6).toVar(),v=li(h,m).toVar(),y=x.toVar();return zo(v.lessThan(_e(0)),()=>{const b=u.sub(f).toVar(),S=li(m,b).negate().div(v).toVar(),T=b.add(h.mul(S)).toVar();zo(li(T,T).lessThan(g.mul(g)),()=>{y.assign(S)})}),y}),l=bn(([u,h,f,m])=>{const g=u.sub(f).toVar(),x=li(g,h).toVar(),v=li(g,g).sub(m.mul(m)).toVar(),y=x.mul(x).sub(v).toVar(),b=_e(-1).toVar();return zo(y.greaterThanEqual(_e(0)),()=>{const S=QP(y).toVar();b.assign(x.negate().add(S))}),b}),c=bn(()=>{const u=Pa(UK).toVar(),h=Zxe.sub(an(0,r,0)).toVar(),f=l(h,u,an(0),s).toVar();return zo(f.greaterThan(_e(0)),()=>{const m=an(0,r.negate(),0).toVar(),g=an(0,1,0),x=o(h,u,m,g,s).toVar(),v=tE(f,x).toVar(),y=h.add(u.mul(v)).div(s).toVar();u.assign(y)}).Else(()=>{u.assign(an(0,1,0))}),u});n.colorNode=bn(()=>{const u=c(),h=this._intensityNode;let f;if(e)f=b_e(a,u,_e(0),t.texelWidth,t.texelHeight,t.maxMip).rgb;else{const m=Pa(u),g=t_e(m);f=a.sample(g).rgb}return sh(f,h)})(),n.needsUpdate=!0}set map(e){if(this._mapNode.value!==e){this._mapNode.value=e;const t=(e==null?void 0:e.isCubeTexture)===!0,n=t?this._setupCubeUVParams(e):null;this._assignMaterialNodes({isCubeTexture:t,cubeUV:n})}}get map(){return this._mapNode.value}set radius(e){this._radiusNode.value!==e&&(this._radiusNode.value=e,this.material.needsUpdate=!0)}get radius(){return this._radiusNode.value}set height(e){this._heightNode.value!==e&&(this._heightNode.value=e,this.material.needsUpdate=!0)}get height(){return this._heightNode.value}set intensity(e){this._intensityNode.value!==e&&(this._intensityNode.value=e,this.material.needsUpdate=!0)}get intensity(){return this._intensityNode.value}}function sAe({map:i=null,files:e=null,path:t=void 0,background:n=!1,environment:s=!0,backgroundIntensity:r=1,environmentIntensity:a=1,backgroundRotation:o=[0,0,0],environmentRotation:l=[0,0,0],ground:c={radius:100,height:15,scale:1e3,followCamera:!0,rotation:[0,0,0]},onLoad:u=void 0,onError:h=void 0}){const{scene:f,camera:m,invalidate:g}=ts(),x=f,v=$.useRef(null),y=$.useRef(null),[b,S]=$.useState(()=>i??null);$.useEffect(()=>{if(v.current)return;const w=new nAe;t&&w.setPath(t),v.current=w},[t]),$.useEffect(()=>{let w=!0;async function N(){if(i){y.current&&(y.current.dispose(),y.current=null),S(i),u==null||u(i);return}if(!e||!v.current){y.current&&(y.current.dispose(),y.current=null),S(null);return}try{const E=Array.isArray(e)?e:[e],U=(await Promise.all(E.map(H=>new Promise((F,V)=>{v.current.load(H,Y=>F(Y),void 0,Y=>V(Y))}))))[0];if(U.mapping=_c,U.colorSpace=Jr,U.needsUpdate=!0,!w){U.dispose();return}y.current&&y.current.dispose(),y.current=U,S(U),u==null||u(U)}catch(E){console.error("GroundEnvironment: Failed to load environment map.",E),h==null||h(E),y.current&&(y.current.dispose(),y.current=null),S(null)}}return N(),()=>{w=!1}},[e,i,h,u]),$.useEffect(()=>()=>{y.current&&(y.current.dispose(),y.current=null)},[]);const T=$.useMemo(()=>c?c===!0?{radius:100,height:15,scale:1e3,followCamera:!0}:{radius:c.radius??100,height:c.height??15,scale:c.scale??1e3,followCamera:c.followCamera??!0,rotation:c.rotation??[0,0,0]}:null,[c]),M=$.useMemo(()=>!b||!T?null:new iAe(b,{radius:T.radius,height:T.height,rotation:T.rotation,intensity:r}),[b,T,r,o]);$.useEffect(()=>{M&&M.rotation.set(o[0],o[1],o[2])},[o]);const C=$.useRef(null);return $.useEffect(()=>{var N,E,B,U;if(!b)return;const w=x;return C.current={environment:w.environment??null,background:w.background??null,environmentIntensity:w.environmentIntensity??1,backgroundIntensity:w.backgroundIntensity??1,backgroundRotation:w.backgroundRotation?(E=(N=w.backgroundRotation).clone)==null?void 0:E.call(N):null,environmentRotation:w.environmentRotation?(U=(B=w.environmentRotation).clone)==null?void 0:U.call(B):null},s&&(w.environment=b,w.environmentIntensity=a),n&&(w.background=b,w.backgroundIntensity=r),Array.isArray(l)&&(w.environmentRotation=new Lr().fromArray(l)),Array.isArray(o)&&(w.backgroundRotation=new Lr().fromArray(o)),g&&g(),()=>{if(!C.current)return;const H=C.current;w.environment=H.environment,w.background=H.background,w.environmentIntensity=H.environmentIntensity,w.backgroundIntensity=H.backgroundIntensity,w.environmentRotation=H.environmentRotation,w.backgroundRotation=H.backgroundRotation,g&&g()}},[n,r,o,b,s,a,l,g,x]),$.useEffect(()=>{M&&b&&(M.map=b)},[M,b]),$.useEffect(()=>{!M||!T||(M.radius=T.radius,M.height=T.height,M.scale.setScalar(T.scale),M.position.y=T.height)},[M,T]),yu(()=>{!M||!T||T.followCamera&&M.position.set(m.position.x,M.position.y,m.position.z)}),$.useEffect(()=>()=>{var w,N;M&&((w=M.geometry)==null||w.dispose(),(N=M.material)==null||N.dispose())},[M]),b&&M?G.jsx("primitive",{object:M}):null}function rAe(){const i=$.useRef(),{gl:e}=ts(),t=qi(Oe),{isMobile:n}=qi(Oe),s=$.useCallback(()=>{i.current&&(e.shadowMap.autoUpdate=!1,e.shadowMap.needsUpdate=!0)},[i.current,e]);$.useEffect(()=>{t.treesLoaded&&i.current&&s()},[t.treesLoaded,e]);const r=$.useMemo(()=>{const a=t.timeOfDay,o=t.lightRotation,c=((a-5)/16-.5)*Math.PI,u=o*Math.PI/180,h=50,f=Math.sin(c)*h,m=2,g=f*Math.cos(u)-m*Math.sin(u),x=Math.max(Math.cos(c)*h,5),v=f*Math.sin(u)+m*Math.cos(u);Oe.sunPosition3D=[g,x,v];const y=850,b=Math.sin(c)*y,S=2,T=b*Math.cos(u)-S*Math.sin(u),M=Math.cos(c)*y-230,C=b*Math.sin(u)+S*Math.cos(u);Oe.sunPositionForLensFlare=[T,M,C];let w="#eed0c2",N=8;if(a>=5&&a<6.5){const V=(a-5)/1.5,Y=new Ye("#fbcbb5"),P=new Ye("#fec5aa");w=Y.lerp(P,V).getStyle(),N=3+V*6}else if(a>=6.5&&a<8){const V=(a-6.5)/1.5,Y=new Ye("#ffb795"),P=new Ye("#eed0c2");w=Y.lerp(P,V).getStyle(),N=8+V*3}else if(a>=8&&a<10)w="#eed0c2",N=8;else if(a>=10&&a<15)w="#eed0c2",N=6;else if(a>=15&&a<18.5)w="#d8915d",N=10;else if(a>=16.5&&a<=21){const V=(a-19.5)/2.5,Y=new Ye("#ff9673"),P=new Ye("#2a1a0a");w=Y.lerp(P,V).getStyle(),N=7-V*15}Oe.sunColor=w;let E=.2;a>=5&&a<6.5?E=.05+(a-5)/1.5*.1:a>=6.5&&a<8?E=.15+(a-6.5)/1.5*.2:a>=8&&a<11?E=.35+(a-8)/3*.25:a>=11&&a<15?E=.6+(a-11)/4*.3:a>=15&&a<17?E=.9-(a-15)/2*.2:a>=17&&a<18.5?E=.7-(a-17)/1.5*.3:a>=18.5&&a<=21&&(E=.15-(a-18.5)/2.5*.35);const B=3,F=(1-Math.min(Math.max((N-B)/(12-B),0),1))*10;return{position:[g,x,v],color:w,intensity:N,backgroundIntensity:E,spotLightIntensity:F,hour:a}},[t.timeOfDay,t.lightRotation]);return G.jsxs(G.Fragment,{children:[G.jsx("color",{attach:"background",args:["#89a0c6"]}),G.jsx("directionalLight",{ref:i,castShadow:!0,position:r.position,color:r.color,intensity:r.intensity,"shadow-mapSize":n?1024:2048,"shadow-camera-near":30,"shadow-camera-far":80,"shadow-camera-left":-25,"shadow-camera-right":25,"shadow-camera-top":25,"shadow-camera-bottom":-25,"shadow-bias":-.001,"shadow-normalBias":.05}),G.jsx("ambientLight",{intensity:.5,color:"#eed0c2"}),G.jsx($.Suspense,{fallback:null,children:G.jsx(sAe,{files:"/envmap.hdr",backgroundIntensity:r.backgroundIntensity*1.5,environmentIntensity:r.backgroundIntensity*.9,environmentRotation:[0,-1.3+r.hour*.01,0],backgroundRotation:[0,r.hour*.1,0],ground:{radius:500,height:17,scale:500,followCamera:!0}})})]})}function aAe(){const i=qi(Oe),e=$.useRef(null),[t,n]=$.useState(!1),[s,r]=$.useState(null),[a,o]=$.useState(!1),l=$.useRef(null),c=i.openedPanel==="time-of-day",u=()=>{Oe.openedPanel=null},h=()=>{Oe.isManipulatingSlider=!0,e.current&&clearTimeout(e.current)},f=()=>{e.current=setTimeout(()=>{Oe.isManipulatingSlider=!1},200)},m=C=>{const w=parseFloat(C.target.value);Oe.timeOfDay=w,h(),f()},g=C=>{const w=parseFloat(C.target.value);Oe.lightRotation=w,h(),f()};$.useEffect(()=>()=>{e.current&&clearTimeout(e.current),Oe.isManipulatingSlider=!1},[]);const x=C=>{const w=Math.floor(C),N=Math.round((C-w)*60),E=w>=12?"PM":"AM";return{time:`${w>12?w-12:w===0?12:w}:${N.toString().padStart(2,"0")}`,period:E}},v=C=>C>=5&&C<7?"Dawn":C>=7&&C<12?"Morning":C>=12&&C<17?"Brunch":C>=17&&C<19?"Golden":C>=19&&C<21?"Dusk":"Evening",{time:y,period:b}=x(i.timeOfDay);v(i.timeOfDay);const S=[{name:"Dawn",time:6.5,rotation:270},{name:"Golden",time:7.65,rotation:280},{name:"Morning",time:9.45,rotation:290},{name:"Brunch",time:12.2,rotation:295},{name:"Dusk",time:19,rotation:-90}];$.useEffect(()=>{const C=w=>{l.current&&!l.current.contains(w.target)&&n(!1)};return t&&document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[t]);const T=()=>{n(!t)},M=C=>{r(C.name),n(!1);const w={time:Oe.timeOfDay,rotation:Oe.lightRotation};uT.to(w,{time:C.time,rotation:C.rotation,duration:1.5,ease:"power2.inOut",onStart:()=>{o(!0)},onUpdate:()=>{Oe.timeOfDay=w.time,Oe.lightRotation=w.rotation},onComplete:()=>{o(!1)}})};return G.jsx(G.Fragment,{children:c&&G.jsx(G.Fragment,{children:G.jsxs("div",{className:"time-of-day-wrapper",style:{pointerEvents:a?"none":"auto"},children:[G.jsx("button",{className:"close-button-time",onClick:u,children:G.jsx("svg",{viewBox:"0 0 24 24",children:G.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})}),G.jsxs("div",{className:"time-of-day-panel",children:[G.jsxs("div",{className:"time-of-day-header",children:[G.jsxs("div",{className:"time-display",children:[y," ",G.jsx("span",{style:{marginLeft:"-5px",fontSize:"10px"},children:b})]}),G.jsx("div",{className:"presets-container",children:G.jsxs("div",{className:"custom-dropdown",ref:l,children:[G.jsxs("div",{className:"dropdown-header",onClick:T,children:[G.jsx("span",{children:s||"PRESET"}),G.jsx("svg",{className:`dropdown-arrow ${t?"open":""}`,width:"12",height:"8",viewBox:"0 0 12 8",children:G.jsx("path",{d:"M1 1L6 6L11 1",stroke:"white",strokeWidth:"2",fill:"none"})})]}),t&&G.jsx("div",{className:"dropdown-list",children:S.map(C=>G.jsx("div",{className:"dropdown-item",onClick:()=>M(C),children:C.name},C.name))})]})})]}),G.jsxs("div",{className:"time-of-day-sliders",children:[G.jsxs("div",{className:"slider-container",children:[G.jsx("label",{style:{color:"white",fontSize:"14px",marginBottom:"8px",display:"block"},children:"TIME OF DAY"}),G.jsx("input",{type:"range",min:"6.75",max:"19.4",step:"0.01",value:i.timeOfDay,onChange:m,className:"time-slider",style:{pointerEvents:a?"none":"auto"}}),G.jsxs("div",{className:"time-markers",children:[G.jsx("span",{className:"time-marker",children:"8 AM"}),G.jsx("span",{className:"time-marker",children:"10 AM"}),G.jsx("span",{className:"time-marker",children:"12 PM"}),G.jsx("span",{className:"time-marker",children:"2 PM"}),G.jsx("span",{className:"time-marker",children:"4 PM"}),G.jsx("span",{className:"time-marker",children:"6 PM"})]})]}),G.jsxs("div",{className:"slider-container",children:[G.jsx("label",{style:{color:"white",fontSize:"14px",marginBottom:"8px",display:"block"},children:"SUN ORIENTATION"}),G.jsx("input",{type:"range",min:"0",max:"360",step:"0.01",value:i.lightRotation,onChange:g,className:"rotation-slider",style:{pointerEvents:a?"none":"auto"}}),G.jsxs("div",{className:"time-markers",children:[G.jsx("span",{className:"time-marker",children:"0"}),G.jsx("span",{className:"time-marker",children:"90"}),G.jsx("span",{className:"time-marker",children:"180"}),G.jsx("span",{className:"time-marker",children:"270"}),G.jsx("span",{className:"time-marker",children:"360"})]})]})]})]})]})})})}function oAe(){const i=qi(Oe),e=$.useRef(null),[t,n]=$.useState({bedroom:!1,bathroom:!1,orientation:!1,availability:!1}),[s,r]=$.useState(!1),a={bedroom:$.useRef(null),bathroom:$.useRef(null),orientation:$.useRef(null),availability:$.useRef(null)},o=i.openedPanel==="unit-search",l=()=>{Oe.openedPanel=null,r(!1)},c=()=>{Oe.isManipulatingSlider=!0,e.current&&clearTimeout(e.current)},u=()=>{e.current=setTimeout(()=>{Oe.isManipulatingSlider=!1},200)},h=C=>{const w=parseFloat(C.target.value);Oe.unitSearchSurface=w,c(),u()},f=C=>{n(w=>({...w,[C]:!w[C]}))};$.useEffect(()=>{const C=N=>{Object.keys(a).forEach(E=>{a[E].current&&!a[E].current.contains(N.target)&&n(B=>({...B,[E]:!1}))})};return Object.values(t).some(N=>N)&&document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[t]);const m=C=>{C===null||Oe.unitSearchBedroomCount===C?Oe.unitSearchBedroomCount=null:Oe.unitSearchBedroomCount=C,n(w=>({...w,bedroom:!1}))},g=C=>{C===null||Oe.unitSearchBathroomCount===C?Oe.unitSearchBathroomCount=null:Oe.unitSearchBathroomCount=C,n(w=>({...w,bathroom:!1}))},x=C=>{C===null||Oe.unitSearchOrientation===C?Oe.unitSearchOrientation=null:Oe.unitSearchOrientation=C,n(w=>({...w,orientation:!1}))},v=C=>{C===null||Oe.unitSearchAvailability===C?Oe.unitSearchAvailability=null:Oe.unitSearchAvailability=C,n(w=>({...w,availability:!1}))},y=()=>i.unitSearchBedroomCount?`${i.unitSearchBedroomCount}`:"ALL",b=()=>i.unitSearchBathroomCount?`${i.unitSearchBathroomCount}`:"ALL",S=()=>i.unitSearchOrientation||"ALL",T=()=>i.unitSearchAvailability||"ALL";$.useEffect(()=>{o||r(!1)},[o]),$.useEffect(()=>()=>{e.current&&clearTimeout(e.current),Oe.isManipulatingSlider=!1},[]);const M=()=>{r(!s)};return G.jsx(G.Fragment,{children:o&&G.jsx(G.Fragment,{children:G.jsxs("div",{className:"unit-search-wrapper",children:[G.jsx("button",{className:"close-button-unit-search",onClick:l,children:G.jsx("svg",{viewBox:"0 0 24 24",children:G.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})}),G.jsxs("div",{className:"mobile-header",children:[G.jsxs("button",{className:"mobile-filter-toggle",onClick:M,children:[G.jsx("span",{children:"Filters"}),G.jsx("svg",{className:`filter-toggle-arrow ${s?"open":""}`,width:"16",height:"16",viewBox:"0 0 16 16",children:G.jsx("path",{d:"M4 6L8 10L12 6",stroke:"white",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})]}),G.jsx("button",{className:"mobile-close-button",onClick:l,children:G.jsx("svg",{viewBox:"0 0 24 24",children:G.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]}),G.jsxs("div",{className:`unit-search-panel ${s?"expanded":""}`,children:[G.jsxs("div",{className:"filter-section",children:[G.jsxs("label",{className:"filter-title",children:["Surface"," ",G.jsxs("span",{className:"filter-title-subtitle",children:["Min: ",Math.round(i.unitSearchSurface),"m"]})]}),G.jsxs("div",{className:"slider-container-unit-search",children:[G.jsx("input",{type:"range",min:"50",max:"90",step:"1",value:i.unitSearchSurface,onChange:h,className:"surface-slider"}),G.jsxs("div",{className:"slider-markers",children:[G.jsx("span",{className:"slider-marker",children:"50"}),G.jsx("span",{className:"slider-marker",children:"90"})]})]})]}),G.jsxs("div",{className:"filter-section",children:[G.jsx("label",{className:"filter-title",children:"Bedroom"}),G.jsxs("div",{className:"custom-dropdown",ref:a.bedroom,children:[G.jsxs("div",{className:"dropdown-header",onClick:()=>f("bedroom"),children:[G.jsx("span",{children:y()}),G.jsx("svg",{className:`dropdown-arrow ${t.bedroom?"open":""}`,width:"12",height:"8",viewBox:"0 0 12 8",children:G.jsx("path",{d:"M1 1L6 6L11 1",stroke:"white",strokeWidth:"2",fill:"none"})})]}),t.bedroom&&G.jsxs("div",{className:"dropdown-list",children:[G.jsx("div",{className:"dropdown-item",onClick:()=>m(null),children:"All"}),[1,2,3].map(C=>G.jsx("div",{className:"dropdown-item",onClick:()=>m(C),children:C},C))]})]})]}),G.jsxs("div",{className:"filter-section",children:[G.jsx("label",{className:"filter-title",children:"Bathroom"}),G.jsxs("div",{className:"custom-dropdown",ref:a.bathroom,children:[G.jsxs("div",{className:"dropdown-header",onClick:()=>f("bathroom"),children:[G.jsx("span",{children:b()}),G.jsx("svg",{className:`dropdown-arrow ${t.bathroom?"open":""}`,width:"12",height:"8",viewBox:"0 0 12 8",children:G.jsx("path",{d:"M1 1L6 6L11 1",stroke:"white",strokeWidth:"2",fill:"none"})})]}),t.bathroom&&G.jsxs("div",{className:"dropdown-list",children:[G.jsx("div",{className:"dropdown-item",onClick:()=>g(null),children:"All"}),[1,2].map(C=>G.jsx("div",{className:"dropdown-item",onClick:()=>g(C),children:C},C))]})]})]}),G.jsxs("div",{className:"filter-section",children:[G.jsx("label",{className:"filter-title",children:"Orientation"}),G.jsxs("div",{className:"custom-dropdown",ref:a.orientation,children:[G.jsxs("div",{className:"dropdown-header",onClick:()=>f("orientation"),children:[G.jsx("span",{children:S()}),G.jsx("svg",{className:`dropdown-arrow ${t.orientation?"open":""}`,width:"12",height:"8",viewBox:"0 0 12 8",children:G.jsx("path",{d:"M1 1L6 6L11 1",stroke:"white",strokeWidth:"2",fill:"none"})})]}),t.orientation&&G.jsxs("div",{className:"dropdown-list",children:[G.jsx("div",{className:"dropdown-item",onClick:()=>x(null),children:"All"}),["NE","SE","SW","NW"].map(C=>G.jsx("div",{className:"dropdown-item",onClick:()=>x(C),children:C},C))]})]})]}),G.jsxs("div",{className:"filter-section",children:[G.jsx("label",{className:"filter-title",children:"Availability"}),G.jsxs("div",{className:"custom-dropdown",ref:a.availability,children:[G.jsxs("div",{className:"dropdown-header",onClick:()=>f("availability"),children:[G.jsx("span",{children:T()}),G.jsx("svg",{className:`dropdown-arrow ${t.availability?"open":""}`,width:"12",height:"8",viewBox:"0 0 12 8",children:G.jsx("path",{d:"M1 1L6 6L11 1",stroke:"white",strokeWidth:"2",fill:"none"})})]}),t.availability&&G.jsxs("div",{className:"dropdown-list",children:[G.jsx("div",{className:"dropdown-item",onClick:()=>v(null),children:"All"}),["AVAILABLE","RESERVED","SOLD"].map(C=>G.jsx("div",{className:"dropdown-item",onClick:()=>v(C),children:C},C))]})]})]})]})]})})})}function lAe(){const e=qi(Oe).openedPanel==="surroundings-panel",t=()=>{Oe.openedPanel=null},n=[{id:"dining",title:"DINING",checked:!0,items:[{name:"Bon Vivant",position:[3,.5,2],description:"Upscale French bistro offering authentic cuisine and fine wines in an elegant atmosphere.",distance:120},{name:"The Smoked Vine",position:[4,.5,3],description:"Modern barbecue restaurant specializing in slow-smoked meats and craft cocktails.",distance:130},{name:"Veg Aroma",position:[5,.5,2],description:"Popular vegetarian restaurant serving flavorful Indian and international plant-based dishes.",distance:150},{name:"Shagun Dining Hall",position:[6,.5,3],description:"Traditional Indian restaurant known for its extensive buffet and festive dining experience.",distance:140}]},{id:"shopping",title:"SHOPPING",checked:!0,items:[{name:"Kohinoor Arcade",position:[7,.5,4],description:"Luxury shopping destination featuring premium brands, jewelry, and designer boutiques.",distance:180},{name:"DMart",position:[8,.5,5],description:"Large discount supermarket chain offering groceries, household items, and daily essentials.",distance:160},{name:"Royal Super Market",position:[9,.5,4],description:"Well-stocked neighborhood supermarket with fresh produce, meats, and specialty items.",distance:280},{name:"Saraf Bazar",position:[10,.5,5],description:"Traditional market street with local vendors selling textiles, spices, and handicrafts.",distance:380}]},{id:"entertainment",title:"ENTERTAINMENT",checked:!0,items:[{name:"X3 Esports",position:[11,.5,6],description:"State-of-the-art gaming center with high-end PCs, tournaments, and esports events.",distance:200},{name:"Trampoline Park",position:[12,.5,7],description:"Fun-filled indoor activity center with trampolines, obstacle courses, and kids' zones.",distance:520},{name:"Shoppers Orbit",position:[13,.5,6],description:"Modern entertainment complex with multiplex cinema, food court, and retail stores.",distance:340},{name:"Seasons Mall",position:[14,.5,7],description:"Large shopping and entertainment mall with cinemas, restaurants, and brand outlets.",distance:420}]},{id:"education",title:"EDUCATION",checked:!0,items:[{name:"Don Bosco High School",position:[15,.5,8],description:"Reputed Catholic school offering quality education with modern facilities and sports programs.",distance:230},{name:"Nirmala Convent High School",position:[16,.5,9],description:"Established convent school known for academic excellence and holistic student development.",distance:320},{name:"St. Xavier High School",position:[17,.5,8],description:"Prestigious Jesuit institution providing comprehensive education and character building.",distance:240}]}],s=(r,a,o)=>{o?Oe.hoveredPointOfInterest=`${r}-${a}`:Oe.hoveredPointOfInterest=null};return G.jsx(G.Fragment,{children:e&&G.jsxs(G.Fragment,{children:[G.jsxs("button",{className:"close-button-surroundings-mobile",onClick:t,children:[G.jsx("svg",{viewBox:"0 0 24 24",children:G.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})}),G.jsx("span",{className:"menu-text",children:"CLOSE"})]}),G.jsxs("div",{className:"surroundings-wrapper",children:[G.jsx("button",{className:"close-button-surroundings",onClick:t,children:G.jsx("svg",{viewBox:"0 0 24 24",children:G.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})}),G.jsx("div",{className:"surroundings-panel",children:n.map(r=>G.jsxs("div",{className:"category-section",children:[G.jsx("div",{className:"category-header",children:G.jsx("h3",{className:"category-title",children:r.title})}),G.jsx("ul",{className:"category-items",children:r.items.map((a,o)=>G.jsx("li",{className:"category-item",onMouseEnter:()=>s(r.id,o,!0),onMouseLeave:()=>s(r.id,o,!1),children:typeof a=="string"?a.toUpperCase():a.name.toUpperCase()},o))})]},r.id))})]})]})})}function cAe(){const i=qi(Oe),[e,t]=$.useState(0),[n,s]=$.useState("normal"),[r,a]=$.useState(!1),[o,l]=$.useState({name:"",email:"",phone:"",message:""}),c=i.openedPanel==="unit-detail",u=i.selectedUnitId?cx[i.selectedUnitId]:null,h=()=>{Oe.openedPanel="unit-search",Oe.selectedUnitId=null,s("normal"),l({name:"",email:"",phone:"",message:""}),a(!1)},f=()=>{console.log("Download PDF for unit:",i.selectedUnitId)},m=()=>{s("form")},g=(B,U)=>{l(H=>({...H,[B]:U}))},x=async B=>{B.preventDefault(),a(!0),await new Promise(U=>setTimeout(U,2e3)),a(!1),s("success")},v=()=>{s("normal"),l({name:"",email:"",phone:"",message:""}),a(!1)},y=()=>{s("normal"),l({name:"",email:"",phone:"",message:""})},b=()=>{i.selectedUnitId&&(Oe.animateCameraToUnitId=i.selectedUnitId)};if(!c||!u)return null;const S={AVAILABLE:"#4caf50",RESERVED:"#ffc107",SOLD:"#f44336"},T={AVAILABLE:"Available",RESERVED:"Reserved",SOLD:"Sold"},M=B=>{const U=B.match(/^(\d+)f_(ne|nw|se|sw)$/i);if(!U)return B;const H=U[1],F=U[2].toUpperCase();return`Unit ${H}${F}`},C=B=>Math.round(B*10.764),w=["/images/ne_living.png","/images/ne_floor.png","/images/ne_kitchen.jpg","/images/ne_bedroom.jpg","/images/ne_open.jpg","/images/ne_bathroom.jpg"],N=()=>{t(B=>B===0?w.length-1:B-1)},E=()=>{t(B=>B===w.length-1?0:B+1)};return G.jsx(G.Fragment,{children:c&&u&&G.jsxs("div",{className:"unit-detail-wrapper",children:[G.jsx("button",{className:"close-button-unit-detail",onClick:h,children:G.jsx("svg",{viewBox:"0 0 24 24",children:G.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})}),G.jsxs("div",{className:"unit-detail-panel",children:[G.jsxs("div",{className:"unit-header",children:[G.jsx("h2",{className:"unit-title",children:M(u.id)}),G.jsx("div",{className:"unit-availability-badge",style:{backgroundColor:S[u.availability]},children:T[u.availability]})]}),n==="form"&&G.jsxs("form",{className:"unit-contact-form",onSubmit:x,children:[G.jsx("p",{className:"form-intro-text",children:"We'd love to hear from you! Fill out the form below and our team will get back to you shortly."}),G.jsxs("div",{className:"form-fields-row",children:[G.jsxs("div",{className:"form-field",children:[G.jsx("label",{htmlFor:"name",children:"Name"}),G.jsx("input",{id:"name",type:"text",value:o.name,onChange:B=>g("name",B.target.value)})]}),G.jsxs("div",{className:"form-field",children:[G.jsx("label",{htmlFor:"phone",children:"Phone"}),G.jsx("input",{id:"phone",type:"tel",value:o.phone,onChange:B=>g("phone",B.target.value)})]})]}),G.jsxs("div",{className:"form-field",children:[G.jsx("label",{htmlFor:"email",children:"Email"}),G.jsx("input",{id:"email",type:"email",value:o.email,onChange:B=>g("email",B.target.value)})]}),G.jsxs("div",{className:"form-field",children:[G.jsx("label",{htmlFor:"message",children:"Message"}),G.jsx("textarea",{id:"message",value:o.message,onChange:B=>g("message",B.target.value),rows:2})]}),G.jsxs("div",{className:"form-actions-row",children:[G.jsxs("button",{type:"button",className:"unit-action-button unit-action-button-cancel",onClick:v,disabled:r,children:[G.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[G.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),G.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),"Cancel"]}),G.jsx("button",{type:"submit",className:"unit-action-button unit-action-button-submit",disabled:r,children:r?G.jsxs(G.Fragment,{children:[G.jsx("div",{className:"spinner"}),"Sending..."]}):G.jsxs(G.Fragment,{children:[G.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",children:G.jsx("path",{stroke:"currentColor",d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11zM21.854 2.147l-10.94 10.939"})}),"Send Message"]})})]})]}),n==="success"&&G.jsxs("div",{className:"unit-success-message",children:[G.jsxs("svg",{className:"success-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[G.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),G.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),G.jsx("p",{children:"Your message has been received and one of our representatives will contact you within 2 hours."}),G.jsx("button",{className:"unit-action-button unit-action-button-half",onClick:y,children:"OK"})]}),n==="normal"&&G.jsxs(G.Fragment,{children:[G.jsxs("div",{className:"unit-details",children:[G.jsxs("div",{className:"unit-detail-item",children:[G.jsxs("svg",{className:"unit-detail-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[G.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),G.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),G.jsxs("span",{children:[u.bedrooms," bedrooms"]})]}),G.jsxs("div",{className:"unit-detail-item",children:[G.jsxs("svg",{className:"unit-detail-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[G.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),G.jsx("line",{x1:"9",y1:"3",x2:"9",y2:"21"})]}),G.jsxs("span",{children:[u.surface," m (",C(u.surface)," ft)"]})]})]}),G.jsxs("div",{className:"unit-properties",children:[G.jsx("div",{className:"unit-property-tag",children:"Air conditioning"}),G.jsx("div",{className:"unit-property-tag",children:"Internet"}),G.jsx("div",{className:"unit-property-tag",children:"Hot water"}),G.jsx("div",{className:"unit-property-tag",children:"Electricity"}),G.jsx("div",{className:"unit-property-tag",children:"Light fixtures"}),G.jsxs("div",{className:"unit-property-tag",children:[u.bathrooms," bathroom",u.bathrooms>1?"s":""]})]}),G.jsxs("div",{className:"unit-actions",children:[G.jsxs("button",{className:"unit-action-button unit-action-button-view",onClick:b,children:[G.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[G.jsx("path",{stroke:"currentColor",d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),G.jsx("circle",{stroke:"currentColor",cx:"12",cy:"12",r:"3"})]}),"View from inside the unit"]}),G.jsxs("div",{className:"unit-actions-row",children:[G.jsxs("button",{className:"unit-action-button",onClick:f,children:[G.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[G.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),G.jsx("polyline",{points:"7 10 12 15 17 10"}),G.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Download PDF"]}),G.jsxs("button",{className:"unit-action-button",onClick:m,children:[G.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:G.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),"Request info"]})]})]}),G.jsx("div",{className:"unit-gallery",children:G.jsxs("div",{className:"unit-gallery-container",children:[G.jsx("img",{src:w[e],alt:`${M(u.id)} - Image ${e+1}`,className:"unit-gallery-image"}),w.length>1&&G.jsxs(G.Fragment,{children:[G.jsx("button",{className:"gallery-nav-button gallery-nav-prev",onClick:N,children:G.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:G.jsx("polyline",{points:"15 18 9 12 15 6"})})}),G.jsx("button",{className:"gallery-nav-button gallery-nav-next",onClick:E,children:G.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:G.jsx("polyline",{points:"9 18 15 12 9 6"})})}),G.jsx("div",{className:"gallery-dots",children:w.map((B,U)=>G.jsx("button",{className:`gallery-dot ${U===e?"active":""}`,onClick:()=>t(U)},U))})]})]})})]})]})]})})}function uAe(i){const{nodes:e,materials:t}=mr("/building_floor-transformed.glb");return G.jsxs("group",{...i,dispose:null,children:[G.jsx("mesh",{receiveShadow:!0,geometry:e.BezierCurve001.geometry,material:t.BuildingPlot}),G.jsx("mesh",{receiveShadow:!0,geometry:e.BezierCurve001_1.geometry,material:t.green})]})}mr.preload("/building_floor-transformed.glb");function hAe(i){const{nodes:e,materials:t}=mr("/building_trees-transformed.glb");return G.jsxs("group",{...i,dispose:null,children:[G.jsxs("group",{position:[-104.464,-.283,.342],rotation:[0,-1.55,0],children:[G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.tree1.geometry,material:t.CherryBark}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.tree1_1.geometry,material:t.CherryBranchAtlas,"material-alphaTest":.95,"material-depthWrite":!1,renderOrder:100})]}),G.jsxs("group",{position:[-85.099,-.021,-39.589],rotation:[0,-1.003,0],children:[G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.tree2.geometry,material:t["CommonBark.001"]}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.tree2_1.geometry,material:t.BirchBranchAtlas,"material-alphaTest":.1,"material-depthWrite":!1,renderOrder:100})]}),G.jsxs("group",{position:[-111.595,-.225,-6.508],rotation:[0,.113,0],children:[G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.tree3.geometry,material:t.OakBark}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.tree3_1.geometry,material:t.OakBranchAtlas,"material-alphaTest":.1,"material-depthWrite":!1,renderOrder:100})]})]})}mr.preload("/building_trees-transformed.glb");function dAe(i){const{nodes:e,materials:t}=mr("/terrain.glb");return t.TerrainCenterNew.normalScale.set(-.25,-.5),t.TerrainCenterNew.needsUpdate=!0,G.jsx("group",{...i,dispose:null,children:G.jsx("mesh",{receiveShadow:!0,geometry:e.Terrain_centerNew.geometry.toNonIndexed(),material:t.TerrainCenterNew,"material-metalness":.3,"material-roughness":.95})})}mr.preload("/terrain.glb");function fAe(i){const{nodes:e,materials:t}=mr("/landscape-transformed.glb");return G.jsxs("group",{...i,dispose:null,children:[G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.blockBuildings_1.geometry,material:t.BuildingWhite}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.blockBuildings_2.geometry,material:t.BuildingRoof})]})}mr.preload("/landscape-transformed.glb");function pAe(i){const{nodes:e,materials:t}=mr("/roads-transformed.glb");return G.jsxs("group",{...i,dispose:null,children:[G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.lightPost.geometry,material:t.pole}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.Sidewalks.geometry,material:t.Sidewalks}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.Roads_brighter_1.geometry,material:t.Roads_Baked_bright}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.Roads_brighter_2.geometry,material:t.buiildingParkingLot_bright})]})}mr.preload("/roads-transformed.glb");const mAe={AVAILABLE:"#4caf50",RESERVED:"#ffc107",SOLD:"#f44336"};function gAe(i,e){const{unitSearchSurface:t,unitSearchBedroomCount:n,unitSearchBathroomCount:s,unitSearchOrientation:r,unitSearchAvailability:a}=e;return!(i.surface<t||n!==null&&i.bedrooms!==n||s!==null&&i.bathrooms!==s||r!==null&&i.orientation!==r||a!==null&&i.availability!==a)}function yAe({unitId:i,geometry:e,material:t,position:n}){const s=$.useRef(),r=qi(Oe),a=cx[i],[o,l]=$.useState(!1),c=r.selectedUnitId===i,u=r.openedPanel==="unit-search"||r.openedPanel==="unit-detail",h=$.useMemo(()=>u?gAe(a,{unitSearchSurface:r.unitSearchSurface,unitSearchBedroomCount:r.unitSearchBedroomCount,unitSearchBathroomCount:r.unitSearchBathroomCount,unitSearchOrientation:r.unitSearchOrientation,unitSearchAvailability:r.unitSearchAvailability}):!1,[u,r.openedPanel,r.unitSearchSurface,r.unitSearchBedroomCount,r.unitSearchBathroomCount,r.unitSearchOrientation,r.unitSearchAvailability,a]);$.useEffect(()=>{if(!t||!a)return;const x=mAe[a.availability];x&&(t.color.setStyle(x),t.transparent=!0,t.opacity=o||c?.3:.9,t.premultipliedAlpha=!0,t.blending=Ch,t.depthWrite=!0,t.depthTest=!0,t.roughness=1,t.metalness=o||c?.5:0,t.specularIntensity=0,t.needsUpdate=!0)},[t,a,o,c,r.selectedUnitId]);const f=x=>{x.stopPropagation(),!(r.openedPanel!=="unit-search"&&r.openedPanel!=="unit-detail")&&(!r.allowClick||r.isDraggingCamera||!r.finishedIntro||(Oe.selectedUnitId=i,Oe.openedPanel="unit-detail"))},m=x=>{x.stopPropagation(),!(!r.allowHover||!r.finishedIntro)&&r.openedPanel==="unit-search"&&(l(!0),Oe.hoveredUnitId=i,document.body.style.cursor="pointer")},g=x=>{x.stopPropagation(),l(!1),Oe.hoveredUnitId=null,document.body.style.cursor="auto"};return a?G.jsx("mesh",{ref:s,geometry:e,material:t,position:n,visible:h,onClick:f,onPointerEnter:m,onPointerLeave:g}):(console.warn(`Unit data not found for: ${i}`),null)}function xAe(i){const{nodes:e,materials:t}=mr("/floor_selectors.glb"),n=$.useMemo(()=>{var s,r,a,o,l,c,u,h,f,m,g,x,v,y,b,S,T,M,C,w,N,E,B,U;return[{id:"3f_ne",geometry:(s=e["3f_ne"])==null?void 0:s.geometry,material:t.material_3f_ne,position:[-90.68,12.8551,-10.3176]},{id:"3f_nw",geometry:(r=e["3f_nw"])==null?void 0:r.geometry,material:t.material_3f_nw,position:[-54.6952,12.8551,-3.3652]},{id:"3f_sw",geometry:(a=e["3f_sw"])==null?void 0:a.geometry,material:t.material_3f_sw,position:[-46.7722,12.7425,-18.0074]},{id:"3f_se",geometry:(o=e["3f_se"])==null?void 0:o.geometry,material:t.material_3f_se,position:[-92.6347,12.8551,-25.4969]},{id:"1f_ne",geometry:(l=e["1f_ne"])==null?void 0:l.geometry,material:t.material_1f_ne,position:[-90.5566,5.5309,-10.436]},{id:"1f_nw",geometry:(c=e["1f_nw"])==null?void 0:c.geometry,material:t.material_1f_nw,position:[-54.6952,5.5309,-3.3652]},{id:"1f_sw",geometry:(u=e["1f_sw"])==null?void 0:u.geometry,material:t.material_1f_sw,position:[-46.7722,5.4184,-18.0074]},{id:"1f_se",geometry:(h=e["1f_se"])==null?void 0:h.geometry,material:t.material_1f_se,position:[-92.6347,5.5309,-25.4969]},{id:"2f_ne",geometry:(f=e["2f_ne"])==null?void 0:f.geometry,material:t.material_2f_ne,position:[-90.5566,9.1498,-10.436]},{id:"2f_nw",geometry:(m=e["2f_nw"])==null?void 0:m.geometry,material:t.material_2f_nw,position:[-54.6952,9.1498,-3.3652]},{id:"2f_sw",geometry:(g=e["2f_sw"])==null?void 0:g.geometry,material:t.material_2f_sw,position:[-46.7722,9.0373,-18.0074]},{id:"2f_se",geometry:(x=e["2f_se"])==null?void 0:x.geometry,material:t.material_2f_se,position:[-92.6347,9.1498,-25.4969]},{id:"4f_ne",geometry:(v=e["4f_ne"])==null?void 0:v.geometry,material:t.material_4f_ne,position:[-90.68,16.5392,-10.3176]},{id:"4f_nw",geometry:(y=e["4f_nw"])==null?void 0:y.geometry,material:t.material_4f_nw,position:[-54.6952,16.5392,-3.3652]},{id:"4f_sw",geometry:(b=e["4f_sw"])==null?void 0:b.geometry,material:t.material_4f_sw,position:[-46.7722,16.4266,-18.0074]},{id:"4f_se",geometry:(S=e["4f_se"])==null?void 0:S.geometry,material:t.material_4f_se,position:[-92.6347,16.5392,-25.4969]},{id:"5f_ne",geometry:(T=e["5f_ne"])==null?void 0:T.geometry,material:t.material_5f_ne,position:[-90.68,20.2533,-10.3176]},{id:"5f_nw",geometry:(M=e["5f_nw"])==null?void 0:M.geometry,material:t.material_5f_nw,position:[-54.6952,20.2533,-3.3652]},{id:"5f_sw",geometry:(C=e["5f_sw"])==null?void 0:C.geometry,material:t.material_5f_sw,position:[-46.7722,20.1408,-18.0074]},{id:"5f_se",geometry:(w=e["5f_se"])==null?void 0:w.geometry,material:t.material_5f_se,position:[-92.6347,20.2533,-25.4969]},{id:"6f_ne",geometry:(N=e["6f_ne"])==null?void 0:N.geometry,material:t.material_6f_ne,position:[-90.68,23.9525,-10.3176]},{id:"6f_nw",geometry:(E=e["6f_nw"])==null?void 0:E.geometry,material:t.material_6f_nw,position:[-54.6952,23.9525,-3.3652]},{id:"6f_sw",geometry:(B=e["6f_sw"])==null?void 0:B.geometry,material:t.material_6f_sw,position:[-46.7722,23.84,-18.0074]},{id:"6f_se",geometry:(U=e["6f_se"])==null?void 0:U.geometry,material:t.material_6f_se,position:[-92.6347,23.9525,-25.4969]}]},[e,t]);return G.jsx("group",{...i,dispose:null,children:n.map(s=>G.jsx(yAe,{unitId:s.id,geometry:s.geometry,material:s.material,position:s.position},s.id))})}mr.preload("/floor_selectors.glb");function _Ae(i){const{nodes:e,materials:t}=mr("/building-transformed.glb"),n=lx("/rocky_terrain_02_nor_gl_1k.webp");n.flipY=!1,n.center.setScalar(.5),n.rotation=Math.PI,n.anisotropy=8,n.generateMipmaps=!1,n.minFilter=Jt,n.magFilter=Jt,n.repeat.set(2,2),n.needsUpdate=!0;const s=DO({files:"/envmap2.hdr"});return G.jsxs("group",{...i,dispose:null,children:[G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.mainBuilding001.geometry,material:t["vray balcony glass"],"material-envMap":s,"material-color":"#2d424c","material-envMapIntensity":.5,"material-roughness":0,"material-transmission":0,"material-transparent":!0,"material-opacity":.51,"material-metalness":0,"material-specularIntensity":1,"material-clearcoat":1,"material-ior":1.4,"material-iridescence":.4,"material-iridescenceIOR":1.28,"material-iridescenceThicknessRange":[.9,.2]}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.mainBuilding002.geometry,material:t.walls,"material-envMap":s,"material-color":"gray","material-envMapIntensity":1,"material-roughness":1,"material-metalness":0,"material-specularIntensity":1}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.mainBuilding003.geometry,material:t["floor white.001"]}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.mainBuilding_1.geometry,material:t["facade wood"],"material-normalScale":[.1,-.05]}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.mainBuilding_2.geometry,material:t.balcony}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.mainBuilding_3.geometry,material:t["molding black side"]}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.mainBuilding_4.geometry,material:t["window metal"]}),G.jsx("mesh",{geometry:e.mainBuilding_5.geometry,visible:!0,material:t["window glass"],"material-envMap":s,"material-color":"#2d424c","material-envMapIntensity":2,"material-roughness":0,"material-transmission":0,"material-transparent":!0,"material-opacity":.3,"material-metalness":0,"material-specularIntensity":1.5,"material-clearcoat":3,"material-reflectivity":2.5,"material-ior":3,"material-side":jr}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.mainBuilding_6.geometry,material:t["facade white"],"material-normalScale":[.05,-.05]}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.mainBuilding_7.geometry,material:t["balcony wood"]}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.mainBuilding_8.geometry,material:t["vray balcony metal mat"],"material-color":"#ffffff","material-envMap":s,"material-envMapIntensity":1,"material-roughness":0,"material-metalness":1,"material-specularIntensity":1,"material-clearcoat":1}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.mainBuilding_9.geometry,material:t["vray molding gray metal"]}),G.jsx("mesh",{castShadow:!0,receiveShadow:!0,geometry:e.mainBuilding_10.geometry,material:t["vray molding gray metal_ncl1_1"]}),G.jsx(uAe,{}),G.jsx(xAe,{}),G.jsx(hAe,{}),G.jsx(dAe,{}),G.jsx(fAe,{}),G.jsx(pAe,{position:[0,.019,0]})]})}mr.preload("/building-transformed.glb");function vAe({cameraFar:i,horizonFade:e,distanceScale:t,minDistance:n,alpha:s,skyColorUniform:r,groundColorUniform:a,nearFadeStart:o,nearFadeWidth:l,heightOffset:c}){const u=uH(r),h=uH(a),f=fH.z.negate().smoothstep(0,Math.max(i-e,1)),m=f.mul(t).max(n).add(c),g=_e(m).sub(UK.y).div(m).saturate(),x=fH.z.negate().smoothstep(o,o+l),v=g.pow(.1).mul(s).mul(x),y=h.mix(u,f);return{fogNode:s_e(y,v),skyColorUniform:r,groundColorUniform:a}}function bAe(i){let e="#a1ceff",t="#192b17";if(i>=5&&i<6.5){const n=(i-5)/1.5,s=new Ye("#4a2a1a"),r=new Ye("#8b5a3c");e=s.lerp(r,n).getStyle(),t="#1a1a2e"}else if(i>=6.5&&i<8){const n=(i-6.5)/1.5,s=new Ye("#8b5a3c"),r=new Ye("#8592bd");e=s.lerp(r,n).getStyle(),t="#1a2a1e"}else if(i>=8&&i<10)e="#7a8cc8",t="#2a3a2e";else if(i>=10&&i<15)e="#27e4ff",t="#2a3a2e";else if(i>=15&&i<18){const n=(i-15)/3,s=new Ye("#d6f2fd"),r=new Ye("#f6c263");e=s.lerp(r,n).getStyle(),t="#3a2a1e"}else if(i>=18&&i<19)e="#eda778",t="#3a2a1e";else if(i>=19&&i<=21){const n=(i-19)/2,s=new Ye("#d2a693"),r=new Ye("#eda778");e=s.lerp(r,n).getStyle(),t="#1a1a2e"}return{skyColor:e,groundColor:t}}function SAe({skyColor:i,groundColor:e,horizonFade:t=800,distanceScale:n=200,minDistance:s=10,alpha:r=.15,nearFadeStart:a=15,nearFadeWidth:o=50,heightOffset:l=10}){const{scene:c,camera:u,invalidate:h}=ts(),f=qi(Oe),m=$.useRef(void 0),g=$.useRef(ut(new Ye(i||"#a1ceff"))),x=$.useRef(ut(new Ye(e||"#192b17"))),v=$.useMemo(()=>vAe({cameraFar:u.far,horizonFade:t,distanceScale:n,minDistance:s,alpha:r,skyColorUniform:g.current,groundColorUniform:x.current,nearFadeStart:a,nearFadeWidth:o,heightOffset:l}),[u.far,t,n,s,r,a,o,l]);return $.useEffect(()=>{const{skyColor:y,groundColor:b}=i&&e?{skyColor:i,groundColor:e}:bAe(f.timeOfDay);g.current.value.set(y),g.current.needsUpdate=!0,x.current.value.set(b),x.current.needsUpdate=!0,h&&h()},[f.timeOfDay,i,e,h]),$.useEffect(()=>{m.current===void 0&&(m.current=c.fogNode??null),c.fogNode=v.fogNode,h&&h()},[c,v,h]),$.useEffect(()=>()=>{c.fogNode=m.current??null,h&&h()},[c,h]),null}function TAe({radius:i=.5,softness:e=.3,intensity:t=.6,color:n="0, 0, 0",zIndex:s=5}){const r=Math.min(Math.max(i,0),1),a=Math.min(Math.max(e,.01),1),o=Math.min(Math.max(t,0),1),l=$.useMemo(()=>{const c=r*100,u=Math.min((r+a*(1-r))*100,100);return`radial-gradient(circle at 50% 50%, rgba(${n}, 0) ${c}%, rgba(${n}, ${o}) ${u}%)`},[r,a,o,n]);return G.jsx("div",{style:{position:"fixed",inset:0,pointerEvents:"none",zIndex:s,backgroundImage:l,backgroundRepeat:"no-repeat",backgroundSize:"cover"}})}const H3={HEMI:0,FULL:1};function AAe(i=6,e=6,t=1,n=1,s=!0){const r=t/i,a=n/e;let o=0,l=0;s&&(o=-t*.5,l=-n*.5);const c=[];for(let u=0;u<=e;u++){const h=u*a;for(let f=0;f<=i;f++){const m=f*r;c.push(m+o,0,h+l)}}return c}function MAe(i){const e=new Array(i.length);for(let t=0;t<i.length;t+=3){const n=i[t+0],s=i[t+1],r=i[t+2],a=Math.sqrt(n**2+s**2+r**2);e[t+0]=n/a,e[t+1]=s/a,e[t+2]=r/a}return e}function EAe(i=0,e=6,t=6){const n=[],s=e+1,r=Math.floor(e*.5),a=Math.floor(t*.5);for(let o=0;o<t;o++){const l=s*o,c=s*(o+1);for(let u=0;u<e;u++){const h=l+u,f=c+u,m=c+u+1,g=l+u+1;(Math.floor(u/r)+Math.floor(o/a))%2===i?n.push(h,f,m,m,g,h):n.push(g,h,f,f,m,g)}}return n}function CAe(i){for(let t=0;t<i.length;t+=3){const n=i[t+0]+.5,s=i[t+2]+.5;let r=n-s,a=-1+n+s,o=1-Math.abs(r)-Math.abs(a);const l=Math.sqrt(r**2+o**2+a**2);i[t+0]=r/l*.5,i[t+1]=o/l*.5,i[t+2]=a/l*.5}}function wAe(i){for(let t=0;t<i.length;t+=3){const n=i[t+0]*2,s=i[t+2]*2;let r=n,a=s,o=1-Math.abs(r)-Math.abs(a);if(o<0){const c=r,u=a;r=Math.sign(c)*(1-Math.abs(u)),a=Math.sign(u)*(1-Math.abs(c)),o=1-Math.abs(r)-Math.abs(a)}const l=Math.sqrt(r**2+o**2+a**2);i[t+0]=r/l*.5,i[t+1]=o/l*.5,i[t+2]=a/l*.5}}function PO(i,e){const t=AAe(e,e),n=EAe(i,e,e),s=t.slice();switch(i){case H3.HEMI:CAe(s);break;case H3.FULL:wAe(s);break;default:throw new Error(`Unknown octahedron type: ${i}`)}const r=MAe(s),a=new pn;return a.setAttribute("position",new Nn(new Float32Array(s),3)),a.setAttribute("normal",new Nn(new Float32Array(r),3)),a.setIndex(n),a.computeBoundingSphere(),{pntPlane:t,pntOct:s,indices:n,geometry:a}}const LB=new Map,EA=new Map;function RAe(i,e,t,n){return i?(i.userData.__impostorSourceId||(i.userData.__impostorSourceId=i.name&&i.name.length>0?i.name:Fh.generateUUID()),`${i.userData.__impostorSourceId}|g${e}|a${t}|o${n}`):null}function NAe(i,e,t="png"){return new Promise((n,s)=>{try{i.toBlob(r=>{if(!r){s(new Error("Failed to create blob from canvas"));return}const a=URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a),console.log(`Atlas saved as ${e}`),n()},t==="webp"?"image/webp":"image/png",1)}catch(r){console.error("Error saving atlas file:",r),s(r)}})}function BAe({mesh:i=null,gridSize:e=16,atlasSize:t=2048,octType:n=H3.HEMI,enabled:s=!0,atlasPath:r=null,saveAtlasPath:a=null}){const{gl:o,scene:l,camera:c}=ts(),[u,h]=$.useState(null),[f,m]=$.useState(null),[g,x]=$.useState(!1),v=$.useRef(null),y=$.useRef(new $f),b=$.useMemo(()=>{if(!s)return null;try{return PO(n,e)}catch(S){return console.error("Failed to build octahedral mesh:",S),null}},[n,e,s]);return v.current=b,$.useEffect(()=>{if(!s||!b){h(null);return}if(r){x(!0),m(null),y.current.load(r,T=>{T.flipY=!1,T.needsUpdate=!0,h({texture:T,gridSize:e,octType:n,octahedralData:b}),x(!1)},void 0,T=>{console.error("Failed to load atlas texture:",T),m(T),x(!1)});return}if(!i||!o){h(null);return}const S=RAe(i,e,t,n);if(S&&LB.has(S)){const T=LB.get(S);h(T),x(!1),m(null);return}if(S&&EA.has(S)){x(!0),m(null),EA.get(S).then(M=>{h(M),x(!1)}).catch(M=>{console.error("Failed to generate atlas:",M),m(M),x(!1)});return}x(!0),m(null);try{const T=DAe({mesh:i,octahedralData:b,gridSize:e,atlasSize:t,gl:o,scene:l,camera:c,saveAtlasPath:a}).then(M=>{const C={texture:M,gridSize:e,octType:n,octahedralData:b};return S&&LB.set(S,C),h(C),x(!1),C},M=>{throw console.error("Failed to generate atlas:",M),m(M),x(!1),M});S&&EA.set(S,T),T.finally(()=>{S&&EA.delete(S)})}catch(T){console.error("Error in atlas generation:",T),m(T),x(!1)}},[i,b,e,t,s,o,l,c,n,r,a]),{atlas:u,error:f,isGenerating:g,octahedralData:b}}async function DAe({mesh:i,octahedralData:e,gridSize:t,atlasSize:n,gl:s,scene:r,camera:a,saveAtlasPath:o=null}){var Y,P,X,J;const l=i instanceof ao?i.clone():(()=>{const re=new ao;return re.add(i.clone()),re})();l.visible=!0;const c=new fu;l.traverse(re=>{if(re instanceof Kn&&re.geometry){const ne=re.geometry;if(ne.computeBoundingSphere(),ne.boundingSphere){const ge=ne.boundingSphere.center.clone();ne.translate(-ge.x,-ge.y,-ge.z),re.position.add(ge)}}});const u=new Gs;l.traverse(re=>{if(re instanceof Kn&&re.geometry&&(re.geometry.computeBoundingSphere(),re.geometry.boundingSphere)){const ne=re.geometry.boundingSphere.clone();ne.applyMatrix4(re.matrixWorld),u.union(ne)}});const f=.5/(u.radius*1.5);l.scale.setScalar(f),l.position.set(0,0,0);const m=.5,g=new Dr(-m,m,m,-m,.001,10),x=s.getRenderTarget(),v=new Ye;s.getClearColor(v);const y=t,b=Math.floor(n/y*1),{pntOct:S}=e,T=document.createElement("canvas");T.width=n,T.height=n;const M=T.getContext("2d",{willReadFrequently:!0});if(!M)throw new Error("Failed to create 2D canvas context for atlas generation");M.fillStyle="rgba(0, 0, 0, 0)",M.fillRect(0,0,n,n);const C=document.createElement("canvas");C.width=b,C.height=b;const w=new yw({canvas:C,preserveDrawingBuffer:!0,antialias:!1});w.setSize(b,b),w.setClearColor(0,0);const N=new fu,E=new ng("#d5c6bc",.45);E.position.set(1,2,-5);const B=new ng("#d5c6bc",.5);B.position.set(-4,0,5),N.add(E),N.add(B);const U=new Dr(-m,m,m,-m,.001,10),H=l.clone();N.add(H);for(let re=0;re<=y;re++)for(let ne=0;ne<=y;ne++){const ge=re*y+ne;if(ge*3+2>=S.length)continue;const Te=S[ge*3],Be=S[ge*3+1],et=S[ge*3+2],wt=new z(Te,Be,et).normalize();g.position.copy(wt.multiplyScalar(1.1)),g.lookAt(0,.5,0),U.position.copy(g.position),U.lookAt(0,.5,0);let Re=null;try{w.clear(),w.render(N,U);const Ke=w.getContext();if(Ke){const jt=new Uint8Array(b*b*4);Ke.readPixels(0,0,b,b,Ke.RGBA,Ke.UNSIGNED_BYTE,jt),Re=jt}else throw new Error("Unable to get WebGL context from renderer")}catch(Ke){console.warn("Error reading pixels from render target:",Ke);continue}if(!Re)continue;const tt=M.createImageData(b,b);tt.data.set(Re);const Bt=Math.floor(ne/y*n),ht=Math.floor(re/y*n);M.putImageData(tt,Bt,ht)}if(w.dispose(),(Y=H.geometry)==null||Y.dispose(),(P=H.material)==null||P.dispose(),o)try{const re=o.toLowerCase().endsWith(".webp")?"webp":"png";await NAe(T,o,re)}catch(re){console.warn("Failed to save atlas file:",re)}const F=new TU(T);F.needsUpdate=!0,F.flipY=!1;const V=T.getContext("2d");return V&&(V.getImageData(0,0,Math.min(100,T.width),Math.min(100,T.height)).data.some((ge,Te)=>Te%4===3&&ge>0)||console.warn("Atlas appears to be empty!")),s.setRenderTarget(x),s.setClearColor(v),c.remove(l),(X=l.geometry)==null||X.dispose(),(J=l.material)==null||J.dispose(),F}const CA=new Map;function LAe(i,e){const t=i.x,n=i.y,s=i.z;if(e===0){let r=t,a=n,o=s;if(n<0)r=t,a=-n,o=s;else if(n>0){a=0;const y=Math.sqrt(t*t+s*s);y>1e-9?(r=t/y,o=s/y):(r=0,o=1)}const l=Math.abs(r),c=Math.abs(a),u=Math.abs(o),h=l+c+u;if(h<1e-9)return{u:.5,v:.5};let f=r/h,m=a/h,g=o/h;if(m<0){m=0;const y=Math.sqrt(f*f+g*g);y>1e-9&&(f/=y,g/=y);const b=Math.abs(f),S=Math.abs(g),T=b+S;T>1e-9&&(f=f/T,g=g/T)}const x=(f+g+1)/2,v=(g+1-f)/2;return{u:Math.max(0,Math.min(1,x)),v:Math.max(0,Math.min(1,v))}}else{const r=Math.abs(t),a=Math.abs(n),o=Math.abs(s),l=r+a+o;if(l<1e-9)return{u:.5,v:.5};let c=t/l,u=n/l,h=s/l;if(u<0){const f=c>=0?1:-1,m=h>=0?1:-1,g=(1-Math.abs(h))*f,x=(1-Math.abs(c))*m;c=g,h=x}return{u:c*.5+.5,v:h*.5+.5}}}function UAe(i,e,t,n){const s=t[0][0],r=t[0][1],a=t[1][0],o=t[1][1],l=t[2][0],c=t[2][1],u=a-s,h=o-r,f=l-s,m=c-r,g=i-s,x=e-r,v=u*m-f*h;if(Math.abs(v)<1e-9)return n.set(1/3,1/3,1/3),n;const y=1/v,b=(g*m-f*x)*y,S=(u*x-g*h)*y,T=1-b-S,M=Math.max(T,0),C=Math.max(b,0),w=Math.max(S,0),N=M+C+w;return N<=0?n.set(1/3,1/3,1/3):n.set(M/N,C/N,w/N),n}function IAe(i,e){const t=`${i}_${e}`;if(CA.has(t))return CA.get(t);const s=PO(i,e).geometry,r=s.getIndex();if(!r)return CA.set(t,null),null;const a=r.array,o=e+1,l=new Array(e*e);let c=0;for(let h=0;h<e;h+=1)for(let f=0;f<e;f+=1){const m=[a[c],a[c+1],a[c+2]],g=[a[c+3],a[c+4],a[c+5]];c+=6;const x=m[1]-m[0]===o&&m[2]-m[1]===1,v=x?[{indices:m,uv:[[0,0],[0,1],[1,1]]},{indices:g,uv:[[1,1],[1,0],[0,0]]}]:[{indices:m,uv:[[1,0],[0,0],[0,1]]},{indices:g,uv:[[0,1],[1,1],[1,0]]}];l[h*e+f]={isBackslash:x,triangles:v}}s.dispose();const u={gridSize:e,octType:i,cells:l};return CA.set(t,u),u}function PAe(i,e){return IAe(i,e)}function OAe({direction:i,cache:e,indicesTarget:t,weightsTarget:n}){if(!e)return console.warn("sampleOctahedralDirection: No cache provided"),!1;if(!i||!i.isVector3)return console.warn("sampleOctahedralDirection: Invalid direction"),!1;const s=i.clone().normalize();if(s.length()<.1)return console.warn("sampleOctahedralDirection: Direction too small after normalization"),!1;const r=LAe(s,e.octType);if(isNaN(r.u)||isNaN(r.v)||r.u<0||r.u>1||r.v<0||r.v>1)return console.warn("sampleOctahedralDirection: Invalid UV coordinates",r),!1;const a=e.gridSize,o=r.u*a,l=r.v*a,c=Math.min(Math.max(Math.floor(o),0),a-1),u=Math.min(Math.max(Math.floor(l),0),a-1),h=Math.min(Math.max(o-c,0),.999999),f=Math.min(Math.max(l-u,0),.999999),m=u*a+c,g=e.cells[m];if(!g)return console.warn(`sampleOctahedralDirection: No cell found at [${u}, ${c}] (index ${m})`),!1;const x=g.isBackslash&&h>f||!g.isBackslash&&h+f>1?g.triangles[1]:g.triangles[0];if(!x||!x.indices||x.indices.length!==3)return console.warn("sampleOctahedralDirection: Invalid triangle"),!1;UAe(h,f,x.uv,n);const v=(a+1)*(a+1)-1,y=[Math.max(0,Math.min(x.indices[0],v)),Math.max(0,Math.min(x.indices[1],v)),Math.max(0,Math.min(x.indices[2],v))];return t.set(y[0],y[1],y[2]),!0}class FAe{constructor(e,t){this.bounds=e,this.cellSize=t,this.grid=new Map,this.gridSize=[Math.ceil((e.max[0]-e.min[0])/t),Math.ceil((e.max[1]-e.min[1])/t),Math.ceil((e.max[2]-e.min[2])/t)]}getCellKey(e){const t=Math.floor((e[0]-this.bounds.min[0])/this.cellSize),n=Math.floor((e[1]-this.bounds.min[1])/this.cellSize),s=Math.floor((e[2]-this.bounds.min[2])/this.cellSize),r=Math.max(0,Math.min(t,this.gridSize[0]-1)),a=Math.max(0,Math.min(n,this.gridSize[1]-1)),o=Math.max(0,Math.min(s,this.gridSize[2]-1));return`${r},${a},${o}`}getCellCoords(e){return e.split(",").map(Number)}getCellCenter(e){const[t,n,s]=this.getCellCoords(e);return[this.bounds.min[0]+(t+.5)*this.cellSize,this.bounds.min[1]+(n+.5)*this.cellSize,this.bounds.min[2]+(s+.5)*this.cellSize]}addInstance(e,t){const n=this.getCellKey(e.position);this.grid.has(n)||this.grid.set(n,[]),this.grid.get(n).push({instance:e,index:t})}queryNearCamera(e,t){const n=[],s=t*t,r=Math.floor((e.x-t-this.bounds.min[0])/this.cellSize),a=Math.ceil((e.x+t-this.bounds.min[0])/this.cellSize),o=Math.floor((e.y-t-this.bounds.min[1])/this.cellSize),l=Math.ceil((e.y+t-this.bounds.min[1])/this.cellSize),c=Math.floor((e.z-t-this.bounds.min[2])/this.cellSize),u=Math.ceil((e.z+t-this.bounds.min[2])/this.cellSize),h=Math.max(0,r),f=Math.min(this.gridSize[0]-1,a),m=Math.max(0,o),g=Math.min(this.gridSize[1]-1,l),x=Math.max(0,c),v=Math.min(this.gridSize[2]-1,u);for(let y=h;y<=f;y++)for(let b=m;b<=g;b++)for(let S=x;S<=v;S++){const T=`${y},${b},${S}`,M=this.grid.get(T);M&&M.forEach(({instance:C,index:w})=>{const N=C.position[0]-e.x,E=C.position[1]-e.y,B=C.position[2]-e.z,U=N*N+E*E+B*B;U<=s&&n.push({instance:C,index:w,distance:Math.sqrt(U),cellKey:T})})}return n.sort((y,b)=>y.distance-b.distance),n}getAllInstances(){const e=[];return this.grid.forEach((t,n)=>{t.forEach(({instance:s,index:r})=>{e.push({instance:s,index:r,cellKey:n})})}),e}getStats(){let e=0,t=0,n=0,s=1/0;this.grid.forEach(a=>{e+=a.length,t++,n=Math.max(n,a.length),s=Math.min(s,a.length)});const r=e/t||0;return{totalCells:this.gridSize[0]*this.gridSize[1]*this.gridSize[2],occupiedCells:t,totalInstances:e,avgInstancesPerCell:r.toFixed(2),maxInstancesPerCell:n,minInstancesPerCell:s===1/0?0:s,occupancy:(t/(this.gridSize[0]*this.gridSize[1]*this.gridSize[2])*100).toFixed(2)+"%"}}clear(){this.grid.clear()}printStats(){this.getStats()}}function GAe(i,e=[0,0,0],t=null){const[n,s]=i,[r,a,o]=e,l=t||Math.max(n,s)/15,c={min:[r-n/2,a-10,o-s/2],max:[r+n/2,a+10,o+s/2]};return new FAe(c,l)}const VJ="/tree.glb",zAe=i=>{const e=typeof i=="number"?i.toString():String(i);let t=0;for(let n=0;n<e.length;n+=1)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t>>>0},VAe=i=>{let e=zAe(i);return()=>{e+=1831565813;let t=e;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}},HAe=(i,e,t)=>{if(!i||!i.image)return null;const n=document.createElement("canvas"),s=n.getContext("2d"),r=i.image;n.width=r.width||r.videoWidth||1,n.height=r.height||r.videoHeight||1,s.drawImage(r,0,0,n.width,n.height);const o=s.getImageData(0,0,n.width,n.height).data,[l,c]=[189,189],[u,h]=[t[0],t[2]];return(f,m)=>{const g=(f-u)/l+.5,x=(m-h)/c+.5,v=Math.max(0,Math.min(1,g)),y=Math.max(0,Math.min(1,x)),b=Math.floor(v*(n.width-1)),T=(Math.floor(y*(n.height-1))*n.width+b)*4;return o[T]/255}};function kAe({modelPath:i=VJ,count:e=1e3,areaSize:t=[100,100],position:n=[0,0,0],minHeight:s=0,maxHeight:r=0,minScale:a=.8,maxScale:o=1.2,baseScale:l=[1,1,1],avoidRadius:c=0,seed:u=2024,gridSize:h=16,atlasSize:f=2048,octType:m=0,geometryArgs:g=[2,2],roughness:x=1,metalness:v=0,alphaTest:y=.5,envMapIntensity:b=1,usePostProcessing:S=!0,brightness:T=1,contrast:M=1,optimizeSize:C=!1,atlasCoverage:w=1,usePostDilatation:N=!1,dilationRadius:E=1,lodDistances:B=[50,100,200,400],maxVisibleDistance:U=500,spatialCellSize:H=null,enableFrustumCulling:F=!0,showDebugInfo:V=!1,frustumCulled:Y=!1,showWireframe:P=!1,distributionTexture:X=null,distributionIntensity:J=1,distributionThreshold:re=0,atlasPaths:ne=null}){const ge=$.useRef(null),{camera:Te}=ts(),[Be,et]=$.useState(0),[wt,be]=$.useState(null),Re=$.useMemo(()=>new Fn,[]),tt=$.useMemo(()=>new z,[]),Bt=$.useMemo(()=>new zh,[]),ht=$.useMemo(()=>new Lt,[]),Ke=lx("/customShadow.webp");Ke.generateMipmaps=!0,Ke.flipY=!0;const jt=typeof X=="string"&&X?X:"/default.svg",Mt=lx(jt);$.useEffect(()=>{Mt&&typeof X=="string"&&X&&jt===X&&(Mt.wrapS=Zr,Mt.wrapT=Zr,Mt.minFilter=Jt,Mt.magFilter=Jt,Mt.generateMipmaps=!1,Mt.flipY=!1)},[Mt,X,jt]);const Ie=$.useMemo(()=>X?typeof X=="string"?jt===X&&Mt||null:X:null,[X,Mt,jt]),ke=$.useMemo(()=>!Ie||!Ie.image?null:HAe(Ie,t,[4.5,0,-2.2]),[Ie,t,n]),Ve=mr(i),at=$.useMemo(()=>{if(!(Ve!=null&&Ve.scene))return null;let Me=null;return Ve.scene.traverse(Q=>{!Me&&Q.isMesh&&(Me=Q)}),Me&&(Me.userData.__impostorSourceId=i),Me},[Ve,i]),Z=$.useMemo(()=>PAe(m,h),[m,h]),zt=$.useMemo(()=>{try{return PO(m,h)}catch(Me){return console.error("Failed to build octahedral mesh:",Me),null}},[m,h]),st=$.useMemo(()=>ne?Array.isArray(ne)?ne:[ne]:null,[ne]),Vt=$.useRef(new $f),[Je,K]=$.useState([]),[I,ue]=$.useState(!1);$.useEffect(()=>{if(!st||!at||!zt){K([]),ue(!1);return}ue(!0);const Me=st.map(Q=>new Promise((pe,He)=>{Vt.current.load(Q,it=>{it.flipY=!1,it.needsUpdate=!0,pe({texture:it,gridSize:h,octType:m,octahedralData:zt})},void 0,it=>{console.error(`Failed to load atlas texture ${Q}:`,it),He(it)})}));Promise.all(Me).then(Q=>{K(Q),ue(!1)}).catch(Q=>{console.error("Error loading atlas textures:",Q),ue(!1)})},[st,at,h,m,zt]);const{atlas:Ne,isGenerating:ze}=BAe({mesh:at,gridSize:h,atlasSize:f,octType:m,enabled:!!at&&!st,saveAtlasPath:"/atlas.webp"}),we=$.useMemo(()=>st&&Je.length>0?Je[0]:Ne,[st,Je,Ne]),Ut=ze||I,dt=$.useMemo(()=>{if(e<=0)return[];if(X&&!ke)return[];const[Me,Q]=t,[pe,He,it]=n,[qe,We,lt]=l,Dt=VAe(u),mn=[];let xn=0;const Oi=e*20;for(;mn.length<e&&xn<Oi;){xn+=1;const Vi=(Dt()-.5)*Me,ea=(Dt()-.5)*Q,ta=pe+Vi,Cs=it+ea;if(c>0&&Math.hypot(ta-pe,Cs-it)<c)continue;if(ke){const na=ke(ta,Cs);if(na<re)continue;const Ri=na*J;if(Dt()>Ri)continue}const gr=s===r?s:s+Dt()*(r-s),Qi=a===o?Math.max(1e-4,a):Math.max(1e-4,a+Dt()*(o-a)),ws=st&&st.length>1?Math.floor(Dt()*st.length):0,sn=.3+Dt()*1;mn.push({position:[ta,He+gr,Cs],scale:[Math.abs(qe*Qi),Math.abs(We*Qi),Math.abs(lt*Qi)],visible:!0,lodLevel:0,atlasIndex:ws,metalness:sn})}return mn},[e,t,n,l,s,r,a,o,c,u,X,ke,J,re,st]),Pt=$.useMemo(()=>{if(dt.length===0)return null;const Me=H||Math.max(...t)/15,Q=GAe(t,n,Me);return dt.forEach((pe,He)=>{Q.addInstance(pe,He)}),V&&Q.printStats(),Q},[dt,t,n,H,V]);$.useEffect(()=>{if(!ge.current||dt.length===0)return;const Me=ge.current;dt.forEach((Q,pe)=>{Re.position.set(...Q.position),Re.scale.set(...Q.scale),Re.updateMatrix(),Me.setMatrixAt(pe,Re.matrix)}),Me.instanceMatrix.needsUpdate=!0},[dt,Re]);const Qt=$.useRef(0),Xe=$.useRef(null),Qe=$.useRef(null),Et=$.useRef(null),ee=$.useMemo(()=>{if(e<=0)return null;const Me=new Cc(...g),Q=new Float32Array(e);Q.fill(8),Xe.current=Q;const pe=new Float32Array(e);pe.fill(0),Qe.current=pe;const He=new Float32Array(e);He.fill(0),Et.current=He;const it=new Yr(Q,1);Me.setAttribute("faceIndex",it);const qe=new Yr(pe,1);Me.setAttribute("atlasIndex",qe);const We=new Yr(He,1);return Me.setAttribute("metalness",We),Me},[e,g]);$.useEffect(()=>{if(!ee||dt.length===0)return;const Me=ee.getAttribute("atlasIndex");Me&&Qe.current&&(dt.forEach((pe,He)=>{Qe.current[He]=pe.atlasIndex||0}),Me.needsUpdate=!0);const Q=ee.getAttribute("metalness");Q&&Et.current&&(dt.forEach((pe,He)=>{Et.current[He]=pe.metalness||0}),Q.needsUpdate=!0)},[ee,dt]),yu(()=>{if(!ge.current||!Te||!we||!Pt||!Z)return;const Me=ge.current,Q=Te.position;Qt.current++,F&&(Te.updateMatrixWorld(),ht.multiplyMatrices(Te.projectionMatrix,Te.matrixWorldInverse),Bt.setFromProjectionMatrix(ht));const pe=Pt.queryNearCamera(Q,U*1.2);for(let it=0;it<pe.length;it++){const{instance:qe,index:We,distance:lt}=pe[it];if(tt.set(...qe.position),F&&!Bt.containsPoint(tt))Re.scale.set(0,0,0);else{let Dt=1,mn=!0;if(lt>B[3]?mn=!1:lt>B[2]?Dt=.4:lt>B[1]?Dt=.7:lt>B[0]&&(Dt=.9),!mn)Re.scale.set(0,0,0);else{const Oi=g[1]*qe.scale[1]*Dt*.5;Re.position.set(qe.position[0],qe.position[1]+Oi,qe.position[2]),Re.lookAt(Q),Re.scale.set(qe.scale[0]*Dt,qe.scale[1]*Dt,qe.scale[2]*Dt);const Vi=new z().subVectors(tt,Q).normalize(),ea=new z,ta=new z;OAe({direction:Vi,cache:Z,indicesTarget:ea,weightsTarget:ta})&&Xe.current&&(Xe.current[We]=ea.x)}}Re.updateMatrix(),Me.setMatrixAt(We,Re.matrix)}const He=new Set(pe.map(it=>it.index));if(Qt.current%10===0&&dt.forEach((it,qe)=>{He.has(qe)||(Re.scale.set(0,0,0),Re.updateMatrix(),Me.setMatrixAt(qe,Re.matrix))}),Me.instanceMatrix.needsUpdate=!0,ee){const it=ee.getAttribute("faceIndex");it&&(it.needsUpdate=!0)}V&&Qt.current%30===0&&et(pe.length)});const me=$.useMemo(()=>{if(!we||st&&Je.length===0)return null;const Me=new tw;Me.transparent=!0,Me.side=Ps,Me.alphaMap=Ke,Me.roughness=1,Me.alphaTest=.2,Me.depthWrite=!1,Me.depthTest=!0,Me.wireframe=P;const Q=X2("faceIndex"),pe=X2("atlasIndex"),He=X2("metalness"),it=kl(),qe=_e(h),We=_e(1).div(qe),lt=Q.div(qe).floor(),Dt=Q.sub(lt.mul(qe)),mn=_e(h-1),xn=lt.clamp(0,mn),Oi=Dt.clamp(0,mn),Vi=Ui(Oi.add(it.x).mul(We),xn.add(it.y).mul(We));let ea;if(st&&Je.length>1){const Cs=Je.map(Qi=>bs(Qi.texture)).map(Qi=>Qi.sample(Vi));let gr=Cs[0];for(let Qi=1;Qi<Cs.length;Qi++){const ws=_e(Qi),sn=pe.sub(ws).abs(),na=_e(1).sub(sn.step(_e(.5)));gr=qs(gr,Cs[Qi],na)}ea=gr}else ea=bs(we.texture).sample(Vi);return Me.colorNode=ea.rgb,Me.opacityNode=P?1:ea.a,Me.metalnessNode=He,Me},[we,Je,st,h,P]);return $.useEffect(()=>()=>{me&&me.dispose(),ee&&ee.dispose()},[me,ee]),$.useEffect(()=>{!Ut&&we&&me&&ee&&dt.length>0&&ge.current?Oe.treesLoaded=!0:Oe.treesLoaded=!1},[Ut,we,me,ee,dt.length]),Ut||!we||!me||!ee||dt.length===0?null:G.jsx(G.Fragment,{children:G.jsx("instancedMesh",{ref:ge,args:[ee,me,e],matrixAutoUpdate:!1,frustumCulled:Y,castShadow:!0})})}mr.preload(VJ);function WAe({sampleIntervalSeconds:i=.1}){const e=$.useRef(),t=qi(Oe),[n,s]=$.useState(null);return $.useEffect(()=>{if(!e.current)return;const r=ps(new XAe(e.current,new Ye("#ffffff"),new Ye("#ffffff"),a=>{Oe.sunOccluded=a}));s(r)},[]),yu((r,a)=>{e.current&&e.current.position.set(t.sunPositionForLensFlare[0],t.sunPositionForLensFlare[1],t.sunPositionForLensFlare[2])}),G.jsxs("mesh",{occlusionTest:!0,ref:e,renderOrder:9,children:[G.jsx("sphereGeometry",{args:[1,8,8]}),G.jsx("meshPhongNodeMaterial",{colorNode:n,transparent:!0,opacity:0,depthWrite:!0})]})}class XAe extends Gt{constructor(t,n,s,r){super("vec3");m_(this,"testObject");m_(this,"uniformNode");m_(this,"onChange");m_(this,"lastState",null);this.updateType=on.OBJECT,this.uniformNode=ut(new Ye),this.testObject=t,this.onChange=r}async update(t){var s;const n=t.renderer.isOccluded(this.testObject);n!==this.lastState&&(this.lastState=n,(s=this.onChange)==null||s.call(this,n))}setup(){return this.uniformNode}}function qAe(){const{isDraggingCamera:i}=qi(Oe);return G.jsx(G.Fragment,{children:G.jsx("div",{className:"header-wrapper-panel",children:G.jsx("div",{className:`header-logo-container-panel ${i?"hidden":""}`,children:G.jsx("img",{src:"/images/planpoint.svg",alt:"logo",width:"auto",height:24})})})})}function jAe(){const i=$.useRef(),{camera:e}=ts();return yu(()=>{const t=new z,n=new Cb;e.getWorldDirection(t),n.setFromVector3(t),i.current&&(i.current.style.transform=`rotate(${Fh.radToDeg(n.theta)-45}deg)`)}),G.jsx(TJ,{wrapperClass:"compass",calculatePosition:()=>[0,0,0],ref:i,style:{position:"absolute",bottom:"20px",right:"20px",width:"80px",height:"80px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"white",zIndex:1e3},children:G.jsxs("div",{children:[G.jsx("p",{style:{position:"absolute",transform:"rotate(45deg)",transformOrigin:"center 95px",fontSize:"11px",fontWeight:"bold",top:"-35px"},children:"N"}),G.jsx("img",{width:"80px",height:"80px",draggable:!1,src:"/images/compass.svg",style:{paddingRight:"1px"}})]})})}const YAe=[{id:"dining",title:"DINING",items:[{name:"Bon Vivant",position:[-4.5,1.5,-5.7],description:"Upscale French bistro offering authentic cuisine and fine wines in an elegant atmosphere.",distance:120},{name:"The Smoked Vine",position:[1.5,1.5,-7.7],description:"Modern barbecue restaurant specializing in slow-smoked meats and craft cocktails.",distance:130},{name:"Veg Aroma",position:[4.5,1.5,-8],description:"Popular vegetarian restaurant serving flavorful Indian and international plant-based dishes.",distance:150},{name:"Shagun Dining Hall",position:[2,1,8.5],description:"Traditional Indian restaurant known for its extensive buffet and festive dining experience.",distance:140}]},{id:"shopping",title:"SHOPPING",items:[{name:"Kohinoor Arcade",position:[10.5,1.5,-2],description:"Luxury shopping destination featuring premium brands, jewelry, and designer boutiques.",distance:180},{name:"DMart",position:[-9.5,1.5,-1.5],description:"Large discount supermarket chain offering groceries, household items, and daily essentials.",distance:160},{name:"Royal Super Market",position:[-7,1.5,-15.5],description:"Well-stocked neighborhood supermarket with fresh produce, meats, and specialty items.",distance:280},{name:"Saraf Bazar",position:[15,1.5,-18],description:"Traditional market street with local vendors selling textiles, spices, and handicrafts.",distance:380}]},{id:"entertainment",title:"ENTERTAINMENT",items:[{name:"X3 Esports",position:[11.5,1.5,-6],description:"State-of-the-art gaming center with high-end PCs, tournaments, and esports events.",distance:200},{name:"Trampoline Park",position:[3,1.5,32],description:"Fun-filled indoor activity center with trampolines, obstacle courses, and kids' zones.",distance:520},{name:"Shoppers Orbit",position:[6,2,-20],description:"Modern entertainment complex with multiplex cinema, food court, and retail stores.",distance:340},{name:"Seasons Mall",position:[-14,1.5,-22],description:"Large shopping and entertainment mall with cinemas, restaurants, and brand outlets.",distance:420}]},{id:"education",title:"EDUCATION",items:[{name:"Don Bosco High School",position:[-2,1.5,-14],description:"Reputed Catholic school offering quality education with modern facilities and sports programs.",distance:230},{name:"Nirmala Convent High School",position:[16,1.5,-12],description:"Established convent school known for academic excellence and holistic student development.",distance:320},{name:"St. Xavier High School",position:[13,1.5,5.5],description:"Prestigious Jesuit institution providing comprehensive education and character building.",distance:240}]}];function KAe(){const i=qi(Oe);return i.openedPanel==="surroundings-panel"?G.jsx(G.Fragment,{children:YAe.map(t=>t.items.map((n,s)=>{const r=`${t.id}-${s}`,a=i.hoveredPointOfInterest===r,l=i.hoveredPointOfInterest!==null&&!a;return G.jsx(YTe,{position:n.position,follow:!0,children:G.jsxs(TJ,{style:{pointerEvents:"auto",userSelect:"none",width:"35px",height:"35px"},zIndexRange:[1,2],wrapperClass:"point-of-interest-tooltip",children:[a&&G.jsxs("div",{style:{color:"white",fontSize:"12px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",whiteSpace:"normal",width:"250px",padding:"12px 16px",backgroundColor:"rgba(5, 5, 5, 0.85)",backdropFilter:"blur(8px)",borderRadius:"8px",position:"absolute",top:n.position[1]-40,left:n.position[0]+50,border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:2},children:[G.jsx("div",{style:{marginBottom:"6px",fontSize:"13px"},children:n.name.toUpperCase()}),G.jsx("div",{style:{fontSize:"10px",fontWeight:400,opacity:.9,lineHeight:"1.4",textTransform:"none",marginBottom:"4px"},children:n.description}),G.jsx("div",{style:{fontSize:"10px",fontWeight:500,opacity:.8,color:"#4FC3F7",marginTop:"6px"},children:n.distance<1e3?`${n.distance}m away`:`${(n.distance/1e3).toFixed(1)}km away`})]}),G.jsx("div",{style:{borderRadius:"100%",width:"35px",height:"35px",backgroundColor:a?"#4279f7":"rgba(255, 255, 255, 1)",opacity:l?0:1,transition:"opacity 0.4s ease",cursor:"pointer",cursor:"url('/pointer.svg') 8 4, pointer"},onMouseEnter:()=>{Oe.hoveredPointOfInterest=r},onMouseLeave:()=>{Oe.hoveredPointOfInterest=null},children:G.jsx("img",{src:t.id==="dining"?"/images/restaurant.png":t.id==="shopping"?"/images/shopping.png":t.id==="entertainment"?"/images/entertainment.png":t.id==="education"?"/images/education.png":"/images/restaurant.png",alt:t.title,style:{width:"100%",height:"100%",objectFit:"contain",scale:.5,cursor:"url('/pointer.svg') 8 4, pointer",filter:a?"invert(1)":"none"}})})]})},r)}))}):null}function ZAe(i){const e=i.match(/^(\d+)f_(ne|nw|se|sw)$/i);if(!e)return i;const t=e[1],n=e[2].toUpperCase();return`Unit ${t}${n}`}function JAe(){const i=qi(Oe),[e,t]=$.useState([0,0]);if($.useEffect(()=>{const r=a=>{const o=[a.clientX,a.clientY];t(o),Oe.mousePosition=o};return window.addEventListener("mousemove",r),()=>window.removeEventListener("mousemove",r)},[]),i.openedPanel!=="unit-search"||!i.hoveredUnitId||!cx[i.hoveredUnitId])return null;const s=ZAe(i.hoveredUnitId);return G.jsxs("div",{style:{position:"fixed",left:0,top:0,pointerEvents:"none",transform:`translate(${e[0]+10}px, ${e[1]+10}px)`,color:"white",fontSize:"12px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",whiteSpace:"nowrap",padding:"8px 12px",backgroundColor:"rgba(5, 5, 5, 0.85)",backdropFilter:"blur(8px)",borderRadius:"6px",border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3},children:[G.jsx("div",{style:{marginBottom:"4px",fontSize:"13px"},children:s}),G.jsx("div",{style:{fontSize:"10px",fontWeight:400,opacity:.9,textTransform:"none"},children:"Tap to see details"})]})}function QAe(){const{isMobile:i,isTablet:e,finishedLoadingAsset:t}=qi(Oe),[n,s]=$.useState(()=>ok());return $.useEffect(()=>{const r=()=>{s(ok())};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),G.jsxs(G.Fragment,{children:[G.jsxs(jve,{gl:async r=>{oZ(Ope),r.antialias=!1,r.samples=0,r.antialias=!1,r.alpha=!1,r.toneMapping=Ki;const a=new _K(r);a.powerPreference="high-performance";const o=new M_e;a.inspector=o,await a.init();const l=a.domElement.parentElement;return l&&!o.domElement.parentElement&&l.appendChild(o.domElement),a},shadows:i?"variance":"soft",dpr:n,frameloop:i?"always":"demand",camera:{position:[-5,1.2,5],fov:e?50:i?75:45,near:.1,far:1e3},children:[G.jsxs($.Suspense,{fallback:null,children:[G.jsx(rAe,{}),G.jsx(WAe,{}),G.jsx(SAe,{}),G.jsx(m1e,{enabled:!0,adaptiveDPR:n}),G.jsx(_Ae,{scale:.08,position:[5.8,0,1]}),G.jsx(kAe,{position:[0,-.09,0],count:15e3,areaSize:[110,110],minScale:.4,maxScale:.7,baseScale:[1,1,1],avoidRadius:4,seed:22,gridSize:16,atlasSize:4096,octType:0,geometryArgs:[2,2],showWireframe:!1,maxVisibleDistance:70,lodDistances:[150,160,180,260],optimizeSize:!0,enableFrustumCulling:!0,distributionTexture:"/distribution.webp",distributionIntensity:10,distributionThreshold:.01,atlasPaths:["/atlas.webp","/atlas2.webp"]}),G.jsx(eAe,{}),G.jsx(KAe,{})]}),t&&!i&&G.jsx(jAe,{})]}),G.jsx(T1e,{}),G.jsx(qAe,{}),G.jsx(aAe,{}),G.jsx(oAe,{}),G.jsx(lAe,{}),G.jsx(cAe,{}),G.jsx(JAe,{}),G.jsx(tAe,{}),G.jsx(TAe,{radius:.7,softness:1,intensity:.2})]})}l9.createRoot(document.getElementById("root")).render(G.jsx(QAe,{}));
