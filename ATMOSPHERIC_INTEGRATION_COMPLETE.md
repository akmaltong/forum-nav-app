# ‚úÖ –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ –≤–Ω–µ–¥—Ä–µ–Ω–æ!

## –î–∞—Ç–∞: 12 —Ñ–µ–≤—Ä–∞–ª—è 2026

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

#### 1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–∞–∫–µ—Ç—ã
```bash
‚úÖ @takram/three-atmosphere
‚úÖ @takram/three-geospatial  
‚úÖ @takram/three-geospatial-effects
```

#### 2. –°–æ–∑–¥–∞–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç AtmosphericScene.tsx

**–ù–∞ –æ—Å–Ω–æ–≤–µ:** World Origin Rebasing –ø—Ä–∏–º–µ—Ä –∏–∑ three-geospatial

**–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç:**
- ‚úÖ Atmosphere —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- ‚úÖ Sky —Å —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —Ç–æ—á–Ω—ã–º –Ω–µ–±–æ–º
- ‚úÖ SunLight —Å —Ç–µ–Ω—è–º–∏ (2048x2048 shadow map)
- ‚úÖ SkyLight –¥–ª—è –Ω–µ–ø—Ä—è–º–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è
- ‚úÖ HemisphereLight –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–≤–µ—Ç–∞ –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞
- ‚úÖ AerialPerspective –¥–ª—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- ‚úÖ LensFlare –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –æ—Ç —Å–æ–ª–Ω—Ü–∞
- ‚úÖ ToneMapping (ACES Filmic)
- ‚úÖ Dithering –¥–ª—è –ø–ª–∞–≤–Ω—ã—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤

#### 3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ Scene3D.tsx

**–£–¥–∞–ª–µ–Ω–æ:**
- ‚ùå AtmosphereSky (—Å—Ç–∞—Ä—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
- ‚ùå HDRIEnvironment
- ‚ùå –°—Ç–∞—Ä—ã–µ HemisphereLight –∏ DirectionalLight
- ‚ùå Effects –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–∑–∞–º–µ–Ω–µ–Ω –Ω–∞ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ Atmosphere)

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ AtmosphericScene –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- ‚úÖ –í—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤–Ω—É—Ç—Ä–∏ Atmosphere

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

### –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:

```tsx
// –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –ø–æ–∑–∏—Ü–∏—è (–¢–æ–∫–∏–æ)
const geodetic = new Geodetic(
  radians(139.7),  // –î–æ–ª–≥–æ—Ç–∞
  radians(35.7),   // –®–∏—Ä–æ—Ç–∞  
  500              // –í—ã—Å–æ—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö
)

// –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ ECEF –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
const position = geodetic.toECEF()

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–∏—Ä–∞
Ellipsoid.WGS84.getNorthUpEastFrame(
  position,
  atmosphere.worldToECEFMatrix
)
```

### –í—Ä–µ–º—è —Å—É—Ç–æ–∫:

```tsx
// –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ –ø–æ–ª–¥–µ–Ω—å –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —è—Ä–∫–æ—Å—Ç–∏
const noonDate = new Date()
noonDate.setHours(12, 0, 0, 0)

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä
useFrame(() => {
  atmosphere.updateByDate(noonDate)
})
```

### –û—Å–≤–µ—â–µ–Ω–∏–µ:

**Light-source lighting —Ä–µ–∂–∏–º:**
- SunLight - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∏ —Ü–≤–µ—Ç
- SkyLight - –Ω–µ–ø—Ä—è–º–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ –æ—Ç –Ω–µ–±–∞
- HemisphereLight - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–≤–µ—Ç –¥–ª—è –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞ (0.4)

**–¢–µ–Ω–∏:**
- Orthographic shadow camera
- 2048x2048 shadow map
- normalBias: 0.1
- –û–±–ª–∞—Å—Ç—å: 50x50 –º–µ—Ç—Ä–æ–≤

### –≠—Ñ—Ñ–µ–∫—Ç—ã –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏:

1. **AerialPerspective** - –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–µ —Ä–∞—Å—Å–µ–∏–≤–∞–Ω–∏–µ —Å–≤–µ—Ç–∞
2. **LensFlare** - —ç—Ñ—Ñ–µ–∫—Ç –±–ª–∏–∫–æ–≤ –æ—Ç —Å–æ–ª–Ω—Ü–∞
3. **ToneMapping** - ACES Filmic –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤
4. **Dithering** - —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–æ—Å –Ω–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞—Ö

---

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

### –î–æ (HDRI —Ä–µ–∂–∏–º):
```tsx
<HDRIEnvironment />
<hemisphereLight intensity={0.6} />
<directionalLight intensity={2.0} />
<Effects />
```

### –ü–æ—Å–ª–µ (Atmospheric —Ä–µ–∂–∏–º):
```tsx
<AtmosphericScene>
  <Atmosphere>
    <Sky />
    <SunLight />
    <SkyLight />
    <hemisphereLight intensity={0.4} />
    <EffectComposer>
      <AerialPerspective />
      <LensFlare />
      <ToneMapping />
      <Dithering />
    </EffectComposer>
  </Atmosphere>
</AtmosphericScene>
```

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

‚úÖ **–§–∏–∑–∏—á–µ—Å–∫–∏ —Ç–æ—á–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ** - –∞–ª–≥–æ—Ä–∏—Ç–º –ë—Ä—é–Ω–µ—Ç–æ–Ω–∞
‚úÖ **–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –Ω–µ–±–æ** - –≤–º–µ—Å—Ç–æ HDRI —Ç–µ–∫—Å—Ç—É—Ä—ã
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç** - –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å–æ–ª–Ω—Ü–∞, —Ü–≤–µ—Ç, –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å
‚úÖ **–ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã** - –¥—ã–º–∫–∞, —Ä–∞—Å—Å–µ–∏–≤–∞–Ω–∏–µ —Å–≤–µ—Ç–∞
‚úÖ **Lens flare** - –∫—Ä–∞—Å–∏–≤—ã–µ –±–ª–∏–∫–∏ –æ—Ç —Å–æ–ª–Ω—Ü–∞
‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π tone mapping** - ACES Filmic
‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–∞—à–∏–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏** - MeshStandardMaterial —Å–æ–≤–º–µ—Å—Ç–∏–º
‚úÖ **–¢–µ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç** - SunLight —Å castShadow

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏:

### –ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è —Å—É—Ç–æ–∫:

```tsx
// –í AtmosphericScene.tsx
const noonDate = new Date()
noonDate.setHours(14, 30, 0, 0) // 14:30
```

### –ò–∑–º–µ–Ω–∏—Ç—å —è—Ä–∫–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞:

```tsx
<hemisphereLight 
  intensity={0.6}  // –£–≤–µ–ª–∏—á–∏—Ç—å –¥–ª—è –±–æ–ª–µ–µ —è—Ä–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞
/>
```

### –ò–∑–º–µ–Ω–∏—Ç—å –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –ø–æ–∑–∏—Ü–∏—é:

```tsx
const geodetic = new Geodetic(
  radians(–¥–æ–ª–≥–æ—Ç–∞),
  radians(—à–∏—Ä–æ—Ç–∞),
  –≤—ã—Å–æ—Ç–∞_–≤_–º–µ—Ç—Ä–∞—Ö
)
```

### –û—Ç–∫–ª—é—á–∏—Ç—å lens flare:

```tsx
<EffectComposer multisampling={8}>
  <AerialPerspective />
  {/* <LensFlare /> */}  // –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å
  <ToneMapping mode="ACES_FILMIC" />
  <Dithering />
</EffectComposer>
```

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- Multisampling: 8 (—Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ)
- Shadow map: 2048x2048 (–±–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–∞/–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
- Precomputed textures (–∫–µ—à–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

**–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ FPS:**
1. –£–º–µ–Ω—å—à–∏—Ç—å multisampling –¥–æ 4 –∏–ª–∏ 0
2. –£–º–µ–Ω—å—à–∏—Ç—å shadow map –¥–æ 1024x1024
3. –û—Ç–∫–ª—é—á–∏—Ç—å LensFlare

---

## Troubleshooting:

### –°–ª–∏—à–∫–æ–º —Ç–µ–º–Ω–æ:
```tsx
// –£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å HemisphereLight
<hemisphereLight intensity={0.8} />
```

### –°–ª–∏—à–∫–æ–º —Å–≤–µ—Ç–ª–æ:
```tsx
// –£–º–µ–Ω—å—à–∏—Ç—å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è
noonDate.setHours(16, 0, 0, 0) // –ü–æ–∑–∂–µ –¥–Ω–µ–º
```

### –ù–µ—Ç —Ç–µ–Ω–µ–π:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–æ–¥–µ–ª—å –∏–º–µ–µ—Ç `castShadow` –∏ `receiveShadow`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ SunLight –∏–º–µ–µ—Ç `castShadow`

### –ß–µ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É

---

## –§–∞–π–ª—ã:

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ:**
- ‚úÖ `src/components/AtmosphericScene.tsx` - –≥–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ:**
- ‚úÖ `src/components/Scene3D.tsx` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- ‚úÖ `ATMOSPHERE_EXAMPLES_ANALYSIS.md` - –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤
- ‚úÖ `ATMOSPHERIC_INTEGRATION_COMPLETE.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

---

## –°–ª–µ–¥—É—é—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

### –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

1. **–ö–æ–Ω—Ç—Ä–æ–ª—å –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫:**
   - –°–ª–∞–π–¥–µ—Ä –≤ UI –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
   - –ê–Ω–∏–º–∞—Ü–∏—è –≤–æ—Å—Ö–æ–¥–∞/–∑–∞–∫–∞—Ç–∞

2. **–ó–≤–µ–∑–¥—ã:**
   ```tsx
   <Stars data='atmosphere/stars.bin' />
   ```

3. **–û–±–ª–∞–∫–∞:**
   ```tsx
   import { Clouds } from '@takram/three-clouds/r3f'
   <Clouds />
   ```

4. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø–æ–≥–æ–¥–∞:**
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏
   - –¢—É–º–∞–Ω
   - –î–æ–∂–¥—å

5. **–í—ã–±–æ—Ä –ª–æ–∫–∞—Ü–∏–∏:**
   - UI –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
   - –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–ú–æ—Å–∫–≤–∞, –ù—å—é-–ô–æ—Ä–∫, –¢–æ–∫–∏–æ)

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç:

üéâ **–§–∏–∑–∏—á–µ—Å–∫–∏ —Ç–æ—á–Ω–æ–µ –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!**

- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –Ω–µ–±–æ —Å —Å–æ–ª–Ω—Ü–µ–º
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–µ–Ω–∏
- –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
- Lens flare –æ—Ç —Å–æ–ª–Ω—Ü–∞
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ —Å –Ω–∞—à–∏–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å!** ‚òÄÔ∏èüåÖ
